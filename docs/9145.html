<html>
<head>
<title>Learning Flask being an iOS Developer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习Flask成为iOS开发者</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/learning-flask-being-an-ios-developer-3c6ec8c2ba83?source=collection_archive---------4-----------------------#2017-12-28">https://medium.com/hackernoon/learning-flask-being-an-ios-developer-3c6ec8c2ba83?source=collection_archive---------4-----------------------#2017-12-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="71f5" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">作为一名iOS开发人员，我相信在你生活中的某个时候，你会想:“如果我也编写应用程序的后端会怎么样？”。这似乎是一个很好的想法，因为你不仅能够编写应用程序的后端，而且后端还将用于服务于其他前端技术(Android，Web等)。).</h2></div><p id="88f1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">从你已经知道的东西中学习新的东西更有意义。这就是本课程的目的，始终从iOS开发人员的角度，教您如何使用Flask开发REST API。</p><p id="81d0" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">需要理解并能够遵循一些要求:</p><ul class=""><li id="d882" class="kf kg hu jl b jm jn jp jq js kh jw ki ka kj ke kk kl km kn dt translated">iOS开发知识</li><li id="a390" class="kf kg hu jl b jm ko jp kp js kq jw kr ka ks ke kk kl km kn dt translated">Python基础知识</li></ul><p id="a1bd" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在iOS开发方面，我是一个速度很快的人。我过去有过使用Objective-C的经验，但现在我只是在编写Swift，本系列将针对它。</p><p id="9b5b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">关于Python，需要一个基础知识，你应该能够理解变量、缩进、函数、类等。我不会在这里详细介绍，因为这会使课程太长。在我写作的时候，<a class="ae kt" href="http://codecademy.com" rel="noopener ugc nofollow" target="_blank"> Codecademy </a>有一个很棒的免费Python课程，足以让你理解这个课程。</p><p id="cd3c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在整个课程中，我们将下载和使用不同的应用程序和软件，但一切都是免费的，所以我不会在这里列出它们。</p></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="16c7" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">这门课是关于什么的？</h1><p id="1d78" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">这里的主要目标是教你如何用Flask创建一个REST API，但是我们应该给它一个“主题”,让它更容易学习。我们将为包含<em class="ly">学校</em>和<em class="ly">学生</em>的学校网络创建一个API。我们还将实现一个登录系统，并让一些端点需要身份验证</p><p id="8537" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">理论上，数据库的图表如下所示:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff fg"><img src="../Images/fcc29adf75efc68091005dd8dc71967a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rvbNiNV70rsPcd_utJtLgQ.png"/></div></div><figcaption class="mk ml fg fe ff mm mn bd b be z ek">We’ll keep it simple with this structure</figcaption></figure><p id="2d70" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您不理解关系数据库是如何工作，请不要担心，因为我将解释完成本课程您应该知道的一切。无论如何，将来参加数据库课程是个好主意，因为这是开发API的关键部分。</p></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="7718" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">该开始了</h1><p id="d8b1" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">首先我们需要一个文本编辑器，它可以是你喜欢的任何文本编辑器(如果你没有，我推荐Atom或Sublime)。</p><p id="8da3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我倾向于在文件夹中分离项目，我建议你也这样做。我的桌面上有一个名为“SchoolsManager”的文件夹，我们所做的一切都在里面。(我建议不要在任何文件夹的名称中使用空格，因为这会在使用virtualenv时带来问题)</p><h2 id="0f2a" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">安装Python和virtualenv</h2><p id="b216" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">如果您已经安装了Python和virtualenv，请跳过这一节。</p><p id="2449" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">去<a class="ae kt" href="https://www.python.org" rel="noopener ugc nofollow" target="_blank">https://www.python.org</a>下载最新的稳定版本，因为写的时候是3.6.4</p><p id="39ec" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">请记住，本课程使用的是python3版本，不支持Python2。</em></p><p id="2ea1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">要安装“virtualenv ”,请打开终端并运行以下命令:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="ecbd" class="mo lc hu nd b fv nh ni l nj nk">sudo pip install virtualenv</span></pre><h2 id="dccd" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">什么是‘virtualenv’？</h2><p id="48c1" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">virtualenv创建了一个隔离的Python环境。当你在Python中使用库时(我们几分钟后会用到一些),你使用的是该库的一个特定版本，通常是当前最新的版本。假设你完成了这个API，它工作得很好，你想让它继续运行(以便能够使用它)，并开始开发另一个API。当您创建新的API时，您可能希望使用与第一个API相同的库的更新版本，但是您不想破坏第一个API。这就是我们使用‘virtualenv’的原因。</p><blockquote class="nl"><p id="4bbd" class="nm nn hu bd no np nq nr ns nt nu ke ek translated">这就像给你机会在较新的XCode中继续编码旧的Swift版本，你不会使用吗？</p></blockquote><p id="4f13" class="pw-post-body-paragraph jj jk hu jl b jm nv iv jo jp nw iy jr js nx ju jv jw ny jy jz ka nz kc kd ke hn dt translated">现在我们已经安装了基本组件，我们必须为我们的项目创建“virtualenv ”,为此，请在终端中转到您的文件夹并运行以下命令:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="1474" class="mo lc hu nd b fv nh ni l nj nk">python3 -m venv venv</span></pre><p id="472f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将创建一个名为“venv”的文件夹，其中包含在项目文件夹中创建“virtualenv”所需的所有内容。简单吧。</p><p id="e8e4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，要进入“virtualenv ”,您只需运行:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="8f10" class="mo lc hu nd b fv nh ni l nj nk">. venv/bin/activate</span></pre><p id="ffd4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你被录取了。</p><p id="2b16" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">查看您的命令提示符如何改变，它说(venv):</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff oa"><img src="../Images/639cfd05105628333dbeee6edf7f9914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e97zjy3U_LlcuZaddipUEg.png"/></div></div><figcaption class="mk ml fg fe ff mm mn bd b be z ek">We are inside the ‘virtualenv’</figcaption></figure><p id="a124" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您想离开“virtualenv ”,只需运行:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="1d1c" class="mo lc hu nd b fv nh ni l nj nk">deactivate</span></pre></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="1db7" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">这门课的重点是什么</h1><p id="b7f9" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">我们可以直接进入代码，对吗？当然，但你会被第一个文件中的大量代码淹没，它只有30行代码，相反，你会了解代码背后的所有理论，然后我们会逐行将其与我们在理论中看到的进行比较。所以，试着去理解接下来的这些概念，然后当我们读到代码的时候，你会惊讶于你对它的理解程度。</p><h2 id="bea8" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">安息</h2><p id="bb11" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">我们说我们将创建一个REST API，但是REST是什么意思呢？要让一个API成为REST，它必须遵循一些规则。如今大多数“REST APIs”并不是真正的完全REST，它们只是遵循最基本的规则，这是REST的关键概念。在创建REST API时，我们必须记住，我们将使用“模型”来处理数据库，使用“资源”来处理我们的客户将要与之交互的对象。换句话说，这意味着，当我们从数据库中读取/写入数据时，我们使用“模型”，当我们从客户端(移动应用程序、web等)接收/发送数据时。)我们使用‘资源’。“模型”和“资源”都是类。</p><h2 id="6d58" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">数据库炼金术</h2><p id="faae" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">我们将使用一个名为“SQLAlchemy”的库来读写数据库。SQLAlchemy与SQLite、PostgreSQL、MySQL等一起工作。它的作用是让我们将模型写入数据库，然后检索它们。</p><h2 id="a182" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">JWT</h2><p id="a713" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">JWT是我们用于身份验证的技术，JWT网站对其工作原理有一个很好的定义:</p><blockquote class="nl"><p id="8309" class="nm nn hu bd no np nq nr ns nt nu ke ek translated">用户登录后，每个后续请求都将包含JWT，允许用户访问该令牌允许的路由、服务和资源。</p></blockquote><p id="b6b5" class="pw-post-body-paragraph jj jk hu jl b jm nv iv jo jp nw iy jr js nx ju jv jw ny jy jz ka nz kc kd ke hn dt translated">基本上，这意味着当用户登录到我们的API时，API将创建一个临时的“access_token”，将它传递给用户，并由客户端保存。此后，对于客户端向API发出的每个请求，都应该发送“access_token ”,这样API将知道客户端已经登录。该令牌在一定时间后过期(出于安全原因)，因此用户无法永远登录。通常，iOS应用程序使用某种自动重新登录功能，因此用户不必一直登录。</p></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="702e" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">让我们看看一些代码</h1><p id="a2ac" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">我建议你下载整个项目，我们一步一步来，你可以在这里下载。解压缩它，你得到一个文件夹。</p><p id="34b2" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您刚刚下载的文件夹名为“code ”,它包含所有需要的代码，将其作为“venv”的兄弟放在您的项目文件夹中:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ob"><img src="../Images/68c6dbd4838b05b5ecbf9d0ae36060f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yIOXYYLw9ZNI_RjeUjz8yQ.png"/></div></div></figure><p id="3e76" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在文本编辑器中打开“code”文件夹。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff oc"><img src="../Images/4e1235a39ebf1495f2f8807c8c761665.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9_VRIZSHkKD9OPilq58nRQ.png"/></div></div></figure><h2 id="d47b" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">一些考虑</h2><p id="7abd" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">文件夹“__pycache__”由python自动生成，不应上传到repo，也不应删除。</p><p id="4ffd" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在文件夹“models”和“resources”中，“__init__”文件告诉python这个文件夹是一个包，而不仅仅是一个文件夹。</p><h2 id="22cc" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">SQLAlchemy</h2><p id="bb47" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">有个文件叫“db.py”，打开看看。该文件唯一做的事情是导入“SQLAlchemy”并创建一个名为“db”的变量。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff oc"><img src="../Images/21b9fb0ae466f1c06c16db60e201a3ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*57BhW_Ap-2ujWeLdyvK4oQ.png"/></div></div></figure><p id="7e99" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这使得API中的每个文件都可以调用相同的“SQLAlchemy()”实例。</p></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="decd" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">模型</h1><h2 id="34da" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">用户模型</h2><p id="ec58" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">让我们先看看模型，记住，它们是我们将从数据库中写入和检索的对象。</p><p id="e1a6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在“模型”文件夹中打开“user.py”。</p><p id="1ec9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先，我们导入“db ”,这将允许我们使用“db”变量来访问数据库:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="3c6c" class="mo lc hu nd b fv nh ni l nj nk">from db import db</span></pre><p id="c0ef" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后我们声明这个类:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="39ed" class="mo lc hu nd b fv nh ni l nj nk">class UserModel(db.Model):</span></pre><p id="d9a5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">记住“模型”是与数据库交互的东西。嗯，这就是为什么模型类继承自' db。模型。</p><p id="fcf9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在类的声明中，我们有一个类似于数据库表的东西:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="c47a" class="mo lc hu nd b fv nh ni l nj nk">__tablename__ = 'users'</span><span id="524a" class="mo lc hu nd b fv od ni l nj nk">id = db.Column(db.Integer, primary_key=True)<br/>username = db.Column(db.String(80))<br/>password = db.Column(db.String(80))</span></pre><p id="1996" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">“__tablename__”显然是表的名称。</p><p id="aed3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后，我们定义“用户”表将拥有的列，并定义它们的参数。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div class="fe ff oe"><img src="../Images/bfada75089e6b19f5ab6611058f004ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*SNQi1wB5_eWqYHBt-xw9nQ.png"/></div></figure><p id="e001" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">仅仅是写这个，SQLAlchemy就知道如何为用户创建表，简单吧？</p><p id="1631" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">之后，我们有了非常简单的“__init__”方法。</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="02c9" class="mo lc hu nd b fv nh ni l nj nk">def __init__(self, username, password):<br/>    self.username = username<br/>    self.password = password</span></pre><blockquote class="of og oh"><p id="cb28" class="jj jk ly jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated">请注意id是如何没有被传递的，这是因为对于数据库中的每个新条目，它的值都会增加1。您可以为id传递您自己的值，但这样我们传递的是“None ”,它会自动递增。</p></blockquote><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="7605" class="mo lc hu nd b fv nh ni l nj nk">def save_to_db(self):<br/>    db.session.add(self)<br/>    db.session.commit()</span></pre><p id="254c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是在SQLAlchemy中向数据库添加内容的方法，非常简单。</p><p id="795a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们有2个“@classmethod”:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="2f1e" class="mo lc hu nd b fv nh ni l nj nk">@classmethod<br/>def find_by_username(cls, username):<br/>    return cls.query.filter_by(username=username).first()</span><span id="75ed" class="mo lc hu nd b fv od ni l nj nk">@classmethod<br/>def find_by_id(cls, _id):<br/>    return cls.query.filter_by(id=_id).first()</span></pre><p id="fb7e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">“@classmethod”是一个装饰器，它以某种方式运行底层的函数。我不会详细讨论它，但这意味着该方法可以在没有类的特定实例的情况下被调用。</p><p id="4987" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以通过说出“UserModel . find _ by _ username(name)”来调用它，或者通过创建一个名为“usermod”的user model实例(例如)并作为“usermod.find_by_username(name)”进行调用。这是相同的输出，因为它们没有接收“self”作为参数，而是接收“cls ”, cls是调用它的类的解释。</p><h2 id="b099" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">学校模型和学生模型</h2><p id="89bd" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">它们是如此的相似和相关，以至于我们要同时研究它们。</p><p id="849d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先，我们导入“数据库”:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="c854" class="mo lc hu nd b fv nh ni l nj nk">from db import db</span></pre><p id="c132" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">两个模型都有相同的“find_by_name ”,因为我们希望能够按名称搜索学生和学校:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="0fc6" class="mo lc hu nd b fv nh ni l nj nk">@classmethod<br/>def find_by_name(cls, name):<br/>    return cls.query.filter_by(name=name).first()</span></pre><p id="58f1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们有从数据库中保存和删除的方法:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="ce2b" class="mo lc hu nd b fv nh ni l nj nk">def save_to_db(self):<br/>    db.session.add(self)<br/>    db.session.commit()</span><span id="458c" class="mo lc hu nd b fv od ni l nj nk">def delete_from_db(self):<br/>    db.session.delete(self)<br/>    db.session.commit()</span></pre><p id="4d85" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们来谈谈数据库结构。</p><p id="9e7a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们说过我们需要这样的东西:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff fg"><img src="../Images/fcc29adf75efc68091005dd8dc71967a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rvbNiNV70rsPcd_utJtLgQ.png"/></div></div></figure><p id="b1ea" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们已经知道如何让SQLAlchemy创建一个表(就像我们为用户做的那样)，但是这里我们有两个表之间的关系。</p><p id="6a74" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">“学生模型”中的代码是:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="d970" class="mo lc hu nd b fv nh ni l nj nk">__tablename__ = 'students'</span><span id="61d7" class="mo lc hu nd b fv od ni l nj nk">id = db.Column(db.Integer, primary_key=True)<br/>name = db.Column(db.String(80))</span><span id="f573" class="mo lc hu nd b fv od ni l nj nk">school_id = db.Column(db.Integer, db.ForeignKey('schools.id'))<br/>school = db.relationship('SchoolModel')</span></pre><p id="bae8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">定义了“__tablename__ ”,还定义了列“id”和“name”。</p><p id="4e13" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这里的图表非常有助于理解“学校标识”和“学校”变量是如何工作的。</p><p id="b617" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">“外键”用于表示两个表之间的关系，这一行表示:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="0b4c" class="mo lc hu nd b fv nh ni l nj nk">school_id = db.Column(db.Integer, db.ForeignKey('schools.id'))</span></pre><p id="c774" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">"创建一个名为' school_id '的整数类型的列，该列与表' schools '中的列' id '有关系"</p><p id="439f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">下面的一行只是声明关系的“另一方”是什么类型，在本例中是“学校模型”:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="ab56" class="mo lc hu nd b fv nh ni l nj nk">school = db.relationship('SchoolModel')</span></pre><p id="4618" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在看看它的表的“学校模型”声明:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="43ae" class="mo lc hu nd b fv nh ni l nj nk">__tablename__ = 'schools'</span><span id="17ca" class="mo lc hu nd b fv od ni l nj nk">id = db.Column(db.Integer, primary_key=True)<br/>name = db.Column(db.String(80))</span><span id="f90f" class="mo lc hu nd b fv od ni l nj nk">students = db.relationship('StudentModel', lazy='dynamic')</span></pre><p id="a00c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">简单吧。</p><p id="5591" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们只需要指定“学生模型”和我们(作为“学校模型”)之间的关系。“lazy =‘dynamic’”意味着变量‘students’是一个查询生成器，它将在每次调用时获取数据，而不是在之前。</p><p id="c27e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后我们有“__init__”方法和“json”方法:</p><ul class=""><li id="a14f" class="kf kg hu jl b jm jn jp jq js kh jw ki ka kj ke kk kl km kn dt translated">学生模型:</li></ul><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="5a36" class="mo lc hu nd b fv nh ni l nj nk">def __init__(self, name, school_id):<br/>    self.name = name<br/>    self.school_id = school_id</span><span id="218a" class="mo lc hu nd b fv od ni l nj nk">def json(self):<br/>    return {'name': self.name, 'school': self.school.name}</span></pre><ul class=""><li id="304e" class="kf kg hu jl b jm jn jp jq js kh jw ki ka kj ke kk kl km kn dt translated">学校模型:</li></ul><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="206a" class="mo lc hu nd b fv nh ni l nj nk">def __init__(self, name):<br/>    self.name = name</span><span id="e2fe" class="mo lc hu nd b fv od ni l nj nk">def json(self):<br/>    return {'name': self.name, 'students': list(map(lambda x: x.json(), self.students.all()))}</span></pre><p id="9145" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">“__init__”方法是自解释的，当资源想要向客户端发送数据时，将使用“json”方法，因为我们必须发送回JSON而不是对象。</p><blockquote class="of og oh"><p id="f523" class="jj jk ly jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated">请注意,“地图”可以用“列表理解”来制作，如果你愿意，继续改变它。这是一个很好的方式来练习你的Python技能。</p></blockquote></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="23d9" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">资源</h1><h2 id="6776" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">用户</h2><p id="2437" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">看一下我们正在导入的内容:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="e0ad" class="mo lc hu nd b fv nh ni l nj nk">from flask_restful import Resource, reqparse<br/>from models.user import UserModel</span></pre><p id="236b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">“reqparser”是我们马上要看到的解析器，Resource将是“Resource”的父类，我们正在导入用户模型以使用它来创建和检索数据库中的数据。</p><p id="d815" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">创建用户的信息，即用户名和密码不会通过url到达我们这里，这是非常不安全的，它将在请求的正文中发送给我们。</p><p id="02de" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了获得这些数据，我们需要一个解析器:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="75fa" class="mo lc hu nd b fv nh ni l nj nk">parser = reqparse.RequestParser()<br/>parser.add_argument('username',<br/>    type=str,<br/>    required=True,<br/>    help="This field cannot be left blank."<br/>)<br/>parser.add_argument('password',<br/>    type=str,<br/>    required=True,<br/>    help="This field cannot be left blank."<br/>)</span></pre><p id="59e9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们从接收到的数据中声明哪些参数对我们来说是重要的，并在参数丢失或错误的情况下设置一条消息。如果主体中有更多的参数，解析器将不会把它们计算在内。现在让我们使用它。</p><p id="38c2" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">理想情况下，资源包含的唯一方法是HTTP动词，即:GET、POST、DELETE、PUT等。</p><p id="cd22" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">其背后的逻辑将走向模型。</p><p id="5b0b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">用户只需要在我们的API中创建(不能删除或更新)，所以我们唯一的功能是:“发布”:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="d825" class="mo lc hu nd b fv nh ni l nj nk">def post(self):<br/>    data = UserRegister.parser.parse_args()</span><span id="eb62" class="mo lc hu nd b fv od ni l nj nk">    if UserModel.find_by_username(data['username']):<br/>        return {"message": "User already exists"}, 400</span><span id="83ee" class="mo lc hu nd b fv od ni l nj nk">    user = UserModel(**data)<br/>    user.save_to_db()</span><span id="6608" class="mo lc hu nd b fv od ni l nj nk">    return {"message": "User created successfully."}, 201</span></pre><p id="e70b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们从解析器获得“数据”,我们知道它有一个用户名和一个密码，因为这是我们的两个参数。</p><p id="9bc4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们使用“UserModel”检查数据库中是否已经存在使用该用户名的用户，如果已经存在，我们返回一条消息，通知其状态代码为400，这意味着“错误的请求”。</p><p id="2db6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果用户还不存在，我们创建一个“用户模型”,将“数据”中的所有数据作为参数传递。因为我们100%确定“数据”中有用户名和密码，并且没有其他可以使用的内容:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="2e13" class="mo lc hu nd b fv nh ni l nj nk">UserModel(**data)</span></pre><p id="a1f6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将与以下内容相同:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="5468" class="mo lc hu nd b fv nh ni l nj nk">UserModel(data['username'], data['password'])</span></pre><p id="30ff" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">用你最喜欢的那个。</p><p id="7f8e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后，我们将刚刚创建的模型保存到数据库中，并返回一条消息，说明我们创建了状态代码为201的用户，意思是“已创建”。</p><h2 id="a820" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">学校</h2><p id="714b" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">对于学校来说，我们需要能够处理这些事情:</p><ul class=""><li id="6f54" class="kf kg hu jl b jm jn jp jq js kh jw ki ka kj ke kk kl km kn dt translated">通过名字得到一所学校</li><li id="e23a" class="kf kg hu jl b jm ko jp kp js kq jw kr ka ks ke kk kl km kn dt translated">张贴学校名称</li><li id="8172" class="kf kg hu jl b jm ko jp kp js kq jw kr ka ks ke kk kl km kn dt translated">删除名为的学校</li><li id="1e8f" class="kf kg hu jl b jm ko jp kp js kq jw kr ka ks ke kk kl km kn dt translated">获取所有学校</li></ul><p id="8cd4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们将这个资源分成两个资源:“学校”和“学校列表”，因为我们有两个GET方法，一个用“/学校”调用，另一个用“/学校”调用。再往前会更清楚。</p><p id="4043" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们导入的内容与user.py中的相同，但没有“reqparse ”,因为我们不会从请求体中获得任何信息。当然，我们导入的不是“模型.用户”,而是“模型.学校”</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="008d" class="mo lc hu nd b fv nh ni l nj nk">from flask_restful import Resource<br/>from models.school import SchoolModel</span></pre><p id="245e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">让我们从“学校”资源开始。</strong></p><p id="b01a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">它有一个GET: </em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="972b" class="mo lc hu nd b fv nh ni l nj nk">def get(self, name):<br/>    school = SchoolModel.find_by_name(name)<br/>    if school:<br/>        return school.json()<br/>    return {'message': 'School not found'}, 404</span></pre><p id="f6a3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们要求“SchoolModel”在数据库中搜索一个特定的名称，如果有，则返回“school.json()”,否则我们返回一条状态代码为404的消息，表示“未找到”。</p><p id="f67a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">它还有一个帖子:</em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="dbf3" class="mo lc hu nd b fv nh ni l nj nk">def post(self, name):<br/>    if SchoolModel.find_by_name(name):<br/>        return {'message': "School '{}' already exists".format(name)}, 400</span><span id="33fd" class="mo lc hu nd b fv od ni l nj nk">school = SchoolModel(name)<br/>    try:<br/>        school.save_to_db()<br/>    except:<br/>        return {'message': 'An error occurred while creating the school'}, 500</span><span id="0765" class="mo lc hu nd b fv od ni l nj nk">return school.json(), 201</span></pre><p id="f416" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先，我们需要查看数据库中是否已经有这个名字的学校，如果有，我们返回一个状态代码为400的消息。如果没有，我们继续用给定的名字创建一个新的“学校模型”。然后是“try-except ”,与Swift中的try-catch相同。在这里，我们试图将模型保存到数据库，如果由于某种原因无法执行，它将返回一条状态代码为500的消息，这意味着“内部服务器错误”。最后，如果我们到了最后，我们返回' school.json()'，这基本上就是我们刚刚插入到数据库中的状态代码201。</p><p id="0471" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">最后它有一个删除:</em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="153b" class="mo lc hu nd b fv nh ni l nj nk">def delete(self, name):<br/>    school = SchoolModel.find_by_name(name)<br/>    if school:<br/>        school.delete_from_db()</span><span id="13d5" class="mo lc hu nd b fv od ni l nj nk">return {'message': 'School deleted'}</span></pre><p id="8be9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这非常简单，我们只需在数据库中查找具有该名称的“学校模型”,如果它存在，我们就删除它。如果它不存在，我们什么也不做。消息总是一样的，因为如果在数据库中找不到该学校，结果就和我们删除它一样。</p><p id="2d02" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">现在让我们来看看学校列表资源:</strong></p><p id="6f14" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">它只有一个GET方法:</em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="133d" class="mo lc hu nd b fv nh ni l nj nk">def get(self):<br/>    return {'schools': list(map(lambda x: x.json(), SchoolModel.query.all()))}</span></pre><blockquote class="of og oh"><p id="7c9a" class="jj jk ly jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated">这和我们之前看到的“地图”是一样的，如果你想为了理解一个列表而改变它，这完全没问题。</p></blockquote><p id="e26d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">乍一看可能有点奇怪，但是“SchoolModel.query.all()”是有意义的，记住“SchoolModel”继承自“db”。模型'这使得它能够使用'。对表进行任何种类的查询。</p><h2 id="f859" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">学生</h2><p id="11ef" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">这是我们拥有的三种资源中较为复杂的一种。</p><p id="9aef" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们看看我们导入了什么:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="63bb" class="mo lc hu nd b fv nh ni l nj nk">from flask_restful import Resource, reqparse<br/>from flask_jwt import jwt_required<br/>from models.student import StudentModel</span></pre><p id="d804" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们正在导入资源和“reqparse”，我们正在从“models.student”导入“StudentModel”，我们正在从“flask_jwt”导入“jwt_required”。对于这些请求，我们将使用JWT认证，不要担心，这比听起来容易。</p><p id="da82" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在课程开始时，我们设置了解析器，因为我们只关心“学校标识”,它将通过请求体传递给我们:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="d017" class="mo lc hu nd b fv nh ni l nj nk">parser = reqparse.RequestParser()<br/>parser.add_argument('school_id',<br/>    type=int,<br/>    required=True,<br/>    help="Every student needs a school id."<br/>)</span></pre><p id="1e29" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">我们有GET方法:</em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="c083" class="mo lc hu nd b fv nh ni l nj nk">def get(self, name):<br/>     student = StudentModel.find_by_name(name)<br/>     if student:<br/>        return student.json()<br/>     return {'message': 'Student not found'}, 404</span></pre><p id="c76c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">它就像学校的GET一样工作。</p><p id="b869" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">我们也有POST方法:</em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="2076" class="mo lc hu nd b fv nh ni l nj nk">@jwt_required()<br/>def post(self, name):<br/>    if StudentModel.find_by_name(name):<br/>        return {'message': "A student with name '{}' already exists.".format(name)}, 400</span><span id="73b7" class="mo lc hu nd b fv od ni l nj nk">data = Student.parser.parse_args()</span><span id="e8d8" class="mo lc hu nd b fv od ni l nj nk">student = StudentModel(name, **data)</span><span id="352a" class="mo lc hu nd b fv od ni l nj nk">try:<br/>    student.save_to_db()<br/>except:<br/>    return {'message': 'An error ocurred inserting the student.'}, 500</span><span id="b0ab" class="mo lc hu nd b fv od ni l nj nk">return student.json(), 201</span></pre><blockquote class="nl"><p id="d432" class="nm nn hu bd no np ol om on oo op ke ek translated">我们这里有个装潢师！</p></blockquote><p id="5681" class="pw-post-body-paragraph jj jk hu jl b jm nv iv jo jp nw iy jr js nx ju jv jw ny jy jz ka nz kc kd ke hn dt translated">请注意“@jwt_required()”装饰符，在我们的方法之前的那一行，我们告诉Flask，我们需要jwt的“access_token”来运行该方法，如果我们没有收到有效的令牌，该方法将抛出一个错误。</p><p id="7ecc" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在该方法中，我们再次使用“StudentModel(name，**data)”对学校进行同样的操作，但是您可以用“StudentModel(name，data['name']，data['school_id'])”替换它。</p><p id="edf9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">我们还实现了一个删除方法:</em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="68a4" class="mo lc hu nd b fv nh ni l nj nk">@jwt_required()<br/>def delete(self, name):<br/>    student = StudentModel.find_by_name(name)<br/>    if student:<br/>        student.delete_from_db()</span><span id="8a08" class="mo lc hu nd b fv od ni l nj nk">return {'message': 'Student deleted'}</span></pre><p id="5705" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">它还有“@jwt_required()”装饰符，所以当发送请求时，客户机必须在请求的头部传递它的“access_token”，我们将在后面看到如何传递。</p><p id="06aa" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最后，我们有“学生列表”，其工作方式与“商店列表”完全相同:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="95af" class="mo lc hu nd b fv nh ni l nj nk">def get(self):<br/>    return {'students': list(map(lambda x: x.json(), StudentModel.query.all()))}</span></pre></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="07e5" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">登录</h1><p id="1bca" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">我们已经看到了如何在用户资源中使用POST方法注册一个新用户，但是我们遗漏了一些东西…让用户登录。</p><p id="a3f1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们有一个名为“security.py”的文件来处理这个问题。“flask_jwt”需要定义两个方法，“authenticate”和“identity”。都在“security.py”里。</p><h2 id="d64f" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">鉴定</h2><p id="b377" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">“authenticate”方法返回一个用户模型(如果在数据库中找到的话)，否则返回“None”:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="88cc" class="mo lc hu nd b fv nh ni l nj nk">def authenticate(username, password):<br/>    user = UserModel.find_by_username(username)<br/>    if user and user.password == password:<br/>        return user</span></pre><p id="d8e9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">该方法采用两个参数:“用户名”和“密码”，并尝试查找具有该用户名的用户模型。如果找到了，它就会尝试将数据库密码中找到的用户与请求中传递的密码进行匹配。如果匹配，则返回用户。</p><p id="a79d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">用户实际上并没有返回到客户端，因为那没有帮助，客户端需要一个“访问令牌”用于将来的请求，“flask_jwt”处理这个问题并向客户端发送“访问令牌”。</p><blockquote class="nl"><p id="d24c" class="nm nn hu bd no np nq nr ns nt nu ke ek translated">请记住,“访问令牌”包含登录用户的“id”信息，而不是用户名和密码信息</p></blockquote><h2 id="9156" class="mo lc hu bd ld mp oq mr lh ms or mu ll js os mw ln jw ot my lp ka ou na lr nb dt translated">身份</h2><p id="ea9c" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">第二种方法是“认同”。它有一个参数，即“有效载荷”。当调用带有“@jwt_required()”装饰符的方法时，调用该方法，并负责为“access_token”返回适当的用户。我们稍后会看到一个例子。</p><p id="e569" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">方法很简单:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="c6dc" class="mo lc hu nd b fv nh ni l nj nk">def identity(payload):<br/>    user_id = payload['identity']<br/>    return UserModel.find_by_id(user_id)</span></pre><p id="29e6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">还记得我说过“access_token”有关于登录用户的“id”的信息吗？通过从有效负载访问“identity”属性，我们可以在数据库中搜索具有该“id”的用户模型并返回它。</p><blockquote class="nl"><p id="444d" class="nm nn hu bd no np nq nr ns nt nu ke ek translated">这可能有点令人困惑，这里有一个例子:</p></blockquote><p id="b0df" class="pw-post-body-paragraph jj jk hu jl b jm nv iv jo jp nw iy jr js nx ju jv jw ny jy jz ka nz kc kd ke hn dt translated">用户使用iOS应用程序注册，API返回消息“用户创建成功”，用户现在使用相同的用户名和密码登录，应用程序向API发送登录请求，传递用户名和密码。‘flask _ jwt’用应用发送的用户名和密码调用“authenticate”方法。它在数据库中找到了它，因此API生成一个“access_token ”,并将其发送回应用程序。现在，当应用程序想要调用一个需要JWT认证的方法(比如学校的POST)时，它需要传入请求的头部，即“access_token”。当发生这种情况时，“flask_jwt”用“access_token”调用“identity”方法，检索“id”并在数据库中搜索具有该“id”的用户模型。</p><p id="c23e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">试着读几遍，如果它令人困惑，在纸上画出方法和流程肯定会有帮助，它真的不太复杂。</p></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="1a5a" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">app.py</h1><p id="545e" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">当我们一般使用Python时，我们喜欢将主应用程序称为“app.py”，现在还不是做任何改变的时候。</p><p id="2c06" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">看一下“app.py”，看看自己能搞清楚哪些部分。</p><p id="af8e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们将从进口开始:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="00f4" class="mo lc hu nd b fv nh ni l nj nk">from flask import Flask<br/>from flask_restful import Api<br/>from flask_jwt import JWT</span><span id="3212" class="mo lc hu nd b fv od ni l nj nk">from security import authenticate, identity<br/>from resources.user import UserRegister<br/>from resources.student import Student, StudentList<br/>from resources.school import School, SchoolList</span></pre><p id="321a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在余下的代码中，我将逐行解释为什么我们要导入它们:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="241a" class="mo lc hu nd b fv nh ni l nj nk">app = Flask(__name__)</span></pre><p id="53fa" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们创建了一个名为我们程序的Flask()实例，为此我们使用了Python定义的变量' __name__ '。‘烧瓶’就是为此而进口的。</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="ddb7" class="mo lc hu nd b fv nh ni l nj nk">app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///data.db'<br/>app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False</span></pre><p id="a734" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">我们配置数据库路由(这是我们在终端中运行服务器的文件夹)并将‘SQLALCHEMY _ TRACK _ MODIFICATIONS’设置为False。这是因为Flask的轨迹修改系统比SQLAlchemy的要好一些。</em></p><blockquote class="of og oh"><p id="6442" class="jj jk ly jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated">请注意，我们使用的是sqlite，但也可以使用PostrgeSQL或MySQL。</p></blockquote><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="5882" class="mo lc hu nd b fv nh ni l nj nk">app.secret_key = 'dante'</span></pre><p id="e454" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">我们定义‘秘密密钥’，用它来加密我们的‘访问权标’。</em></p><blockquote class="of og oh"><p id="89e7" class="jj jk ly jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated">请注意，这应该是一个更难猜测的关键</p></blockquote><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="5a85" class="mo lc hu nd b fv nh ni l nj nk">api = Api(app)</span></pre><p id="4887" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">我们创建Api实例。“flask_restful”中的“Api”是为此导入的。</em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="36cf" class="mo lc hu nd b fv nh ni l nj nk">@app.before_first_request<br/>def create_tables():<br/>    db.create_all()</span></pre><p id="54dc" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">使用装饰器“@app.before_first_request”我们告诉数据库创建所有的表，它这样做是为了所有的模型并检查每个模型如何想要它的表。需要导入“db ”,但它将在我们运行它之前导入，您将会看到。</em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="b532" class="mo lc hu nd b fv nh ni l nj nk">jwt = JWT(app, authenticate, identity)</span></pre><p id="aee3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">我们创建一个JWT实例，将“应用程序”本身、“身份验证”方法和“身份”方法作为参数传递。为此导入了“flask_jwt”中的“JWT”和“security”中的“authenticate”和“identity”。</em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="1517" class="mo lc hu nd b fv nh ni l nj nk">api.add_resource(School, '/school/&lt;string:name&gt;')<br/>api.add_resource(Student, '/student/&lt;string:name&gt;')<br/>api.add_resource(SchoolList, '/schools')<br/>api.add_resource(StudentList, '/students')</span><span id="c5f1" class="mo lc hu nd b fv od ni l nj nk">api.add_resource(UserRegister, '/register')</span></pre><p id="f30a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">然后我们定义Api将使用的资源，声明我们将接收的资源类、url和url参数。</em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="bc75" class="mo lc hu nd b fv nh ni l nj nk">if __name__ == '__main__':<br/>    from db import db<br/>    db.init_app(app)<br/>    app.run(port=5000, debug=True)</span></pre><p id="50ca" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最后，我们需要运行应用程序，我知道代码有点奇怪，但请耐心等待。</p><p id="0d76" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">“app.py”可以从另一个文件中调用，因此，为了确保它将初始化数据库并运行应用程序一次(当我们直接从终端调用它时)，我们使用了“if”语句，因为当您从终端调用文件时，Python会将该文件的“__name__”分配给“__main__”。</p><p id="b921" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后我们导入“db”(这个get是在第一个请求之前导入的，所以当调用create_tables()时，“db”已经被导入)，初始化数据库并在端口5000(这是默认端口)和调试模式下运行服务器，这将帮助我们跟踪应用程序抛出错误时的问题。</p></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="b684" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">运行服务器</h1><p id="8491" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">是时候运行服务器并测试它了。</p><p id="26e4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">要运行服务器，请打开终端并转到您的项目文件夹。</p><p id="ebe8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">启动“venv ”,以防您忘记如何启动，它是:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="9636" class="mo lc hu nd b fv nh ni l nj nk">. venv/bin/activate</span></pre><p id="98d3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在进入代码文件夹:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="67ff" class="mo lc hu nd b fv nh ni l nj nk">cd code</span></pre><p id="715e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">并运行服务器:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="4411" class="mo lc hu nd b fv nh ni l nj nk">python app.py</span></pre><p id="d273" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ly">如果抛出一个错误，请尝试:</em></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="596a" class="mo lc hu nd b fv nh ni l nj nk">python3.6 app.py</span></pre><p id="4215" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您应该会看到类似这样的内容:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="522d" class="mo lc hu nd b fv nh ni l nj nk">(venv) Dantes-MBP:code dantepuglisi$ python app.py<br/>* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)<br/>* Restarting with stat<br/>* Debugger is active!<br/>* Debugger PIN: 247-053-277</span></pre><p id="bd8f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这意味着您正在localhost (127.0.0.1是localhost)中的端口5000上运行服务器，如您之前定义的那样。</p><p id="2916" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">要停止服务器只需按:Ctrl+C</p></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="a8f0" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">测试API</h1><p id="5573" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">我们要用Postman来测试API，在这里下载<a class="ae kt" href="https://www.getpostman.com" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="2632" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">此外，在这里下载这个项目<a class="ae kt" href="https://www.getpostman.com/collections/0822afedd7f0f0fc142c" rel="noopener ugc nofollow" target="_blank">的集合，并通过转到“集合”、“导入”并将&amp;拖放到框中将其导入到Postman。</a></p><p id="af45" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您应该会在应用程序的左侧看到收藏。在集合中有3个文件夹:“学生”、“学校”和“授权”。每个文件夹都有与特定资源交互的端点。</p><h2 id="e7b6" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">证明</h2><p id="0272" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">在“Auth”文件夹中点击“/register”端点，您应该会看到类似这样的内容:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ov"><img src="../Images/965442fe8d13ca6162d0e01bf014f605.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WPz5FJupUy4Oqbpy_4HDqw.png"/></div></div></figure><p id="5d9d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">路由是“http://127.0.0.1:5000/register，http动词是POST。</p><p id="566a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">按“Headers”选项卡，在标题中，我们为“Content-Type”传递“application/json”，这意味着主体是json格式的。</p><p id="7109" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在点击“Body”选项卡，我们传递“username”和“password”来注册。您可以更改这些数据，但是一定要在“/auth”端点中进行更改。</p><p id="2aa7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">按“Send”并查看响应，您将得到类似这样的内容(记得让服务器在终端中运行):</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ow"><img src="../Images/7f2c93199ea603d1499f5aff41acb02b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IGOIc1ccm3O_cBLVLfzb8g.png"/></div></div></figure><p id="e7eb" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们知道用户已在数据库中注册，现在转到“/auth”端点。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ox"><img src="../Images/1216fc0c5c11fc5aae6b75707bc48028.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CGVrTZRzZgXPArPXl2MQZQ.png"/></div></div></figure><p id="aa62" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们在主体中传递相同的头和相同的信息，以登录我们刚刚创建的同一个用户。</p><p id="bf27" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">按下“发送”后，您会得到如下内容:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff oy"><img src="../Images/4b2846c1cf95c80f04481ff850bb2073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a65MwFyqWcSkFk_BbmDLvw.png"/></div></div></figure><p id="5497" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">选择“access_token”(不带引号)并复制它(Cmd+C)。</p><p id="5831" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在我们继续其他端点之前，您看到发生了什么吗？</p><p id="09fc" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">当您第一次调用API (/register)时，SQLAlchemy创建了一个名为data.db的文件(您可以搜索它，它在“code”文件夹中),原因如下:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="887f" class="mo lc hu nd b fv nh ni l nj nk">@app.before_first_request<br/>def create_tables():<br/>    db.create_all()</span></pre><p id="3f38" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们在Postman中调用了“POST /register”端点，它从UserRegister中触发了“POST”方法，如下所示:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="de18" class="mo lc hu nd b fv nh ni l nj nk">def post(self):<br/>    data = UserRegister.parser.parse_args()</span><span id="4351" class="mo lc hu nd b fv od ni l nj nk">    if UserModel.find_by_username(data['username']):<br/>        return {"message": "User already exists"}, 400</span><span id="e68e" class="mo lc hu nd b fv od ni l nj nk">    user = UserModel(**data)<br/>    user.save_to_db()</span><span id="7259" class="mo lc hu nd b fv od ni l nj nk">    return {"message": "User created successfully."}, 201</span></pre><p id="2d30" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后，我们继续尝试使用/auth传递相同的用户名和密码登录，这触发了“security.py”中的“authenticate”方法:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="90ac" class="mo lc hu nd b fv nh ni l nj nk">def authenticate(username, password):<br/>    user = UserModel.find_by_username(username)<br/>    if user and user.password == password:<br/>        return user</span></pre><blockquote class="of og oh"><p id="197e" class="jj jk ly jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated">请注意，除了“access_token”之外，您还可以更改“/auth”返回的内容，请查看flask_jwt文档。</p></blockquote><h2 id="8b69" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">学校</h2><p id="96fb" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">现在我们将移动到“学校”文件夹。一旦进入，点击“岗位/学校/ <name>”端点。</name></p><p id="365d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你会得到这个:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff oz"><img src="../Images/db227ecbeeccbf22e2e4dedcf11b0932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RB1g1PJ-FRDsvx9AxB1T6g.png"/></div></div></figure><p id="9136" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">将URL中的“<name>”替换为您选择的学校名称，我会选择“asd ”,这是一个非常可靠的学校名称。</name></p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ow"><img src="../Images/1a20e0e6b5add58e3d3eb2f4f6e9e3c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*blftrBrOESAExMe0heQ2OQ.png"/></div></div></figure><p id="bee6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们没有在头部或主体中传递信息，因为来自学校(资源)的“post”方法只是从URL中获取一个参数“<name>”。</name></p><p id="6aeb" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">按“发送”,看看会有什么回复。我们刚刚创建了一所学校。</p><p id="077c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">可以随便玩玩删，弄弄，弄弄所有学校。</p><p id="cf6a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们有一所学校，现在我们需要学生，否则严格来说他们不是学校，对吗？</p><h2 id="0de9" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">学生</h2><p id="d701" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">打开集合中的“Student”文件夹，我们也来测试一下。</p><p id="b588" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们要创建一个新学生，为此，打开" POST /student/ <name>"端点。</name></p><p id="fc7f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您将获得:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff pa"><img src="../Images/7814ffbb496fd6be9ddd7c6ee6bc9ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AU1aJV4IvG_vTPhJCGfZ_Q.png"/></div></div></figure><p id="a600" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">把“<name>”换成你喜欢的任何名字(‘但丁’似乎是个很酷的名字)。</name></p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff pa"><img src="../Images/6c50651c0bed7cc2b47957e80673ce9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k56-eQ06Dh6s0HKHv_I3OA.png"/></div></div></figure><p id="5ebd" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">继续按“发送”。</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff pb"><img src="../Images/778201d43d75dbf28b8647dd8f51372b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mAc_QtrUhZpPvt7lZTDHFA.png"/></div></div></figure><p id="1a2e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">发生了什么事？一个错误？是因为那个名字太牛逼了吗？</p><p id="d3fb" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">别担心，你需要发送你之前得到的“访问令牌”,记得吗？</p><p id="9ac4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">按下“标题”选项卡，“授权”的值为空。为了解决这个问题，在值中写下(为了更容易理解，我使用了Swift语法，假设这是一个Swift字符串):“JWT \(access_token)”</p><blockquote class="of og oh"><p id="5b14" class="jj jk ly jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated">请注意，如果您没有“access_token”来粘贴它，您可以转到“/auth”端点并再次登录。</p></blockquote><p id="40b5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">那就是:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff pc"><img src="../Images/28a8c38a1c0d78e1e5fb4aee69fe9048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QURYk0a4v8JBAIeKuz8Lmw.png"/></div></div></figure><blockquote class="of og oh"><p id="5de9" class="jj jk ly jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated">请注意，在“JWT”和“访问令牌”之间有一个空格。</p></blockquote><p id="ed28" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们现在可以再次发送请求，瞧:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff pd"><img src="../Images/ff06189c68f2c808ada5630a602b214e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V9X2gMhaN7DK0hS-OX2JUg.png"/></div></div></figure><p id="1e7f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">它将我们与名为“asd”的学校相匹配，因为它的“school_id”为1(这是我们创建的第一个学校),我们在正文中为“school_id”传递“1 ”,请按“body”选项卡检查它。</p><blockquote class="of og oh"><p id="f594" class="jj jk ly jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated">质询时间:如果您创建一个带有不存在的“学校id”的学生，它将创建该学生，但会抛出一个错误，尝试修复该错误，以便根本不会创建该学生，并且端点会返回一条消息“请选择一个有效的学校id”</p></blockquote><p id="04b1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">要删除数据库并重新开始，只需转到项目中的“code”文件夹并删除名为“data.db”的文件。之后，再次运行服务器。</p></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="6d3e" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">创建iOS应用程序</h1><p id="d59a" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">到目前为止，一切看起来都很好，但我们实际上还没有在应用程序中使用该API。</p><p id="3f21" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们现在做那件事。</p><p id="353d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我会指导你完成步骤，但不会给你完成的项目，因为我假设你是一个iOS开发人员，将能够自己完成。</p><p id="29fc" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先创建一个单视图项目，命名为“学校管理器”，保存在“学校管理器”文件夹中，安装CocoaPods和Alamofire。</p><p id="394d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">创建一个名为APIClient的新文件，并添加以下代码，这是API方法所在的位置:</p><figure class="lz ma mb mc fq md"><div class="bz el l di"><div class="pe pf l"/></div></figure><blockquote class="of og oh"><p id="3f4a" class="jj jk ly jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated">注意，我们不是在头中将“Content-Type”作为“application/json”传递，而是用“jsonEncoding”将参数编码为JSON。两种方式都可以。</p></blockquote><p id="00fd" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们将“access_token”保存在UserDefaults中，以便在我们关闭应用程序并再次打开它时，如果令牌没有过期，我们就不需要再次登录。</p><p id="22c3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">大体上。故事板是这样做的:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff pg"><img src="../Images/0899b9958ba024863b21b7299f6bbc3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWxfEXBOL3XY4930s2O9jQ.png"/></div></div></figure><p id="629d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这只是为了测试。</p><p id="7ffa" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后转到ViewController.swift，实现这两个动作，连接到按钮上。不要忘记连接文本字段的出口:</p><figure class="lz ma mb mc fq md"><div class="bz el l di"><div class="pe pf l"/></div></figure><p id="87b8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你应该有这样的东西:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ph"><img src="../Images/ae36a30b42630cab1449db36d1c82cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*idB6kp0AyGtify8c0rzong.png"/></div></div></figure><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ph"><img src="../Images/1f81628d9169d2e84d095fa244f7be12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fqm4YwFQs-FfFnJZpwj3GQ.png"/></div></div></figure><p id="c8d2" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您还没有删除data.db，我们可以更好地进行测试。</p><p id="2187" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，在我们运行应用程序之前，请确保您的服务器正在终端中运行，并按下我们都非常喜欢的“播放”按钮。</p><blockquote class="of og oh"><p id="6c14" class="jj jk ly jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated">请注意，您应该在模拟器中运行此操作，因为您的手机将无法访问“localhost”(127 . 0 . 0 . 1)。</p></blockquote><p id="8c01" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">输入用户名和密码，按下“注册”按钮，看看控制台，你就得到这个:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff pi"><img src="../Images/27636782cfba7cf56a380b0e251efcdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h06w7Edrs207NfAmPBK-6Q.png"/></div></div></figure><p id="a74e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这样，用户就创建好了。</p><p id="997c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在按下“登录”按钮，得到这个:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff pj"><img src="../Images/05929702628cc00f93163c5d02e80873.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gx7ZF_qAs3LvP9EwiLLeSQ.png"/></div></div></figure><p id="bcf5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">嗯，我们打印了两次“访问令牌”，但这不是问题，问题是，我们有“访问令牌”！</p><p id="2023" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们必须创建第二个屏幕，让用户在正确登录后通过。</p><p id="4d1b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">第二个屏幕将显示一个ui table视图，学校作为部分的标题，学生作为这些部分的行。</p><p id="84ac" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这应该很容易做到，所以我们继续吧。</p><p id="2d6c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">类似这样的事情应该可以做到(不要忘记将UIViewController设置为UITableView的“委托”和“数据源”):</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff pk"><img src="../Images/54d2b025f4678542ce867cd0f55265e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eCk5GMAw3i4hsUGo2faMTg.png"/></div></div></figure><p id="dd76" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">创建一个名为“SchoolsListViewController”的新文件，并将其设置为“storyboard”中新UIViewController的类和“Storyboard ID”的类。</p><p id="eb8f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们必须向API登录函数添加一个完成处理程序，以知道我们何时拥有可用的“access_token ”,让我们开始吧。将“登录”方法更改为:</p><figure class="lz ma mb mc fq md"><div class="bz el l di"><div class="pe pf l"/></div></figure><p id="6046" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">以及“登录按钮已按下”动作:</p><figure class="lz ma mb mc fq md"><div class="bz el l di"><div class="pe pf l"/></div></figure><p id="b6df" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这段代码非常简单明了，所以让我们继续。</p><p id="83c9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们仍然需要得到学校及其学生的名单，有几种方法可以做到这一点。我们可以发出两个请求，一个GET /schools和一个GET /students，或者我们可以只发出一个调用来GET /students，然后用我们的方法来分离这些东西。我们将使用第二个方法，所以首先要做的是进入APIClient.swift并粘贴这个方法:</p><figure class="lz ma mb mc fq md"><div class="bz el l di"><div class="pe pf l"/></div></figure><p id="643b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们获取学生(记住他们有各自的学校名称)并在一个元组数组中的完成处理程序中传递它。</p><p id="b2b8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是“schoolslistviewcontroller . swift”代码，我试图使它易于阅读和理解，而不是那么高性能，我希望你不要在看嵌套for-in的例子时感到恶心😄：</p><figure class="lz ma mb mc fq md"><div class="bz el l di"><div class="pe pf l"/></div></figure><p id="cdd8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">一开始可能看起来很难，但并不复杂，魔术发生在“addSchools”和“createDiagramArray”中，所以，首先尝试理解这一点，然后再理解其余部分。</p><p id="299c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在运行之前，请确保您的服务器在终端中运行，并在Postman中创建一些学生和学校，因为我们没有在我们的应用程序中实现学生的创建。</p><p id="8af5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">运行该应用程序，您应该会看到如下内容:</p><figure class="lz ma mb mc fq md fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff pl"><img src="../Images/ce102c1ed703db5b7ed36a80b813e238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c7Q30NpGMMZmrJcahsfSiQ.png"/></div></div></figure><p id="6a2a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">正在“测试”一个学校和“测试学生”、“测试学生4”、“测试学生3”等。“测试”学校的学生。</p><p id="a5d5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">“testStudent15”、“testStudent14”等。是“测试学校3”的学生，等等。</p><p id="e86a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">挑战时间:添加两个按钮(“添加学校”和“添加学生”)，以便能够从应用程序中创建学校和学生。对于某些请求，您需要“access_token ”,您可以像这样创建头字典:</strong></p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="ef45" class="mo lc hu nd b fv nh ni l nj nk">let headers: HTTPHeaders = [<br/>    "Authorization": "JWT jasgdbjkasbjasjdhasd",<br/>]</span></pre><p id="37be" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后在请求中传递它:</p><pre class="lz ma mb mc fq nc nd ne nf aw ng dt"><span id="4b43" class="mo lc hu nd b fv nh ni l nj nk">"https://127.0.0.1:5000/student/\(name)", headers: headers</span></pre><p id="3a89" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">希望你在将API信息导入iOS应用程序的过程中玩得开心，我很高兴知道你将来会经常用到它。</p></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><h1 id="38ef" class="lb lc hu bd ld le lf lg lh li lj lk ll ja lm jb ln jd lo je lp jg lq jh lr ls dt translated">最后的想法和下一步</h1><p id="a8c8" class="pw-post-body-paragraph jj jk hu jl b jm lt iv jo jp lu iy jr js lv ju jv jw lw jy jz ka lx kc kd ke hn dt translated">很好，现在你有了一个功能性的、经过测试的REST API，以及一个使用它的iOS应用程序。任何服务都可以从您的计算机(或运行服务器的计算机)与这个API进行交互。</p><p id="0399" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">作为后续步骤，我建议执行以下操作:</p><ul class=""><li id="eb79" class="kf kg hu jl b jm jn jp jq js kh jw ki ka kj ke kk kl km kn dt translated">将服务器部署到云(Heroku等。)或您自己的服务器</li><li id="3f03" class="kf kg hu jl b jm ko jp kp js kq jw kr ka ks ke kk kl km kn dt translated">将Git用于服务器的源代码控制(当然也用于应用程序)</li></ul><h2 id="eec4" class="mo lc hu bd ld mp mq mr lh ms mt mu ll js mv mw ln jw mx my lp ka mz na lr nb dt translated">希望你喜欢它到目前为止，让我知道你是否有任何问题，评论或建议。您也可以通过Twitter @ iAmDantePuglisi联系我。</h2></div></div>    
</body>
</html>