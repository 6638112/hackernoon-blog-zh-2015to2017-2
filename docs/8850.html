<html>
<head>
<title>Formik — Handling files and reCaptcha</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Formik —处理文件和reCaptcha</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/formik-handling-files-and-recaptcha-209cbeae10bc?source=collection_archive---------3-----------------------#2017-12-18">https://medium.com/hackernoon/formik-handling-files-and-recaptcha-209cbeae10bc?source=collection_archive---------3-----------------------#2017-12-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/48e192b7d1503c23824792dbedb7ae24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M1ae_X1VwJm74dGWpgt85A.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">formik logo</figcaption></figure><p id="41f0" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这篇文章的目的是展示一些人们在开始使用<a class="ae ke" href="https://hackernoon.com/tagged/formik" rel="noopener ugc nofollow" target="_blank"> Formik </a>时可能会遇到的困难。</p><p id="ab45" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">如果你还不知道Formik，请参考其<a class="ae ke" href="https://github.com/jaredpalmer/formik" rel="noopener ugc nofollow" target="_blank"> Github </a>或这些帖子:</p><ul class=""><li id="53ab" class="kf kg hu ji b jj jk jn jo jr kh jv ki jz kj kd kk kl km kn dt translated"><a class="ae ke" href="https://keyholesoftware.com/2017/10/23/the-joy-of-forms-with-react-and-formik/" rel="noopener ugc nofollow" target="_blank">与React和Formik同形式的喜悦</a></li><li id="ea0e" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd kk kl km kn dt translated"><a class="ae ke" href="https://mead.io/formik/?utm_source=github&amp;utm_campaign=formikrepo" rel="noopener ugc nofollow" target="_blank">与Formik更好的反应形式</a></li><li id="7429" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd kk kl km kn dt translated"><a class="ae ke" href="https://hackernoon.com/painless-react-forms-with-formik-e61b70473c60" rel="noopener ugc nofollow" target="_blank">无痛反应形式与Formik </a>(我写的)</li></ul><p id="e7d6" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">出于演示目的，我将使这些示例简单易懂。我还会故意省去一些功能，这样我就可以在最后给你一些挑战了！</p><h1 id="0588" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">上传一个文件📎</h1><p id="2d01" class="pw-post-body-paragraph jg jh hu ji b jj lr jl jm jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd hn dt translated">我很确定我们都尝试过在表单中上传文件。在Formik文档中，没有关于文件上传的指示或指导，但它就像处理一个<strong class="ji hv">反应-选择</strong>选择框一样简单。</p><p id="ee2c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">您真正需要的只是一个Formik值的条目(在本例中称为<em class="lw">文件)</em>，并设置<em class="lw"> </em> <strong class="ji hv"> onChange </strong>以使用Formik的<strong class="ji hv"> setFieldValue </strong>函数。记住我们可以通过使用<strong class="ji hv">event . current target . files[0]轻松访问上传的文件！</strong></p><p id="7648" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这很简单，因为:</p><figure class="lx ly lz ma fq iv"><div class="bz el l di"><div class="mb mc l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">example function for handling file input</figcaption></figure><p id="0537" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">而Formik为你持有<a class="ae ke" href="https://developer.mozilla.org/en-US/docs/Web/API/File" rel="noopener ugc nofollow" target="_blank">文件</a>对象。你可以用它做任何你想做的事。知道名字，尺寸和类型吗？</p><figure class="lx ly lz ma fq iv"><div class="bz el l di"><div class="mb mc l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">example code for showing file data</figcaption></figure><p id="900c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">有了这些数据，你可以在输入下方的小缩略图中显示图像，如下所示:</p><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff md"><img src="../Images/0be1eb82adeaf09c69526b09070d2743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mvnbIIhL0Ji6cgoZuVQriA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">thumbnail example</figcaption></figure><p id="69d9" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">查看下面的<strong class="ji hv"> CodeSandbox.io </strong>示例，看看如何轻松实现这一点。对于缩略图生成，我非常简单。演示时不需要花哨的东西。</p><figure class="lx ly lz ma fq iv"><div class="bz el l di"><div class="me mc l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">one file upload with thumbnail example</figcaption></figure><h1 id="3b44" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">上传多个文件📎 📎 📎</h1><p id="d8ce" class="pw-post-body-paragraph jg jh hu ji b jj lr jl jm jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd hn dt translated">我们已经看到了单个文件的上传，那么多个文件呢？和一个空投区？那些文件的缩略图呢？</p><p id="72bf" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我将使用优秀的<a class="ae ke" href="https://github.com/react-dropzone/react-dropzone" rel="noopener ugc nofollow" target="_blank"> react-dropzone </a>库来处理所有这些dropzone细节。为了简单起见，我还将重用上一个示例中的缩略图组件。</p><p id="1eeb" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这将是最终的结果</p><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mf"><img src="../Images/97e139236b4d3fdf8138b8d1f68b540a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mEXlsQpkA-_jpA3222awqg.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">3 files uploaded</figcaption></figure><p id="1c35" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">福米克让处理这种事情变得很容易。<strong class="ji hv"> setFieldValue </strong>就是你需要的全部。基本上，你可以跟踪一系列文件，并做你需要做的一切。<strong class="ji hv">请随意使用下面的CodeSandbox.io示例！</strong></p><figure class="lx ly lz ma fq iv"><div class="bz el l di"><div class="me mc l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Multiple file upload example</figcaption></figure><h1 id="fa56" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">reCaptcha支持🔐</h1><p id="bbe1" class="pw-post-body-paragraph jg jh hu ji b jj lr jl jm jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd hn dt translated">我敢打赌，几乎每个人在过去都与某种形式的<a class="ae ke" href="https://hackernoon.com/tagged/google" rel="noopener ugc nofollow" target="_blank">谷歌</a> r <a class="ae ke" href="https://www.google.com/recaptcha/intro/android.html" rel="noopener ugc nofollow" target="_blank"> eCaptcha </a>互动过。也许甚至在今天，你填了一张表格，打了勾，或者玩了一个小游戏来证明你不是机器人。重点是，当人们希望通过不断提交表单来防止机器人向他们发送垃圾邮件时，reCaptchas非常常见。</p><p id="f37f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">让我向您展示如何在表单上处理简单的recaptcha。对于这个例子，我将使用<a class="ae ke" href="https://github.com/appleboy/react-recaptcha" rel="noopener ugc nofollow" target="_blank"> react-recaptcha </a>包来获取api连接。</p><blockquote class="mg mh mi"><p id="b215" class="jg jh lw ji b jj jk jl jm jn jo jp jq mj js jt ju mk jw jx jy ml ka kb kc kd hn dt translated"><strong class="ji hv">我使用了一个仅用于演示目的的键。如果在你读这篇文章的时候，因为任何原因它下降了，请随意输入你自己的并尝试一下。</strong></p></blockquote><figure class="lx ly lz ma fq iv"><div class="bz el l di"><div class="me mc l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Google reCaptcha v2 example</figcaption></figure><p id="cd67" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">什么？！😅你期待更多的工作吗？还记得福克斯的目标吗</p><blockquote class="mm"><p id="7b0f" class="mn mo hu bd mp mq mr ms mt mu mv kd ek translated">就是用最小的API创建一个可伸缩的、高性能的表单助手，它可以做一些非常烦人的事情，剩下的就交给你了。</p></blockquote><p id="ca2b" class="pw-post-body-paragraph jg jh hu ji b jj mw jl jm jn mx jp jq jr my jt ju jv mz jx jy jz na kb kc kd hn dt translated">我们可以简单地用<strong class="ji hv"> setFieldValue </strong>函数控制它，并用值来处理它。稍后，您将把它提交给服务器，并对给定的reCaptcha响应执行服务器端验证！</p><h1 id="4622" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">都在一起！💯</h1><p id="8a3a" class="pw-post-body-paragraph jg jh hu ji b jj lr jl jm jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd hn dt translated">太好了！您已经走了这么远，现在您想知道如何在实际场景中应用它并将数据提交给服务器。让我来帮忙吧！</p><p id="1540" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">让我们为一个用户构建一个表单，该表单有一个<strong class="ji hv">名称、电子邮件、照片、一些附件</strong>，并且必须通过验证reCaptcha来提交表单。</p><p id="4204" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">最后，我们将了解如何向服务器发送信息，以便服务器接受文件和用户模型。</p><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nb"><img src="../Images/03f73804a2c41bedae85824354c5362e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mRGI67gYYhx3kb8z1c7tKQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">the final form look</figcaption></figure><p id="389f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">正如您在下面的<strong class="ji hv"> CodeSandbox.io </strong>中看到的，只有当recaptcha被验证并且我们所有的必填字段都被填写时，表单才被提交。你可以随意摆弄它。</p><figure class="lx ly lz ma fq iv"><div class="bz el l di"><div class="me mc l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">the full example</figcaption></figure><p id="28ee" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">福米克已经为我们免费办理了<strong class="ji hv">姓名</strong>和<strong class="ji hv">电子邮件</strong>。所以我们只需要插入其他字段。就像你想的那么简单</p><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div class="fe ff nc"><img src="../Images/68fd40756852ec055ab3ddf8b7d04080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*MVZ2SVE5b9CU8bljpaSTXA.png"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">initial values, validation schema and submition code</figcaption></figure><p id="d7e5" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">为了让这些文件进入服务器，你必须通过<a class="ae ke" href="https://developer.mozilla.org/en-US/docs/Web/API/FormData" rel="noopener ugc nofollow" target="_blank">表单数据</a>提交它们。我选择了简单的方法，因为它用于演示目的，我必须让它对你来说简单明了。</p><p id="5c8c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我建议<a class="ae ke" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" rel="noopener ugc nofollow" target="_blank"> async/await </a>但是你可以使用任何你想要的！</p><pre class="lx ly lz ma fq nd ne nf ng aw nh dt"><span id="20da" class="ni ku hu ne b fv nj nk l nl nm">const res = await fetch(“your post url”, { method: “POST”, body: formData });</span></pre><p id="c0a1" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">其余的取决于您的服务器堆栈。</p><p id="4e46" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">注意:下面这段代码可能会有所不同，这取决于你的后端栈。</strong></p><pre class="lx ly lz ma fq nd ne nf ng aw nh dt"><span id="cf4b" class="ni ku hu ne b fv nj nk l nl nm">for (let i = 0; i &lt;= values.attachments.length; i++) {</span><span id="77cc" class="ni ku hu ne b fv nn nk l nl nm">  formData.append(`attachments[${i}]`, values.attachments[i]);</span><span id="9b24" class="ni ku hu ne b fv nn nk l nl nm">}</span></pre><h1 id="b14f" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">对你来说有些挑战🎲</h1><p id="1a39" class="pw-post-body-paragraph jg jh hu ji b jj lr jl jm jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd hn dt translated">在这一点上，你可能想知道为什么我没有做一些基本的功能，比如清除上传的文件，清除单个上传的文件(来自多次上传的例子)，或者甚至清除和重置reCaptcha。</p><p id="5bca" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">嗯，那就是<strong class="ji hv">你的</strong>挑战！😏 😄</p><p id="7b6c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">为了提高这些技能，你可以自由地使用代码沙箱并开始工作！</p><p id="c381" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">你可以试试</p><ul class=""><li id="3de9" class="kf kg hu ji b jj jk jn jo jr kh jv ki jz kj kd kk kl km kn dt translated">制作一个更智能的缩略图组件(react-dropzone实际上给了我们一个预览斑点，所以也许可以使用它？😄)</li><li id="31c7" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd kk kl km kn dt translated">从单一上传输入中移除文件</li><li id="2733" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd kk kl km kn dt translated">从多个上传输入中移除一个(一些)文件</li><li id="686e" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd kk kl km kn dt translated">重置加盖器</li><li id="25be" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd kk kl km kn dt translated">简化表单数据追加代码</li><li id="f039" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd kk kl km kn dt translated">对一些API进行真正的提交</li></ul><p id="faab" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">尽情编码吧！💻 🎲</p><figure class="lx ly lz ma fq iv"><div class="bz el l di"><div class="me mc l"/></div></figure></div></div>    
</body>
</html>