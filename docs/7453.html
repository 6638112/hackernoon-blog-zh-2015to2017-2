<html>
<head>
<title>Attach an IAM Role to an EC2 Instance with CloudFormation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CloudFormation将IAM角色附加到EC2实例</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/attach-an-iam-role-to-an-ec2-instance-with-cloudformation-33c517a8d4c3?source=collection_archive---------5-----------------------#2017-10-28">https://medium.com/hackernoon/attach-an-iam-role-to-an-ec2-instance-with-cloudformation-33c517a8d4c3?source=collection_archive---------5-----------------------#2017-10-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/220e9fa74d5fd0ef7039ebf32fcaa3b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/0*seeHMMnw7nyqCM9u."/></div></figure><blockquote class="iy"><p id="1928" class="iz ja hu bd jb jc jd je jf jg jh ji ek translated">CloudFormation允许您通过在代码中定义AWS基础设施来管理它。</p></blockquote><p id="de48" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf ji hn dt translated">在这篇文章中，我将向你们展示如何创建一个<strong class="jl hv"> EC2 </strong>实例，并为其附加一个<strong class="jl hv"> IAM </strong>角色，这样你们就可以访问你们的<strong class="jl hv"> S3 </strong>桶。</p><p id="1e51" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">首先，您需要一个模板来指定您希望在堆栈中包含的资源。对于这一步，您使用我已经准备好的样本<a class="ae kl" href="https://github.com/mlabouardy/aws-cloudformation-templates" rel="noopener ugc nofollow" target="_blank">模板</a>:</p><figure class="km kn ko kp fq iv"><div class="bz el l di"><div class="kq kr l"/></div></figure><p id="c3c5" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">该模板创建一个基本的<strong class="jl hv"> EC2 </strong>实例，该实例使用一个<strong class="jl hv"> IAM角色</strong>和<strong class="jl hv"> S3列表</strong>策略<strong class="jl hv">。它还创建了一个安全组，允许从任何地方进行SSH访问。</strong></p><p id="36d6" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">注意:我还使用了<em class="ks">参数</em>部分来声明在创建堆栈时可以传递给模板的值。</p><p id="868a" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">现在我们定义了模板。登录<a class="ae kl" href="https://console.aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS管理控制台</a>，然后导航到<strong class="jl hv"> CloudFormation </strong>，点击<strong class="jl hv"> Create Stack </strong>。上传<strong class="jl hv"> JSON </strong>文件:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/c4ef8809172546c3a0d9166c12e921ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*cMmzY5vildv0Htec."/></div></figure><p id="44c6" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">您需要为这个栈指定一个名称，并选择您的EC2规范配置&amp; SSH密钥对:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/4b661c603c982c3e52b97ce87913a55d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*KFM77mK51J_Grf5U."/></div></figure><p id="8e8b" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">确保选中“我确认AWS云信息可能会创建IAM资源”复选框，以便创建<strong class="jl hv"> IAM策略</strong> &amp; <strong class="jl hv">角色</strong>:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/8f77d234277aa0b2e1b1af6e3d62a88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*DAtdclqaDz5oVwwK."/></div></figure><p id="cf47" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">启动后，您将看到以下启动流程事件的屏幕:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/9ab04b89dd9670867165dd220355fba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*p7sJHa5ED0RuHxWp."/></div></figure><p id="bb34" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">过一会儿，您会在状态选项卡中看到<strong class="jl hv"> CREATE_COMPLETE </strong>消息:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/5b5df66154c4da7bd055f585ed6bf943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*JIg-NkDJZVvpBL7v."/></div></figure><p id="f3c6" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">完成后，在output选项卡上，您应该看到如何通过<strong class="jl hv"> SSH </strong>连接到您的实例:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/566f40e6646ad4d43a0b15f22c874de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*ohUUi10q8X4KfwJT."/></div></figure><p id="49f7" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">如果您将终端指向output选项卡中显示的值，您应该能够通过SSH连接到服务器:</p><p id="4367" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">宋承宪ec2-user@52.91.239.135-I VPC . PEM</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/b500d5d36b5b383032fe0d08c838683d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*8m3BsF8wLbP5Jpnl."/></div></figure><p id="7f97" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">让我们检查一下是否可以使用<strong class="jl hv"> AWS CLI </strong>列出S3存储桶:</p><p id="4bbf" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">aws s3 ls</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/0b24c582d4e885fc21318624399cdcd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/0*pmTPfF5Yp7Q-ZRVk."/></div></figure><p id="c614" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">厉害！因此，我们能够列出存储桶，但是如果我们想要创建一个新的存储桶，该怎么办呢:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/bd0fe070ff64821aad3a8aed155b30f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*vJH6PwwLbyae_WGH."/></div></figure><p id="6e0c" class="pw-post-body-paragraph jj jk hu jl b jm kg jo jp jq kh js jt ju ki jw jx jy kj ka kb kc kk ke kf ji hn dt translated">没有成功，这很正常，因为附加到实例的<strong class="jl hv"> IAM角色</strong>没有足够的权限(<em class="ks"> CreateBucket </em> action)。</p></div></div>    
</body>
</html>