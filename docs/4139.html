<html>
<head>
<title>How to write nice, typed and expressive node-express functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何编写漂亮的、有类型的、有表现力的节点表达函数</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-write-nice-typed-and-expressive-node-express-functions-107ae7edd41?source=collection_archive---------9-----------------------#2017-05-15">https://medium.com/hackernoon/how-to-write-nice-typed-and-expressive-node-express-functions-107ae7edd41?source=collection_archive---------9-----------------------#2017-05-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/130dc4f93197e43a3c074ccc0518c7b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*drudDoh5PG0royvGlco-pg.jpeg"/></div></figure><p id="9355" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在这篇文章中，我将展示一种包装节点表达控制器方法的好方法，以便有一个更好的自描述<a class="ae jw" href="https://hackernoon.com/tagged/codebase" rel="noopener ugc nofollow" target="_blank">代码库</a>。</p><p id="f103" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">假设您想要构建一个api端点来获取某个用户，并返回它。很简单，是吗？</p><h2 id="a173" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">1.很久以前</h2><p id="2719" class="pw-post-body-paragraph iy iz hu ja b jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr kw jt ju jv hn dt translated">很久以前，人们会写一些可以阅读的东西</p><figure class="kx ky kz la fq iv"><div class="bz el l di"><div class="lb lc l"/></div><figcaption class="ld le fg fe ff lf lg bd b be z ek">Old school style, with callbacks and no typings. The legend says that people actually found this very cool for some time.</figcaption></figure><h2 id="70ce" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">2.现在</h2><p id="2d1f" class="pw-post-body-paragraph iy iz hu ja b jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr kw jt ju jv hn dt translated">让我们现在到2017年，使用typescript。首先，让我们利用这里的两个特性:</p><ul class=""><li id="fb85" class="lh li hu ja b jb jc jf jg jj lj jn lk jr ll jv lm ln lo lp dt translated">打字</li><li id="7bb6" class="lh li hu ja b jb lq jf lr jj ls jn lt jr lu jv lm ln lo lp dt translated">异步/等待</li></ul><p id="d416" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">代码可以重写如下:</p><figure class="kx ky kz la fq iv"><div class="bz el l di"><div class="lb lc l"/></div></figure><p id="8e3f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意<code class="eh lv lw lx ly b">await user.findOne(...)</code>如何允许我们编码，就好像我们的流程是同步的一样。此外，任何异常(或拒绝的承诺)都将被主<code class="eh lv lw lx ly b">try/catch</code>块捕获。对于更复杂的函数，已经有了很好的改进。如果你还不知道的话，<a class="ae jw" href="https://hackernoon.com/await-is-the-new-black-e47217f96f06" rel="noopener ugc nofollow" target="_blank">我碰巧对async/await </a>很感兴趣。</p><p id="d3b7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">此外，尝试添加一个错别字，如<code class="eh lv lw lx ly b">res.seeendStatus(500)</code>，typescript编译器会警告您一个未知的方法。因为<code class="eh lv lw lx ly b">Result</code>现在有打字了。很好。安全。</p><h2 id="b4be" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">3.甚至更好？！</h2><p id="5d50" class="pw-post-body-paragraph iy iz hu ja b jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr kw jt ju jv hn dt translated">我用最后一个例子作为模板很长一段时间，它工作得很好。尽管如此，有些事情还是会困扰我。</p><p id="87e4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">通过查看这段代码，乍一看这个函数返回一个用户并不明显。添加一些文档是一个想法，但是你怎么能确定文档<em class="lz">准确地描述了下面的代码呢(通常的回答是:你不知道，所以你还是要读代码)？</em></p><p id="deaf" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">当然，这个例子很简单，所以你很快就能读懂这个方法。但是，当我们到处都在使用类型化的<a class="ae jw" href="https://hackernoon.com/tagged/functions" rel="noopener ugc nofollow" target="_blank">函数</a>时，为什么要读取方法呢？</p><p id="fe86" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们在<a class="ma mb gr" href="https://medium.com/u/4fb3c47e7f1c?source=post_page-----107ae7edd41--------------------------------" rel="noopener" target="_blank"> Hunteed </a>想出的是一个包装器，它允许我们声明我们的express函数的输出。</p><p id="3e71" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在我们深入细节之前，这里有一个我们最终函数的例子:</p><figure class="kx ky kz la fq iv"><div class="bz el l di"><div class="lb lc l"/></div></figure><p id="d16b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在这里你可以注意到:</p><ul class=""><li id="c8fa" class="lh li hu ja b jb jc jf jg jj lj jn lk jr ll jv lm ln lo lp dt translated">我们使用一些神奇的<code class="eh lv lw lx ly b">apiMethod</code>装饰来减少样板文件。</li><li id="e85e" class="lh li hu ja b jb lq jf lr jj ls jn lt jr lu jv lm ln lo lp dt translated">第一行说明了一切:这个<code class="eh lv lw lx ly b">wrappedShowUser</code>函数假装它返回一个包含类型为<code class="eh lv lw lx ly b">User</code>的用户的对象，或者什么都不包含。</li><li id="9e45" class="lh li hu ja b jb lq jf lr jj ls jn lt jr lu jv lm ln lo lp dt translated">我们不写no try/catch(仍然应该有一个try catch，但是我们不需要每次都写它，冒着忘记它的风险)</li><li id="3e09" class="lh li hu ja b jb lq jf lr jj ls jn lt jr lu jv lm ln lo lp dt translated">该函数实际上返回我们假装发送的数据。typescript可以检查我们做了什么。耶！</li></ul><p id="1233" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在开始实施:</p><figure class="kx ky kz la fq iv"><div class="bz el l di"><div class="lb lc l"/></div></figure><h2 id="dca3" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">结论</h2><p id="b027" class="pw-post-body-paragraph iy iz hu ja b jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr kw jt ju jv hn dt translated">正如所承诺的，我们最终的api方法现在如下所示</p><figure class="kx ky kz la fq iv"><div class="bz el l di"><div class="lb lc l"/></div></figure><p id="cf91" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我真的认为这是一些可读和自描述的代码。它利用了类型、错误处理的优势，并保证没有人会忘记在express api端点上使用try/catch。整洁！</p><figure class="kx ky kz la fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="fe ff mc"><img src="../Images/260868264e5393acf53e1f87faa3b10f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXmL6IfE1xU31nWh5I0Geg.jpeg"/></div></div><figcaption class="ld le fg fe ff lf lg bd b be z ek">These people have absolutely no idea of what’s going on here, but they definitely look very happy about it.</figcaption></figure><div class="kx ky kz la fq ab cb"><figure class="mh iv mi mj mk ml mm paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mh iv mi mj mk ml mm paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mh iv mi mj mk ml mm paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mn mo mp"><p id="f922" class="iy iz lz ja b jb jc jd je jf jg jh ji mq jk jl jm mr jo jp jq ms js jt ju jv hn dt translated"><a class="ae jw" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jw" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jw" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jw" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="iy iz lz ja b jb jc jd je jf jg jh ji mq jk jl jm mr jo jp jq ms js jt ju jv hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jw" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jw" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kx ky kz la fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="fe ff mt"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="kx ky kz la fq iv"><div class="bz el l di"><div class="mu lc l"/></div></figure></div></div>    
</body>
</html>