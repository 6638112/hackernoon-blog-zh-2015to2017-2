<html>
<head>
<title>Colorizing Black &amp; White Photos using Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用深度学习给黑白照片着色</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/colorising-black-white-photos-using-deep-learning-4da22a05f531?source=collection_archive---------6-----------------------#2017-08-22">https://medium.com/hackernoon/colorising-black-white-photos-using-deep-learning-4da22a05f531?source=collection_archive---------6-----------------------#2017-08-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="f7dd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt jp translated">eep学习增强了视觉和语言处理等“认知”任务。甚至谷歌也转而使用基于神经网络的翻译<a class="ae jy" href="https://research.google.com/pubs/pub45610.html" rel="noopener ugc nofollow" target="_blank"/>。一个可能的原因是，它不需要特定领域的知识来获得最先进的结果。此外，GPU等无限并行的硬件，加上TensorFlow等精心设计的框架，引发了人工智能革命。这篇文章谈到了另一个这样的“认知”任务:使用<a class="ae jy" href="https://hackernoon.com/tagged/deep-learning" rel="noopener ugc nofollow" target="_blank">深度学习</a>给黑白照片着色。</p><p id="5e42" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这篇文章基于最近的一篇论文:<a class="ae jy" href="https://arxiv.org/pdf/1603.08511.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1603.08511.pdf</a></p><p id="dd96" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本文假设关于<strong class="it hv">神经网络</strong>和<strong class="it hv">损失函数</strong>的基本知识。</p></div><div class="ab cl jz ka hc kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hn ho hp hq hr"><h1 id="2117" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">任务</h1><p id="43a9" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">这项任务相当简单:拍摄一张黑白照片，然后将其制作成彩色版本。直觉上，这个想法很简单。根据图片中的内容，可以判断出应该是什么颜色。树叶通常是绿色的，天空是蓝色的，云是白色的，等等。所有需要做的就是让计算机能够做到这一点。</p></div><div class="ab cl jz ka hc kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hn ho hp hq hr"><h1 id="6c41" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">以前的工作和问题</h1><p id="00f8" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">之前的作品都使用了深度学习。他们使用回归分析来预测每个像素的颜色。然而，这产生了相当平淡无奇的结果。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff lj"><img src="../Images/5965f05c6fe43033b795d9c6595407da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KANitt5Msc0T0YB25bFG2g.jpeg"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek">Figure 1.0 Results of a regression based model. <strong class="bd lz">Left: </strong>Input to the model. <strong class="bd lz">Right: </strong>Output of the model</figcaption></figure><p id="7d90" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">先前的工作使用均方误差(MSE)作为损失函数来训练模型。作者指出，MSE将尝试“平均”出颜色，以获得最小的平均误差，这将导致平淡无奇的外观。相反，作者把给图片着色的任务作为一个分类问题。</p><h1 id="23e8" class="kg kh hu bd ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz me lb lc ld dt translated">模型的输入和输出</h1><p id="77e7" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">作者使用LAB色彩空间(最常见的色彩空间是RGB)。在实验室方案中，L通道记录光强度值，另外两个通道分别记录颜色对手绿色-红色和蓝色-黄色。你可以在这里阅读关于LAB的详细<a class="ae jy" href="https://en.wikipedia.org/wiki/Lab_color_space" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="94d1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用LAB色彩空间的一个很好的理由是它可以保持光强度值的分离。B/W图片可以被认为只是L通道，该模型在进行预测时不必学习如何保持光强度正确(如果使用RGB，则必须这样做)。该模型将只学习如何给图像着色，让它专注于重要的事情。</p><p id="40dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该模型输出AB值，然后可以将其应用于黑白图像以获得彩色版本。</p><p id="1b94" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">模型本身就是一个相当标准的卷积神经<a class="ae jy" href="https://hackernoon.com/tagged/network" rel="noopener ugc nofollow" target="_blank">网络</a>。作者没有使用任何池层，而是选择使用上采样/下采样层。</p><h1 id="14cc" class="kg kh hu bd ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz me lb lc ld dt translated">颜色量化</h1><p id="5416" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">如上所述，作者使用了分类模型而不是回归模型。因此，班级的数量需要固定。作者选择313个AB对作为类别数。即使这看起来是一个非常低的值，他们使用了一些方法来确保更多的颜色值是可能的(这将在本文后面讨论)。</p><h1 id="45e1" class="kg kh hu bd ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz me lb lc ld dt translated">损失函数</h1><p id="2638" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">作者使用的损失函数是标准交叉熵。Z是一个像素的实际类，而Z hat是模型的输出。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mf"><img src="../Images/b019511fb228d7ce73b19a1795d829d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*spXCAa3W0xj-CfliMXxypg.jpeg"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek"><strong class="bd lz">Equation 1.0</strong> Standard Cross Entropy</figcaption></figure><p id="10f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作者还指出，颜色值会有等级不平衡。交叉熵是一种损失函数，它不能很好地处理类别不平衡，通常具有较少实例的类别被赋予较高的权重。作者指出，与其他颜色相比，像灰色和浅蓝色这样的不饱和颜色更丰富，因为它们出现在背景中。因此，他们想出了他们的称重方案。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mf"><img src="../Images/312e0ae9e2f3946c0c715a702926f25e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMfHwNxifg5wqoI_AAwrNg.jpeg"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek"><strong class="bd lz">Equation 1.1</strong> Weighing scheme</figcaption></figure><p id="fd08" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作者从ImageNet数据库中计算~p，这是类的分布。记住Q是类的数量(313)。作者使用λ值为0.5效果很好。注意作者平滑了分布~p，但是我将在这里跳过细节。有兴趣的可以在原论文里看一下。</p><p id="147f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以在考虑了重量之后，最终的损失函数看起来是这样的:</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mf"><img src="../Images/423af82888b03cf65ea18b95851b5022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gTvlcCDdOgkElSVpxxSKMg.jpeg"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek"><strong class="bd lz">Equation 1.3</strong> Loss function after weighing scheme</figcaption></figure><p id="7151" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">新的项v()就是每个类的权重值。h和w分别是图像的高度和宽度。</p><h1 id="232b" class="kg kh hu bd ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz me lb lc ld dt translated">从类别中预测颜色</h1><p id="43a3" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">直接使用类别号313来给图像着色会太粗糙。颜色实在太少了，无法真实地表现颜色的真实范围。</p><p id="5da3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作者使用了后处理步骤，以便从模型的预测中获得更多样化的颜色范围。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mf"><img src="../Images/420c30d154e5d8db757a019e6913b965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K0xgC2nOR1y9-UvqgmXkbA.jpeg"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek"><strong class="bd lz">Equation 2.0</strong> Calculating color from class probabilities</figcaption></figure><p id="e3de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">h是函数，Z是模型的输出。t是一个超参数，作者用几个不同的值进行了实验。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mg"><img src="../Images/f360d8259e88e25edd365495ef572a4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YOcKbnMw385LSP4Fopy1gA.jpeg"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek"><strong class="bd lz">Figure 1.0 </strong>Effect of different values of T</figcaption></figure><p id="79a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是一个好步骤的原因是因为模型的输出将具有关于类概率的非常有价值的信息。上面的函数不是只取具有最大概率的类(就像我们在图像分类中所做的那样)，而是试图利用关于模型输出的整个概率分布的信息。</p><h1 id="8603" class="kg kh hu bd ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz me lb lc ld dt translated">培训框架</h1><p id="053a" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">训练这样的网络分为两部分。首先，数据通过模型传递(正向传递)，然后计算最终预测。为了计算损耗，需要计算H的倒数。</p><h1 id="d658" class="kg kh hu bd ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz me lb lc ld dt translated">结果</h1><p id="b26a" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">结果更加生动，而且在大多数情况下，非常接近真实。请注意，很多时候它与地面真实情况并不完全相同，但它在语义上仍然是正确的(模型用正确的颜色给正确的对象着色)。</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mh"><img src="../Images/d30d03d6a998a36d93e992233d73de03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f1-AXynFt2Hp0Geu6g_TvQ.png"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek"><strong class="bd lz">Figure 2.0</strong> Comparison between different colouring frameworks</figcaption></figure><h2 id="de41" class="mi kh hu bd ki mj mk ml km mm mn mo kq jc mp mq ku jg mr ms ky jk mt mu lc mv dt translated">给传统黑白照片着色</h2><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff mw"><img src="../Images/48a6b97bb72620b0d7bb762eac6caeb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-QBWCLkALbVJCo5l07YQFg.jpeg"/></div></div><figcaption class="lv lw fg fe ff lx ly bd b be z ek"><strong class="bd lz">Figure 2.1 </strong>Colouring photos that were originally taken in Black &amp; White</figcaption></figure><h1 id="7156" class="kg kh hu bd ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz me lb lc ld dt translated">结论</h1><p id="e3d7" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">在这篇文章中，我们讨论了一种新的方法来彩色图像使用一个修改的损失函数。我们讨论了如何使用超参数来控制活力，以及为什么类再平衡在自然图像着色中起着重要作用。</p><h1 id="d2cf" class="kg kh hu bd ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz me lb lc ld dt translated">行动呼吁</h1><p id="79d0" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">如果你喜欢这篇文章，<strong class="it hv">只要你认为这篇文章有价值，就按住那个拍手图标</strong>。我总是在寻找反馈来改进我的文章。如果你有建议或问题，请随时回复。</p><figure class="lk ll lm ln fq lo"><div class="bz el l di"><div class="mx my l"/></div></figure></div></div>    
</body>
</html>