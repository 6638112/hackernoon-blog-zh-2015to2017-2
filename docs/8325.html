<html>
<head>
<title>Decide on dinner with an Ethereum arbitration contract</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用以太坊仲裁合同决定晚餐</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/decide-on-dinner-with-an-ethereum-arbitration-contract-c59c13a28d5?source=collection_archive---------19-----------------------#2017-11-28">https://medium.com/hackernoon/decide-on-dinner-with-an-ethereum-arbitration-contract-c59c13a28d5?source=collection_archive---------19-----------------------#2017-11-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/ddef4b02550e9cb758504385dfb8fb72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4ctSjJIIbOTHTqyHB2kLw.png"/></div></div></figure><div class=""/><p id="2829" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">杰克和吉尔决定不了晚餐，所以他们请了一位仲裁人来审理他们的争执。问题是他们不相信对方能独立选择仲裁人。</p><p id="e92f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们写一份以太坊契约来处理他们的纠纷吧！</p><blockquote class="ka kb kc"><p id="dd04" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">本文假设您对以太坊有基本的了解。如果你还不确定，就从Preethi Kasireddy 的这篇<a class="ae kh" rel="noopener" href="/@preethikasireddy/how-does-ethereum-work-anyway-22d1df506369">精彩文章</a>开始吧。</p></blockquote></div><div class="ab cl kk kl hc km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hn ho hp hq hr"><h2 id="c436" class="kr ks if bd kt ku kv kw kx ky kz la lb jn lc ld le jr lf lg lh jv li lj lk ll dt translated">我们的合同将如何运作</h2><p id="1307" class="pw-post-body-paragraph jc jd if je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated"><strong class="je ig"> 1。</strong>第一个人创建一个新的仲裁实例，并对其进行描述。🌟</p><p id="2f22" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> 2。</strong>第一个人和第二个人提交了他们的不同意见。😠</p><p id="6ae3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> 3。</strong>人物一和人物二也选择一个仲裁者。直到双方同意相同的帐户地址，该过程才会继续。👍</p><p id="6ddc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> 4。仲裁人审查两个观点并决定获胜者。🤔 ➡ 🏆</strong></p><h1 id="4ff8" class="lr ks if bd kt ls lt lu kx lv lw lx lb ly lz ma le mb mc md lh me mf mg lk mh dt translated">设置</h1><blockquote class="ka kb kc"><p id="9153" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">F <!-- -->如果你以前运行过松露项目，你可以随意移动到下一部分</p></blockquote><p id="c70d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将使用一个名为<a class="ae kh" href="http://truffleframework.com/" rel="noopener ugc nofollow" target="_blank"> Truffle </a>的框架来开发我们的智能合约。这是一个处理编译、测试、部署、迁移等等的一站式商店。在这篇文章中，我们将只使用某些功能，但我鼓励你深入挖掘。</p><p id="8da6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在我们开始之前，全局安装truffle和testrpc。</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="e230" class="kr ks if mn b fv mr ms l mt mu">npm install -g truffle <!-- -->ethereumjs-testrpc</span></pre><p id="e1fd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，在新目录中运行:</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="6c05" class="kr ks if mn b fv mr ms l mt mu">truffle init</span></pre><p id="8b18" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你应该看到truffle的文件夹结构随着一些简单的例子在<code class="eh mv mw mx mn b">contracts/</code>文件夹中膨胀。</p><h2 id="2667" class="kr ks if bd kt ku kv kw kx ky kz la lb jn lc ld le jr lf lg lh jv li lj lk ll dt translated">把你的脚弄湿</h2><p id="1bed" class="pw-post-body-paragraph jc jd if je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">让我们感受一下工作流程。</p><p id="d7a6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> 1。</strong>用<code class="eh mv mw mx mn b">testrpc</code>启动我们的测试客户端。您将看到一些用于模拟互动的账户:</p><figure class="mi mj mk ml fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff my"><img src="../Images/d02c9485ea491bac761751404f68e4b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t7qUA4w6FZEmLUR3kGiB_g.png"/></div></div></figure><p id="be05" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> 2。</strong>中的<em class="kd">分开</em>标签中的<em class="kd">运行<code class="eh mv mw mx mn b">truffle compile</code>。这将从契约中生成一个相应的JSON工件，并将它们放到一个构建文件夹中。</em></p><p id="484b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> 3。</strong>现在运行<code class="eh mv mw mx mn b">truffle migrate</code>来生成文件，以便将合同部署到区块链。<em class="kd">重要的是，当您迁移时，testrpc必须正在运行，否则您的契约不会被部署到那个测试实例。</em></p><p id="86a6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> 4。运行<code class="eh mv mw mx mn b">truffle console</code>，它将连接到我们正在运行的以太坊客户端，并允许我们与合同进行交互。</strong></p><h2 id="aef4" class="kr ks if bd kt ku kv kw kx ky kz la lb jn lc ld le jr lf lg lh jv li lj lk ll dt translated">闲逛</h2><p id="0952" class="pw-post-body-paragraph jc jd if je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">我们将修改一个现有的契约(技术上来说是一个<a class="ae kh" href="http://solidity.readthedocs.io/en/develop/contracts.html#libraries" rel="noopener ugc nofollow" target="_blank">库</a> …尽管对我们的目的有用)<code class="eh mv mw mx mn b"><a class="ae kh" href="https://github.com/ConsenSys/truffle-webpack-demo/blob/master/contracts/ConvertLib.sol" rel="noopener ugc nofollow" target="_blank">ConvertLib.sol</a></code>。它提供了一种将两个数相乘的方法。</p><blockquote class="ka kb kc"><p id="ccb0" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">改变链上状态的方法是一个<strong class="je ig">事务</strong>(消耗gas)，而任何只返回数据的方法是一个<strong class="je ig">调用</strong>(免费)。</p></blockquote><p id="462c" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">松露的控制台已经<a class="ae kh" href="https://github.com/ethereum/wiki/wiki/JavaScript-API" rel="noopener ugc nofollow" target="_blank"> web3 </a>和我们的合同准备就绪，放手一搏:</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="d0a1" class="kr ks if mn b fv mr ms l mt mu"><em class="kd">// get the deployed contract by its class name, returns a promise<br/></em><strong class="mn ig">&gt; const contract = ConvertLib.deployed()</strong></span><span id="0454" class="kr ks if mn b fv mz ms l mt mu"><em class="kd">// invoke the 'convert' method with 'call', also returns a promise</em><strong class="mn ig"><em class="kd"><br/></em>&gt; const response = contract.then(c =&gt; c.convert.call(5, 20))</strong></span><span id="2247" class="kr ks if mn b fv mz ms l mt mu"><em class="kd">// print out our result!!</em><strong class="mn ig"><br/>&gt; response.then(res =&gt; res.toNumber())</strong></span><span id="fb9b" class="kr ks if mn b fv mz ms l mt mu"><em class="kd">100</em></span></pre><p id="ffcf" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">太好了，我们已经与一个<em class="kd">部署合同</em>互动，让两个数字相乘！</p></div><div class="ab cl kk kl hc km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hn ho hp hq hr"><h1 id="cea1" class="lr ks if bd kt ls na lu kx lv nb lx lb ly nc ma le mb nd md lh me ne mg lk mh dt translated">让我们写一些可靠性</h1><p id="249c" class="pw-post-body-paragraph jc jd if je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">以太坊合同是用一种叫做<a class="ae kh" href="https://solidity.readthedocs.io/en/develop/" rel="noopener ugc nofollow" target="_blank">可靠性</a>的高级语言编写的。如果你熟悉Javascript或面向对象编程，你会发现很多相似之处。</p><p id="decc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用Solidity，我们将定义状态变量并建立我们的仲裁规则。之后，我们将使用Truffle来编译合同，并将其部署到我们的测试环境中。我们在合同中定义的状态和代码将存在于以太坊区块链的一个特定地址。</p></div><div class="ab cl kk kl hc km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hn ho hp hq hr"><p id="5675" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们从打扫房间开始。移除<code class="eh mv mw mx mn b">contracts/ConvertLib.sol</code>和<code class="eh mv mw mx mn b">contracts/MetaCoin.sol</code>，但<strong class="je ig">保留</strong>和<code class="eh mv mw mx mn b">contracts/Migrations.sol</code>，以便我们可以执行迁移。</p><p id="feb4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，在<code class="eh mv mw mx mn b">contracts/</code>文件夹中创建一个名为<code class="eh mv mw mx mn b">Arbitration.sol</code>的文件。现在进入你的<code class="eh mv mw mx mn b">migrations/</code>文件夹，修改<code class="eh mv mw mx mn b">2_deploy_contracts.js</code>:</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="f8c3" class="kr ks if mn b fv mr ms l mt mu">var Arbitration = artifacts.require('./Arbitration.sol');</span><span id="a240" class="kr ks if mn b fv mz ms l mt mu">module.exports = function(deployer) {<br/>  deployer.deploy(Arbitration);<br/>};</span></pre></div><div class="ab cl kk kl hc km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hn ho hp hq hr"><p id="e2e0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">打开<code class="eh mv mw mx mn b">contracts/Arbitration.sol</code>，开始定义实体版本和合同名称。</p><p id="0d99" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您将添加公共变量<code class="eh mv mw mx mn b">description</code>和<code class="eh mv mw mx mn b">winningOpinion</code>以及事务方法<code class="eh mv mw mx mn b">setDescription</code>来设置描述。</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="eb39" class="kr ks if mn b fv mr ms l mt mu">pragma solidity ^0.4.11;</span><span id="404d" class="kr ks if mn b fv mz ms l mt mu">contract Arbitration {<br/>  string public description;<br/>  string public winningOpinion;</span><span id="7a81" class="kr ks if mn b fv mz ms l mt mu">  function setDescription(string _description) {<br/>    description = _description;<br/>  }<br/>}</span></pre></div><div class="ab cl kk kl hc km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hn ho hp hq hr"><p id="3e48" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来使用<code class="eh mv mw mx mn b"><a class="ae kh" href="http://solidity.readthedocs.io/en/develop/types.html#structs" rel="noopener ugc nofollow" target="_blank">struct</a></code>类型来定义我们的索赔人的数据应该是什么样子。然后，我们将使用我们创建的<code class="eh mv mw mx mn b">Claimant</code>类型来声明一个名为<code class="eh mv mw mx mn b">claimants</code>的数组。最后，创建一个添加新索赔者的方法。</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="dfe2" class="kr ks if mn b fv mr ms l mt mu">contract Arbitration {<br/>  string public description;</span><span id="5344" class="kr ks if mn b fv mz ms l mt mu"><strong class="mn ig">  struct Claimant {<br/>    string opinion;<br/>    address addr;<br/>    address arbiter;<br/>  }</strong></span><span id="5ce9" class="kr ks if mn b fv mz ms l mt mu"><strong class="mn ig">  Claimant[] public claimants;<br/></strong>  <br/>  function setDescription(string _description) {<br/>    description = _description;<br/>  }</span><span id="7ea6" class="kr ks if mn b fv mz ms l mt mu"><strong class="mn ig">  function addClaimant(string opinion, address arbiter) {<br/>    if (claimants.length &lt; 2) {<br/>      claimants.push(Claimant(opinion, msg.sender, arbiter));  <br/>    }</strong><br/><strong class="mn ig">  }</strong><br/>}</span></pre><p id="1020" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">需要注意的一点是，<code class="eh mv mw mx mn b">msg.sender</code>会给我们发送<code class="eh mv mw mx mn b">addClaimant</code>交易的账户地址。<code class="eh mv mw mx mn b">msg</code>也有其他<a class="ae kh" href="http://solidity.readthedocs.io/en/develop/units-and-global-variables.html#block-and-transaction-properties" rel="noopener ugc nofollow" target="_blank">有价值的信息</a>传递。</p></div><div class="ab cl kk kl hc km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hn ho hp hq hr"><p id="2932" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在申请人添加了他们的提议之后，仲裁人将能够通过调用<code class="eh mv mw mx mn b">getProposals</code>来审查异议。</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="f6b8" class="kr ks if mn b fv mr ms l mt mu">contract Arbitration {</span><span id="5722" class="kr ks if mn b fv mz ms l mt mu">  ...</span><span id="e03a" class="kr ks if mn b fv mz ms l mt mu"><strong class="mn ig">  function getProposals()<br/>    returns (<br/>      string _description,<br/>      string _proposalOne,<br/>      string _proposalTwo<br/>    )<br/>  {<br/>    require(claimants.length == 2);<br/>    return (<br/>      description,<br/>      claimants[0].opinion,<br/>      claimants[1].opinion<br/>    );<br/>  }</strong></span><span id="523c" class="kr ks if mn b fv mz ms l mt mu">}</span></pre><p id="6b9f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在函数声明中，你会看到我们定义了用<code class="eh mv mw mx mn b">returns</code>关键字返回的内容。我们使用<code class="eh mv mw mx mn b">require</code>来允许代码仅在两个索赔者提交时继续。</p></div><div class="ab cl kk kl hc km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hn ho hp hq hr"><p id="25da" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们将创建一个方法，只允许<em class="kd">这个仲裁者</em>选择获胜者。首先我们将创建一个<code class="eh mv mw mx mn b">selectWinner</code>将使用的助手方法<code class="eh mv mw mx mn b">verifyArbiter</code>。<code class="eh mv mw mx mn b">verifyArbiter</code>循环遍历索赔人，确保发件人地址与每个索赔人选择的地址相匹配。如果require没有抛出错误，那么它将设置契约的状态变量<code class="eh mv mw mx mn b">winningOpinion</code>。</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="899b" class="kr ks if mn b fv mr ms l mt mu">contract Arbitration {</span><span id="73ec" class="kr ks if mn b fv mz ms l mt mu">  ...</span><span id="31e4" class="kr ks if mn b fv mz ms l mt mu"><strong class="mn ig">  function verifyArbiter() returns (bool isArbiter) {<br/>    for (uint i = 0; i &lt; claimants.length; i++) {<br/>      if (msg.sender != claimants[i].arbiter) {<br/>        return false;<br/>      }<br/>    }</strong></span><span id="c235" class="kr ks if mn b fv mz ms l mt mu"><strong class="mn ig">    return true;<br/>  }</strong></span><span id="1860" class="kr ks if mn b fv mz ms l mt mu"><strong class="mn ig">  function selectWinner(uint proposalNumber) {<br/>    require(verifyArbiter());</strong></span><span id="a05e" class="kr ks if mn b fv mz ms l mt mu"><strong class="mn ig">    winningOpinion = claimants[proposalNumber].opinion;<br/>  }</strong></span><span id="6463" class="kr ks if mn b fv mz ms l mt mu">}</span></pre><h1 id="f2df" class="lr ks if bd kt ls lt lu kx lv lw lx lb ly lz ma le mb mc md lh me mf mg lk mh dt translated">与合同互动</h1><p id="2ef8" class="pw-post-body-paragraph jc jd if je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">打开终端并运行<code class="eh mv mw mx mn b">testrpc</code>。然后，在新的选项卡中运行<code class="eh mv mw mx mn b">truffle compile</code>、<code class="eh mv mw mx mn b">truffle migrate</code>和<code class="eh mv mw mx mn b">truffle console</code>，就像我们在上一节中所做的那样。让我们首先获取对我们的合同的引用，并为其添加描述:</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="1d95" class="kr ks if mn b fv mr ms l mt mu">&gt;<strong class="mn ig"> const contract = Arbitration.deployed()</strong></span><span id="e54c" class="kr ks if mn b fv mz ms l mt mu">&gt;<strong class="mn ig"> contract.then(c =&gt; c.description())</strong><br/><em class="kd">''<br/></em>&gt;<strong class="mn ig"> contract.then(c =&gt; c.setDescription('What to eat for dinner'))</strong></span><span id="971b" class="kr ks if mn b fv mz ms l mt mu">&gt;<strong class="mn ig"> contract.then(c =&gt; c.description())<br/></strong><em class="kd">'What to eat for dinner'</em></span></pre><p id="3032" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">可以看到，我们可以像调用函数一样调用变量名来访问状态:<code class="eh mv mw mx mn b">description()</code>。</p><p id="3c9f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，回到testrpc输出，查看它给出的十个地址。将<code class="eh mv mw mx mn b"><em class="kd">ARBITER_ADDRESS</em></code>设置为列表中除第一个以外的任何地址，因为truffle默认使用第一个帐户作为发送者。</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="bacb" class="kr ks if mn b fv mr ms l mt mu">&gt;<strong class="mn ig"> contract.then(c =&gt; c.addClaimant('burgers', '<em class="kd">ARBITER_ADDRESS</em>'))</strong></span><span id="ed6f" class="kr ks if mn b fv mz ms l mt mu">&gt;<strong class="mn ig"> contract.then(c =&gt; c.claimants(0))<br/></strong><em class="kd">[ 'burgers',<br/>'FIRST_ADDRESS_LISTED',<br/>'ARBITER_ADDRESS' ]</em></span></pre><p id="d4df" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了添加第二个索赔者，我们将修改调用addClaimant方法的方式。最后一个参数将从testrpc帐户列表中获取另一个地址，并从那里模拟发送一个调用。</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="85e1" class="kr ks if mn b fv mr ms l mt mu">&gt;<strong class="mn ig"> contract.then(c =&gt; c.addClaimant('pizza', '<em class="kd">ARBITER_ADDRESS</em>', {from: '<em class="kd">SECOND_CLAIMANT_ADDRESS</em>'}))</strong></span><span id="4482" class="kr ks if mn b fv mz ms l mt mu">&gt;<strong class="mn ig"> contract.then(c =&gt; c.claimants(1))<br/></strong><em class="kd">[ 'pizza',<br/>'SECOND_CLAIMANT_ADDRESS',<br/>'ARBITER_ADDRESS' ]</em></span></pre><p id="a390" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在假设仲裁人希望看到提案的当前状态。假设两个声明者都投票了(否则会抛出一个错误),他们将得到如下响应:</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="da9d" class="kr ks if mn b fv mr ms l mt mu">&gt; <strong class="mn ig">contract.then(c =&gt; c.getProposals.call())<br/></strong><em class="kd">[ 'What to eat for dinner', 'burgers', 'pizza' ]</em></span></pre><p id="e7fd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用仲裁人的地址，让我们选择一个赢家，用0代表汉堡，用1代表披萨。</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="bb8d" class="kr ks if mn b fv mr ms l mt mu">&gt; <strong class="mn ig">contract.then(c =&gt; c.selectWinner(1, {from: '<em class="kd">ARBITER_ADDRESS</em>'}))</strong></span></pre><p id="97bc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">仲裁人选出获胜者后，任何人都可以查阅获胜者的合同。</p><pre class="mi mj mk ml fq mm mn mo mp aw mq dt"><span id="45b0" class="kr ks if mn b fv mr ms l mt mu">&gt; <strong class="mn ig">contract.then(c =&gt; c.winningOpinion())<br/></strong><em class="kd">'pizza'</em></span></pre></div><div class="ab cl kk kl hc km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hn ho hp hq hr"><p id="08c0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们知道披萨会赢，但写这份合同仍然是理解以太坊的一次富有成效的练习。点击查看代码<a class="ae kh" href="https://github.com/captDaylight/arbitration-tutorial" rel="noopener ugc nofollow" target="_blank">！</a></p><figure class="mi mj mk ml fq hw"><div class="bz el l di"><div class="nf ng l"/></div></figure></div></div>    
</body>
</html>