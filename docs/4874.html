<html>
<head>
<title>Hiding feature from production — Laravel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从生产中隐藏特征Laravel</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/hiding-feature-from-production-laravel-8815bcb64359?source=collection_archive---------14-----------------------#2017-06-27">https://medium.com/hackernoon/hiding-feature-from-production-laravel-8815bcb64359?source=collection_archive---------14-----------------------#2017-06-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div class="fe ff hs"><img src="../Images/71ddb0b769f643fcab7fe5507e114343.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*ASA5nFv0V4hxAklZA-kBVg.png"/></div></figure><div class=""/><p id="754d" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我最近开始研究环境清理功能。目标很简单:从<strong class="ja ic"> Dev </strong>和<strong class="ja ic"> Stage </strong>数据库中删除数据。通常，根据客户的要求，他们的数据库的副本已经在某个地方制作完成，并且从未被移除。</p><p id="c990" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我不知道这是愚蠢的幼稚恐惧还是真正的担忧，但我担心有人会打开两个标签(production和dev ),并在错误的标签中错误地使用该功能。<a class="ae jw" href="https://about.gitlab.com/2017/02/01/gitlab-dot-com-database-incident/" rel="noopener ugc nofollow" target="_blank">您有没有看过最近在GitLab发生的事件？</a></p><p id="91c8" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja ic">长话短说</strong>:我开发了一个在生产中不会用到的功能，我就是这样做的:</p><h2 id="f61e" class="jx jy ib bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">1-路由服务提供商</h2><p id="77f2" class="pw-post-body-paragraph iy iz ib ja b jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr kw jt ju jv hn dt translated">在<code class="eh kx ky kz la b">RouteServiceProvider</code>的<code class="eh kx ky kz la b">map</code>中，如果我们没有生产，让我们注册一种新的路线。</p><pre class="lb lc ld le fq lf la lg lh aw li dt"><span id="d18c" class="jx jy ib la b fv lj lk l ll lm"><strong class="la ic">if </strong>(!$this-&gt;app-&gt;environment('production'))<br/>   $this-&gt;mapDevelopmentRoutes();</span></pre><p id="e7fe" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">接下来，为这种新类型的路由定义规则，例如文件名、控制器名称空间和前缀。</p><pre class="lb lc ld le fq lf la lg lh aw li dt"><span id="40aa" class="jx jy ib la b fv lj lk l ll lm"><em class="ln">/**<br/> * Define the "development" routes for the application.<br/> *<br/> * These routes all receive "web" middleware.<br/> *<br/> * </em><strong class="la ic"><em class="ln">@return </em></strong><em class="ln">void<br/> */<br/></em><strong class="la ic">protected function </strong>mapDevelopmentRoutes() {<br/>   Route::<em class="ln">middleware</em>(['web', 'auth'])<br/>      -&gt;namespace($this-&gt;namespace . '\Development')<br/>      -&gt;as('development.')<br/>      -&gt;prefix('development')<br/>      -&gt;group(base_path('routes/development.php'));<br/>}</span></pre><h2 id="364f" class="jx jy ib bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">2-路线/开发. php文件</h2><p id="1d21" class="pw-post-body-paragraph iy iz ib ja b jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr kw jt ju jv hn dt translated">除了展示一个真实的例子，这里没什么好说的。这是我注册的。</p><pre class="lb lc ld le fq lf la lg lh aw li dt"><span id="2e60" class="jx jy ib la b fv lj lk l ll lm"><strong class="la ic">&lt;?php<br/><br/>use </strong>Illuminate\Support\Facades\Route;<br/><br/>// These routes should only be available for development environment. RouteServiceProvider will make sure to only register these<br/>// in case the environment is not production.<br/><br/>Route::<em class="ln">get</em>('/redactor', 'RedactorController@index')-&gt;name('redactor.index');<br/>Route::<em class="ln">patch</em>('/redactor', 'RedactorController@redact')-&gt;name('redactor.redact');</span></pre><h2 id="e8f0" class="jx jy ib bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">3-[可选]视图编辑器</h2><p id="9f2b" class="pw-post-body-paragraph iy iz ib ja b jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr kw jt ju jv hn dt translated">我有一个为用户构建菜单项的<code class="eh kx ky kz la b">menu.blade.php</code>文件。我决定利用<em class="ln">la ravel View composer</em>来告诉这个组件是否显示只开发的特性。</p><pre class="lb lc ld le fq lf la lg lh aw li dt"><span id="fbb5" class="jx jy ib la b fv lj lk l ll lm"><strong class="la ic">@if(isset</strong>($development) &amp;&amp; $development<strong class="la ic">)<br/>    </strong>&lt;li&gt;<br/>        &lt;a href="{{route('development.redactor.index')}}"&gt;<br/>            &lt;i class="fa fa-eraser fa-fw"&gt;&lt;/i&gt;<br/>            {{ __('Redactor') }}<br/>            &lt;span class="pull-right text-muted" title="{{ __('Available for Dev only') }}"&gt;&lt;i class="fa fa-warning fa-fw"&gt;&lt;/i&gt;&lt;/span&gt;<br/>        &lt;/a&gt;<br/>    &lt;/li&gt;<br/><strong class="la ic">@endif</strong></span></pre><p id="f39d" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><code class="eh kx ky kz la b">DevelopmentComposer</code>文件只是将<code class="eh kx ky kz la b">development</code>设置为<code class="eh kx ky kz la b">true</code></p><pre class="lb lc ld le fq lf la lg lh aw li dt"><span id="d80f" class="jx jy ib la b fv lj lk l ll lm"><strong class="la ic">&lt;?php<br/><br/>namespace </strong>App\Http\ViewComposers;<br/><br/><strong class="la ic">use </strong>Illuminate\View\View;<br/><br/><strong class="la ic">class </strong>DevelopmentComposer <strong class="la ic">extends </strong>TenantComposer {<br/><br/>   <strong class="la ic">public function </strong>compose(View $view) {<br/>      <strong class="la ic">parent</strong>::<em class="ln">compose</em>($view);<br/><br/>      $view-&gt;with(['development' =&gt; <strong class="la ic">true</strong>]);<br/>   }<br/>}</span></pre><p id="acc8" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果环境不是生产环境，则<code class="eh kx ky kz la b">ComposerServiceProvider</code>将只注册<code class="eh kx ky kz la b">DevelopmentComposer</code></p><pre class="lb lc ld le fq lf la lg lh aw li dt"><span id="77f9" class="jx jy ib la b fv lj lk l ll lm"><strong class="la ic">if </strong>(!$this-&gt;app-&gt;environment('production'))<br/>   View::<em class="ln">composer</em>('layouts.development.menu', 'App\Http\ViewComposers\DevelopmentComposer');</span></pre><p id="68dd" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">是的，这可以与路线的映射一起设置在<code class="eh kx ky kz la b">RouteServiceProvider</code>中，但是我现在才意识到这一点(在撰写本文时)=</p><h1 id="d525" class="lo jy ib bd jz lp lq lr kd ls lt lu kh lv lw lx kk ly lz ma kn mb mc md kq me dt translated">结论</h1><p id="2ce6" class="pw-post-body-paragraph iy iz ib ja b jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr kw jt ju jv hn dt translated">上周，我编辑了大约20个数据库，在任务进行到一半时，我突发了一场小心脏病，我在想我是在生产还是在开发。然后我想起我已经确定这永远不会是一个问题。幸福的结局。</p><blockquote class="mf mg mh"><p id="9efb" class="iy iz ln ja b jb jc jd je jf jg jh ji mi jk jl jm mj jo jp jq mk js jt ju jv hn dt translated"><a class="ae jw" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客们开始他们下午的方式。我们是<a class="ae jw" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jw" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受提交</a>并很高兴<a class="ae jw" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>的机会。</p><p id="dca4" class="iy iz ln ja b jb jc jd je jf jg jh ji mi jk jl jm mj jo jp jq mk js jt ju jv hn dt translated">要了解更多信息，<a class="ae jw" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a> , <a class="ae jw" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">喜欢/在脸书给我们发消息</a>，或者简单地，<a class="ae jw" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank">发推文/DM @HackerNoon。</a></p><p id="708a" class="iy iz ln ja b jb jc jd je jf jg jh ji mi jk jl jm mj jo jp jq mk js jt ju jv hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jw" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jw" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote></div></div>    
</body>
</html>