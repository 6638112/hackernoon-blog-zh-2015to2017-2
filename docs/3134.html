<html>
<head>
<title>How to apply ACLs to loopback application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将ACL应用于环回应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-apply-acls-to-loopback-application-1871fb51cc21?source=collection_archive---------6-----------------------#2017-03-15">https://medium.com/hackernoon/how-to-apply-acls-to-loopback-application-1871fb51cc21?source=collection_archive---------6-----------------------#2017-03-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="f7f7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">无需提及每个人在应用程序开发中采用Node.js的速度有多快，而且这种情况仍在继续。</p><p id="0b58" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">根据stack overflow . com 2016年的调查，<a class="ae jp" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> Javascript </a>是与Node并列的最具趋势的技术。JS也越来越受欢迎。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/0cc48b696f981e997f066e9de1d92a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Suks5XG6uiB1N5C7KBci6g.png"/></div></div></figure><p id="edfd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，我们可以在以下网站https://siftery.com/<a class="ae jp" href="https://hackernoon.com/tagged/nodejs" rel="noopener ugc nofollow" target="_blank">nodejs</a>的统计数据中看到有多少客户在生产中使用Node.js。有很多巨头在他们的应用程序中使用Node.js，其中一些是:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff kc"><img src="../Images/057fd5043b28dcdc319b25c8430c571b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WW5VTRjlODIEHefa-bBb7A.png"/></div></div></figure><p id="08a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好奇他们用Node.js覆盖了哪些部分？这里有一个关于LinkedIn如何在他们的应用程序中使用Node.js的例子:</p><div class="kd ke fm fo kf kg"><a href="http://venturebeat.com/2011/08/16/linkedin-node/" rel="noopener  ugc nofollow" target="_blank"><div class="kh ab ej"><div class="ki ab kj cl cj kk"><h2 class="bd hv fv z el kl eo ep km er et ht dt translated">独家报道:LinkedIn如何使用Node.js和HTML5构建更好、更快的应用</h2><div class="kn l"><h3 class="bd b fv z el kl eo ep km er et ek translated">今天早上，LinkedIn发布了其华丽的移动应用程序。我们已经向您介绍了所有新功能…</h3></div><div class="ko l"><p class="bd b gc z el kl eo ep km er et ek translated">venturebeat.com</p></div></div><div class="kp l"><div class="kq l kr ks kt kp ku ka kg"/></div></div></a></div><p id="f6bb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然你会用Node.js开发很多包/工具，比如哈比神/Koa/Koa2/Express，但还有<a class="ae jp" href="https://github.com/strongloop/loopback" rel="noopener ugc nofollow" target="_blank"> Loopback </a>，它因其多样性和惊人的特性而越来越受欢迎。</p><p id="e576" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关于Loopback的一点信息是它是由IBM公司<a class="ae jp" href="https://github.com/strongloop" rel="noopener ugc nofollow" target="_blank"> Strongloop </a>的人创建的。它允许您立即创建强大灵活的API和模型。更不用说它有很棒的东西可以使用，即可用的<a class="ae jp" href="https://github.com/strongloop/loopback#connectors" rel="noopener ugc nofollow" target="_blank">连接器</a>和<a class="ae jp" href="https://github.com/strongloop/loopback#components" rel="noopener ugc nofollow" target="_blank">组件</a>。</p><p id="7a12" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">也就是说，现在让我们跳到ACL。</p><h1 id="b7c0" class="kv kw hu bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls dt translated">美国学术团体委员会</h1><blockquote class="lt"><p id="5552" class="lu lv hu bd lw lx ly lz ma mb mc jo ek translated">LoopBack使用访问控制列表(ACL)来控制谁可以访问哪些数据。</p></blockquote><p id="d76e" class="pw-post-body-paragraph ir is hu it b iu md iw ix iy me ja jb jc mf je jf jg mg ji jj jk mh jm jn jo hn dt translated">使用ACL，您可以限制对模型的数据访问，即您想要的api方法。其工作方式是Loopback使用两个集合，<strong class="it hv"> Role </strong>和<strong class="it hv"> RoleMapping。</strong>您也可以创建自定义角色，但有些角色是loopback自己提供的。即$everyone，$authenticated，$unauthenticated等。</p><p id="595c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设您有一个客户支持应用程序，它有以下模型:</p><ol class=""><li id="a6af" class="mi mj hu it b iu iv iy iz jc mk jg ml jk mm jo mn mo mp mq dt translated">AppUser(从用户扩展)</li><li id="1df2" class="mi mj hu it b iu mr iy ms jc mt jg mu jk mv jo mn mo mp mq dt translated">种类</li></ol><p id="cd4e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将创建一些自定义角色(在boot/script.js中):</p><pre class="jr js jt ju fq mw mx my mz aw na dt"><span id="8ceb" class="nb kw hu mx b fv nc nd l ne nf">// Assuming...<br/>// employeeUsers[] contains the employees<br/>// adminUsers[] contains the admins</span><span id="23f1" class="nb kw hu mx b fv ng nd l ne nf">Role.create({<br/>      name: 'admin'<br/>    }, <strong class="mx hv">function</strong>(err, role) {<br/>      <strong class="mx hv">if</strong> (err) cb(err);<br/><br/>      adminUsers.forEach(function(admin){<br/>          <em class="nh">//make bob an admin</em><br/>          role.principals.create({<br/>            principalType: RoleMapping.USER,<br/>            principalId: admin.id<br/>          }, <strong class="mx hv">function</strong>(err, principal) {<br/>              cb(err);<br/>          });<br/>      }); <br/>    });<br/>Role.create({<br/>      name: 'employee'<br/>    }, <strong class="mx hv">function</strong>(err, role) {<br/>      <strong class="mx hv">if</strong> (err) cb(err);<br/><br/>      <!-- -->employeeUsers<!-- -->.forEach(function(employee){<br/>          <em class="nh">//make bob an admin</em><br/>          role.principals.create({<br/>            principalType: RoleMapping.USER,<br/>            principalId: employee.id<br/>          }, <strong class="mx hv">function</strong>(err, principal) {<br/>              cb(err);<br/>          });<br/>      });<br/>    });</span></pre><p id="6896" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设我们有以下API:</p><ol class=""><li id="b87b" class="mi mj hu it b iu iv iy iz jc mk jg ml jk mm jo mn mo mp mq dt translated">获取类别=获取/API/类别</li><li id="00b1" class="mi mj hu it b iu mr iy ms jc mt jg mu jk mv jo mn mo mp mq dt translated">按id获取类别= GET /api/categories/:cat_id</li><li id="2917" class="mi mj hu it b iu mr iy ms jc mt jg mu jk mv jo mn mo mp mq dt translated">创建类别=帖子/API/类别</li></ol><p id="455a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们希望只有管理员可以访问“获取类别”调用，经过身份验证的用户(员工)应该访问“通过id获取类别”调用，但员工不应被允许<strong class="it hv">创建</strong>类别。所以这是我们要做的。我们将使用环回的生成器来创建一个ACL。</p><p id="23b6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，拒绝所有人访问类别api</p><pre class="jr js jt ju fq mw mx my mz aw na dt"><span id="480d" class="nb kw hu mx b fv nc nd l ne nf">$ lb acl</span><span id="5274" class="nb kw hu mx b fv ng nd l ne nf">? Select the model to apply the ACL entry to: Category<br/>? Select the ACL scope: All methods and properties<br/>? Select the access type: All (match all types)<br/>? Select the role: All users<br/>? Select the permission to apply: Explicitly deny access</span></pre><p id="71aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我们将允许管理员访问所有的类别api。</p><pre class="jr js jt ju fq mw mx my mz aw na dt"><span id="3318" class="nb kw hu mx b fv nc nd l ne nf">$ lb acl<br/><br/>? Select the model to apply the ACL entry to: Category<br/>? Select the ACL scope: All methods and properties<br/>? Select the role: other<br/>? Enter the role name : admin<br/>? Select the permission to apply: Explicitly grant access</span></pre><p id="8bbf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我们将只允许员工通过id呼叫访问该类别。</p><pre class="jr js jt ju fq mw mx my mz aw na dt"><span id="50e0" class="nb kw hu mx b fv nc nd l ne nf">$ lb acl</span><span id="26c9" class="nb kw hu mx b fv ng nd l ne nf">? Select the model to apply the ACL entry to: Category<br/>? Select the ACL scope: A single method<br/>? Enter the method name: findById<br/>? Select the role: other<br/>? Enter the role name : employee<br/>? Select the permission to apply: Explicitly grant access</span></pre><p id="4737" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">执行上述命令后，category.json中的ACL应该如下所示:</p><pre class="jr js jt ju fq mw mx my mz aw na dt"><span id="f837" class="nb kw hu mx b fv nc nd l ne nf">"acls": [<br/>  {<br/>    "accessType": "*",<br/>    "principalType": "ROLE",<br/>    "principalId": "$everyone",<br/>    "permission": "DENY"<br/>  },<br/>  <!-- -->{<br/>    "accessType": "*",<br/>    "principalType": "ROLE",<br/>    "principalId": "admin",<br/>    "permission": "ALLOW"<br/>  }<!-- -->,  {<br/>    "accessType": "EXECUTE",<br/>    "principalType": "ROLE",<br/>    "principalId": "employee",<br/>    "permission": "ALLOW",<br/>    "property": "findById"<br/>  }<br/>],</span></pre><h1 id="a866" class="kv kw hu bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls dt translated">结论</h1><p id="3b9d" class="pw-post-body-paragraph ir is hu it b iu ni iw ix iy nj ja jb jc nk je jf jg nl ji jj jk nm jm jn jo hn dt translated">关于ACLs实施的要点总结如下:</p><ol class=""><li id="550d" class="mi mj hu it b iu iv iy iz jc mk jg ml jk mm jo mn mo mp mq dt translated">在RoleMappings下映射用户和角色(下图)</li><li id="341f" class="mi mj hu it b iu mr iy ms jc mt jg mu jk mv jo mn mo mp mq dt translated">根据要求在模型中设置ACL</li></ol><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff nn"><img src="../Images/73dc4937e88bcf148b4893fcdc4d1fdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VkxVwUu-EJIQdJIrkeEwWw.png"/></div></div><figcaption class="no np fg fe ff nq nr bd b be z ek">RoleMappings containing principalId as userId, principleType as <code class="eh ns nt nu mx b">RoleMapping.USER ('User')</code></figcaption></figure><p id="f679" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">loopback让您处理ACL的方式非常巧妙。当我掌握了它的窍门时，我个人很喜欢它。</p><div class="jr js jt ju fq ab cb"><figure class="nv jv nw nx ny nz oa paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nv jv nw nx ny nz oa paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nv jv nw nx ny nz oa paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ob oc od"><p id="f922" class="ir is nh it b iu iv iw ix iy iz ja jb oe jd je jf of jh ji jj og jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is nh it b iu iv iw ix iy iz ja jb oe jd je jf of jh ji jj og jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff oh"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="oi oj l"/></div></figure></div></div>    
</body>
</html>