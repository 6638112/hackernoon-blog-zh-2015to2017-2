<html>
<head>
<title>Stop using .IO Domain Names for Production Traffic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止使用。生产流量的IO域名</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/stop-using-io-domain-names-for-production-traffic-b6aa17eeac20?source=collection_archive---------3-----------------------#2017-11-09">https://medium.com/hackernoon/stop-using-io-domain-names-for-production-traffic-b6aa17eeac20?source=collection_archive---------3-----------------------#2017-11-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/c629af3427de261b059d0fc9cfd9acdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*egB2Ew1TNoJvp7aeAA2u9Q.png"/></div></div></figure><p id="cb79" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ka">注意:如果你是</em> <a class="ae kb" href="https://getstream.io/" rel="noopener ugc nofollow" target="_blank"> <em class="ka"> Stream </em> </a> <em class="ka">的用户，请务必将你的API客户端更新到最新版本，以大幅提高可靠性。对于那些使用定制API客户端的人，看看我们更新的</em> <a class="ae kb" href="https://getstream.io/docs_rest/" rel="noopener ugc nofollow" target="_blank"> <em class="ka"> REST文档</em> </a> <em class="ka">。</em></p><p id="9944" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">域名解析是互联网的主干服务之一。这是我们通常很少花时间去思考的事情。当然，当它坏掉时，情况就变了。在过去的一年里，IO域中断是我们的客户无法使用<a class="ae kb" href="https://getstream.io/" rel="noopener ugc nofollow" target="_blank"> Stream </a>的首要原因。具体来说，2017年9月20日的停电是一个令人头疼的问题。本文将深入探讨。IO域名可靠性问题以及我们如何解决这些问题。</p><p id="e1bb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">互联网域名系统(DNS)的基础设施庞大而复杂。由于其分散性，如果问题出在您的DNS提供商或更广泛的DNS基础设施上，除了坐等问题解决，您别无选择。处理DNS中断的唯一可行的解决方案是回退到备份域。</p><p id="385e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这使得DNS服务中断相当严重。许多风险都很复杂，降低风险的成本也很高，在某些情况下，降低风险几乎是不可能的。</p><h1 id="5131" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">哪里出错了:全球停电。“io”顶级域</h1><p id="c87e" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">2017年9月20日，我们的系统监视器和健康检查开始显示间歇性故障。Pings我们的网站和API服务器无法将“getstream.io”记录解析为有效的主机名。</p><p id="88bb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要访问我们的核心API服务和仪表板，域名解析是必需的。没有它，客户就无法找到我们服务器的地址。不言而喻，这立即被归类为关键，并得到了我们团队的充分重视。</p><p id="5baa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">经过初步调查，我们发现解析任何getstream.io记录都会随机失败，并返回不正确的NXDOMAIN错误。随后，我们的一名工程师发现。6个权威的io域中有2个会持续失败。io名称服务器。其余四个运行正常，这解释了错误的明显随机性。</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="lj lk l"/></div></figure><p id="938b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一个坏的如下所示:</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="lj lk l"/></div></figure><p id="ac3f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">由于这发生在权威的域名服务器上，我们联系了我们的DNS提供商，然后也试图联系NIC.io。令我们惊讶的是，我们发现<strong class="je hv"> NIC.io只能在世界协调时周一到周五上午7点到12点之间通过电话联系，并且没有暴露任何关于服务健康状况的状态</strong>。</p><p id="ba3d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">与此同时，我们开始查看还有谁受到了这次宕机的影响，并在Twitter和<a class="ae kb" href="https://news.ycombinator.com/item?id=15293578" rel="noopener ugc nofollow" target="_blank">黑客新闻</a>上发布了相关消息。在等待中断结束时，我们还增加了DNS TTL，以便DNS查询的数量尽可能低。此后不久，我们收到了Gandi.net的回复，告知我们NIC.io正在修复这个问题。</p><p id="fab2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae kb" href="http://status.getstream.io/incidents/kgqqpz89lpr0" rel="noopener ugc nofollow" target="_blank">中断</a>持续了近2个小时，在此期间，对任何. getstream.io记录的DNS查询都有1/5会失败。对于摆在我们服务前面的东西来说，这是一个很大的问题，并对我们提出了很多问题。</p><h1 id="c09f" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">这难道不会发生在任何TLD身上吗？</h1><p id="ac05" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">我们明白了。有时候东西会坏掉。实际上，任何顶级域名都可能发生类似的中断。</p><p id="f22d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当我们在2014年开始时，我们决定。从品牌的角度来看，io很棒。<a class="ae kb" href="https://getstream.io/" rel="noopener ugc nofollow" target="_blank"> Stream </a>是一个技术产品，我们的受众主要是技术型的，所以。木卫一似乎是一个伟大的匹配。为API使用相同的域与其说是一个深思熟虑的决定，不如说是一个结果。</p><p id="62d7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">不可能估计…的可能性。com域名服务器与。io名称服务器。令我们惊讶的是，虽然大约20%的DNS解析。io域名完全被破坏，很难在Twitter上找到抱怨的人。事实上，我相信我们是第一批发微博的人之一。如果这一切都发生了。com域名，所有的新闻来源将已着火。</p><h1 id="bcf2" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">到底哪里出了问题</h1><p id="e9e1" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">不幸的是，我们发现NIC。IO没有配备管理顶级域名所需的技术支持和系统。在发生大停电时无法联系到他们是不可接受的。</p><p id="f0ae" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">进一步看，不需要很多研究就能发现。io TLD团队在过去几年里犯了几个错误。仅举几个例子:</p><ul class=""><li id="f1fe" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lq lr ls lt dt translated">一年前发生了几乎<a class="ae kb" href="https://news.ycombinator.com/item?id=12813065" rel="noopener ugc nofollow" target="_blank">相同的停机</a>(假阴性NXDOMAIN响应)。</li><li id="cf42" class="ll lm hu je b jf lu jj lv jn lw jr lx jv ly jz lq lr ls lt dt translated">2017年7月，谷歌的一名安全工程师能够<a class="ae kb" href="https://thehackerblog.com/the-io-error-taking-control-of-all-io-domains-with-a-targeted-registration/" rel="noopener ugc nofollow" target="_blank">购买一个权威域名服务器</a> (ns-a1.io)的域名，并获得每个域名的控制权。io域。</li></ul><p id="1d0e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正在搜索<a class="ae kb" href="https://hn.algolia.com/?query=io%20domain&amp;sort=byPopularity&amp;prefix&amp;page=0&amp;dateRange=all&amp;type=story" rel="noopener ugc nofollow" target="_blank">。HN上的io</a>返回一长串类似的中断。</p><h1 id="31a2" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">最好的即时解决方案是什么？</h1><p id="cb5c" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">添加一个. com域并在我们所有的API客户端上使用它作为缺省值显然是容易实现的。当然我们也会有同样的问题。然而，我们对. com背后的管理层更有信心。很明显，这个问题不仅可以更早地发现，而且人们也不会花几个小时来承认和补救这种情况。</p><h1 id="5eef" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">我们实现DNS无中断服务的路线图</h1><p id="6a9b" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">这些DNS问题让我们停下来思考DNS可能出现故障的所有方式。</p><ol class=""><li id="be73" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lz lr ls lt dt translated">我们失去了对自己领域的控制。这可能以多种方式发生:</li></ol><ul class=""><li id="36c8" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lq lr ls lt dt translated">NIC.io an决定<a class="ae kb" href="https://www.nic.io/terms.htm" rel="noopener ugc nofollow" target="_blank">取消我们的域名</a>。</li><li id="391f" class="ll lm hu je b jf lu jj lv jn lw jr lx jv ly jz lq lr ls lt dt translated">我们<a class="ae kb" href="https://www.theregister.co.uk/2017/07/26/marketo_forgot_to_renew_domain/" rel="noopener ugc nofollow" target="_blank">忘记</a>到<a class="ae kb" href="http://www.theregister.co.uk/2003/11/06/microsoft_forgets_to_renew_hotmail/" rel="noopener ugc nofollow" target="_blank">更新</a>域<a class="ae kb" href="https://nakedsecurity.sophos.com/2015/10/02/how-one-man-bought-google-com-for-just-12/" rel="noopener ugc nofollow" target="_blank"/>(哎呀)。</li></ul><ol class=""><li id="2efc" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lz lr ls lt dt translated"><strong class="je hv"> Route53停运。</strong>由于我们将getstream.io委托给Route53名称服务器，因此它们的名称服务器出现故障会中断我们的服务。从2016年开始的<a class="ae kb" href="https://dyn.com/blog/dyn-statement-on-10212016-ddos-attack/" rel="noopener ugc nofollow" target="_blank"> DynDNS </a> DDoS宕机就是一个例子。</li><li id="93bb" class="ll lm hu je b jf lu jj lv jn lw jr lx jv ly jz lz lr ls lt dt translated"><strong class="je hv">。TLD停电。</strong></li></ol><p id="31b8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为我们控制API客户端，所以实现故障转移机制很容易。设置和维护备份域和/或备份DNS提供商可能非常具有挑战性。在第一种情况下，我们需要保持数百个DNS记录同步，并加倍我们的SSL证书；其次，我们只需要改变我们的基础设施，不使用任何Route53特定功能。为此，我们需要在两个不同的提供商之间保持所有DNS记录同步，并确保我们不使用任何供应商特定的功能。作为AWS客户，这是一个重大挑战，因为DNS在许多方面都已深度集成。</p><p id="0782" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">展望未来，我们的计划是增加一个. org域名，并找到一个DNS提供商来管理域名服务器。</p><h1 id="70b8" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">结论</h1><p id="59f4" class="pw-post-body-paragraph jc jd hu je b jf la jh ji jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz hn dt translated">事后看来，为我们的核心API使用. IO域并不是一个好的选择。9月20日的停电显示了问题和支持基础设施有多严重。根据我们的经验，如果可用性很重要，我们建议不要使用. IO域名。</p><p id="3fc6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了解决DNS问题，Stream的API流量现在运行在. com域名上。该网站仍在运行。io，因为这更难改变，并且在正常运行时间方面不那么重要。为了进一步提高可靠性，我们正在考虑:</p><ul class=""><li id="e01e" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lq lr ls lt dt translated">添加备份。ORG域名。</li><li id="cb75" class="ll lm hu je b jf lu jj lv jn lw jr lx jv ly jz lq lr ls lt dt translated">将备份DNS提供程序用于。COM或者。ORG域名。</li><li id="66f5" class="ll lm hu je b jf lu jj lv jn lw jr lx jv ly jz lq lr ls lt dt translated">在我们的SDK中实现客户端DNS故障转移。</li></ul><p id="7349" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">DNS作为一个整体是最想当然的事情之一，但很容易导致严重的停机和麻烦。使用广泛使用的TLD。com/。net/。org是确保可靠性的最好也是最简单的方法。</p><blockquote class="ma mb mc"><p id="d5c4" class="jc jd ka je b jf jg jh ji jj jk jl jm md jo jp jq me js jt ju mf jw jx jy jz hn dt translated">这是GetStream.io团队的一次合作，由GetStream.io首席技术官<a class="ae kb" href="https://twitter.com/tommasobarbugli" rel="noopener ugc nofollow" target="_blank">托马索·巴布格利</a>领导。原始博文可在<a class="ae kb" href="https://getstream.io/blog/stop-using-io-domain-names-for-production-traffic/" rel="noopener ugc nofollow" target="_blank">https://getstream . io/blog/stop-using-io-domain-names-for-production-traffic/</a>找到。</p></blockquote></div></div>    
</body>
</html>