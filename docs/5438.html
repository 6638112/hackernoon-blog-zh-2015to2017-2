<html>
<head>
<title>The fifteen minute WebRTC demo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">十五分钟的WebRTC演示</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-fifteen-minute-webrtc-demo-3f5cf3a71fc4?source=collection_archive---------8-----------------------#2017-07-26">https://medium.com/hackernoon/the-fifteen-minute-webrtc-demo-3f5cf3a71fc4?source=collection_archive---------8-----------------------#2017-07-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4761" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">教程中总有一些类似“看看你能在15分钟内做些什么！”这是对WebRTC的<a class="ae jp" href="https://hackernoon.com/tagged/design" rel="noopener ugc nofollow" target="_blank">设计</a>的证明，这甚至是可能的:15分钟获得一个工作的对等演示是相当令人震惊的。总的来说，这些教程是合法的:你可以在不到一个小时的时间里得到一些非常棒的东西。</p><p id="127c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">也就是说，工作演示和准备生产的东西之间的差别是很大的。举个例子，</p><ul class=""><li id="7111" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">你打算支持什么浏览器？</li><li id="3568" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">它会部署在公司网络上吗？该解决方案必须处理代理和防火墙吗？</li><li id="3971" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">是1-1聊天，还是多方会议？</li><li id="6768" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">您将如何帮助用户配置他们的麦克风、扬声器和摄像头？</li><li id="07a9" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">你会支持iOS和Android客户端吗，可能通过一个原生应用？</li></ul><p id="7a62" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">…这些是…不是简单的问题。在最普通的情况下，每个人都在使用Chrome，这都是一对一的聊天，通常相当容易。但现实是，你可能会有一个末日产品经理(PMoD)坚持让你支持IE11、Safari、一堆手机，以及一个有2到10个同时聚会的房间。这就是事情变得…困难的地方。</p></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><p id="8330" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">先说浏览器。也许你很幸运，你的PMoD只想要Chrome。耶！跳到下一节。</p><p id="3a43" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者不是。他们想要IE11和Safari。这意味着:一个插件。你的选择是一些<a class="ae jp" href="https://github.com/sarandogou/webrtc-everywhere" rel="noopener ugc nofollow" target="_blank"> github项目，它们使用相当旧版本的WebRTC </a>、<a class="ae jp" href="https://skylink.io/plugin/" rel="noopener ugc nofollow" target="_blank"> pay Temasys </a>，或者推出你自己的邪恶开源软件联盟，比如<a class="ae jp" href="https://github.com/firebreath/FireBreath" rel="noopener ugc nofollow" target="_blank"> Firebreath </a>加<a class="ae jp" href="https://www.openwebrtc.org/" rel="noopener ugc nofollow" target="_blank"> OpenWebRTC </a>或<a class="ae jp" href="https://webrtc.org/native-code/" rel="noopener ugc nofollow" target="_blank"> Chrome的WebRTC实现</a>。</p><p id="36cb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这也可能意味着支持安装程序(可能同时支持Windows和OSX)，如果你包括H.264支持和双倍/四倍的QA工作，潜在的MPEG-LA许可问题，因为插件经常在一些相当关键的方面与本机实现不同。如果您选择自行开发的解决方案，您可能还会遇到其他有趣的事情，比如跨平台绘图模型。</p><p id="de24" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，即使有安装程序，在某些公司内部，用户甚至会被阻止安装。因此，您需要一种在这些公司内部部署和处理更新的方法。</p></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><p id="edd2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设您的PMoD主要想与财富500强公司一起使用您的产品。现在你的问题是:这些公司中的每一个都将有一些可怕的代理/防火墙基础设施，结合健康剂量的随机反病毒软件在本地运行，这将阻碍无缝部署你的产品的一切努力。</p><p id="20eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你绝对需要一个TURN服务器，比如<a class="ae jp" href="https://github.com/coturn/coturn" rel="noopener ugc nofollow" target="_blank"> coturn </a>，你绝对需要同时支持HTTP CONNECT和TCP 443，因为某些网络安全类型似乎不理解A)在HTTPS之外还有一个广阔的网络世界，B) UDP不是一种时尚。</p><p id="fff3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">即使有了TURN服务器和443访问，还是会有网络不合作。为此，你必须在这个庞大的公司里找到一些人，并说服他们允许你进入。美好时光。</p><p id="9732" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，你必须将这些服务器分散在世界各地，因为你的用户遍布全球。</p><p id="d89e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你开始在AWS中建立一个小型的服务器大军。</p></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><p id="daa0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您的PMoD还没有完成。现在，他们希望在同一个会议中有两个以上的人。问题是:当你将人加入会议时，你会遇到<a class="ae jp" href="http://mathworld.wolfram.com/HandshakeProblem.html" rel="noopener ugc nofollow" target="_blank">握手问题</a>。基本上，当您添加更多的人时，连接的数量将取决于:</p><figure class="km kn ko kp fq kq fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/e0d37375180dfa87fa619eeba3613585.png" data-original-src="https://miro.medium.com/v2/resize:fit:220/format:webp/1*jx2qkohdeaNEEJ_Je2FYeA.png"/></div></figure><p id="bf58" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以如果你有四个人，那就是4(4–1)/2，或者六个连接。去八突然意味着你有8(8–1)/2，或<em class="kt">二十八</em> <strong class="it hv"> <em class="kt"> </em> </strong>人脉。你的PMoD觉得十听起来不错；这使你处于<em class="kt"> 45个要建立的连接，最坏的情况</em>。</p><p id="3541" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">遗憾的是，这无法扩展。在十个人的情况下，房间里的每个人都必须将数据推送给其他九个参与者。大多数人缺乏上行带宽来做到这一点。你遇到了真正的问题。</p><p id="2c50" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那么我们如何解决这个问题呢？我们使用选择性转发单元(SFU)，多点控制单元(MCU)，或者你告诉你的PMoD他们在吸毒，你可以支持四个(也许五个？？)人们在一个P2P满网的厄运中:</p><figure class="km kn ko kp fq kq fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/4295f5637cc2b123ed3ee90b9d6762f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*z3FBc7OcHh_hjhP8sgnndA.png"/></div></figure><p id="6bec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当然，你突然需要基础设施——大量的基础设施，而且在某些服务器死亡的情况下可能是多余的。该服务器需要坚如磐石，因为它是会议的单点故障。您可能需要在世界各地部署它，因为澳大利亚的用户试图连接到您在美国东部的媒体服务器时会有严重的延迟。这个基础设施必须与你的TURN服务器协同工作。你需要决定是选择SFU还是MCU，两者都有明显的权衡。</p></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><p id="f416" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你的PMoD给你发了一封疯狂的邮件；首席执行官试用了该产品，她的摄像头工作不正常，她听不到其他人的声音。原来是扬声器被关掉了，摄像头在用Skype。这也证明了这是你的问题。</p><p id="39ff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你需要为人们提供枚举、配置和测试他们的硬件的方法。这很糟糕，原因有很多:</p><ul class=""><li id="9188" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">Windows在应用程序之间的共享方面有点糟糕。例如:摄像机归Skype所有。Chrome未能获得摄像头。</li><li id="0d26" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">Windows真的不擅长管理音频设备。你有默认的麦克风，但你也有默认的通信设备，似乎没有人能很好地理解这一点，因为在某些基本层面上这是不可理解的。</li><li id="f47d" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">高级用户总是想要配置他们的扬声器输出。他们希望通过他们的耳机，而不是通过他们的电脑扬声器(咄)，所以必须能够配置。</li><li id="f330" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">但是Firefox不允许这样做。没有适合您的扬声器配置。</li><li id="5af4" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">而火狐的getUserMedia实现简直是疯了。每次你请求访问麦克风和摄像头时，它都会弹出一个权限提示。多谢了，火狐。</li><li id="4b66" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">这提醒了我:上帝禁止在Chrome或Firefox中意外拒绝权限提示的用户。那是支持电话。克拉普。</li><li id="6531" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">哦，还有，你的财富500强客户一直在安装Chrome/Firefox，而摄像头和麦克风被管理员禁用了。非常感谢各位。谢谢你所做的一切。</li></ul><p id="1554" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">…您还需要一些方法来测量麦克风强度，确定视频流是合法的，并允许用户正确配置他们的扬声器。对于一个严肃的项目来说，这些都不是细节；它们对现实世界中的实际成功至关重要。</p><p id="19c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后是各种各样的垃圾:静音音频/视频，允许人们在会议中交换硬件，为人们提供调试设备的工具，等等。</p></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><p id="08c5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">PMoD不理解他们为什么不能用iOS。没问题，你说。我只需将一些WebRTC库移植到移动设备上，创建一个本机应用程序，实现我们最终选择的SFU/MCU解决方案所需的所有信号，瞧，完成了。小菜一碟！</p><p id="aea1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">哦，然后我会从头再做一遍，但对于Android。</p><p id="399b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这需要对SDP提供/回答交换、涓流冰、DTLS协商、本地代码等方面有深入的了解。你的项目持续了三个月。它还将您与您选择的一些SFU/MCU紧密耦合，因为信令不是WebRTC标准的一部分。</p><p id="a808" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">…那该死的15分钟演示。看看它给你带来了什么。</p></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><p id="bc81" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我不应该抱怨。我真的没有抱怨。过去，这需要一个相当大的团队(团队？？)的工程师来推出这样的解决方案。现在，有了WebRTC，让一个小团队管理一个公司的所有基础设施是完全可能的。</p><p id="cbfe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它不适合胆小的人——你需要一些媒体和网络专家，一些有SIP/SDP经验的人可以拯救你，一些面对一些不虔诚的本机代码无所畏惧的人。但这是合理的。</p><p id="ca74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">小心15分钟的演示。</p><figure class="km kn ko kp fq kq"><div class="bz el l di"><div class="kv kw l"/></div></figure></div></div>    
</body>
</html>