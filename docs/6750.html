<html>
<head>
<title>The highs and lows of using Lerna to manage your JavaScript projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Lerna管理JavaScript项目的优势和劣势</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-highs-and-lows-of-using-lerna-to-manage-your-javascript-projects-ff5c5cd82a99?source=collection_archive---------1-----------------------#2017-10-03">https://medium.com/hackernoon/the-highs-and-lows-of-using-lerna-to-manage-your-javascript-projects-ff5c5cd82a99?source=collection_archive---------1-----------------------#2017-10-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/09ac096751f047b4b0c1b32d05fd127d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJ3usVPNW83hftjs7V-dvA.jpeg"/></div></div></figure><div class=""/><p id="6669" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">概述、难点、亮点和提示</p><p id="48d8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Lerna是一个用多个包管理大规模<a class="ae ka" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>项目的<a class="ae ka" href="https://hackernoon.com/tagged/managing" rel="noopener ugc nofollow" target="_blank">工具。</a></p><p id="fd38" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">任何参与过由粒度组件或依赖项组成的大型项目的人都知道，过一段时间后对您的工作进行更新会变得很麻烦。在2017年的JavaScript世界中，我们到处都在导入包，Lerna正在帮助我们管理我们在Yoox NET-A-PORTER的大项目。</p><h2 id="ed4d" class="kb kc if bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated">谁在用Lerna？</h2><ul class=""><li id="7cc2" class="kw kx if je b jf ky jj kz jn la jr lb jv lc jz ld le lf lg dt translated">巴贝利斯</li><li id="f241" class="kw kx if je b jf lh jj li jn lj jr lk jv ll jz ld le lf lg dt translated">创建-反应-应用</li><li id="5e1c" class="kw kx if je b jf lh jj li jn lj jr lk jv ll jz ld le lf lg dt translated">反应路由器</li><li id="a4ca" class="kw kx if je b jf lh jj li jn lj jr lk jv ll jz ld le lf lg dt translated">玩笑</li><li id="77c0" class="kw kx if je b jf lh jj li jn lj jr lk jv ll jz ld le lf lg dt translated"><a class="ae ka" href="https://lernajs.io/#users" rel="noopener ugc nofollow" target="_blank">还有很多很多更多</a></li></ul></div><div class="ab cl lm ln hc lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hn ho hp hq hr"><h2 id="bc90" class="kb kc if bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated">它真正的作用&amp;为什么它很棒</h2><p id="7b5a" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn lt jp jq jr lu jt ju jv lv jx jy jz hn dt translated">让我们从一个例子开始。</p><p id="3af2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">假设您有一个带有按钮组件的React应用程序——这个按钮组件需要使用一个文本组件(粒度很细，但只是为了举例方便):</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="bc55" class="kb kc if mb b fv mf mg l mh mi">// inside the <!-- -->super-button<!-- --> NPM package + repo</span><span id="014f" class="kb kc if mb b fv mj mg l mh mi">import SuperText from 'super-text'</span><span id="5e54" class="kb kc if mb b fv mj mg l mh mi">const SuperButton = props =&gt; (<br/>  &lt;button&gt;<br/>    &lt;SuperText value="Click me!" /&gt;<br/>  &lt;/button&gt;<br/>)</span><span id="4f68" class="kb kc if mb b fv mj mg l mh mi">export default SuperButton</span><span id="4e10" class="kb kc if mb b fv mj mg l mh mi"><br/>// inside the <!-- -->super-text<!-- --> NPM package + repo</span><span id="a191" class="kb kc if mb b fv mj mg l mh mi">const SuperText = props =&gt; (<br/>  &lt;span&gt;<br/>    {props.value}<br/>  &lt;/span&gt;<br/>)</span><span id="3a70" class="kb kc if mb b fv mj mg l mh mi">export default SuperText</span></pre><p id="24f2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这些组件中的每一个都存在于它们自己的回购协议中，并且是它们自己的NPM包——它们需要由20多个开发人员来维护、版本化和工作。</p><p id="62d4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">假设我们有一个使用这两个组件的应用程序——如果我们想更新这两个组件作为特性的一部分，那么我们必须对每个组件进行更改，更新测试，更新版本，提交更改，让他们接受代码审查，发布包，更新使用它们的应用程序——唷。</p><p id="ac8d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">但是等等！</strong>您刚刚意识到您的更改与需求略有不同，并且/或者它没有按预期工作——让我们假设这些组件要复杂得多，或者可能涉及复杂的样式等。您将不得不再次重做整个过程——如果您的团队很忙，也许他们不会抽出时间来审查代码，也许您将在接下来的2个小时内被阻止，并且不得不求助于阅读中型文章，直到他们解除对您的阻止！</p><p id="d888" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Lerna来救援了！ Lerna让你把你的应用构建成一个非常大的包和应用库(都可以重命名和配置)；这些应用程序是消费者，包是粒度依赖(上面的超级按钮&amp;超级文本)。当您完成所有需要的更改后，您可以执行一个命令:</p><p id="2db5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mk ml mm mb b">$ lerna run bootstrap</code></p><p id="0b7b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这将遍历您的所有应用程序(在我们自己命名的<code class="eh mk ml mm mb b">apps</code>文件夹中),并通过使用各自的包名(和版本)将每个应用程序依赖项符号链接到在<code class="eh mk ml mm mb b">packages</code>中找到的任何本地版本。)在<code class="eh mk ml mm mb b">package.json</code>。任何在<code class="eh mk ml mm mb b">packages</code>中找不到的都将简单地从npm中安装，无论如何都是一样的。</p><p id="496c" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是巨大的——它允许大规模重构、更新和特性<strong class="je ig"> </strong>丰富，而没有<em class="mn">开发人员过程头痛</em>。对您的依赖项进行更改，引导、检查并在您的消费者应用中实施它们，您就大功告成了！保存拉取请求，直到一切就绪。</p></div><div class="ab cl lm ln hc lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hn ho hp hq hr"><h2 id="2ea5" class="kb kc if bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated">为什么它会令人讨厌&amp;如何减轻痛苦</h2><p id="be45" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn lt jp jq jr lu jt ju jv lv jx jy jz hn dt translated">听起来很棒，对吧？我们最初是这样想的，后来我们在移植我们的大型应用程序时遇到了一些麻烦——我们基本上解决了所有这些问题:</p><ul class=""><li id="f61b" class="kw kx if je b jf jg jj jk jn mo jr mp jv mq jz ld le lf lg dt translated"><strong class="je ig">如果每个应用程序都有很多依赖项，引导会花费很长时间。</strong> 2017年的web开发通常意味着你有500多个依赖于运行你的应用程序的各种各样的包——无论是构建步骤、编译、捆绑、可重用的组件，还是简单地用<em class="mn"> left-pad </em>你的字符串。<br/>通过将应用程序&amp;包之间的所有共享依赖关系移动到一个根<code class="eh mk ml mm mb b">package.json</code>文件中，并在引导命令中指定<code class="eh mk ml mm mb b">--hoist</code>标志，来缓解这一问题。虽然还需要一段时间，但会大大缩短时间。</li><li id="c101" class="kw kx if je b jf lh jj li jn lj jr lk jv ll jz ld le lf lg dt translated"><strong class="je ig">测试运行时间很长，并且失去语法高亮。</strong><br/><code class="eh mk ml mm mb b">$ lerna run test</code>命令遍历每个包并运行在<code class="eh mk ml mm mb b">package.json</code>中声明的测试脚本——这里的问题是它将为它找到的每个实例生成一个测试运行程序——在我们的例子中，我们有大约60个实例，它们耗尽了我们的笔记本电脑。这也意味着我们的语法突出显示(通过/失败/警告等)被忽略了，因为测试运行是在单独的shell进程中产生的。<br/>通过从根级别运行测试运行程序来解决这个问题，在那里有一个配置文件来指定在哪个目录中查找测试——我们使用jest，配置文件使这一切变得非常容易。我们的测试从大约2m运行到大约15s，我们的颜色编码恢复了！</li><li id="38f4" class="kw kx if je b jf lh jj li jn lj jr lk jv ll jz ld le lf lg dt translated"><strong class="je ig">与一家大型回购公司合作的方式。我们仍在逐步解决这个问题，这将取决于您的项目、团队结构和需求——如果您正在构建一个由可重用的原子组件组成的大型共享平台，您有时会问自己“谁拥有这个平台？”通常答案是<em class="mn">每个人</em> <em class="mn">都应该</em>但是事情并不总是那样发展，这是另一篇博文的话题。</strong></li></ul></div><div class="ab cl lm ln hc lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hn ho hp hq hr"><p id="41b8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们仍在适应雷纳，这是一条充满挫折的崎岖之路，但最终会得到最好的解决。这对我们的项目很有帮助，也可能对你的项目有帮助。</p><h2 id="548f" class="kb kc if bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated">想了解更多关于Lerna的知识？</h2><p id="f966" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn lt jp jq jr lu jt ju jv lv jx jy jz hn dt translated">查看<a class="ae ka" href="https://lernajs.io/" rel="noopener ugc nofollow" target="_blank">官方网站</a>或查看<a class="ae ka" href="https://github.com/lerna/lerna" rel="noopener ugc nofollow" target="_blank"> github页面</a></p><p id="4796" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mn">喜欢我的漫谈吗？在</em> <a class="ae ka" href="https://twitter.com/_ChrisGreg" rel="noopener ugc nofollow" target="_blank"> <em class="mn"> twitter </em> </a> <em class="mn">上关注我，在我的</em> <a class="ae ka" href="http://chrisgregori.co.uk/" rel="noopener ugc nofollow" target="_blank"> <em class="mn">个人网站</em> </a> <em class="mn">上了解更多我的开发故事或关注我的业余项目。💻</em></p><figure class="lw lx ly lz fq hw"><div class="bz el l di"><div class="mr ms l"/></div></figure></div></div>    
</body>
</html>