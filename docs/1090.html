<html>
<head>
<title>Generating Code Coverage with PHPUnit and phpdbg</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用PHPUnit和phpdbg生成代码覆盖率</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/generating-code-coverage-with-phpunite-and-phpdbg-4d20347ffb45?source=collection_archive---------0-----------------------#2016-09-05">https://medium.com/hackernoon/generating-code-coverage-with-phpunite-and-phpdbg-4d20347ffb45?source=collection_archive---------0-----------------------#2016-09-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="d43c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在之前的一篇文章中，我解释了如何识别执行时间过长的测试。在这篇文章中，我将展示如何使用<a class="ae jp" href="https://hackernoon.com/tagged/phpunit" rel="noopener ugc nofollow" target="_blank"> PHPUnit </a>来提高代码覆盖报告生成的性能。</p><p id="ca4d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在phpunit.xml文件中，可以添加配置来生成与正在执行的测试相关的报告。例如:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><p id="12e2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将创建一个名为“tests/_reports”的目录，其中包含一系列有用的信息。在coverage-html目录中，我们可以看到有助于分析的代码测试覆盖细节。clover.xml文件只是由Jenkins、CodeCov、Coveralls、Codacy等服务处理的相同信息的另一个版本，用于自动化警报和脚本。</p><p id="a693" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">除了更改phpunit.xml文件之外，为了生成这些信息，我们还需要安装扩展XDebug。然而，通过安装它，我们得到了性能的实质性下降。检查测试执行结果，但不生成报告:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><p id="46b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，当我们添加XDebug并再次执行它时，我们得到:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><p id="cb9e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">执行时间从1.08分钟跳到了22.26分钟！</p><p id="2019" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在网上做了一些研究后，我找到了<a class="ae jp" href="http://blog.remirepo.net/post/2015/11/09/PHPUnit-code-coverage-benchmark" rel="noopener ugc nofollow" target="_blank">的这个帖子</a>，并决定尝试一下<a class="ae jp" href="https://hackernoon.com/tagged/phpdbg" rel="noopener ugc nofollow" target="_blank"> phpdbg </a>。</p><p id="36b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为我在这个测试中使用的是MacOS X，所以我执行了下面的命令来安装所有必要的依赖项。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><p id="2a00" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">主要区别在于php7安装中使用的参数–with-phpdbg。</p><p id="8f4d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过跟随PHPUnit的创建者塞巴斯蒂安·博格曼的这篇文章，我找到了再次运行测试的语法:</p><p id="99ac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jx"> phpdbg -qrr。/vendor/bin/phpunit </em></p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><p id="71e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.59分钟比XDebug的22.26分钟要好得多。</p><p id="fc5c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在写这篇文章之前，我兴奋地发了以下微博:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff jy"><img src="../Images/17dc243fa6ff34fda42b7c51bad0a7cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*yt6WOmIOoX-zhXj9CMZ_gw.png"/></div></figure><p id="a72d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你看一下评论，吴镇男·雷瑟斯不是别人，正是XDebug的创造者！考虑到他的评论，我比较了XDebug和phpdbg生成的结果。</p><p id="5320" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是XDebug(左)和phpdbg(右)生成的coverage-html的对比。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kb"><img src="../Images/61d6fd3134c7f72bef867706f430e408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2uSBGtThJ3b742BBnzWSlQ.png"/></div></div></figure><p id="d023" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，我使用CodeCov处理clover.xml文件，结果也略有不同:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kb"><img src="../Images/bfb85fd9ecec7adcf64698265bc8bfde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tkv3BQKyav1mFgCZ696wtQ.png"/></div></div><figcaption class="kg kh fg fe ff ki kj bd b be z ek">phpdbg</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kb"><img src="../Images/99972b80c87582fbe65bf7b21eb3798a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bvCV0rV3281osMvS33vpfw.png"/></div></div><figcaption class="kg kh fg fe ff ki kj bd b be z ek">XDebug</figcaption></figure><p id="f531" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">根据phpdbg生成的报告，Planrockr拥有66.05%的代码覆盖率。XDebug的报告显示代码覆盖率为65.92%</p><p id="6545" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我从这个小测试中得出一些结论:</p><ul class=""><li id="6858" class="kk kl hu it b iu iv iy iz jc km jg kn jk ko jo kp kq kr ks dt translated">XDebug是一个不可思议的工具，它不仅仅是生成代码覆盖率，所以我并不是说你应该停止使用它。我只是比较它众多功能中的一个。</li><li id="5c9b" class="kk kl hu it b iu kt iy ku jc kv jg kw jk kx jo kp kq kr ks dt translated">我比较了默认结果，没有对XDebug或phpdbg的配置进行任何调整，因此其他场景可能会有不同的结果。</li><li id="fe3a" class="kk kl hu it b iu kt iy ku jc kv jg kw jk kx jo kp kq kr ks dt translated">虽然这两个结果略有不同，但在我的例子中，由于phpdbg的性能更好，所以使用phpdbg确实是一种补偿。</li></ul><p id="ca5a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我会继续使用phpdbg一段时间，如果我碰巧看到任何不同的结果，我会更新这篇文章或写另一篇关于体验的文章。</p><p id="f644" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你认为我的结论是错误的，请不要犹豫联系我让我知道。</p><blockquote class="ky kz la"><p id="5040" class="ir is jx it b iu iv iw ix iy iz ja jb lb jd je jf lc jh ji jj ld jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is jx it b iu iv iw ix iy iz ja jb lb jd je jf lc jh ji jj ld jl jm jn jo hn dt translated">要了解更多信息，请<a class="ae jp" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">阅读我们的“关于”页面</a>、<a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上点赞/给我们发消息</a>，或者简单地说，<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is jx it b iu iv iw ix iy iz ja jb lb jd je jf lc jh ji jj ld jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="le jw l"/></div></figure></div></div>    
</body>
</html>