<html>
<head>
<title>Integrate React.js in a Rails application — the simple way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将React.js集成到Rails应用程序中——简单的方法</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/integrate-react-js-in-a-rails-application-the-simple-way-1fe04ad83f6e?source=collection_archive---------0-----------------------#2015-08-21">https://medium.com/hackernoon/integrate-react-js-in-a-rails-application-the-simple-way-1fe04ad83f6e?source=collection_archive---------0-----------------------#2015-08-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="a7c8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">React是一个构建客户端javascript应用程序的伟大框架。与其他客户端框架相比，它只负责MVC中的V。将它与jQuery或backbone.js一起使用非常容易。</p><p id="a41c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在过去的几个月里，围绕react发布了一些很棒的东西，比如<a class="ae jp" href="https://facebook.github.io/react-native/" rel="noopener ugc nofollow" target="_blank"> react native </a>、<a class="ae jp" href="http://facebook.github.io/react/blog/2015/08/11/relay-technical-preview.html" rel="noopener ugc nofollow" target="_blank"> relay </a>、<a class="ae jp" href="https://github.com/facebook/graphql" rel="noopener ugc nofollow" target="_blank"> graphql </a>。React推动整个javascript生态系统使用新工具，编写更好的代码，并重新思考最佳实践。</p><p id="c034" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">与客户端javascript相关的新标准之一是使用<a class="ae jp" href="http://requirejs.org/docs/commonjs.html" rel="noopener ugc nofollow" target="_blank"> CommonJS </a>模块。CommonJS包括以一种安全和明确的方式管理依赖关系，使得模块可以要求其他模块，就像任何真正的编程语言一样。唯一的问题是浏览器不支持开箱即用。有几个工具可以解决这个问题，包括<a class="ae jp" href="http://requirejs.org/" rel="noopener ugc nofollow" target="_blank">requires</a>、<a class="ae jp" href="http://browserify.org/" rel="noopener ugc nofollow" target="_blank"> browserify </a>和最近的w <a class="ae jp" href="https://github.com/webpack/webpack" rel="noopener ugc nofollow" target="_blank"> ebpack </a>。</p><p id="1dce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Browserify可以作为一个独立的工具链来构建一个js应用程序(不需要使用gulp或grunt)。一个很好的例子是脸书通量<a class="ae jp" href="https://github.com/facebook/flux/tree/master/examples/flux-todomvc" rel="noopener ugc nofollow" target="_blank"> Todo MVC样本代码</a>。Browserify基本上是在react应用程序之外创建一个<em class="jq"> bundle.js </em>文件，然后您可以将<em class="jq"> bundle.js </em>包含在您的index.html页面中。</p></div><div class="ab cl jr js hc jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hn ho hp hq hr"><p id="56a7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Ruby on rails使用资产管道以自己的方式管理javascripts。资产管道是一项伟大的技术，因为您可以使用coffeescript编写模块化的javascripts。它可以预编译你的文件用于生产，等等。</p><p id="6a29" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不过，资产管道有两个主要缺点:</p><ol class=""><li id="124e" class="jy jz hu it b iu iv iy iz jc ka jg kb jk kc jo kd ke kf kg dt translated"><strong class="it hv">基本不可能在rails </strong>之外使用。例如，每次我试图使用sinatra开发一个独立的基于资产的ruby应用程序，30分钟后我就创建了一个rails应用程序，并且只使用资产管道。这是一个大问题，因为除了ruby on rails之外，没有人能使用这项技术，所以它永远不会成为前端开发的标准技术。</li><li id="b3bd" class="jy jz hu it b iu kh iy ki jc kj jg kk jk kl jo kd ke kf kg dt translated"><strong class="it hv">与commonJs模块</strong>不兼容。资产管道有另一种方式<em class="jq">需要</em>模块，这是相当强大的，但是每当你在npm上找到一个好的模块，你不能npm安装它并在你的rails应用程序中使用它。</li></ol><h1 id="9e5b" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">铁路</h1><p id="55da" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">有两种常见的方法允许您在rails中使用react:</p><ol class=""><li id="3336" class="jy jz hu it b iu iv iy iz jc ka jg kb jk kc jo kd ke kf kg dt translated"><strong class="it hv">铁轨道</strong>。2014年，<a class="ae jp" href="https://twitter.com/bigardone" rel="noopener ugc nofollow" target="_blank"> @bigardone </a>在<a class="ae jp" href="http://codeloveandboards.com/blog/2014/08/24/rails-and-react-i-a-happy-medium/" rel="noopener ugc nofollow" target="_blank">系列博客文章</a>中对此进行了大量记录。他解释了如何使用<em class="jq"> react_rails </em> gem，如何用JSX + CoffeeScript编码，猜猜会发生什么？有用！<a class="ae jp" href="https://github.com/reactjs/react-rails" rel="noopener ugc nofollow" target="_blank"> react_rails </a> gem的最大好处是它允许你从erb实例化组件，并从ruby对象传递属性。这种方法的主要问题是它不能用于npm模块。</li><li id="5dfd" class="jy jz hu it b iu kh iy ki jc kj jg kk jk kl jo kd ke kf kg dt translated"><strong class="it hv">Rails+browserify方式</strong>:为了和npm模块一起使用react，你需要一个browser ify这样的工具。<a class="ae jp" href="https://github.com/browserify-rails/browserify-rails" rel="noopener ugc nofollow" target="_blank"> browserify-rails </a> gem允许您在标准rails资产中要求()模块。react的完整方法在本文中有很好的记录，作者是<a class="ae jp" href="https://twitter.com/olance" rel="noopener ugc nofollow" target="_blank"> @olance </a>。这种方法在理论上很棒，但是它假设在编译您的资产时已经安装了<em class="jq"> browserify </em>。例如，如果您将应用程序部署到heroku，或者使用heroku buildpacks，情况就不一样了。因此，使用这种技术意味着要么为部署定制一个构建步骤，要么在部署之前预编译您的资产。您可能不希望这样做，尤其是如果您在现有项目中包含react，而该项目的资产在部署期间是预编译的，并且您不希望在短期内对此进行更改。</li></ol><h1 id="6fae" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">简单的方法</h1><p id="0d22" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">在我看来，上面描述的方法有很大的缺点，尽管它们确实允许您在rails应用程序中执行一些react代码。我们可以采用的另一种方法是在开发中使用browserify和一个标准的<em class="jq"> package.json </em>文件，并让它在您的rails资产中输出一个<em class="jq"> bundle.js </em>文件:</p><ol class=""><li id="026f" class="jy jz hu it b iu iv iy iz jc ka jg kb jk kc jo kd ke kf kg dt translated">首先创建一个简单的<em class="jq">包. json </em>，包括react、<em class="jq"> browserify </em>和<em class="jq"> reactify </em>，如下所示:</li></ol><figure class="lp lq lr ls fq lt"><div class="bz el l di"><div class="lu lv l"/></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">The devDependencies part can be created incrementally with npm install — save-dev some_library, whereas the dependencies par can be updated using — save option.</figcaption></figure><p id="acc5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.如果你使用的是turbolinks，你可能会在head标签中包含<em class="jq"> application.js </em>，这对react来说不是很好。例如，您可以在<em class="jq">/app/assets/JavaScript s/react/application . js</em>中创建一个新的js文件，并使它像下面这样简单:</p><figure class="lp lq lr ls fq lt"><div class="bz el l di"><div class="lu lv l"/></div></figure><p id="fdca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.不要忘记通过编辑<em class="jq"> /config/application.rb </em>将其添加到您的预编译文件中</p><figure class="lp lq lr ls fq lt"><div class="bz el l di"><div class="lu lv l"/></div></figure><p id="cf0b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">4.然后，您可以像普通javascript一样在任何erb视图中引用这个新文件:</p><figure class="lp lq lr ls fq lt"><div class="bz el l di"><div class="lu lv l"/></div></figure><p id="48fe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">5.更新你的<em class="jq">。gitignore </em>。您应该忽略<em class="jq"> node_modules </em>目录，因为它不会部署到生产中。你应该<strong class="it hv">不要</strong>忽略<em class="jq">/app/assets/JavaScript s/react/bundle . js</em>，因为你希望它被部署到生产中。</p><p id="9bc5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">6.运行<em class="jq"> npm start </em>运行react应用程序</p><p id="ebba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">额外的构建步骤？然后，您可以运行<em class="jq"> npm start </em>，使用<a class="ae jp" href="https://github.com/substack/watchify" rel="noopener ugc nofollow" target="_blank"> watchify </a>实时更新react应用程序，您的js文件将在您的rails应用程序中更新。资产管道将负责缩小您的文件，这样您就不必添加额外的步骤来构建用于生产的文件。</p><h1 id="3446" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">结论</h1><p id="fb32" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">这种方法的有趣之处在于，它向您的rails应用程序添加了一个新的<em class="jq"> js </em>文件，而不需要您进行供应商浏览或出售您的npm模块。您可以在应用程序的其余部分继续使用jquery和turbolinks(因为您正在一些erb视图的底部加载新的<em class="jq"> js </em>文件)。这让你<a class="ae jp" href="https://www.youtube.com/watch?v=BF58ZJ1ZQxY" rel="noopener ugc nofollow" target="_blank">不必重写整个应用</a>并在你的rails应用的一小部分上引入react。</p><p id="7e1a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另一个好处是，如果您不处理react部分，您就不必运行<em class="jq"> npm start </em>。相反，如果您在react部分工作，您将需要运行<em class="jq"> npm start </em>来查看您的更改在开发时的效果，而不需要额外的部署步骤。因此，在部署到生产环境之前，不可能忘记构建这个javascript。</p></div></div>    
</body>
</html>