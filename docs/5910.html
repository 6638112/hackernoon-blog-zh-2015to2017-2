<html>
<head>
<title>Continuous deployment for your Node.js projects in 10 minutes with Exoframe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Exoframe在10分钟内完成Node.js项目的持续部署</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/continuous-deployment-for-your-node-js-projects-in-10-minutes-with-exoframe-bdf48340c1be?source=collection_archive---------8-----------------------#2017-08-23">https://medium.com/hackernoon/continuous-deployment-for-your-node-js-projects-in-10-minutes-with-exoframe-bdf48340c1be?source=collection_archive---------8-----------------------#2017-08-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="9375" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为您的项目设置连续部署可能非常棘手。Puppet、Ansible、Chef——所有这些工具都很棒，但有时您只是想要一些小而简单的工具来将您喜欢的项目部署到您的虚拟或专用服务器上。<br/>我想向你展示如何使用<a class="ae jp" href="https://github.com/exoframejs/exoframe" rel="noopener ugc nofollow" target="_blank"> Exoframe </a>在大约10分钟内为你的Node.js项目设置持续部署，包括滚动更新、HTTPS和所有那些花哨的东西。</p><p id="f44d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">出于演示的目的，我们将基于Express.js部署简单的Node.js项目，你可以在GitHub repo中找到源代码(以及所有其他提到的部分):<a class="ae jp" href="https://github.com/exoframejs/node-cd-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/exoframejs/node-cd-demo</a></p><p id="4e8f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你更喜欢视频格式而不是阅读，你可以在这里看我做整个演练:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><h1 id="0d2d" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">准备服务器</h1><p id="2e7c" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">在开始之前，您显然需要一台服务器。如果你已经有了一个——太棒了。如果没有，就在<a class="ae jp" href="https://www.hetzner.com/?country=ot" rel="noopener ugc nofollow" target="_blank">Hetzner</a>/<a class="ae jp" href="https://www.digitalocean.com/" rel="noopener ugc nofollow" target="_blank">DO</a>/<a class="ae jp" href="https://www.vultr.com/" rel="noopener ugc nofollow" target="_blank">Vultr</a>或任何你喜欢的旅馆买一个。</p><p id="7f8f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦您用您喜欢的操作系统设置了服务器，您将需要<a class="ae jp" href="https://www.digitalocean.com/community/tutorials/how-to-configure-ssh-key-based-authentication-on-a-linux-server" rel="noopener ugc nofollow" target="_blank">配置公钥SSH认证</a>。<br/>这是必需的，因为Exoframe使用私有-公共密钥对进行认证过程。<br/>如果您使用登录密码对进行SSH认证，我强烈建议切换到<a class="ae jp" href="https://security.stackexchange.com/questions/69407/why-is-using-an-ssh-key-more-secure-than-using-passwords" rel="noopener ugc nofollow" target="_blank">公钥-私钥方法</a>。<br/>还要注意链接文章中关于在完成公钥认证部分后禁用密码认证的部分——在我看来，这也是必须的。</p><p id="1006" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你完成了这些——你需要<a class="ae jp" href="https://docs.docker.com/engine/installation/" rel="noopener ugc nofollow" target="_blank">安装Docker </a>,因为Exoframe依赖它来执行和管理服务。完成docker后，启动<a class="ae jp" href="https://github.com/exoframejs/exoframe-server" rel="noopener ugc nofollow" target="_blank"> Exoframe服务器</a>只需执行以下命令:</p><pre class="jq jr js jt fq la lb lc ld aw le dt"><span id="85f1" class="lf jy hu lb b fv lg lh l li lj">docker run -d \<br/>  -v /var/run/docker.sock:/var/run/docker.sock \<br/>  -v /path/to/exoframe-folder:/root/.exoframe \<br/>  -v /home/user/.ssh/authorized_keys:/root/.ssh/authorized_keys:ro \<br/>  -e EXO_PRIVATE_KEY=your_private_key \<br/>  --label traefik.backend=exoframe-server \<br/>  --label traefik.frontend.rule=Host:exoframe.your-host.com \<br/>  --name exoframe-server \<br/>  exoframe/server</span></pre><p id="513b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">确保更改参数以适应您的服务器，您至少希望:</p><ol class=""><li id="27d1" class="lk ll hu it b iu iv iy iz jc lm jg ln jk lo jo lp lq lr ls dt translated">将<code class="eh lt lu lv lb b">EXO_PRIVATE_KEY</code>设置为独特的东西。它在身份验证令牌的生成过程中使用。</li><li id="41e1" class="lk ll hu it b iu lw iy lx jc ly jg lz jk ma jo lp lq lr ls dt translated">设置<code class="eh lt lu lv lb b">--label traefik.frontend.rule=Host:exoframe.your-host.com</code>指向您的主机。它用于公开Exoframe服务器API端点。</li></ol><p id="f02d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="mb">重要提示</em>:这也将启动一个<a class="ae jp" href="https://traefik.io/" rel="noopener ugc nofollow" target="_blank"> Traefik </a>实例，它将占用端口80和443。它用于将请求路由到您部署的服务，设置HTTPS等。</p><p id="7b72" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有关这些参数和启动程序的更多详细说明，请参见Exoframe server GitHub资源库中的<a class="ae jp" href="https://github.com/exoframejs/exoframe-server#installation-and-usage" rel="noopener ugc nofollow" target="_blank">文档。</a></p><h1 id="bc2b" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">从CLI测试部署</h1><p id="b354" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">在配置连续部署之前，我们需要确保Exoframe服务器工作正常。<br/>为此，我们将在本地安装Exoframe CLI，并手动部署我们的项目，看看是否可行。<br/>目前，Exoframe CLI仅在节点8+上工作，因为它依赖于async/await，所以请确保您安装了最新的节点。要在本地安装Exoframe CLI，只需执行:</p><pre class="jq jr js jt fq la lb lc ld aw le dt"><span id="adb2" class="lf jy hu lb b fv lg lh l li lj">npm install exoframe -g</span></pre><p id="2337" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们已经安装了它，我们需要将它指向我们的新服务器。您可以通过执行以下命令来实现这一点:</p><pre class="jq jr js jt fq la lb lc ld aw le dt"><span id="0021" class="lf jy hu lb b fv lg lh l li lj">exoframe endpoint http://you.server.url</span></pre><p id="5dd2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">完成后，您将需要通过运行以下命令登录到您的服务器，并选择用于与您的服务器进行身份验证的私钥(并可能输入您的私钥的密码):</p><pre class="jq jr js jt fq la lb lc ld aw le dt"><span id="fdd7" class="lf jy hu lb b fv lg lh l li lj">exoframe login</span></pre><p id="36c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">成功登录后，您可以部署您的项目。但是在部署之前，我们将做最后一件事—生成一个新的项目配置文件。这可以通过在项目文件夹中执行以下命令来完成:</p><pre class="jq jr js jt fq la lb lc ld aw le dt"><span id="12ad" class="lf jy hu lb b fv lg lh l li lj">exoframe config</span></pre><p id="e954" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该命令将以交互方式引导您完成配置创建。对于这个演示，唯一重要的字段是“域”。</p><p id="3347" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="mb">重要提示</em>:由于Exoframe不知道Node.js项目的入口点是什么，它将简单地在部署时执行<code class="eh lt lu lv lb b">npm start</code>，并期望服务监听端口80。所以，确保你的<code class="eh lt lu lv lb b">package.json</code>中有<code class="eh lt lu lv lb b">start</code>脚本，并使用端口80！</p><p id="65cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦为您的新部署设置了所需的域，您就可以通过在项目文件夹中运行以下命令来部署项目:</p><pre class="jq jr js jt fq la lb lc ld aw le dt"><span id="e484" class="lf jy hu lb b fv lg lh l li lj">exoframe</span></pre><p id="ba73" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Exoframe CLI报告项目已经部署后，您应该在配置步骤中输入的域上测试它的可用性。<br/>如果一切按预期运行——我们准备好设置连续交付了！</p><h1 id="c913" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">使用Travis-CI配置连续交付</h1><p id="223e" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">我们将使用Travis-CI来测试和部署我们的项目。<br/>下面是Node.js项目的一个简单的<code class="eh lt lu lv lb b">.travis.yml</code>配置:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div></figure><p id="d2c3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Travis为我们做了测试Node.js项目的大部分工作，所以我们在这里需要关心的是指定语言和Node.js版本。你可以在官方Travis-CI文档中了解更多信息。</p><p id="059d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们已经有了Travis配置文件，并且我们已经确保它能够工作，我们需要向它添加Exoframe部署。<br/> Exoframe有一个名为“部署令牌”的特殊功能，允许您将项目部署到您的服务器，而无需使用您的私钥登录。因此，要设置部署，我们首先需要生成这样的令牌。这可以通过执行以下命令轻松完成:</p><pre class="jq jr js jt fq la lb lc ld aw le dt"><span id="e5d1" class="lf jy hu lb b fv lg lh l li lj">exoframe token</span></pre><p id="5d7e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在执行时，您应该得到一个新生成的令牌，它可以用来将项目部署到当前的Exoframe服务器。</p><p id="2d90" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="mb">重要提示</em>:一定要保存好令牌，因为无法再次读取，只能生成一个新的。</p><p id="6679" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦有了令牌，您需要使用<a class="ae jp" href="https://docs.travis-ci.com/user/encryption-keys/" rel="noopener ugc nofollow" target="_blank"> Travis-CI加密系统</a>将加密的令牌存储在您的Travis配置中，如下所示:</p><pre class="jq jr js jt fq la lb lc ld aw le dt"><span id="949a" class="lf jy hu lb b fv lg lh l li lj">travis encrypt EXO_TOKEN="your-token-here"</span></pre><p id="81fb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">之后，您需要调整配置本身，以便在运行测试之前安装Exoframe CLI，并在测试成功后触发部署。<br/>配置文件应该是这样的:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mc jw l"/></div></figure><p id="0750" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在您将它推送到GitHub之后，您应该能够打开Travis日志并看到您的项目被部署到您的服务器上。</p><h2 id="d836" class="lf jy hu bd jz md me mf kd mg mh mi kh jc mj mk kl jg ml mm kp jk mn mo kt mp dt translated">额外收获:滚动更新</h2><p id="5cc1" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">注意上面配置中微小的<code class="eh lt lu lv lb b">-u</code>标志。这告诉Exoframe服务器为当前部署执行滚动更新。<br/>它的工作方式非常简单——它将部署新版本，等待它启动，然后拆除旧版本，这将实现零停机部署。</p><h2 id="1a98" class="lf jy hu bd jz md me mf kd mg mh mi kh jc mj mk kl jg ml mm kp jk mn mo kt mp dt translated">额外奖励:其他项目类型</h2><p id="859d" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">Exoframe还支持其他项目类型！<br/>目前，除了Node.js项目，还可以部署静态HTML项目、Docker项目和Docker-Compose项目。</p><h1 id="cab9" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">试试看！</h1><p id="75da" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">如果你觉得Exoframe有趣——试试吧！<br/>GitHub上现在已经有<a class="ae jp" href="https://github.com/exoframejs/exoframe" rel="noopener ugc nofollow" target="_blank">了。<br/>一如既往——感谢您的任何反馈和贡献。</a></p></div></div>    
</body>
</html>