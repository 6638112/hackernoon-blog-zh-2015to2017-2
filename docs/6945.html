<html>
<head>
<title>Challenge: Program without variables #javascript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">挑战:没有变量的程序#javascript</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/challenge-program-without-variables-javascript-bee89a41455e?source=collection_archive---------3-----------------------#2017-10-11">https://medium.com/hackernoon/challenge-program-without-variables-javascript-bee89a41455e?source=collection_archive---------3-----------------------#2017-10-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/69b21b8ae19f9f1eeaa6db5b81b0310a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ghPN6u1X_XLEjXVDnQwazA.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae jg" href="https://pixabay.com/en/labyrinth-wood-play-ball-red-fun-1738039/" rel="noopener ugc nofollow" target="_blank">Labrinth — Alexas_Fotos</a></figcaption></figure><p id="e14e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">挑战在于创建一个没有任何变量的软件(一些真实的、有形的东西，而不仅仅是一个hello world)。</p><p id="6523" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这个想法来自萨梅尔·布纳的一篇文章。对此，我(开玩笑地)回应道，尝试“无变量编码”。</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="kl km l"/></div></figure><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="kl km l"/></div></figure><p id="0fd9" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我计划创建一个希望图书馆。我受到了Trey Huffine的一篇文章的启发<a class="kf kg gr" href="https://medium.com/u/47e700e59e44?source=post_page-----bee89a41455e--------------------------------" rel="noopener" target="_blank">，</a><a class="ae jg" rel="noopener" href="/gitconnected/understand-javascript-promises-by-building-a-promise-from-scratch-84c0fd855720">通过从零开始建立承诺来学习JavaScript承诺</a>。</p><p id="0983" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我相信承诺简单到足以理解代码，也复杂到足以成为挑战。</p><h1 id="496f" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">警告！</h1><p id="5344" class="pw-post-body-paragraph jh ji hu jj b jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka lp kc kd ke hn dt translated">如果我把编写干净的代码比作环法自行车赛，<em class="lq">这段代码不是那段</em>。这个代码会比X-Games小轮车自由泳大空气更好。你将会看到几个双后空翻和360度转体，但是当你骑上你的自行车时，最好让所有的轮子都在路上。孩子们，不要在家里或工作中尝试这个。</p><p id="48d4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">话虽如此(<em class="lq">如果你允许自己</em>)从这段代码中可以学到很多东西，我鼓励你创建自己的游戏场，看看你能变得多么极端和怪异。在边缘，你会发现最有趣的事情。</p><h1 id="2f2b" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">规则</h1><ul class=""><li id="30ac" class="lr ls hu jj b jk ll jo lm js lt jw lu ka lv ke lw lx ly lz dt translated">不允许的关键字:<code class="eh ma mb mc md b">var</code>、<code class="eh ma mb mc md b">let</code>、<code class="eh ma mb mc md b">const</code>、<code class="eh ma mb mc md b">import</code>、<code class="eh ma mb mc md b">class</code>。不使用<code class="eh ma mb mc md b">if</code>或<code class="eh ma mb mc md b">switch</code>或<code class="eh ma mb mc md b">function</code>关键词的加分。</li><li id="fbf5" class="lr ls hu jj b jk me jo mf js mg jw mh ka mi ke lw lx ly lz dt translated">只要遵守所有规则，图书馆是允许的。</li><li id="1955" class="lr ls hu jj b jk me jo mf js mg jw mh ka mi ke lw lx ly lz dt translated">可以创建新库，但必须遵循所有规则。</li><li id="eb85" class="lr ls hu jj b jk me jo mf js mg jw mh ka mi ke lw lx ly lz dt translated">库必须足够通用，可以在任何项目中使用，并且不能替代所创建代码的业务逻辑。</li><li id="9110" class="lr ls hu jj b jk me jo mf js mg jw mh ka mi ke lw lx ly lz dt translated">测试是不必要的。但是如果你选择写测试，它们就不受规则的约束。</li></ul><h1 id="7515" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">开始吧！</h1><h1 id="69d8" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">TimeDivisionDuplex 时分双工</h1><p id="204e" class="pw-post-body-paragraph jh ji hu jj b jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka lp kc kd ke hn dt translated">Promise库非常复杂，当我对代码进行修改时，我希望确保这些修改不会破坏之前工作的任何东西。所以我将首先写出我所有的测试。这很容易，因为node已经包含了一个Promise库，所以我将首先针对它编写我的测试。</p><p id="666a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">一个区别是，我不打算创建任何类，因为我发现JavaScript 中不需要类。因此，您可以不用创建承诺的典型代码:<code class="eh ma mb mc md b">new Promise((resolve, reject))</code>，而只使用<code class="eh ma mb mc md b">XPromise((resolve, reject)),</code>，不使用<code class="eh ma mb mc md b">new</code>关键字。</p><p id="b3aa" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae jg" href="https://gist.github.com/joelnet/29c273cb83a3ec2b290eaaf8f18d77f0" rel="noopener ugc nofollow" target="_blank"> XPromise.tests.js </a></p><h1 id="fdd8" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">从界面开始</h1><p id="c55d" class="pw-post-body-paragraph jh ji hu jj b jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka lp kc kd ke hn dt translated">我马上面临一项具有挑战性的任务。类似于A+ Promise实现，我希望能够使用<code class="eh ma mb mc md b">XPromise((resolve, reject) =&gt; …)</code>、<code class="eh ma mb mc md b">Promise.resolve(…)</code>和<code class="eh ma mb mc md b">Promise.reject(…)</code>创建一个承诺。所以<code class="eh ma mb mc md b">XPromise</code>需要是一个函数，还要有2个属性(<code class="eh ma mb mc md b">resolve</code>和<code class="eh ma mb mc md b">reject</code>)，也是函数。</p><p id="ca68" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">通常这不需要太多思考，但是由于规则的原因，我不能这样做:</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="mj km l"/></div></figure><p id="8c56" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">通过使用<code class="eh ma mb mc md b">Object.assign</code>将<code class="eh ma mb mc md b">resolve</code>和<code class="eh ma mb mc md b">reject</code>附加到主函数，是时候发挥创造力了。</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="mj km l"/></div></figure><p id="3a2f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">到目前为止，我对此相当满意。也就是说，直到我意识到<code class="eh ma mb mc md b">resolve</code>和<code class="eh ma mb mc md b">reject</code>是助手函数，最终需要指向主<code class="eh ma mb mc md b">XPromise</code>函数，现在没有对它的引用😦</p><h1 id="256c" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">创建没有变量的引用<strong class="ak"/></h1><p id="fbc9" class="pw-post-body-paragraph jh ji hu jj b jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka lp kc kd ke hn dt translated"><code class="eh ma mb mc md b">XPromise</code>也需要返回一个包含<code class="eh ma mb mc md b">then</code>和<code class="eh ma mb mc md b">catch</code>两个函数的对象。这些函数必须调用原始的<code class="eh ma mb mc md b">XPromise</code>函数，它(再次)不再被引用。</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="mj km l"/></div></figure><p id="b380" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">所以…我需要弄清楚如何创建一个异步的，递归的，匿名的函数，否则这整个事情将会失败。废话。</p><h2 id="f701" class="mk ko hu bd kp ml mm mn kt mo mp mq kx js mr ms lb jw mt mu lf ka mv mw lj mx dt translated">是时候推出组合子了</h2><p id="82c2" class="pw-post-body-paragraph jh ji hu jj b jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka lp kc kd ke hn dt translated">说到匿名递归函数，脑海中立刻浮现出著名的Y组合子。这就是Y组合子的目的。但是，Y组合子并不是我们唯一可以使用的组合子。对于这个任务，我决定使用不太为人所知但更简单的U Combinator。</p><p id="607e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我喜欢U Combinator，因为它容易记忆。</p><pre class="kh ki kj kk fq my md mz na aw nb dt"><span id="a121" class="mk ko hu md b fv nc nd l ne nf">f =&gt; f(f)</span></pre><p id="9638" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">就是这样！U Combinator将一个函数作为参数，然后将该函数传递给自身。现在你的函数的第一个参数就是你的函数。如果这听起来令人困惑，那是因为它令人困惑。不要担心，在代码中会更容易看到。</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="mj km l"/></div></figure><p id="082a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">注意零件<code class="eh ma mb mc md b">sayHello =&gt; () =&gt; 'hello'</code>以及<code class="eh ma mb mc md b">sayHello</code>和<code class="eh ma mb mc md b">UsayHello</code>的相同之处。</p><p id="e94a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在让我们用递归来试试。</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="mj km l"/></div></figure><p id="70d4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">完美！这正是我们需要的！现在是时候把它塞进项目里了。</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="mj km l"/></div></figure><p id="e851" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">好了，这是承诺的基本框架。我们有自己的主函数<code class="eh ma mb mc md b">XPromise</code>，辅助函数<code class="eh ma mb mc md b">resolve</code>和<code class="eh ma mb mc md b">reject</code>。<code class="eh ma mb mc md b">XPromise</code>取一个函数，包含<code class="eh ma mb mc md b">resolve</code>和<code class="eh ma mb mc md b">reject</code>。该函数还返回一个包含函数<code class="eh ma mb mc md b">then</code>和<code class="eh ma mb mc md b">catch</code>的对象。</p><p id="fed3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以看到，我还使用了一个立即调用的函数表达式，使U Combinator可以用作<code class="eh ma mb mc md b">U</code>参数。</p><p id="2389" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在和我在一起吧，最糟糕的已经过去了！如果我没有跟丢你，并且还在跟踪你……请放心，在本文的剩余部分，我们将会沿着山坡向下滑行！😃</p><h1 id="ae73" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated"><strong class="ak">存储状态</strong></h1><p id="09e1" class="pw-post-body-paragraph jh ji hu jj b jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka lp kc kd ke hn dt translated">像其他应用程序一样，这个应用程序必须存储某种状态。这将是来自<code class="eh ma mb mc md b">resolve</code>、<code class="eh ma mb mc md b">reject</code>的值和/或来自<code class="eh ma mb mc md b">then</code>和<code class="eh ma mb mc md b">catch</code>的函数。一般来说，这可以用好的“旧变量”来完成。不过，我们也可以使用默认参数来完成同样的事情。这也将带来额外的好处，能够调用该函数，并为它植入一个新的状态！剧透一下，我们正准备这么做！</p><p id="20a9" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">BTW，这是Redux的绝佳案例！</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="mj km l"/></div></figure><h1 id="73b1" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated"><strong class="ak">将块转换成表达式</strong></h1><p id="f698" class="pw-post-body-paragraph jh ji hu jj b jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka lp kc kd ke hn dt translated">我<em class="lq">更喜欢用<strong class="jj hv">表达式</strong> <em class="lq"> </em>编码</em>而不是<strong class="jj hv">块</strong>。这只是我的一个偏好。<code class="eh ma mb mc md b">if</code>语句和<code class="eh ma mb mc md b">try/catch</code>包含块，所以我要做一个替换。我还喜欢使用<strong class="jj hv">逗号运算符</strong>来组合多个表达式，您将在下面看到。</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="mj km l"/></div></figure><p id="d0cd" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">是啊，这样好多了！😀</p><p id="ac76" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我想清理一下那个<code class="eh ma mb mc md b">try/catch</code>。</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="mj km l"/></div></figure><h1 id="ec30" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated"><strong class="ak">快进&gt; &gt; </strong></h1><p id="7f18" class="pw-post-body-paragraph jh ji hu jj b jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka lp kc kd ke hn dt translated">这篇文章是关于在不使用变量的情况下编写软件的挑战。这篇文章不是关于如何创建一个承诺库。所以为了节省时间，让我们跳过无聊的废话，直接填空。</p><figure class="kh ki kj kk fq iv"><div class="bz el l di"><div class="mj km l"/></div></figure><p id="a427" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">好吧，它在那里，在所有的荣耀；一个没有单个<code class="eh ma mb mc md b">const</code>、<code class="eh ma mb mc md b">let</code>或<code class="eh ma mb mc md b">var</code>的无极库。</p><p id="8a76" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">看看这个…我所有的测试都通过了！😁</p><figure class="kh ki kj kk fq iv fe ff paragraph-image"><div class="fe ff ng"><img src="../Images/2c573ca283a6ca319424c3204dfb1aea.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*PrS873p1HpAD8LqybNxYgQ.png"/></div></figure><p id="7f8e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">源代码@<a class="ae jg" href="https://github.com/joelnet/XPromise" rel="noopener ugc nofollow" target="_blank">https://github.com/joelnet/XPromise</a></p><h1 id="f32b" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">赛后总结</h1><p id="77ca" class="pw-post-body-paragraph jh ji hu jj b jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka lp kc kd ke hn dt translated">这个挑战比我想象的要困难(耗时)得多。不一定是因为限制，而是因为<strong class="jj hv">创建一个Promise库比我预期的要复杂得多</strong>。承诺可以被同步/异步调用，也可以不被同步/异步调用，可以有也可以没有resolve值、reject值、then resolver和/或catch resolver。这是64种可能的状态！很明显我没有足够的测试。</p><p id="97d0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我终于有了U Combinator的合法用例，这真是太棒了。</p><p id="a38e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Medium不擅长写代码博客，为每个小片段创建一个要点对我来说是一件痛苦的事情😦</p><p id="959b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我有点喜欢这个图书馆的样子。整个事情最终变成了一个单一的表达。</p><h1 id="2127" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">我给你的信息</h1><p id="3fc1" class="pw-post-body-paragraph jh ji hu jj b jk ll jm jn jo lm jq jr js ln ju jv jw lo jy jz ka lp kc kd ke hn dt translated">我知道这变得很复杂，不要觉得你必须100%理解它。我只希望你觉得它很有趣。我希望这篇文章里有你以前没见过的东西。我希望我让您对自己探索代码感到好奇！</p><p id="2d17" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你会如何完成挑战？你会做出同样的选择吗？你喜欢什么？你会有什么不同的做法？我会❤️听听你的想法！</p><p id="a870" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这里关注我，推特<a class="ae jg" href="https://twitter.com/joelnet" rel="noopener ugc nofollow" target="_blank"> @joelnet </a>，<a class="ae jg" href="https://www.linkedin.com/in/joel-thoms/" rel="noopener ugc nofollow" target="_blank">链接进来</a>，它让我开心…当我开心的时候我会写更多！</p><p id="da1c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在此继续阅读:</p><div class="nh ni fm fo nj nk"><a href="https://medium.com/@joelthoms/latest" rel="noopener follow" target="_blank"><div class="nl ab ej"><div class="nm ab nn cl cj no"><h2 class="bd hv fv z el np eo ep nq er et ht dt translated">乔尔·托马斯写的最新故事</h2><div class="nr l"><h3 class="bd b fv z el np eo ep nq er et ek translated">阅读乔尔·托马斯在Medium上写的最新故事。计算机科学家和技术传播者，拥有20多年的…</h3></div><div class="ns l"><p class="bd b gc z el np eo ep nq er et ek translated">medium.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ja nk"/></div></div></a></div></div></div>    
</body>
</html>