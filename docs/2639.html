<html>
<head>
<title>Selenium testing: a new hope</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">硒测试:新的希望</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/selenium-testing-a-new-hope-a00649cdb100?source=collection_archive---------5-----------------------#2017-02-08">https://medium.com/hackernoon/selenium-testing-a-new-hope-a00649cdb100?source=collection_archive---------5-----------------------#2017-02-08</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><h1 id="7cae" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">第二部分。减肥和去集装箱。</h1><p id="9db8" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">在第一部分中，我讲述了无需编写任何代码就能构建可伸缩<a class="ae kn" href="https://hackernoon.com/tagged/selenium" rel="noopener ugc nofollow" target="_blank"> Selenium </a>集群的简单方法。在这一部分，我们将深入探讨更微妙的硒问题:</p><ol class=""><li id="0593" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km kv kw kx ky dt translated">如何使用标准Selenium hub准备易于扩展的工作节点</li><li id="44f8" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">为什么可以甚至推荐在容器中运行大多数浏览器，以及如何做到这一点</li><li id="35b8" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">有哪些现成的开源工具</li></ol><h1 id="f1cd" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">工作节点内部有什么</h1><p id="888f" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">第一部分中描述的所有新的<a class="ae kn" href="https://hackernoon.com/tagged/tools" rel="noopener ugc nofollow" target="_blank">工具</a>实际上都是智能瘦代理，将用户请求重定向到真正的Selenium Hub和节点。然而，当你想到更多的问题时:</p><ul class=""><li id="913d" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km le kw kx ky dt translated">如何安排集线器和节点以有效消耗硬件资源并保持可伸缩性？</li><li id="451d" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km le kw kx ky dt translated">使用哪个操作系统？</li><li id="eae0" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km le kw kx ky dt translated">应该安装哪个软件？</li><li id="bec8" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km le kw kx ky dt translated">没有真实显示器我们能工作吗？</li></ul><p id="00de" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">人们可以尝试使用具有一个Selenium Hub和许多用于不同浏览器的Selenium节点的硬件服务器。看似合理，但实际上毫无用处:</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff li"><img src="../Images/1f77cea14887caa18daae6e89f2bb804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZvEY71LhSu8Sqd6F9t-4Ww.png"/></div></div></figure><ol class=""><li id="5f8d" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km kv kw kx ky dt translated">正如我前面说过的，Selenium hub在加载大量节点时会变得非常慢。不确定实际原因，但这是我们的经验所显示的。一个建议——如果你希望睡觉时没有噩梦，睡觉时不要看Selenium源代码。所以我们不能在同一个hub上使用几十个Selenium节点。然后，让我们只使用几个节点和一个集线器。为了保持效率，我们需要减少每个集线器的CPU核心总数——这是迁移到云的一个很好的理由。例如，我们的安装在很长一段时间内都是使用只有2个VCPUs和4gb RAM的小型虚拟机。</li><li id="bd8f" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">不清楚如何简单地安装同一浏览器的不同版本(例如，使用二进制软件包)。</li><li id="6920" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">不清楚如何轻松计算每个浏览器版本的总量。</li><li id="9502" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">不同的Selenium节点版本兼容不同的浏览器版本。例如，较新的Selenium节点不能支持相对较旧的浏览器版本。</li></ol><p id="7b76" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">始终将相同数量的节点连接到同一个hub的最简单方法是在同一个虚拟机上启动hub和节点。如果每个浏览器版本使用一台机器，那么计算可用浏览器的总数就成了小学的任务。您可以轻松地添加和删除包含Selenium节点和浏览器兼容版本的虚拟机。这是我们在云中使用Selenium集群时的建议，每个版本都有静态数量。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff lu"><img src="../Images/b7d0b3f2ebd3cf98fda630bdd6936fb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vMlyU78RsfPJWVTpk3NcwQ.png"/></div></div></figure><p id="6371" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">但是，除了Selenium Hub和Selenium Node之外，这样的虚拟机内部还应该存在什么才能顺利工作呢？</p><ul class=""><li id="ef32" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km le kw kx ky dt translated">首先，我们建议尽可能使用Linux作为基础操作系统。有了Linux，你可以满足80%的浏览器需求。列举未涵盖的内容更简单:</li></ul><ol class=""><li id="c2d2" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km kv kw kx ky dt translated">Internet Explorer和Microsoft Edge。这些只能在Microsoft Windows中运行，将在另一篇文章中讨论。因为从未有过如此悲伤的故事。</li><li id="354f" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">桌面Safari。有人在用吗？Selenium对这个浏览器的支持相当差。</li><li id="1841" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">iOS和真正的苹果设备。你需要使用苹果的硬件，比如MacMini和<a class="ae kn" href="http://github.com/appium/appium/" rel="noopener ugc nofollow" target="_blank"> Appium </a>来配合它们工作。</li></ol><ul class=""><li id="a540" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km le kw kx ky dt translated">要运行标准的Selenium，您需要安装Java (JDK或JRE)并提供所需版本的Selenium JAR。</li><li id="bc55" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km le kw kx ky dt translated">虚拟机没有真正的显示器，所以您需要在特定的X服务器上启动Selenium node，它可以在没有显示器的情况下工作。这样的实现被称为<a class="ae kn" href="https://www.x.org/releases/X11R7.6/doc/man/man1/Xvfb.1.xhtml" rel="noopener ugc nofollow" target="_blank"> Xvfb </a>。这可以通过以下方式完成:</li></ul><pre class="lj lk ll lm fq lv lw lx ly aw lz dt"><span id="a809" class="ma is hu lw b fv mb mc l md me">xvfb-run -l -a -s '-screen 0 1600x1200x24 -noreset' java -jar \  selenium-server-standalone.jar -role node &lt;...other args&gt;</span></pre><p id="646a" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">请注意，Xvfb仅用于Selenium节点进程。</p><ul class=""><li id="0e4d" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km le kw kx ky dt translated">你可能还想安装额外的字体包，如<a class="ae kn" href="http://askubuntu.com/questions/578057/installation-of-fonts-in-ubuntu-14-04" rel="noopener ugc nofollow" target="_blank">微软的True Type字体</a>。</li><li id="575a" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km le kw kx ky dt translated">如果你想截图，建议<a class="ae kn" href="http://stackoverflow.com/questions/2324348/how-to-disable-caret-blinking" rel="noopener ugc nofollow" target="_blank">关闭基于Gtk的浏览器的光标闪烁</a>。</li><li id="9ddc" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km le kw kx ky dt translated">如果您的测试需要与声音系统交互，您还需要设置虚拟声卡。Ubuntu的脚本可能如下所示:</li></ul><pre class="lj lk ll lm fq lv lw lx ly aw lz dt"><span id="84a8" class="ma is hu lw b fv mb mc l md me">#!/bin/bash<br/>apt-get -y install linux-sound-base libasound2-dev<br/>apt-get -y install alsa-utils alsa-oss<br/>apt-get -y install --reinstall linux-image-extra-`uname -r` \<br/>  modprobe snd-dummy<br/>if ! grep -Fxq "snd-dummy" /etc/modules; then<br/>    echo "snd-dummy" &gt;&gt; /etc/modules<br/>fi<br/>adduser $(whoami) audio</span></pre><h1 id="0af7" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">减肥</h1><p id="619c" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">您可能已经注意到Selenium是一个Java应用程序。您需要在系统上安装Java虚拟机(JVM)来运行Selenium。最小的Java安装包叫做JRE，大约50兆。最新版本3.0.1的Selenium JAR增加了20兆字节。然后考虑操作系统的大小，所有需要的字体，浏览器的分布大小，你可以很容易地增加到几百兆字节。尽管磁盘存储现在相对便宜，但我们可以做得更好。Selenium 2.0和3.0系列也称为Selenium WebDriver。这是因为不同的浏览器支持是使用所谓的webdriver二进制实现的。它是这样工作的:</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff lu"><img src="../Images/f075571584b639e384996090191c082a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tgSZJiIeR7OChDWh5sinjA.png"/></div></div></figure><ol class=""><li id="0c14" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km kv kw kx ky dt translated">浏览器开发者可以用他们想要的任何方式实现他们的产品。为了让Selenium支持该产品，他们需要提供一个独立的二进制文件，该文件具有与Selenium Server相同的API，并支持JSONWire协议。该二进制文件应该能够启动浏览器进程，根据其规范执行协议命令，并在请求时停止进程。驱动程序二进制文件和浏览器二进制文件之间的任何通信细节都留给了浏览器开发人员。唯一的契约是支持相同的Selenium API。比如Chrome有<a class="ae kn" href="https://sites.google.com/a/chromium.org/chromedriver/" rel="noopener ugc nofollow" target="_blank"> Chromedriver </a>，Opera Blink有<a class="ae kn" href="https://github.com/operasoftware/operachromiumdriver" rel="noopener ugc nofollow" target="_blank"> OperaDriver </a>等等。</li><li id="9606" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">当设置Selenium时，您只需指定驱动程序二进制文件的路径。</li><li id="28d1" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">当您请求一个新的会话时，Selenium实际上会启动驱动程序二进制文件，然后将您的请求委托(代理)给驱动程序进程。司机做剩下的。您可以通过在所需端口上手动启动驱动程序进程并在该端口上运行测试来获得相同的结果。</li></ol><p id="1d02" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">话虽如此——为一个简单的代理服务器花费数百兆字节不是有点贵吗？一年前，答案肯定是否定的，因为Firefox——最广泛使用的Selenium浏览器——没有这样的二进制文件。Selenium服务器负责启动Firefox进程，向它上传一个扩展，并向这个扩展打开的端口发送代理请求。去年，情况发生了变化。从Firefox 48.0开始，Selenium通过使用名为<a class="ae kn" href="https://github.com/mozilla/geckodriver" rel="noopener ugc nofollow" target="_blank"> Geckodriver </a>的独立驱动程序与浏览器进行交互。这意味着至少对于大多数桌面浏览器来说，我们可以安全地删除Selenium服务器和代理对驱动程序二进制文件的直接请求。</p><h1 id="b134" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">转到容器</h1><p id="6a1e" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">在前面的小节中，我描述了如何使用云中的虚拟机来组织Selenium集群。在这种方法中，虚拟机总是在运行，因此花费你的钱。此外，具体浏览器版本的主机总数是有限的，这可能会导致免费浏览器在高峰负荷耗尽。我听说过一些正在工作甚至已经获得专利的复杂解决方案，它们根据当前负载预启动并预热一个虚拟机池，以便始终拥有免费的浏览器。这行得通，但我们能做得更好吗？虚拟机管理程序虚拟化的主要问题是速度。启动新的虚拟机可能需要几分钟时间。让我们再想一想——我们是否需要为每种浏览器配备一个独立的操作系统？答案是否定的——我们只需要文件系统和网络隔离快速工作。这就是容器虚拟化发挥作用的地方。目前，容器主要在Linux下工作，但是正如我所说的，Linux很容易覆盖80%最流行的浏览器。集装箱在几秒钟内启动，下降速度更快。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff mf"><img src="../Images/6c3edb0be77dcd602d6a0535f1dd25ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S-Bm6H2TgqKPJs4IWBS0vA.png"/></div></div></figure><p id="5ddb" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">我们应该在集装箱里放什么？—几乎与我们为虚拟机所做的一样:浏览器二进制、字体、Xvfb。对于旧版本的Firefox，我们仍然需要Java和Selenium服务器，但对于Chrome、Opera和最新的Firefox，我们可以使用驱动程序二进制文件作为容器主进程。使用极简的Linux发行版，比如Alpine，我们可以交付极小且轻量级的容器。</p><h1 id="263f" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">硒样的</h1><p id="ddb7" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">实际上最流行、最知名的容器平台是<a class="ae kn" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>。Selenium开发人员提供了一组预构建的Docker容器，用于在Docker环境中启动Selenium server standalone或Selenium Grid。不幸的是，要创建一个集群，你需要手动启动和停止这些容器，或者使用一些自动化工具，如<a class="ae kn" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> Docker Compose </a>。这已经比从包中安装Selenium要好，但最好是获得一个具有以下行为的轻量级守护进程:</p><ol class=""><li id="38b6" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km kv kw kx ky dt translated">有人启动了这个守护进程，而不是标准的Selenium Hub</li><li id="7609" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">守护进程知道，例如，为了启动Firefox 48，它需要拉取并运行容器X，对于Chrome 53，它需要拉取并运行容器y。</li><li id="492b" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">用户像往常一样请求Selenium会话，但是来自这个新的守护进程。</li><li id="2438" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">守护进程分析所需的功能，启动正确的容器，然后将所有请求代理到其主进程(Selenium服务器或webdriver二进制文件)。我们做到了…甚至更多。</li></ol><p id="a764" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">在大规模使用标准Selenium服务器的这些年中，我们明白使用JVM和fatty Selenium JAR来代理请求是一种开销。所以我们在寻找一种更轻便的技术。最后我们选择了<a class="ae kn" href="http://golang.org/" rel="noopener ugc nofollow" target="_blank"> Go </a>编程语言，又名Golang。为什么对我们的目的更好？</p><ol class=""><li id="16a7" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km kv kw kx ky dt translated">静态链接。编译结果是运行单个二进制文件。有了二进制文件，就不需要再安装任何类似JVM for Java的东西了。</li><li id="0f10" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">交叉编译。我们可以使用同一个Go编译器为不同的平台编译二进制文件。</li><li id="4e4f" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">丰富的标准库。对我们来说，最重要的是开箱即用的反向代理和HTTP/2支持。</li><li id="55f9" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">大社区。它已经成为主流了。</li><li id="79e5" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">受流行的IDE支持。在同一个平台上有一个很好的IntellijIDEA插件和一个Gogland IDE的alpha版本。</li></ol><p id="d00a" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">我们没有为这个新的Go守护进程找到一个好名字。这就是为什么它仅仅被称为<a class="ae kn" href="http://github.com/aandryashin/selenoid" rel="noopener ugc nofollow" target="_blank">月形</a>的原因。要开始使用Selenoid，请执行三个简单的步骤:</p><ul class=""><li id="e960" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km le kw kx ky dt translated">使用浏览器版本到容器的映射创建一个JSON文件:</li></ul><pre class="lj lk ll lm fq lv lw lx ly aw lz dt"><span id="7970" class="ma is hu lw b fv mb mc l md me">{<br/>  "firefox": {<br/>    "default": "latest",<br/>    "versions": {<br/>      "48.0": {<br/>        "image": "selenoid/firefox:48.0",<br/>        "port": "4444"<br/>      },<br/>      "latest": {<br/>        "image": "selenoid/firefox:latest",<br/>        "port": "4444"<br/>      }<br/>    }<br/>  },<br/>  "chrome": {<br/>    "default": "53.0",<br/>    "versions": {<br/>      "53.0": {<br/>        "image": "selenoid/chrome:53.0",<br/>        "port": "4444"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="2db5" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">像在GridRouter XML文件中一样，您可以指定可用的浏览器版本。但是Selenoid在同一台机器上或使用远程Docker API启动容器，所以不需要输入主机名和区域。对于每个浏览器版本，您需要提供容器名称、版本和容器监听的端口。</p><ul class=""><li id="93f2" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km le kw kx ky dt translated">运行Selenoid二进制文件:</li></ul><pre class="lj lk ll lm fq lv lw lx ly aw lz dt"><span id="d470" class="ma is hu lw b fv mb mc l md me">$ selenoid -limit 10 -conf /etc/selenoid/browsers.json</span></pre><p id="3c0b" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">默认情况下，它从端口4444启动，就像Selenium Hub一样。</p><ul class=""><li id="9e5a" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km le kw kx ky dt translated">像对标准Selenium一样，运行指向seleniod主机的测试。</li></ul><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff lu"><img src="../Images/b6974e4bf829d308a1ca30c73271774a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jcrN7uluKAg5KvnqlBtYfw.png"/></div></div></figure><p id="7192" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">我们的测试表明，Docker容器甚至可以在几秒钟内启动。相反，您得到的是有保证的内存和磁盘状态。浏览器状态总是像全新安装后一样。除此之外，您还可以在一个主机集群上安装Selenoid，这些主机具有作为Docker映像存储的一组相同的所需浏览器。这为您提供了一个大型Selenium集群，它可以根据浏览器的使用情况自动扩展。如果当前的请求需要更多的Chrome会话，就会启动更多的容器。当没有Chrome请求时——所有容器都关闭，为其他浏览器请求腾出空间。</p><p id="71a6" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">为了提供更好的负载分配，Selenoid会自动将超过会话限制的请求放入等待队列，并在同一主机上的一些会话结束时处理它们。但是Selenoid不仅仅是一个容器管理工具。它不仅允许您按需启动容器，还允许您启动任何驱动程序二进制文件。该特性的主要用例是替换Windows上的Selenium服务器。在这种情况下，Selenoid将启动IEDriverServer二进制文件，从而节省内存消耗并避免Selenium服务器中的一些代理错误。</p><h1 id="2ff9" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">Go网格路由器(又名ggr)</h1><p id="2c7e" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">你还记得GridRouter也是Java应用吗？我们努力创建了一个轻量级的Go实现，叫做Go Grid Router(简称ggr)。有什么好处？</p><ol class=""><li id="f51e" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km kv kw kx ky dt translated">性能提升。可以满足至少25%以上的需求。</li><li id="3068" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">更低的内存消耗。在150 rps负载下，它消耗100-200兆内存，并且这种消耗保持稳定。</li><li id="fdcd" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">客户端断开问题已修复。当客户端断开连接(例如，由于超时)时，原始GridRouter继续尝试创建新会话。当太多的集线器变得不可用时，这会使网络变得混乱并降低GridRouter的性能。相反，Go实现会在客户端断开连接后立即停止新的尝试。</li><li id="217a" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">优雅重启。当在Docker容器之外使用时，您可以通过发送SIGUSR2来优雅地重启服务器(不会丢失客户端请求)。</li><li id="aac3" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">根据请求重新加载配额。在负载均衡器后面使用多个GridRouter实例时，同步更新配额XML文件很重要。在运行的集群上添加新的中心主机和更新XML文件时，可能会出现配额不一致的情况。在这种情况下，一些客户端会话可能会出现404错误，因为并非所有GridRouter实例都已经安装了最新的主机列表。Go实现不会自动重新加载配额文件，而是等待SIGHUP信号。这适用于独立的二进制文件和Docker容器。</li><li id="8b29" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">加密密码。Ggr使用Apache <a class="ae kn" href="https://httpd.apache.org/docs/2.4/misc/password_encryptions.html" rel="noopener ugc nofollow" target="_blank"> htpasswd </a>文件，带有纯文本用户名和加密密码。</li><li id="ff38" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">缩减二进制大小。目前大约是6兆字节。不需要下载安装Java。当包装在Alpine Docker集装箱内时，集装箱总容量为11兆字节。</li></ol><p id="5ae2" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">当与Selenoid结合使用时，它允许创建可扩展且健壮的集群，如下所示:</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff mg"><img src="../Images/62c9859d61e222c4cbcfec19252e8d01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xS6HjOaNLEWBu3NSmqvlVQ.png"/></div></div></figure><h1 id="1945" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">结论</h1><p id="43ab" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">在这一部分中，我向您介绍了可以用来以现代方式组织Selenium集群的前沿技术:</p><ol class=""><li id="4903" class="ko kp hu jr b js kq jw kr ka ks ke kt ki ku km kv kw kx ky dt translated">为什么硒适合在容器环境中运行</li><li id="8a6c" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">集装箱里应该放些什么</li><li id="3bed" class="ko kp hu jr b js kz jw la ka lb ke lc ki ld km kv kw kx ky dt translated">有哪些开源解决方案可以实现这一点</li></ol><p id="457d" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">在下一部分，我将展示如何在流行的云平台中开始使用本部分描述的解决方案。</p><p id="b453" class="pw-post-body-paragraph jp jq hu jr b js kq ju jv jw kr jy jz ka lf kc kd ke lg kg kh ki lh kk kl km hn dt translated">àbientt…</p><div class="lj lk ll lm fq ab cb"><figure class="mh ln mi mj mk ml mm paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mh ln mi mj mk ml mm paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mh ln mi mj mk ml mm paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mn mo mp"><p id="f922" class="jp jq mq jr b js kq ju jv jw kr jy jz mr lf kc kd ms lg kg kh mt lh kk kl km hn dt translated"><a class="ae kn" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kn" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kn" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kn" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jp jq mq jr b js kq ju jv jw kr jy jz mr lf kc kd ms lg kg kh mt lh kk kl km hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kn" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kn" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff mu"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="lj lk ll lm fq ln"><div class="bz el l di"><div class="mv mw l"/></div></figure></div></div>    
</body>
</html>