<html>
<head>
<title>Another look at Elixir’s With</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">再看长生不老药</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/another-look-at-elixirs-with-cbd70ccd8ba4?source=collection_archive---------6-----------------------#2016-11-23">https://medium.com/hackernoon/another-look-at-elixirs-with-cbd70ccd8ba4?source=collection_archive---------6-----------------------#2016-11-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="bfba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最近我写了一篇关于使用Elixir的<code class="eh jp jq jr js b">with</code>语法的文章:</p><div class="jt ju fm fo jv jw"><a rel="noopener follow" target="_blank" href="/@shdblowers/using-elixirs-with-bccf39bac279"><div class="jx ab ej"><div class="jy ab jz cl cj ka"><h2 class="bd hv fv z el kb eo ep kc er et ht dt translated">使用灵药</h2><div class="kd l"><h3 class="bd b fv z el kb eo ep kc er et ek translated">这是一篇简短的文章，展示了在Elixir中使用with关键字的示例。</h3></div><div class="ke l"><p class="bd b gc z el kb eo ep kc er et ek translated">medium.com</p></div></div></div></a></div><p id="1ddf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我在那篇文章的结尾说，我确信<code class="eh jp jq jr js b">with</code>是有用处的，但是我在努力寻找它们。作为对那篇文章的更新，我发现了对<code class="eh jp jq jr js b">with</code>语句的一个很好的使用，<a class="ae kf" href="https://hackernoon.com/tagged/model" rel="noopener ugc nofollow" target="_blank">模型</a>净化！</p><p id="04ff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是一个流程图，展示了这篇文章将以多种方式编写的逻辑:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff kg"><img src="../Images/6e383ad3efa6ebc653c9fb0bb4fef662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*RfPtbybekjxnwGBA2WNJDw.png"/></div></figure><p id="8754" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如您所看到的，逻辑分支到两个不同的最终结论，要么参数有效，可以创建用户，要么存在错误，应该通知用户。我在代码中寻找的是尽可能清晰简明地表达这一思想。</p><p id="805f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是一个使用<code class="eh jp jq jr js b">with</code>的例子，它通过使用一个结构创建一个用户，同时依次净化来自请求的每个<a class="ae kf" href="https://hackernoon.com/tagged/parameter" rel="noopener ugc nofollow" target="_blank">参数</a>:</p><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="ba4c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面我已经定义了函数<code class="eh jp jq jr js b">create/1</code>,它获取包括<code class="eh jp jq jr js b">"Name"</code>和<code class="eh jp jq jr js b">"Email"</code>的用户属性映射，并返回一个创建的用户结构。对于每个添加的参数，都要通过一个验证函数，该函数将返回<code class="eh jp jq jr js b">{:ok, property}</code>或<code class="eh jp jq jr js b">{:error, message}</code>。</p><p id="6403" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用<code class="eh jp jq jr js b">with</code>这些函数可以链接在一起，如果出现问题，共享一个<code class="eh jp jq jr js b">else</code>子句。此外，每个函数产生的值都可以被捕获并在<code class="eh jp jq jr js b">do</code>语句中使用，如上所示。</p><p id="cea1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还要注意，<code class="eh jp jq jr js b">else</code>子句在上面的代码中实际上是可选的。因为该子句返回它所捕获的内容，所以当省略了<code class="eh jp jq jr js b">else</code>子句时，这种行为得以保持。</p><p id="81d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将<code class="eh jp jq jr js b">create/1</code>功能与流程图进行比较，可以清楚地看到，使用<code class="eh jp jq jr js b">with</code>可以简洁地表达逻辑。它清楚地显示了逻辑想要走的快乐之路，以及它是否到达了那条路的尽头。</p><p id="691f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们看看<code class="eh jp jq jr js b">with</code>的替代方案，如前一篇文章所示，它们是使用函数或<code class="eh jp jq jr js b">case</code>。再次查看了这两种选择，我看不出单独使用函数是一种合理的选择，因为它不能恰当地表达正在发生的分支逻辑。</p><p id="b6b3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是使用<code class="eh jp jq jr js b">case</code>表达的逻辑示例:</p><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="f2a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上述方法有两个关键问题。首先也是最重要的，在<code class="eh jp jq jr js b">create/1</code>函数中最重要的代码行，创建<code class="eh jp jq jr js b">User</code>结构的代码行隐藏在函数中间的嵌套深处。目前，如果有两个参数，可读性不是很好，想象一下如果有更多的参数，比如10个？那看起来很可怕。另一个问题是我不得不一次又一次地重新定义如何处理一个错误，而不是对所有事情都指定一次。</p><p id="a8fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，我收回我说过的关于<code class="eh jp jq jr js b">with</code>语法的话。这是一个很好的语法糖，我期待着在未来发现它的更多用途。</p><div class="kh ki kj kk fq ab cb"><figure class="kq kl kr ks kt ku kv paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="kq kl kr ks kt ku kv paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="kq kl kr ks kt ku kv paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="kw kx ky"><p id="f922" class="ir is kz it b iu iv iw ix iy iz ja jb la jd je jf lb jh ji jj lc jl jm jn jo hn dt translated"><a class="ae kf" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kf" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kf" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kf" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is kz it b iu iv iw ix iy iz ja jb la jd je jf lb jh ji jj lc jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kf" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kf" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="fe ff ld"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="li kp l"/></div></figure></div></div>    
</body>
</html>