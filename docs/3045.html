<html>
<head>
<title>Wake-On-Lan through the internet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过互联网进行局域网唤醒</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/wake-on-lan-through-the-internet-491817e2dd41?source=collection_archive---------2-----------------------#2017-03-09">https://medium.com/hackernoon/wake-on-lan-through-the-internet-491817e2dd41?source=collection_archive---------2-----------------------#2017-03-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="abd1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的日常工作通常是从打开一个到服务器的SSH连接，运行一个docker镜像(上面有RStudio Server或者Jupyter)，直接在浏览器上分析数据或者编程开始的。一直都很方便，直到上个月突然断线。突然所有的东西都停止工作了，我绝望地浪费了几个小时试图修好它。回家后我发现，由于楼上的一个小建筑，我公寓的电很不稳定。当然，一个简单的解决方案是获得一个UPS(不间断电源),但我被这个想法迷住了，也许我可以通过互联网打开我的服务器。这就像服务器的电源开关一直在我身边。这太酷了，尤其是当我要离开很长一段时间，不想在能源账单上浪费钱的时候。这个故事是关于我是如何做到的。你可以先看看我最后的网络设置。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff jp"><img src="../Images/3e6a39722b0e390c595d4063daf479c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*snmG1m9CSbZsTLNQK0BV1g.png"/></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">My Network with the Wifi Repeater to provide wired connection to the server, and an insider to help me wake the server through the internet</figcaption></figure><p id="0498" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">第一步</strong>:满足硬件要求</p><p id="b580" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在大多数主板上，有一个功能叫做“局域网唤醒”(WOL)。WoL的工作原理是向目标机器发送一个名为Magic Packet的数据包。当收到数据包时，目标机器的网络接口会唤醒计算机的其余部分。然而，我意识到我不能通过它的无线接口唤醒我的服务器(我使用的是USB无线适配器)。原来，这个神奇的数据包必须被发送到主板的内置以太网端口，因为它是整个机器关闭时唯一醒着的东西。我用一个<em class="kb"> Wifi中继器</em>解决了这个问题，并通过以太网电缆将其连接到服务器。<strong class="it hv">如果你的机器使用有线连接，你可以跳过这一步。</strong></p><p id="9d93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">第二步</strong>:让局域网唤醒在局域网上工作。</p><p id="5a3f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">顾名思义，WOL旨在通过本地网络唤醒机器。所以你必须和你的目标设备在同一个网络中才能让它工作。在这一步中，我们将尝试这样做。<br/>首先，你必须打开主板上的WOL功能。进入BIOS设置，寻找“PCI事件唤醒”或“局域网唤醒”并启用它。<br/>第二，在Ubuntu上，你要知道你的默认界面，检查它是否支持WOL，开启该功能。整个过程可以如下进行:</p><pre class="jq jr js jt fq kc kd ke kf aw kg dt"><span id="aee4" class="kh ki hu kd b fv kj kk l kl km">$ route #Get name of the default interface, for example: <strong class="kd hv">eth0</strong><br/>$ sudo ethtool eth0 <br/>#Look for "Supports Wake-on: g" line, which means WOL supported<br/>$ sudo ethtool -s eth0 wol g  #Enable WOL</span></pre><p id="6354" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要使设置在重启后保持不变，您需要将上面的最后一条命令添加到<em class="kb"> etc/network/interfaces </em>中的接口配置中。你可以在<a class="ae kn" href="https://help.ubuntu.com/community/WakeOnLan" rel="noopener ugc nofollow" target="_blank">这里</a>阅读更多内容。</p><p id="bffc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，让我们来测试一下。你可以在Android中使用一款名为“Wake-on-Lan”的手机应用(iOS也有类似的应用，但我没有测试过)。它可以自动扫描您的本地网络，并列出所有连接的设备。你只需搜索你的机器，添加它，然后你就可以随时向它发送神奇的数据包。试着关掉你的目标机，用手机唤醒它。</p><p id="344b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您知道设备的mac地址和广播地址，您可以手动添加设备。在我的例子中，它们是9E:65:F9:0E:29:FB和192.168.0.255。您可以使用<em class="kb"> ifconfig </em>命令来找出这些信息。请注意，您将需要您的mac地址来通过互联网唤醒您的机器。</p><p id="98c9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">第三步</strong>:通过互联网实现网络唤醒。</p><p id="460e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请注意，您的路由器必须有一个静态IP(即82.164.3.27的<strong class="it hv"/>)才能完成这一步。有许多方法可以通过互联网发送神奇的数据包。我将它们从最简单到最难(有时是唯一的)的解决方案列在下面:</p><p id="23c2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">第一种解决方案</strong>:如果你的路由器支持转发魔包(端口7或9 UDP)，你很幸运。您可以将任何数据包从端口7或9 UDP转发到您的目标设备。有些路由器甚至允许转发广播数据包。你可以使用<a class="ae kn" href="https://www.depicus.com/wake-on-lan/woli." rel="noopener ugc nofollow" target="_blank">这个网站</a>来唤醒你的服务器。但是，据我所知，大部分流行的商用路由器都不支持这个(我的情况)。记得为您的服务器预留DHCP地址，这样它的IP地址在重新连接后不会改变。</p><p id="3ef0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">第二种解决方案</strong>:你可以检查一下你的路由器是否可以安装一个更好的固件。出于营销目的，许多路由器生产商隐藏了产品的功能。您可以安装第三方固件来解锁所有这些。我强烈推荐<a class="ae kn" href="https://openwrt.org/" rel="noopener ugc nofollow" target="_blank"> OpenWrt </a>。在这里检查你的路由器是否被OpenWrt <a class="ae kn" href="https://wiki.openwrt.org/toh/start" rel="noopener ugc nofollow" target="_blank">支持。</a></p><p id="105e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">第三种解决方案</strong>:如果你的路由器没那么好，你就需要一个内线。它是一种始终开启并连接到您的本地网络的设备。然后你可以通过互联网向你的内线发送SSH，让它为你发送这个神奇的包。在我的例子中，我使用了一个便宜的Raspberry Pi 3(我已经用它来控制其他东西)。我在上面使用OpenWrt，运行如下的etherwake命令:</p><pre class="jq jr js jt fq kc kd ke kf aw kg dt"><span id="8a48" class="kh ki hu kd b fv kj kk l kl km">$ etherwake 9E:65:F9:0E:29:FB eth0</span></pre><p id="d311" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一个参数是目标机器的mac地址，而第二个参数是将发送包的内部人员的网络接口。它应该是它的默认接口。您可以查看<a class="ae kn" href="https://wiki.openwrt.org/doc/uci/wol" rel="noopener ugc nofollow" target="_blank">此链接</a>了解更多详情。请注意，您的内部人员可以是运行任何操作系统的任何设备。只要你能通过网络SSH到它，它应该可以工作。记得为内部人员的SSH端口配置端口转发，这样您就可以从任何地方对其进行SSH。</p><p id="0d8c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以，就这样了。我希望你喜欢这个故事。如果有任何问题，请留下您的评论。</p></div></div>    
</body>
</html>