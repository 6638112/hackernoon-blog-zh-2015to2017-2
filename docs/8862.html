<html>
<head>
<title>Why XOD switched from Travis to Circle CI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">XOD为什么从特拉维斯转到圈CI</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/why-xod-switched-from-travis-to-circle-ci-98b6832f2d96?source=collection_archive---------15-----------------------#2017-12-18">https://medium.com/hackernoon/why-xod-switched-from-travis-to-circle-ci-98b6832f2d96?source=collection_archive---------15-----------------------#2017-12-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/9e2fdc31221182a6573ad75fe713ac70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OVsgM-miFdJVaSVRqBMsCQ.png"/></div></div></figure><p id="ae99" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们开发了XOD。这是一个开源的可视化编程IDE，可用于Windows、macOS、Linux和浏览器。从一开始，我们就使用<a class="ae ka" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>在Linux和macOS上构建、测试和打包发行版。最近我们转到了<a class="ae ka" href="https://circleci.com" rel="noopener ugc nofollow" target="_blank">圈CI </a>。我对这种改变很满意。为什么？请继续阅读。</p><h1 id="bbb8" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">性能问题</h1><p id="c7c8" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">在过去的一年半时间里，XOD在代码方面有了显著的增长。如果说一年前完整的CI周期需要5分钟左右，那么最近它用机器时间就超过了25分钟。这是为了在制品集成。当我们发布一个新版本时，持续时间可以超过90分钟。</p><p id="3e0e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">把Travis本身的额外基础设施问题放在这里(下面会有更多)，每天合并3-4个拉请求是我们能承受的最大速度。</p><p id="629d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可能认为我们有一个太大的项目，应该分成多个回购。嗯，它<em class="le">是</em>一个<a class="ae ka" href="https://github.com/xodio/xod" rel="noopener ugc nofollow" target="_blank">大monorepo </a>，但是它并没有阻止开发者在他的机器上在几分钟内完全构建和测试XOD。</p><h2 id="75bf" class="lf kc hu bd kd lg lh li kh lj lk ll kl jn lm ln kp jr lo lp kt jv lq lr kx ls dt translated">Mac供应时间</h2><p id="cc1d" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们可以暂时接受25分钟的构建。并行构建的机会不多了。但有个问题我们无论如何都不能影响特拉维斯。这是Mac供应。</p><p id="4206" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这可能需要几个小时。这不是秘密。参见他们的<a class="ae ka" href="https://www.traviscistatus.com/" rel="noopener ugc nofollow" target="_blank">状态页面</a>上的“开源项目的积压macOS构建”。上百(！)的构建堆叠在队列中等待机器。</p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lt"><img src="../Images/1e090ed802ccab66471baf878562a4a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hAXr-Uat5wuXRO9_OkOOMw.png"/></div></div><figcaption class="ly lz fg fe ff ma mb bd b be z ek">The plot shows queue length. The groups of five hills are workdays of a week.</figcaption></figure><p id="e785" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">更糟糕的是，我不能付钱去买优先池什么的。大约两个月前，他们强迫我们从商业计划转向免费计划，仅仅因为我们的GitHub回购是公开的。</p><p id="58ae" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">公平地说，Travis devs在过去的几个月里一直在努力解决这个问题。他们对每个项目设置了一些Mac限制，等等。但无济于事。我不明白，如果你不想在队列中坐很长时间，他们为什么不能“简单地”将Mac-cluster的容量翻倍并拿钱。</p><h2 id="1935" class="lf kc hu bd kd lg lh li kh lj lk ll kl jn lm ln kp jr lo lp kt jv lq lr kx ls dt translated">导火线</h2><p id="f84d" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">正如我说过的，当我们发布时，CI会构建发行版。<a class="ae ka" href="https://github.com/xodio/xod/wiki/Releasing-a-New-Version" rel="noopener ugc nofollow" target="_blank">发布过程</a>本身相当复杂，需要几个小时的细致工作。你最不希望看到的是构建失败，因为你知道一切<em class="le">都应该</em>编译好，因为你前一天已经排练过了。</p><p id="08ec" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，我们只是闲逛。我们无法发布0.16.0，因为对Travis的功能测试在没有明显原因的情况下随机失败。每个重建周期需要20分钟(外加30–90分钟的资源调配时间),并在另一个“随机”点再次失败。</p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mc"><img src="../Images/bf87de5425aeb80a2bf62b313fb28251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U4Auu1EitL_3rQrDAqpUyw.png"/></div></div><figcaption class="ly lz fg fe ff ma mb bd b be z ek">A pretty common scenario. The build has not even started after an hour of wait.</figcaption></figure><p id="c631" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">嗯，在我们的套件中有<em class="le">和</em>一个古怪的功能测试问题。我们依靠WebdDriverIO来运行应用程序和模拟用户操作。它似乎有一个依赖于性能的bug，这个bug不会出现在本地机器和Circle CI上。我们将使用Puppeteer和headless Chrome重写测试套件，但这需要时间，我们希望让事情一直运行到完成。</p><p id="65f0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这档节目让我不得不立即寻找替代品。</p><h1 id="5442" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">圈出CI作为替代项</h1><p id="0bae" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">选择相当容易。除了Travis和Circle，我没有找到支持MAC的CI SaaS。我给了Circle CI一个尝试。</p><p id="f9d1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">令人惊讶的是，迁移非常容易，不到24小时就完成了。我们能够在第二天发布。</p><p id="fd73" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">切换很简单，不是因为有一些“导入”工具或者配置结构非常相似，不，它们差别很大。因为Circle CI最近推出了他们全新的2.0平台，有<a class="ae ka" href="https://circleci.com/docs/2.0/" rel="noopener ugc nofollow" target="_blank">优秀医生</a>。</p><p id="c498" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.0的概念如此简单而强大，以至于我能够在不到一天的时间里复制90%的CI流程，包括缓存、并行化、GitHub集成等。</p><p id="db87" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有几个星期的CircleCI经验，我可以比较这两个服务并排。</p><h1 id="1b7e" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">切尔莱奇对特拉维斯奇</h1><h2 id="470c" class="lf kc hu bd kd lg lh li kh lj lk ll kl jn lm ln kp jr lo lp kt jv lq lr kx ls dt translated">表演</h2><p id="8753" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">Linux常规版本:Travis ~12m，Circle ~9m <br/> Linux发布版本:Travis ~15m，Circle ~9m(没有因并行化而发生变化)<br/> Linux供应:在Travis和Circle上只需几秒钟</p><p id="7b39" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">macOS常规版本:Travis ~ 21–25m(不稳定)，Circle ~9m <br/> macOS发布版本:Travis ~ 24–45m(不稳定)，Circle ~9m <br/> macOS配置:Travis weekend —几秒钟，Travis workday —从5m到几小时，Circle —几秒钟</p><p id="98d0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">分支机构建立挂钟时间:特拉维斯-从30分钟到几个小时，圈-9m</p><p id="46e3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">是的，Circle在9分钟内建立XOD，总是，不管今天是什么日子，太阳在哪里。如果幸运的话，特拉维斯可以在3000万英镑内完成。</p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div class="fe ff md"><img src="../Images/405944445a2fe0dc960c5f945e55a9f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*i2AYN55dpD32zxhmyfIzUw.png"/></div><figcaption class="ly lz fg fe ff ma mb bd b be z ek">The total time is 09:35. Parallelization helps a lot.</figcaption></figure><p id="d1c8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您打算在Mac上进行构建，这就是您应该知道的全部内容。</p><p id="aea9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">获胜者:切尔莱西</p><h2 id="f1c5" class="lf kc hu bd kd lg lh li kh lj lk ll kl jn lm ln kp jr lo lp kt jv lq lr kx ls dt translated">机器和基础设施</h2><p id="a620" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">Travis和Circle似乎使用相似的Linux机器配置。但是CircleCI真正支持Docker容器。我可以使用自己的docker映像来运行构建。因此，我可以预先安装、配置和调整一切，以节省构建开始时的几分钟时间。在Travis上，我不得不一遍又一遍地“升级和安装”。</p><p id="6420" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Mac由<a class="ae ka" href="https://www.macstadium.com/" rel="noopener ugc nofollow" target="_blank"> Mac Stadium </a>为特拉维斯提供。不确定它们的配置，但与Linux版本相比，它们执行相同任务的速度要慢2倍。不知道CircleCI把他们的MAC带到哪里去了，但是性能上和Linux机器相当。</p><p id="5a9a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这两个服务都不提供Windows机器。这对任何一方来说都将是T2的巨大利益。在这种情况下，它将是市场上唯一一款支持所有桌面操作系统的CI SaaS。</p><p id="0406" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">冠军</strong>:切尔莱西</p><h2 id="5c82" class="lf kc hu bd kd lg lh li kh lj lk ll kl jn lm ln kp jr lo lp kt jv lq lr kx ls dt translated">网络界面</h2><p id="747f" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">特拉维斯的用户界面看起来很老派。圆在审美上更现代。但是，从可用性的角度来看，特拉维斯更清楚。他们有更少的视觉噪音，更明确的色彩和动画。如果有东西在跑，那它就是在旋转。如果有什么错误，它会在一个基本上是灰度的页面上用鲜艳的红色显示出来。</p><p id="8699" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">CircleCI经常试图将我切换到另一个GitHub组织，这个组织非常混乱，看起来我失去了所有的历史。</p><p id="6b1d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你使用CircleCI的现代功能和推荐的工作流程，仪表盘(即起始页)在circle ci中毫无意义。重新启动构建的按钮并不总是如你所愿，按钮本身也不总是设置在直观的地方。</p><figure class="lu lv lw lx fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff me"><img src="../Images/7b76596720ce674b6ba22023dc768ebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hEsAZJAQXyjJV3k2mlw0Q.png"/></div></div><figcaption class="ly lz fg fe ff ma mb bd b be z ek">Can you spot the button to retry the failed build?… Yep, there is no such one on the build details page. You have to go back to build list and there will be “Restart” below failed builds. But (!) it will not recover your build anyway 😬</figcaption></figure><p id="fc45" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">另一方面，CircleCI有桌面通知。那是我第一次接受Chrome的“显示桌面通知”。它们对CI来说非常方便。</p><p id="4f5d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这两个服务都有很多UI/UX改进的空间。</p><p id="776e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">获胜者:特拉维斯</p><h2 id="82f6" class="lf kc hu bd kd lg lh li kh lj lk ll kl jn lm ln kp jr lo lp kt jv lq lr kx ls dt translated">构建日志</h2><p id="09f4" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">不知道是什么技术问题，但在Travis上，日志会不时损坏或根本无法渲染。记录本身被推到一个连续的滚动中，很难找到任务边界。</p><p id="8000" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在CircleCI上，我还没有发现任何日志问题。并且输出被清楚地分成带有定时信息的可折叠部分。</p><p id="df29" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">获胜者</strong> : CircleCI</p><h2 id="5ad1" class="lf kc hu bd kd lg lh li kh lj lk ll kl jn lm ln kp jr lo lp kt jv lq lr kx ls dt translated">配置灵活性</h2><p id="b566" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">这两种服务都使用您直接存储在repo中的YAML配置。但是建筑就大不一样了。</p><p id="090e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">特拉维斯定义了一个非常严格的管道。您的项目安装、构建和部署。你可以在这里和那里部署，就这样。“—但是，但是…我们想部署在谷歌云存储上。—不可能，让它成为构建步骤的一部分。”</p><p id="91c8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了在Travis上实现并行，您应该使用为其他目的而存在的矩阵构建特性。在那里，您分配不同的环境变量集，然后执行一个小小的Bash voodoo来跳过构建的一些步骤并完成其他步骤。</p><p id="8676" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">CircleCI 2.0有一个简单而强大的工作流概念。它允许您执行作业扇出、扇入、序列，以及与Git提交的分支和标记相关的所有操作。超级酷。</p><p id="638b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这两种服务都缺少一些功能。例如，两者都不能只观察回购的一部分，所以如果我处理文档，我不能跳过冗长的测试。CircleCI配置往往有很多代码重复，因为我不能在macOS和Linux之间重用作业步骤的一部分。缓存系统非常简单:在这两种情况下，我都不能缓存编程派生的路径，只能缓存硬编码的目录。</p><p id="67a3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">获胜者</strong> : CircleCI</p><h2 id="0ef9" class="lf kc hu bd kd lg lh li kh lj lk ll kl jn lm ln kp jr lo lp kt jv lq lr kx ls dt translated">定价和开源支持</h2><p id="fb77" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">Travis对员工收费，即兼职。花129美元/莫忧就能得到两份兼职。就这样，很简单。</p><p id="55e1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">圆形稍微复杂一点。它对Linux和macOS部分分别收费。你可以免费获得一个Linux工人，每增加一个工人每月要花费你50美元。要使用macOS，你必须为2个工人支付49美元/月，但它额外限制了500分钟的CPU时间，所以如果你有一个更大的项目，准备好为5个工人MAC和1800分钟的CPU时间支付129美元/月。</p><p id="1967" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">XOD是一个<a class="ae ka" href="https://github.com/xodio/xod" rel="noopener ugc nofollow" target="_blank">开源</a>项目，两个服务都支持开源运动(我猜他们很好地推销了他们的服务)。OSS项目从这些服务中获得了什么？</p><p id="37b7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Travis让你免费在Linux和macOS上构建。5名工人0美元。如果你是开源的<em class="le">和</em>想要为更好的能力付费，你不能。</p><p id="4119" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">CircleCI免费赠送4个Linux workers和2个worker/500分钟免费macOS。只有在与CCI团队交谈后才能获得免费的MAC电脑。您可以定期购买的其他资源。</p><p id="0191" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">赢家</strong>:平局</p></div><div class="ab cl mf mg hc mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hn ho hp hq hr"><p id="fa9d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对我来说，选择很明显。与Travis相比，CircleCI 2.0似乎是下一代系统。</p><p id="e3b2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但是时间在流动，产品在进化。如果你要选择CI SaaS，先两个都试试。每个都提供14天的免费试用。祝两个军种好运。</p></div></div>    
</body>
</html>