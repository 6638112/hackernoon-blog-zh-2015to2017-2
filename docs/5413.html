<html>
<head>
<title>Snapshot Testing With Jest — Beyond React components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jest快照测试—超越React组件</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/snapshot-testing-with-jest-beyond-react-components-7630fd0024c5?source=collection_archive---------9-----------------------#2017-07-25">https://medium.com/hackernoon/snapshot-testing-with-jest-beyond-react-components-7630fd0024c5?source=collection_archive---------9-----------------------#2017-07-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="1aca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">快照是测试<a class="ae jp" href="https://hackernoon.com/tagged/ui" rel="noopener ugc nofollow" target="_blank"> UI </a>组件的一种很棒的新方法，但是它们的适用性不止于此，它们在其他环境中也非常有用。</p><p id="ea9b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">实际上，使用Jest快照可以测试和断言任何可序列化值的输出。</strong></p><p id="f5d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们假设以下场景:我们有一个todos列表(Array <obj>)，在我们的应用程序中，我们希望能够通过它的一个属性来过滤它们。让我们为它写一个函数和一些测试:</obj></p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="cd4c" class="jz ka hu jv b fv kb kc l kd ke"><strong class="jv hv">var</strong> ToDos = [<br/>  { 'Id': '1', 'Title': 'Shop groceries', 'Status': 'done' },<br/>  { 'Id': '2', 'Title': 'Go to gym', 'Status': 'pending' },<br/>  { 'Id': '3', 'Title': 'Kill it with fire', 'Status': 'done' },<br/>  { 'Id': '4', 'Title': 'Take snapshots', 'Status': 'done' },<br/>  { 'Id': '5', 'Title': 'Be awesome', 'Status': 'pending' },<br/>];</span><span id="cf4f" class="jz ka hu jv b fv kf kc l kd ke">function filterTodos(arr, key, term) {<br/>  return arr.filter(function(obj) {<br/>    return obj[key] === term<br/>  });<br/>}</span><span id="953a" class="jz ka hu jv b fv kf kc l kd ke">test('it returns all todos with matching Id',() =&gt;{<br/>  expect(<!-- -->filterTodos(ToDos,'Id', '1')).toBe(<br/>    <!-- -->{ 'Id': '1', 'Title': 'Shop groceries', 'Status': 'done' }<br/>  <!-- -->)<br/>})</span><span id="2c62" class="jz ka hu jv b fv kf kc l kd ke">test('it returns all todos with matching Title',() =&gt;{<br/>  expect(<!-- -->filterTodos(ToDos,'Title', <!-- -->'Shop groceries'<!-- -->)).toBe(<br/>    <!-- -->{ 'Id': '1', 'Title': 'Shop groceries', 'Status': 'done' }<br/>  <!-- -->)<br/>})</span><span id="dddf" class="jz ka hu jv b fv kf kc l kd ke">test('it returns all todos with matching Status',() =&gt;{<br/>  expect(<!-- -->filterTodos(ToDos,'Done', 1)).toBe(<br/>    <!-- -->{ 'Id': '1', 'Title': 'Shop groceries', 'Status': 'done' },<br/>    { 'Id': '3', 'Title': 'Kill it with fire', 'Status': 'done' },<br/>    { 'Id': '4', 'Title': 'Take snapshots', 'Status': 'done' }<br/>  <!-- -->)<br/>})</span></pre><p id="702e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通常，当测试这样的功能时，我们需要一个模拟的todos列表，然后我们需要手动断言预期的返回值。</p><blockquote class="kg kh ki"><p id="b903" class="ir is kj it b iu iv iw ix iy iz ja jb kk jd je jf kl jh ji jj km jl jm jn jo hn dt translated">一切都很好，但是，如果将来我们需要改变我们的数据，我们需要手动更新每个测试。</p></blockquote><p id="46b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设我们有了一个新的需求，要求所有的待办事项都应该有一个带有到期日期的到期密钥。然后，我们必须手动更新我们的数组和每个测试用例的返回值。这可能很麻烦，特别是在一个具有更复杂功能的大型应用程序中。</p><p id="db80" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">借助快照，我们可以复制同样的测试场景:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="686f" class="jz ka hu jv b fv kb kc l kd ke"><strong class="jv hv">var</strong> ToDos = [<br/>  { 'Id': '1', 'Title': 'Shop groceries', 'Status': 'done' },<br/>  { 'Id': '2', 'Title': 'Go to gym', 'Status': 'pending' },<br/>  { 'Id': '3', 'Title': 'Kill it with fire', 'Status': 'done' },<br/>  { 'Id': '4', 'Title': 'Take snapshots', 'Status': 'done' },<br/>  { 'Id': '5', 'Title': 'Be awesome', 'Status': 'pending' },<br/>];</span><span id="5e3c" class="jz ka hu jv b fv kf kc l kd ke">function filterTodos(arr, key, term) {<br/>  return arr.filter(function(obj) {<br/>    return obj[key] === term<br/>  });<br/>}</span><span id="7ea8" class="jz ka hu jv b fv kf kc l kd ke">test('it returns all todos with matching Id',() =&gt;{<br/>  expect(<!-- -->filterTodos(ToDos, 'Id', '1')).toMatchSnapshot()<br/>})</span><span id="68f4" class="jz ka hu jv b fv kf kc l kd ke">test('it returns all todos with matching Title',() =&gt;{<br/>  expect(<!-- -->filterTodos(ToDos, 'Title', <!-- -->'Shop groceries'<!-- -->)).toMatchSnapshot()<br/>})</span><span id="7539" class="jz ka hu jv b fv kf kc l kd ke">test('it returns all todos with matching Status',() =&gt;{<br/>  expect(<!-- -->filterTodos(ToDos, 'Status', 'done')).toMatchSnapshot()<br/>})</span></pre><p id="18ca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将为您提供以下快照:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="e159" class="jz ka hu jv b fv kb kc l kd ke">// Jest Snapshot v1, <a class="ae jp" href="https://goo.gl/fbAQLP" rel="noopener ugc nofollow" target="_blank">https://goo.gl/fbAQLP</a></span><span id="8dfe" class="jz ka hu jv b fv kf kc l kd ke">exports[`it returns all todos with matching Id 1`] = `<br/>Array [<br/>  Object {<br/>    "Id": "1",<br/>    "Status": "done",<br/>    "Title": "Shop groceries",<br/>  },<br/>]<br/>`;</span><span id="2939" class="jz ka hu jv b fv kf kc l kd ke">exports[`it returns all todos with matching Status 1`] = `<br/>Array [<br/>  Object {<br/>    "Id": "1",<br/>    "Status": "done",<br/>    "Title": "Shop groceries",<br/>  },<br/>  Object {<br/>    "Id": "3",<br/>    "Status": "done",<br/>    "Title": "Kill it with fire",<br/>  },<br/>  Object {<br/>    "Id": "4",<br/>    "Status": "done",<br/>    "Title": "Take snapshots",<br/>  },<br/>]<br/>`;</span><span id="5ec1" class="jz ka hu jv b fv kf kc l kd ke">exports[`it returns all todos with matching Title 1`] = `<br/>Array [<br/>  Object {<br/>    "Id": "1",<br/>    "Status": "done",<br/>    "Title": "Shop groceries",<br/>  },<br/>]<br/>`;</span></pre><p id="95a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那么对todos数组的更新将导致测试失败，并产生以下输出:</p><figure class="jq jr js jt fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="fe ff kn"><img src="../Images/d969b551dd4cd345b307364d01a253ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o-Y4ptDWGdA6gD8B_7lY_g.png"/></div></div></figure><p id="2bfd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果这个新输出是预期的，我们可以简单地通过运行`` `$ jest — updateSnapshots命令在所有测试用例中复制它，不需要遍历每个测试并更新它的返回值。</p><blockquote class="kg kh ki"><p id="3df6" class="ir is kj it b iu iv iw ix iy iz ja jb kk jd je jf kl jh ji jj km jl jm jn jo hn dt translated">这就是为什么快照对于具有复杂和频繁变化的需求的应用程序非常有用，并且是一个非常好的测试工具，它的适用性可以远远超出react组件。</p></blockquote><p id="fe7e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">资源:</strong></p><figure class="jq jr js jt fq ko"><div class="bz el l di"><div class="kv kw l"/></div></figure><div class="kx ky fm fo kz la"><a href="https://jest-everywhere.now.sh/#/?_k=vkg4ky" rel="noopener  ugc nofollow" target="_blank"><div class="lb ab ej"><div class="lc ab ld cl cj le"><h2 class="bd hv fv z el lf eo ep lg er et ht dt translated">西贝柳斯·塞拉菲尼的《到处开玩笑》</h2><div class="lh l"><h3 class="bd b fv z el lf eo ep lg er et ek translated">编辑描述</h3></div><div class="li l"><p class="bd b gc z el lf eo ep lg er et ek translated">jest-everywhere.now.sh</p></div></div></div></a></div><figure class="jq jr js jt fq ko"><div class="bz el l di"><div class="lj kw l"/></div></figure></div></div>    
</body>
</html>