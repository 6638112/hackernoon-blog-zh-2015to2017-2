<html>
<head>
<title>Quantified Boy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">量化男孩</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/quantified-boy-726e9558594f?source=collection_archive---------2-----------------------#2016-10-06">https://medium.com/hackernoon/quantified-boy-726e9558594f?source=collection_archive---------2-----------------------#2016-10-06</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="40e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用树莓派和亚马逊破折号按钮构建21世纪星图</p><p id="5ef9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个世界充满了技术福音传播者，他们认为技术是我们的救赎之路。面对任何问题，他们认为你需要做的就是抹上一点科技，然后问题就消失了。我不是那种人，但我喜欢认为我正在帮助我的儿子在学校表现得更好，这都要归功于一个树莓派、几个<a class="ae jp" href="https://www.amazon.co.uk/b?ie=UTF8&amp;node=10833773031" rel="noopener ugc nofollow" target="_blank">亚马逊dash按钮</a>和一些我在工作中编写的<a class="ae jp" href="http://bothan.io/" rel="noopener ugc nofollow" target="_blank">软件</a>。</p><p id="2950" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我儿子的学校有一个行为和奖励积分系统。表现好的奖励成绩分，表现不好的奖励行为分。这都是登录在一个由凯德建立的可怕的专有系统上的。自从他去年开学，我就决定建一个screen scraper来监控这个系统。然后，如果那天有任何问题，它会给我和我的妻子发电子邮件，并在我自己安装的<a class="ae jp" href="http://bothan.io/" rel="noopener ugc nofollow" target="_blank"> Bothan </a>中记录这些要点，这是我在工作中帮助构建的一个系统，用于跟踪和可视化指标。然后，我可以在仪表板上可视化这些点，省去了我每天登录可恶的学校系统的痛苦(你可以在Github上看到<a class="ae jp" href="https://github.com/pezholio/gboard" rel="noopener ugc nofollow" target="_blank">代码</a>)。</p><p id="98c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种方法相当有效，在我儿子上学的第一年里，它一直在后台运行(可能为我节省了很多时间)。然而，当我的儿子一年级时，我意识到我们需要一些别的东西。</p><p id="10f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在他上学的头几个星期，他已经积累了29个行为点，不是任何类型的主要顽皮，只是低水平的厚脸皮和乱搞，你知道，五岁孩子做的那种事情。不管我是否同意学校的做法，我知道我需要帮助他在学校变得更好。</p><p id="d36b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，我和妻子决定在家里建立我们自己的行为和成绩积分系统——如果他在学校过得不好，他会得到一个行为积分(不像学校因为他的不端行为给他五分)，如果他过得好，他会得到两个奖励积分(我儿子对胡萝卜的反应比大棒好得多)。我们也会因为他在家里的总体表现给他加分。如果他在11月底(他的生日)之前获得一定数量的奖励积分，他就可以和所有的朋友一起举办一个大型的生日聚会。</p><p id="415b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来的问题是，我们如何以一种吸引他的方式记录这些点？我们以前尝试过星图，它们在几周内都很好，但后来新鲜感消失了，星图变得破旧，他最终脱离了整个过程。幸运的是，亚马逊dash按钮刚刚在英国发布，我很想找个借口用它们做点什么。</p><p id="ba37" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我点了两个按钮，加上一个树莓派3，并开始工作。每当我着手这种性质的项目时，我总是会使用我觉得舒服的语言，那就是Ruby。在我的Pi上安装了一个现代版的Ruby之后，我安装了<a class="ae jp" href="https://github.com/kenyonj/dashed" rel="noopener ugc nofollow" target="_blank">虚线宝石</a>，并按照说明进行设置。然而，无论我做什么，我都不能让它工作。在一番疯狂的谷歌搜索之后，我发现Dash按钮中的固件发生了变化，协议从ARP切换到了UDP。我还发现了一个<a class="ae jp" href="https://github.com/hortinstein/node-dash-button" rel="noopener ugc nofollow" target="_blank">节点库</a>，它得到了更好的支持，并且附带了很棒的文档，所以我决定使用它。</p><p id="6727" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我的Pi上安装了Node和node-dash-button库，以及libpcap(嗅探网络流量所需要的)，接下来我需要做的是设置我的dash按钮。我打开了亚马逊应用程序，在设置中，有一个设置你的dash按钮的链接。这使你的按钮通过你的WiFi网络连接到网络，并允许你每次按下按钮时选择你想要订购的产品。</p><p id="d65e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我跳过了最后一步，按照指示在我的Pi上运行“node _ modules/node-dash-button/bin/find button ”,嗅探我的网络以获取我的按钮的MAC地址。我依次按下每个按钮，毫不费力地得到了这些按钮的MAC地址。</p><p id="ccd3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后是我最喜欢的部分，写代码。我做的第一件事是捕捉每个按钮的按下并记录到控制台，以检查一切是否正常:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="1c0d" class="jz ka hu jv b fv kb kc l kd ke">var dash_button = require('node-dash-button');<br/>var bad_button = '' // The MAC address for the good button goes here<br/>var good_button = '' // The MAC address for the bad button goes here</span><span id="2de5" class="jz ka hu jv b fv kf kc l kd ke">var dash = dash_button([bad_button, good_button], null, null, 'all');</span><span id="f8af" class="jz ka hu jv b fv kf kc l kd ke">dash.on("detected", function (dash_id){<br/>  if (dash_id === bad_button){<br/>      console.log("Naughty!")<br/>  } else if (dash_id === good_button){<br/>      console.log("Good!");<br/>  }<br/>});</span></pre><p id="cc65" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我保存了这个文件(作为index.js ),并通过“sudo node index.js ”(您需要sudo，因为libpcap需要管理员权限)从命令行运行代码，令我惊讶的是，它竟然成功了！我确实遇到了一个问题，每次我按下按钮时，我都会在手机上收到亚马逊应用程序的唠叨推送通知，告诉我完成设置按钮，但幸运的是，你可以在亚马逊应用程序设置中关闭这一功能。下一步是在某个地方记录这些按钮按压。</p><p id="7695" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我之前提到过<a class="ae jp" href="http://bothan.io/" rel="noopener ugc nofollow" target="_blank">博塔恩</a>。我已经把学校的分数记录在那里了，所以把家里的分数也存储在那里是有意义的。</p><p id="7569" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Bothan最初是一个简单的API，用于开放数据研究所记录财务和其他指标，然后我们构建了可视化组件(因此您可以将数据视为图表、饼图、简单数字或目标图)，最后是一个仪表板构建工具。任何人都可以部署他们自己版本的Bothan，并且通过一个简单的REST API添加指标。我需要利用这个REST API来记录分数，因此，有了<a class="ae jp" href="https://github.com/request/request" rel="noopener ugc nofollow" target="_blank"> request </a>库，我开始工作并编写了一个方法来获取行为或优点的当前分数，加1，然后将最新的数据推送到Bothan:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="098b" class="jz ka hu jv b fv kb kc l kd ke">var bothan_url = '' // The URL of your Bothan install<br/>var bothan_username = '' // The URL of your Bothan install<br/>var bothan_password = '' // The URL of your Bothan install</span><span id="4ca4" class="jz ka hu jv b fv kf kc l kd ke">var postPoint = function(metric) {<br/>  var bothanURL = bothan_url<br/>  var metricURL = bothanURL + '/metrics/' + metric + '.json'<br/>  var date = new Date()</span><span id="d3f1" class="jz ka hu jv b fv kf kc l kd ke">  request(metricURL, function(error, response, body) {<br/>    json = JSON.parse(body)<br/>    value = (json == null) ? 0 : json.value</span><span id="7b42" class="jz ka hu jv b fv kf kc l kd ke">    request.post(metricURL, {<br/>      auth: {<br/>        user: bothan_username,<br/>        pass: bothan_password<br/>      },<br/>      json: {<br/>        time: date.toISOString(),<br/>        value: value + 1<br/>      }<br/>    })<br/>  })<br/>}</span></pre><p id="f7f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">(我意识到获取最新的指标并添加一个指标(以及一个额外的HTTP请求)是一件很麻烦的事情，所以我想对Bothan做的一个改进是添加一个/append API方法，只给一个给定的指标添加一个指标)</p><p id="30fb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用这种方法，只需要调用带有度量名称的方法来记录Bothan的行为或优点，就像这样:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="2af0" class="jz ka hu jv b fv kb kc l kd ke">dash.on("detected", function (dash_id) {<br/>  if (dash_id === bad_button){<br/>    console.log("Naughty!")<br/>    postPoint('home-behaviour-points')<br/>  } else if (dash_id === good_button){<br/>    console.log("Good!");<br/>    postPoint('home-acheivement-points')<br/>  }<br/>});</span></pre><p id="2f52" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，我添加了一个带有依赖项的package.json文件，以及一个脚本定义，这样代码就可以通过npm start运行，然后查看如何在引导时在我的Pi上自动运行它。我以前在其他项目中也这样做过(比如<a class="ae jp" href="http://www.ellieharrison.com/" rel="noopener ugc nofollow" target="_blank"> Ellie Harrison的</a>自动售货机艺术作品，我和一个同事在驱动它的原始笔记本电脑坏了之后重新设计了它)，并使用了init.d脚本，但这看起来有点大材小用。这一次，我只是在/etc/rc.local中添加了以下命令，让脚本在后台愉快地运行:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="87a2" class="jz ka hu jv b fv kb kc l kd ke">cd /home/pi/quantified-boy &amp;&amp; npm start &amp;</span></pre><p id="6c22" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">(这里最后一个&amp;很重要，因为它分叉了进程，否则Pi将只是运行这个脚本，永远不会正确引导)</p><p id="8fc3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我重新启动，测试，它的工作。拼图的最后一块是显示指标，所以我可以一眼看到我儿子做得怎么样，最重要的是，他可以在按下按钮后得到即时反馈。我使用Bothan的dashboarding特性来<a class="ae jp" href="http://demo.bothan.io/dashboards/bothan" rel="noopener ugc nofollow" target="_blank">构建一个仪表板</a>(在这里链接到一个演示)，并在~/中添加了以下内容。config/LX session/LXDE-pi/auto start文件，以kiosk模式在Chromium中打开仪表板URL，并阻止Pi进入睡眠状态，这样我就可以随时看到仪表板:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="3fbd" class="jz ka hu jv b fv kb kc l kd ke">@xset s off<br/>@xset -dpms<br/>@xset s noblank<br/>@chromium-browser --kiosk --incognito <a class="ae jp" href="http://demo.bothan.io/dashboards/bothan" rel="noopener ugc nofollow" target="_blank">http://demo.bothan.io/dashboards/bothan</a></span></pre><p id="df5d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后我重启Pi，在启动完成后，我看到了我的仪表板。最后，我花了27英镑从亚马逊买了一个5英寸的屏幕，把所有东西都放在了厨房里:</p><figure class="jq jr js jt fq kh fe ff paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="fe ff kg"><img src="../Images/52a51873589c45cb1d71dfad2d775517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tIBYW38GCxBp23NscMHfdQ.jpeg"/></div></div></figure><p id="56e6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">大约一个星期过去了，我的儿子喜欢玩按钮(我说“按钮”，因为出于某种原因，他从来不想按行为点按钮)。他喜欢看到分数上升的即时满足感，这是让他超越正常星盘的好方法。</p><p id="72f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最终的代码可以在Github上的<a class="ae jp" href="https://github.com/pezholio/quantified-boy/" rel="noopener ugc nofollow" target="_blank">这里</a>获得，你可以通过<a class="ae jp" href="https://bothan.io/" rel="noopener ugc nofollow" target="_blank"> bothan.io </a>安装你自己的免费Bothan实例。你可以用这个代码来测量任何东西。正如他们所说，唯一的限制是你的想象力！</p><div class="jq jr js jt fq ab cb"><figure class="ko kh kp kq kr ks kt paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ko kh kp kq kr ks kt paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ko kh kp kq kr ks kt paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ku kv kw"><p id="f922" class="ir is kx it b iu iv iw ix iy iz ja jb ky jd je jf kz jh ji jj la jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is kx it b iu iv iw ix iy iz ja jb ky jd je jf kz jh ji jj la jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jq jr js jt fq kh fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff lb"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure><figure class="jq jr js jt fq kh"><div class="bz el l di"><div class="lc ld l"/></div></figure></div></div>    
</body>
</html>