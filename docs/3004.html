<html>
<head>
<title>Nightmare of Operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">运营噩梦</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/nightmare-of-operations-708dd0a67dc6?source=collection_archive---------12-----------------------#2017-03-05">https://medium.com/hackernoon/nightmare-of-operations-708dd0a67dc6?source=collection_archive---------12-----------------------#2017-03-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/81d1df6a0575ed3e8a12ebfa5a951348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x5tXU8XusmO2DRrsUTF5gw.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Choose wisely or you’ll have an extra blog post assignment</figcaption></figure><p id="03d1" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我睁开眼睛。是<a class="ae ke" href="https://hackernoon.com/tagged/pitch-black" rel="noopener ugc nofollow" target="_blank">漆黑一片</a>。当我做最坏的打算时，恐慌开始了。我大声呼救，但尖叫中一道聚光灯打在了我的眼睛上，使我暂时失明。出于本能，我将手臂举到脸前挡住光线。当我的眼睛开始适应光线时，我看到了一个洋娃娃的轮廓。</p><p id="faad" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">几秒钟过去了，洋娃娃把头转向我，用法国口音说:</p><blockquote class="kf"><p id="ce30" class="kg kh hu bd ki kj kk kl km kn ko kd ek translated"><em class="kp">“我想玩ze游戏...Iz i = i++ ze同aaaz i++？”</em></p></blockquote><p id="da53" class="pw-post-body-paragraph jg jh hu ji b jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ku kb kc kd hn dt translated">作为一个一个月大的软件工程学生，我回想起我所有的经历来尝试回答这个问题。</p><p id="c168" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">就这样，我输了。</p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="fa02" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我从床上惊起，耳边响起了手机闹铃。我向右滑动关闭我的闹钟。完全清醒，我抬头看着天花板，恢复我的梦想。</p><p id="8b03" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh lc ld le lf b">i = i++</code>增加<code class="eh lc ld le lf b">i</code>然后把值分配给<code class="eh lc ld le lf b">i</code>吗？</p><p id="20ea" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">关于这个问题的某些东西引起了人们的兴趣，让他们想更深入地研究。所以我跳下床来到我的电脑前，想弄清楚这个谜。</p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="9287" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我戴上一些KPOP，开始写一个简单的测试。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div class="fe ff lg"><img src="../Images/05651591051ff3ad77add4b5bdf1fd3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*_klLEF6-V_uU_SlxXRBZaA.png"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">pretty self explanatory</figcaption></figure><p id="3df2" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">程序运行时，我的心怦怦直跳。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div class="fe ff ll"><img src="../Images/141b1fb895f9ce05b0ca1406e2270d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:52/format:webp/1*xxruBOTY4A0-VaPZ_uE1fQ.png"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">i done messed up</figcaption></figure><p id="586a" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">妈的，你搞砸了阿伦。</p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="1ad4" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在我不得不离开去上学之前，我有一段时间，所以我决定更深入地研究一下，看看汇编中到底发生了什么。</p><p id="0c3e" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我用gdb打开了测试程序的可执行文件，并在main上设置了一个断点，这样程序就会一直运行，直到main返回，然后停止。</p><p id="13ce" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh lc ld le lf b">(gdb) break main</code></p><p id="e64a" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">然后我用这个新的断点运行程序。</p><p id="feb7" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh lc ld le lf b">(gdb) run</code></p><p id="e51b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">最后，我想查看当前函数(main)的汇编指令，所以我使用了<code class="eh lc ld le lf b">disassemble</code>命令。</p><p id="1b5b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh lc ld le lf b">(gdb) disassemble</code></p><p id="9346" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">给了我这个。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div class="fe ff lm"><img src="../Images/8d775712ee4c890c23948789e5df4483.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*8PI4n8R7bNQ0oSOsM3nERA.png"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">assembly for test program</figcaption></figure><p id="947d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">快速组装课。</p><p id="39bc" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">立即值是常量，以<code class="eh lc ld le lf b">$</code>为前缀。像<code class="eh lc ld le lf b">$0xa</code>就是十六进制中的十进制10。寄存器名称以<code class="eh lc ld le lf b">%</code>为前缀。</p><p id="7cab" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">寄存器是计算机处理器中保存单个值的小内存空间。有两种类型的寄存器:通用寄存器和专用寄存器。在我们的代码示例中，<code class="eh lc ld le lf b">%eax</code>、<code class="eh lc ld le lf b">%edx</code>、<code class="eh lc ld le lf b">%esi</code>和<code class="eh lc ld le lf b">%edi</code>是通用寄存器，而<code class="eh lc ld le lf b">%rbp</code>和<code class="eh lc ld le lf b">%rsp</code>是专用寄存器。</p><p id="2c11" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">前两行称为函数前同步码。这将旧的基指针推到堆栈上，以便以后保存。然后，它将堆栈指针的值复制到基指针。所以在前两行之后，<code class="eh lc ld le lf b">%rbp</code>将指向main堆栈框架的底部。</p><p id="3dd9" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">跳过几行，我们可以看到十六进制的值<code class="eh lc ld le lf b">$0xa</code>被<code class="eh lc ld le lf b">movl</code>指令复制到<code class="eh lc ld le lf b">-0x4(%rbp)</code>中。<code class="eh lc ld le lf b">movl</code>与<code class="eh lc ld le lf b">mov</code>命令相同，但l表示操作数将是一个<code class="eh lc ld le lf b">long</code>。<code class="eh lc ld le lf b">-0x4(%rbp)</code>与<code class="eh lc ld le lf b">%rbp + -0x4</code>相同，因为堆栈向下增长，所以从当前堆栈帧的基数减去4实际上是访问当前帧本身。这是本地变量<code class="eh lc ld le lf b">i</code>存储的地方。所以<code class="eh lc ld le lf b">$0xa</code>被复制到局部变量<code class="eh lc ld le lf b">i</code>中。</p><p id="cc40" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">下一行是有趣的地方。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div class="fe ff ln"><img src="../Images/d7b5f5abf3c928fa7a170cd522c4a87a.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*yt4MqHTXjwvbdLmSjLirNg.png"/></div></figure><p id="a0f8" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh lc ld le lf b">lea</code>指令有点像<code class="eh lc ld le lf b">mov</code>指令。<code class="eh lc ld le lf b">mov</code>使用类似<code class="eh lc ld le lf b">mov &lt;destination&gt;, &lt;source&gt;</code>的语法，将内容从源移动到目的地。</p><p id="01cc" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">然而，<code class="eh lc ld le lf b">lea</code>将源地址移动到目的地址。它计算由第二个操作数指定的地址，就好像要从该操作数加载或存储数据一样，但是它将计算出的地址存储到由第一个操作数指定的寄存器中。</p><p id="587e" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">所以上面指令的意思是<code class="eh lc ld le lf b">%edx = %rax + 1</code>。</p><p id="1548" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">然后在下一行我们看到。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div class="fe ff lo"><img src="../Images/8fe5ddf1f39586d5dc77e0d65db0e9b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*TrMwsXaDFjm00NGx39lrqg.png"/></div></figure><p id="f284" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这将把值为<code class="eh lc ld le lf b">$0xa</code>的局部变量<code class="eh lc ld le lf b">i</code>的内容移动到<code class="eh lc ld le lf b">%edx</code>中。所以这个操作存储在另一个临时寄存器中，而不是原来的寄存器中。所以增量完成了，只是在另一个临时寄存器中。</p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="0d6f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">然后我将它与<code class="eh lc ld le lf b">i++</code>的第二次测试进行了比较。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div class="fe ff lp"><img src="../Images/a022b158873df59799116072db8f186e.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*lpmHxyXdXCvRfHKK56Os1Q.png"/></div></figure><p id="1776" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这给<code class="eh lc ld le lf b">i</code>增加了<code class="eh lc ld le lf b">$0x1</code>。</p><p id="178d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这解释了为什么<code class="eh lc ld le lf b">i = i++</code>返回<code class="eh lc ld le lf b">i</code>而不是<code class="eh lc ld le lf b">i + 1</code>。</p></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="d995" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">所以问题的关键是一个评价顺序的问题。</p><p id="ed3b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">所以当<code class="eh lc ld le lf b">i = i++</code>被编译时:</p><ol class=""><li id="f15b" class="lq lr hu ji b jj jk jn jo jr ls jv lt jz lu kd lv lw lx ly dt translated"><code class="eh lc ld le lf b">i</code>的值被复制到一个临时位置</li><li id="f908" class="lq lr hu ji b jj lz jn ma jr mb jv mc jz md kd lv lw lx ly dt translated">临时值递增并保存为新值(不覆盖)</li><li id="865e" class="lq lr hu ji b jj lz jn ma jr mb jv mc jz md kd lv lw lx ly dt translated">新值存储在<code class="eh lc ld le lf b">i</code>中</li><li id="fe4d" class="lq lr hu ji b jj lz jn ma jr mb jv mc jz md kd lv lw lx ly dt translated">然后<code class="eh lc ld le lf b">i</code>返回临时值，与原始值相同</li></ol></div><div class="ab cl kv kw hc kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hn ho hp hq hr"><p id="e49f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">找到答案后，我收拾好东西，准备去上学。</p><p id="02ae" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我到达学校时正好赶上我们的同伴学习日。</p><p id="7e26" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">当我的同事开始复习上周的作业时，我倾听并参与其中。然后不知从哪里，我听到了同样带着法国口音的问题:</p><h1 id="1add" class="me mf hu bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb dt translated">Iz i = i++ ze同aaaz i++？</h1><div class="lh li lj lk fq ab cb"><figure class="nc iv nd ne nf ng nh paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nc iv nd ne nf ng nh paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nc iv nd ne nf ng nh paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ni nj nk"><p id="f922" class="jg jh nl ji b jj jk jl jm jn jo jp jq nm js jt ju nn jw jx jy no ka kb kc kd hn dt translated"><a class="ae ke" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿妹家庭的一员。我们现在<a class="ae ke" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ke" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jg jh nl ji b jj jk jl jm jn jo jp jq nm js jt ju nn jw jx jy no ka kb kc kd hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ke" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ke" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff np"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="nq nr l"/></div></figure></div></div>    
</body>
</html>