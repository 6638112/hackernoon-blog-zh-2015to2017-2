<html>
<head>
<title>How to import data to Cloud Firestore?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将数据导入云Firestore？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/filling-cloud-firestore-with-data-3f67d26bd66e?source=collection_archive---------2-----------------------#2017-11-09">https://medium.com/hackernoon/filling-cloud-firestore-with-data-3f67d26bd66e?source=collection_archive---------2-----------------------#2017-11-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/106eae1bf62887d6c5abcda515340f96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nd3-Yr4AeAFF6bjbDHKk_g.png"/></div></div></figure><p id="fa05" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">不久前Firebase团队宣布了新的<strong class="je hv">文档数据库</strong>叫做<strong class="je hv"> Firestore。</strong>一个新的数据库有许多改进和新的能力。即使是现在的测试版，它也有和老兄弟一样的限制(100 000个并发连接)。从明显的优势来看:</p><ul class=""><li id="c8d8" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated">可量测性</li><li id="e772" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">多区域支持</li><li id="d0cd" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated"><strong class="je hv">面向文档的数据结构！</strong></li><li id="a58f" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">易于查询</li><li id="6672" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">离线支持(即使是web)</li></ul><p id="3691" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以，如果你准备好投入到<a class="ae ko" href="https://hackernoon.com/tagged/serverless" rel="noopener ugc nofollow" target="_blank">无服务器</a> <a class="ae ko" href="https://hackernoon.com/tagged/technologies" rel="noopener ugc nofollow" target="_blank">技术</a>的未来，这份教程就是为你准备的！</p><blockquote class="kp kq kr"><p id="0cb9" class="jc jd ks je b jf jg jh ji jj jk jl jm kt jo jp jq ku js jt ju kv jw jx jy jz hn dt translated">在本教程中，我将把<strong class="je hv"> Firebase实时数据库</strong>称为<strong class="je hv"> RTDB </strong>。</p></blockquote><h1 id="4e5b" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">如何导入数据？</h1><p id="567b" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">您可能会问自己的第一个问题是如何将数据推送到新数据库。旧的<strong class="je hv"> RTDB </strong>很棒，它具有作为单一JSON文件的导出/导入数据库的特性。</p><p id="17dc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于新的<strong class="je hv">云Firestore，</strong>我们需要自己实现一个机制。让我们假设您正试图从<strong class="je hv"> RTDB </strong>迁移到<strong class="je hv"> Firestore </strong>，因此您需要导出您当前的数据库快照。如果没有RDBM实例，可以使用任何JSON数据来测试这种方法。</p><h1 id="fd0f" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">加载数据的脚本</h1><p id="3709" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">为什么<a class="ae ko" href="https://firebase.google.com/docs/reference/admin/node/" rel="noopener ugc nofollow" target="_blank"><strong class="je hv">Firebase admin SDK</strong></a>而不是<strong class="je hv"> Firebase SDK？</strong></p><blockquote class="kp kq kr"><p id="ca2c" class="jc jd ks je b jf jg jh ji jj jk jl jm kt jo jp jq ku js jt ju kv jw jx jy jz hn dt translated">目前，使用<strong class="je hv"> firebase SDK </strong>(在4.6.1中测试)将嵌套数组推送到Firebase仍然存在问题。如果你试图使用Firebase SDK设置嵌套数组，你会得到如下结果:</p><p id="ed76" class="jc jd ks je b jf jg jh ji jj jk jl jm kt jo jp jq ku js jt ju kv jw jx jy jz hn dt translated"><code class="eh lz ma mb mc b"><em class="hu">Function DocumentReference.set() called with invalid data. Nested arrays are not supported.</em></code></p></blockquote><h2 id="184b" class="md kx hu bd ky me mf mg lc mh mi mj lg jn mk ml lk jr mm mn lo jv mo mp ls mq dt translated">证明</h2><p id="4759" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">要授权我们的应用程序，我们需要导出<strong class="je hv">服务密钥。</strong></p><figure class="ms mt mu mv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mr"><img src="../Images/2b44df7be89ae259815afb6d45db75e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*091DzZbQuErfgt6XVj7_lg.png"/></div></div><figcaption class="mw mx fg fe ff my mz bd b be z ek">Firebase Console</figcaption></figure><p id="d9ab" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在<strong class="je hv"> Firebase控制台</strong>中，点击<em class="ks">概述</em>部分旁边的设置轮，选择<em class="ks">用户和权限</em>选项。</p><figure class="ms mt mu mv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff na"><img src="../Images/c53d8a1f65d23a1b95724ec328b4e895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LPwC9xX8jr5iSOIxEUTP1w.png"/></div></div></figure><p id="2bcc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你将登陆<em class="ks">权限页面</em>。选择<em class="ks">服务帐户</em>选项卡，并填写数据，如上面的屏幕截图所示。填写复选框<em class="ks">提供一个新的私钥，</em>这样您就可以<strong class="je hv">下载</strong>您的密钥并在脚本中使用它。创建后，会询问您保存密钥的位置。我们将其保存为<code class="eh lz ma mb mc b">service-key.json</code></p><pre class="ms mt mu mv fq nb mc nc nd aw ne dt"><span id="3a7d" class="md kx hu mc b fv nf ng l nh ni">const admin = require('./node_modules/firebase-admin');<br/>const serviceAccount = require("./service-key.json");</span><span id="faaf" class="md kx hu mc b fv nj ng l nh ni">admin.initializeApp({<br/>  credential: admin.credential.cert(serviceAccount),  <br/>  databaseURL: "https://YOUR_DB.firebaseio.com"<br/>});</span></pre><p id="cacc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh lz ma mb mc b">credentials</code> —该属性将由刚刚创建的<strong class="je hv">服务账户密钥</strong>填充</p><p id="927a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">【firebaseio.com】—是您的数据库实例的名称+T2</p><figure class="ms mt mu mv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nk"><img src="../Images/6f6c60deccf6a14e1b0681981ebc5f22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y0R2dWgStq6twbI55tVWqA.png"/></div></div><figcaption class="mw mx fg fe ff my mz bd b be z ek"><strong class="bd nl">https://cf-studio-dev.firebaseio.com</strong> and <a class="ae ko" href="https://cf-studio-dev.firebaseio.com" rel="noopener ugc nofollow" target="_blank"><strong class="bd nl">https://cf-studio.firebaseio.com</strong></a></figcaption></figure><h2 id="7228" class="md kx hu bd ky me mf mg lc mh mi mj lg jn mk ml lk jr mm mn lo jv mo mp ls mq dt translated">脚本的其余部分</h2><figure class="ms mt mu mv fq iv"><div class="bz el l di"><div class="nm nn l"/></div></figure><p id="f14c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">只要数组也是对象，这个脚本就完全可以使用。</p><pre class="ms mt mu mv fq nb mc nc nd aw ne dt"><span id="0f9b" class="md kx hu mc b fv nf ng l nh ni">$ node json-to-firestore.js</span></pre><p id="92ec" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请记住，脚本依赖于几个文件:</p><p id="f20a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh lz ma mb mc b">firebase-admin</code> — npm模块，可以本地安装到脚本的文件夹下</p><p id="937e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh lz ma mb mc b">service-key.json</code> —我们在<strong class="je hv">认证</strong>部分生成的文件</p><p id="c0d9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh lz ma mb mc b">data.json</code> —实际上是我们想要推送到我们的<strong class="je hv"> Firestore </strong>的数据</p><h1 id="e404" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">结论</h1><p id="9b4d" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated"><strong class="je hv">云火石</strong>看起来很有前景。尽管它还处于测试阶段，但这并不意味着你不应该得到它。众所周知的Firebase产品叫做<strong class="je hv">云函数</strong>(仍在测试阶段)已经被数千个项目使用。</p><p id="3449" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本文中，我介绍了一种向云商店提交JSON数据的简单方法。如果您对使用<strong class="je hv"> Angular </strong>框架配置<strong class="je hv"> Firebase hosting </strong>感兴趣，请学习<a class="ae ko" href="https://hackernoon.com/from-zero-to-production-with-angular-firebase-and-gitlab-ci-598181cfc6e5" rel="noopener ugc nofollow" target="_blank">如何使用Angular、Firebase和GitLab CI </a>从零到生产。</p><figure class="ms mt mu mv fq iv"><div class="bz el l di"><div class="no nn l"/></div></figure></div></div>    
</body>
</html>