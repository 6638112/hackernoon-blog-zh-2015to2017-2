<html>
<head>
<title>How to set up a postcss pipeline with variable sharing in gulp</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在gulp中设置带有变量共享的postcss管道</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-set-up-a-postcss-pipeline-with-variable-sharing-in-gulp-4e77624cc749?source=collection_archive---------7-----------------------#2017-04-09">https://medium.com/hackernoon/how-to-set-up-a-postcss-pipeline-with-variable-sharing-in-gulp-4e77624cc749?source=collection_archive---------7-----------------------#2017-04-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="fe46" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">利用<a class="ae jj" href="http://postcss.org/" rel="noopener ugc nofollow" target="_blank"> postcss </a>和<a class="ae jj" href="http://cssnext.io/" rel="noopener ugc nofollow" target="_blank"> cssnext </a>面向未来的css，以及css和js之间的变量共享，从头开始创建一个样式管道。</h2></div><p id="4183" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">用gulp为postcss设置一个基本的<a class="ae jj" href="https://hackernoon.com/tagged/workflow" rel="noopener ugc nofollow" target="_blank">工作流</a>相当简单。Cssnext还允许我们在一个中央<a class="ae jj" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> javascript </a>文件中指定变量，这些变量可以在整个代码库中使用。这意味着您可以进一步标准化样式，对于css和javascript中的样式有时是不可避免的(例如数据可视化)。</p><p id="8b58" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我将主要关注提供对变量、自定义媒体查询和部分导入的支持。为了使本教程保持合理的简短，我不能涵盖更多，但我希望到最后你会有足够的概述，能够添加自己的插件，以利用postcss的更高级的功能。</p><p id="8b62" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">这个例子的源代码可以在<a class="ae jj" href="https://github.com/zimrick/postcss-starter-gulp" rel="noopener ugc nofollow" target="_blank"> github </a>上找到。</p><h1 id="36ac" class="kg kh hu bd ki kj kk kl km kn ko kp kq ja kr jb ks jd kt je ku jg kv jh kw kx dt translated">1.吞咽的基本设置</h1><p id="e470" class="pw-post-body-paragraph jk jl hu jm b jn ky iv jp jq kz iy js jt la jv jw jx lb jz ka kb lc kd ke kf hn dt translated">要开始使用npm初始化一个新文件夹。在这个文件夹中，你需要一个src和css文件夹。src文件夹将包含未编译的css，css文件夹将包含已处理/已编译的css文件。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="4b8c" class="lm kh hu li b fv ln lo l lp lq">$ mkdir postcss-starter-gulp &amp;&amp; cd postcss-starter-gulp<br/>$ npm init<br/>...<br/>$ mkdir src css</span></pre><h1 id="d7c6" class="kg kh hu bd ki kj kk kl km kn ko kp kq ja kr jb ks jd kt je ku jg kv jh kw kx dt translated">2.添加gulp依赖项</h1><p id="dcc6" class="pw-post-body-paragraph jk jl hu jm b jn ky iv jp jq kz iy js jt la jv jw jx lb jz ka kb lc kd ke kf hn dt translated">接下来，你将不得不安装gulp和一些额外的gulp包。确保它们都列在<code class="eh lr ls lt li b">package.json</code>中。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="cce3" class="lm kh hu li b fv ln lo l lp lq">$ npm install gulp gulp-postcss autoprefixer postcss-cssnext postcss-partial-import --save-dev</span></pre><h1 id="19da" class="kg kh hu bd ki kj kk kl km kn ko kp kq ja kr jb ks jd kt je ku jg kv jh kw kx dt translated">3.添加gulpfile</h1><p id="c073" class="pw-post-body-paragraph jk jl hu jm b jn ky iv jp jq kz iy js jt la jv jw jx lb jz ka kb lc kd ke kf hn dt translated">在项目的根目录下创建一个<code class="eh lr ls lt li b">gulpfile.js</code>。文件应该是这样的:</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="7b9b" class="lm kh hu li b fv ln lo l lp lq"><em class="lu">// gulpfile.js</em></span><span id="3e72" class="lm kh hu li b fv lv lo l lp lq">var gulp = require("gulp")<br/>var postcss = require("gulp-postcss")<br/>var partialImport = require("postcss-partial-import")<br/>var cssnext = require("postcss-cssnext")</span><span id="c464" class="lm kh hu li b fv lv lo l lp lq">gulp.task("css:build", function() {<br/>    var processors = [<br/>        partialImport(),<br/>        cssnext({<br/>            browsers: ["&gt; 1%"],<br/>        })<br/>    ]<br/>    return gulp.src("./src/main.css")<br/>               .pipe(postcss(processors))<br/>               .pipe(gulp.dest("./css"))<br/>})</span><span id="d03a" class="lm kh hu li b fv lv lo l lp lq">gulp.task("default", function() {<br/>    gulp.watch("./src/**/*.css", ["css:build"])<br/>})</span></pre><p id="da41" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我们的gulpfile包含两个任务，一个用于构建css文件，另一个默认任务用于观察src目录的变化。当src文件夹中的任何内容发生变化时，观察器将运行build命令。构建任务将在src目录中查找main.css文件，并使用指定的处理器(在本例中为partialImport和cssnext)处理该文件。<a class="ae jj" href="http://cssnext.io/usage/#browsers" rel="noopener ugc nofollow" target="_blank"> Cssnext将对css进行改造，以兼容市场份额超过1%的浏览器(根据caniuse数据库)</a>。处理后的css将被输出到<code class="eh lr ls lt li b">./css</code>目录。</p><p id="edf2" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">为了在不全局安装gulp的情况下运行我们项目中的gulp任务，我们需要向我们的<code class="eh lr ls lt li b">package.json</code>添加一些npm脚本。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="eba7" class="lm kh hu li b fv ln lo l lp lq"><em class="lu">// package.json</em></span><span id="6211" class="lm kh hu li b fv lv lo l lp lq">...<br/>  "scripts": {<br/>    "css:watch": "gulp",<br/>    "css:build": "gulp css:build", <br/>    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"<br/>  },<br/>...</span></pre><p id="353d" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">现在我们可以使用npm、<code class="eh lr ls lt li b">$ npm run css:watch</code>和<code class="eh lr ls lt li b">$ npm run css:build</code>运行gulp任务。</p><h1 id="0f2a" class="kg kh hu bd ki kj kk kl km kn ko kp kq ja kr jb ks jd kt je ku jg kv jh kw kx dt translated">4.添加示例css</h1><p id="9dc7" class="pw-post-body-paragraph jk jl hu jm b jn ky iv jp jq kz iy js jt la jv jw jx lb jz ka kb lc kd ke kf hn dt translated">在src目录中创建一个main.css文件，并添加一些示例css(如下所示)来检查编译过程。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="afb4" class="lm kh hu li b fv ln lo l lp lq"><em class="lu">// ./src/main.css</em></span><span id="7258" class="lm kh hu li b fv lv lo l lp lq">:root {<br/>  --color-blue: #2196F3;<br/>  --color-pink: #E91E63;<br/>}</span><span id="3a30" class="lm kh hu li b fv lv lo l lp lq">@custom-media --md-viewport (min-width: 62em);</span><span id="dbb5" class="lm kh hu li b fv lv lo l lp lq">.blue-container {<br/>  background: var(--color-blue);<br/>}</span><span id="d242" class="lm kh hu li b fv lv lo l lp lq"><a class="ae jj" href="http://twitter.com/media" rel="noopener ugc nofollow" target="_blank">@</a>media (--md-viewport) {<br/>  .blue-container {<br/>    background: var(--color-pink);<br/>  }<br/>}</span></pre><p id="cc2c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">一旦你通过npm运行吞咽任务…</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="e685" class="lm kh hu li b fv ln lo l lp lq">$ npm run css:build</span></pre><p id="91f3" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">…上面的css应该成功编译成这样:</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="1155" class="lm kh hu li b fv ln lo l lp lq"><em class="lu">// ./css/main.css</em></span><span id="0810" class="lm kh hu li b fv lv lo l lp lq">.blue-container {<br/>  background: #2196F3;<br/>}</span><span id="b24f" class="lm kh hu li b fv lv lo l lp lq"><a class="ae jj" href="http://twitter.com/media" rel="noopener ugc nofollow" target="_blank">@</a>media (min-width: 62em) {<br/>  .blue-container {<br/>    background: #E91E63;<br/>  }<br/>}</span></pre><h1 id="3ec0" class="kg kh hu bd ki kj kk kl km kn ko kp kq ja kr jb ks jd kt je ku jg kv jh kw kx dt translated">5.添加js变量和js媒体查询</h1><p id="4983" class="pw-post-body-paragraph jk jl hu jm b jn ky iv jp jq kz iy js jt la jv jw jx lb jz ka kb lc kd ke kf hn dt translated">更进一步，我们可以让变量<code class="eh lr ls lt li b">color-blue</code>和<code class="eh lr ls lt li b">color-pink</code>对css文件和javascript文件都可用。为此，你必须创建一个<code class="eh lr ls lt li b">./src/styleVariables.js</code>，一个<code class="eh lr ls lt li b">./src/mediaQueries.js</code>，并修改<code class="eh lr ls lt li b">./src/main.css</code>和<code class="eh lr ls lt li b">gulpfile.js</code>。</p><p id="d977" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">首先，从main.css中删除所有变量定义和自定义媒体查询定义。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="68d7" class="lm kh hu li b fv ln lo l lp lq"><em class="lu">// ./src/main.css</em></span><span id="c004" class="lm kh hu li b fv lv lo l lp lq">.blue-container {<br/>  background: var(--color-blue);<br/>}</span><span id="c0da" class="lm kh hu li b fv lv lo l lp lq"><a class="ae jj" href="http://twitter.com/media" rel="noopener ugc nofollow" target="_blank">@</a>media (--md-viewport) {<br/>  .blue-container {<br/>    background: var(--color-pink);<br/>  }<br/>}</span></pre><p id="8edc" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">接下来，在<code class="eh lr ls lt li b">./src/styleVariables.js</code>中的一个简单javascript对象中定义变量。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="d4c1" class="lm kh hu li b fv ln lo l lp lq"><em class="lu">// ./src/styleVariables.js</em></span><span id="ee62" class="lm kh hu li b fv lv lo l lp lq">module.exports = {<br/>  "color-blue": "#2196F3",<br/>  "color-pink": "#E91E63",<br/>}</span></pre><p id="9d22" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">然后在<code class="eh lr ls lt li b">./src/mediaQueries.js</code>中将您的媒体查询也定义为一个简单的javascript对象。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="c571" class="lm kh hu li b fv ln lo l lp lq"><em class="lu">// ./src/mediaQueries.js</em></span><span id="1a57" class="lm kh hu li b fv lv lo l lp lq">module.exports = {<br/>  "md-viewport": "(min-width: 62em)",<br/>}</span></pre><p id="25dd" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">最后，您必须让cssnext处理器知道styleVariables.js和mediaQueries.js的存在。为此，将<code class="eh lr ls lt li b">styleVariables.js</code>和<code class="eh lr ls lt li b">mediaQueries.js</code>导入gulpfile，并将其插入cssnext选项。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="3d98" class="lm kh hu li b fv ln lo l lp lq"><em class="lu">// gulpfile.js</em></span><span id="6621" class="lm kh hu li b fv lv lo l lp lq">var gulp = require("gulp")<br/>var postcss = require("gulp-postcss")<br/>var partialImport = require("postcss-partial-import")<br/>var cssnext = require("postcss-cssnext")</span><span id="17a5" class="lm kh hu li b fv lv lo l lp lq"><strong class="li hv">var styleVariables = require("./src/styleVariables")<br/>var mediaQueries = require("./src/mediaQueries")</strong></span><span id="7b98" class="lm kh hu li b fv lv lo l lp lq">gulp.task("css:build", function() {<br/>    var processors = [<br/>        partialImport(),<br/>        cssnext({<br/>            browsers: ["&gt; 1%"],<br/>            <strong class="li hv">features: {<br/>              customProperties: {<br/>                variables: styleVariables,<br/>              },<br/>              customMedia: {<br/>                extensions: mediaQueries,<br/>              }<br/>            }</strong><br/>        })<br/>    ]<br/>    return gulp.src("./src/main.css")<br/>               .pipe(postcss(processors))<br/>               .pipe(gulp.dest("./css"))<br/>})</span><span id="5cb0" class="lm kh hu li b fv lv lo l lp lq">gulp.task("default", function() {<br/>    gulp.watch("./src/**/*.css", ["css:build"])<br/>})</span></pre><p id="b197" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">所以现在你有了一个简单的postcss处理器，它允许你在css和js之间共享变量。对于可以添加到这个设置中的其他酷东西，请查看<a class="ae jj" href="https://github.com/postcss/postcss#plugins" rel="noopener ugc nofollow" target="_blank"> postcss github repo </a>。</p><p id="dd09" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">你可以在<a class="ae jj" href="https://github.com/zimrick/postcss-starter-gulp" rel="noopener ugc nofollow" target="_blank"> github </a>上找到本教程使用的代码。</p><blockquote class="lw lx ly"><p id="e0ca" class="jk jl lu jm b jn jo iv jp jq jr iy js lz ju jv jw ma jy jz ka mb kc kd ke kf hn dt translated"><a class="ae jj" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是这个大家庭的一员。我们现在<a class="ae jj" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">正在接受投稿</a>，并乐意<a class="ae jj" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="jk jl lu jm b jn jo iv jp jq jr iy js lz ju jv jw ma jy jz ka mb kc kd ke kf hn dt translated">要了解更多信息，<a class="ae jj" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a> , <a class="ae jj" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">喜欢/在脸书给我们发消息</a>，或者简单地，<a class="ae jj" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank">发推文/DM @HackerNoon。</a></p><p id="708a" class="jk jl lu jm b jn jo iv jp jq jr iy js lz ju jv jw ma jy jz ka mb kc kd ke kf hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jj" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jj" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ld le lf lg fq mc"><div class="bz el l di"><div class="md me l"/></div></figure></div></div>    
</body>
</html>