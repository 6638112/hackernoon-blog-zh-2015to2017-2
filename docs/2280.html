<html>
<head>
<title>[AWS] Tutorial SQS(Message Queuing Service)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[AWS]教程SQS(消息队列服务)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/aws-sqs-queue-send-message-nodejs-javascript-helloworld-setup-config-5e9bb26f6dec?source=collection_archive---------6-----------------------#2017-01-17">https://medium.com/hackernoon/aws-sqs-queue-send-message-nodejs-javascript-helloworld-setup-config-5e9bb26f6dec?source=collection_archive---------6-----------------------#2017-01-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/3afb5a073509cbcefb14899609026ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iIBdIwzbHwMPtNgZitXUig.png"/></div></div></figure><p id="4f89" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">建立你自己的服务器需要很好的知识，这样你就不会遗漏任何一个角落。这不是亚马逊SQS的情况，因为它可以很快上手。</p><blockquote class="ka kb kc"><p id="3551" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">SQS的美妙之处还在于它不会丢失东西——独立于任何服务器——而且它消除了两个线程试图做相同的工作和碰撞头的情况。</p><p id="4106" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">一旦任何东西接收到队列中的消息，它们就在一定时间内拥有对它的独占租约。当您需要扩展到多个工作服务器时，这一点尤其重要。每一个都只是获得队列中的下一个作业，独立于其他作业完成自己的工作，然后一旦完成就从队列中删除它(Jason Byrne )。</p></blockquote><h2 id="b753" class="ki kj hu bd kk kl km kn ko kp kq kr ks jn kt ku kv jr kw kx ky jv kz la lb lc dt translated">备注:</h2><p id="c708" class="pw-post-body-paragraph jc jd hu je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated">—在开始下面的步骤之前，克隆<a class="ae kh" href="https://github.com/wahengchang/aws-sqs-example" rel="noopener ugc nofollow" target="_blank">示例Git </a>，并进行npm安装。</p><h1 id="3d8a" class="li kj hu bd kk lj lk ll ko lm ln lo ks lp lq lr kv ls lt lu ky lv lw lx lb ly dt translated">步骤:</h1><ol class=""><li id="ec91" class="lz ma hu je b jf ld jj le jn mb jr mc jv md jz me mf mg mh dt translated">设置访问密钥和秘密密钥</li><li id="3c16" class="lz ma hu je b jf mi jj mj jn mk jr ml jv mm jz me mf mg mh dt translated">$ node sqs_createqueue.js</li><li id="c95c" class="lz ma hu je b jf mi jj mj jn mk jr ml jv mm jz me mf mg mh dt translated">$ node sqs_listqueues.js</li><li id="e260" class="lz ma hu je b jf mi jj mj jn mk jr ml jv mm jz me mf mg mh dt translated">$ node sqs_getqueueurl.js(返回url用于步骤5和6)</li><li id="9607" class="lz ma hu je b jf mi jj mj jn mk jr ml jv mm jz me mf mg mh dt translated">$ node sendMessage.js</li><li id="6344" class="lz ma hu je b jf mi jj mj jn mk jr ml jv mm jz me mf mg mh dt translated">$ node接收消息. js</li></ol></div><div class="ab cl mn mo hc mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="hn ho hp hq hr"><h1 id="c117" class="li kj hu bd kk lj mu ll ko lm mv lo ks lp mw lr kv ls mx lu ky lv my lx lb ly dt translated">1-设置访问密钥和秘密密钥</h1><figure class="na nb nc nd fq iv fe ff paragraph-image"><div class="fe ff mz"><img src="../Images/bbd077400c9a486561b3e3eef1ab2bbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*RMFyUV7imuAsyNaU38H7-w.png"/></div></figure><p id="b313" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">进入<strong class="je hv"> <em class="kd"> IAM管理控制台</em> </strong>创建一个用户，系统将为其生成访问密钥和秘密密钥(<a class="ae kh" href="http://docs.aws.amazon.com/IAM/latest/UserGuide/console_controlling-access.html" rel="noopener ugc nofollow" target="_blank">了解更多信息</a>)。</p><p id="f6f5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建用户之前，需要具有SQS权限的已配置组。在权限窗口中，选择<strong class="je hv"><em class="kd">AmazonSQSFullAccess</em></strong>的点击框，然后选择下一步。</p><figure class="na nb nc nd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ne"><img src="../Images/9d1794ffd0f92f822dcff3c506439a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VF9Gr04L4rgNF7OFW63BjQ.png"/></div></div></figure><p id="81a2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将用户添加到具有访问SQS权限的组中。</p><figure class="na nb nc nd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nf"><img src="../Images/f27318c8592ef958692d712b533f389b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bxl6JeTFHTtGtYz4ny4wBg.png"/></div></div></figure><p id="723c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">生成<strong class="je hv"> <em class="kd"> access-key </em> </strong>和<strong class="je hv"> <em class="kd"> secret-key </em> </strong>，稍后将在<strong class="je hv"> <em class="kd"> config.json </em> </strong>中使用。</p><figure class="na nb nc nd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ng"><img src="../Images/c131b9afa8384a367f10128a58f000e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXRF2rMah2UEN44rjUVFyQ.jpeg"/></div></div></figure><p id="b8e9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在Node.js目录下创建一个<strong class="je hv"> <em class="kd"> config.json </em> </strong>文件，将上一步生成的<strong class="je hv"> <em class="kd"> access-key </em> </strong>和<strong class="je hv"> <em class="kd"> secret-key </em> </strong>粘贴到字段<strong class="je hv"><em class="kd"/></strong>和<strong class="je hv"><em class="kd">secretAccessKey</em></strong>中。</p><figure class="na nb nc nd fq iv fe ff paragraph-image"><div class="fe ff nh"><img src="../Images/c48a7f808965feb521a2b4cfc54fac9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*GqfaTzwmZdYR4DWEBLlcrg.png"/></div></figure></div><div class="ab cl mn mo hc mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="hn ho hp hq hr"><h1 id="c759" class="li kj hu bd kk lj mu ll ko lm mv lo ks lp mw lr kv ls mx lu ky lv my lx lb ly dt translated">2-创建队列</h1><p id="151e" class="pw-post-body-paragraph jc jd hu je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated">亚马逊不仅给我们带来了多样化的东西，它还为我们提供了非常容易阅读的文档和非常容易使用的示例代码。有了<a class="ae kh" href="http://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/sqs-examples-using-queues.html" rel="noopener ugc nofollow" target="_blank"> doc </a>和git示例，运行Helloworld示例，发送/接收消息只是小菜一碟。</p><figure class="na nb nc nd fq iv fe ff paragraph-image"><div class="fe ff ni"><img src="../Images/991d9db895ad3adfa8679d46737c302f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*D7axIKVVR83ZwVpz34gpzg.png"/></div></figure><h2 id="cf6d" class="ki kj hu bd kk kl km kn ko kp kq kr ks jn kt ku kv jr kw kx ky jv kz la lb lc dt translated">创建队列</h2><p id="dc71" class="pw-post-body-paragraph jc jd hu je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated">运行sqs_createqueue.js文件</p><figure class="na nb nc nd fq iv fe ff paragraph-image"><div class="fe ff nj"><img src="../Images/3633527de0a4577d06b2acd39643fdd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*0aAqpunMUAVkq7y54uYSSw.png"/></div></figure><pre class="na nb nc nd fq nk nl nm nn aw no dt"><span id="5db0" class="ki kj hu nl b fv np nq l nr ns"><br/>$ node sqs_createqueue.js</span><span id="563f" class="ki kj hu nl b fv nt nq l nr ns">Success https://sqs.us-east-1.amazonaws.com/xxx/SQS_QUEUE_NAME</span></pre><h2 id="abed" class="ki kj hu bd kk kl km kn ko kp kq kr ks jn kt ku kv jr kw kx ky jv kz la lb lc dt translated">列表队列</h2><pre class="na nb nc nd fq nk nl nm nn aw no dt"><span id="ac90" class="ki kj hu nl b fv np nq l nr ns">$ node sqs_listqueues.js</span><span id="131b" class="ki kj hu nl b fv nt nq l nr ns">Success [ 'https://sqs.us-east-1.amazonaws.com/xxx/SQS_QUEUE_NAME' ]</span></pre><h2 id="ec05" class="ki kj hu bd kk kl km kn ko kp kq kr ks jn kt ku kv jr kw kx ky jv kz la lb lc dt translated">获取队列Url</h2><pre class="na nb nc nd fq nk nl nm nn aw no dt"><span id="ed1f" class="ki kj hu nl b fv np nq l nr ns">$ node sqs_getqueueurl.js</span><span id="a8b3" class="ki kj hu nl b fv nt nq l nr ns">Success <a class="ae kh" href="https://sqs.us-east-1.amazonaws.com/xxx/SQS_QUEUE_NAME" rel="noopener ugc nofollow" target="_blank"><strong class="nl hv">https://sqs.us-east-1.amazonaws.com/xxx/SQS_QUEUE_NAME</strong></a></span></pre><p id="36ba" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在<strong class="je hv"> sendMessage.js </strong>中，将返回结果的值设置为有价值的<strong class="je hv"> QueueUrl </strong>，将发送<strong class="je hv"> <em class="kd">消息“关于当前纽约时间的信息……”</em></strong>:</p><figure class="na nb nc nd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nu"><img src="../Images/d0fea7a20344075fed33c18380d7a81b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WUB5el9T6jJh6MnE4Ya8eQ.png"/></div></div></figure><h2 id="8682" class="ki kj hu bd kk kl km kn ko kp kq kr ks jn kt ku kv jr kw kx ky jv kz la lb lc dt translated">将消息发送到队列</h2><pre class="na nb nc nd fq nk nl nm nn aw no dt"><span id="b6f3" class="ki kj hu nl b fv np nq l nr ns">$ node sendMessage.js</span><span id="a858" class="ki kj hu nl b fv nt nq l nr ns">Success 169607bb-xxx-xxx-xxx-d4d1cc270e9f</span></pre><h2 id="57f4" class="ki kj hu bd kk kl km kn ko kp kq kr ks jn kt ku kv jr kw kx ky jv kz la lb lc dt translated">从队列接收消息</h2><p id="a94f" class="pw-post-body-paragraph jc jd hu je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated">在<strong class="je hv"> receiveMessage.js </strong>中，将来自<strong class="je hv"> sqs_getqueueurl.js </strong>结果的值设置为<strong class="je hv"> QueueUrl </strong>:</p><pre class="na nb nc nd fq nk nl nm nn aw no dt"><span id="7f61" class="ki kj hu nl b fv np nq l nr ns">$ node receiveMessage.js</span><span id="4af5" class="ki kj hu nl b fv nt nq l nr ns">{ ResponseMetadata: { RequestId: 'f7ae9017-0692-5eae-874e-c0e0a13a070b' },</span><span id="4cfa" class="ki kj hu nl b fv nt nq l nr ns">Messages:</span><span id="1062" class="ki kj hu nl b fv nt nq l nr ns">[ { MessageId: '169607bb-3d5a-4dab-a8bf-d4d1cc270e9f',<br/>    ReceiptHandle: 'xxx',<br/>    MD5OfBody: 'xxx',<br/><strong class="nl hv"><em class="kd">    Body: 'Information about current NY Times fiction bestseller for week of 12/11/2016.',<br/></em></strong>    Attributes: [Object],<br/>    MD5OfMessageAttributes: 'xxxx',<br/>    MessageAttributes: [Object] } ] }</span></pre></div><div class="ab cl mn mo hc mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="hn ho hp hq hr"><h1 id="4964" class="li kj hu bd kk lj mu ll ko lm mv lo ks lp mw lr kv ls mx lu ky lv my lx lb ly dt translated">注意</h1><h2 id="b863" class="ki kj hu bd kk kl km kn ko kp kq kr ks jn kt ku kv jr kw kx ky jv kz la lb lc dt translated">消息属性与消息正文</h2><p id="23ab" class="pw-post-body-paragraph jc jd hu je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated">— <strong class="je hv"> <em class="kd">消息属性</em> </strong>应该被用作消息元数据(如时间戳或可能的某个类别)，而不是消息本身。</p><p id="5823" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt">—</p><h1 id="dd00" class="li kj hu bd kk lj lk ll ko lm ln lo ks lp lq lr kv ls lt lu ky lv lw lx lb ly dt translated">参考:</h1><p id="e73e" class="pw-post-body-paragraph jc jd hu je b jf ld jh ji jj le jl jm jn lf jp jq jr lg jt ju jv lh jx jy jz hn dt translated"><a class="ae kh" href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/master/javascript/example_code/sqs" rel="noopener ugc nofollow" target="_blank">https://github . com/AWS docs/AWS-doc-SDK-examples/tree/master/JavaScript/example _ code/SQS</a></p><p id="2377" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae kh" href="http://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/sqs-examples-using-queues.html" rel="noopener ugc nofollow" target="_blank">http://docs . AWS . Amazon . com/SDK-for-JavaScript/v2/developer-guide/SQS-examples-using-queues . html</a></p><p id="dc00" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae kh" href="https://github.com/wahengchang/aws-sqs-example" rel="noopener ugc nofollow" target="_blank">https://github.com/wahengchang/aws-sqs-example</a></p><div class="na nb nc nd fq ab cb"><figure class="nv iv nw nx ny nz oa paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nv iv nw nx ny nz oa paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nv iv nw nx ny nz oa paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ka kb kc"><p id="f922" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated"><a class="ae kh" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kh" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kh" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kh" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kh" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kh" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="na nb nc nd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ob"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>