<html>
<head>
<title>How Python Coders Tried to Kill my Supposedly Secure JavaScript API Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python程序员如何试图扼杀我的所谓安全的JavaScript API服务</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-python-coders-tried-to-kill-my-supposedly-secure-javascript-api-service-71698d36bb96?source=collection_archive---------4-----------------------#2017-06-20">https://medium.com/hackernoon/how-python-coders-tried-to-kill-my-supposedly-secure-javascript-api-service-71698d36bb96?source=collection_archive---------4-----------------------#2017-06-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="628f" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">一个开发者的噩梦</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/cc93e8a99954bfc0076b368441ea8e9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wSRJ7bY1pnstwacC."/></div></div></figure><p id="08f0" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated"><em class="kr">免责声明:在撰写本文期间，没有任何Python或JavaScript编码人员受到伤害。所有涉及编码员的行为都是安全模拟的，纯属虚构。</em></p><p id="f3a0" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">你有没有试过启动一个应用程序，却发现你的数字资产被你的API安全漏洞丢失了？你会想象像《精灵宝可梦GO》一样广受欢迎，但又像《精灵宝可梦GO》一样，担心你会失去对应用程序功能的控制，并且<a class="ae ks" href="https://www.approov.io/blog/securing-pokemon.html" rel="noopener ugc nofollow" target="_blank">会激怒你的用户群</a>？</p><p id="f56a" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">2016年11月，Fallible的人创造了一个<a class="ae ks" href="https://android.fallible.co/" rel="noopener ugc nofollow" target="_blank">在线工具</a>来逆向工程任何android应用程序以寻找秘密。在超过16，000个测试应用中，他们发现大约有<a class="ae ks" href="https://hackernoon.com/we-reverse-engineered-16k-apps-heres-what-we-found-51bdf3b456bb#.ptkd7fo2o" rel="noopener ugc nofollow" target="_blank"> 2500个应用包含API密钥和/或秘密</a>。这对安全不利。</p><h1 id="e0da" class="kt ku hu bd kv kw kx ky kz la lb lc ld ja le jb lf jd lg je lh jg li jh lj lk dt translated">代码冲浪</h1><p id="487d" class="pw-post-body-paragraph jv jw hu jx b jy ll iv ka kb lm iy kd ke ln kg kh ki lo kk kl km lp ko kp kq hn dt translated">最近，为了提高我的JavaScript技能，我不想进行紧张的多日黑客马拉松，只是偶尔和其他程序员聚几个晚上。由此诞生了<em class="kr"> JavaScript代码冲浪</em> app。概念很简单；一个有着有趣项目和像样的WiFi的主机程序员会宣传一个聚会，其他程序员可以注册参加。主持人在他的项目上获得了一些关注，而与会者开始建立他们的JavaScript印章。这种商业模式完全是利他主义的，尽管我可以看到将这项服务充分货币化的方法，使其能够自给自足。</p><p id="8ada" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我先用Node.js/Express,移动版构建了后端，最初推出了一个Android应用，iOS紧随其后，我用一个简单的RESTful API将所有东西绑在一起。前端和后端实现都是完全开源的。</p><p id="ecfe" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我使用了几个第三方API服务。例如，我使用了<a class="ae ks" href="https://developer.github.com/v3/" rel="noopener ugc nofollow" target="_blank"> GitHub API </a>来评估一个程序员的JavaScript声誉，基于他们的公共存储库活动和贡献。从一开始，我就用双因素授权实现了<a class="ae ks" href="https://oauth.net/2/" rel="noopener ugc nofollow" target="_blank"> OAuth2 </a>用户授权。由于涉及到位置披露，我希望确保所有信息访问都得到适当的划分和保护。</p><h1 id="0195" class="kt ku hu bd kv kw kx ky kz la lb lc ld ja le jb lf jd lg je lh jg li jh lj lk dt translated">溅射发射</h1><p id="dcfb" class="pw-post-body-paragraph jv jw hu jx b jy ll iv ka kb lm iy kd ke ln kg kh ki lo kk kl km lp ko kp kq hn dt translated">在推出和一点社会推广之后，事情开始好转，这时候麻烦开始了。</p><p id="8714" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">第一个症状是Android应用程序完全无法收集JavaScript信誉分数。没有名声，没人能注册聚会。</p><p id="09ba" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我把问题追溯到GitHub，所有的API调用都被完全限制了速率！我直接从Android调用GitHub API，API id/密钥存储在我的应用程序中，我认为是安全的。然而，有人窃取了我的GitHub凭证，并在API中泛滥，完全封锁了我真正的JavaScript用户群。结果我的应用被嫉妒的Python程序员劫持了。</p><p id="396c" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">开源存储库中没有存储API密钥。密钥是直接从Android APKs中窃取的——我的应用程序没有通过<a class="ae ks" href="https://android.fallible.co/" rel="noopener ugc nofollow" target="_blank">易错测试</a>。我尝试了代码混淆和<a class="ae ks" href="https://hackernoon.com/mobile-api-security-techniques-682a5da4fe10" rel="noopener ugc nofollow" target="_blank">对秘密</a>进行编码，但这丝毫没有降低它们的速度。每次我更改密码都意味着整个安装基础的全面升级。这是一场失败的游戏。</p><h1 id="abf7" class="kt ku hu bd kv kw kx ky kz la lb lc ld ja le jb lf jd lg je lh jg li jh lj lk dt translated">难分难解的酣战</h1><p id="020d" class="pw-post-body-paragraph jv jw hu jx b jy ll iv ka kb lm iy kd ke ln kg kh ki lo kk kl km lp ko kp kq hn dt translated">我的下一步是从Android应用程序中获取第三方GitHub API密钥。我没有直接从Android调用GitHub API，而是扩展了自己的API，通过自己的后端服务器代理调用GitHub。至少我不再暴露GitHub API密钥了。</p><p id="2038" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">尽管朝着正确的方向迈出了一步，但这并没有让那些讨厌的蟒蛇慢下来多少。我的应用程序的API密钥是仍然隐藏在我的应用程序中的一个密钥，他们很容易就找到了。他们的回应是对我自己的API进行逆向工程，并使用它使我的后端服务器重复计算用户的GitHub信誉，像以前一样戏剧性地关闭了我的应用程序。</p><p id="243f" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我用速率限制和在我的服务器上缓存用户信誉分数来应对。他们通过创建一群新用户，用虚假的meetup请求淹没我的服务来反击。</p><p id="aad2" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我被困在一个永无止境的捉迷藏游戏中，所有的虚假流量都让我在亚马逊网络服务上花费了真金白银。这是不可持续的。</p><h1 id="17a2" class="kt ku hu bd kv kw kx ky kz la lb lc ld ja le jb lf jd lg je lh jg li jh lj lk dt translated">不再有秘密</h1><p id="0ada" class="pw-post-body-paragraph jv jw hu jx b jy ll iv ka kb lm iy kd ke ln kg kh ki lo kk kl km lp ko kp kq hn dt translated">为什么我有一个API密钥？它应该是一个只有应用程序知道的秘密，这样只有应用程序才能成功调用我的API，但在应用程序上保留这个秘密是有问题的。</p><p id="5082" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我的用户认证是可靠的。事实上，我将它委托给了一个OAuth2授权服务，该服务返回一个用户授权令牌。我的应用程序从未见过任何用户凭证。</p><p id="7c3d" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">所以我使用了类似的方法来删除我的最后一个API秘密。这次，我将应用程序的身份验证委托给了一个应用程序身份验证服务。该服务对应用程序进行质询，并根据其响应证明该应用程序是可信的和未经篡改的。像用户认证服务一样，应用认证返回授权令牌。生成令牌的特殊秘密只有我的后端服务器和认证服务知道；它永远不会暴露在应用程序中，所以没有什么可偷的了。</p><p id="cd54" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">证明应用程序的真实性很快，不需要人工输入，因此任何授权令牌的生命周期都可能很短。如果任何代币被盗，它的价值是有限的。</p><p id="9745" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">一旦我从应用程序中获得了最后一个秘密，我的服务就稳定了。试图重新打包我的Android应用程序或重放API调用都无法证明，我的成本又降了下来。</p><p id="daa1" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">如果不是我又犯了一个错误，这个故事就到此为止了。在开发过程中，我生成了一个用于测试的长生命周期应用程序令牌，并将它放在了开源存储库中。这让皮托尼斯塔家族重操旧业。幸运的是，由于这个秘密已经不在应用程序中了，我干脆换了一个新的秘密。一旦更改了密码，危险的测试令牌就失效了，不需要对已安装的应用程序库进行更新。</p><h1 id="0ed3" class="kt ku hu bd kv kw kx ky kz la lb lc ld ja le jb lf jd lg je lh jg li jh lj lk dt translated">经验教训</h1><p id="602d" class="pw-post-body-paragraph jv jw hu jx b jy ll iv ka kb lm iy kd ke ln kg kh ki lo kk kl km lp ko kp kq hn dt translated">当我终于从噩梦中醒来时，我想到了可能会发生的事情。</p><p id="c04f" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">我不得不花费大量的时间和金钱来抵御恶意攻击，而不是为我的应用添加功能和扩大我的用户社区。我不能在战斗中坚持太久。</p><p id="7706" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">你必须考虑到任何移动平台都是一个充满敌意的环境。这不仅仅是大多数开发者关注的用户真实性。还关乎app的真实性。使用第三方服务来证明您的应用程序提供了一种最佳实践方法来保持您的移动应用程序的安全。</p><p id="ef76" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">永远不要低估程序员的毅力——JavaScript和Python程序员都一样。</p></div><div class="ab cl lq lr hc ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hn ho hp hq hr"><p id="c1ba" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">完全公开:我喜欢用javascript、python和其他语言编写代码，偶尔也会做梦；他们都有自己的快乐和挑战。我为<a class="ae ks" href="https://www.criticalblue.com/" rel="noopener ugc nofollow" target="_blank"> CriticalBlue </a>做软件性能和API安全方面的工作，而<a class="ae ks" href="https://approov.io" rel="noopener ugc nofollow" target="_blank">安全处理机密</a>是我们业务的一部分。</p><p id="52f8" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">感谢阅读！如果你能推荐这篇文章(点击❤按钮)，让其他人也能找到，我将不胜感激。</p><div class="jk jl jm jn fq ab cb"><figure class="lx jo ly lz ma mb mc paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lx jo ly lz ma mb mc paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lx jo ly lz ma mb mc paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="md me mf"><p id="f922" class="jv jw kr jx b jy jz iv ka kb kc iy kd mg kf kg kh mh kj kk kl mi kn ko kp kq hn dt translated"><a class="ae ks" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ks" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ks" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ks" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jv jw kr jx b jy jz iv ka kb kc iy kd mg kf kg kh mh kj kk kl mi kn ko kp kq hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ks" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ks" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mj"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>