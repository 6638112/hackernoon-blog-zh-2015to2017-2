<html>
<head>
<title>Angular 2+ and Ruby on Rails user authentication Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular 2+和Ruby on Rails用户认证第3部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/angular-2-and-ruby-on-rails-user-authentication-part-3-d938fcb7a334?source=collection_archive---------1-----------------------#2017-02-12">https://medium.com/hackernoon/angular-2-and-ruby-on-rails-user-authentication-part-3-d938fcb7a334?source=collection_archive---------1-----------------------#2017-02-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="5ac6" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">本文是<a class="ae jj" rel="noopener" href="/@avatsaev/angular-2-and-ruby-on-rails-user-authentication-fde230ddaed8#.p1u4kqz5e"> Angular 2+和Ruby on Rails用户认证</a>的后续文章</h2></div><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff jk"><img src="../Images/765f93de67da54aa85b3f38dba9e2c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EVCbusTvl_CBlfa96EhvYg.png"/></div></div></figure><h1 id="47fa" class="jw jx hu bd jy jz ka kb kc kd ke kf kg ja kh jb ki jd kj je kk jg kl jh km kn dt translated">应用架构</h1><h2 id="8a0d" class="ko jx hu bd jy kp kq kr kc ks kt ku kg kv kw kx ki ky kz la kk lb lc ld km le dt translated">成分</h2><ul class=""><li id="4546" class="lf lg hu lh b li lj lk ll kv lm ky ln lb lo lp lq lr ls lt dt translated"><em class="lu">首页组件(欢迎页面)</em></li><li id="6587" class="lf lg hu lh b li lv lk lw kv lx ky ly lb lz lp lq lr ls lt dt translated"><em class="lu">工具栏组件</em></li><li id="bacb" class="lf lg hu lh b li lv lk lw kv lx ky ly lb lz lp lq lr ls lt dt translated"><em class="lu">认证对话框组件</em></li><li id="0d01" class="lf lg hu lh b li lv lk lw kv lx ky ly lb lz lp lq lr ls lt dt translated"><em class="lu">从组件</em>登录</li><li id="8992" class="lf lg hu lh b li lv lk lw kv lx ky ly lb lz lp lq lr ls lt dt translated"><em class="lu">登记表组件</em></li><li id="ec26" class="lf lg hu lh b li lv lk lw kv lx ky ly lb lz lp lq lr ls lt dt translated"><em class="lu">剖面组件</em></li></ul><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff ma"><img src="../Images/2dca287cd319fbec5a9523e0e7128273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HqBWKwqRXK500Qy_uVbvFg.png"/></div></div></figure><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff mb"><img src="../Images/d80b654444ec419da1b5b7ff636d8c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HXHkx2qwrdUD7RHfuw6Jzw.png"/></div></div></figure><p id="591f" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">将登录和注册表单分成不同的组件是有用的，因为如果需要，我们可以在其他页面中重用它们(例如，没有对话框的专用登录和注册页面)</p><h2 id="5420" class="ko jx hu bd jy kp kq kr kc ks kt ku kg kv kw kx ki ky kz la kk lb lc ld km le dt translated">路线</h2><ul class=""><li id="6992" class="lf lg hu lh b li lj lk ll kv lm ky ln lb lo lp lq lr ls lt dt translated"><em class="lu">回家路线</em></li><li id="b0d9" class="lf lg hu lh b li lv lk lw kv lx ky ly lb lz lp lq lr ls lt dt translated"><em class="lu">轮廓路线</em></li></ul><h2 id="032c" class="ko jx hu bd jy kp kq kr kc ks kt ku kg kv kw kx ki ky kz la kk lb lc ld km le dt translated">路线守卫</h2><ul class=""><li id="17a1" class="lf lg hu lh b li lj lk ll kv lm ky ln lb lo lp lq lr ls lt dt translated"><em class="lu"> Profile route guard </em>:将检查用户是否登录，如果没有，将重定向到主页</li></ul><h2 id="f503" class="ko jx hu bd jy kp kq kr kc ks kt ku kg kv kw kx ki ky kz la kk lb lc ld km le dt translated">服务</h2><ul class=""><li id="16d2" class="lf lg hu lh b li lj lk ll kv lm ky ln lb lo lp lq lr ls lt dt translated"><em class="lu"> TokenAuthService </em>:将管理登录、注册、注销、用户配置文件数据，验证令牌真实性，并检查用户是否登录</li></ul><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff mr"><img src="../Images/795b08585f8b13d51ba035ebae4fdecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NMOpRPtOi4yOwLTSxL2i7g.png"/></div></div></figure><h1 id="0fda" class="jw jx hu bd jy jz ka kb kc kd ke kf kg ja kh jb ki jd kj je kk jg kl jh km kn dt translated">家用元件和家用布线</h1><p id="af05" class="pw-post-body-paragraph mc md hu lh b li lj iv mf lk ll iy mh kv ms mj mk ky mt mm mn lb mu mp mq lp hn dt translated">让我们从使用Angular CLI生成第一个组件Home开始:</p><pre class="jl jm jn jo fq mv mw mx my aw mz dt"><span id="ff83" class="ko jx hu mw b fv na nb l nc nd">$ ng g c home</span></pre><blockquote class="ne nf ng"><p id="80a6" class="mc md lu lh b li me iv mf lk mg iy mh nh mi mj mk ni ml mm mn nj mo mp mq lp hn dt translated">g =生成，c =组件</p></blockquote><p id="a1a7" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">这将创造。/src/app/ <strong class="lh hv"> home </strong>文件夹包含home组件类、其模板和样式表，Angular CLI还会自动将其添加到主应用程序模块的声明数组中。</p><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff nk"><img src="../Images/c5b8771f300167b346ec290af7b564d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MzzSc0ENTvJ8z46rXwojhg.png"/></div></div></figure><p id="524e" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">现在我们需要为它创建一条路线，打开<strong class="lh hv">。/src/app/app-routing . module . ts</strong></p><p id="a299" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">导入家庭组件:</p><pre class="jl jm jn jo fq mv mw mx my aw mz dt"><span id="93aa" class="ko jx hu mw b fv na nb l nc nd">import {HomeComponent} from "./home/home.component";</span></pre><p id="e1d4" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">并将归属路由添加到路由数组:</p><pre class="jl jm jn jo fq mv mw mx my aw mz dt"><span id="0ce8" class="ko jx hu mw b fv na nb l nc nd">const routes: Routes = [<br/>  {<br/>    path: '',<br/>    children: []<br/>  },<br/>  <strong class="mw hv">{<br/>    path: 'home',<br/>    component: HomeComponent<br/>  }</strong><br/>];</span></pre><p id="4c6b" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">我们还会将它设为默认路由:</p><pre class="jl jm jn jo fq mv mw mx my aw mz dt"><span id="78ef" class="ko jx hu mw b fv na nb l nc nd">const routes: Routes = [<br/>  {<br/>    path: '',<br/>    component: HomeComponent,<br/>    pathMatch: 'full'<br/>  },<br/>  {<br/>    path: 'home',<br/>    component: HomeComponent<br/>  }<br/>];</span></pre><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff nl"><img src="../Images/f49e405af55892545e5dfc29b27f8c49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uv6b_YMLmM4n_QUIzcF_fw.png"/></div></div></figure><p id="f570" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">现在，如果我们转到<a class="ae jj" href="http://localhost:4200" rel="noopener ugc nofollow" target="_blank">http://localhost:4200</a>home component将默认显示</p><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff nm"><img src="../Images/1d74a9e7b0fdf8ac765d6bfad3e97bf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RuYrI2Bf0NsPzUEFd3HtlQ.png"/></div></div></figure><h1 id="6e66" class="jw jx hu bd jy jz ka kb kc kd ke kf kg ja kh jb ki jd kj je kk jg kl jh km kn dt translated">工具栏组件</h1><p id="e5e8" class="pw-post-body-paragraph mc md hu lh b li lj iv mf lk ll iy mh kv ms mj mk ky mt mm mn lb mu mp mq lp hn dt translated">工具栏组件的相同程序:</p><pre class="jl jm jn jo fq mv mw mx my aw mz dt"><span id="f639" class="ko jx hu mw b fv na nb l nc nd">$ ng g c toolbar</span></pre><p id="bbd8" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">设置工具栏的html模板:</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="748b" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">现在我们将显示所有动作，稍后我们将实现条件状态。</p><p id="3d85" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">更换<strong class="lh hv">。/src/app/home/home . component . html</strong>来点更吸引人的:</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="0405" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">编辑<strong class="lh hv">。/src/app/app . component . html</strong>显示我们的工具栏，并将路由器出口包装在<em class="lu">容器</em>类中:</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="2573" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">这是我们目前得到的信息:</p><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff np"><img src="../Images/2b8653aa358246829c155e86ee720741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5pqNQB9cRAaGL_f7bCEGUA.png"/></div></div></figure><h1 id="f6d9" class="jw jx hu bd jy jz ka kb kc kd ke kf kg ja kh jb ki jd kj je kk jg kl jh km kn dt translated"><strong class="ak">认证对话框</strong></h1><p id="a427" class="pw-post-body-paragraph mc md hu lh b li lj iv mf lk ll iy mh kv ms mj mk ky mt mm mn lb mu mp mq lp hn dt translated">现在我们需要创建<strong class="lh hv"> AuthDialogComponent </strong>，它将显示登录/注册表单:</p><pre class="jl jm jn jo fq mv mw mx my aw mz dt"><span id="6625" class="ko jx hu mw b fv na nb l nc nd">$ ng g c auth-dialog</span></pre><p id="44d4" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">让我们在<strong class="lh hv">中编辑AuthDialogComponent文件。/src/app/auth-dialog/auth-dialog . component . ts</strong></p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="f901" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">验证对话框组件将有一个<strong class="lh hv">输入</strong>装饰器(第11行)<strong class="lh hv">验证模式</strong>，它有两个可能的值，“登录”或“注册”，这将允许我们选择对话框出现时显示的初始表单(登录或注册表单)。此输入的默认值是“登录”。</p><p id="e696" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated"><strong class="lh hv"> modalActions </strong>(第12行)<strong class="lh hv"> </strong>是一个事件发射器，物化对话框指令需要它，我们将在它上面发射事件来打开或关闭我们的对话框。</p><p id="6dc4" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated"><strong class="lh hv"> openDialog </strong>(第18行)方法以一个<strong class="lh hv"> mode </strong>为参数，将设置当前的auth模式并显示对话框，如果没有传递参数，默认为login。</p><p id="273d" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated"><strong class="lh hv"> isLoginMode </strong>和<strong class="lh hv"> isRegisterMode </strong>方法<strong class="lh hv"> </strong>将帮助我们有条件地显示登录或注册表单。</p><p id="0385" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">编辑此对话框的模板<strong class="lh hv">。/src/app/auth-dialog/auth-dialog . component . html</strong>:</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="a412" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">在第2行，我们使用<strong class="lh hv">物化模态指令</strong>，并为其<strong class="lh hv">物化动作</strong>输入传递<strong class="lh hv">模态动作</strong>事件发射器，以便能够通过在对话框上发射事件来控制对话框。</p><p id="75ed" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">现在这个对话框在第17行显示的是它的当前模式，以及在第23和26行切换模式的能力。<strong class="lh hv"> *ngIf </strong>结构指令采用布尔表达式，如果表达式为<em class="lu"> true </em>，则显示节点，否则隐藏节点(从DOM中移除)。</p><p id="e076" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">让我们在单击工具栏中的注册或登录操作时显示此对话框。</p><p id="b720" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">在<strong class="lh hv">中。/src/app/toolbar/toolbar . component . html</strong>包含auth-dialog组件，并在登录和注册操作时创建click事件以打开auth对话框:</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="ae2b" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated"><strong class="lh hv"> #authDialog </strong>(第24行)<strong class="lh hv"> </strong>是对工具栏组件视图的AuthDialogComponent的引用，它将允许我们从工具栏组件类访问AuthDialogComponent类。</p><p id="39b4" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated"><strong class="lh hv">。/src/app/toolbar/toolbar . component . ts:</strong></p><pre class="jl jm jn jo fq mv mw mx my aw mz dt"><span id="831a" class="ko jx hu mw b fv na nb l nc nd">import {Component, OnInit, <strong class="mw hv">ViewChild</strong>} from '@angular/core';<br/><strong class="mw hv">import {AuthDialogComponent} from "../auth-dialog/auth-dialog.component";</strong><br/><br/>@Component({<br/>  selector: 'app-toolbar',<br/>  templateUrl: './toolbar.component.html',<br/>  styleUrls: ['./toolbar.component.sass']<br/>})<br/>export class ToolbarComponent implements OnInit {<br/><br/>  <strong class="mw hv">@ViewChild('authDialog') authDialog: AuthDialogComponent;</strong><br/><br/>  constructor() { }<br/><br/>  ngOnInit() {<br/>  }<br/><br/><strong class="mw hv">  presentAuthDialog(mode?: 'login'| 'register'){<br/>    this.authDialog.openDialog(mode);<br/>  }</strong><br/><br/>}</span></pre><p id="ec69" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated"><strong class="lh hv"> ViewChild </strong> decorator将从我们的模板中引用<strong class="lh hv"> AuthDialogComponent </strong>，这样我们就可以直接从我们的<strong class="lh hv"> ToolbarComponent </strong>类中访问它的方法和属性。</p><p id="8a01" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated"><strong class="lh hv"> presentAuthDialog </strong>方法带一个<strong class="lh hv">可选</strong> <em class="lu">模式</em>参数<strong class="lh hv">(注意问号)</strong>，AuthDialogComponenet的<strong class="lh hv"> openDialog </strong>方法默认模式为“登录”，所以如果我们想打开登录对话框，我们可以不带任何参数调用<strong class="lh hv"> presentAuthDialog() </strong>。</p><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff nq"><img src="../Images/8103f9ed37a8515c08a73a14f73eae2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oe7U0kGBduoKGnjupW1aZw.png"/></div></div></figure><p id="b1c5" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">到目前为止，这是我们从Auth对话框中得到的结果:</p><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff nr"><img src="../Images/30e39778c1d9f4312a0b17b575db8a4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fwDLU3tGdFkPkZF1IRPYRw.gif"/></div></div></figure><p id="9138" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">我们将使用<strong class="lh hv">令牌服务</strong>根据用户是否通过身份验证来显示工具栏中的正确操作，为此，我们可以使用<a class="ae jj" href="https://github.com/neroniaky/angular2-token#usersignedin" rel="noopener ugc nofollow" target="_blank"><strong class="lh hv">userSignedIn()方法</strong> </a> <strong class="lh hv"> </strong>返回用户登录时的true。</p><p id="270b" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">将<strong class="lh hv"> Angular2TokenService </strong>导入并注入到我们的<strong class="lh hv">工具栏组件</strong>中:</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="5e67" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">现在我们可以在工具栏模板上使用它来有条件地隐藏/显示动作，我们还将把<strong class="lh hv"> signOut </strong>方法附加到它的动作上:</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><h1 id="b13f" class="jw jx hu bd jy jz ka kb kc kd ke kf kg ja kh jb ki jd kj je kk jg kl jh km kn dt translated">登录和注册表单</h1><p id="2074" class="pw-post-body-paragraph mc md hu lh b li lj iv mf lk ll iy mh kv ms mj mk ky mt mm mn lb mu mp mq lp hn dt translated">我们快完成了。让我们生成登录和注册表单组件。</p><pre class="jl jm jn jo fq mv mw mx my aw mz dt"><span id="6460" class="ko jx hu mw b fv na nb l nc nd">$ ng g c login-form</span><span id="74d7" class="ko jx hu mw b fv ns nb l nc nd">$ ng g c register-form</span></pre><h2 id="faf4" class="ko jx hu bd jy kp kq kr kc ks kt ku kg kv kw kx ki ky kz la kk lb lc ld km le dt translated">登录表单模板</h2><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="aa8d" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">我们有两个文本输入(电子邮件和密码)，这两个都是表单拥有有效状态所必需的。我们在第12行和第24行使用Angular的双向数据绑定将输入值绑定到组件类中的signInUser对象，这意味着当用户在HTML表单中修改这些值时，这些值将被更新，如果在组件类中以编程方式修改这些值，这些值也会在视图中更新。</p><p id="6bc5" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">提交按钮(第31行)将处于禁用状态，除非表单生效(第32行)。</p><h2 id="3456" class="ko jx hu bd jy kp kq kr kc ks kt ku kg kv kw kx ki ky kz la kk lb lc ld km le dt translated">登录表单组件</h2><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="3284" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">登录表单将有一个输出<strong class="lh hv"> onFormResult </strong>(第16行)，这是一个在登录请求完成时触发的事件，因此父组件可以监听并对其进行操作。</p><p id="7ba7" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">我们将把<strong class="lh hv">令牌服务</strong>注入到我们的组件中(第17行),并在提交表单时使用它的<strong class="lh hv">登录</strong>方法。当登录动作完成时，我们将在<strong class="lh hv"> onFormResult </strong>输出上发出一个事件，带有包含结果的有效负载(第31和37行)，这将通知父组件。</p><h2 id="e1c0" class="ko jx hu bd jy kp kq kr kc ks kt ku kg kv kw kx ki ky kz la kk lb lc ld km le dt translated">注册表单模板</h2><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="0568" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">非常类似于登录，但有一个额外的密码确认文本字段及其验证。</p><h2 id="272c" class="ko jx hu bd jy kp kq kr kc ks kt ku kg kv kw kx ki ky kz la kk lb lc ld km le dt translated">注册表单组件</h2><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="3c48" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">与登录表单类似，注册表单也有一个输出事件发射器<strong class="lh hv"> onFormResult </strong>，它在注册请求完成时触发。</p><h2 id="5568" class="ko jx hu bd jy kp kq kr kc ks kt ku kg kv kw kx ki ky kz la kk lb lc ld km le dt translated">在验证对话框中连接输出</h2><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="91d8" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated">在auth dialog组件类中，为<strong class="lh hv">登录</strong>和<strong class="lh hv">注册</strong>表单组件发出的<strong class="lh hv"> onFormResult </strong>事件创建事件处理程序，如果登录/注册成功，则关闭对话框，否则在警告窗口中显示我们的ror服务器返回的错误:</p><figure class="jl jm jn jo fq jp"><div class="bz el l di"><div class="nn no l"/></div></figure><h2 id="c9a9" class="ko jx hu bd jy kp kq kr kc ks kt ku kg kv kw kx ki ky kz la kk lb lc ld km le dt translated">最终验证对话框</h2><p id="675c" class="pw-post-body-paragraph mc md hu lh b li lj iv mf lk ll iy mh kv ms mj mk ky mt mm mn lb mu mp mq lp hn dt translated">请注意，当用户登录和注销时，工具栏动作会自动更新它们的状态。</p><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff nr"><img src="../Images/8b38e7fb9f69b7e3f56e32545d3d62b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nEqOfQzwmVXIVdNmCS-B7g.gif"/></div></div></figure><blockquote class="ne nf ng"><p id="66ff" class="mc md lu lh b li me iv mf lk mg iy mh nh mi mj mk ni ml mm mn nj mo mp mq lp hn dt translated">该器件的最终源代码可从Github获得:<a class="ae jj" href="https://github.com/avatsaev/angular-token-auth-seed/tree/final" rel="noopener ugc nofollow" target="_blank">https://Github . com/avatsaev/angular-token-auth-seed/tree/final</a></p></blockquote><p id="3638" class="pw-post-body-paragraph mc md hu lh b li me iv mf lk mg iy mh kv mi mj mk ky ml mm mn lb mo mp mq lp hn dt translated"><a class="ae jj" rel="noopener" href="/@avatsaev/angular-2-and-ruby-on-rails-user-authentication-part-4-49d550c5869a#.bpxr54ano"> <strong class="lh hv">第4部分:用户配置文件、认证服务和认证路由器防护。</strong>T3】</a></p><div class="jl jm jn jo fq ab cb"><figure class="nt jp nu nv nw nx ny paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nt jp nu nv nw nx ny paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nt jp nu nv nw nx ny paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ne nf ng"><p id="f922" class="mc md lu lh b li me iv mf lk mg iy mh nh mi mj mk ni ml mm mn nj mo mp mq lp hn dt translated"><a class="ae jj" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jj" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jj" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jj" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="mc md lu lh b li me iv mf lk mg iy mh nh mi mj mk ni ml mm mn nj mo mp mq lp hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jj" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jj" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jl jm jn jo fq jp fe ff paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="fe ff nz"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>