<html>
<head>
<title>How to Properly Run Docker on RHEL and Friends</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何正确运行RHEL和朋友的Docker</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-properly-run-docker-on-rhel-and-friends-d055754414e5?source=collection_archive---------9-----------------------#2017-03-15">https://medium.com/hackernoon/how-to-properly-run-docker-on-rhel-and-friends-d055754414e5?source=collection_archive---------9-----------------------#2017-03-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="59a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">TL；dr使用lvm-direct存储驱动程序。lvm-loopback用于原型制作，不可扩展</strong></p><p id="e9c8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在阅读了<a class="ae jp" href="https://thehftguy.com/" rel="noopener ugc nofollow" target="_blank">the ftguy的</a>关于他有多爱docker的搞笑帖子后，我有了写这篇文章的灵感。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="217f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在$day_job，我们在一些jenkins slaves上使用docker来构建rpm，并支持利用docker的应用程序的测试执行。很自然，这是一个开发环境，所以我们不讨论在生产中运行docker或任何疯狂的事情。但是当詹金斯·乔布斯挂着，挂着，挂着的时候，我们正在谈论拿着干草叉的开发者</p><p id="2de0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">大多数情况下，一切都很顺利。每隔几天，一个docker节点就会锁定，cpu和负载平均值飙升，重新启动它，一切都会恢复正常。我们接受了一段时间。</p><p id="fb9d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当你在原木中潜水时，你会发现有趣的事情。</p><figure class="jy jz ka kb fq kc fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/15965aabc1910233a5c1ac6ab4d5f46d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*-WKQUnYPiy109bmj2D74Ww.png"/></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">impending doom found in the docker daemon’s logs</figcaption></figure><p id="6f06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">等等，什么？你是说没有百胜安装docker那么容易？但我记得你说过通往牛奶和蜂蜜之地的路是用码头工人铺成的？嗯嗯:\</p><p id="c575" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">原来docker的储物有点搞笑。自己找找，这是储物手册…</p><figure class="jy jz ka kb fq kc fe ff paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="fe ff kj"><img src="../Images/97c3f57da164b6b30cb4368d7aae0583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FTcR3CZkaGIkJCKfH7hX0Q.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek"><a class="ae jp" href="https://docs.docker.com/engine/userguide/storagedriver/selectadriver/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/engine/userguide/storagedriver/selectadriver/</a></figcaption></figure><p id="ca4b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它始于AUFS，RedHat的一些英雄写了设备映射器插件(谢谢！)，现在有了overlay，overlay2，btrfs，zfs，各种各样的FSS</p><p id="0fb3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://developers.redhat.com/blog/2014/09/30/overview-storage-scalability-docker/" rel="noopener ugc nofollow" target="_blank">这里是</a>一篇精彩的文章，解释了设备映射器驱动程序的历史和发展。</p><p id="8ca3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">简而言之，rhel/centos系统上的现成docker使用lvm-loopback存储驱动程序。它快速、简单，并且在小范围内有效。</p><p id="2e13" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您想在docker(rhel/centos)上运行真实的工作负载，您必须使用lvm-direct驱动程序。lvm-direct使用<a class="ae jp" href="https://www.kernel.org/doc/Documentation/device-mapper/thin-provisioning.txt" rel="noopener ugc nofollow" target="_blank">自动精简配置</a>，因此它不是普通的lvm设置任务。</p><p id="61e2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是在新节点上设置lvm-direct驱动程序的简单快捷的方法:</p><ol class=""><li id="fb33" class="ko kp hu it b iu iv iy iz jc kq jg kr jk ks jo kt ku kv kw dt translated">向节点添加一个额外的、未分区的、非文件系统的块设备，或者在配置节点时，保留一定百分比的lvm卷组空闲空间(请参见有用链接)。</li><li id="763d" class="ko kp hu it b iu kx iy ky jc kz jg la jk lb jo kt ku kv kw dt translated">自从RedHat发布docker 1.12之后，运行<a class="ae jp" href="https://github.com/projectatomic/container-storage-setup" rel="noopener ugc nofollow" target="_blank"> docker-storage-setup </a>服务。这将检测您的额外数据块设备/空闲vg空间，并自动配置精简池。</li><li id="20b6" class="ko kp hu it b iu kx iy ky jc kz jg la jk lb jo kt ku kv kw dt translated">就是这样。启动docker守护进程并进行验证。` docker info 2&gt; /dev/null | grep loop `应该不返回任何内容。运行一个容器，看看会发生什么</li></ol><p id="0e28" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">自从切换到lvm-direct以来已经27天了，没有任何愤怒的“为什么我的码头工人工作悬着”暴民的迹象。</p><p id="f4d1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我想这里真正的信息是，你不能只是安装$new_hotness并期望它工作。也许如果有人有RTFM，我们就可以跳过这整个痛苦的一课。呸…</p><p id="159a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一些有用的链接:</p><ul class=""><li id="a40b" class="ko kp hu it b iu iv iy iz jc kq jg kr jk ks jo lc ku kv kw dt translated"><a class="ae jp" href="http://www.projectatomic.io/blog/2015/06/notes-on-fedora-centos-and-docker-storage-drivers/" rel="noopener ugc nofollow" target="_blank">朋友不让朋友在生产回环上运行Docker</a></li><li id="a851" class="ko kp hu it b iu kx iy ky jc kz jg la jk lb jo lc ku kv kw dt translated"><a class="ae jp" href="https://developers.redhat.com/blog/2014/09/30/overview-storage-scalability-docker/" rel="noopener ugc nofollow" target="_blank">Docker中存储可扩展性的全面概述</a></li><li id="f166" class="ko kp hu it b iu kx iy ky jc kz jg la jk lb jo lc ku kv kw dt translated"><a class="ae jp" href="https://docs.openshift.org/latest/install_config/install/host_preparation.html#configuring-docker-storage" rel="noopener ugc nofollow" target="_blank">配置Docker存储器</a></li><li id="f33d" class="ko kp hu it b iu kx iy ky jc kz jg la jk lb jo lc ku kv kw dt translated"><a class="ae jp" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_atomic_host/7/html/managing_containers/managing_storage_with_docker_formatted_containers#how_to_leave_space_in_the_volume_group_backing_root_during_installation" rel="noopener ugc nofollow" target="_blank">如何在卷组中留出空间</a></li><li id="859c" class="ko kp hu it b iu kx iy ky jc kz jg la jk lb jo lc ku kv kw dt translated"><a class="ae jp" href="https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/" rel="noopener ugc nofollow" target="_blank"> Docker和设备映射器存储驱动</a></li></ul><div class="jy jz ka kb fq ab cb"><figure class="ld kc le lf lg lh li paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ld kc le lf lg lh li paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ld kc le lf lg lh li paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="lj lk ll"><p id="f922" class="ir is lm it b iu iv iw ix iy iz ja jb ln jd je jf lo jh ji jj lp jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿妹家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is lm it b iu iv iw ix iy iz ja jb ln jd je jf lo jh ji jj lp jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jy jz ka kb fq kc fe ff paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="fe ff lq"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>