# REST 不适合 RPC

> 原文：<https://medium.com/hackernoon/rest-is-just-not-for-rpc-d5d9507ff99a>

我认为 RPC 协议和 [REST](https://hackernoon.com/tagged/rest) 协议生活在非常不同的抽象层次上，不应该像替代品一样进行比较。这可能是我对当前 REST 批评浪潮的主要问题。如果我们只是接受没有人会乐意通过 REST，一个为资源同步而设计的特定领域的 API，来强制一种 RPC 类型的 [API](https://hackernoon.com/tagged/api) ，讨论可能会更有成效。

由于编程语言使用函数，而 RPC 是通过某种网络使用这些函数的一种方式，当然 RPC APIs 是实现这一点的最通用和透明的方式。我们现在有令人惊叹的技术，如 gRPC、websockets、Cap'nProto、ProtocolBuffers、MessagePack 等，HTTP 可能是传统支持的一个很好的后备传输层，但原则上这些不需要 HTTP 层的任何东西，但通过纯 websockets 或纯 UDP/TCP 会好得多。

最好是看看两个极端，然后看看现实世界的混合用例如何才能被建模得最好:
-纯 RPC API:
一切适合的东西，如消息传递、非常动态和多维查询、请求视图模型、触发事件、远程算法执行、发送突变。这些事情最好使用我上面提到的 RPC 技术来实现。这些概念通常甚至与“资源”的概念没有联系，所以它会碰到我们读到的所有其他问题。

-纯资源 API:
任何应该同步或发布资源上一致的状态和状态变化，并需要访问完整资源以保持一致性，同时尽可能抽象实现细节的协议，最好在 REST 中建模。请注意，与上面的描述相比，这个应用程序是多么的狭窄。尽管如此，这仍然适用于许多系统，只要资源的概念在该系统的逻辑中有意义:
对于 REST 的逻辑，我发现下面的定义最实用:资源是一个实体，它在理论上可以作为 unix 文件公开，并且它在某个时间的状态可以通过一个简单的散列函数来验证。这个类比也很有趣，因为它反映了 plan9 的发展(所有东西实际上都是一个文件/所有东西都应该有一个 REST 接口)正在转变为一个更真实的 linux 世界(有许多类似 API 的文件，但也有 d-bus 等。/会有许多 REST API，但也有许多 RPC 协议)
注意每个 REST API 都可以相对容易地用 RPC 风格的 API 建模(尽管可能会重新发明 weel ),而不是反过来。
当考虑 REST apis 的实际应用时，还有两个重要的技术需要记住，即使你在现实中使用了完全不同的技术，但是这些技术实现的纯洁性和有真实的资源来检查你的想法的事实是一个极大的帮助:
couchDB 和 webDAV
—这个 API 作为 webDAV 服务器公开在理论上有意义吗？这个 api 安装在文件浏览器中会有多可笑？与这个 api 的交互越荒谬，REST 就越不可能是你的 API 的好模型。你发现越多令人讨厌/美好的用例会让这样的界面变得很棒，它就越适合 REST。如果你比 webDAV 更了解 couchDB，这是一样的，那么将这个 API 建模为一个包含文档和文档版本修订的 couchdb 数据库有多大意义呢？

现实世界的 API 通常都有这两个方面。关键是找到 API 自然的主要思想，并识别和解决硬币的另一面作为边缘情况。如果你的 API 主要是 RPC 风格的，但是你有更强的需求来操作资源，这就是 graphQL 的用武之地，这也是为什么我认为 graphQL 通过 web socket 最有意义，我不认为它是 REST 的替代品，而是作为一个工具带来赋予 RPC APIs 更强的数据需求。如果你的 API 很大，并且可以被分割成两个领域，那么拥有两个清晰建模的独立 API 有时是有意义的。这乍一看似乎很奇怪，但如果 Web 应用程序有 REST API，但也使用 websockets 来实现某些功能，这确实会发生。
-如果你的 API 主要是一个完美的 REST fit，但有一些 RPC 方面，那么当然仍然可以将 RPC 建模为 REST，但要清楚这些端点是什么，并准备好替换它们，如果你遇到已知的问题，只是有意识地了解这一点已经很有帮助了。