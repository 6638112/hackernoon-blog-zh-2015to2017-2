<html>
<head>
<title>How we happily dockerized our development environment (part 1/2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们如何愉快地将我们的开发环境分类(第1/2部分)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-we-happily-dockerized-our-development-environment-part-1-2-b05fd6927a53?source=collection_archive---------0-----------------------#2016-03-10">https://medium.com/hackernoon/how-we-happily-dockerized-our-development-environment-part-1-2-b05fd6927a53?source=collection_archive---------0-----------------------#2016-03-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="68a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这篇文章中，我将展示一些我们在<a class="jp jq gr" href="https://medium.com/u/4fb3c47e7f1c?source=post_page-----b05fd6927a53--------------------------------" rel="noopener" target="_blank"> Hunteed </a>使用的技巧，由于完全docked化的<a class="ae jr" href="https://hackernoon.com/tagged/development" rel="noopener ugc nofollow" target="_blank">开发</a>环境，这些技巧可以提高我们的生产力。</p><p id="8d17" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是第1/2部分，我们描述了一个dockerized开发环境的基本配置。<a class="ae jr" rel="noopener" href="/@aherve/dockerized-development-environment-on-steroids-part-2-2-b800a65d0462#.235fodt6h">在第2部分</a>中，我们将解释如何让这种配置发挥作用，这样你就再也不用等待<em class="js"> npm安装/gem安装</em>了。</p><h2 id="d2fc" class="jt ju hu bd jv jw jx jy jz ka kb kc kd jc ke kf kg jg kh ki kj jk kk kl km kn dt translated">为什么我应该对我的工作流程进行任何更改？</h2><p id="f468" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">通过正确设置<a class="ae jr" href="https://hackernoon.com/tagged/docker" rel="noopener ugc nofollow" target="_blank"> docker </a>配置，我们现在了解以下特性:</p><ul class=""><li id="76a5" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated"><strong class="it hv">一键安装</strong>工作就绪环境。从零开始。没错。</li></ul><figure class="ld le lf lg fq lh fe ff paragraph-image"><div class="fe ff lc"><img src="../Images/635e1cc7f2c14a8345c64d806fa44877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/1*s89b5ZNf1SaVtgjosVPr9w.gif"/></div></figure><ul class=""><li id="9c94" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated"><strong class="it hv">没有特定版本/依赖关系的本地安装</strong>。作为一名自由职业者，你可能会参与几个项目，每个项目都使用不同版本的node/mongo/elastic-search…等等。这根本不应该是一个问题。</li><li id="b8a6" class="kt ku hu it b iu lk iy ll jc lm jg ln jk lo jo ky kz la lb dt translated"><strong class="it hv">如果在本地有效，则在产品</strong>中有效。CI和生产服务器应该与我的开发环境完全一样。</li><li id="6286" class="kt ku hu it b iu lk iy ll jc lm jg ln jk lo jo ky kz la lb dt translated">本项目不需要基础设施方面的知识。前端开发人员、设计人员、集成商可以对基础设施有所了解。我们希望一个集成商能够在我们的项目上工作，而不必知道如何安装mongodb服务器。嗯，他/她根本不应该关心是否有数据库。</li></ul><p id="0bea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">除了这些特性之外，我们还想要现在已经成为任何现代编码配置标准的特性:</p><ul class=""><li id="bd37" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated"><strong class="it hv">持续测试</strong>:更改代码应该触发一系列测试，这对开发人员来说是直接可见的</li><li id="2fcb" class="kt ku hu it b iu lk iy ll jc lm jg ln jk lo jo ky kz la lb dt translated"><strong class="it hv">热重装:</strong>你的代码的变化会很快出现在你的浏览器上，而不需要手动重启</li><li id="de8a" class="kt ku hu it b iu lk iy ll jc lm jg ln jk lo jo ky kz la lb dt translated"><strong class="it hv">持续集成</strong>被插入，每次提交都会在CI-server上触发一个完整的测试套件。</li></ul><p id="e9ca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">没错。所以我们将基本上摆脱</p><ul class=""><li id="5624" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated">欢迎来到<a class="jp jq gr" href="https://medium.com/u/4fb3c47e7f1c?source=post_page-----b05fd6927a53--------------------------------" rel="noopener" target="_blank"> Hunteed </a>，让我们和首席技术官一起花3天时间黑进你的电脑，直到你能真正投入这个项目</li><li id="0e3e" class="kt ku hu it b iu lk iy ll jc lm jg ln jk lo jo ky kz la lb dt translated">我不明白，它在我的机器上工作！</li><li id="a9e0" class="kt ku hu it b iu lk iy ll jc lm jg ln jk lo jo ky kz la lb dt translated">我如何改变我安装的MongoDB/MySQL/elastic-search/node/phantom/ruby/等等的版本，使它符合你的栈？</li><li id="708a" class="kt ku hu it b iu lk iy ll jc lm jg ln jk lo jo ky kz la lb dt translated">NPM install/gem install/whatever install在我的机器上不工作。所需的依赖项是什么？</li><li id="8571" class="kt ku hu it b iu lk iy ll jc lm jg ln jk lo jo ky kz la lb dt translated">我不明白，它在我的机器上工作！(又来了！？)</li><li id="ebd1" class="kt ku hu it b iu lk iy ll jc lm jg ln jk lo jo ky kz la lb dt translated">我不明白，它不能在我的机器上工作！(是啊，那也是)</li></ul><p id="3c7c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好吧，让我们屠杀怪物！</p><h2 id="4850" class="jt ju hu bd jv jw jx jy jz ka kb kc kd jc ke kf kg jg kh ki kj jk kk kl km kn dt translated">2.使其工作</h2><p id="db40" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated"><a class="ae jr" href="https://github.com/aherve/simple-dockerized-dev-env/tree/make-it-work" rel="noopener ugc nofollow" target="_blank">在这里</a>你可以找到一个小小的演示项目:</p><pre class="ld le lf lg fq lp lq lr ls aw lt dt"><span id="a80c" class="jt ju hu lq b fv lu lv l lw lx">git clone https://github.com/aherve/simple-dockerized-dev-env</span></pre><p id="77bd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们进入细节之前，让我们看看您可以用它做什么:</p><ul class=""><li id="6f79" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated"><strong class="it hv">构建整个环境:</strong></li></ul><pre class="ld le lf lg fq lp lq lr ls aw lt dt"><span id="afce" class="jt ju hu lq b fv lu lv l lw lx">docker-compose build</span></pre><p id="e126" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将下载适当的容器，以便您可以使用节点mongodb的开箱即用安装。它还会为您运行npm安装。</p><p id="2911" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另请注意，如果您再次运行此命令，docker将使用缓存，这样npm安装和映像下载就不会执行两次:</p><figure class="ld le lf lg fq lh fe ff paragraph-image"><div class="fe ff ly"><img src="../Images/ea6d22a0a3e5970d8161d463907a5602.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*YZGzImtgGRzhCwZb1qwfww.png"/></div></figure><p id="fabe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您更改了<em class="js"> package.json </em>文件，那么<em class="js"> npm install </em>命令将再次运行。正是我们需要的！</p><ul class=""><li id="3d1b" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated"><strong class="it hv">一次性测试:</strong></li></ul><pre class="ld le lf lg fq lp lq lr ls aw lt dt"><span id="fade" class="jt ju hu lq b fv lu lv l lw lx">docker-compose run test</span></pre><p id="60c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将运行测试。如果您第一次启动这个命令，您是否注意到它是如何为您安装所有东西的？</p><figure class="ld le lf lg fq lh fe ff paragraph-image"><div class="fe ff lz"><img src="../Images/11de6e3a19b927334e1308e283380fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*ZYEhxfb09aCoaGRG51R2-g.png"/></div></figure><p id="9533" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意，还启动了一个<em class="js"> db_1 </em>实例。您的测试套件实际上连接到了一个mongodb，尽管我们在这里实际上没有使用它。</p><ul class=""><li id="d621" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated"><strong class="it hv">启动服务器/脚本</strong></li></ul><pre class="ld le lf lg fq lp lq lr ls aw lt dt"><span id="d17b" class="jt ju hu lq b fv lu lv l lw lx">docker-compose run hello<br/>&gt; hello is loaded !</span></pre><ul class=""><li id="305c" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated"><strong class="it hv">连续测试</strong></li></ul><pre class="ld le lf lg fq lp lq lr ls aw lt dt"><span id="3914" class="jt ju hu lq b fv lu lv l lw lx">docker-compose run autotest</span></pre><p id="502e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">与简单的测试命令不同，这个命令将启动一个观察器来跟踪代码中的变化。尝试更改<em class="js"> /src/spec.js </em>文件，看着测试瞬间失败！</p><p id="aed1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">MAC用户注意:</strong> docker在使用osX时运行在虚拟环境中。因此，文件更改不会被检测到。幸运的是，<a class="ae jr" href="https://github.com/codekitchen/dinghy" rel="noopener ugc nofollow" target="_blank">这些家伙为你解决了这个问题。只需安装dinghy，并将其用作docker虚拟机。然后它将开箱即用。</a></p><ul class=""><li id="318a" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated"><strong class="it hv">运行任意命令</strong></li></ul><pre class="ld le lf lg fq lp lq lr ls aw lt dt"><span id="f1fc" class="jt ju hu lq b fv lu lv l lw lx">docker-compose run hello npm list<br/>docker-compose run test env | grep NODE_ENV</span></pre><p id="4e8e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">run hello <something>将简单地覆盖docker-compose文件的默认<em class="js">命令</em>指令。</something></p><h2 id="ace3" class="jt ju hu bd jv jw jx jy jz ka kb kc kd jc ke kf kg jg kh ki kj jk kk kl km kn dt translated">3.它是如何工作的？</h2><figure class="ld le lf lg fq lh fe ff paragraph-image"><div class="fe ff ma"><img src="../Images/38ba5086460a0bf79f1f0c627d96ba56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*7qHBu-zj6bV8YKq5rwyNMg.jpeg"/></div></figure><p id="99c5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所有与docker相关的机制位于两个文件中:</p><ol class=""><li id="ff11" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo mb kz la lb dt translated">Dockerfile:</li></ol><figure class="ld le lf lg fq lh"><div class="bz el l di"><div class="mc md l"/></div></figure><p id="e00a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个文件描述了构建一个能够运行我们代码的容器的指令。</p><p id="7cfc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本例中，它包含一个node (alpine-node)的预安装，我们在这个预安装上创建一个工作目录(/app)来存放package.json文件。然后我们运行npm install，这样javascript库就可以在容器中使用了。Rubyists可以将<em class="js"> npm install </em>比作<em class="js"> gem install </em>命令，而<em class="js"> package.json </em>文件比作<em class="js"> Gemfile </em>文件。</p><p id="13ca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意，我们的源代码还没有包含在容器中。</p><p id="133e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.docker-撰写:</p><p id="c7e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个文件定义和编排容器。</p><p id="3eb9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这个例子中，我们使用我们的主<em class="js">docker文件</em> 3次来构建非常相似的图像:<em class="js"> hello，autotest </em>和<em class="js"> test </em>。您会注意到这些实际上是相同的容器，但是我们传递不同的环境变量，以及不同的默认命令。</p><figure class="ld le lf lg fq lh"><div class="bz el l di"><div class="mc md l"/></div></figure><p id="2b72" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="js"> volumes </em>指令将我们的本地目录挂载到容器中。更重要的是，本地<em class="js"> src </em>目录中的任何变化都会对正在运行的容器产生即时影响。事实上，它们实际上是同一个文件。</p><p id="1729" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">与位于<em class="js"> /src </em>中的不同，<em class="js"> package.json </em>是在运行<em class="js"> install </em>命令之前通过ADD命令添加的。这意味着如果<em class="js"> package.json </em>发生变化，您必须重新构建容器。</p><p id="0e7a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，最后一个<em class="js"> db </em>图像是一个正在运行的<em class="js"> mongodb </em>图像。这个映像是直接从docker-hub下载的，它将启动一个现成的工作数据库服务器。由于有了<em class="js"> links </em>命令，其他容器可以访问db。</p><h2 id="fc66" class="jt ju hu bd jv jw jx jy jz ka kb kc kd jc ke kf kg jg kh ki kj jk kk kl km kn dt translated">4.额外收获:CI服务器也知道docker！</h2><p id="f636" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">因为您可以安装环境，而不管您的设置如何…那么CI服务器也是如此</p><p id="a4c5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<a class="jp jq gr" href="https://medium.com/u/4fb3c47e7f1c?source=post_page-----b05fd6927a53--------------------------------" rel="noopener" target="_blank"> Hunteed </a>我们使用<a class="ae jr" href="https://codeship.com" rel="noopener ugc nofollow" target="_blank"> codeship </a>基于docker的基础设施进行持续集成&amp;部署。</p><p id="7928" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好消息是，他们可以像你一样阅读docker-compose文件。</p><p id="0455" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">简单地添加一个<em class="js"> codeship-steps.yml </em>文件，在这里您告诉codeship运行您的测试:</p><figure class="ld le lf lg fq lh"><div class="bz el l di"><div class="mc md l"/></div></figure><p id="3f7a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">codeship将使用您拥有的确切配置运行您的测试。多棒啊。</p><h2 id="6a33" class="jt ju hu bd jv jw jx jy jz ka kb kc kd jc ke kf kg jg kh ki kj jk kk kl km kn dt translated">5.结论</h2><p id="31a1" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">到目前为止，我们有一个工作环境，允许任何贡献者在一次点击上，不管他/她的个人计算机配置。</p><p id="fc8e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种特殊设置的唯一缺点是，每当您更改<em class="js"> package.json </em>文件时，<em class="js"> docker-compose build </em>将运行全新的<em class="js"> npm安装</em>。这可能需要很长时间，因为所有的库都是从头开始重新安装的。第二部分中的<a class="ae jr" rel="noopener" href="/@aherve/dockerized-development-environment-on-steroids-part-2-2-b800a65d0462#.235fodt6h">。我们将改进我们的配置，以显著加快这一步。</a></p><p id="fbab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">编码快乐！</p><p id="fb89" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">前往第2/2部分，了解如何将您的工作流程应用于类固醇！</p><p id="3467" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">延伸阅读:<a class="ae jr" rel="noopener" href="/@aherve/edge-node-express-api-using-docker-typescript-codeship-mongoose-37397cd07955#.gnqj3w7av">使用typescript构建node-express api的文档化开发环境</a></p><div class="ld le lf lg fq ab cb"><figure class="me lh mf mg mh mi mj paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="me lh mf mg mh mi mj paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="me lh mf mg mh mi mj paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mk ml mm"><p id="f922" class="ir is js it b iu iv iw ix iy iz ja jb mn jd je jf mo jh ji jj mp jl jm jn jo hn dt translated"><a class="ae jr" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jr" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jr" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jr" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="7b1b" class="ir is js it b iu iv iw ix iy iz ja jb mn jd je jf mo jh ji jj mp jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jr" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jr" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ld le lf lg fq lh fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff mq"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure><figure class="ld le lf lg fq lh"><div class="bz el l di"><div class="mr md l"/></div></figure></div></div>    
</body>
</html>