<html>
<head>
<title>More polish</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更加完美</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/more-polish-59b1a13480a0?source=collection_archive---------11-----------------------#2017-05-21">https://medium.com/hackernoon/more-polish-59b1a13480a0?source=collection_archive---------11-----------------------#2017-05-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="7ec6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是N部分系列的第10部分，详细介绍了我如何制作我的动画。</p><p id="47e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://hackernoon.com/some-polish-62200a044d27" rel="noopener ugc nofollow" target="_blank">上一张</a> <a class="ae jp" rel="noopener" href="/@kevpluck/putting-it-out-there-f830d3846a34">下一张</a></p><p id="13c3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上周，我设法向你展示了如何渲染x轴，这比我预期的要多花一点功夫，所以希望y轴不会太有挑战性，尤其是因为它是一个简单的标量值。</p><p id="e5cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">y轴是<a class="ae jp" href="https://hackernoon.com/tagged/co2" rel="noopener ugc nofollow" target="_blank"> CO2 </a> <a class="ae jp" href="https://hackernoon.com/tagged/measured" rel="noopener ugc nofollow" target="_blank">的浓度，测量值</a>为PPM(百万分之一)，范围约为310-400 PPM。</p><p id="32fb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为题外话；为了理解这些数字，这里有一个400 PPM的图像:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/a9dec18701c067bb2cefdc859a4b66d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*eVuQreK6yELMGjGG7Eht5A.png"/></div></figure><p id="7cff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关于计算y轴，我注意到的第一件事是，与x轴不同，我们在渲染之前知道最大x值，因为它只是一个时间变量，我们不知道最大y值，直到它从数据中提取出来并进行缩放。没问题，我们只需在绘制值后绘制y轴。</p><p id="74c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我们需要一个变量来记录最大CO2值:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="5aa3" class="kd ke hu jz b fv kf kg l kh ki">float co2Max = 0.0;</span></pre><p id="a1e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<code class="eh kj kk kl jz b">drawGraph()</code>中的<code class="eh kj kk kl jz b">for</code>循环之前弹出。</p><p id="6726" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<code class="eh kj kk kl jz b">for</code>循环中提取CO2值后，添加:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="daba" class="kd ke hu jz b fv kf kg l kh ki">if(co2 &gt; co2Max) co2Max = co2;</span></pre><p id="ac09" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<code class="eh kj kk kl jz b">for</code>循环后添加:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="f2e1" class="kd ke hu jz b fv kf kg l kh ki">drawYAxis(co2Max, yScale);</span></pre><p id="4d58" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那下面会有红色的曲线，因为我们还没有创建<code class="eh kj kk kl jz b">drawYAxis()</code>。所以让我们在<code class="eh kj kk kl jz b">drawGraph()</code>之后马上开始:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="3ece" class="kd ke hu jz b fv kf kg l kh ki">void drawYAxis(float co2Max, float yScale)<br/>{<br/>  <br/>}</span></pre><p id="0025" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我认为从320PPM开始显示每10PPM的刻度线应该足够了，所以让我们设置起始值:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="acb2" class="kd ke hu jz b fv kf kg l kh ki">float co2Tick = 320.0;</span></pre><p id="e187" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，当<code class="eh kj kk kl jz b">co2Tick</code>小于<code class="eh kj kk kl jz b">co2Max</code>时，我们要为刻度线画一条线，并用值标记它，然后将它增加10:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="d9af" class="kd ke hu jz b fv kf kg l kh ki">while(co2Tick &lt;= co2Max)<br/>{<br/> float yAxisTickPos = height - MARGIN - (co2Tick - 313.04) * yScale;</span><span id="9926" class="kd ke hu jz b fv km kg l kh ki"> line(MARGIN, yAxisTickPos, MARGIN - 5.0, yAxisTickPos);<br/> text(int(co2Tick), MARGIN - 15, yAxisTickPos+3);<br/> <br/> co2Tick += 10.0;<br/>}</span></pre><p id="5500" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">记住，当y轴翻转时，我们需要从<code class="eh kj kk kl jz b">height</code>中减去数值。嗯，<code class="eh kj kk kl jz b">313.04</code>是数据中的最小CO2水平，也许应该通过创建一个全局常数来使其变得明显:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="5eb6" class="kd ke hu jz b fv kf kg l kh ki">final float CO2MIN = 313.04;</span></pre><p id="293e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这样更好:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="368a" class="kd ke hu jz b fv kf kg l kh ki">float yAxisTickPos = height - MARGIN - (co2Tick - CO2MIN) * yScale;</span></pre><p id="3d34" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">行<code class="eh kj kk kl jz b">co2Tick += 10.0</code>是一种将变量递增10的简写方式。相当于<code class="eh kj kk kl jz b">co2Tick = co2Tick + 10.0</code>。</p><p id="be9e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们试一试:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="kn ko l"/></div></figure><p id="0169" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这很好，但是，看起来我们需要设置初始的最大CO2，这样我们就可以开始做一些记号了。初始最大CO2值必须是图表顶部的CO2值。在我们调用<code class="eh kj kk kl jz b">drawYAxis()</code>之前弹出这段代码:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="ca26" class="kd ke hu jz b fv kf kg l kh ki">if((co2Max - CO2MIN) * yScale &lt; graphHeight) <br/>    co2Max = graphHeight / yScale + CO2MIN;</span></pre><p id="fe34" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">导致:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="kn ko l"/></div></figure><p id="1f01" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好多了。</p><p id="62a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们需要标记轴。x轴是直向前的:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="6345" class="kd ke hu jz b fv kf kg l kh ki">text("Year", MARGIN + graphWidth / 2, height - 20);</span></pre><p id="9253" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是y轴需要旋转。做好准备，因为这涉及到一些矩阵操作。别担心，我们不会做矩阵乘法或点积运算(尽管那会很有趣)。我们将简单地使用这两个函数:<code class="eh kj kk kl jz b">translate()</code>和<code class="eh kj kk kl jz b">rotate()</code>。</p><p id="7456" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想象一个网格覆盖了我们的绘图空间，原点在左上角，然后调用<code class="eh kj kk kl jz b">translate(x,y)</code>将原点和整个网格移动到你的新位置，同时<code class="eh kj kk kl jz b">rotate(radian)</code>围绕原点旋转整个网格。调用这些矩阵操作函数后，所有随后的绘图函数将在修改后的网格上绘制它们的点。</p><p id="55de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着当我们绘制一些旋转的文本时，我们必须再次将网格旋转回来。呃。谢天谢地，Processing对此有一个简单的解决方案；这是矩阵堆栈。(不确定什么是<em class="kp">栈</em>？我们开始吧。)它有两个命令；<code class="eh kj kk kl jz b">pushMatrix()</code>和<code class="eh kj kk kl jz b">popMatrix()</code>。基本上,<code class="eh kj kk kl jz b">pushMatrix()</code>会记住网格的当前方向，这样你就可以随心所欲地操作它，然后<code class="eh kj kk kl jz b">popMatrix()</code>会恢复它。因为它是一个堆栈，所以只要一个<code class="eh kj kk kl jz b">popMatrix()</code>调用与前面的<code class="eh kj kk kl jz b">pushMatrix()</code>成对出现，你就可以重复调用这些方法。</p><p id="138a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以就在<code class="eh kj kk kl jz b">drawYAxis()</code>之前加一句:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="888d" class="kd ke hu jz b fv kf kg l kh ki">pushMatrix();<br/>    translate(0, graphWidth / 2);<br/>    rotate(-PI / 2.0);<br/>    text("CO₂ concentration (PPM)", 0, 20);<br/>popMatrix();</span></pre><p id="f360" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当使用弧度(当然是角度的最佳单位)时，我喜欢使用<code class="eh kj kk kl jz b">PI</code>的分数，因为它更容易理解，因为你只需要记住180°是<code class="eh kj kk kl jz b">PI</code>，90°是<code class="eh kj kk kl jz b">PI / 2</code>，45°是<code class="eh kj kk kl jz b">PI / 4</code>等等。</p><p id="9b11" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">给主图加标题后，我们得到:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="kn ko l"/></div></figure><p id="37d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以及现在相当长且完整的代码:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="f7b5" class="kd ke hu jz b fv kf kg l kh ki">import java.time.*;<br/>import de.looksgood.ani.*;<br/>Ani _ani;</span><span id="c1ba" class="kd ke hu jz b fv km kg l kh ki">FloatDict _data = new FloatDict();<br/>LocalDate _startDate = LocalDate.of(1958, 3, 29);</span><span id="dc0d" class="kd ke hu jz b fv km kg l kh ki">void setup()<br/>{<br/>  loadData();<br/>  size(500,500);<br/>  background(0);<br/>  stroke(255,255,0);<br/>  textAlign(CENTER);<br/>  <br/>  Ani.init(this);<br/>  Ani.setDefaultTimeMode(Ani.FRAMES);<br/>  _ani = new Ani(this, 530, "_change", 6, Ani.EXPO_IN);<br/>}</span><span id="42f9" class="kd ke hu jz b fv km kg l kh ki">float yScale = 20.0;</span><span id="29a9" class="kd ke hu jz b fv km kg l kh ki">boolean _coda = false;<br/>int _codaCount = 0;</span><span id="6e1f" class="kd ke hu jz b fv km kg l kh ki">float _change = 1.0;<br/>final int MARGIN = 60;<br/>final float CO2MIN = 313.04;</span><span id="5ffe" class="kd ke hu jz b fv km kg l kh ki">void draw()<br/>{<br/>  // The following pauses the animation before exiting<br/>  if(_change &gt;= 6.0) <br/>  {<br/>    if(!_coda)<br/>    {<br/>      _coda = true;<br/>      _codaCount = frameCount;<br/>    }<br/>    if(frameCount - _codaCount &gt; 120) <br/>    {<br/>      exit();<br/>    }<br/>    return;<br/>  }<br/>  <br/>  background(0);<br/>  strokeWeight(1);<br/>  <br/>  line(MARGIN, 0, MARGIN, height);<br/>  line(0, height - MARGIN, width, height - MARGIN);<br/>  <br/>  drawGraph(MARGIN, height - MARGIN, width - MARGIN, height - MARGIN);<br/>}</span><span id="9728" class="kd ke hu jz b fv km kg l kh ki">void drawGraph(int xPos, int yPos, int graphWidth, int graphHeight)<br/>{<br/>  text("Atmospheric CO₂ concentration 1958 - 2017\nR. F. Keeling, S. J. Walker, S. C. Piper and A. F. Bollenbacher\nMauna Loa, Observatory, Hawaii", MARGIN + graphWidth / 2.0, MARGIN);<br/>  int deltaX = int(frameCount * _change);<br/>    <br/>  float xScale = 1.0;<br/>  <br/>  int xAxisMaximum = graphWidth;<br/>  <br/>  <br/>  if(deltaX &gt; graphWidth)<br/>  {<br/>    xAxisMaximum = deltaX;<br/>    xScale = float(graphWidth) / float(deltaX);<br/>  }<br/>  <br/>  text("Year", MARGIN + graphWidth / 2, height - 20);<br/>  drawXAxis(xAxisMaximum, xScale);<br/>  <br/>  strokeWeight(3);<br/>  <br/>  float co2Max = 0.0;<br/>  <br/>  for(int dataIndex = 1; dataIndex &lt;= deltaX; dataIndex++)<br/>  {<br/>    <br/>    int daysFromStart = (dataIndex - 1) * 7;<br/>    LocalDate frameDate = _startDate.plusDays(daysFromStart);<br/>       <br/>    <br/>    if(_data.hasKey(frameDate.toString()))<br/>    {<br/>      float co2 = _data.get(frameDate.toString());<br/>      <br/>      if(co2 &gt; co2Max) co2Max = co2;<br/>            <br/>      float x = dataIndex;<br/>      float y = (co2 - CO2MIN);<br/>      <br/>      if(y * yScale &gt; graphHeight) <br/>      {<br/>        yScale = float(graphHeight)/y;<br/>      }<br/>      <br/>      point(xPos + x * xScale, yPos - (y * yScale));<br/>    }<br/>  }<br/>  <br/>  if((co2Max - CO2MIN) * yScale &lt; graphHeight) <br/>    co2Max = graphHeight / yScale + CO2MIN;<br/>  <br/>  pushMatrix();<br/>    translate(0, graphWidth / 2);<br/>    rotate(-PI / 2.0);<br/>    text("CO₂ concentration (PPM)", 0, 20);<br/>  popMatrix();<br/>  <br/>  drawYAxis(co2Max, yScale);<br/>}</span><span id="0ebc" class="kd ke hu jz b fv km kg l kh ki">void drawYAxis(float co2Max, float yScale)<br/>{<br/>  float co2Tick = 320.0;<br/>  strokeWeight(1);<br/>  <br/>  while(co2Tick &lt;= co2Max)<br/>  {<br/>    float yAxisTickPos = height - MARGIN - (co2Tick - CO2MIN) * yScale;<br/>    <br/>    line(MARGIN, yAxisTickPos, MARGIN - 5.0, yAxisTickPos);<br/>    text(int(co2Tick), MARGIN - 15, yAxisTickPos+3);<br/>    <br/>    co2Tick += 10.0;<br/>  }<br/>}</span><span id="6960" class="kd ke hu jz b fv km kg l kh ki">void drawXAxis(int xAxisMaximum, float xScale)<br/>{<br/>  int yPos = height - MARGIN;<br/>  float xAxisTick = 279.0 / 7.0;<br/>  int axisYear = 1959;<br/>  <br/>  while(xAxisTick &lt;= xAxisMaximum)<br/>  {<br/>    int tickLength = 5;<br/>    int xPos = MARGIN + int(xAxisTick * xScale);<br/>    <br/>    if(axisYear % 5 == 0)<br/>    {<br/>      text(axisYear, xPos, yPos + 22);<br/>      tickLength = 10;<br/>    }<br/>        <br/>    line(xPos, yPos, xPos, yPos + tickLength);<br/>    <br/>    xAxisTick += 365.25 / 7.0;<br/>    axisYear++;<br/>  }<br/>}</span><span id="54d0" class="kd ke hu jz b fv km kg l kh ki">void loadData()<br/>{<br/>  String[] lines = loadStrings("weekly_in_situ_co2_mlo.csv");<br/>  <br/>  for (String line : lines) <br/>  {<br/>    if( line.startsWith("\"") ) continue;<br/>    <br/>    String[] values = split(line, ',');<br/>    String date = values[0];<br/>    float co2 = parseFloat(values[1]);<br/>    _data.set(date, co2);<br/>  }<br/>}</span></pre><p id="6343" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下周，我将向你展示如何录制视频和生成gif，并把它们放到互联网上。</p><div class="jr js jt ju fq ab cb"><figure class="kq jv kr ks kt ku kv paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="kq jv kr ks kt ku kv paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="kq jv kr ks kt ku kv paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="kw kx ky"><p id="f922" class="ir is kp it b iu iv iw ix iy iz ja jb kz jd je jf la jh ji jj lb jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is kp it b iu iv iw ix iy iz ja jb kz jd je jf la jh ji jj lb jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="fe ff lc"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lh ko l"/></div></figure></div></div>    
</body>
</html>