<html>
<head>
<title>How to pass complex data to custom InfoWindows on a GoogleMap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将复杂数据传递给GoogleMap上的自定义信息窗口</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-pass-complex-data-to-custom-infowindows-on-a-googlemap-3a50d0df1be0?source=collection_archive---------3-----------------------#2017-08-21">https://medium.com/hackernoon/how-to-pass-complex-data-to-custom-infowindows-on-a-googlemap-3a50d0df1be0?source=collection_archive---------3-----------------------#2017-08-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/7e46f7933c5c7c04e81765a35f2ecaef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LgjfqvQSSezZ9Gvlr73wtA.jpeg"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Orb thingy and sky with clouds. Fuck yeah</figcaption></figure><div class=""/><div class=""><h2 id="2a4c" class="pw-subtitle-paragraph jg ii ij bd b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ek translated">最差。博客。贴吧。标题。永远不会。</h2></div><p id="281d" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">妈的。你刚刚点击了一篇题为“如何将复杂数据传递到GoogleMap上的自定义信息窗口”的文章吗？我对你的求知欲印象深刻。</p><p id="7d28" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">在Android上，当你点击GoogleMap对象上的一个标记时，就会弹出一个信息窗口。InfoWindow包含(不出所料)信息，这些信息通常与放置标记的位置相关。这是默认信息窗口的样子(截图来自我的应用，<a class="ae ku" href="https://play.google.com/store/apps/details?id=com.saladdressing.looksie" rel="noopener ugc nofollow" target="_blank"> Looxie </a></p><figure class="kw kx ky kz fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff kv"><img src="../Images/607e252d705f6ca082930ad85cb55ef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vF2o-LG80tQB5cc7e_Kbig.png"/></div></div></figure><p id="2315" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">看到那个“四级用户:收集2059积分”的东西了吗？这就是默认信息窗口的外观。</p><p id="9896" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">有时候，那是行不通的。例如，您可能希望在信息窗口上放置一个图像。或者在上面设置一个自定义的字体，这样它就可以和你的应用程序的其他部分保持一致。例如，这是我在<a class="ae ku" href="https://play.google.com/store/apps/details?id=com.codehousefive.disembody" rel="noopener ugc nofollow" target="_blank">我最新的实验应用</a>中想要的信息窗口的样子</p><figure class="kw kx ky kz fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff kv"><img src="../Images/715dee33b6a0b59c6c846767f9b02bd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WaZlUIuJGt4jwgDhnRdVqw.png"/></div></div></figure><p id="e7c0" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">看到工作中的<a class="ae ku" href="http://atipofoundry.com/fonts/bariol" rel="noopener ugc nofollow" target="_blank">甜甜圈字体</a>了吗？可爱的“播放”按钮呢？这需要使用定制的信息窗口。自定义信息窗口并不是本文的重点(而是传递给信息窗口的信息),但是这里有一些步骤，供外行参考</p><ul class=""><li id="ec26" class="la lb ij ka b kb kc ke kf kh lc kl ld kp le kt lf lg lh li dt translated">首先，在本教程之后的<a class="ae ku" href="https://developers.google.com/maps/documentation/android-api/start" rel="noopener ugc nofollow" target="_blank">之前添加Google Play服务和Google Maps SDK。您还必须获得一个API密钥。</a></li><li id="bb83" class="la lb ij ka b kb lj ke lk kh ll kl lm kp ln kt lf lg lh li dt translated">完成后，你需要在布局中添加一个<fragment>，并添加你想要的属性和粗体线条</fragment></li></ul><pre class="kw kx ky kz fq lo lp lq lr aw ls dt"><span id="18ae" class="lt lu ij lp b fv lv lw l lx ly">&lt;fragment android:id=”@+id/map”    <br/><strong class="lp ik">    android:name=”com.google.android.gms.maps.SupportMapFragment”  <br/></strong>    android:layout_width=”match_parent” <br/>    android:layout_height=”match_parent” /&gt;</span></pre><ul class=""><li id="b9e2" class="la lb ij ka b kb kc ke kf kh lc kl ld kp le kt lf lg lh li dt translated">这将允许您在Java代码中将<fragment>转换为<strong class="ka ik"> SupportMapFragment </strong>，如下所示</fragment></li></ul><pre class="kw kx ky kz fq lo lp lq lr aw ls dt"><span id="89fc" class="lt lu ij lp b fv lv lw l lx ly">SupportMapFragment mapFragment = (SupportMapFragment) getSupportFragmentManager() .findFragmentById(R.id.map);</span></pre><ul class=""><li id="3f0e" class="la lb ij ka b kb kc ke kf kh lc kl ld kp le kt lf lg lh li dt translated">最后，通过调用片段上的getMapAsync()并传入当前活动上下文，在片段中显示地图</li></ul><pre class="kw kx ky kz fq lo lp lq lr aw ls dt"><span id="a5ba" class="lt lu ij lp b fv lv lw l lx ly">mapFragment.getMapAsync(this);</span></pre><p id="0118" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">如果您的设置正常，您现在应该会在片段中看到一个Google地图。</p><p id="fc30" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">要开始在Google地图上放置和操作标记，让托管地图的活动实现<strong class="ka ik"> OnMapReadyCallback </strong>接口总是一个好主意。这将允许您(实际上是强迫您)在活动中实现一个名为<strong class="ka ik"> onMapReady() </strong>的回调方法，该方法将在地图加载并准备就绪后立即执行。</p><pre class="kw kx ky kz fq lo lp lq lr aw ls dt"><span id="77e4" class="lt lu ij lp b fv lv lw l lx ly">public void onMapReady(GoogleMap map) {</span><span id="5f6c" class="lt lu ij lp b fv lz lw l lx ly">}</span></pre><p id="52a5" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">该方法向您传递一个GoogleMap实例，然后您可以使用它在地图上执行各种操作。</p><p id="3426" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">您现在可以通过执行以下操作在地图上放置一个标记(在<strong class="ka ik"> onMapReady() </strong>中)</p><pre class="kw kx ky kz fq lo lp lq lr aw ls dt"><span id="c69e" class="lt lu ij lp b fv lv lw l lx ly">Marker marker = map.addMarker(new MarkerOptions().position(<strong class="lp ik">latLng</strong>) .icon(BitmapDescriptorFactory.fromResource(<strong class="lp ik">iconResource</strong>)) .title(<strong class="lp ik">title</strong>).snippet(<strong class="lp ik">snippet</strong>));</span></pre><p id="7bc0" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">粗体变量分别是，</p><ul class=""><li id="5567" class="la lb ij ka b kb kc ke kf kh lc kl ld kp le kt lf lg lh li dt translated">一个包含你的纬度和经度的对象</li><li id="92e7" class="la lb ij ka b kb lj ke lk kh ll kl lm kp ln kt lf lg lh li dt translated">图标资源，如R.drawable.my_icon</li><li id="2cc1" class="la lb ij ka b kb lj ke lk kh ll kl lm kp ln kt lf lg lh li dt translated">包含<em class="ma">标记标题</em>的字符串变量</li><li id="3cb9" class="la lb ij ka b kb lj ke lk kh ll kl lm kp ln kt lf lg lh li dt translated">另一个保存标记额外信息的字符串变量叫做<em class="ma">片段。</em> <strong class="ka ik">记住这一条，很重要。</strong></li></ul><p id="ee54" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">这将在地图上放置一个带有默认信息窗口的标记。然而，众所周知</p><blockquote class="mb mc md"><p id="2f46" class="jy jz ma ka b kb kc jk kd ke kf jn kg me ki kj kk mf km kn ko mg kq kr ks kt hn dt translated">默认的信息窗口很难看。默认信息窗口正在运行。当默认的信息窗口出现在信息窗口学校时，它们会受到更酷、更个性化的信息窗口的欺负。你想让你的信息窗口被欺负吗，野蛮人？</p></blockquote><p id="ceac" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">这是从《当你在谷歌地图上放置标记时会发生什么》一书中直接引用的，所以闭嘴，跟着我做。</p><p id="e680" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">要创建自己的定制InfoWindow，您需要创建自己的实现<strong class="ka ik"> GoogleMap的类。InfoWindowAdapter </strong>然后覆盖两个方法:<strong class="ka ik"> getInfoContents() </strong>和<strong class="ka ik"> getInfoWindow() </strong></p><p id="32b4" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">这两种方法的区别在于，<strong class="ka ik"> getInfoContents() </strong>提供了一个默认的“气泡”、阴影和指向标记的脱字符号(见上面我的第一个截图)，而<strong class="ka ik"> getInfoWindow() </strong>没有提供<em class="ma">任何东西</em>，就像1998年家庭度假时你的那个吝啬叔叔，当你在游泳池边想要一个奇怪的冰淇淋，但他太便宜了，没有给你买。</p><p id="ca64" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">[深呼吸]</p><p id="49ed" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">当您覆盖getInfoWindow()时，您通过膨胀一个XML布局来提供整个布局、背景和所有内容。下面是InfoWindowAdapter的一个实现</p><pre class="kw kx ky kz fq lo lp lq lr aw ls dt"><span id="9b65" class="lt lu ij lp b fv lv lw l lx ly">public class InfoWindowCustom implements GoogleMap.InfoWindowAdapter {</span><span id="537f" class="lt lu ij lp b fv lz lw l lx ly">    Context context; <br/>    LayoutInflater inflater;</span><span id="6057" class="lt lu ij lp b fv lz lw l lx ly">    public InfoWindowCustom(Context context) {<br/>           this.context = context;<br/>    }</span><span id="370e" class="lt lu ij lp b fv lz lw l lx ly">    @Override    <br/>    public View <strong class="lp ik">getInfoContents(Marker marker)</strong> {        <br/>        return null;    <br/>    }</span><span id="2f4e" class="lt lu ij lp b fv lz lw l lx ly">    @Override<br/>    public View <strong class="lp ik">getInfoWindow(Marker marker)</strong> {</span><span id="dd30" class="lt lu ij lp b fv lz lw l lx ly">    inflater = (LayoutInflater)<br/>context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);         </span><span id="140d" class="lt lu ij lp b fv lz lw l lx ly">   // <strong class="lp ik">R.layout.echo_info_window</strong> is a layout in my <br/>   // <strong class="lp ik">res/layout folder</strong>. You can provide your own</span><span id="320a" class="lt lu ij lp b fv lz lw l lx ly">    View v = inflater.inflate(<em class="ma">R.layout.echo_info_window</em>, null);   <br/>         <br/>    TextView title = (TextView) v.findViewById(R.id.info_window_title);     <br/>  TextView subtitle = (TextView) v.findViewById(R.id.info_window_subtitle);</span><span id="0141" class="lt lu ij lp b fv lz lw l lx ly">    title.setText(marker.getTitle());<br/>    subtitle.setText(marker.getSnippet());</span><span id="65f6" class="lt lu ij lp b fv lz lw l lx ly">    return v;</span><span id="91fd" class="lt lu ij lp b fv lz lw l lx ly">    }</span><span id="8403" class="lt lu ij lp b fv lz lw l lx ly">}</span></pre><p id="0484" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">同时，回到显示地图的活动中的<strong class="ka ik"> onMapReady() </strong>的神奇土地，您必须在地图上设置InfoWindowAdapter实现，就像这样</p><pre class="kw kx ky kz fq lo lp lq lr aw ls dt"><span id="8b4d" class="lt lu ij lp b fv lv lw l lx ly">map.setInfoWindowAdapter(new InfoWindowCustom(this));</span></pre><p id="d83e" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">从现在开始，无论何时点击一个标记，所有的标记信息都将被漂亮地显示出来，被你的自定义信息窗口框住。</p><figure class="kw kx ky kz fq hw"><div class="bz el l di"><div class="mh mi l"/></div></figure><h2 id="4d85" class="lt lu ij bd mj mk ml mm mn mo mp mq mr kh ms mt mu kl mv mw mx kp my mz na nb dt translated">俄罗斯山上实现的承诺</h2><p id="e43c" class="pw-post-body-paragraph jy jz ij ka b kb nc jk kd ke nd jn kg kh ne kj kk kl nf kn ko kp ng kr ks kt hn dt translated">但是等等！这不是我承诺的！我承诺的是将复杂数据传递给InfoWindow适配器的能力，现在这似乎有点困难，因为标记只能携带两部分数据:一个<strong class="ka ik">标题</strong>和一个<strong class="ka ik">片段</strong>。</p><p id="7556" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">当我第一次遇到这个问题时，我的解决方案是将我想要显示的所有内容连接到代码片段中，用换行符(" \n ")分隔代表不同数据的不同行。</p><p id="c7c7" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">然而，这意味着，如果我想对不同的数据片段采用不同的样式，我将不得不修改Spannables和String的长度。您曾经使用Spannables处理过串联的字符串数据吗？我有，而且我很确定撒旦的肛门侵犯是一个更令人兴奋的前景。</p><p id="c025" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">没有。我需要更简单的东西。然后突然我的眼睛亮了起来，我觉得自己就像是维尔纳·爱因斯坦发现了马克思主义。</p><p id="25ad" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">为什么我不能简单地将对象的JSON表示传递给代码片段，然后在InfoWindowAdapter中检索该代码片段，并将其转换回对象呢？</p><p id="0f82" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">事实证明我可以。我做到了。</p><p id="def5" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">假设您有一个名为MarkerInfo的类</p><pre class="kw kx ky kz fq lo lp lq lr aw ls dt"><span id="aee5" class="lt lu ij lp b fv lv lw l lx ly">public class MarkerInfo {</span><span id="81a2" class="lt lu ij lp b fv lz lw l lx ly">    private String title;<br/>    private String subtitle;<br/>    private String soundUrl;<br/>    private int numberOfPlays;</span><span id="02d4" class="lt lu ij lp b fv lz lw l lx ly">   public MarkerInfo() { }</span><span id="5c0a" class="lt lu ij lp b fv lz lw l lx ly">   // getters and setters omitted because I'm not writing this in<br/>   // an IDE. But assume that they are there</span><span id="27a7" class="lt lu ij lp b fv lz lw l lx ly">}</span></pre><p id="bb93" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">将该类的对象转换成JSON表示并转换回对象的一个超级简单的方法是使用像<a class="ae ku" href="https://github.com/google/gson" rel="noopener ugc nofollow" target="_blank"> Gson </a>这样的库。</p><p id="0ec7" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">在将MarkerInfo对象导入到您的项目中之后，您只需这样做就可以将它转换成字符串(JSON)表示</p><pre class="kw kx ky kz fq lo lp lq lr aw ls dt"><span id="103e" class="lt lu ij lp b fv lv lw l lx ly">MarkerInfo markerInfo = new MarkerInfo();<br/>markerInfo.setTitle("Shit went down");<br/>markerInfo.setSubtitle("In Hell's Kitchen");<br/>markerInfo.setSoundUrl("https://www.luke.com/matthew/jessica/dumbass.mp3");<br/>markerInfo.setNumberOfPlays(66);</span><span id="54bb" class="lt lu ij lp b fv lz lw l lx ly">Gson gson = new Gson();<br/><strong class="lp ik">String markerInfoString = gson.toJson(markerInfo);</strong></span></pre><p id="24af" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">因此，当您在标记上设置snippet属性时，您可以将结果字符串传递给它，然后在您的自定义InfoWindowAdapter类中，您可以检索对象的字符串表示形式，并将其转换回对象。</p><pre class="kw kx ky kz fq lo lp lq lr aw ls dt"><span id="d966" class="lt lu ij lp b fv lv lw l lx ly">Gson gson = new Gson();</span><span id="d552" class="lt lu ij lp b fv lz lw l lx ly"><strong class="lp ik">MarkerInfo aMarkerInfo = gson.fromJson(marker.getSnippet(), MarkerInfo.class);</strong></span></pre><p id="6749" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">现在，您可以单独访问任何对象字段，并在您认为合适的时候在视图上设置它。</p><p id="56f6" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">很酷吧。当然，在使用正确的关键词在互联网上进行一些研究后，我发现在我“发现”之前，其他人已经使用过这个技巧，但是去他妈的那些家伙，因为他们不是我。</p></div></div>    
</body>
</html>