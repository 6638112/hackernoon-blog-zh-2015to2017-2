<html>
<head>
<title>Up and Running with Universal Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用通用组件启动和运行</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/up-and-running-with-universal-components-66678132cad?source=collection_archive---------11-----------------------#2017-09-25">https://medium.com/hackernoon/up-and-running-with-universal-components-66678132cad?source=collection_archive---------11-----------------------#2017-09-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/5d4f909f7371c477d31be0cd727aa104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yNDn_b-ahQRgaD4fNIRJAQ.jpeg"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Photo by <a class="ae ih" href="https://unsplash.com/photos/mMcqMYJfopo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Patrick Fore</a> on <a class="ae ih" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="17cb" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我最近<a class="ae ih" href="https://labs.mlssoccer.com/the-road-to-universal-components-at-major-league-soccer-eeb7aac27e6c" rel="noopener ugc nofollow" target="_blank">写了</a>为什么我们在美国职业足球大联盟选择通用组件，我收到了很多反馈，询问我们实际上如何实施我们的UCs系统的细节。</p><figure class="kf kg kh ki fq hw"><div class="bz el l di"><div class="kj kk l"/></div></figure><figure class="kf kg kh ki fq hw"><div class="bz el l di"><div class="kj kk l"/></div></figure><p id="a4fe" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">虽然对我们来说开源我们的MLS特定组件没有意义，但我不想让每个人都挂在我们如何实现UCs的问题上，所以我创建了一个<a class="ae ih" href="https://github.com/kkemple/universal-components-example" rel="noopener ugc nofollow" target="_blank">示例库</a>，并将在这篇文章中介绍如何设置您自己的UC系统。</p><blockquote class="kl km kn"><p id="9b1b" class="jh ji ko jj b jk jl jm jn jo jp jq jr kp jt ju jv kq jx jy jz kr kb kc kd ke hn dt translated">部署的故事书可以在<a class="ae ih" href="http://universal-components-example-storybook.surge.sh" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></blockquote><h1 id="57aa" class="ks kt ik bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">选择解决方案</h1><p id="5ac7" class="pw-post-body-paragraph jh ji ik jj b jk lq jm jn jo lr jq jr js ls ju jv jw lt jy jz ka lu kc kd ke hn dt translated">实施UCs时，您将面临的第一个挑战是您的库基于什么解决方案。目前有两种选择，<code class="eh lv lw lx ly b"><a class="ae ih" href="https://github.com/necolas/react-native-web" rel="noopener ugc nofollow" target="_blank">react-native-web</a></code> (RNW)和<code class="eh lv lw lx ly b"><a class="ae ih" href="https://github.com/lelandrichardson/react-primitives" rel="noopener ugc nofollow" target="_blank">react-primitives</a></code> (RP)。在美国职业足球大联盟，我们决定选择RNW有两个原因:</p><ol class=""><li id="db93" class="lz ma ik jj b jk jl jo jp js mb jw mc ka md ke me mf mg mh dt translated">它比react-primitives更成熟。这听起来可能很奇怪，因为两者在技术上都处于早期alpha阶段，但RNW目前与React Native旗鼓相当，并支持React 16。(<a class="ae ih" href="https://github.com/airbnb/react-sketchapp/issues/104" rel="noopener ugc nofollow" target="_blank">https://github.com/airbnb/react-sketchapp/issues/104</a>)<br/>这意味着RNW将与<code class="eh lv lw lx ly b">create-react-app</code>、<code class="eh lv lw lx ly b">create-react-native-app</code>和<code class="eh lv lw lx ly b">react-native init</code>一起开箱即用。CRA和CRNA的例子都可以在我在本文开头提到的例子库中找到。</li><li id="42d5" class="lz ma ik jj b jk mi jo mj js mk jw ml ka mm ke me mf mg mh dt translated">RP使用了<code class="eh lv lw lx ly b">Touchable</code>原语，它在技术上并不直接映射到RN。React Native中有一个<code class="eh lv lw lx ly b">Touchable</code> api，但它不是像<code class="eh lv lw lx ly b">TouchableOpacity</code>或任何其他React Native touchables那样的组件。这需要更复杂的设置。</li></ol><h1 id="2d1f" class="ks kt ik bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">设置项目</h1><p id="fc12" class="pw-post-body-paragraph jh ji ik jj b jk lq jm jn jo lr jq jr js ls ju jv jw lt jy jz ka lu kc kd ke hn dt translated">我们将使用<a class="ae ih" href="https://github.com/lerna/lerna" rel="noopener ugc nofollow" target="_blank"> Lerna </a>来设置一个monorepo。这将使管理我们的通用组件包(以及我们将来可能创建的任何包)的部署变得更加容易。</p><p id="4e24" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先我们需要安装Lerna。</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="fc25" class="mr kt ik ly b fv ms mt l mu mv">yarn add --global lerna</span></pre><p id="5175" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后我们需要为我们的项目创建一个新的文件夹，从项目的根目录运行<code class="eh lv lw lx ly b">yarn init</code>来创建一个新的<code class="eh lv lw lx ly b">package.json</code>，然后运行<code class="eh lv lw lx ly b">lerna init</code>来设置Lerna。</p><p id="71c5" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将创建一个基本的设置。您应该有一个如下所示的项目:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="3573" class="mr kt ik ly b fv ms mt l mu mv">packages/<br/>lerna.json<br/>package.json</span></pre><p id="96ae" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们在根目录下添加一个<code class="eh lv lw lx ly b">.gitignore</code>,并确保忽略所有我们最终可能使用的<code class="eh lv lw lx ly b">node_modules</code>目录。</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="237d" class="mr kt ik ly b fv ms mt l mu mv">**/node_modules/**</span></pre><p id="ded0" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们应该有一个这样的项目结构:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="009f" class="mr kt ik ly b fv ms mt l mu mv">packages/<br/>.gitignore<br/>lerna.json<br/>package.json</span></pre><p id="cdc5" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来我们需要创建我们的<code class="eh lv lw lx ly b">universal-components</code>包。在<code class="eh lv lw lx ly b">packages</code>目录中创建一个名为<code class="eh lv lw lx ly b">universal-components</code>的新文件夹。然后将<code class="eh lv lw lx ly b">cd</code>放入该目录，再次运行<code class="eh lv lw lx ly b">yarn init</code>(对于这个包，使用您想要在应用程序中导入组件的名称)。</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="4473" class="mr kt ik ly b fv ms mt l mu mv">packages/<br/>  universal-components/<br/>    package.json<br/>lerna.json<br/>package.json</span></pre><p id="2e1e" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们已经准备好了我们的包，我们需要设置通用组件。这意味着我们需要<a class="ae ih" href="https://babeljs.io/" rel="noopener ugc nofollow" target="_blank"> Babel </a>支持测试/故事书的代码传输，以及RNW的别名。</p><p id="898c" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先让我们安装所有需要的<code class="eh lv lw lx ly b">babel</code>依赖项:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="c99c" class="mr kt ik ly b fv ms mt l mu mv">// from within packages/universal-components</span><span id="5392" class="mr kt ik ly b fv mw mt l mu mv">yarn add -D babel-plugin-module-resolver babel-plugin-transform-class-properties babel-plugin-transform-es2015-modules-commonjs babel-preset-flow babel-preset-react babel-preset-stage-2 flow-bin</span></pre><p id="e34b" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">那可是好多模块啊！让我们看看它们各自的功能:</p><ul class=""><li id="e83e" class="lz ma ik jj b jk jl jo jp js mb jw mc ka md ke mx mf mg mh dt translated"><strong class="jj il">babel-plugin-module-resolver</strong>:用于别名和添加<code class="eh lv lw lx ly b">.web.js</code>扩展支持</li><li id="fe74" class="lz ma ik jj b jk mi jo mj js mk jw ml ka mm ke mx mf mg mh dt translated"><strong class="jj il">babel-plugin-transform-class-properties:</strong>用于添加对React Native中支持的类属性的支持。</li><li id="915f" class="lz ma ik jj b jk mi jo mj js mk jw ml ka mm ke mx mf mg mh dt translated"><strong class="jj il">babel-plugin-transform-es 2015-modules-commonjs:</strong>用于添加对导入/导出语句的支持，无需<code class="eh lv lw lx ly b">.default</code></li><li id="6825" class="lz ma ik jj b jk mi jo mj js mk jw ml ka mm ke mx mf mg mh dt translated"><strong class="jj il">通天塔-预设-流量:</strong>用于添加流量支持</li><li id="4137" class="lz ma ik jj b jk mi jo mj js mk jw ml ka mm ke mx mf mg mh dt translated"><strong class="jj il">巴别-预设-反应:</strong>用于添加反应支持</li><li id="60bb" class="lz ma ik jj b jk mi jo mj js mk jw ml ka mm ke mx mf mg mh dt translated"><strong class="jj il"> babel-preset-stage-2 </strong>:用于添加<code class="eh lv lw lx ly b">async/await</code>和<code class="eh lv lw lx ly b">rest/spread</code>运算符之类的东西(受React Native支持)</li><li id="c70f" class="lz ma ik jj b jk mi jo mj js mk jw ml ka mm ke mx mf mg mh dt translated"><strong class="jj il"> flow-bin </strong>:用于对我们的组件运行流</li></ul><p id="b333" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，我们需要在新的<code class="eh lv lw lx ly b">universal-components</code>包中创建一个<code class="eh lv lw lx ly b">.babelrc</code>文件，然后添加以下配置:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="6099" class="mr kt ik ly b fv ms mt l mu mv">{<br/>  "plugins": [<br/>    "transform-class-properties",<br/>    "transform-es2015-modules-commonjs",<br/>    [<br/>      "module-resolver",<br/>      {<br/>        "alias": {<br/>          "react-native": "react-native-web"<br/>        },<br/>        "extensions": ["web.js", ".js"]<br/>      }<br/>    ]<br/>  ],<br/>  "presets": ["react", "stage-2", "flow"]<br/>}</span></pre><p id="8489" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">既然我们可以支持通用组件，我们需要安装React:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="3bc2" class="mr kt ik ly b fv ms mt l mu mv">yarn add -D react react-dom react-native-web prop-types</span></pre><p id="a1ba" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们将它们添加为<code class="eh lv lw lx ly b"> devDependencies</code>，因为我们不希望它们与我们的通用组件一起安装。在本地环境中，我们不想安装<code class="eh lv lw lx ly b">react-native-web</code>，反之亦然。因此，我们将它们添加为<code class="eh lv lw lx ly b">devDepenencies</code>，并将它们包含在我们的<code class="eh lv lw lx ly b">package.json</code>文件的<code class="eh lv lw lx ly b">peerDepencencies</code>部分中。这样，当UC包的用户安装时，他们将被警告所需的未满足的对等依赖。</p><blockquote class="kl km kn"><p id="5002" class="jh ji ko jj b jk jl jm jn jo jp jq jr kp jt ju jv kq jx jy jz kr kb kc kd ke hn dt translated">我们没有添加<code class="eh lv lw lx ly b">react-native</code>作为<code class="eh lv lw lx ly b">devDependency</code>，因为我们使用的是Storybook的web版本，在这个环境中不需要React Native。</p></blockquote><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="52ec" class="mr kt ik ly b fv ms mt l mu mv">// in packages/universal-components/package.json</span><span id="b063" class="mr kt ik ly b fv mw mt l mu mv">"peerDependencies": {<br/>  "prop-types": "&gt;=15",<br/>  "react": "&gt;=15",<br/>  "react-dom": "&gt;=15",<br/>  "react-native": "&gt;=0.42",<br/>  "react-native-web": "&gt;=0.0.129"<br/>}</span></pre><p id="b054" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们需要做的最后一件事是创建一个<code class="eh lv lw lx ly b">components</code>目录，它将是我们通用组件的未来之家。🏠</p><p id="cb3d" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">完成后，您的项目应该如下所示:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="130b" class="mr kt ik ly b fv ms mt l mu mv">packages/<br/>  universal-components/<br/>    components<br/>    .babelrc<br/>    package.json<br/>    yarn.lock<br/>lerna.json<br/>package.json</span></pre><p id="d7a6" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">好吧！现在我们准备开发我们的第一个通用组件！🎉</p><h1 id="44b2" class="ks kt ik bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">设置故事书</h1><p id="1a88" class="pw-post-body-paragraph jh ji ik jj b jk lq jm jn jo lr jq jr js ls ju jv jw lt jy jz ka lu kc kd ke hn dt translated">为了确保我们保持一个有组织的开发过程(并确保我们的组件在web上正常工作)，我们将使用<a class="ae ih" href="https://storybook.js.org/" rel="noopener ugc nofollow" target="_blank"> Storybook </a>来隔离开发并获得关于组件外观和行为的实时反馈。</p><p id="d34a" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们要做的第一件事是将storybook作为依赖项添加到我们的<code class="eh lv lw lx ly b">universal-components</code>包中。</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="f223" class="mr kt ik ly b fv ms mt l mu mv">// from within packages/universal-components</span><span id="ab52" class="mr kt ik ly b fv mw mt l mu mv">yarn add -D @storybook/react</span></pre><p id="67af" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，我们需要为我们的故事书配置创建一个<code class="eh lv lw lx ly b">.storybook</code>目录:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="f19c" class="mr kt ik ly b fv ms mt l mu mv">packages/<br/>  universal-components/<br/>    .storybook/<br/>    components/<br/>    .babelrc<br/>    package.json<br/>    yarn.lock<br/>lerna.json<br/>package.json</span></pre><p id="cd5e" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在<code class="eh lv lw lx ly b">.storybook</code>内部添加一个<code class="eh lv lw lx ly b">config.js</code>文件。这就是我们的基本故事书配置。在<code class="eh lv lw lx ly b">config.js</code>内添加以下内容:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="e25a" class="mr kt ik ly b fv ms mt l mu mv">import { configure } from '@storybook/react';</span><span id="3230" class="mr kt ik ly b fv mw mt l mu mv">const req = require.context(<br/>  '../components/', // path where stories live<br/>  true, // recursive?<br/>  /\__stories__\/.*.js$/, // story files match this pattern<br/>);</span><span id="48f8" class="mr kt ik ly b fv mw mt l mu mv">function loadStories() {<br/>  req.keys().forEach(module =&gt; req(module));<br/>}</span><span id="ed94" class="mr kt ik ly b fv mw mt l mu mv">configure(loadStories, module);</span></pre><p id="3636" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">重要的是我们配置Storybook在我们的<code class="eh lv lw lx ly b">components</code>目录中查找<code class="eh lv lw lx ly b">__stories__</code>目录并加载它们。</p><p id="34ea" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这让我们可以将我们的故事放在相关组件的旁边，这些组件很好，并且与默认的<a class="ae ih" href="https://facebook.github.io/jest/" rel="noopener ugc nofollow" target="_blank"> Jest </a>配置很好地匹配(稍后将详细介绍测试)。</p><p id="0b6c" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，我们必须改变Storybook的默认Webpack配置，以便我们可以正确地解析导入的通用组件。在<code class="eh lv lw lx ly b">.storybook</code>目录中创建一个<code class="eh lv lw lx ly b">webpack.config.js</code>文件，并添加以下内容:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="c621" class="mr kt ik ly b fv ms mt l mu mv">const path = require('path');<br/>const webpack = require('webpack');<br/>// use babel-minify due to UglifyJS errors from modern JS syntax<br/>const MinifyPlugin = require('babel-minify-webpack-plugin');</span><span id="bca9" class="mr kt ik ly b fv mw mt l mu mv">// get default webpack config for @storybook/react<br/>const genDefaultConfig = require('@storybook/react/dist/server/config/defaults/webpack.config.js');</span><span id="8adf" class="mr kt ik ly b fv mw mt l mu mv">const DEV = process.env.NODE_ENV !== 'production';<br/>const prodPlugins = [<br/>  new webpack.DefinePlugin({<br/>    'process.env.NODE_ENV': JSON.stringify(<br/>      process.env.NODE_ENV || 'development'<br/>    ),<br/>    'process.env.__REACT_NATIVE_DEBUG_ENABLED__': DEV,<br/>  }),<br/>  new webpack.optimize.OccurrenceOrderPlugin(),<br/>  new MinifyPlugin(),<br/>];</span><span id="ba59" class="mr kt ik ly b fv mw mt l mu mv">module.exports = (baseConfig, env) =&gt; {<br/>  const config = genDefaultConfig(baseConfig, env);<br/>  const defaultPlugins = config.plugins;<br/>  const overwrite = {<br/>    devtool: 'inline-source-map',<br/>    module: {<br/>      rules: [<br/>        {<br/>          test: /\.js$/,<br/>          exclude: /node_modules/,<br/>          loader: 'babel-loader',<br/>          query: { cacheDirectory: true },<br/>        },<br/>      ],<br/>    },<br/>    plugins: DEV ? defaultPlugins : prodPlugins,<br/>  };</span><span id="c656" class="mr kt ik ly b fv mw mt l mu mv">  return Object.assign(config, overwrite);<br/>};</span></pre><p id="7e28" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，我们在Storybook的生产构建过程中不会遇到任何问题，并准备创建一个组件，但首先让我们在<code class="eh lv lw lx ly b">package.json</code>中添加几个<code class="eh lv lw lx ly b">script</code>条目，让我们的生活变得更轻松一些。</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="b6b7" class="mr kt ik ly b fv ms mt l mu mv">// in universal-components/package.json</span><span id="7984" class="mr kt ik ly b fv mw mt l mu mv">"scripts": {<br/>  "storybook": "start-storybook -p 9001 -c .storybook",<br/>  "build: "build-storybook"<br/>  ...<br/>},</span></pre><p id="c9b2" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们在components中为一个<code class="eh lv lw lx ly b">Button</code>组件创建一个新目录:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="be23" class="mr kt ik ly b fv ms mt l mu mv">components/<br/>  button/<br/>    __stories__/<br/>      index.js<br/>    index.js</span></pre><p id="b810" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在<code class="eh lv lw lx ly b">button/index.js</code>中添加以下代码:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="e565" class="mr kt ik ly b fv ms mt l mu mv">// @flow</span><span id="b42d" class="mr kt ik ly b fv mw mt l mu mv">import React, { Component } from 'react';<br/>import {<br/>  Platform,<br/>  StyleSheet,<br/>  Text,<br/>  TouchableOpacity,<br/>  View,<br/>} from 'react-native';<br/>import PropTypes from 'prop-types';</span><span id="0a04" class="mr kt ik ly b fv mw mt l mu mv">export type ButtonProps = {<br/>  backgroundColor: string,<br/>  fontColor: string,<br/>  onPress: () =&gt; void,<br/>  size: string,<br/>  style: StyleSheet.Styles,<br/>  text: string,<br/>};</span><span id="6fe9" class="mr kt ik ly b fv mw mt l mu mv">const getButtonPadding = (size: string): number =&gt; {<br/>  switch (size) {<br/>    case 'small':<br/>      return 10;<br/>    case 'medium':<br/>      return 14;<br/>    case 'large':<br/>      return 18;<br/>    default:<br/>      return 14;<br/>  }<br/>};</span><span id="5214" class="mr kt ik ly b fv mw mt l mu mv">const getButtonFontSize = (size: string): number =&gt; {<br/>  switch (size) {<br/>    case 'small':<br/>      return 10;<br/>    case 'medium':<br/>      return 16;<br/>    case 'large':<br/>      return 20;<br/>    default:<br/>      return 16;<br/>  }<br/>};</span><span id="aa84" class="mr kt ik ly b fv mw mt l mu mv">export default class Button extends Component&lt;ButtonProps, *&gt; {<br/>  static propTypes = {<br/>    backgroundColor: PropTypes.string,<br/>    fontColor: PropTypes.string,<br/>    onPress: PropTypes.func.isRequired,<br/>    size: PropTypes.string,<br/>    style: PropTypes.oneOfType([<br/>      PropTypes.array,<br/>      PropTypes.object,<br/>      PropTypes.string,<br/>    ]),<br/>    text: PropTypes.string.isRequired,<br/>  };</span><span id="f40f" class="mr kt ik ly b fv mw mt l mu mv">  render = (): React$Element&lt;*&gt; =&gt; {<br/>    const {<br/>      backgroundColor = 'black',<br/>      fontColor = 'white',<br/>      onPress,<br/>      size = 'medium',<br/>      style,<br/>      text,<br/>    } = this.props;<br/>    const computedStyles = styles(backgroundColor, fontColor, size);</span><span id="d0ae" class="mr kt ik ly b fv mw mt l mu mv">    return (<br/>      &lt;TouchableOpacity onPress={onPress}&gt;<br/>        &lt;View style={[computedStyles.container, style]}&gt;<br/>          &lt;Text style={computedStyles.text}&gt;<br/>            {text.toUpperCase()}<br/>          &lt;/Text&gt;<br/>       &lt;/View&gt;<br/>      &lt;/TouchableOpacity&gt;<br/>    );<br/>  };<br/>}</span><span id="6416" class="mr kt ik ly b fv mw mt l mu mv">const styles = (<br/>  backgroundColor: string,<br/>  fontColor: string,<br/>  size: string,<br/>): StyleSheet.styles =&gt;<br/>  StyleSheet.create({<br/>    container: {<br/>    backgroundColor: backgroundColor,<br/>    borderRadius: 3,<br/>    padding: getButtonPadding(size),<br/>  },<br/>  text: {<br/>    backgroundColor: 'transparent',<br/>    color: fontColor,<br/>    fontFamily: Platform.OS === 'web' ? 'sans-serif' : undefined,<br/>    fontSize: getButtonFontSize(size),<br/>    fontWeight: 'bold',<br/>    textAlign: 'center', <br/>  },<br/>});</span></pre><p id="cf85" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们有了一个按钮组件，让我们添加一个故事，这样我们就可以看到它的呈现。在<code class="eh lv lw lx ly b">button/__stories__/index.js</code>增加以下内容:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="9baf" class="mr kt ik ly b fv ms mt l mu mv">import React from 'react';<br/>import { storiesOf } from '@storybook/react';<br/>import { View, Text, StyleSheet } from 'react-native';</span><span id="ac65" class="mr kt ik ly b fv mw mt l mu mv">import Button from '../';</span><span id="c28e" class="mr kt ik ly b fv mw mt l mu mv">storiesOf('Universal Components', module).add('Button', () =&gt; {<br/>  return (<br/>    &lt;View style={styles.container}&gt;<br/>      &lt;Text style={styles.title}&gt;Button&lt;/Text&gt;<br/>      &lt;View style={styles.example}&gt;<br/>        &lt;Text style={styles.exampleTitle}&gt;Example&lt;/Text&gt;<br/>        &lt;View style={styles.exampleWrapper}&gt;<br/>          &lt;Button<br/>            text="Press Me!"<br/>            onPress={() =&gt; alert('Button Pressed!')}<br/>          /&gt;<br/>        &lt;/View&gt;<br/>      &lt;/View&gt;<br/>    &lt;/View&gt;<br/>  );<br/>});</span><span id="b45c" class="mr kt ik ly b fv mw mt l mu mv">const styles = StyleSheet.create({<br/>  container: {<br/>    padding: 32,<br/>  },<br/>  example: {<br/>    borderColor: '#dddddd',<br/>    borderWidth: 1,<br/>    display: 'inline-flex',<br/>    flex: 0,<br/>    padding: 16,<br/>  },<br/>  exampleTitle: {<br/>    fontFamily: 'sans-serif',<br/>    fontSize: 18,<br/>    fontWeight: 'bold',<br/>    marginBottom: 12,<br/>  },<br/>  exampleWrapper: {<br/>    width: 300,<br/>  },<br/>  title: {<br/>    fontFamily: 'sans-serif',<br/>    fontSize: 24,<br/>    fontWeight: 'bold',<br/>    marginBottom: 24,<br/>  },<br/>});</span></pre><p id="9ef1" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">设置好故事后，我们现在可以运行storybook并查看组件的运行情况。从<code class="eh lv lw lx ly b">universal-components</code>目录运行<code class="eh lv lw lx ly b">yarn storybook</code>。就是这样。您现在已经有了一个启动并运行的开发环境。🐎</p><figure class="kf kg kh ki fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff my"><img src="../Images/91f55c2b0636fd731a94cc0b135e1ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VYGMreAx6SRRPI-1fNEqUA.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Universal Components Storybook</figcaption></figure><h1 id="d242" class="ks kt ik bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">设置测试</h1><p id="08a3" class="pw-post-body-paragraph jh ji ik jj b jk lq jm jn jo lr jq jr js ls ju jv jw lt jy jz ka lu kc kd ke hn dt translated">在Storybook中构建组件无疑减少了出错的机会，但是如果你想以编程的方式测试功能，你将需要设置测试。为了测试通用组件，您可以使用React社区中已经广泛使用的<a class="ae ih" href="https://facebook.github.io/jest/" rel="noopener ugc nofollow" target="_blank"> Jest </a>和<a class="ae ih" href="http://airbnb.io/enzyme/" rel="noopener ugc nofollow" target="_blank"> Enzyme </a>。</p><p id="e58d" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们要做的第一件事是添加我们的测试依赖项:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="6dea" class="mr kt ik ly b fv ms mt l mu mv">// from universal-components directory</span><span id="6ff3" class="mr kt ik ly b fv mw mt l mu mv">yarn add -D enzyme enzyme-to-json jest</span></pre><p id="0785" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们有了测试依赖项，我们需要设置一些测试。在<code class="eh lv lw lx ly b">components</code>的<code class="eh lv lw lx ly b">button</code>目录中添加一个名为<code class="eh lv lw lx ly b">__tests__</code>的新目录，并带有一个<code class="eh lv lw lx ly b">index.js</code>文件。</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="ad31" class="mr kt ik ly b fv ms mt l mu mv">components/<br/>  button/<br/>  __stories__/<br/>    index.js<br/>  __tests__/<br/>    index.js<br/>  index.js</span></pre><p id="c136" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">将以下内容添加到<code class="eh lv lw lx ly b">__tests__/index.js</code>:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="fcce" class="mr kt ik ly b fv ms mt l mu mv">import React from 'react';<br/>import { mount } from 'enzyme';<br/>import { mountToJson } from 'enzyme-to-json';</span><span id="e23d" class="mr kt ik ly b fv mw mt l mu mv">import Button from '../';</span><span id="0758" class="mr kt ik ly b fv mw mt l mu mv">describe('&lt;Button /&gt;', () =&gt; {<br/>  it('&lt;Button text="Test" /&gt;', () =&gt; {<br/>    const wrapper = mount(<br/>      &lt;Button text="Test" onPress={() =&gt; {}} /&gt;<br/>    );<br/>    expect(mountToJson(wrapper)).toMatchSnapshot();<br/>  });<br/>  <br/>  it('onPress()', () =&gt; {<br/>    const spy = jest.fn();<br/>    const wrapper = mount(&lt;Button text="Test" onPress={spy} /&gt;);</span><span id="a9e5" class="mr kt ik ly b fv mw mt l mu mv">    wrapper<br/>      .find('TouchableOpacity')<br/>      .first()<br/>      .props()<br/>      .onPress();<br/>    <br/>    expect(spy).toBeCalled();<br/>  });<br/>});</span></pre><p id="bb65" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们需要在<code class="eh lv lw lx ly b">package.json</code>中添加一个<code class="eh lv lw lx ly b">script</code>条目，这样我们就可以轻松地运行我们的测试。</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="cd9e" class="mr kt ik ly b fv ms mt l mu mv">// in universal-components/package.json</span><span id="508f" class="mr kt ik ly b fv mw mt l mu mv">"scripts": {<br/>  "test": "jest",<br/>  ...<br/>},</span></pre><p id="5f56" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">随着一些测试的进行和我们的<code class="eh lv lw lx ly b">package.json</code>的更新，我们现在可以运行<code class="eh lv lw lx ly b">yarn test</code>来确保一切正常。</p><figure class="kf kg kh ki fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mz"><img src="../Images/974e26be39127aa6bc12891d7d7edde5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8i8S22m7b7GJEC5L9ecdCQ.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Jest Tests</figcaption></figure><h1 id="e72f" class="ks kt ik bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">部署</h1><p id="1314" class="pw-post-body-paragraph jh ji ik jj b jk lq jm jn jo lr jq jr js ls ju jv jw lt jy jz ka lu kc kd ke hn dt translated">最后一步是部署故事书和我们的通用组件库。让我们从故事书开始。</p><p id="0605" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们已经添加了一个<code class="eh lv lw lx ly b">script</code>来为生产(<code class="eh lv lw lx ly b">"build": "build-storybook"</code>)构建故事书，但是我们仍然需要一种方法来部署我们的故事书，以便我们的通用组件库的用户知道他们可以使用什么。为此，我们将使用<code class="eh lv lw lx ly b"><a class="ae ih" href="http://surge.sh/" rel="noopener ugc nofollow" target="_blank">surge.sh</a></code>。</p><p id="29f6" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先我们需要添加<code class="eh lv lw lx ly b">surge</code>作为新的<code class="eh lv lw lx ly b">devDependency</code>:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="0cc5" class="mr kt ik ly b fv ms mt l mu mv">// from universal-components directory</span><span id="a7c3" class="mr kt ik ly b fv mw mt l mu mv">yarn add -D surge</span></pre><p id="2bb9" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来我们需要添加一个<code class="eh lv lw lx ly b">script</code>:</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="4263" class="mr kt ik ly b fv ms mt l mu mv">"scripts": {<br/>  "deploy": "yarn build &amp;&amp; surge ./storybook-static",<br/>  ...<br/>}</span></pre><blockquote class="kl km kn"><p id="375f" class="jh ji ko jj b jk jl jm jn jo jp jq jr kp jt ju jv kq jx jy jz kr kb kc kd ke hn dt translated">别忘了给你的<code class="eh lv lw lx ly b">.gitignore</code>加上<code class="eh lv lw lx ly b">packages/universal-components/storybook-static</code>！</p></blockquote><p id="09cd" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最后但同样重要的是，我们需要发布我们的通用组件包。然而，在此之前，我们应该在我们的<code class="eh lv lw lx ly b">universal-components</code>包中配置一个<code class="eh lv lw lx ly b">.npmignore</code>，这样我们就不会部署任何不必要的文件。</p><pre class="kf kg kh ki fq mn ly mo mp aw mq dt"><span id="c97b" class="mr kt ik ly b fv ms mt l mu mv">node_modules<br/>.storybook<br/>.babelrc</span></pre><p id="88ef" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">前面我提到过，我们正在使用Lerna来简化软件包的发布。要发布包的新版本，从项目的根目录运行<code class="eh lv lw lx ly b">lerna publish</code>(不是<code class="eh lv lw lx ly b">universal-components</code>目录)。</p><p id="b144" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">就是这样！现在，您已经有了一个完整的通用组件工作流，并且正在运行！给自己一个鼓励，或者一个虚拟的击掌！✋</p><p id="235c" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你对这个通用组件的实现有任何问题，欢迎在下面评论或者在<a class="ae ih" href="https://twitter.com/kurtiskemple" rel="noopener ugc nofollow" target="_blank">推特</a>上联系我，我的DMs永远是开放的！</p></div></div>    
</body>
</html>