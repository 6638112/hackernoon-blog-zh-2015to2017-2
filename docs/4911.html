<html>
<head>
<title>Flutter, native APIs and plugins (3/3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter、原生API和插件(3/3)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/flutter-native-apis-and-plugins-3-3-b84776fc8a7e?source=collection_archive---------8-----------------------#2017-06-29">https://medium.com/hackernoon/flutter-native-apis-and-plugins-3-3-b84776fc8a7e?source=collection_archive---------8-----------------------#2017-06-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="a421" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">(译自法语:<a class="ae jp" href="https://rxlabz.github.io/dart/flutter/2017/06/15/sytody-flutter-natif-plugins3.html" rel="noopener ugc nofollow" target="_blank"> Flutter，API natives et plugins (3/3) </a>)</p><p id="6294" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">也是在5月份左右，<strong class="it hv"> Flutter插件系统</strong>出现了，这是一个很好的机制，可以很容易地使用Flutter/Dart的本地特性。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/40312c5cc689066e1ef78036fbaa2f4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/0*OT2eY4sfJgNZh9LB.gif"/></div></figure><ol class=""><li id="95f6" class="jy jz hu it b iu iv iy iz jc ka jg kb jk kc jo kd ke kf kg dt translated">在<a class="ae jp" rel="noopener" href="/@rxlabz/flutter-native-apis-and-plugins-1-3-3db651d79a7c">第一部分</a>中，我们已经看到了 <code class="eh kh ki kj kk b"><strong class="it hv">MethodChannels</strong></code>的<strong class="it hv">基础知识</strong></li><li id="330a" class="jy jz hu it b iu kl iy km jc kn jg ko jk kp jo kd ke kf kg dt translated">在<a class="ae jp" rel="noopener" href="/@rxlabz/flutter-api-natives-et-plugins-2-3-27cbe7bb36ee">第二部分</a>中，我们看到了如何<strong class="it hv">创建语音识别专用通道</strong></li></ol><p id="6b93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们现在来看看如何通过<strong class="it hv">为iOS和Android </strong>构建一个专用的Flutter插件来模块化这些代码。</p><h1 id="063a" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">颤振插件系统😍</h1><p id="5403" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">Flutter插件通过Dart包管理器作为简单的包(依赖项)来管理。</p><p id="ae6e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">只需1)声明依赖关系，2)运行<code class="eh kh ki kj kk b">pub packages get</code>，Flutter就会更新XCode和Android项目。它是如此的有效和透明，以至于目前我甚至不需要理解Graddle是什么，也不需要知道podfile是如何工作的。一切都由Flutter管理😎🍹！</p><p id="7d35" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尽管<a class="ae jp" href="https://pub.dartlang.org/flutter/plugins/" rel="noopener ugc nofollow" target="_blank"> Flutter插件目录</a>还有点雏形，但它已经提供了一些有用的<a class="ae jp" href="https://hackernoon.com/tagged/tools" rel="noopener ugc nofollow" target="_blank">工具</a>。</p><h1 id="514c" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">使用插件</h1><p id="8429" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">要使用插件:</p><ol class=""><li id="cd41" class="jy jz hu it b iu iv iy iz jc ka jg kb jk kc jo kd ke kf kg dt translated">在项目<br/> <code class="eh kh ki kj kk b">dependencies:<br/> speech_recognition: "^0.2.0+1"</code>的pubspec.yaml中声明依赖关系</li><li id="366f" class="jy jz hu it b iu kl iy km jc kn jg ko jk kp jo kd ke kf kg dt translated">拿到包，建app <br/> <code class="eh kh ki kj kk b">flutter packages get<br/>flutter build ios<br/>flutter build apk</code></li><li id="e0d2" class="jy jz hu it b iu kl iy km jc kn jg ko jk kp jo kd ke kf kg dt translated">在您的代码<br/>中导入包<code class="eh kh ki kj kk b">import 'package:speech_recognition/speech_recognition.dart';</code></li><li id="d91b" class="jy jz hu it b iu kl iy km jc kn jg ko jk kp jo kd ke kf kg dt translated">就这样</li></ol><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="fe ff lt"><img src="../Images/7458ac0724d4fa6a9c8129ad8d5ca2a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/1*AI4JQCOOxnQOrCoIOMAaww.gif"/></div></div></figure><p id="0cc0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">…除非插件确实需要特殊权限，在这种情况下，有必要编辑iOS的<code class="eh kh ki kj kk b">.plist</code>文件和Android的<code class="eh kh ki kj kk b">manifest.xml</code>文件。</p><p id="0c17" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，当应用程序被构建时，根据操作系统，Flutter将安装和管理iOS / Android依赖项，以便本地代码正确可用。</p><p id="a605" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该团队已经建立了一个自我记录插件系统，效果非常好，在大多数情况下，你甚至可以不碰iOS或Android文件。🍾🥂</p><h1 id="97b1" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">构建一个插件</h1><p id="f998" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">但是<a class="ae jp" href="https://hackernoon.com/tagged/magnificence" rel="noopener ugc nofollow" target="_blank">的辉煌</a>更进一步，用工具创建插件！我发现它非常有效，我已经发布了4个插件，但至少我可以说，我根本不是跨平台插件专家:)。</p><p id="6a5b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Flutter CLI提供了一个插件框架生成命令，包含所有必需的文件，甚至是一个使用创建的插件预先配置的示例项目:</p><pre class="jr js jt ju fq ly kk lz ma aw mb dt"><span id="9606" class="mc kr hu kk b fv md me l mf mg">flutter create -i swift --org bz.rxla --plugin my_plugin</span></pre><ul class=""><li id="5a95" class="jy jz hu it b iu iv iy iz jc ka jg kb jk kc jo mh ke kf kg dt translated"><code class="eh kh ki kj kk b">-i swift</code>:我们希望将Swift用于iOS代码，而不是默认定义的ObjC</li><li id="db15" class="jy jz hu it b iu kl iy km jc kn jg ko jk kp jo mh ke kf kg dt translated"><code class="eh kh ki kj kk b">-a kotlin</code>:如果我们要用Kotlin代替Java默认的Android端</li><li id="6b41" class="jy jz hu it b iu kl iy km jc kn jg ko jk kp jo mh ke kf kg dt translated"><code class="eh kh ki kj kk b">--org my.domain</code>:插件名称空间</li><li id="dfcb" class="jy jz hu it b iu kl iy km jc kn jg ko jk kp jo mh ke kf kg dt translated"><code class="eh kh ki kj kk b">--plugin my_plugin</code>:插件的名称</li></ul><p id="cff7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Dart端，生成的代码非常简单，它主要包含一个“专用”通道的创建。这个系统最有趣的地方是在iOS和Android上的插件的自我检测/安装。</p><h2 id="6c23" class="mc kr hu bd ks mi mj mk kw ml mm mn la jc mo mp le jg mq mr li jk ms mt lm mu dt translated">颤动/飞镖</h2><p id="0671" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">下面是为插件的Dart部分生成的代码:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="mv mw l"/></div></figure><h2 id="095f" class="mc kr hu bd ks mi mj mk kw ml mm mn la jc mo mp le jg mq mr li jk ms mt lm mu dt translated">iOS / Swift</h2><p id="1cb0" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated"><code class="eh kh ki kj kk b">SwiftPluginDemoPlugin.swift</code>文件包含允许应用程序自动检测插件的机制。这是一个静态的<code class="eh kh ki kj kk b">register</code>方法，应用程序在启动时调用它来传输一个<code class="eh kh ki kj kk b">FlutterPluginRegistrar</code>。注册者的角色是将插件创建的通道添加到<code class="eh kh ki kj kk b">MethodChannel</code>调用的“接收者”列表中，使其能够通过其<code class="eh kh ki kj kk b">handle</code>方法接收调用。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="mv mw l"/></div></figure><p id="6644" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Swift的使用增加了一个小层，生成了ObjC <code class="eh kh ki kj kk b">PluginDemoPlugin.h</code>和<em class="mx">。m </em>文件，以及一个<strong class="it hv"><em class="mx">swiftplugindemoplugin . swift</em></strong>。</p><h2 id="5660" class="mc kr hu bd ks mi mj mk kw ml mm mn la jc mo mp le jg mq mr li jk ms mt lm mu dt translated">安卓/ Java</h2><p id="40a4" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">我们在Java中为Android找到了同样的<code class="eh kh ki kj kk b">registrar</code>原理。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="mv mw l"/></div></figure><h1 id="bde7" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated"><strong class="ak">实施</strong></h1><p id="9bd4" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">接下来，剩下的就是将实现从<a class="ae jp" rel="noopener" href="/@rxlabz/flutter-api-natives-et-plugins-2-3-27cbe7bb36ee">的第二部分</a>转移到插件项目，以及相关的Swift和Java代码。参见<a class="ae jp" href="http://github.com/rxlabz/speech_recognition" rel="noopener ugc nofollow" target="_blank">语音识别插件</a></p><h1 id="d68f" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">出版</h1><p id="25c6" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">要在pub.dartlang.com上发布插件:</p><pre class="jr js jt ju fq ly kk lz ma aw mb dt"><span id="f9a2" class="mc kr hu kk b fv md me l mf mg"><em class="mx">/FLUTTER_PATH/bin/cache/dart-sdk/bin/pub publish</em></span></pre><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff my"><img src="../Images/4eb570502c55550c8674e1fb8f8fdde5.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/0*jgiVO0lwbe3P7WVY.gif"/></div></figure><h1 id="3750" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">资源</h1><ul class=""><li id="b948" class="jy jz hu it b iu lo iy lp jc mz jg na jk nb jo mh ke kf kg dt translated"><a class="ae jp" href="https://flutter.io/platform-plugins/" rel="noopener ugc nofollow" target="_blank">文档</a></li><li id="8cc3" class="jy jz hu it b iu kl iy km jc kn jg ko jk kp jo mh ke kf kg dt translated"><a class="ae jp" href="http://github.com/rxlabz/sytody" rel="noopener ugc nofollow" target="_blank">系统应用</a></li><li id="4a3a" class="jy jz hu it b iu kl iy km jc kn jg ko jk kp jo mh ke kf kg dt translated"><a class="ae jp" href="http://github.com/rxlabz/speech_recognition" rel="noopener ugc nofollow" target="_blank">语音_识别插件</a></li><li id="f1f8" class="jy jz hu it b iu kl iy km jc kn jg ko jk kp jo mh ke kf kg dt translated"><a class="ae jp" href="https://pub.dartlang.org/flutter/packages/" rel="noopener ugc nofollow" target="_blank">颤振插件和包</a></li></ul><div class="jr js jt ju fq ab cb"><figure class="nc jv nd ne nf ng nh paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nc jv nd ne nf ng nh paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nc jv nd ne nf ng nh paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ni nj nk"><p id="f922" class="ir is mx it b iu iv iw ix iy iz ja jb nl jd je jf nm jh ji jj nn jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is mx it b iu iv iw ix iy iz ja jb nl jd je jf nm jh ji jj nn jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="fe ff no"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="np mw l"/></div></figure></div></div>    
</body>
</html>