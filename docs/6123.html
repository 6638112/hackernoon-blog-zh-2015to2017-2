<html>
<head>
<title>Performance Tuning Alexa Skills using AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda调整Alexa性能的技巧</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/performance-tuning-alexa-skills-using-aws-lambda-24ccacb7199b?source=collection_archive---------15-----------------------#2017-09-04">https://medium.com/hackernoon/performance-tuning-alexa-skills-using-aws-lambda-24ccacb7199b?source=collection_archive---------15-----------------------#2017-09-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/7af229ede056b70437d85ec7429be022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-hLTB9MHMYidlqPQAMOoA.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo courtesy of <a class="ae jg" href="https://pixabay.com/en/users/sandid-356019/" rel="noopener ugc nofollow" target="_blank">sandid</a> via CC2.0 on <a class="ae jg" href="https://pixabay.com" rel="noopener ugc nofollow" target="_blank">Pixabay</a></figcaption></figure><p id="688e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我是<a class="ae jg" href="https://developer.amazon.com/alexa/champions/terren-peterson" rel="noopener ugc nofollow" target="_blank"> Alexa开发冠军</a>和<a class="ae jg" href="https://hackernoon.com/alexa" rel="noopener ugc nofollow" target="_blank"> Alexa </a>上的<a class="ae jg" href="https://www.oreilly.com/people/terren-peterson" rel="noopener ugc nofollow" target="_blank">奥莱利作者</a>。我每个月都创造新的Alexa技能，并监控那些已经运行的技能的使用情况，并根据需要进行更新。</p><p id="0029" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">AWS  Lambda是一个很棒的服务，默认情况下，它是流行的亚马逊Alexa平台背后的编码逻辑。我的Alexa技能之一是在每年的这个时候使用它，特别是从八月到十月。它叫做<a class="ae jg" href="https://www.amazon.com/Drawrz-com-Hurricane-Center/dp/B01EFCJ0OU" rel="noopener ugc nofollow" target="_blank">飓风中心</a>，在你的亚马逊Alexa设备上提供来自国家飓风中心的数据。</p><p id="1cbb" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最近，随着飓风哈维和伊尔玛的到来，它的流量达到了峰值，创下了历史新高。鉴于它使用的是无服务器模式，它会随着负载自动扩展，所以我不需要做任何事情来支持峰值。这确实让我看了看我的每月AWS发票，只是为了确保我保持在相关成本的顶部。这是我对飓风中心技能的性能调整和成本影响的分析。</p><h1 id="1261" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">性能调整AWS Lambda</h1><p id="0bd7" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">提供Lambda函数时的一个默认变量是内存分配。它由控制台“高级设置”选项卡上的滑块(见下文)控制，默认情况下，启动时为128MB。此设置可以在不对Lambda函数进行任何编码更改的情况下进行调整。只需保存，平台将使用新容量重新部署该功能。</p><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff li"><img src="../Images/3eb3e965c289d47d48924aaa3f9c74cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g0BM2A_DMa94Wq0RqNEPUA.png"/></div></div></figure><p id="43c3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">通过将内存分配从默认的128MB更改为512MB(相对应的vCPU更改为4倍)，性能显著提高。下面是CloudWatch中的响应时间图，显示了对该函数的调用的每日平均性能。8月14日进行了更改。以前，性能在300毫秒范围内，现在平均在100毫秒范围内，提高了3倍！我在过去两周收到的流量峰值也没有对这一点产生影响，因为性能保持很快——100毫秒。</p><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff li"><img src="../Images/f3d4f7cfa3004840ef11ca7d89f07a58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0qDcNA0rDzeN2VLqdHq4ig.png"/></div></div></figure><h1 id="c8b5" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">对成本有什么影响？</h1><p id="4853" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">每当我们向应用程序投入额外资源时，一个很好的问题是成本影响是什么。相对而言似乎不贵的东西可以很快增值。</p><p id="dd8b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">AWS在Lambda上的价格结构相当慷慨。考虑到Alexa技能的相对使用，这一点尤其正确。帐户上存在一个免费层，限制在100万个请求之下，以及一个月40万GB秒的CPU使用量。这是我们通过增加内存分配而影响的第二个指标，因为事务量保持不变。</p><h1 id="d397" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">让我们计算一下这个变化</h1><p id="551b" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">从128MB升级到512MB的影响并不意味着成本会增加4倍。度量单位是分配的内存乘以以100毫秒为增量的事务时间的组合。鉴于我们看到响应时间减少了3倍，它们几乎抵消了。</p><blockquote class="ln"><p id="92ef" class="lo lp hu bd lq lr ls lt lu lv lw ke ek translated">场景#1 —小型(128MB)版本</p><p id="6590" class="lo lp hu bd lq lr ls lt lu lv lw ke ek translated">10k执行x 300ms毫秒x 128 MB = 384 GB-秒。</p><p id="1e6d" class="lo lp hu bd lq lr ls lt lu lv lw ke ek translated">场景#2 —更大(512MB)的版本</p><p id="ba87" class="lo lp hu bd lq lr ls lt lu lv lw ke ek translated">10k执行x 100ms x 512 MB = 512 GB-秒。</p></blockquote><p id="4039" class="pw-post-body-paragraph jh ji hu jj b jk lx jm jn jo ly jq jr js lz ju jv jw ma jy jz ka mb kc kd ke hn dt translated">因此，内存翻两番的最终结果是消耗增加了34%——我的技能获得了3倍的性能提升。嘣！</p><h1 id="aa89" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">不要调谐超过100毫秒</h1><p id="5276" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">超过512MB是可能的，因为该服务支持高达1.5GB的大小。Lambda的定价模型中有“细则”，强调每笔交易的成本四舍五入到最接近的100毫秒。这意味着，一旦性能低于100毫秒，堆的任何增加都会增加整体使用量。这是与上面的例子相匹配的场景。</p><blockquote class="ln"><p id="aa69" class="lo lp hu bd lq lr ls lt lu lv lw ke ek translated">场景#3 —最大(1.5GB)版本</p><p id="324c" class="lo lp hu bd lq lr ls lt lu lv lw ke ek translated">10k执行x 65ms毫秒(四舍五入到100毫秒)x 1.5 gmb = 1500 GB-秒。</p></blockquote><p id="22a7" class="pw-post-body-paragraph jh ji hu jj b jk lx jm jn jo ly jq jr js lz ju jv jw ma jy jz ka mb kc kd ke hn dt translated">最终结果是，三倍的内存可能会提高性能，但使用成本也会增加3倍。</p><h1 id="eaa6" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">我的账单增加了多少？</h1><p id="2de4" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">现在荒谬的部分来了。每月前40万千兆秒是免费的，所以除非使用这个Lambda函数的技能变得非常流行，否则它将保持在免费层之下。让我们计算一下Alexa技能达到这个水平会有多受欢迎。<em class="mc">(示例假设上述场景# 2)</em></p><p id="7b1d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">33k执行/天x 30天/月= 100万执行/月。</p><p id="7dce" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">33k执行/天x 30天/月，512MB = 50k GB秒。</p><p id="b8b7" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">因此，使用这种技巧要注意的不是内存，而是事务量。如果你不熟悉Alexa技能的使用，33k执行/天是非常高的，只有平台上最顶尖的1%的技能可以看到这种流量。当开发Alexa技能时，不要犹豫增加内存，因为它可以提高性能，而且是免费的！</p><figure class="lj lk ll lm fq iv"><div class="bz el l di"><div class="md me l"/></div></figure></div></div>    
</body>
</html>