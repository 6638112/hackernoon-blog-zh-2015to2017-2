<html>
<head>
<title>A Guide to creating Web Applications with React and Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React和Redux创建Web应用程序的指南</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-guide-to-creating-web-applications-with-react-and-redux-2f6bc0775951?source=collection_archive---------4-----------------------#2017-10-31">https://medium.com/hackernoon/a-guide-to-creating-web-applications-with-react-and-redux-2f6bc0775951?source=collection_archive---------4-----------------------#2017-10-31</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/f6a8d2e5a6b34f71c0b9a8bacc942d95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NpiMGCSHzTL9XZlhsxwHrg.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/eBRTYyjwpRY" rel="noopener ugc nofollow" target="_blank">Radek Grzybowski</a> on <a class="ae jg" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2488" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在<a class="ae jg" href="https://hackernoon.com/a-beginners-guide-to-progressive-web-apps-the-frontend-web-424b6d697e35" rel="noopener ugc nofollow" target="_blank">之前的一篇文章</a>中，我试图写一篇深入的指南来开始使用<strong class="jj hv">渐进式网络应用</strong>。从那以后，我学到了很多，同时也注意到了我所使用的工具的一些变化，我决定写一些后续的和重写的指南。就像上次一样，我将添加一个<strong class="jj hv">TL；博士在每一部分帮助你找出你想读文章的哪一部分。</strong></p><div class="kf kg fm fo kh ki"><a href="https://hackernoon.com/a-beginners-guide-to-progressive-web-apps-the-frontend-web-424b6d697e35" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">渐进式网络应用入门指南&amp;前端网络</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">为前端web开发，跟上Javascript生态系统以及所有新术语和华而不实的…</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">hackernoon.com</p></div></div><div class="kr l"><div class="ks l kt ku kv kr kw ja ki"/></div></div></a></div><p id="2c1c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你还没有读过我之前关于PWAs的文章，我强烈建议你在继续之前先读一读。</p></div><div class="ab cl ky kz hc la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hn ho hp hq hr"><h2 id="63ac" class="lf lg hu bd lh li lj lk ll lm ln lo lp js lq lr ls jw lt lu lv ka lw lx ly lz dt translated">React、CSS框架和JSON文件</h2><p id="3b70" class="pw-post-body-paragraph jh ji hu jj b jk ma jm jn jo mb jq jr js mc ju jv jw md jy jz ka me kc kd ke hn dt translated">上一次，我从零开始，解释了从哪里获得样本数据，以及为什么像React和CSS框架这样的工具对于这样的项目是有用的。我们仍将使用我的宠物项目<a class="ae jg" href="http://minicss.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jj hv"> mini.css </strong> </a>进行造型，以及<a class="ae jg" href="https://reactjs.org/docs/installation.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jj hv"> React </strong> </a>，但我们也将添加<a class="ae jg" href="http://redux.js.org/#installation" rel="noopener ugc nofollow" target="_blank"> <strong class="jj hv"> Redux </strong> </a>到组合中。除此之外，我们还将使用<a class="ae jg" href="https://jsonbin.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jj hv"> JSONbin.io </strong> </a>为我们的PWA创建我们自己的JSON文件，而不是从一些API获取数据。这样，我们将能够创建一个定制的数据结构来满足我们的需求，并模拟设计API端点的过程。</p><div class="kf kg fm fo kh ki"><a href="https://hackernoon.com/5-reasons-to-try-out-mini-css-62ddb47b9370" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">试用mini.css的5个理由</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">在这篇文章中，我将解释为什么mini.css是css框架生态系统的一个有价值的补充，以及…</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">hackernoon.com</p></div></div><div class="kr l"><div class="mf l kt ku kv kr kw ja ki"/></div></div></a></div><p id="5ab0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">本文中React的一个关键点是，我们不需要像以前那样编写自己的<strong class="jj hv">服务工作者</strong>。如今，<code class="eh mg mh mi mj b">create-react-app</code>为我们提供了一个预构建的服务工作者实现，它可以在发生任何变化时自动更新，使我们能够更快、更轻松地创建pwa。</p><p id="51be" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">除此之外，我将向您介绍Redux，它非常热门有很多原因，主要是因为它允许您<strong class="jj hv">全局管理状态</strong>，并且它被认为是扩展您的应用程序的完美选择。对于这个特定的项目，这可能有点大材小用，但是尝试新工具总是好的。</p><blockquote class="mk ml mm"><p id="f176" class="jh ji kx jj b jk jl jm jn jo jp jq jr mn jt ju jv mo jx jy jz mp kb kc kd ke hn dt translated"><strong class="jj hv">TL；DR: </strong> React现在支持服务人员开箱即用，允许更轻松地创建PWA。Redux对于管理全局状态以及扩展我们的应用程序来说是无价的。</p></blockquote><h2 id="a488" class="lf lg hu bd lh li lj lk ll lm ln lo lp js lq lr ls jw lt lu lv ka lw lx ly lz dt translated">定义数据结构</h2><p id="dc10" class="pw-post-body-paragraph jh ji hu jj b jk ma jm jn jo mb jq jr js mc ju jv jw md jy jz ka me kc kd ke hn dt translated">上一次，我们使用了几个RESTful JSON APIs来获取数据并提供给用户。这一次，我们将做一些稍微不同的事情，定义我们自己的<strong class="jj hv">数据结构</strong>，并在线存储它，以便我们的PWA可以访问它。我们想要创建一个简单的应用程序，在结构上类似于博客，所以我们想要定义一个类似于<strong class="jj hv">博客文章</strong>的数据结构。下面是一篇文章的JSON对象应该包含的内容:</p><ul class=""><li id="1213" class="mq mr hu jj b jk jl jo jp js ms jw mt ka mu ke mv mw mx my dt translated"><strong class="jj hv"> ID: </strong>可以唯一标识帖子的值</li><li id="2fd8" class="mq mr hu jj b jk mz jo na js nb jw nc ka nd ke mv mw mx my dt translated"><strong class="jj hv">标题:</strong>文章标题的字符串表示</li><li id="d04f" class="mq mr hu jj b jk mz jo na js nb jw nc ka nd ke mv mw mx my dt translated"><strong class="jj hv">图片:</strong>文章特色图片的链接</li><li id="d900" class="mq mr hu jj b jk mz jo na js nb jw nc ka nd ke mv mw mx my dt translated"><strong class="jj hv">作者:</strong>带有文章作者姓名的字符串</li><li id="efe3" class="mq mr hu jj b jk mz jo na js nb jw nc ka nd ke mv mw mx my dt translated"><strong class="jj hv">标签:</strong>包含文章关键词的字符串列表</li><li id="7b78" class="mq mr hu jj b jk mz jo na js nb jw nc ka nd ke mv mw mx my dt translated"><strong class="jj hv">内容:</strong>文章实际内容的字符串表示</li><li id="c763" class="mq mr hu jj b jk mz jo na js nb jw nc ka nd ke mv mw mx my dt translated"><strong class="jj hv">添加日期:</strong>表示添加文章的日期</li></ul><p id="24e7" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">基于上面的结构，我使用了一个<a class="ae jg" href="https://www.lipsum.com/" rel="noopener ugc nofollow" target="_blank"> Lorem Ipsum生成器</a>和一些来自<a class="ae jg" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>的精彩图片来创建一个包含25个帖子的样本JSON文件。你可以在这里看一下<a class="ae jg" href="https://jsonbin.io/b/59f721644ef213575c9f6531" rel="noopener ugc nofollow" target="_blank"/>—记住JSON对象的定义非常重要，因为它将在某种程度上决定我们页面的结构。</p><blockquote class="mk ml mm"><p id="3b97" class="jh ji kx jj b jk jl jm jn jo jp jq jr mn jt ju jv mo jx jy jz mp kb kc kd ke hn dt translated"><strong class="jj hv">TL；DR: </strong>数据结构的定义是确定应用程序内容并开始构建它的良好开端。JSON是模拟API响应的理想格式。</p></blockquote><h2 id="f038" class="lf lg hu bd lh li lj lk ll lm ln lo lp js lq lr ls jw lt lu lv ka lw lx ly lz dt translated">创建应用程序外壳</h2><figure class="nf ng nh ni fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ne"><img src="../Images/129933069dea07d7112cf3b3877b964d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ogce8TmBaLRc_RbknZpX7w.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">What our finished application will look like</figcaption></figure><p id="1f41" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">构建PWA的第一步是创建一个<strong class="jj hv">应用程序外壳</strong>。为了做到这一点，我将使用<strong class="jj hv"> mini.css </strong>，以及一些定制的css来使它看起来更加完美。因为这是一个简单的博客应用程序，所以我将使用一个<code class="eh mg mh mi mj b">&lt;header&gt;</code>元素来添加一个漂亮的顶栏，带有一个图标和一个抽屉按钮，以及一个搜索字段(稍后会详细介绍)。除此之外，我想在<code class="eh mg mh mi mj b">.drawer</code>中添加一个帖子列表。这个列表将是一个响应菜单，默认情况下在手机上是隐藏的。</p><pre class="nf ng nh ni fq nj mj nk nl aw nm dt"><span id="4e92" class="lf lg hu mj b fv nn no l np nq">create-react-app autumn-pwa<br/>cd autumn-pwa<br/>npm install --save redux react-redux<br/>npm start</span></pre><p id="a604" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在我们开始设计应用程序外壳之前，我们需要<strong class="jj hv">创建一个项目</strong>。如果你已经在全球范围内安装了<code class="eh mg mh mi mj b">create-react-app</code>，你应该通过运行上面的指令来启动并运行你的项目。当项目文件夹被创建时，前往<a class="ae jg" href="https://github.com/Chalarangelo/mini.css" rel="noopener ugc nofollow" target="_blank"> mini.css的仓库</a>并获取你所选择的最新版本。</p><div class="kf kg fm fo kh ki"><a href="https://hackernoon.com/creating-a-mobile-friendly-navigation-using-mini-css-8cea580c51ed" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">使用mini.css创建移动友好导航</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">在这个系列中，我们将介绍一些基本的概念和技术，帮助你开始使用mini.css…</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">hackernoon.com</p></div></div><div class="kr l"><div class="mf l kt ku kv kr kw ja ki"/></div></div></a></div><p id="1128" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我不打算深入讨论定制CSS，因为这超出了本文的范围，并且在框架的网站上也有很好的记录，但是您可以使用它来创建您喜欢的应用程序外壳。在完成所有设置并运行之后，我的<code class="eh mg mh mi mj b">App</code>组件看起来像这样:</p><figure class="nf ng nh ni fq iv"><div class="bz el l di"><div class="nr ns l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">The application shell for our PWA</figcaption></figure><p id="ee5e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可能已经注意到，我们的应用程序shell缺少链接列表和帖子。在接下来的几个步骤中，我们将从JSON文件中获取数据，并根据这些数据动态创建这两个文件。</p><blockquote class="mk ml mm"><p id="b38f" class="jh ji kx jj b jk jl jm jn jo jp jq jr mn jt ju jv mo jx jy jz mp kb kc kd ke hn dt translated"><strong class="jj hv">TL；DR: </strong>每个应用都需要一个应用外壳，里面包含了基本的UI。应用程序外壳可以是几个空容器，稍后将动态填充数据。</p></blockquote></div><div class="ab cl ky kz hc la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hn ho hp hq hr"><h2 id="8ba5" class="lf lg hu bd lh li lj lk ll lm ln lo lp js lq lr ls jw lt lu lv ka lw lx ly lz dt translated">连接冗余</h2><p id="77b2" class="pw-post-body-paragraph jh ji hu jj b jk ma jm jn jo mb jq jr js mc ju jv jw md jy jz ka me kc kd ke hn dt translated">自上次以来，到目前为止，我们还没有做任何非常不同的事情，但现在是时候开始一些新的东西了，即<strong class="jj hv"> Redux </strong>。Redux允许我们全局地管理我们的应用程序的状态，使得随意伸缩和改变它变得非常容易。这个特定的应用程序可能不会给你一个令人信服的理由来使用它，但它是一个很酷的工具，你很可能会需要它。最坏的情况是，你将知道如何使用另一个你可能很快就需要的工具。</p><div class="kf kg fm fo kh ki"><a href="http://redux.js.org/" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">给我读Redux</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">如果你来自Flux，你需要理解一个重要的区别。Redux没有一个…</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">redux.js.org</p></div></div><div class="kr l"><div class="nt l kt ku kv kr kw ja ki"/></div></div></a></div><p id="473d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">那么，Redux如何与React结合使用呢？这真的相当简单，但是幕后发生的事情一开始会让你迷惑。Redux为应用程序的状态使用一个<strong class="jj hv">全局存储</strong>，您可以通过发送<strong class="jj hv">动作</strong>与之交互。行动是与商店互动的唯一方式，您可以使用<strong class="jj hv">行动创建者</strong>来创建行动。这听起来可能很复杂，所以让我给你看一个例子:</p><figure class="nf ng nh ni fq iv"><div class="bz el l di"><div class="nr ns l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">An example of an action and an action creator</figcaption></figure><p id="9a08" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">阅读上面代码中的注释应该有助于您理解什么是动作，什么是动作创建者。说到这里，我们需要谈谈Redux的最后一个非常重要的部分Redux。简单地说，<strong class="jj hv"> reducer </strong>是一个被告知正在执行什么类型的动作(以及动作有效载荷中的任何参数)的函数，它的工作是相应地改变应用程序的状态。reducer是一个纯粹的函数，它接受上一个状态和一个动作，然后返回下一个状态。大多数时候，你会看到一个reducer有一个<code class="eh mg mh mi mj b">switch</code>语句，每个动作对应一个<code class="eh mg mh mi mj b">case</code>。</p><p id="e675" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">好了，现在我们知道了Redux是如何工作的，让我们来写一些代码。我们希望我们的应用程序有两个动作，一个是让<strong class="jj hv">查看博客中的所有帖子</strong>，另一个是根据特定的查询搜索帖子。我上面给出的代码是搜索功能的动作创建器，所以如何创建一个动作创建器来查看所有的帖子应该是非常明显的(<strong class="jj hv">提示:</strong> <em class="kx">除了动作</em>的 <code class="eh mg mh mi mj b">type</code> <em class="kx">之外，没有任何有效负载)。</em></p><p id="f0c8" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，我们应该创建我们的reducer，它目前是一个几乎为空的<code class="eh mg mh mi mj b">switch</code>语句，看起来应该像这样:</p><figure class="nf ng nh ni fq iv"><div class="bz el l di"><div class="nr ns l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Our reducer without any functionality implemented</figcaption></figure><p id="4d13" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最后，我们必须将我们的<code class="eh mg mh mi mj b">App</code>组件<code class="eh mg mh mi mj b">connect()</code>到Redux存储器和<code class="eh mg mh mi mj b">mapStateToProps()</code>中，以便组件被传递给正确的<code class="eh mg mh mi mj b">props</code>。然后，我们将把我们的<code class="eh mg mh mi mj b">&lt;App /&gt;</code>组件包装在一个<code class="eh mg mh mi mj b">&lt;Provider&gt;</code>中，并将提供者的存储设置为<code class="eh mg mh mi mj b">createStore(reducer)</code>，其中<code class="eh mg mh mi mj b">reducer</code>是指我们刚刚创建的缩减器。</p><figure class="nf ng nh ni fq iv"><div class="bz el l di"><div class="nr ns l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Connecting Redux to our application</figcaption></figure><blockquote class="mk ml mm"><p id="28df" class="jh ji kx jj b jk jl jm jn jo jp jq jr mn jt ju jv mo jx jy jz mp kb kc kd ke hn dt translated"><strong class="jj hv">TL；DR: </strong> Redux帮助我们管理应用程序的状态。它使用动作和动作创建者与商店进行交互。归约器是纯函数，它们被给定前一个状态和一个动作，然后返回下一个状态。为了利用Redux，我们需要将我们的应用程序连接到它的商店，并将我们的应用程序组件包装在一个提供者中。</p></blockquote><h2 id="4f11" class="lf lg hu bd lh li lj lk ll lm ln lo lp js lq lr ls jw lt lu lv ka lw lx ly lz dt translated">获取初始数据</h2><p id="b5e5" class="pw-post-body-paragraph jh ji hu jj b jk ma jm jn jo mb jq jr js mc ju jv jw md jy jz ka me kc kd ke hn dt translated">在上一篇文章中，我向您展示了一种使用AJAX从API获取数据的方法。这一次，我们将使用<code class="eh mg mh mi mj b">fetch()</code>和<strong class="jj hv"> Javascript Promises </strong>为我们的应用程序获取数据。</p><div class="kf kg fm fo kh ki"><a rel="noopener follow" target="_blank" href="/@bluepnume/learn-about-promises-before-you-start-using-async-await-eb148164a9c8"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">在开始使用async/await之前理解承诺</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">随着Babel现在支持异步/等待开箱即用，以及ES2016(或ES7)即将到来，越来越多的人…</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">medium.com</p></div></div></div></a></div><p id="1a40" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我可以写很多关于承诺和它们如何工作的文章，但我相信有很多其他文章比我更好地解释它们，所以我只打算解释你需要知道的。当您调用像<code class="eh mg mh mi mj b">fetch()</code>这样的函数时，结果可能需要一段时间才能返回，或者甚至可能根本不会返回。在第一个场景中，您使用<code class="eh mg mh mi mj b">.then()</code>处理结果，在第二个场景中，您使用<code class="eh mg mh mi mj b">.catch()</code>处理错误。</p><p id="ebf8" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在我们的例子中，我们相信API是好的，它不会返回一个错误(不管怎样，如果我们提供了正确的URL，就不应该返回错误)，所以我们将省略<code class="eh mg mh mi mj b">.catch()</code>部分，使用<code class="eh mg mh mi mj b">.then()</code>。<code class="eh mg mh mi mj b">fetch()</code>需要提供一个URL，然后我们可以连锁一个或多个<code class="eh mg mh mi mj b">.then()</code>调用，将尽快解决响应回来。</p><p id="9137" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在Redux中运行这样的异步代码相当复杂，所以我们将使用另一种方法，即在<code class="eh mg mh mi mj b">App</code>组件挂载后立即操作它。因此，我们将在我们的<code class="eh mg mh mi mj b">App</code>的<code class="eh mg mh mi mj b">componentDidMount()</code>方法中编写如下内容:</p><figure class="nf ng nh ni fq iv"><div class="bz el l di"><div class="nr ns l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Fetching initial data from our JSON file</figcaption></figure><p id="f6ae" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">加载了我们的<strong class="jj hv">初始数据</strong>之后，填充导航列表以及显示我们刚刚从JSON文件中加载的所有数据的帖子列表应该很容易。我假设您熟悉HTML和React，因此您可以轻松地自己完成这项工作。</p><blockquote class="mk ml mm"><p id="467f" class="jh ji kx jj b jk jl jm jn jo jp jq jr mn jt ju jv mo jx jy jz mp kb kc kd ke hn dt translated"><strong class="jj hv">TL；DR: </strong> <code class="eh mg mh mi mj b">fetch()</code>是一种我们可以用来从JSON文件(或API)中获取数据的方法，它返回一个Javascript承诺。承诺用于异步运行代码，因此我们可以利用它们来加载数据，而不必等待数据来呈现我们的应用程序。</p></blockquote><h2 id="2862" class="lf lg hu bd lh li lj lk ll lm ln lo lp js lq lr ls jw lt lu lv ka lw lx ly lz dt translated">将状态移至Redux</h2><p id="b085" class="pw-post-body-paragraph jh ji hu jj b jk ma jm jn jo mb jq jr js mc ju jv jw md jy jz ka me kc kd ke hn dt translated">Redux的一个关键点是，它使用<code class="eh mg mh mi mj b">props</code>而不是<code class="eh mg mh mi mj b">state</code>将数据传递给组件。这是我一开始很纠结的一件事，所以我故意让你把我们从JSON文件中得到的数据存储到我们的<code class="eh mg mh mi mj b">App</code>组件的本地<code class="eh mg mh mi mj b">state</code>中，以便解释一个具有本地状态的项目如何从Redux中受益，如果你花时间进行必要的修改的话。到现在为止，你的<code class="eh mg mh mi mj b">render()</code>方法应该有一个呈现文章和链接的部分，如下所示:</p><figure class="nf ng nh ni fq iv"><div class="bz el l di"><div class="nr ns l"/></div></figure><p id="4373" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然而，您希望您的<strong class="jj hv">应用程序的状态由Redux </strong>来管理。所以，你要做的第一件事就是把<code class="eh mg mh mi mj b">this.state</code>改成<code class="eh mg mh mi mj b">this.props</code>。一旦你这样做了，你就会开始得到错误，但是请耐心等待几分钟，你就可以开始了。我们需要将JSON数据传递给Redux的<code class="eh mg mh mi mj b">store</code>，而不是复制到本地<code class="eh mg mh mi mj b">state</code>。我们如何做到这一点？用一个动作！我将继续定义一个新的动作，然后将它添加到reducer，然后告诉它将检索到的数据存储到全局<code class="eh mg mh mi mj b">state</code>。最后，我将修改<code class="eh mg mh mi mj b">componentWillMount</code>方法来分派该动作，这样一切都像以前一样工作。这是我最后得到的结果:</p><figure class="nf ng nh ni fq iv"><div class="bz el l di"><div class="nr ns l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Moving local state to global store</figcaption></figure><blockquote class="mk ml mm"><p id="7adf" class="jh ji kx jj b jk jl jm jn jo jp jq jr mn jt ju jv mo jx jy jz mp kb kc kd ke hn dt translated"><strong class="jj hv">TL；DR: </strong> Redux与组件<code class="eh mg mh mi mj b">props</code>交互，不与<code class="eh mg mh mi mj b">state</code>交互。从局部状态转移到全局状态很容易做到，并确保使用Redux处理所有事情。像<code class="eh mg mh mi mj b">.fetch()</code>这样的异步调用可以根据需要利用动作与全局<code class="eh mg mh mi mj b">store</code>进行交互。</p></blockquote></div><div class="ab cl ky kz hc la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hn ho hp hq hr"><h2 id="11a3" class="lf lg hu bd lh li lj lk ll lm ln lo lp js lq lr ls jw lt lu lv ka lw lx ly lz dt translated">添加搜索功能</h2><p id="58c2" class="pw-post-body-paragraph jh ji hu jj b jk ma jm jn jo mb jq jr js mc ju jv jw md jy jz ka me kc kd ke hn dt translated"><strong class="jj hv">搜索</strong>是任何类型的应用程序中最常见的功能。有许多方法可以实现搜索，但对于这个PWA，我将使用<a class="ae jg" href="https://github.com/bvaughn/js-search" rel="noopener ugc nofollow" target="_blank"> <strong class="jj hv"> JS Search </strong> </a>，一个非常高效的搜索库，非常容易使用。继续安装，使用:</p><pre class="nf ng nh ni fq nj mj nk nl aw nm dt"><span id="167d" class="lf lg hu mj b fv nn no l np nq">npm install js-search</span></pre><div class="kf kg fm fo kh ki"><a href="https://github.com/bvaughn/js-search" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab ej"><div class="kk ab kl cl cj km"><h2 class="bd hv fv z el kn eo ep ko er et ht dt translated">bvaughn/js-search</h2><div class="kp l"><h3 class="bd b fv z el kn eo ep ko er et ek translated">JS Search是一个高效的客户端JavaScript和JSON对象搜索库</h3></div><div class="kq l"><p class="bd b gc z el kn eo ep ko er et ek translated">github.com</p></div></div><div class="kr l"><div class="nu l kt ku kv kr kw ja ki"/></div></div></a></div><p id="9b3d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">与任何工具一样，您应该花点时间阅读自述文件并理解它是如何工作的。根据提供的说明，创建搜索库的实例、按日期排序、向<code class="eh mg mh mi mj b">title</code>、<code class="eh mg mh mi mj b">tags</code>和<code class="eh mg mh mi mj b">author</code>添加索引以及将文档集合设置为<code class="eh mg mh mi mj b">posts</code>的列表应该很容易。</p><figure class="nf ng nh ni fq iv"><div class="bz el l di"><div class="nr ns l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">The finished reducer code</figcaption></figure><p id="0066" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了实际选择要显示的帖子，我们将使用帖子的<code class="eh mg mh mi mj b">id</code>数组，所以继续将它添加到您的reducer的定义中，以及您的<code class="eh mg mh mi mj b">App</code>组件的构造函数中。您还应该更新帖子和链接的呈现条件，如果<code class="eh mg mh mi mj b">selected</code>数组不为空，则只显示选定的帖子，否则显示所有帖子。</p><p id="b24a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最后，我们需要为我们的搜索字段挂接一个<code class="eh mg mh mi mj b">onChange</code>事件，这样我们就可以向reducer发送动作。如果该字段为空，我们将清空<code class="eh mg mh mi mj b">selected</code>帖子列表，否则我们将利用JS搜索来查找哪些帖子符合我们的查询。</p><figure class="nf ng nh ni fq iv"><div class="bz el l di"><div class="nr ns l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Hooking up search to the reducer</figcaption></figure><blockquote class="mk ml mm"><p id="5306" class="jh ji kx jj b jk jl jm jn jo jp jq jr mn jt ju jv mo jx jy jz mp kb kc kd ke hn dt translated"><strong class="jj hv">TL；DR: </strong>客户端搜索可以很容易地用JS搜索库来实现，它只需要向我们的Redux reducer添加一点点逻辑，以及一个搜索字段的事件处理程序。</p></blockquote><h2 id="c99e" class="lf lg hu bd lh li lj lk ll lm ln lo lp js lq lr ls jw lt lu lv ka lw lx ly lz dt translated">优化构建</h2><p id="e0f3" class="pw-post-body-paragraph jh ji hu jj b jk ma jm jn jo mb jq jr js mc ju jv jw md jy jz ka me kc kd ke hn dt translated">我们的小PWA已经完成，我们甚至不用担心编写服务人员，因为<code class="eh mg mh mi mj b">create-react-app</code>已经为我们处理好了。但是有一个小问题，那就是我们最终建筑的尺寸。跑<code class="eh mg mh mi mj b">npm run build</code>会发现我们的PWA有多重。对我来说，光是文件<code class="eh mg mh mi mj b">.js</code>就有168 kb<strong class="jj hv">那么大。对于像这样的小型博客应用程序来说，这是相当沉重的，所以想象一下对于一个相当大的网站来说，它的大小会是多少。</strong></p><p id="15d6" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">优化PWA的大小似乎没有必要。在服务工作者第一次缓存了所有代码之后，就可以从缓存中提供服务了。从技术上讲，这是真的，但是如果我们的应用程序定期更新呢？如果我们有大量的资产需要大量的带宽呢？毕竟，在用户离开我们的网站之前，我们有大约3秒钟的时间。</p><p id="2e07" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我的首选是使用<a class="ae jg" href="https://preactjs.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jj hv"> Preact </strong> </a>，这是react的一个轻量级实现。为了使事情更容易，我将安装<code class="eh mg mh mi mj b">preact-compat</code>和<code class="eh mg mh mi mj b">preact-redux</code>以及<code class="eh mg mh mi mj b">preact</code>，这样我们几乎不需要修改我们的代码。继续安装它们。然后，找到<code class="eh mg mh mi mj b">react</code>和<code class="eh mg mh mi mj b">react-dom</code>的任何引用，并替换为<code class="eh mg mh mi mj b">preact-compat</code>。最后，用<code class="eh mg mh mi mj b">preact-redux</code>替换<code class="eh mg mh mi mj b">react-redux</code>的所有引用，并重新构建您的项目。</p><p id="eeef" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我的<code class="eh mg mh mi mj b">.js</code>文件现在是<strong class="jj hv"> 77KB </strong>！这还不到以前大小的一半，这将大大加快加载速度。但是我们还能做更多。在<strong class="jj hv"> Lighthouse </strong>中测试我的PWA，发现页面上的图像需要很长时间才能加载，所以我需要解决这个问题。我的一个想法是使用被低估的<code class="eh mg mh mi mj b">&lt;picture&gt;</code>元素在手机上展示一个更小、更低清晰度的图像。做了这个改变，编译并再次运行显示，虽然不完美，应用程序的性能已经好了很多，我减少了1秒的加载时间。</p><figure class="nf ng nh ni fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nv"><img src="../Images/7e6c41dc91176cca332053e6e3710cea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WJkiQQU8MNzqf_gk0JOyQw.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Lighthouse scores — performance comparison before and after optimizing image loading</figcaption></figure><blockquote class="mk ml mm"><p id="e896" class="jh ji kx jj b jk jl jm jn jo jp jq jr mn jt ju jv mo jx jy jz mp kb kc kd ke hn dt translated"><strong class="jj hv">TL；DR: </strong>捆绑的Javascript文件的最终大小可能会非常大，这会减慢我们PWA的初始加载时间。Preact是一个轻量级且易于使用的替代方案，它将帮助您最小化应用程序的大小。</p></blockquote></div><div class="ab cl ky kz hc la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hn ho hp hq hr"><h2 id="6bd4" class="lf lg hu bd lh li lj lk ll lm ln lo lp js lq lr ls jw lt lu lv ka lw lx ly lz dt translated">最终考虑</h2><p id="15fe" class="pw-post-body-paragraph jh ji hu jj b jk ma jm jn jo mb jq jr js mc ju jv jw md jy jz ka me kc kd ke hn dt translated">部署PWA时，我注意到<strong class="jj hv"> Github页面</strong>不能正确地服务它。这是因为<code class="eh mg mh mi mj b">index.html</code>中的所有路径都指向<code class="eh mg mh mi mj b">/</code>，而不是<code class="eh mg mh mi mj b">./</code>。如果你计划在Github页面上部署，我建议运行<code class="eh mg mh mi mj b">npm run eject</code>，然后修改<code class="eh mg mh mi mj b">/config/paths.js</code>中的<code class="eh mg mh mi mj b">getServedPath()</code>指向<code class="eh mg mh mi mj b">./</code>，而不是<code class="eh mg mh mi mj b">/</code>。重新构建并部署到Github页面，我的PWA按预期运行，自动生成的服务工作器通知我<em class="kx">内容已缓存供离线使用</em>。</p><p id="a19c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最终的源代码可以在这里找到，你可以在这里看到完整的应用程序<a class="ae jg" href="https://chalarangelo.github.io/autumn-pwa/index.html" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl ky kz hc la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hn ho hp hq hr"><blockquote class="nw"><p id="53ec" class="nx ny hu bd nz oa ob oc od oe of ke ek translated">希望现在你已经理解了进步的Web应用程序是如何工作的，以及如何利用所有的现代工具让你的生活变得更简单。非常感谢您的宝贵时间！</p></blockquote></div></div>    
</body>
</html>