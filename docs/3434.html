<html>
<head>
<title>Genetic algorithm, A* and rotated objects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">遗传算法、A*和旋转物体</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/genetic-algorithm-a-and-rotated-objects-ca19668c780d?source=collection_archive---------10-----------------------#2017-04-01">https://medium.com/hackernoon/genetic-algorithm-a-and-rotated-objects-ca19668c780d?source=collection_archive---------10-----------------------#2017-04-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="23d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有一段时间，我想扩展由<a class="jq jr gr" href="https://medium.com/u/fecd456da1ea?source=post_page-----ca19668c780d--------------------------------" rel="noopener" target="_blank">丹尼尔·希夫曼</a>完成的编码挑战<a class="ae jp" href="https://www.youtube.com/watch?v=bGz7mv2vD6g" rel="noopener ugc nofollow" target="_blank">智能火箭</a>。所以我做了。</p><h1 id="9e54" class="js jt hu bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dt translated">目标</h1><p id="97ed" class="pw-post-body-paragraph ir is hu it b iu kq iw ix iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo hn dt translated">为了实现这一目标，我创建了以下改进列表:</p><p id="58f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.让画布变大，这样会更有趣，尤其是在处理性能提升的时候；</p><p id="b7de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.改变它计算有机体适应度的方式。后来，这被证明是一个好主意，因为经过一些改进后，可以添加更多的障碍，并保持遗传算法在寻找更具挑战性的路径方面的可靠性。</p><p id="0d9e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.改进代码组织和组件化；</p><p id="9990" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">4.看看遗传算法能在多大程度上使生物体达到目标(命中率)；</p><p id="3eb3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">5.增加更多的适应度计算算法，看仿真如何应对；</p><p id="ab03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">6.添加历史统计数据以可视化遗传算法的进化；</p><p id="a606" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">7.添加控件来管理<a class="ae jp" href="https://hackernoon.com/tagged/enviroment" rel="noopener ugc nofollow" target="_blank">环境</a>(种群大小、速度、有机体数量、健身算法选择器、播放/暂停和重置)；</p><p id="0056" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">8.创建一个插件系统；</p><p id="1678" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">9.正确计算旋转物体的碰撞。这比我想象的要难；</p><p id="0ced" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">10.多加障碍！</p><p id="6bb4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">11.添加更多的基因特征！</p><h1 id="0d79" class="js jt hu bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dt translated"><strong class="ak">遗传算法</strong></h1><p id="8ae3" class="pw-post-body-paragraph ir is hu it b iu kq iw ix iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo hn dt translated">这个项目中使用的遗传算法非常简单。一个包含一个种群的世界，一个由有机体和每个有机体及其基因组成的种群:运动，大小和最大力量(在这种情况下最大力量代表其敏捷性)。</p><p id="1db2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在每一代结束时，使用三种可用方法之一计算每个生物体的适应度:</p><p id="8397" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.A*:寿命和到目标的距离之间的加权计算；</p><p id="6ed4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.加权:寿命和到目标的直接距离之间的加权计算；</p><p id="d464" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.直接距离:生物体与目标之间的直接距离；</p><p id="a603" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">A*加权公式:</p><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="la lb l"/></div></figure><p id="f7e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其中<em class="lc">距离</em>是到达目标的总A*路径步数，<em class="lc">寿命</em>是死亡前的最高世界分笔成交点(或者当它到达目标时，最大可能寿命)。</p><p id="6eeb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">交配池的建立是为了在低等生物和高等生物之间产生一定比例的DNA差异。</p><p id="922b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">交配池:</p><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="la lb l"/></div></figure><p id="07a5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">随着池的建立，我们需要随机选择生物体进行交配，并交叉其DNA。</p><p id="d7b0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">选择:</p><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="la lb l"/></div></figure><p id="c38b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，以0.1%的突变率穿过它的DNA。这种突变对于创造离群值来说是必要的，这种离群值可以推动这些生物体并给予它们更多的存活率。</p><p id="d5ec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">交叉:</p><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="la lb l"/></div></figure><h1 id="4991" class="js jt hu bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dt translated"><strong class="ak">性能瓶颈</strong></h1><h2 id="c362" class="ld jt hu bd ju le lf lg jy lh li lj kc jc lk ll kg jg lm ln kk jk lo lp ko lq dt translated"><strong class="ak"> A*寻路</strong></h2><p id="6085" class="pw-post-body-paragraph ir is hu it b iu kq iw ix iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo hn dt translated">我遇到的主要性能问题是A*算法。我正在使用<a class="ae jp" href="https://github.com/bgrins/javascript-astar" rel="noopener ugc nofollow" target="_blank">这个</a>库，这是一个很好的算法实现，然而，我最初的想法是创建一个600x600(画布大小)的网格，并根据它的颜色确定可行走的路径(黑色表示可通行的路径，白色表示墙壁)。</p><p id="a29a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我发现自己等待了10到15秒来计算所有100个生物体路径，以便给所有生物体一个适合度分数。这种计算必须在每一代结束时进行。</p><p id="5d0e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了减少所需的总时间，我缓存了创建的图，并且每次新的路径搜索我都简单地清理了图。不幸的是，该算法将数据与函数混合在一起，因此不可能浅层复制图形，因此，我需要重置并清除图形中的每个节点(600*600 = 360，000个节点)。这方面还有待改进。</p><p id="0ebb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尽管总的时间需求非常大，在7到11秒之间，我还需要进一步改进。经过一两个晚上的思考，我发现了两个可能的解决方案:缩小画布大小或者缓存所有可能的路径组合及其距离。我决定从第一个开始，这被证明是一个可以接受的解决方案。</p><p id="ce8a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的想法来自JPEG压缩，这当然不是同一个算法，但想法是一样的。我没有在600x600的画布中计算路径，而是将画布大小缩小X%,然后在较小版本的画布地图表示中计算这两点之间的距离。这个解决方案使距离不太准确，但它对所有生物来说都是公平的，所以这里没有损失。</p><p id="9471" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这一次，将画布尺寸缩小50%使得时间从7-11秒变成了&lt; 1 seconds. After more caching and profiles to find slow parts it decreased to &lt; 400ms in my machine.</p><p id="fc20" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Interesting results, I wonder how they do in games with paths larger than mine. Do they do the same?</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div class="fe ff lr"><img src="../Images/47bfb034adf981ebdfc25d2c3a2a99c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*_eea3qoXwW7CRGWIVSDcWg.png"/></div></figure><h2 id="ff70" class="ld jt hu bd ju le lf lg jy lh li lj kc jc lk ll kg jg lm ln kk jk lo lp ko lq dt translated"><strong class="ak">函数编程</strong></h2><p id="03e1" class="pw-post-body-paragraph ir is hu it b iu kq iw ix iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo hn dt translated">一开始，因为我喜欢使用函数式<a class="ae jp" href="https://hackernoon.com/tagged/programming" rel="noopener ugc nofollow" target="_blank">编程</a>和像<a class="ae jp" href="http://ramdajs.com/" rel="noopener ugc nofollow" target="_blank"> ramda </a>这样的库，所以一切都计划用它来制作。</p><p id="7924" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">过了一段时间，我明白了我的目标之一是性能，我需要告诉你，1600滴答和60 FPS的速率与函数式编程不相称。似乎每一点表现都需要挤一挤才能足够快。所以放弃这个想法并不容易。你到处都能看到基本的fors。</p><p id="d530" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我发现一件有趣的事情是，在for中使用var比新的let更好，原因如下。</p><h1 id="c5d2" class="js jt hu bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dt translated"><strong class="ak">冲突</strong></h1><p id="99a2" class="pw-post-body-paragraph ir is hu it b iu kq iw ix iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo hn dt translated">canvas对象和p5库提供了旋转对象的方法，但它在内部进行旋转，因此不可能知道旋转对象的向量(我没有找到方法),因此无法使用它通过顶点计算碰撞。</p><p id="6036" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了帮助我，我找到了绕原点旋转矢量的公式:</p><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="la lb l"/></div></figure><p id="ba89" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，我自己做了，而不是利用旋转到canvas/p5，从而提高了性能(因为我只能做一次，并将其用于渲染和碰撞计算)。</p><p id="5305" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">p5没有碰撞系统，所以我利用了<a class="ae jp" href="https://github.com/bmoren/p5.collide2D" rel="noopener ugc nofollow" target="_blank"> p5.collide2D </a>。</p><p id="185f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我对结果很满意，正因为如此，我可以在有角度的矩形中检查碰撞。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div class="fe ff lu"><img src="../Images/4c816fa1ab874f937690b878e8a983ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:266/format:webp/1*uT9uxYJf5gu1IwgjpUxdnw.png"/></div></figure><p id="8164" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以查看<a class="ae jp" href="https://rawgit.com/conradoqg/smart-organisms/master/index.html" rel="noopener ugc nofollow" target="_blank">演示</a>或git库，网址为:</p><div class="lv lw fm fo lx ly"><a href="https://github.com/conradoqg/smart-organisms" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab ej"><div class="ma ab mb cl cj mc"><h2 class="bd hv fv z el md eo ep me er et ht dt translated">conradoqg/智能生物</h2><div class="mf l"><h3 class="bd b fv z el md eo ep me er et ek translated">智能生物——一个旨在了解更多关于p5.js库和遗传算法的纳米项目。</h3></div><div class="mg l"><p class="bd b gc z el md eo ep me er et ek translated">github.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ls ly"/></div></div></a></div><p id="8b7e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就是这样。</p><div class="kv kw kx ky fq ab cb"><figure class="mn kz mo mp mq mr ms paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mn kz mo mp mq mr ms paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mn kz mo mp mq mr ms paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mt mu mv"><p id="f922" class="ir is lc it b iu iv iw ix iy iz ja jb mw jd je jf mx jh ji jj my jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is lc it b iu iv iw ix iy iz ja jb mw jd je jf mx jh ji jj my jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="fe ff mz"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="ne lb l"/></div></figure></div></div>    
</body>
</html>