<html>
<head>
<title>Myths and Legends of SPF</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SPF的神话传说</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/myths-and-legends-of-spf-d17919a9e817?source=collection_archive---------3-----------------------#2017-10-02">https://medium.com/hackernoon/myths-and-legends-of-spf-d17919a9e817?source=collection_archive---------3-----------------------#2017-10-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/c73016397370b546c13fdfdf4c324783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aRwWU6_o6TwgrGqabHkpew.jpeg"/></div></div></figure><p id="4853" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">SPF是发件人策略框架(SPF)的缩写，用于授权使用<a class="ae ka" href="https://hackernoon.com/tagged/email" rel="noopener ugc nofollow" target="_blank">电子邮件</a>中的域。电子邮件域使用此协议来指定哪些Internet主机有权在SMTP HELO和MAIL FROM命令中使用此域。您不必使用任何额外的软件来发布SPF策略，因此此过程非常简单:只需将包含该策略的TXT记录添加到DNS区域。本文末尾给出了这种类型条目的示例。有许多使用SPF的手册甚至在线构造函数。</p><p id="ae4f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">SPF标准的第一个版本是在10多年前批准的。在此期间，开发了许多实现和应用实践。此外，该标准的新版本已经发布。但最令人惊讶的是，由于某种原因，SPF比任何其他标准都要高，在过去的10年里，随着大量的神话和误解在一篇篇文章中传播，并以令人羡慕的规律性出现在论坛上的讨论和问题回答中。同时，协议本身似乎非常简单:实现只需要几分钟。让我们试着回忆和分析一下最常见的误解。</p><p id="70ec" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">TL；DR——请查看最后的建议。</p><h1 id="2791" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">1.误解:SPF将保护我的域名免受欺骗</h1><p id="f836" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong> SPF不保护用户可见的发件人地址。</p><p id="e092" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">解释:</strong> SPF不处理用户看到的消息内容，尤其是发件人的地址。SPF在两个MTA(envelope-from，RFC5321)之间的邮件传输层(SMTP)上授权和验证地址。MailFrom又名返回路径)。这些地址对用户是不可见的，它们可能与用户看到的from头中的地址不同(RFC5322。来自)。因此，无法阻止在“发件人”标头中带有假冒发件人的邮件获得SPF授权。</p><p id="c97c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用DMARC保护可见域名免受欺骗。</p><h1 id="5dc6" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">2.误解:实施后，SPF将提高安全性并打击垃圾邮件</h1><p id="b39f" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong>最有可能的是，在<a class="ae ka" href="https://hackernoon.com/tagged/security" rel="noopener ugc nofollow" target="_blank">安全性</a>和垃圾邮件方面，你不会看到任何重大变化。</p><p id="87b9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">解释:</strong> SPF本来就是一个利他协议，所以它不会给任何发布SPF政策的人提供任何好处。从理论上讲，如果你实现了SPF，这个协议可以保护其他人从你的域名收到假邮件。但事实上，即使这个假设也不成立，因为应用SPF的结果很少被直接使用(这些我们后面都会讨论)。此外，即使所有域都发布了SPF，并且所有收件人都禁止接收未经SPF授权的邮件，这种方法也很难减少垃圾邮件的数量。</p><p id="28ad" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">SPF并不直接防止欺骗或垃圾邮件，然而，该协议被积极而成功地用于部署垃圾邮件过滤系统，以及防止假冒电子邮件，因为它允许您根据特定的域及其信誉检查每封邮件。</p><h1 id="f0ed" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">3.误解:SPF对电子邮件的送达率有负面(正面)影响</h1><p id="5e00" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong>这完全取决于信息的类型、传递方式和你的声誉</p><p id="8761" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">解释:</strong> SPF并不意味着影响标准流程内的电子邮件可送达性，并且当用户从不同于发送邮件的服务器接收此类邮件时，会对邮件的不当实施或间接流程产生负面影响，例如，这适用于重定向电子邮件。但是垃圾邮件过滤系统和基于信誉的分类器考虑了SPF的可用性和授权域的信誉，并且这通常给出关于标准消息流的正面结果。当然，除非你自己就是垃圾邮件发送者。</p><h1 id="5dbb" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">4.误解:SPF为电子邮件发件人提供授权</h1><p id="32b9" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong> SPF为代表域发送邮件的电子邮件服务器提供授权</p><p id="114f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">解释:</strong>首先，SPF只在域级别起作用，在个人邮件地址级别不起作用。其次，即使你是一个特定域的合法电子邮件用户，SPF也不允许你从任何地方发送邮件。为了使您的邮件成功通过SPF验证，您必须只从授权的服务器发送邮件。第三，如果您使用SPF授权了一个服务器(例如，您可以允许通过任何ESP或主机提供商从您的域发送电子邮件)，并且该服务器没有施加任何附加限制，则该服务器的所有用户都有权代表您的域发送邮件。在实施SPF和提供一般电子邮件的身份验证时，请记住这一点。</p><h1 id="fb7e" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">5.误解:未经SPF授权的电子邮件将被拒绝</h1><p id="75a9" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong>一般来说，SPF授权与否对电子邮件的传递没有重大影响。</p><p id="2077" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">解释:</strong> SPF只是一个授权标准，它明确指出应用于未经授权的电子邮件的操作不在该标准的范围之内，而是由收件人的本地策略管理。如果禁止接收此类邮件，这会导致邮件通过间接传递路径出现问题，例如，当使用重定向或邮件列表时，您应该在本地策略中考虑这一事实。在实践中，不建议在SPF授权失败的情况下使用严格的ban。只有在没有其他过滤器的情况下，当域发布<code class="eh le lf lg lh b">-all</code> (hardfail)策略时，标准才允许(但不要求)严格禁止。在大多数情况下，SPF授权被用作加权系统中的一个因素。与此同时，这个因素将具有微不足道的权重，因为违反SPF授权通常不是垃圾邮件的可靠指标:许多垃圾邮件成功地通过SPF授权，而合法的垃圾邮件通常无法做到这一点，我们不太可能在这个领域见证重大变化。如果我们这样看的话，<code class="eh le lf lg lh b">-all</code>和<code class="eh le lf lg lh b">~all</code>没有区别。</p><p id="6bb7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">SPF授权在邮件传递或垃圾邮件过滤方面并不重要，但它允许确认发件人的地址和与域的关系，以及使用域的信誉而不是此邮件的ip信誉。</p><p id="8c6f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">DMARC策略对有关处理未通过授权的消息的进一步行动的决策有更大的影响。DMARC允许您拒绝(或隔离)所有或部分未经授权的邮件。</p><h1 id="9350" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">6.误解:SPF建议使用-all (hardfail)，因为它比？全部或全部</h1><p id="5ccb" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong>事实上，<code class="eh le lf lg lh b">-all</code>对安全性没有任何影响，但是对消息的传递有负面影响。</p><p id="5246" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">解释:</strong> <code class="eh le lf lg lh b">-all</code>导致少数直接使用SPF的收件人通过间接路由发送的邮件被拦截，并拦截邮件。同时，这一政策不会对大多数垃圾短信和虚假短信产生明显影响。目前，<code class="eh le lf lg lh b">~all</code> (softfail)被认为是最合适的策略，几乎所有大型域名都在使用它，即使是那些有非常严格的安全要求的域名(如paypal.com)。<code class="eh le lf lg lh b">-all</code>可用于不用于发送合法电子邮件的域。DMARC将<code class="eh le lf lg lh b">-</code>、<code class="eh le lf lg lh b">~</code>和<code class="eh le lf lg lh b">?</code>视为等同物。</p><h1 id="16e2" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">7.误解:只为用于发送邮件的域配置SPF就足够了</h1><p id="a169" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">事实:在邮件服务器上为HELO中使用的域配置SPF也是必要的。此外，建议对不用于发送电子邮件的MX、A记录和通配符应用阻止策略。</p><p id="33ea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">说明:</strong>在某些情况下，特别是在投递NDR(未送达报告)、DSN(投递状态通知)和某些自动回复时，SMTP信封(envelope-from)中的发件人地址将为空。在这种情况下，SPF从HELO/EHLO命令检查主机名。您需要通过该命令检查名称(例如，通过打开服务器配置或通过向公共服务器发送电子邮件并检查邮件头),并为此名称启用SPF。</p><p id="c3e3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">垃圾邮件制造者不仅可以使用您用来发送邮件的相同域，他们还可以代表任何具有A-或MX记录的主机发送垃圾邮件。因此，如果您出于利他的考虑发布SPF，那么您需要为所有这样的记录添加SPF，并且为不存在的记录添加通配符(*)也是可取的。</p><h1 id="18a4" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">8.误解:最好在DNS中添加一个特殊的SPF类型记录(而不是TXT)</h1><p id="d7f2" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong>一定是TXT记录。</p><p id="aa57" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">说明:</strong>根据当前版本的SPF标准(RFC 7208)，SPF类型DNS记录已被弃用，不应再使用。</p><h1 id="a756" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">9.误解:建议您在SPF中包含尽可能多的可用元素(a、mx、ptr、include)，因为这可以降低出错的可能性</h1><p id="30dc" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong>需要最小化SPF记录，建议仅通过<code class="eh le lf lg lh b">ip4</code> / <code class="eh le lf lg lh b">ip6</code>指定网络地址。</p><p id="6484" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">解释:</strong>解析SPF策略最多只能进行10次DNS查询。超过此限制将导致永久性策略错误(permerror)。此外，DNS是一种不可靠的服务，因此每个请求都有失败(temperror)的可能性，这种可能性随着请求数量的增加而增加。每个额外的<code class="eh le lf lg lh b">a</code>或<code class="eh le lf lg lh b">include</code>记录需要一个额外的DNS请求；至于<code class="eh le lf lg lh b">include</code>，也需要请求包含记录中指定的所有元素。<code class="eh le lf lg lh b">mx</code>要求为每个MX服务器请求MX记录和额外的A记录请求。需要一个额外的请求，而且，它本身就是不安全的。只有通过<code class="eh le lf lg lh b">ip4</code> / <code class="eh le lf lg lh b">ip6</code>列出的网络地址不需要额外的DNS请求。</p><h1 id="4655" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">10.误解:SPF记录的TTL应该更小(更大)</h1><p id="3dc2" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong>对于大多数DNS记录，最好选择1小时到1天范围内的TTL，并在部署或实施计划更改时提前减少，或在策略稳定时增加。</p><p id="4f64" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">解释:</strong>较高的TTL降低了DNS错误的可能性，从而降低了SPF临时错误的可能性，但是当需要对SPF记录进行更改时，它增加了响应时间。</p><h1 id="1601" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">11.误解:如果我不知道哪些IP地址可以用来发送我的消息，那么最好用+all发布策略</h1><p id="0986" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong>具有明确<code class="eh le lf lg lh b">+all</code>或隐含规则的政策允许从任何IP地址代表域名发送邮件，这将对电子邮件的发送产生负面影响。</p><p id="db5d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">解释:</strong>这样的策略没有意义，它经常被垃圾邮件制造者用来确保通过僵尸网络发送的垃圾邮件的SPF认证。因此，发布此类策略的域有被阻止的风险。</p><h1 id="e86f" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">12.误解:使用SPF是没有意义的</h1><p id="2e5d" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong>使用SPF很有必要。</p><p id="a2e5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">说明:</strong> SPF是邮件中授权发件人的机制之一，也是基于信誉的系统中识别域的方式。目前，大型电子邮件服务提供商逐渐开始要求对消息进行授权，并且没有授权的消息在向用户传送或显示方面会受到“惩罚”。此外，对于未通过SPF授权的邮件，可能没有关于传递或未传递的自动响应和通知。原因是这样的响应通常被准确地发送到SPF授权的SMTP信封地址，并要求它被授权。因此，即使所有消息都由DKIM授权，也需要SPF。此外，SPF对于IPv6网络和云服务是必须的:在这样的网络中，使用IP地址的信誉几乎是不可能的，并且来自没有SPF授权的地址的消息通常不会被接受。根据该标准，SPF的主要任务之一是使用域名的信誉而不是IP信誉。</p><h1 id="a936" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">13.误解:SPF是自给自足的</h1><p id="187e" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong> DKIM和DMARC也是必须的。</p><p id="cfca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">说明:</strong> DKIM需要成功转发电子邮件。需要DMARC来保护发件人的地址不被盗用。此外，DMARC允许您接收有关违反SPF政策的报告。</p><h1 id="b1bc" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">14.误解:两份SPF记录比一份好</h1><p id="3a1b" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong>记录必须正好是一条。</p><p id="d239" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">说明:</strong>本要求在标准中有描述。如果有多条记录，这将导致永久错误(permerror)。如果需要合并几个SPF记录，只需用几个<code class="eh le lf lg lh b">include</code>操作符发布一个记录即可。</p><h1 id="d1f7" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">15.误解:spf1好，但spf2.0更好</h1><p id="aac8" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je hv">事实:</strong>你应该用<code class="eh le lf lg lh b">v=spf1</code>。</p><p id="ba48" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">说明:</strong> spf2.0不存在。通过发布spf2.0记录，您可能会面临不可预知结果的风险。spf2.0从未存在过，它也不是一个标准，但是在实验标准RFC 4406(发送者ID)中提到了它，它是基于这样一个假设，即这样一个标准将被采用，因为相应的讨论确实发生了。寄件人ID，本应解决地址欺骗的问题，却没有成为普遍接受的标准，您应该使用DMARC来代替。即使您决定使用发件人ID并发布spf2.0条目，它也不会替代spf1条目。</p><p id="ba1f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我几乎写完了这篇文章，突然我被我们的客户支持人员截住了，他们强烈地(明确地)建议我回忆一下他们在解决各种问题时经常要处理的SPF的以下细微差别:</p><ol class=""><li id="0ca8" class="li lj hu je b jf jg jj jk jn lk jr ll jv lm jz ln lo lp lq dt translated">SPF政策应以<code class="eh le lf lg lh b">all</code>或<code class="eh le lf lg lh b">redirect</code>指令结束。这些指令之后绝对不应该有任何内容。</li><li id="0af9" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz ln lo lp lq dt translated"><code class="eh le lf lg lh b">all</code>或<code class="eh le lf lg lh b">redirect</code>指令在该策略中只能使用一次，并且相互替换(即一个策略不能同时包含<code class="eh le lf lg lh b">all</code>和<code class="eh le lf lg lh b">redirect</code>)。</li><li id="426d" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz ln lo lp lq dt translated"><code class="eh le lf lg lh b">include</code>指令不能取代<code class="eh le lf lg lh b">all</code>或<code class="eh le lf lg lh b">redirect</code>。<code class="eh le lf lg lh b">include</code>可以多次使用，但是您的策略仍然应该以<code class="eh le lf lg lh b">all</code>或<code class="eh le lf lg lh b">redirect</code>指令终止。<code class="eh le lf lg lh b">include</code>或<code class="eh le lf lg lh b">redirect</code>应用于包含以<code class="eh le lf lg lh b">all</code>或<code class="eh le lf lg lh b">redirect</code>终止的有效策略。与此同时，<code class="eh le lf lg lh b">include</code>并不关注包含策略中用于<code class="eh le lf lg lh b">all</code>的规则(<code class="eh le lf lg lh b">-all</code>、<code class="eh le lf lg lh b">~all</code>、<code class="eh le lf lg lh b">?all</code>)，然而对于<code class="eh le lf lg lh b">redirect</code>来说却有所不同。</li><li id="aa26" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz ln lo lp lq dt translated"><code class="eh le lf lg lh b">include</code>与冒号(<code class="eh le lf lg lh b">include:example.com</code>)连用，<code class="eh le lf lg lh b">redirect</code>需要等号(<code class="eh le lf lg lh b">redirect=example.com</code>)。</li><li id="1a51" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz ln lo lp lq dt translated">SPF不包括子域。SPF在子域上不с。防晒系数。确实如此。不是。掩护。子域名。(默认情况下，DMARC涵盖了它们)。如果DNS中的每个A或MX记录用于或可以用于传递电子邮件，您应该为这些记录发布SPF。</li></ol><h1 id="3241" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">摘要</h1><ul class=""><li id="463e" class="li lj hu je b jf kz jj la jn lw jr lx jv ly jz lz lo lp lq dt translated">您应该确保为所有MX，最好是所有A记录创建一个策略。</li><li id="75c0" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz lz lo lp lq dt translated">为邮件服务器的HELO/EHLO中使用的名称添加SPF策略。</li><li id="17a0" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz lz lo lp lq dt translated">在DNS中将SPF策略发布为带有<code class="eh le lf lg lh b">v=spf1</code>的TXT记录。</li><li id="fe6a" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz lz lo lp lq dt translated">尝试在您的策略中将这些地址用作<code class="eh le lf lg lh b">ip4</code> / <code class="eh le lf lg lh b">ip6</code>网络。在策略的开头指定它们，以避免不必要的DNS请求。尽量少用<code class="eh le lf lg lh b">include</code>，尽量不用<code class="eh le lf lg lh b">a</code>，只有在极端和不可抗拒的必要情况下才使用<code class="eh le lf lg lh b">mx</code>，千万不要使用<code class="eh le lf lg lh b">ptr</code>。</li><li id="ec71" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz lz lo lp lq dt translated">为真正用于发送电子邮件的域指定<code class="eh le lf lg lh b">~all</code>，为未使用的域和记录指定<code class="eh le lf lg lh b">-all</code>。</li><li id="4c1c" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz lz lo lp lq dt translated">在实施和测试期间使用小TTL，然后将TTL增加到适当的值。在进行任何更改之前，请先降低TTL。</li><li id="5937" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz lz lo lp lq dt translated">一定要验证你的SPF政策，例如<a class="ae ka" href="https://mxtoolbox.com/spf.aspx" rel="noopener ugc nofollow" target="_blank">这里</a>。</li><li id="9d1d" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz lz lo lp lq dt translated">不要把自己局限在SPF的部署上，尽量实现DKIM，永远实现DMARC。DMARC保护您的消息免受欺骗，并允许您接收有关违反SPF的信息。您将能够检测伪造、间接消息流和配置错误。</li><li id="0103" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz lz lo lp lq dt translated">如果你在实现SPF、DKIM和/或DMARC后阅读俄语(或只是为了好玩)，使用<a class="ae ka" href="https://postmaster.mail.ru/security/" rel="noopener ugc nofollow" target="_blank">https://postmaster.mail.ru/security/</a>检查它们。根据当前状态验证SPF和DMARC仅当与邮件上的信箱一致时，才使用前一天的统计数据检查DKIM。Ru在前一天或之前。</li><li id="0923" class="li lj hu je b jf lr jj ls jn lt jr lu jv lv jz lz lo lp lq dt translated">M3AAWG有好的SPF BCP</li></ul><p id="9196" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">SPF政策示例:<code class="eh le lf lg lh b">@ IN TXT “v=spf1 ip4:1.2.3.0/24 include:_spf.myesp.example.com ~all”</code></p><figure class="ma mb mc md fq iv"><div class="bz el l di"><div class="me mf l"/></div></figure></div></div>    
</body>
</html>