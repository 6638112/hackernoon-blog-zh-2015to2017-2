<html>
<head>
<title>To start thinking about load testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始考虑负载测试</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/to-start-thinking-about-load-testing-e68384b24a12?source=collection_archive---------13-----------------------#2017-10-13">https://medium.com/hackernoon/to-start-thinking-about-load-testing-e68384b24a12?source=collection_archive---------13-----------------------#2017-10-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><h1 id="9891" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">阿帕奇长凳</h1><p id="8a90" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">这是我们的step 1 <a class="ae kn" href="https://hackernoon.com/tagged/tool" rel="noopener ugc nofollow" target="_blank">工具</a>，但是请记住这是单线程的。把ab想象成对性能的健全测试。<strong class="jr hv">对于第一步，你可以使用一台单机，有足够的内存和CPU。运行负载15-30分钟，检查是否有明显的问题。</strong></p><h1 id="6f0d" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">wrk</h1><p id="0210" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">wrk是我们用于<a class="ae kn" href="https://hackernoon.com/tagged/load-testing" rel="noopener ugc nofollow" target="_blank">负载测试</a>的step 2工具，它类似于ab，但是这将放置适当的负载(并发)。在第2步中，我们将使用一台大型计算机(比如64 GB ram，8–16个内核)。在这个阶段，我们仍然在单台机器上进行测试。运行负载约30-60分钟。在进入下一个阶段之前，这样可以很好地理解系统。</p></div><div class="ab cl ko kp hc kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hn ho hp hq hr"><p id="7c00" class="pw-post-body-paragraph jp jq hu jr b js kv ju jv jw kw jy jz ka kx kc kd ke ky kg kh ki kz kk kl km hn dt translated">直到1和2，我们可能正在测试应用程序的单个端点。这很容易设置和获得结果。但直到我们做了分布式负载测试+完成应用流程(流程完成前调用多个API的场景)，事情才算完成。<strong class="jr hv">与1和2相比，分布式负载测试的设置时间更长，成本也更高。</strong></p><h1 id="60ed" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">分布式负载测试</h1><p id="c854" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">我们这里的goto工具是jmeter。Jmeter听起来可能是java特有的，但事实并非如此。这是一个很好的投资时间来拿起jmeter。另外<strong class="jr hv">因为jmeter是一个非常老的工具，所以很容易找到很多有用的指南和设置。</strong></p><p id="78b4" class="pw-post-body-paragraph jp jq hu jr b js kv ju jv jw kw jy jz ka kx kc kd ke ky kg kh ki kz kk kl km hn dt translated">3的目标是得到每台机器每秒请求数的<strong class="jr hv">良好估计</strong>(一定要记下机器规格)。一旦你有了这个数字，<strong class="jr hv">你就可以根据预期流量/高峰流量</strong>来计划你的需求。还有助于决定您需要多少垂直/水平缩放。</p><h1 id="5736" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">对于垂直缩放</h1><h1 id="7c27" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">语言的选择</h1><p id="bbf2" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">一旦您确定了需要关注性能的主要流程，您就可以用编译语言重写这些部分(这几乎总是获得性能提升的唾手可得的果实)。<strong class="jr hv">但这只是在你的应用程序执行很多事情，而不仅仅是一个中间层与数据库对话的时候。</strong></p><h1 id="3bad" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">体系结构</h1><p id="dd19" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">您已经处于一个很好的阶段，即跨几个服务而不是一个大的服务进行设置。尽量不要接受太多的服务。<strong class="jr hv">您希望考虑每个网络呼叫(这将为每个呼叫增加至少10ms)。有时耦合两个服务会给你带来好处。</strong></p><h1 id="8a72" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">进入内存使用</h1><p id="0019" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">对于nodejs来说，获得这些数字可能更难，但是在代码层面上，也可能有一些唾手可得的成果。确定gc的热点，或者在许多情况下，算法和数据结构本身也很重要。</p><h1 id="cfc1" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">对于水平缩放</h1><h1 id="2822" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">负载平衡</h1><p id="005c" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">检查你的http调用的安排。服务进入您的网络后要经过多少个路由器。计划如何平均分配负载。<strong class="jr hv">循环法在开始是可以的，但是随着你的继续，要识别哪些呼叫是繁忙的，哪些不是，并相应地配置路由器。</strong></p><h1 id="d79a" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">贮藏</h1><p id="d04d" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">如果系统是非交易/非支付系统，其中99%的准确性和100%一样好，那么缓存就很有帮助。但是要注意缓存的所有边缘情况。性能仅次于实际业务。<strong class="jr hv">一个糟糕的缓存配置会变得非常糟糕，包括更低的性能和可能错误的结果。</strong>还要注意已经存在的缓存(最近很多框架/ORM都包含了隐藏缓存)</p><p id="bb7d" class="pw-post-body-paragraph jp jq hu jr b js kv ju jv jw kw jy jz ka kx kc kd ke ky kg kh ki kz kk kl km hn dt translated">您可以在所有级别应用缓存:数据库级别、功能级别、控制器级别、api级别。</p><h1 id="f5e4" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">数据库ˌ资料库</h1><p id="9e01" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated"><strong class="jr hv">对于多数读取/少数写入系统，您可以利用数据库从属服务器</strong>来增加吞吐量(这属于缓存，尽管是不同的类型)。此外，请确保您考虑到当副本关闭时会发生什么情况。</p><p id="be3c" class="pw-post-body-paragraph jp jq hu jr b js kv ju jv jw kw jy jz ka kx kc kd ke ky kg kh ki kz kk kl km hn dt translated">-如果情况相反，主要写/次要读，您将需要<strong class="jr hv">检查您使用的是什么数据库(有多个主数据库是有帮助的)</strong></p><p id="a019" class="pw-post-body-paragraph jp jq hu jr b js kv ju jv jw kw jy jz ka kx kc kd ke ky kg kh ki kz kk kl km hn dt translated">-还有您如何在特定数据库中存储数据。<strong class="jr hv">每个DB事务需要写入磁盘的数据量</strong>。</p><p id="b0ed" class="pw-post-body-paragraph jp jq hu jr b js kv ju jv jw kw jy jz ka kx kc kd ke ky kg kh ki kz kk kl km hn dt translated">以上是方法的简要总结。对于上面的每一点，你也应该考虑它的缺点</p><ul class=""><li id="a3ff" class="la lb hu jr b js kv jw kw ka lc ke ld ki le km lf lg lh li dt translated">如果一台机器坏了怎么办</li><li id="12a9" class="la lb hu jr b js lj jw lk ka ll ke lm ki ln km lf lg lh li dt translated">如果5下降了呢</li><li id="5070" class="la lb hu jr b js lj jw lk ka ll ke lm ki ln km lf lg lh li dt translated">如果网络延迟由于某种原因增加了怎么办</li><li id="c061" class="la lb hu jr b js lj jw lk ka ll ke lm ki ln km lf lg lh li dt translated">如果io速度由于某种原因下降了怎么办</li></ul><p id="f10e" class="pw-post-body-paragraph jp jq hu jr b js kv ju jv jw kw jy jz ka kx kc kd ke ky kg kh ki kz kk kl km hn dt translated">以上的一些一般要点:</p><ul class=""><li id="6f27" class="la lb hu jr b js kv jw kw ka lc ke ld ki le km lf lg lh li dt translated">记下所有从您的系统发出的呼叫(给第三方)</li><li id="9adf" class="la lb hu jr b js lj jw lk ka ll ke lm ki ln km lf lg lh li dt translated">如果第三方不能保证他们的RPS/QPS，您可能希望转移到异步流(队列)</li><li id="541f" class="la lb hu jr b js lj jw lk ka ll ke lm ki ln km lf lg lh li dt translated">记下你的哪些服务是IO密集型的，哪些是CPU密集型的，哪些是网络密集型的(很多时候你可以在一个服务中加入两个)</li><li id="f5d7" class="la lb hu jr b js lj jw lk ka ll ke lm ki ln km lf lg lh li dt translated">负载测试时尽量减少模仿。</li></ul><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="lt lu l"/></div></figure></div></div>    
</body>
</html>