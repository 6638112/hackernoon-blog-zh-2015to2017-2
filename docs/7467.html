<html>
<head>
<title>A simple and secure Blockchain Database API written in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python写的简单安全的区块链数据库API</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-finance-data-can-be-secured-by-blockchain-technology-a-fast-and-simple-adoption-with-200-5e762299b67?source=collection_archive---------2-----------------------#2017-10-29">https://medium.com/hackernoon/how-finance-data-can-be-secured-by-blockchain-technology-a-fast-and-simple-adoption-with-200-5e762299b67?source=collection_archive---------2-----------------------#2017-10-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="87c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">GitHub项目链接:<a class="ae jp" href="https://github.com/adamchinkc/blockchain_database" rel="noopener ugc nofollow" target="_blank">此处</a></p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="be3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们谈论<a class="ae jp" href="https://hackernoon.com/tagged/blockchain" rel="noopener ugc nofollow" target="_blank">区块链</a>时，我们总是把它与对等网络联系起来，认为数据必须跨网络分布。这将引起人们的担忧，认为区块链会破坏数据的保密性。</p><p id="7dfa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">实际上，<strong class="it hv">区块链本身的数据架构已经提供了一个很好的解决方案来保护数据免受未经授权的操纵</strong>，<em class="jx">只要服务器受到足够的控制保护，如访问控制，网络和系统安全控制，最好是在内部网络中。</em></p><p id="c3e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以我尝试用Python，Sqlite，RESTful <a class="ae jp" href="https://hackernoon.com/tagged/api" rel="noopener ugc nofollow" target="_blank"> API </a>框架来搭建一个基于区块链数据架构的数据库。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><h1 id="7a87" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated"><strong class="ak">区块链的数据架构及其完整性</strong></h1><figure class="kx ky kz la fq lb fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff kw"><img src="../Images/39583b92c7f050122b225ac9c7ecf061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wj8onoBmsQgsCt1MspoQyA.png"/></div></div><figcaption class="li lj fg fe ff lk ll bd b be z ek">Abstracted from Bitcoin: A Peer-to-Peer Electronic Cash System by Satoshi Nakamoto <a class="ae jp" href="https://bitcoin.org/bitcoin.pdf" rel="noopener ugc nofollow" target="_blank">https://bitcoin.org/bitcoin.pdf</a></figcaption></figure><p id="b688" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从上图中可以看出，每个数据块都由以前的哈希、随机数和事务组成。如果不确定什么是hash，可以先看这篇<a class="ae jp" rel="noopener" href="/@ConsenSys/blockchain-underpinnings-hashing-7f4746cbd66b">文章</a>。为了简化，哈希值是前一个块的唯一ID。如果我们使用这个“唯一ID”来验证前一个块，我们将知道前一个块是否被修改过。</p><p id="2698" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">言外之意是什么？这种机制使我们能够确保任何人都不允许更改以前创建的数据。如果你需要修改数据，你必须创建另一个记录来“修改”或“删除”它。</p><figure class="kx ky kz la fq lb fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lm"><img src="../Images/b342c38421b9918260a6d61f3e65276e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SgaXStuZxH_g58C_aNixnw.png"/></div></div></figure><p id="fe1f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在上例中，Alice错误地输入了日志条目123.4，但它应该是432.1。Alice必须创建另一个记录“删除”来撤销先前的条目。</p><p id="6110" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这似乎是大多数会计系统的基本功能，但我们无法知道它是否只是在应用程序级别受到控制，从而产生了在数据库级别更改数据的可能性。</p><p id="833d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了确保没有人可以更改从起点到终点的数据，我引入了一个简单安全的区块链数据库API。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><h1 id="c23f" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">基于区块链数据架构的数据库</h1><figure class="kx ky kz la fq lb fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff ln"><img src="../Images/bd3e2498bb47b3e3fd97f8a2aa21a11b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZUA06XdNnJ7oDh_zLTFm-w.png"/></div></div></figure><p id="5806" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">问责制、保密性和完整性</strong></p><p id="2e1a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当用户创建交易记录时，他用私钥加密数据，并将数据发布到区块链数据库API。区块链数据库API会用用户的公钥解密数据。在这个过程中，用户的身份得到了确认。实现了<strong class="it hv">问责</strong>和<strong class="it hv">保密的目的。</strong></p><p id="0908" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下一步，区块链数据库API将使用nonce(即随机字符串)和之前的哈希计算交易的哈希值。区块链数据库API会将交易、nonce和hash插入数据库。</p><p id="bd52" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了检测任何未经授权的更改，区块链数据库API将根据之前的哈希、交易和nonce的信息重新计算哈希值。如果进行了任何更改，哈希值将会更改，并且可以通知API。因此，数据的<strong class="it hv">完整性</strong>将得到保证。</p><p id="4fe9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">限制</strong></p><p id="2021" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于是在集中式体系结构中，获得管理权限的攻击者有可能通过重新计算哈希值来更改整个数据库。</p><p id="3f00" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这可以通过以下解决方案来保护:</p><ul class=""><li id="c08b" class="lo lp hu it b iu iv iy iz jc lq jg lr jk ls jo lt lu lv lw dt translated">将事务克隆到安全的日志服务器</li><li id="b36e" class="lo lp hu it b iu lx iy ly jc lz jg ma jk mb jo lt lu lv lw dt translated">增量备份数据(逐行事务)而不是完整备份</li></ul></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><h1 id="e854" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">如何使用API？</h1><p id="5ff5" class="pw-post-body-paragraph ir is hu it b iu mc iw ix iy md ja jb jc me je jf jg mf ji jj jk mg jm jn jo hn dt translated">1.启动哈希API</p><pre class="kx ky kz la fq mh mi mj mk aw ml dt"><span id="c502" class="mm jz hu mi b fv mn mo l mp mq">python hash.py</span></pre><p id="8492" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.启动Nonce API</p><pre class="kx ky kz la fq mh mi mj mk aw ml dt"><span id="8300" class="mm jz hu mi b fv mn mo l mp mq">python nonce.py</span></pre><p id="010f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.启动主API</p><pre class="kx ky kz la fq mh mi mj mk aw ml dt"><span id="de78" class="mm jz hu mi b fv mn mo l mp mq">python main.py</span></pre><p id="b283" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">4.将日志数据发布到主API<a class="ae jp" href="http://127.0.0.1:8000/construct" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/construct</a>并返回带有nonce和hash的响应</p><pre class="kx ky kz la fq mh mi mj mk aw ml dt"><span id="fd36" class="mm jz hu mi b fv mn mo l mp mq">data1 = { 	"journal_id": "JE000001", <br/>	"entry_date" : "2016-11-06", <br/>	"create_time" : "2016-11-06 18:00:00", <br/>	"created_by": "Adam",<br/>	"post_status": "P",<br/>	"account_code" : "100000",<br/>	"amount" : 16453.24,<br/>	"dr_cr" : "C"</span><span id="927b" class="mm jz hu mi b fv mr mo l mp mq">}</span></pre><p id="8823" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">5.将响应发布到主API<a class="ae jp" href="http://127.0.0.1:8000/insert" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/insert</a></p><pre class="kx ky kz la fq mh mi mj mk aw ml dt"><span id="36c0" class="mm jz hu mi b fv mn mo l mp mq">data1 = { 	"journal_id": "JE000001", <br/>	"entry_date" : "2016-11-06", <br/>	"create_time" : "2016-11-06 18:00:00", <br/>	"created_by": "Adam",<br/>	"post_status": "P",<br/>	"account_code" : "100000",<br/>	"amount" : 16453.24,<br/>	"dr_cr" : "C",<br/>  "nonue" : ".....",<br/>  "hash" : "....."<br/>}</span></pre><p id="e105" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">6.通过Get<a class="ae jp" href="http://127.0.0.1:8000/verify?id=1" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/verify验证您的交易？id=1 </a></p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="3d6c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">特别感谢我的同事们富有成效的讨论和西蒙的鼓励。如有任何意见，请随时留在这里或给我发电子邮件至<a class="ae jp" href="mailto:adam.kc.chin@gmail.com" rel="noopener ugc nofollow" target="_blank">adam.kc.chin@gmail.com</a>。</p><figure class="kx ky kz la fq lb"><div class="bz el l di"><div class="ms mt l"/></div></figure></div></div>    
</body>
</html>