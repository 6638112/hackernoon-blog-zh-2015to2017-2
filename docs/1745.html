<html>
<head>
<title>[ Expressjs ] Cracking nuts, override res.send</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[ Expressjs ]开裂螺母，覆盖res.send</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/nodejs-express-js-manipulating-response-before-going-back-to-user-5e96ad8d84ca?source=collection_archive---------4-----------------------#2016-12-04">https://medium.com/hackernoon/nodejs-express-js-manipulating-response-before-going-back-to-user-5e96ad8d84ca?source=collection_archive---------4-----------------------#2016-12-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/3174e7c17306a459e87457801f8f2b7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YrrXFGsgfitTGrKcPJOYFw.jpeg"/></div></div></figure><blockquote class="jc"><p id="50f7" class="jd je hu bd jf jg jh ji jj jk jl jm ek translated">Express.js是坚果的外壳，它具有良好的架构和基本的受保护功能，其中的逻辑是坚果的新鲜，它赋予了坚果味道，使坚果与众不同。</p></blockquote><p id="9f85" class="pw-post-body-paragraph jn jo hu jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj jm hn dt translated">我是Express.js的忠实粉丝，已经在许多项目中使用它，我最喜欢的部分是中间件模式和路由器设计，它们减轻了构建HTTP服务器的痛苦。</p><p id="5f1b" class="pw-post-body-paragraph jn jo hu jp b jq kk js jt ju kl jw jx jy km ka kb kc kn ke kf kg ko ki kj jm hn dt translated">我的老板昨天给了我一个特写:</p><p id="bc11" class="pw-post-body-paragraph jn jo hu jp b jq kk js jt ju kl jw jx jy km ka kb kc kn ke kf kg ko ki kj jm hn dt translated">“彼得，我们需要一个东西来监控应用程序中的用户行为。”<br/>“我觉得GA已经加在APP里了？”<br/>“我们需要来自用户的更多细节，但它们没有存储在GA中(像资金流)，GA有一个缺点，不容易做搜索。”<br/>“我明白了，需要一个模块来存储每个请求的每一个细节(GET、POST、PUT)<strong class="jp hv"><em class="kp"/></strong><em class="kp">，一个日志模块来记录和监控，当错误或异常发生时，至少我们可以从记录中找到</em>原因。”</p><p id="105f" class="pw-post-body-paragraph jn jo hu jp b jq kk js jt ju kl jw jx jy km ka kb kc kn ke kf kg ko ki kj jm hn dt translated">最好的解决方案是操作<strong class="jp hv"> res.send( ) </strong>函数，只需几行程序:</p><pre class="kq kr ks kt fq ku kv kw kx aw ky dt"><span id="d97e" class="kz la hu kv b fv lb lc l ld le">var express = require(‘express’) <br/>var app = express()<br/>  <br/>// Overwrite res.send<br/>app.use(function(req, res, next) {<br/><strong class="kv hv"><em class="kp">    var temp = res.send<br/>    res.send = function() {<br/>        console.log(‘do something..’);<br/>        temp.apply(this,</em></strong>arguments<strong class="kv hv"><em class="kp">);<br/>    }<br/>    next();</em></strong><br/>})</span><span id="ecfc" class="kz la hu kv b fv lf lc l ld le">app.get(‘/’, function (req, res) {<br/>res.send(‘Hello World!’)<br/>})</span></pre><p id="edcd" class="pw-post-body-paragraph jn jo hu jp b jq kk js jt ju kl jw jx jy km ka kb kc kn ke kf kg ko ki kj jm hn dt translated"><em class="kp">#拜</em> <a class="lg lh gr" href="https://medium.com/u/b662fb63374b?source=post_page-----5e96ad8d84ca--------------------------------" rel="noopener" target="_blank"> <em class="kp">弗拉迪米尔</em> </a> <em class="kp">，建议使用</em> <strong class="jp hv"> <em class="kp"> temp.apply(此，</em></strong><em class="kp">arguments</em><strong class="jp hv"><em class="kp">)以获得更好的代码使用灵活性</em> </strong></p></div><div class="ab cl li lj hc lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hn ho hp hq hr"><h2 id="e3e3" class="kz la hu bd lp lq lr ls lt lu lv lw lx jy ly lz ma kc mb mc md kg me mf mg mh dt translated">你也喜欢坚果系列:</h2><p id="5062" class="pw-post-body-paragraph jn jo hu jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj jm hn dt translated"><a class="ae mn" href="https://hackernoon.com/javascript-cracking-nuts-override-object-constructor-48a73628b7e6#.22qqwdp14" rel="noopener ugc nofollow" target="_blank">【Javascript】override object . constructor()</a><br/><a class="ae mn" rel="noopener" href="/@peterchang_82818/expressjs-cracking-nuts-black-list-ip-4787a0850e49#.bxj93og4k">【Expressjs】将IP放入黑名单</a></p><p id="487b" class="pw-post-body-paragraph jn jo hu jp b jq kk js jt ju kl jw jx jy km ka kb kc kn ke kf kg ko ki kj jm hn dt translated">喜欢这个故事？对别人有帮助吗？这有助于我知道你是否想看到更多关于他的话题，并有助于人们看到这个故事，<strong class="jp hv"> <em class="kp">当点击下面的心</em> </strong>。</p></div><div class="ab cl li lj hc lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hn ho hp hq hr"><h2 id="7ff2" class="kz la hu bd lp lq lr ls lt lu lv lw lx jy ly lz ma kc mb mc md kg me mf mg mh dt translated">参考:</h2><p id="a56a" class="pw-post-body-paragraph jn jo hu jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj jm hn dt translated"><a class="ae mn" href="http://stackoverflow.com/questions/27885425/express-middleware-before-response-is-carried-out-to-client" rel="noopener ugc nofollow" target="_blank">http://stack overflow . com/questions/27885425/express-middleware-before-response-is-to-client</a></p><p id="737c" class="pw-post-body-paragraph jn jo hu jp b jq kk js jt ju kl jw jx jy km ka kb kc kn ke kf kg ko ki kj jm hn dt translated"><a class="ae mn" href="https://github.com/wahengchang/javascript-must-know/blob/master/middleware_overwrite_res.send/app.js" rel="noopener ugc nofollow" target="_blank">https://github . com/wahengchang/JavaScript-must-know/blob/master/middleware _ overwrite _ RES . send/app . js</a></p><div class="kq kr ks kt fq ab cb"><figure class="mo iv mp mq mr ms mt paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mo iv mp mq mr ms mt paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mo iv mp mq mr ms mt paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mu mv mw"><p id="f922" class="jn jo kp jp b jq kk js jt ju kl jw jx mx km ka kb my kn ke kf mz ko ki kj jm hn dt translated"><a class="ae mn" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae mn" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae mn" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae mn" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jn jo kp jp b jq kk js jt ju kl jw jx mx km ka kb my kn ke kf mz ko ki kj jm hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae mn" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae mn" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kq kr ks kt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff na"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>