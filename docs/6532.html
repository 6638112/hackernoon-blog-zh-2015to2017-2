<html>
<head>
<title>The Catalan government is using cypherpunk techniques with voter data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加泰罗尼亚政府对选民数据使用密码朋克技术</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/is-sensitive-voter-data-being-exposed-by-the-catalan-government-af9d8a909482?source=collection_archive---------4-----------------------#2017-09-23">https://medium.com/hackernoon/is-sensitive-voter-data-being-exposed-by-the-catalan-government-af9d8a909482?source=collection_archive---------4-----------------------#2017-09-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/ad3d828095bbc4e07f735b2a38f5bcb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-7Rxw2eN9hXeoTPN33I9A.jpeg"/></div></div></figure><div class=""/><p id="5b14" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可能知道，加泰罗尼亚正在为自决而斗争。加泰罗尼亚政府计划在2017年10月1日举行独立公投。另一方面，西班牙政府决心阻止这次公投，因为他们认为这是非法的。因此，它采取了以下措施来阻挠投票:<a class="ae ka" href="https://www.nytimes.com/2017/09/20/world/europe/catalonia-referendum-spain.html?mcubz=0" rel="noopener ugc nofollow" target="_blank">它审查网站，没收数百万张选票，使用军警拦截载有选民可以在哪里投票的信息的邮件，把人关进监狱，等等。</a></p><p id="11ef" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然而，在这篇文章中，我想强调的不是政治，而是加泰罗尼亚政府如何使用一种非常规但有趣的方法来通知公民去哪里投票。我将详细介绍选民需要提供的信息、如何处理这些信息以便将相关数据反馈给选民，以及这种方法的利弊。</p><h2 id="b6a0" class="kb kc if bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated">用户需要哪些数据？</h2><p id="5a18" class="pw-post-body-paragraph jc jd if je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">加泰罗尼亚政府推出了一个网站，这样选民就可以查询10月1日去哪里投票。在该网站中，要求用户输入以下信息:</p><ul class=""><li id="1aaf" class="lb lc if je b jf jg jj jk jn ld jr le jv lf jz lg lh li lj dt translated">国民身份证号码(DNI)</li><li id="3e10" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">出生日期</li><li id="e7f0" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">邮递区号</li></ul><h2 id="7cd0" class="kb kc if bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated"><strong class="ak">这些数据会发生什么？</strong></h2><p id="44f9" class="pw-post-body-paragraph jc jd if je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">在用户输入这些数据后，会发生一个异步请求，当请求完成时，如果有匹配，就会向用户提供他们应该在哪里投票的信息。</p><p id="9c1d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">很标准的东西，对吧？但是，有一个重要的细节:<strong class="je ig">用户输入的数据从不离开浏览器</strong>。当用户点击提交按钮时发生的请求是一个类似下面的<code class="eh lp lq lr ls b">fetch</code>请求:</p><pre class="lt lu lv lw fq lx ls ly lz aw ma dt"><span id="ce50" class="kb kc if ls b fv mb mc l md me">https://onvotar.garantiespelreferendum.com/db/XX/XX.db</span></pre><p id="bdd5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">其中<code class="eh lp lq lr ls b">X</code>是一个十六进制数字。响应包含70到100行似乎是加密的记录。</p><h2 id="a581" class="kb kc if bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated"><strong class="ak">数据库是否被暴露？</strong></h2><p id="f867" class="pw-post-body-paragraph jc jd if je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">我承认当我第一次看到它的时候，我有点害怕。看起来很明显，整个数据库是以小块的形式暴露的。是的，我看了JS代码，这就是正在发生的事情。有65，536个(<code class="eh lp lq lr ls b">0x0000</code>到<code class="eh lp lq lr ls b">0xFFFF</code>)不同的数据库块可供任何人公开访问。</p><p id="427e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我关心的是用户是否能够解密他们的数据或整个数据库。当我深入研究代码时，我意识到事实上事情并不像最初看起来那么糟糕。相反，这是当用户点击提交按钮时实际发生的情况:</p><ul class=""><li id="4709" class="lb lc if je b jf jg jj jk jn ld jr le jv lf jz lg lh li lj dt translated">国民身份证号码的前3个字符被删除。根本用不到。</li><li id="d47a" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">修剪后的ID号与DOB和邮政编码连接在一起。</li><li id="36d9" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">SHA256散列被应用于该键1715次。让我们称这个散列循环的结果为$HASH1。</li><li id="ab83" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">另一个SHA256散列被应用于$HASH1。让我们把这个结果称为$HASH2。</li><li id="a339" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">$HASH1和$HASH2都是由64个十六进制字符组成的字符串。</li><li id="9f23" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">$HASH2的前4个字符用于确定需要获取的DB块。(例如:<code class="eh lp lq lr ls b">d4f3</code>-&gt;-T1)</li><li id="134a" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">$HASH2的下60个字符用于查找包含与用户相关的数据的记录。如果响应中某一行的前60个字符与$HASH2的后60个字符匹配，则该行包含该用户的投票数据。</li><li id="314c" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">如果匹配，则使用$HASH1作为密码解密前60个字符之后的内容。结果是该用户的投票地点信息。</li></ul><h2 id="725a" class="kb kc if bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated">他们为什么选择这种方法？</h2><p id="1ca3" class="pw-post-body-paragraph jc jd if je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">我的假设是他们这样做有两个原因:</p><ol class=""><li id="b71b" class="lb lc if je b jf jg jj jk jn ld jr le jv lf jz mf lh li lj dt translated">避免审查。一旦这些数据库块公开，几乎不可能阻止人们知道他们应该去哪里投票。只要你有办法让这些文件可以被访问，任何能够提供静态内容的网站都可以用于这个目的(比如IPFS)。</li><li id="4be4" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz mf lh li lj dt translated">通过让客户端做所有繁重的工作(计算散列和解密)来防止DDOS攻击。服务器只需要能够高效地提供静态文件。</li></ol><h2 id="aa19" class="kb kc if bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated">那么…可以吗？</h2><p id="6e0a" class="pw-post-body-paragraph jc jd if je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">让我们看看:</p><p id="df12" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，即使恶意用户能够“解密”整个数据库，他们能够获得的唯一信息是身份证的最后6个字符，以及一个出生日期和一个邮政编码。我很难想到这些信息可能会被恶意利用。没有名字，没有地址，没有社会保险号，等等。</p><p id="4036" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">唯一有点敏感的数据是国民身份证号码，前3个数字被删除了。因此，如果恶意用户可以通过暴力攻击获得一些记录，他们也不会得到多少。有必要指出这种情况，因为国家Id的最后一位是一个字母，它是使用数字的<code class="eh lp lq lr ls b">mod(23)</code>计算出来的。因此，攻击者能够将范围缩小到大约43个可能的候选对象，而不是1000个。</p><h2 id="283a" class="kb kc if bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated">“解密”所有数据需要什么？</h2><p id="aea9" class="pw-post-body-paragraph jc jd if je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">如果攻击者想通过暴力攻击获得全部或大部分数据，该怎么办？他们需要多少样本来比对？</p><ul class=""><li id="dbe8" class="lb lc if je b jf jg jj jk jn ld jr le jv lf jz lg lh li lj dt translated">国家ID的5个数字= 100000</li><li id="693d" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">国家ID的一个字母= 23</li><li id="1dea" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">邮政编码:我查过，在加泰罗尼亚有1146个不同的邮政编码。</li><li id="96cf" class="lb lc if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">出生日期:选民必须在2017年10月1日年满18岁。假设攻击者想要将18岁到75岁之间的所有人作为目标:<code class="eh lp lq lr ls b">(75 – 18) * 365 = ~20,805</code></li></ul><p id="7672" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因此，为了“解密”大部分数据，攻击者需要对大约54，837，819，000，000个密钥进行暴力攻击。我现在的电脑需要大约850年才能处理所有这些密钥。</p><p id="1bb4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当然，可以尝试对“低挂果实”进行暴力攻击:人口较多的邮政编码，同时缩小30-50岁之间的年龄范围。所以，是的，有可能得到一些记录。虽然，很可能用处不大。</p><h2 id="01a4" class="kb kc if bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated">我为什么要发表这个？</h2><p id="71b0" class="pw-post-body-paragraph jc jd if je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">主要是因为我觉得这很有意思，想知道大家对这个方法的看法。</p><p id="a965" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完全披露:我不是民族主义者，但我支持独立。我希望公投能够举行，但我确实重视隐私(T2)和安全(T4)。因此，对我来说，确保这种方法是安全的是最重要的。</p><figure class="lt lu lv lw fq hw"><div class="bz el l di"><div class="mg mh l"/></div></figure></div></div>    
</body>
</html>