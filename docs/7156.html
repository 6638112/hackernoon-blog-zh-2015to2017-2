<html>
<head>
<title>Open source node.js package from scratch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从头开始打开源代码node.js包</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/open-source-node-js-package-from-scratch-fa48242a1bbd?source=collection_archive---------23-----------------------#2017-10-18">https://medium.com/hackernoon/open-source-node-js-package-from-scratch-fa48242a1bbd?source=collection_archive---------23-----------------------#2017-10-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="caa2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本教程中，我想展示创建<a class="ae jp" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> node.js </a>包并在<a class="ae jp" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>中注册它是多么容易。我们的主要目标是看到这样的图像:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/be421f769a8e5ca1a6e983fd029fe8b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x8scYh8M1W0bXc0R0a6s4A.png"/></div></div></figure></div><div class="ab cl kc kd hc ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hn ho hp hq hr"><p id="63fd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有很多开发人员使用开源代码，但从不回馈任何东西。我将展示如何简单快速地创建节点包并在npm中注册它。</p><p id="dc00" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于本教程，我将创建<a class="ae jp" href="https://yeps.info/" rel="noopener ugc nofollow" target="_blank"> YEPS </a>模块，并在npm中注册它。但是没有代码质量和测试代码覆盖率，它就不会完成。我将只使用linux进行测试，因为我认为node在linux环境下工作得更好，而且由于它是开源的，我们将在任何地方使用开源。而且<a class="ae jp" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>作为开源数据库对我们来说也是完美的。我将在<a class="ae jp" rel="noopener" href="/@evheniybystrov/full-stack-react-app-from-scratch-part-1-9086cacc59ac">系列</a>的未来部分使用这个包。</p><p id="96d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我喜欢idea: <strong class="it hv">不学框架。学习架构</strong>。这就是为什么我不喜欢使用一个<em class="kj">大的通用框架</em>——与其解决业务问题，我需要花很多时间来学习这个框架，以了解所有的功能，并知道如何在一些抽象的未来问题中使用它。<strong class="it hv">喜欢过早优化</strong>。</p><p id="53a7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Node.js是一个小软件包的平台。大多数包都有<strong class="it hv">单一责任</strong>。它有助于解决问题，并为创建自己的应用程序甚至业务框架提供了可能性。如果您找不到符合自己需求的包，您可以创建自己的包并与其他开发人员共享。比如<a class="ae jp" href="https://www.npmjs.com/package/eslint-config-airbnb" rel="noopener ugc nofollow" target="_blank"> Airbnb诚信通配置</a>。不要忘记测试——如果只有一个原因需要改变，那么测试就很容易。</p><p id="6ac8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那我们开始吧。首先，我们需要创建目录，并使用<strong class="it hv"> npm init </strong>命令创建npm项目:</p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="a284" class="kp kq hu kl b fv kr ks l kt ku">mkdir yeps-mongoose<br/>cd yeps-mongoose<br/>npm init -f</span></pre><p id="2fbc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为它将是YEPS的一部分，我们需要创建一个模块来连接mongo。为此，我们需要使用配置。让我们安装<a class="ae jp" href="https://www.npmjs.com/package/config" rel="noopener ugc nofollow" target="_blank">配置包</a>:</p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="897e" class="kp kq hu kl b fv kr ks l kt ku">npm i -S config</span></pre><p id="f297" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并创建文件<strong class="it hv"> config/default.json </strong>:</p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="4919" class="kp kq hu kl b fv kr ks l kt ku">{<br/>  "mongoose": {<br/>    "uri": "mongodb://localhost/test",<br/>    "parameters": {<br/>      "useMongoClient": <strong class="kl hv">true<br/>    </strong>}<br/>  }<br/>}</span></pre><p id="47e5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里我们设置了用于连接MongoDB的uri和一些参数。</p><p id="62fe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为什么这么小的封装只有一个连接？Mongoose帮助创建模式并将其保存为模型。但是为了保存和更新我们的数据，我们需要连接到真实的数据库。</p><p id="531f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们使用node.js作为一个web服务器时，我们需要处理两个流程，比如使用<a class="ae jp" href="http://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> express.js </a>或YEPS: <strong class="it hv">应用启动</strong>和<a class="ae jp" href="https://nodejs.org/en/docs/guides/anatomy-of-an-http-transaction/" rel="noopener ugc nofollow" target="_blank">处理来自用户的请求事件</a>。我们在运行节点进程时使用first，它包括JavaScript文件，读取配置文件，连接到数据库…</p><p id="430b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这里，我们可以使用我们的包。当第一次需要这个包时，它将读取配置文件并连接到MongoDB。之后，我们可以创建模式，存储在文件中，并要求作为一个模块。由于mongoose连接到真实的数据库，我们的模型可以保存和更新数据。</p><p id="9896" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来我们需要安装所有其他的<strong class="it hv">依赖</strong>:<a class="ae jp" href="https://www.npmjs.com/package/mongoose" rel="noopener ugc nofollow" target="_blank">mongose</a>和<a class="ae jp" href="https://www.npmjs.com/package/npm-run-all" rel="noopener ugc nofollow" target="_blank"> npm-run-all </a>和<a class="ae jp" href="https://www.npmjs.com/package/debug" rel="noopener ugc nofollow" target="_blank"> debug </a>:</p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="b768" class="kp kq hu kl b fv kr ks l kt ku">npm i -S mongoose npm-run-all debug</span></pre><p id="2957" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和<strong class="it hv">依赖关系</strong>:</p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="e547" class="kp kq hu kl b fv kr ks l kt ku">npm i -D chai chai-http coveralls eslint eslint-config-airbnb-base eslint-plugin-import husky istanbul@next mocha mocha-lcov-reporter nsp rimraf yeps yeps-server yeps-error</span></pre><p id="6bcd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和一些帮助文件:</p><p id="3704" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">。编辑器配置</strong></p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="3e80" class="kp kq hu kl b fv kr ks l kt ku">root = true<br/><br/>[*]<br/>end_of_line = lf<br/>insert_final_newline = true<br/><br/>charset = utf-8<br/><br/>indent_style = space<br/>indent_size = 2</span></pre><p id="d674" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不同ide中的团队拥有相同的代码标准会有所帮助。</p><p id="68df" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">。eslintrc </strong></p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="9776" class="kp kq hu kl b fv kr ks l kt ku">{<br/>  "extends": "airbnb-base",<br/>  "env": {<br/>    "node": <strong class="kl hv">true</strong>,<br/>    "mocha": <strong class="kl hv">true<br/>  </strong>},<br/>  "rules": {<br/>    "no-unused-expressions": 0,<br/>    "no-underscore-dangle": 0<br/>  }<br/>}</span></pre><p id="c7b3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">eslint 的配置——代码质量工具。</p><p id="8336" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">.伊斯坦布尔. yml </strong></p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="a6a1" class="kp kq hu kl b fv kr ks l kt ku"><strong class="kl hv">instrumentation:<br/>  default-excludes: </strong>true<br/>  <strong class="kl hv">excludes: </strong>[]<br/>  <strong class="kl hv">include-all-sources: </strong>true</span></pre><p id="8725" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">代码覆盖工具。</p><p id="28c9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> .travis.yml </strong></p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="230e" class="kp kq hu kl b fv kr ks l kt ku"><strong class="kl hv">sudo: </strong>required<br/><strong class="kl hv">language: </strong>node_js<br/><strong class="kl hv">node_js:<br/>  </strong>- "7"<br/>  - "8"<br/><strong class="kl hv">services:<br/>  </strong>- docker<br/><strong class="kl hv">before_install:<br/>  </strong>- npm install<br/><strong class="kl hv">script:<br/>  </strong>- docker version<br/>  - node --version<br/>  - npm --version<br/>  - npm run lint<br/>  - npm run test<br/>  - npm run report</span></pre><p id="d9f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该配置有助于我们使用<a class="ae jp" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank"> TravisCI </a>。我们需要使用node.js，在node的最新7和8版本上测试它，我们将使用docker并运行几个命令进行测试:<strong class="it hv">检查版本</strong>，<strong class="it hv">运行lint，测试并报告</strong>。</p><p id="e321" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不要忘记我们文档中的<a class="ae jp" href="https://github.com/evheniy/yeps-mongoose/blob/master/LICENSE" rel="noopener ugc nofollow" target="_blank">许可</a>和<a class="ae jp" href="https://github.com/evheniy/yeps-mongoose/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> README.md </a>文件。你可以在<a class="ae jp" href="https://github.com/evheniy/yeps-mongoose" rel="noopener ugc nofollow" target="_blank"> github </a>或者<a class="ae jp" href="https://npmjs.org/package/yeps-mongoose" rel="noopener ugc nofollow" target="_blank"> npm </a>中找到README.md的最新版本。</p><p id="dc1d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的主要代码是:</p><p id="24a7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> index.js </strong>:</p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="d5fd" class="kp kq hu kl b fv kr ks l kt ku">const debug = require(‘debug’)(‘yeps:mongoose’);<br/>const mongoose = require(‘mongoose’);<br/>const config = require(‘config’); </span><span id="0532" class="kp kq hu kl b fv kv ks l kt ku">debug(config.mongoose); </span><span id="beca" class="kp kq hu kl b fv kv ks l kt ku">mongoose.connect(config.mongoose.uri, config.mongoose.parameters);<br/>mongoose.Promise = global.Promise;</span></pre><p id="d36e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里我们有调试工具，需要mongose包，配置和连接mongose到我们的MongoDB服务器。和小更新—从node.js设置mongoose promise。</p><p id="b4d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下一步是测试:</p><p id="545e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> tests/index.js </strong></p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="0119" class="kp kq hu kl b fv kr ks l kt ku">require('..');<br/><strong class="kl hv">const </strong>App = require('yeps');<br/><strong class="kl hv">const </strong>srv = require('yeps-server');<br/><strong class="kl hv">const </strong>error = require('yeps-error');<br/><strong class="kl hv">const </strong>chai = require('chai');<br/><strong class="kl hv">const </strong>chaiHttp = require('chai-http');<br/><strong class="kl hv">const </strong>mongoose = require('mongoose');<br/><br/><strong class="kl hv">const </strong>{ Schema } = mongoose;<br/><strong class="kl hv">const </strong>{ expect } = chai;<br/><br/>chai.use(chaiHttp);<br/><br/><strong class="kl hv">let </strong>app;<br/><strong class="kl hv">let </strong>server;<br/><br/><strong class="kl hv">const </strong>UserSchema = <strong class="kl hv">new </strong>Schema({<br/>  name: {<br/>    type: String,<br/>    required: [<strong class="kl hv">true</strong>, 'Name is required.'],<br/>  },<br/>});<br/><br/><strong class="kl hv">const </strong>User = mongoose.model('user', UserSchema);<br/><br/>describe('YEPS mysql test', () =&gt; {<br/>  beforeEach(() =&gt; {<br/>    app = <strong class="kl hv">new </strong>App();<br/>    app.then(error());<br/>    server = srv.createHttpServer(app);<br/>  });<br/><br/>  afterEach(() =&gt; {<br/>    server.close();<br/>  });<br/><br/>  after(() =&gt; {<br/>    mongoose.connection.close();<br/>  });<br/><br/>  it('should test User', <strong class="kl hv">async </strong>() =&gt; {<br/>    <strong class="kl hv">let </strong>isTestFinished1 = <strong class="kl hv">false</strong>;<br/>    <strong class="kl hv">let </strong>isTestFinished2 = <strong class="kl hv">false</strong>;<br/><br/>    app.then(<strong class="kl hv">async </strong>(ctx) =&gt; {<br/>      <strong class="kl hv">const </strong>test = <strong class="kl hv">new </strong>User({ name: 'Test' });<br/><br/>      <strong class="kl hv">await </strong>test.save();<br/><br/>      <strong class="kl hv">const </strong>users = <strong class="kl hv">await </strong>User.find({ name: 'Test' });<br/>      expect(users[0]._id.toString()).to.be.equal(test._id.toString());<br/><br/>      <strong class="kl hv">const </strong>user = <strong class="kl hv">await </strong>User.findOne({ _id: test._id });<br/>      expect(user.name).to.be.equal('Test');<br/><br/>      <strong class="kl hv">await </strong>test.remove();<br/><br/>      isTestFinished1 = <strong class="kl hv">true</strong>;<br/><br/>      ctx.res.writeHead(200);<br/>      ctx.res.end(JSON.stringify(test));<br/>    });<br/><br/>    <strong class="kl hv">await </strong>chai.request(server)<br/>      .get('/')<br/>      .send()<br/>      .then((res) =&gt; {<br/>        expect(res).to.have.status(200);<br/>        isTestFinished2 = <strong class="kl hv">true</strong>;<br/>      });<br/><br/>    expect(isTestFinished1).is.true;<br/>    expect(isTestFinished2).is.true;<br/>  });<br/>});</span></pre><p id="5d4b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这里，我们创建一个简单的模式，运行<strong class="it hv"> YEPS </strong>服务器，并进行一些简单的操作，如创建、更新和删除数据库中的数据。</p><p id="0db4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关于测试你可以在我的<a class="ae jp" rel="noopener" href="/@evheniybystrov/full-stack-react-app-from-scratch-part-1-9086cacc59ac">上一篇文章</a>中读到。</p><p id="dfb4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> package.json </strong></p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="14ca" class="kp kq hu kl b fv kr ks l kt ku">{<br/>  "name": "yeps-mongoose",<br/>  "version": "0.0.1",<br/>  "description": "YEPS Mongoose connector",<br/>  "main": "index.js",<br/>  "scripts": {<br/>    "lint": "npm-run-all lint:**",<br/>    "lint:js": "eslint index.js tests",<br/>    "test": "npm-run-all test:**",<br/>    "test:db:start": "npm run db:start",<br/>    "test:db:preparing": "node -e \"setTimeout(()=&gt;1, 1000)\"",<br/>    "test:security": "nsp check",<br/>    "test:code": "mocha tests --recursive",<br/>    "test:coverage": "istanbul cover _mocha -- tests --recursive",<br/>    "test:db:stop": "npm run db:stop",<br/>    "report": "cat ./coverage/lcov.info | ./node_modules/.bin/coveralls",<br/>    "clear": "rimraf coverage",<br/>    "precommit": "npm run lint &amp;&amp; npm test",<br/>    "prepush": "npm run lint &amp;&amp; npm test",<br/>    "db:start": "docker run -d --name mongo -p 27017:27017 mongo",<br/>    "db:stop": "docker rm -f mongo"<br/>  },<br/>  "repository": {<br/>    "type": "git",<br/>    "url": "git+https://github.com/evheniy/yeps-mongoose.git"<br/>  },<br/>  "keywords": [<br/>    "promise",<br/>    "http",<br/>    "server",<br/>    "rest",<br/>    "fast",<br/>    "async",<br/>    "await",<br/>    "https",<br/>    "ssl",<br/>    "easy",<br/>    "mongoose",<br/>    "mongo"<br/>  ],<br/>  "author": "Evheniy Bystrov",<br/>  "license": "MIT",<br/>  "bugs": {<br/>    "url": "https://github.com/evheniy/yeps-mongoose/issues"<br/>  },<br/>  "homepage": "https://github.com/evheniy/yeps-mongoose#readme",<br/>  "files": [<br/>    "index.js"<br/>  ],<br/>  "engines": {<br/>    "node": "&gt;=7.6.0"<br/>  },<br/>  "dependencies": {<br/>    "config": "^1.26.2",<br/>    "debug": "^3.1.0",<br/>    "mongoose": "^4.12.2",<br/>    "npm-run-all": "^4.1.1"<br/>  },<br/>  "devDependencies": {<br/>    "chai": "^4.1.2",<br/>    "chai-http": "^3.0.0",<br/>    "coveralls": "^3.0.0",<br/>    "eslint": "^4.9.0",<br/>    "eslint-config-airbnb-base": "^12.0.2",<br/>    "eslint-plugin-import": "^2.7.0",<br/>    "husky": "^0.14.3",<br/>    "istanbul": "^1.1.0-alpha.1",<br/>    "mocha": "^4.0.1",<br/>    "mocha-lcov-reporter": "^1.3.0",<br/>    "nsp": "^2.8.1",<br/>    "rimraf": "^2.6.2",<br/>    "yeps": "^1.0.0",<br/>    "yeps-error": "^1.2.0",<br/>    "yeps-server": "^1.0.0"<br/>  }<br/>}</span></pre><p id="6223" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Package.json文件<strong class="it hv">是任何node.js项目中最重要的文件</strong>之一。它的名称是<strong class="it hv"> app </strong>、<strong class="it hv">版本</strong>、<strong class="it hv">关键字</strong>、<strong class="it hv">依赖关系</strong> …最重要的是——<strong class="it hv">它有脚本部分</strong>，可以轻松运行任何带有npm的命令，如测试或启动服务器。</p><p id="fa8b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里最有趣的命令是运行docker:</p><pre class="jr js jt ju fq kk kl km kn aw ko dt"><span id="a621" class="kp kq hu kl b fv kr ks l kt ku">"db:start": "docker run -d --name mongo -p 27017:27017 mongo",<br/>"db:stop": "docker rm -f mongo"</span></pre><p id="d1a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这有助于在docker中将mongo作为一个打开了27017端口的进程来启动。要测试它，只需运行<strong class="it hv"> npm运行数据库:启动</strong>或<strong class="it hv"> npm运行数据库:停止</strong>。</p><p id="ab14" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">测试代码后的第一步是<strong class="it hv">将它保存在github </strong>中。为此，我们需要创建一个新的存储库:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff kw"><img src="../Images/cb3586121a4ce001cf405b61eb89c617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U0dRLFIlfMSmiQ211H7n1g.png"/></div></div></figure><p id="6fb3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Github帮助并显示<strong class="it hv">为此的所有步骤</strong>:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff kx"><img src="../Images/e419e9ba036c474b287c42265e2ba5a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ko9k6BkrL_GS60qUxJYdIw.png"/></div></div></figure><p id="8ed1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是在保存我们的代码之前，我们需要配置TravisCI和<a class="ae jp" href="https://coveralls.io/" rel="noopener ugc nofollow" target="_blank">工作服</a>。打开TravisCI管理面板后(不要忘记创建帐户并登录)，我们需要<strong class="it hv">同步github库</strong>。只需点击<strong class="it hv">同步账号</strong>按钮:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ky"><img src="../Images/474a46c3f65a3ae8027fc911dce3060a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SphW6PTDPD8YvEwpzr0r2w.png"/></div></div></figure><p id="836a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以看到我们的新存储库:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff kz"><img src="../Images/1a2c2cff4f5fc6ead757fff69e895e3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ldeIUxDlHbWFdg-PnfElWA.png"/></div></div></figure><p id="2b55" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并在每次提交后启用我们的新存储库来检查和运行测试:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff la"><img src="../Images/1e80856ef8f7bc3a6f535ada3430947d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VH-N-FctoQRX4lPbA4JG8A.png"/></div></div></figure><p id="5ec5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下一步:我们需要为<strong class="it hv">工作服</strong>做同样的。登录并添加存储库:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lb"><img src="../Images/ce9a47c1fa809e6eca49f241e439cb91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*dwlOgZwbUbK0mlqAQUVsfg.png"/></div></figure><p id="3b51" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们需要<strong class="it hv">同步github库</strong>，在下一张图的底部，我们可以看到一个新的库。只需<strong class="it hv">启用</strong>即可:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lc"><img src="../Images/514a11b6d819f65cdedb172da6c1e1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fVGK9-TTy7cEExQTkbU7zg.png"/></div></div></figure><p id="18db" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们已经准备好进行第一次提交，并在github repository中看到我们所有的更改:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ld"><img src="../Images/82a10646d498abfe423f69a1d9ceda5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gfbDlxGJOaB_xPMzaoaWdA.png"/></div></div></figure><p id="3551" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们打开TravisCI并检查<strong class="it hv">构建状态</strong>:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff le"><img src="../Images/a0aee846f7e6ed37661b7c19bdc3ae1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VwngDMv19h107C9dfs2w2Q.png"/></div></div></figure><p id="52e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过所有测试和检查后，我们可以看到<strong class="it hv">的绿色状态</strong>。我们的主要目标是让它一直保持绿色:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lf"><img src="../Images/8c03c8c82b7e7814e351dbc8a7b205d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5xA_OMONEuM4iOenf8D9NA.png"/></div></div></figure><p id="3612" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">打开工作服并检查<strong class="it hv">代码覆盖率</strong>:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lg"><img src="../Images/e7ca15a2505c2caac6f46512dbce32fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*irjE3yrAuopqjM4CbnczAQ.png"/></div></div></figure><p id="678c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们准备发布它。只需运行命令<strong class="it hv"> npm publish </strong>即可。如果npm要求登录，只需输入您的npm帐户的登录名和密码(不要忘记创建它):</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lh"><img src="../Images/85aaa4ce7bf477a897e9a093b8b0edcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UWlaM4cRjXWosy3A1jPyNw.png"/></div></div></figure><p id="42b3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以在github中看到更新的状态:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff li"><img src="../Images/782396728500299c3d2de017594dcb0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asiDnhpcwfjqkBV9grs0pA.png"/></div></div></figure><p id="4398" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和npm:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lj"><img src="../Images/1719c87d3221c12a8a3ccf167c8fbd78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TE7Vobv_Hmv2GrHEsmsMPg.png"/></div></div></figure><p id="df9f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以差不多完成了。我们需要检查依赖关系，只需点击<a class="ae jp" href="https://david-dm.org/evheniy/yeps-mongoose" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">依赖关系</strong> </a>链接或者<strong class="it hv">徽章</strong>:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lk"><img src="../Images/eec26428824fdef610d9e4a248c68de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cFr5Kem2NzEFrfi2yVK_ng.png"/></div></div></figure><p id="efb9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和<a class="ae jp" href="https://david-dm.org/evheniy/yeps-mongoose?type=dev" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> devDependencies </strong> </a>:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ll"><img src="../Images/49715caaa585aa15eaa0c399930666cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hRY_-Cd5KNMrjrDSO6bUbg.png"/></div></div></figure><p id="2ab3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以是最新的。不要忘记<strong class="it hv">支持</strong>它，并在需要时更新。</p><p id="22e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">别忘了添加徽章。像TravisCI或工作服这样的服务都有自己的徽章，或者像http://shields.io/这样的综合服务。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lm"><img src="../Images/2f0a38373e109f1289b970e29e1a31dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vF_BqQwslguYmcR3NJnHkw.png"/></div></div></figure><p id="bdaa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是它们可以被缓存，所以至少1天后它们会被更新。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ln"><img src="../Images/7bb7932d1064d02fac6a82fb40d85682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n4BB4QT1NzCbrq7Wx3TPlQ.png"/></div></div></figure><p id="fb10" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以及一些简单的规则，它们是如何组织你的代码的最佳实践。将你的整体项目分割成小的单一责任包。将代码和测试存储在<strong class="it hv"> github </strong>或<a class="ae jp" href="https://bitbucket.org/" rel="noopener ugc nofollow" target="_blank"> bitbucket </a>中。</p><p id="6eda" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是<strong class="it hv">只有源代码</strong>。如果你需要用<a class="ae jp" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> webpack </a>或者<a class="ae jp" href="https://gulpjs.com/" rel="noopener ugc nofollow" target="_blank">gupp</a>来构建，比如把<a class="ae jp" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"> typescript </a>或者<a class="ae jp" href="https://flow.org/" rel="noopener ugc nofollow" target="_blank"> flow </a>编译成js文件，<a class="ae jp" href="https://www.npmjs.com/package/node-sass" rel="noopener ugc nofollow" target="_blank"> sass </a> / <a class="ae jp" href="https://www.npmjs.com/package/less" rel="noopener ugc nofollow" target="_blank"> less </a>转换成css，在把 <strong class="it hv">保存到npm </strong>之前先把它做成<strong class="it hv">。并将您的生产就绪代码存储在npm或私有存储中。</strong></p><p id="e1cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Npm包应该易于导入任何项目，无需准备、编译、打包...</p><p id="f606" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">仅此而已。现在你可以看到为开源做贡献是多么容易。</p></div></div>    
</body>
</html>