<html>
<head>
<title>Crafting a PWA: Part 1 — Setting up the development workflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">制作PWA:第1部分——建立开发工作流程</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/crafting-a-pwa-part-1-setting-up-the-development-workflow-705337695748?source=collection_archive---------15-----------------------#2017-09-18">https://medium.com/hackernoon/crafting-a-pwa-part-1-setting-up-the-development-workflow-705337695748?source=collection_archive---------15-----------------------#2017-09-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="044b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">T2:PWAs已经流行了一段时间了。精心打造一个好的、表演性的体验是一个持续的旅程。</p><blockquote class="jq jr js"><p id="5424" class="ir is jt it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">因此，在开始<a class="ae jp" href="https://hackernoon.com/tagged/pwa" rel="noopener ugc nofollow" target="_blank"> PWA </a>旅程之前，我们应该花时间建立开发工作流程。</p></blockquote><blockquote class="jx"><p id="1952" class="jy jz hu bd ka kb kc kd ke kf kg jo ek translated">这将伟大的应用程序与曾经伟大的应用程序区分开来。</p></blockquote><p id="8f39" class="pw-post-body-paragraph ir is hu it b iu kh iw ix iy ki ja jb jc kj je jf jg kk ji jj jk kl jm jn jo hn dt translated">例如，让我们考虑一个<a class="ae jp" href="https://github.com/ankeetmaini/react-hn" rel="noopener ugc nofollow" target="_blank"> GitHub仓库</a>，它实现了黑客新闻前端。这不是PWA<strong class="it hv">T9】还不是T11】。它是由<a class="ae jp" href="https://hackernoon.com/tagged/react" rel="noopener ugc nofollow" target="_blank"> React </a>和Redux组成的。</strong></p><p id="7a13" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我希望从现在开始，对这个存储库的每个拉请求都进行性能问题的测试和审计。</p><p id="ff09" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我该怎么做？使用CI服务器，如<a class="ae jp" href="http://travis-ci.org" rel="noopener ugc nofollow" target="_blank"> Travis </a>。通过Travis，我们将增加对lint检查、自动阶段部署、使用lighthouse进行审计的支持，并且可以随时对应用程序上发生的变化进行绝对控制。</p><h2 id="030d" class="km kn hu bd ko kp kq kr ks kt ku kv kw jc kx ky kz jg la lb lc jk ld le lf lg dt translated">步骤1 —添加Travis CI</h2><p id="7822" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">转到您的个人资料页面，为您的存储库启用Travis CI</p><figure class="ln lo lp lq fq lr fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff lm"><img src="../Images/3c55f44ec43aa4d710bab080d0407a53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z9SeKBEVcQv1DPzO6w7JYQ.png"/></div></div></figure><p id="3edf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦您启用了这个开关，您就需要添加一个<code class="eh ly lz ma mb b">.travis.yml</code>来指导Travis在构建的不同阶段做什么。</p><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="mc md l"/></div></figure><p id="0ee9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面是一个简单的对PR运行lint检查的<code class="eh ly lz ma mb b">.travis.yml</code>。</p><h2 id="da28" class="km kn hu bd ko kp kq kr ks kt ku kv kw jc kx ky kz jg la lb lc jk ld le lf lg dt translated">步骤2:添加阶段部署</h2><ol class=""><li id="dfc6" class="me mf hu it b iu lh iy li jc mg jg mh jk mi jo mj mk ml mm dt translated">能够看到运行中的代码变更有助于评审者自信地合并您的变更。</li><li id="2c58" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">一旦创建了Pull请求，我现在将使用<a class="ae jp" href="https://zeit.co/now" rel="noopener ugc nofollow" target="_blank">将您的代码部署到一个唯一的stage URL。您也可以使用</a><a class="ae jp" href="http://surge.sh/" rel="noopener ugc nofollow" target="_blank">浪涌</a>。</li><li id="0697" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">我们面临的挑战是整合Travis的Now部署，以便在创建/更新PR时部署新的更改，并准备好供其他审核者查看/审核。</li><li id="155b" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">travis 是一个优秀的实用程序，现在就可以部署。now部署的特点是— <em class="jt">每次您部署一个项目，now都会为您提供一个新的、唯一的URL。</em></li><li id="2cc1" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">但是<a class="ae jp" href="https://github.com/eliperelman/now-travis" rel="noopener ugc nofollow" target="_blank"> now-travis </a>不提供保存URL的能力，以便我们以后可以使用它来运行lighthouse审计。我一会儿会谈到这一点。</li><li id="57de" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">所以我添加了一个更改，将部署的URL保存到一个临时文件中，并创建了一个到目前为止还没有合并的Pull请求。你可以在你的设置中使用这把叉子:<a class="ae jp" href="https://github.com/ankeetmaini/now-travis" rel="noopener ugc nofollow" target="_blank">https://github.com/ankeetmaini/now-travis</a></li><li id="ae09" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">这将把<strong class="it hv"> now-travis </strong>作为开发依赖项添加到您的项目中。</li><li id="cb5d" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">按照<a class="ae jp" href="https://github.com/ankeetmaini/now-travis/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">自述文件</a>中的说明将now部署与Travis集成。</li><li id="69fc" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">现在使用<code class="eh ly lz ma mb b">npm start</code>或<code class="eh ly lz ma mb b">npm run now-start</code>来启动你的应用程序。它为now-*命令提供了优先权，因此在这种情况下将执行<code class="eh ly lz ma mb b">now-start</code>而不是<code class="eh ly lz ma mb b">npm start</code>。这很有用，因为在开发模式下我也会使用<code class="eh ly lz ma mb b">npm start</code>，而在生产模式下我可能需要传递NODE_ENV=production。或者你可能需要发送其他的东西。</li><li id="a7be" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">成功构建后，更新您的<code class="eh ly lz ma mb b">.travis.yml</code>以运行now-travis。请看after _ script `<em class="jt">NOW _ ALIAS = react-HN-ankeemaini node _ modules/中的这行代码。bin/now-Travis-file = now _ URL</em>` 1</li></ol><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="mc md l"/></div></figure><p id="7433" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在有了这个设置，Travis将部署每个拉取请求。您可以在下图中看到一个临时部署已经完成。</p><figure class="ln lo lp lq fq lr fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff ms"><img src="../Images/0838dd0812e50c2789563d34f2e4c1b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ASToWVoqCPXkdekrd6x-A.png"/></div></div><figcaption class="mt mu fg fe ff mv mw bd b be z ek">CI checks PR for lint, deploys and audits app performance</figcaption></figure><h2 id="fc55" class="km kn hu bd ko kp kq kr ks kt ku kv kw jc kx ky kz jg la lb lc jk ld le lf lg dt translated">步骤3:集成Lighthouse</h2><ol class=""><li id="f0bd" class="me mf hu it b iu lh iy li jc mg jg mh jk mi jo mj mk ml mm dt translated"><a class="ae jp" href="https://developers.google.com/web/tools/lighthouse/" rel="noopener ugc nofollow" target="_blank"> Lighthouse </a>是谷歌的一个审计工具，它会根据一些分数检查你的应用程序并给它打分。</li><li id="f921" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">持续运行这种审计是至关重要的，以便始终保持我们的应用程序快速和高性能。我们将使用<a class="ae jp" href="https://github.com/ebidel/lighthouse-ci" rel="noopener ugc nofollow" target="_blank"> lighthouse-ci </a>将其与Travis集成。</li><li id="3024" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">将<a class="ae jp" href="https://github.com/lighthousebot" rel="noopener ugc nofollow" target="_blank"> lighthousebot </a>作为合作者添加到您的知识库中，这样它就可以更新您的PR状态并发布带有灯塔评分的评论。</li><li id="45ee" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated"><a class="ae jp" href="https://github.com/ebidel/lighthouse-ci#get-an-api-key" rel="noopener ugc nofollow" target="_blank">请求一个API键</a>并在Travis中添加一个ENV变量。目前还没有必要这样做，但将来会这样做。</li><li id="25b6" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">由于<em class="jt">现在</em>将我们的应用程序部署到一个唯一的URL，我们将其保存在一个名为<code class="eh ly lz ma mb b">now-url</code>的文件中。我们需要从文件中读取这个URL，并将其作为lighthouse-ci的输入。</li><li id="9e3b" class="me mf hu it b iu mn iy mo jc mp jg mq jk mr jo mj mk ml mm dt translated">为此，我在文件夹的根目录下创建了一个文件<em class="jt"> run-lighthouse.js </em>，代码如下。<em class="jt"> lighthouse-ci </em>采用<a class="ae jp" href="https://github.com/ebidel/lighthouse-ci#options" rel="noopener ugc nofollow" target="_blank">以下选项</a>，我们在下面的文件中传递相同的选项。</li></ol><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="mc md l"/></div></figure><p id="d67e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">7.最后，在阶段部署完成后，在<strong class="it hv"> after_script </strong>部分的<code class="eh ly lz ma mb b">.travis.yml</code>中添加一个条目来运行上面的文件。<em class="jt"> — file </em>是接受文件名的参数，需要从该文件名读取部署的URL。这会评估你的舞台部署，如果你没有通过minScore，PR会失败，还会发布一个带有你的灯塔分数的评论，见这个PR<a class="ae jp" href="https://github.com/ankeetmaini/react-hn/pull/9" rel="noopener ugc nofollow" target="_blank">https://github.com/ankeetmaini/react-hn/pull/9</a></p><pre class="ln lo lp lq fq mx mb my mz aw na dt"><span id="b89e" class="km kn hu mb b fv nb nc l nd ne">./run-lighthouse.js --file=now_url</span></pre><figure class="ln lo lp lq fq lr fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff nf"><img src="../Images/43e522517b5adecf1d92dcd3d3134d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Jzgvr9vD1YthNj89ws_YQ.png"/></div></div></figure><p id="83df" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">恭喜你！</strong>，你已经成功设置了一个很棒的工作流程。引用中使用的所有代码都在这里。</p></div><div class="ab cl ng nh hc ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="hn ho hp hq hr"><p id="b7b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">[1]由于now中的免费OSS计划一次只能有三个活动部署，您可能需要使用<code class="eh ly lz ma mb b">now rm id</code>手动删除部署</p><p id="e8c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">[2]现在lightousebot将只发布一个评论，不会因为对存储库的权限不足而使您的PR失败，上面显示我的PR失败的截图是因为我运行了一个单独的lighthouse-ci实例用于演示目的。<a class="ae jp" href="https://github.com/ebidel/lighthouse-ci/issues/8" rel="noopener ugc nofollow" target="_blank">详见本期</a></p><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="nn md l"/></div></figure></div></div>    
</body>
</html>