<html>
<head>
<title>How to Build a Portfolio Platform App Using AngularJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用AngularJS构建投资组合平台App</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-a-portfolio-platform-app-using-angularjs-9a98e5a6b7de?source=collection_archive---------4-----------------------#2017-08-31">https://medium.com/hackernoon/how-to-build-a-portfolio-platform-app-using-angularjs-9a98e5a6b7de?source=collection_archive---------4-----------------------#2017-08-31</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/24dd01a96a000a29893a9676c0864a03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YZ_E6SzqctL_6LWNuAew_Q.jpeg"/></div></div></figure><p id="03b0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本教程中，我将向你展示如何使用AngularJS、一点Node和Cosmic JS创建一个“投资组合平台”应用程序。在本教程结束时，我们将有一个平台，使多个投资组合网站的管理。用户可以登录并管理他们的投资组合网站。管理员可以从Cosmic JS仪表板管理多个用户。让我们开始吧。</p><h1 id="5bd5" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">TL；速度三角形定位法(dead reckoning)</h1><p id="0088" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated"><a class="ae ld" href="https://github.com/cosmicjs/portfolio-platform" rel="noopener ugc nofollow" target="_blank">下载GitHub repo。</a> <br/> <a class="ae ld" href="https://cosmicjs.com/apps/portfolio-platform/demo" rel="noopener ugc nofollow" target="_blank">查看试玩。点击几下</a> <br/> <a class="ae ld" href="https://cosmicjs.com/apps/portfolio-platform" rel="noopener ugc nofollow" target="_blank">安装到你的宇宙JS桶。</a></p><h1 id="f0d4" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">开始使用:</h1><p id="d863" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">首先，让我们创建一个新目录来构建我们的项目，并创建一个package.json文件。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="ab77" class="ln kb hu lj b fv lo lp l lq lr">mkdir cosmicapp-porfolio</span><span id="ae71" class="ln kb hu lj b fv ls lp l lq lr">cosmicapp-porfolio$ touch package.json</span></pre><p id="79f1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在您的package.json中，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d319" class="ln kb hu lj b fv lo lp l lq lr">//cosmicapp-porfolio/package.json<br/>{<br/>  "name": "photography-portfolio-app",<br/>  "version": "1.0.0",<br/>  "main": "app-server.js",<br/>  "engines": {<br/>    "node": "4.1.2",<br/>    "npm": "3.5.2"<br/>  },<br/>  "description": "",<br/>  "dependencies": {<br/>    "body-parser": "^1.17.2",<br/>    "bower": "^1.7.7",<br/>    "buffer-to-vinyl": "^1.1.0",<br/>    "express": "^4.13.3",<br/>    "gulp": "^3.9.1",<br/>    "gulp-autoprefixer": "^3.1.0",<br/>    "gulp-concat": "^2.6.0",<br/>    "gulp-concat-css": "^2.2.0",<br/>    "gulp-env": "^0.4.0",<br/>    "gulp-minify-css": "^1.2.4",<br/>    "gulp-ng-config": "^1.4.0",<br/>    "gulp-npm-script-sync": "^1.1.0",<br/>    "gulp-webserver": "^0.9.1",<br/>    "http-server": "^0.9.0",<br/>    "stripe": "^4.22.0",<br/>    "wiredep": "^3.0.0"<br/>  },<br/>  "scripts": {<br/>    "postinstall": "bower install &amp;&amp; gulp config &amp;&amp; gulp js",<br/>    "start": "npm run production",<br/>    "production": "node app-server.js",<br/>    "gulp": "gulp"<br/>  },<br/>  "author": "",<br/>  "license": "ISC",<br/>  "devDependencies": {<br/>    "gulp-npm-script-sync": "^1.1.0",<br/>    "gulp-remote-src": "^0.4.2"<br/>  }<br/>}</span></pre><p id="74a9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">其次，我们来做一个bower.json文件。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="6d0f" class="ln kb hu lj b fv lo lp l lq lr">cosmicapp-porfolio$ touch bower.json</span></pre><p id="5479" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在您的bower.json中，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="f455" class="ln kb hu lj b fv lo lp l lq lr">//cosmicapp-porfolio/bower.json<br/>{<br/>  "name": "photography-portfolio-app",<br/>  "description": "Photography Portfolio App",<br/>  "version": "0.0.0",<br/>  "homepage": "https://github.com/kutsaniuk/cosmicapp-porfolio",<br/>  "license": "MIT",<br/>  "private": true,<br/>  "dependencies": {<br/>    "angular": "~1.5.x",<br/>    "angular-mocks": "~1.5.x",<br/>    "angular-bootstrap": "~1.1.x",<br/>    "angular-cookies": "~1.5.x",<br/>    "angular-route": "~1.5.x",<br/>    "angular-ui-router": "0.2.x",<br/>    "angular-resource": "1.5.x",<br/>    "angular-animate": "~1.5.x",<br/>    "ng-dialog": "0.6.1",<br/>    "bootstrap": "3.3.x",<br/>    "cr-acl": "",<br/>    "angular-chosen-localytics": "*",<br/>    "bootstrap-chosen": "*",<br/>    "ng-flow": "^2.7.4",<br/>    "angular-mask": "*",<br/>    "checklist-model": "0.9.0",<br/>    "angular-ui-notification": "^0.2.0",<br/>    "angular-ui-calendar": "^1.0.2",<br/>    "angular-ui-switch": "^0.1.1",<br/>    "ng-scrollbars": "^0.0.11",<br/>    "jquery.scrollbar": "*",<br/>    "angular-flash-alert": "^2.4.0",<br/>    "components-font-awesome": "^4.7.0",<br/>    "angular-loading-bar": "^0.9.0",<br/>    "angular-environment": "^1.0.8",<br/>    "angular-dragdrop": "",<br/>    "angular-sanitize": "1.5.*",<br/>    "angular-drag-and-drop-directives": "",<br/>    "jquery-ui-touch-punch": "",<br/>    "angular-touch":"1.5.*",<br/>    "textAngular":"1.5.*"<br/>  },<br/>  "resolutions": {<br/>    "angular": "~1.5.x"<br/>  },<br/>  "devDependencies": {<br/>    "cr-acl": "^0.5.0"<br/>  }<br/>}</span></pre><p id="46a9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">配置应用服务器:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="7cd0" class="ln kb hu lj b fv lo lp l lq lr">cosmicapp-porfolio$ touch app-server.js</span><span id="0d11" class="ln kb hu lj b fv ls lp l lq lr">//cosmicapp-porfolio/app-server.js<br/>var express = require('express');<br/>var bodyParser = require('body-parser');<br/>var app = express();<br/>app.set('port', process.env.PORT || 3000)<br/>app.use(express.static(__dirname))<br/>app.use(bodyParser.json())<br/>var http = require('http').Server(app)<br/>// Route<br/>app.get('/', (req, res) =&gt; {<br/>  res.sendFile(__dirname + '/index.html');<br/>})<br/>http.listen(app.get('port'), () =&gt; {<br/>  console.log('Photography Portfolio App listening on ' + app.get('port'))<br/>})</span></pre><h1 id="5616" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">我们正在安装什么，为什么:</h1><ol class=""><li id="a9ab" class="lt lu hu je b jf ky jj kz jn lv jr lw jv lx jz ly lz ma mb dt translated">我们将使用AngularJS框架来构建单页面应用程序</li><li id="2771" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们正在为创建多视图安装angular-ui-router。</li><li id="511f" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们将使用gulp把所有的js和css文件构建成一个文件。</li></ol><h1 id="d092" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">构建我们的应用程序:</h1><p id="d849" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">现在我们将构建我们的文件结构，这样我们就可以组织我们的angular模块和js文件。这就是我们的cosmicapp-portfolio目录应该看起来的样子:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="4031" class="ln kb hu lj b fv lo lp l lq lr">cosmicapp-porfolio<br/>|----app<br/>|       |----auth<br/>|                 |----auth.ctrl.js<br/>|                 |----auth.service.js<br/>|       |----config<br/>|                 |----config.js<br/>|       |----portfolio<br/>|                 |----about<br/>|                           |----portfolio.about.mdl.js<br/>|                 |----contact<br/>|                           |----portfolio.contact.mdl.js<br/>|                 |----intro<br/>|                           |----portfolio.intro.mdl.js<br/>|                 |----projects<br/>|                           |----add<br/>|                                   |----portfolio.projects.add.ctrl.js<br/>|                           |----edit<br/>|                                   |----portfolio.projects.edit.ctrl.js<br/>|                           |----portfolio.projects.mdl.js<br/>|                 |----settings<br/>|                           |----portfolio.settings.ctrl.js<br/>|                           |----portfolio.settings.mdl.js<br/>|                 |----portfolio.ctrl.js<br/>|                 |----portfolio.mdl.js<br/>|                 |----portfolio.service.js<br/>|       |----user<br/>|                 |----user.service.js<br/>|       |----main.mdl.js<br/>|----dist<br/>|       |----css<br/>|       |----img<br/>|       |----js<br/>|----css<br/>|----views<br/>|----gulpfile.js<br/>|----app-server.js<br/>|----bower.json<br/>|----package.json</span></pre><p id="a237" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们将建立我们的index.html。将以下代码复制并粘贴到您的index.html文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="850f" class="ln kb hu lj b fv lo lp l lq lr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en" ng-app="main"&gt;<br/>&lt;head&gt;<br/>    &lt;meta charset="utf-8"&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>    &lt;meta name="description" content=""&gt;<br/>    &lt;meta name="author" content=""&gt;</span><span id="518e" class="ln kb hu lj b fv ls lp l lq lr">    &lt;title&gt;Photography Portfolio App&lt;/title&gt;</span><span id="5a6b" class="ln kb hu lj b fv ls lp l lq lr">    &lt;!-- bower:css --&gt;<br/>    &lt;!-- endbower --&gt;</span><span id="07c2" class="ln kb hu lj b fv ls lp l lq lr">    &lt;!-- Bootstrap Core CSS --&gt;<br/>    &lt;link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"&gt;</span><span id="a5d0" class="ln kb hu lj b fv ls lp l lq lr">    &lt;!-- Custom CSS --&gt;</span><span id="922d" class="ln kb hu lj b fv ls lp l lq lr">    &lt;link href="dist/css/main.min.css" rel="stylesheet"&gt;<br/></span><span id="a62a" class="ln kb hu lj b fv ls lp l lq lr">    &lt;!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries --&gt;<br/>    &lt;!-- WARNING: Respond.js doesn't work if you view the page via file:// --&gt;<br/>    &lt;!--[if lt IE 9]&gt;<br/>    &lt;script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"&gt;&lt;/script&gt;<br/>    &lt;script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"&gt;&lt;/script&gt;<br/>    &lt;![endif]--&gt;</span><span id="15be" class="ln kb hu lj b fv ls lp l lq lr">&lt;/head&gt;<br/>&lt;body&gt;</span><span id="789e" class="ln kb hu lj b fv ls lp l lq lr">&lt;div ui-view&gt;&lt;/div&gt;</span><span id="5a20" class="ln kb hu lj b fv ls lp l lq lr">&lt;!-- bower:js --&gt;<br/>&lt;!-- endbower --&gt;</span><span id="96af" class="ln kb hu lj b fv ls lp l lq lr">&lt;script src="dist/js/main.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="53da" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，我们将把我们的“根”视图作为目标，稍后放置我们的角度模块。位于我们的dist目录中的main.js文件是我们的gulpfile.js文件在捆绑了我们所有的angular模块之后将产生的文件。现在，设置我们的gulpfile.js文件来捆绑我们所有的js文件，并将该捆绑文件导出到我们的dist目录中。将以下代码复制到gulpfile.js文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="5f26" class="ln kb hu lj b fv lo lp l lq lr">//cosmicapp-porfolio/gulpfile.js<br/>'use strict';</span><span id="6a18" class="ln kb hu lj b fv ls lp l lq lr">'use strict';</span><span id="81f5" class="ln kb hu lj b fv ls lp l lq lr">var gulp = require('gulp'),<br/>    webserver = require('gulp-webserver'),<br/>    minifyCSS = require('gulp-minify-css'),<br/>    concat = require('gulp-concat'),<br/>    wiredep = require('wiredep').stream,<br/>    gulpNgConfig = require('gulp-ng-config'),<br/>    autoprefixer = require('gulp-autoprefixer'),<br/>    b2v = require('buffer-to-vinyl'),<br/>    sync = require('gulp-npm-script-sync');</span><span id="6080" class="ln kb hu lj b fv ls lp l lq lr">sync(gulp);</span><span id="6af5" class="ln kb hu lj b fv ls lp l lq lr">gulp.task('css', function () {<br/>  return gulp.src('css/**/*.css')<br/>    .pipe(minifyCSS())<br/>    .pipe(concat('main.min.css'))<br/>    .pipe(autoprefixer())<br/>    .pipe(gulp.dest('dist/css'));<br/>});</span><span id="9083" class="ln kb hu lj b fv ls lp l lq lr">gulp.task('js', function() {<br/>    return gulp.src('app/**/**/*.js')<br/>        .pipe(concat('main.js'))<br/>        .pipe(gulp.dest('dist/js/'));<br/>});</span><span id="95d9" class="ln kb hu lj b fv ls lp l lq lr">gulp.task('config', function () {<br/>    const json = JSON.stringify({<br/>        BUCKET_SLUG: process.env.COSMIC_BUCKET,<br/>        MEDIA_URL: 'https://api.cosmicjs.com/v1/' + process.env.COSMIC_BUCKET + '/media',<br/>        URL: 'https://api.cosmicjs.com/v1/',<br/>        READ_KEY: process.env.COSMIC_READ_KEY || '',<br/>        WRITE_KEY: process.env.COSMIC_WRITE_KEY || '',<br/>        DEFAULT_IMAGE: process.env.DEFAULT_IMAGE || ''<br/>    });<br/>    return b2v.stream(new Buffer(json), 'config.js')<br/>        .pipe(gulpNgConfig('config'))<br/>        .pipe(gulp.dest('app/config'));<br/>});</span><span id="0051" class="ln kb hu lj b fv ls lp l lq lr">gulp.task('default', function () {<br/>  gulp.watch('css/**/*.css', ['css']);<br/>  gulp.watch('app/**/**/*.js', ['js']);<br/>  gulp.watch('bower.json', ['bower']);<br/>});</span><span id="a5a5" class="ln kb hu lj b fv ls lp l lq lr">gulp.task('bower', function () {<br/>  gulp.src('index.html')<br/>    .pipe(wiredep({<br/>      directory: 'bower_components'<br/>    }))<br/>    .pipe(gulp.dest(''));<br/>});</span></pre><p id="f7ed" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">之后，我们可以创建主模块。将以下代码复制并粘贴到main.mdl.js文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="4e07" class="ln kb hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="9325" class="ln kb hu lj b fv ls lp l lq lr">    angular<br/>        .module('main', [<br/>            'ui.router',<br/>            'ui.bootstrap',<br/>            'ngMask',<br/>            'ngCookies',<br/>            'ngRoute',<br/>            'ngDialog',<br/>            'cr.acl',<br/>            'ui-notification',<br/>            'ngFlash',<br/>            'ngAnimate',<br/>            'textAngular',<br/>            'flow',<br/>            'angular-loading-bar',<br/>            'ngDragDrop',<br/>            'ngSanitize',<br/>            'ngTouch',</span><span id="6583" class="ln kb hu lj b fv ls lp l lq lr">            'portfolio',</span><span id="00f5" class="ln kb hu lj b fv ls lp l lq lr">            'config'<br/>        ])<br/>        .config(config)<br/>        .run(run);</span><span id="ba8b" class="ln kb hu lj b fv ls lp l lq lr">    config.$inject = ['$stateProvider', '$urlRouterProvider', 'cfpLoadingBarProvider', 'NotificationProvider', '$locationProvider'];<br/>    function config($stateProvider, $urlRouterProvider, cfpLoadingBarProvider, NotificationProvider, $locationProvider) {<br/>        cfpLoadingBarProvider.includeSpinner = false;</span><span id="8fb1" class="ln kb hu lj b fv ls lp l lq lr">        NotificationProvider.setOptions({<br/>            startTop: 25,<br/>            startRight: 25,<br/>            verticalSpacing: 20,<br/>            horizontalSpacing: 20,<br/>            positionX: 'right',<br/>            positionY: 'bottom'<br/>        });</span><span id="58b3" class="ln kb hu lj b fv ls lp l lq lr">        $urlRouterProvider.otherwise(function ($injector) {<br/>            var $state = $injector.get("$state");<br/>            $state.go('login');<br/>        });</span><span id="8f86" class="ln kb hu lj b fv ls lp l lq lr">        $stateProvider<br/>            .state('blog', {<br/>                url: '/blog',<br/>                templateUrl: '../blog.html'<br/>            })<br/>            .state('login', {<br/>                url: '/login',<br/>                templateUrl: '../views/auth/login.html',<br/>                controller: 'AuthCtrl as auth',<br/>                onEnter: ['AuthService', 'crAcl', function(AuthService, crAcl) {<br/>                    AuthService.clearCredentials();<br/>                    crAcl.setRole();<br/>                }],<br/>                data: {<br/>                    is_granted: ['ROLE_GUEST']<br/>                }<br/>            })<br/>            .state('register', {<br/>                url: '/register',<br/>                templateUrl: '../views/auth/register.html',<br/>                controller: 'AuthCtrl as auth',<br/>                onEnter: ['AuthService', 'crAcl', function(AuthService, crAcl) {<br/>                    AuthService.clearCredentials();<br/>                    crAcl.setRole();<br/>                }],<br/>                data: {<br/>                    is_granted: ['ROLE_GUEST']<br/>                }<br/>            });</span><span id="ba34" class="ln kb hu lj b fv ls lp l lq lr">    }</span><span id="e048" class="ln kb hu lj b fv ls lp l lq lr">    run.$inject = ['$rootScope', '$cookieStore', '$state', 'crAcl'];<br/>    function run($rootScope, $cookieStore, $state, crAcl) {</span><span id="a7ee" class="ln kb hu lj b fv ls lp l lq lr">        $rootScope.globals = $cookieStore.get('globals') || {};</span><span id="98f1" class="ln kb hu lj b fv ls lp l lq lr">        crAcl<br/>            .setInheritanceRoles({<br/>                'ROLE_ADMIN': ['ROLE_ADMIN', 'ROLE_GUEST'],<br/>                'ROLE_USER': ['ROLE_USER', 'ROLE_GUEST'],<br/>                'ROLE_GUEST': ['ROLE_GUEST']<br/>            });</span><span id="9669" class="ln kb hu lj b fv ls lp l lq lr">        crAcl<br/>            .setRedirect('login');</span><span id="356d" class="ln kb hu lj b fv ls lp l lq lr">        if ($rootScope.globals.currentUser) {<br/>            crAcl.setRole($rootScope.globals.currentUser.role);<br/>            $state.go('portfolio.intro');<br/>        }<br/>        else {<br/>            crAcl.setRole();<br/>        }</span><span id="6cec" class="ln kb hu lj b fv ls lp l lq lr">    }</span><span id="ed15" class="ln kb hu lj b fv ls lp l lq lr">})();</span></pre><p id="daca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们将设置我们的授权控制器。将以下代码复制并粘贴到auth.ctrl.js文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="ebbc" class="ln kb hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="d3c2" class="ln kb hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .controller('AuthCtrl', AuthCtrl);</span><span id="ff8e" class="ln kb hu lj b fv ls lp l lq lr">    function AuthCtrl(crAcl, $state, AuthService, Flash, $log) {<br/>        var vm = this;</span><span id="951e" class="ln kb hu lj b fv ls lp l lq lr">        vm.login = login;<br/>        vm.register = register;</span><span id="52e9" class="ln kb hu lj b fv ls lp l lq lr">        vm.loginForm = null;</span><span id="961e" class="ln kb hu lj b fv ls lp l lq lr">        vm.credentials = {};<br/>        vm.user = {};</span><span id="f3b9" class="ln kb hu lj b fv ls lp l lq lr">        function login(credentials) {<br/>            function success(response) {<br/>                function success(response) {<br/>                    if (response.data.status !== 'empty') {<br/>                        var currentUser = response.data.objects[0];</span><span id="3465" class="ln kb hu lj b fv ls lp l lq lr">                        crAcl.setRole('ROLE_USER');<br/>                        AuthService.setCredentials({<br/>                            slug: currentUser.slug,<br/>                            first_name: currentUser.metadata.first_name,<br/>                            last_name: currentUser.metadata.last_name,<br/>                            email: currentUser.metadata.email,<br/>                            role: 'ROLE_USER'<br/>                        });<br/>                        $state.go('portfolio.intro', {slug: currentUser.slug});<br/>                    }<br/>                    else<br/>                        Flash.create('danger', 'Incorrect username or password');<br/>                }</span><span id="5baf" class="ln kb hu lj b fv ls lp l lq lr">                function failed(response) {<br/>                    $log.error(response);<br/>                }</span><span id="703f" class="ln kb hu lj b fv ls lp l lq lr">                if (response.data.status !== 'empty')<br/>                    AuthService<br/>                        .checkPassword(credentials)<br/>                        .then(success, failed);<br/>                else<br/>                    Flash.create('danger', 'Incorrect username or password');</span><span id="7f1d" class="ln kb hu lj b fv ls lp l lq lr">                $log.info(response);<br/>            }</span><span id="5fb4" class="ln kb hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="9949" class="ln kb hu lj b fv ls lp l lq lr">            if (vm.loginForm.$valid)<br/>                AuthService<br/>                    .checkUsername(credentials)<br/>                    .then(success, failed);<br/>        }</span><span id="2d9e" class="ln kb hu lj b fv ls lp l lq lr">        function register(credentials) {<br/>            function success(response) {<br/>                login(credentials);</span><span id="d064" class="ln kb hu lj b fv ls lp l lq lr">                $log.info(response);<br/>            }</span><span id="14d4" class="ln kb hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="8f43" class="ln kb hu lj b fv ls lp l lq lr">            if (vm.loginForm.$valid)<br/>                AuthService<br/>                    .register(credentials)<br/>                    .then(success, failed);<br/>        }</span><span id="bc6d" class="ln kb hu lj b fv ls lp l lq lr">    }<br/>})();</span></pre><p id="08a8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建授权服务，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="7d28" class="ln kb hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="ac65" class="ln kb hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .service('AuthService', function ($http,<br/>                                          $cookieStore,<br/>                                          $q,<br/>                                          $rootScope,<br/>                                          URL, BUCKET_SLUG, READ_KEY, WRITE_KEY) {<br/>            var authService = this;<br/>            $http.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';</span><span id="0887" class="ln kb hu lj b fv ls lp l lq lr">            authService.checkUsername = function (credentials) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object-type/users/search', {<br/>                    params: {<br/>                        metafield_key: 'email',<br/>                        metafield_value_has: credentials.email,<br/>                        limit: 1,<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            authService.checkPassword = function (credentials) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object-type/users/search', {<br/>                    ignoreLoadingBar: true,<br/>                    params: {<br/>                        metafield_key: 'password',<br/>                        metafield_value: credentials.password,<br/>                        limit: 1,<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.register = function (user) {<br/>                return $http.post(URL + BUCKET_SLUG + '/add-object', {<br/>                        title: user.first_name + ' ' + user.last_name,<br/>                        type_slug: 'users',<br/>                        slug: user.username,<br/>                        metafields: [<br/>                            {<br/>                                key: "first_name",<br/>                                type: "text",<br/>                                value: user.first_name<br/>                            },<br/>                            {<br/>                                key: "last_name",<br/>                                type: "text",<br/>                                value: user.last_name<br/>                            },<br/>                            {<br/>                                key: "email",<br/>                                type: "text",<br/>                                value: user.email<br/>                            },<br/>                            {<br/>                                key: "password",<br/>                                type: "text",<br/>                                value: user.password<br/>                            },<br/>                            {<br/>                                key: "intro",<br/>                                type: "html-textarea",<br/>                                value: null<br/>                            },<br/>                            {<br/>                                key: "about",<br/>                                type: "html-textarea",<br/>                                value: null<br/>                            },<br/>                            {<br/>                                key: "contact",<br/>                                type: "html-textarea",<br/>                                value: null<br/>                            },<br/>                            {<br/>                                key: "projects",<br/>                                type: "objects",<br/>                                objects: [],<br/>                                object_type: "projects",<br/>                                value: null<br/>                            }<br/>                        ],</span><span id="3706" class="ln kb hu lj b fv ls lp l lq lr">                        write_key: WRITE_KEY<br/>                    }, { ignoreLoadingBar: false });<br/>            };<br/>            authService.setCredentials = function (user) {<br/>                $rootScope.globals = {<br/>                    currentUser: user<br/>                };</span><span id="5450" class="ln kb hu lj b fv ls lp l lq lr">                $cookieStore.put('globals', $rootScope.globals);<br/>            };<br/>            authService.clearCredentials = function () {<br/>                var deferred = $q.defer();<br/>                $cookieStore.remove('globals');</span><span id="57e4" class="ln kb hu lj b fv ls lp l lq lr">                if (!$cookieStore.get('globals')) {<br/>                    $rootScope.globals = {};<br/>                    deferred.resolve('Credentials clear success');<br/>                } else {<br/>                    deferred.reject('Can\'t clear credentials');<br/>                }</span><span id="d0e0" class="ln kb hu lj b fv ls lp l lq lr">                return deferred.promise;<br/>            };<br/>        });<br/>})();</span></pre><h1 id="d76f" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">这是怎么回事:</h1><ol class=""><li id="0171" class="lt lu hu je b jf ky jj kz jn lv jr lw jv lx jz ly lz ma mb dt translated">我们使用ui路由器来配置路由。</li><li id="50eb" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们为对我们的Cosmic JS API的异步调用创建了Auth Service。</li><li id="c148" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们创建了Auth Controller来检查凭证和注册用户。</li></ol><p id="fa29" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为获取和更新用户创建用户服务，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="0f6a" class="ln kb hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="8b47" class="ln kb hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .service('UserService', function ($http,<br/>                                          $cookieStore,<br/>                                          $q,<br/>                                          $rootScope,<br/>                                          URL, BUCKET_SLUG, READ_KEY, WRITE_KEY) {<br/>            $http.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';</span><span id="06b0" class="ln kb hu lj b fv ls lp l lq lr">            this.getCurrentUser = function (ignoreLoadingBar) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object/' + $rootScope.globals.currentUser.slug, {<br/>                    ignoreLoadingBar: ignoreLoadingBar,<br/>                    params: {<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.getUser = function (slug, ignoreLoadingBar) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object/' + slug, {<br/>                    ignoreLoadingBar: ignoreLoadingBar,<br/>                    params: {<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.updateUser = function (user) {<br/>                user.write_key = WRITE_KEY;</span><span id="0c1a" class="ln kb hu lj b fv ls lp l lq lr">                return $http.put(URL + BUCKET_SLUG + '/edit-object', user, {<br/>                    ignoreLoadingBar: false<br/>                });<br/>            };</span><span id="c2ef" class="ln kb hu lj b fv ls lp l lq lr">        });<br/>})();</span></pre><p id="a930" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为获取和更新创建组合服务，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="a5d4" class="ln kb hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="18e6" class="ln kb hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .service('PortfolioService', function ($http,<br/>                                          $cookieStore,<br/>                                          $q,<br/>                                          $rootScope,<br/>                                          URL, BUCKET_SLUG, READ_KEY, WRITE_KEY, MEDIA_URL) {</span><span id="1c69" class="ln kb hu lj b fv ls lp l lq lr">            $http.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';</span><span id="fc4e" class="ln kb hu lj b fv ls lp l lq lr">            this.getPortfolioBySlug = function (slug) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object/' + slug, {<br/>                    params: {<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };</span><span id="ecf5" class="ln kb hu lj b fv ls lp l lq lr">            this.updatePortfolio = function (portfolio) {<br/>                portfolio.write_key = WRITE_KEY;</span><span id="bd77" class="ln kb hu lj b fv ls lp l lq lr">                return $http.put(URL + BUCKET_SLUG + '/edit-object', portfolio);<br/>            };</span><span id="9aa3" class="ln kb hu lj b fv ls lp l lq lr">            this.upload = function (file) {<br/>                var fd = new FormData();<br/>                fd.append('media', file);<br/>                fd.append('write_key', WRITE_KEY);</span><span id="31fb" class="ln kb hu lj b fv ls lp l lq lr">                var defer = $q.defer();</span><span id="829f" class="ln kb hu lj b fv ls lp l lq lr">                var xhttp = new XMLHttpRequest();</span><span id="b902" class="ln kb hu lj b fv ls lp l lq lr">                xhttp.upload.addEventListener("progress",function (e) {<br/>                    defer.notify(parseInt(e.loaded * 100 / e.total));<br/>                });<br/>                xhttp.upload.addEventListener("error",function (e) {<br/>                    defer.reject(e);<br/>                });</span><span id="d4d8" class="ln kb hu lj b fv ls lp l lq lr">                xhttp.onreadystatechange = function() {<br/>                    if (xhttp.readyState === 4) {<br/>                        defer.resolve(JSON.parse(xhttp.response)); //Outputs a DOMString by default<br/>                    }<br/>                };</span><span id="5910" class="ln kb hu lj b fv ls lp l lq lr">                xhttp.open("post", MEDIA_URL, true);</span><span id="3ac3" class="ln kb hu lj b fv ls lp l lq lr">                xhttp.send(fd);</span><span id="4b52" class="ln kb hu lj b fv ls lp l lq lr">                return defer.promise;<br/>            }<br/>        });<br/>})();</span></pre><p id="d50b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建投资组合控制器，用于更新和添加、编辑项目，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="a3ce" class="ln kb hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="4e6a" class="ln kb hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .controller('PortfolioCtrl', PortfolioCtrl);</span><span id="e377" class="ln kb hu lj b fv ls lp l lq lr">    function PortfolioCtrl($rootScope, $stateParams, $sce, $scope, $state, ngDialog, AuthService, UserService, PortfolioService, $log) {<br/>        var vm = this;</span><span id="228e" class="ln kb hu lj b fv ls lp l lq lr">        getPortfolio();</span><span id="1ad4" class="ln kb hu lj b fv ls lp l lq lr">        vm.currentUser = $rootScope.globals.currentUser ? $rootScope.globals.currentUser : getUser();</span><span id="952f" class="ln kb hu lj b fv ls lp l lq lr">        vm.logout = logout;<br/>        vm.updatePortfolio = updatePortfolio;<br/>        vm.openAddProjectDialog = openAddProjectDialog;<br/>        vm.openEditProjectDialog = openEditProjectDialog;</span><span id="78af" class="ln kb hu lj b fv ls lp l lq lr">        vm.portfolio = {};</span><span id="de2c" class="ln kb hu lj b fv ls lp l lq lr">        vm.toolbarEditor = [<br/>            ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'bold', 'italics', 'underline', 'justifyLeft', 'justifyCenter', 'justifyRight']<br/>        ];</span><span id="98f3" class="ln kb hu lj b fv ls lp l lq lr">        function chunk(arr, size) {<br/>            var newArr = [];<br/>            for (var i = 0; i &lt; arr.length; i += size) {<br/>                newArr.push(arr.slice(i, i + size));<br/>            }<br/>            return newArr;<br/>        }</span><span id="151d" class="ln kb hu lj b fv ls lp l lq lr">        function getUser() {<br/>            function success(response) {<br/>                var currentUser = response.data.object;</span><span id="c3c3" class="ln kb hu lj b fv ls lp l lq lr">                vm.currentUser = {<br/>                    slug: currentUser.slug,<br/>                    first_name: currentUser.metadata.first_name,<br/>                    last_name: currentUser.metadata.last_name,<br/>                    email: currentUser.metadata.email<br/>                };<br/>            }</span><span id="a4ae" class="ln kb hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="b3de" class="ln kb hu lj b fv ls lp l lq lr">            UserService<br/>                .getUser($stateParams.slug, true)<br/>                .then(success, failed);<br/>        }</span><span id="4e05" class="ln kb hu lj b fv ls lp l lq lr">        function getPortfolio() {<br/>            function success(response) {<br/>                vm.portfolio = response.data.object;</span><span id="0a70" class="ln kb hu lj b fv ls lp l lq lr">                if (Array.isArray(vm.portfolio.metadata.projects))<br/>                    vm.projectsChunk = chunk(vm.portfolio.metadata.projects, 2);<br/>                else<br/>                    vm.projectsChunk = [];</span><span id="9f35" class="ln kb hu lj b fv ls lp l lq lr">                vm.contact = $sce.trustAsResourceUrl('mailto:' + vm.currentUser.email);</span><span id="e4ab" class="ln kb hu lj b fv ls lp l lq lr">                $log.info(response);<br/>            }</span><span id="4216" class="ln kb hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="53dd" class="ln kb hu lj b fv ls lp l lq lr">            PortfolioService<br/>                .getPortfolioBySlug($stateParams.slug)<br/>                .then(success, failed);<br/>        }</span><span id="d026" class="ln kb hu lj b fv ls lp l lq lr">        function updatePortfolio() {<br/>            function success(response) {<br/>                getPortfolio();</span><span id="ee5f" class="ln kb hu lj b fv ls lp l lq lr">                $log.info(response);<br/>            }</span><span id="dcc5" class="ln kb hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="2b05" class="ln kb hu lj b fv ls lp l lq lr">            PortfolioService<br/>                .updatePortfolio(vm.portfolio)<br/>                .then(success, failed);<br/>        }</span><span id="924e" class="ln kb hu lj b fv ls lp l lq lr">        function openAddProjectDialog(slug) {</span><span id="3b8d" class="ln kb hu lj b fv ls lp l lq lr">            var options = {<br/>                templateUrl: '../views/portfolio/portfolio.project.edit.html',<br/>                showClose: true,<br/>                controller: 'PortfolioProjectsAddCtrl as vm'<br/>            };</span><span id="0063" class="ln kb hu lj b fv ls lp l lq lr">            ngDialog.open(options).closePromise.finally(function () {<br/>                getPortfolio();<br/>            });<br/>        }</span><span id="e0cc" class="ln kb hu lj b fv ls lp l lq lr">        function openEditProjectDialog(slug) {</span><span id="23bf" class="ln kb hu lj b fv ls lp l lq lr">            var options = {<br/>                templateUrl: '../views/portfolio/portfolio.project.edit.html',<br/>                showClose: true,<br/>                controller: 'PortfolioProjectsEditCtrl as vm',<br/>                data: {<br/>                    slug: slug<br/>                }<br/>            };</span><span id="c0f0" class="ln kb hu lj b fv ls lp l lq lr">            ngDialog.open(options).closePromise.finally(function () {<br/>                getPortfolio();<br/>            });<br/>        }</span><span id="d92a" class="ln kb hu lj b fv ls lp l lq lr">        function logout() {<br/>            function success(response) {<br/>                $state.go('auth');</span><span id="c332" class="ln kb hu lj b fv ls lp l lq lr">                $log.info(response);<br/>            }</span><span id="f3d0" class="ln kb hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="7f9a" class="ln kb hu lj b fv ls lp l lq lr">            AuthService<br/>                .clearCredentials()<br/>                .then(success, failed);<br/>        }</span><span id="30f0" class="ln kb hu lj b fv ls lp l lq lr">        $scope.state = $state;</span><span id="3b22" class="ln kb hu lj b fv ls lp l lq lr">    }<br/>})();</span></pre><p id="9bd3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建投资组合模块，复制并粘贴下面的代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="38b1" class="ln kb hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="cfee" class="ln kb hu lj b fv ls lp l lq lr">    angular<br/>        .module('portfolio', [<br/>            'portfolio.intro',<br/>            'portfolio.projects',<br/>            'portfolio.about',<br/>            'portfolio.contact',<br/>            'portfolio.settings'<br/>        ])<br/>        .config(config);</span><span id="3dfb" class="ln kb hu lj b fv ls lp l lq lr">    config.$inject = ['$stateProvider'];<br/>    function config($stateProvider) {</span><span id="b120" class="ln kb hu lj b fv ls lp l lq lr">        $stateProvider<br/>            .state('portfolio', {<br/>                url: '/:slug/',<br/>                abstract: true,<br/>                templateUrl: '../views/portfolio/portfolio.html',<br/>                controller: 'PortfolioCtrl as vm',<br/>                data: {<br/>                    is_granted: ['ROLE_USER', 'ROLE_GUEST']<br/>                }<br/>            });<br/>    }<br/>})();</span></pre><h1 id="52a2" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">这是怎么回事:</h1><ol class=""><li id="fbe1" class="lt lu hu je b jf ky jj kz jn lv jr lw jv lx jz ly lz ma mb dt translated">我们为获取和更新创建了组合服务。</li><li id="d968" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们为更新和添加，编辑项目创建了投资组合控制器。</li><li id="1b48" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们创建了投资组合模块。</li></ol><p id="3a58" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建用于获取作者信息的作者控制器，复制并粘贴以下代码:</p><h1 id="a8cb" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">结论:</h1><p id="0008" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">我们能够使用我们的动作和调度程序函数来消费Cosmic JS API。我希望你和我一样喜欢这个教程，如果你有任何问题<a class="ae ld" href="https://twitter.com/cosmic_js" rel="noopener ugc nofollow" target="_blank">在Twitter上联系我们</a>和<a class="ae ld" href="https://cosmicjs.com/community" rel="noopener ugc nofollow" target="_blank">加入我们的Slack社区</a>。</p></div></div>    
</body>
</html>