# 理解 JS:强制

> 原文：<https://medium.com/hackernoon/understanding-js-coercion-ff5684475bfc>

![](img/a5d80f9ae02ec001221bf3dbc4461938.png)

由于数量惊人的库、工具和各种各样的东西使你的开发变得更容易，许多程序员在没有深入了解某些东西如何工作的情况下就开始构建应用程序。JavaScript 就是这种行为的典型代表。虽然它是最复杂和传播最广的语言之一，但许多开发人员被吸引到使用更高级的工具和抽象掉语言的“不好的部分”。

虽然您仍然能够构建令人惊叹的应用程序，但是进入 JavaScript maelstrom 对您非常有益。理解“奇怪的部分”是普通普通程序员和高级开发人员的区别，虽然 JS 生态系统是不断变化的，但基础是所有其他工具构建的基础。理解这些会给你一个更广阔的视野，并改变你看待开发过程的方式。

# 什么是强制？

**强制**是 JavaScript 中用于*意外类型转换*的术语。通常，当您处理数据时，您需要将其从一种数据类型转换为另一种数据类型，这是每个开发人员每天都要做的事情。**强制**是指那些作为不同操作的副作用而发生的不明显的类型强制转换。

大多数人认为这让他们的生活更加艰难。有些人认为这是语言设计中的一个流程，并试图避免它。然而，我建议我们进行更深入的研究，理解它是如何工作的，并拥抱 JS 的混乱。除非您想编写自己的 JavaScript 引擎，否则您很可能不得不使用强制方法。即使你决定尽可能地避免它，知道解决什么和如何解决也是很重要的。

当然，如果处理不当，强制可能是破坏性的，会导致代码库中不必要的错误和复杂性。但是现在，让我们关注另一个观点——为了简化我们的代码并去掉那些会使我们的代码更混乱的不必要的样板文件，强制是必要的。

# 字符串和数字

让我们从简单的开始——如何将数字和字符串结合起来？我们如何把一个数字变成一个字符串，反之亦然？将数字转换成字符串最简单也是最常用的方法是使用 **+** 操作符。

```
14 + "" // "14"
```

每当您使用“ **+** ”或“ **-** ”时，您要加或减的值必须是同一类型。在上面的例子中，他们显然不是。所以接下来会发生的是，JS 会尝试将它们拉平——在这种情况下，将我们的数字转换为一个字符串，然后将它们加在一起。换句话说，每个包含字符串的“ **+** ”表达式都会产生一个字符串。

```
42 + "0" // "420"
```

我们可以使用“ **+** ”来连接字符串，但是如果我们使用“ **-** ”会发生什么？它只能用于数字，所以 JS 会再次将值转换为相同的类型——这次是数字。

```
"42" - 7 // 35
"42" - 0 // 42
"42" - "9" // 33
```

好吧，这并不难，但总有一个陷阱。让我们尝试将两个数组相加，看看会发生什么:

```
["alex", "sam"] + ["jon", "mary"] // "alex,samjon,mary"
```

等等，刚刚发生了什么？现在，无论何时使用“ **+** ”操作符，如果其中一个已经是字符串，那么这些值将会连接起来，或者如果可能的话，它们将被转换为字符串。因此，您得到两个数组的字符串表示，然后将它们相加。一旦你理解了它，它就是合乎逻辑的，但是当它出乎意料地发生时，它会导致失望。

另一个有趣的例子是当我们使用“ **-** ”操作符时会发生什么。正如我前面提到的，它只保留给数字类型，所以有用的 JavaScript 语言会将值转换为数字(如果可能的话)，然后对结果值执行该操作。

```
[3] - [1] // 2
["alex", "sam"] - ["jon", "mary"] // NaN
```

JavaScript 只是尽可能地为您节省一些时间。一些开发人员希望它能像其他语言一样工作，这让他们对结果不满意。您对 JS 细节越熟悉，您在代码中引入的错误就越少。

# **布尔型**

这无疑给更有经验的开发者带来了麻烦。布尔强制通常用在 if 语句、循环检查、三元和逻辑运算符中。当你使用其中一个变量时，如果变量不是布尔值，它将被强制为 1。更重要的是，逻辑表达式的结果不一定是布尔值，而是所使用的两个操作数之一的值。也许举个例子会更好:

```
const a = 100
const b = "test"
const c = nulla || b // 100
a && b // "test"a || c // 100
a && c // nullb || c // "test"
b && c // null
```

我们来分析一下这是怎么回事。例如，来自其他语言的开发人员在条件检查中使用它时，可能希望它返回 true 或 false。事实上你得到的是其中一个操作数的值。

当您使用 **||** 操作符时，如果第一个值转换为 true，您将得到该值的返回值。否则，你总会得到第二个。在& &的情况下，如果都被强制为真，你将总是得到第二个值**。如果第一个转换为 false，那么你将得到它的返回值。**

现在，您可能正在思考 JavaScript 语言的缺陷，并考虑您的职业选择，但让我提醒您，这与您在 Python 和 Ruby 中得到的行为完全相同(令人惊讶)。它们的继承实现也以类似于原型继承的方式运行，但是这是一个不同的主题。

那么，这为什么有用呢？经常可以看到这样初始化变量:

```
function greet (name) {
    name = name || 'visitor'
    console.log(`Hello, ${name}!`)
}greet() // Hello, visitor!
```

在这里，我们使用这种确切的行为来检查一个值是否丢失，如果是，则分配另一个值。你可以在许多代码库中看到这一点。顺便提一下，在 ES6 中，您可以直接在函数参数中定义默认值，以避免在函数开始时检查所有传递的值。

# 平等

当谈到强制时，我们还必须提到等式运算符以及对它们的常见误解。流行的解释是 **==** 比较值而不检查类型 **===** 比较值和类型。虽然这是解释正在发生的事情的简单方法，但它并不完全正确。

正如我们前面提到的，一些操作不能在不同类型的值上运行，所以幕后的 JavaScript 将使用强制来使我们的生活更容易。每当我们使用 **==** 比较两个值时，JavaScript 将使用强制转换将值转换为相同的类型。另一方面，当我们使用严格的等式 **===** 时，JS 不会对值进行类型转换(这意味着如果它们属于不同的类型，它们就不相等)。

简单来说， **==** 是允许强制的比较，**= =**是没有强制的比较。

```
42 == "42" // true
42 === "42" // false
```

# 结论

总之，作为 JS 开发人员，强制是您每天都会遇到的事情，所以理解它是至关重要的。本文中的信息足以让您有一个大致的了解，但是关于 JavaScript 这种有用的语言的本质，还有很多东西需要学习。

如果你对更多的 JS 相关内容感兴趣，你可以从 [***这里***](https://buttondown.email/kondov) 订阅我的时事通讯，或者你可以看看同一系列的其他文章:

[](https://hackernoon.com/understanding-javascript-scope-1d4a74adcdf5) [## 理解 JavaScript:范围

### 由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…

hackernoon.com](https://hackernoon.com/understanding-javascript-scope-1d4a74adcdf5) [](https://hackernoon.com/understanding-javascript-prototype-and-inheritance-d55a9a23bde2) [## 理解 JavaScript:原型和继承

### 由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…

hackernoon.com](https://hackernoon.com/understanding-javascript-prototype-and-inheritance-d55a9a23bde2) [](https://hackernoon.com/understanding-javascript-the-this-keyword-4de325d77f68) [## 理解 JavaScript:这个关键字

### 由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…

hackernoon.com](https://hackernoon.com/understanding-javascript-the-this-keyword-4de325d77f68) [](https://hackernoon.com/understanding-javascript-new-keyword-ec67c8caaa74) [## 理解 JavaScript:新关键字

### 由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…

hackernoon.com](https://hackernoon.com/understanding-javascript-new-keyword-ec67c8caaa74) [](https://hackernoon.com/understanding-js-coercion-ff5684475bfc) [## 理解 JS:强制

### 由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…

hackernoon.com](https://hackernoon.com/understanding-js-coercion-ff5684475bfc) [](https://hackernoon.com/understanding-js-the-event-loop-959beae3ac40) [## 理解 JS:事件循环

### 由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…

hackernoon.com](https://hackernoon.com/understanding-js-the-event-loop-959beae3ac40)