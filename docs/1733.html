<html>
<head>
<title>Three Bytes and a Space</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">三个字节和一个空格</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/three-bytes-and-a-space-8f9fbd1c669b?source=collection_archive---------2-----------------------#2016-12-03">https://medium.com/hackernoon/three-bytes-and-a-space-8f9fbd1c669b?source=collection_archive---------2-----------------------#2016-12-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="b7ac" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">或者说，铁锈bug，不合规，还有我是怎么学会爱上IRC的。</h2></div><p id="be2b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在过去的几周里，我一直在用Rust做实验，经常在我工作的间隙学习。在尝试了一段时间并熟悉了这种语言之后，我拼命地寻找一个项目。在我的搜索中，我想到了一个我们在工作场所使用的脚本，为了这个故事的目的，我将它称为<code class="eh kg kh ki kj b">snap.py</code>。</p><p id="e1f2" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh kg kh ki kj b">snap.py</code>是一个使用非常简单的<a class="ae kf" href="https://hackernoon.com/tagged/python" rel="noopener ugc nofollow" target="_blank"> Python </a>脚本:访问几个带有表格的网页，检查其中的表格，并从每行的列中提取数据。它收集它们，记录它们，然后输出到终端。这似乎很简单。然而，它有几个问题让我不太满意:</p><ul class=""><li id="b234" class="kk kl hu jl b jm jn jp jq js km jw kn ka ko ke kp kq kr ks dt translated">由于Python的<a class="ae kf" href="https://wiki.python.org/moin/GlobalInterpreterLock" rel="noopener ugc nofollow" target="_blank"> GIL </a>，没有真正的多线程</li><li id="645c" class="kk kl hu jl b jm kt jp ku js kv jw kw ka kx ke kp kq kr ks dt translated">由于为每一行创建对象，导致内存占用</li><li id="a21e" class="kk kl hu jl b jm kt jp ku js kv jw kw ka kx ke kp kq kr ks dt translated">低内存系统上的颠簸</li><li id="04f2" class="kk kl hu jl b jm kt jp ku js kv jw kw ka kx ke kp kq kr ks dt translated">由于其工作负载，运行相当缓慢</li></ul><p id="bb32" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">坐在办公桌前，我心想Rust也许能解决许多问题，如果不是所有问题的话。如果它足够好，它甚至会吸引我开发团队中的前辈的目光。</p><p id="041a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">因此，在我漫长而平静的工作转变中:</p><pre class="ky kz la lb fq lc kj ld le aw lf dt"><span id="86f4" class="lg lh hu kj b fv li lj l lk ll">cargo new --bin snaprs</span></pre><h1 id="6b60" class="lm lh hu bd ln lo lp lq lr ls lt lu lv ja lw jb lx jd ly je lz jg ma jh mb mc dt translated">旅程开始了</h1><p id="a1ef" class="pw-post-body-paragraph jj jk hu jl b jm md iv jo jp me iy jr js mf ju jv jw mg jy jz ka mh kc kd ke hn dt translated">我想我应该从分别使用<code class="eh kg kh ki kj b">reqwest</code>和<code class="eh kg kh ki kj b">kuchiki</code>下载数据和解析数据开始。我的脚本开始时相当简单:</p><pre class="ky kz la lb fq lc kj ld le aw lf dt"><span id="c1e0" class="lg lh hu kj b fv li lj l lk ll">extern crate kuchiki;<br/>extern crate reqwest;</span><span id="0945" class="lg lh hu kj b fv mi lj l lk ll">use std::io::Read;<br/>use kuchiki::parse_html;<br/>use kuchiki::traits::*;<br/>use reqwest::get;</span><span id="2c4c" class="lg lh hu kj b fv mi lj l lk ll">static URL: &amp;’static str = “<a class="ae kf" href="http://internal.company.url/table1" rel="noopener ugc nofollow" target="_blank">http://internal.company.url/table1</a>";</span><span id="008a" class="lg lh hu kj b fv mi lj l lk ll">fn main() {<br/> <br/> let mut response = get(URL).unwrap();<br/> let mut body = String::new();<br/> response.read_to_string(&amp;mut body).unwrap();</span><span id="877e" class="lg lh hu kj b fv mi lj l lk ll">}</span></pre><p id="070b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我认为这是一个停下来编译的好地方，因为如果没有别的，我不可能把这个搞砸。</p><pre class="ky kz la lb fq lc kj ld le aw lf dt"><span id="2606" class="lg lh hu kj b fv li lj l lk ll">thread ‘main’ panicked at ‘called `Result::unwrap()` on an `Err` value: Http(Status)’, src/libcore/result.rs:799</span></pre><figure class="ky kz la lb fq ml fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/d38911f54cdad88ef80f495af79ca237.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*z6-m9n0Mb-KpkHrptqNbsw.png"/></div></figure><h1 id="02d2" class="lm lh hu bd ln lo lp lq lr ls lt lu lv ja lw jb lx jd ly je lz jg ma jh mb mc dt translated">掉进兔子洞</h1><p id="0663" class="pw-post-body-paragraph jj jk hu jl b jm md iv jo jp me iy jr js mf ju jv jw mg jy jz ka mh kc kd ke hn dt translated">我注释掉了<code class="eh kg kh ki kj b">body</code>的行，删除了<code class="eh kg kh ki kj b">response</code>上的<code class="eh kg kh ki kj b">unwrap()</code>，并编写了一个快速的小<code class="eh kg kh ki kj b">match</code>函数来输出我得到的错误消息。忽略警告消息:</p><pre class="ky kz la lb fq lc kj ld le aw lf dt"><span id="9e63" class="lg lh hu kj b fv li lj l lk ll">$ cargo run<br/>   Compiling snaprs v0.1.0 (file:///path/to/snaprs)<br/>   Finished debug [unoptimized + debuginfo] target(s) in 2.27 secs<br/>   Running `target/debug/snaprs`<br/> Invalid Status provided</span></pre><p id="c26f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">根据<code class="eh kg kh ki kj b">reqwest</code>的文档，通过扩展<code class="eh kg kh ki kj b">hyper</code>，当HTTP客户端接收到非标准的HTTP状态代码时，会返回此错误消息。即使通过使用<code class="eh kg kh ki kj b">reqwest::Client::new()</code>创建一个合适的客户端，甚至求助于使用<code class="eh kg kh ki kj b">hyper</code>，我仍然会得到同样的错误。</p><p id="9f0d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">作为健全性检查，我下降到<code class="eh kg kh ki kj b">ipython</code>，导入<code class="eh kg kh ki kj b">requests</code>，测试相同的URL，它接收到一个200，并且下载数据没有问题。打开开发者工具，在我的网络浏览器中加载URL，我可以看到页面正在下载和渲染，同样是200。最后，使用<code class="eh kg kh ki kj b">curl</code>，我能够确认同一个页面的响应标题显示我收到了一个200。只有生锈是我失败的原因。</p><p id="7941" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">沮丧和慌乱中，我上了IRC，请求# rust-初学者的帮助。有一些基本的故障排除和解释我的情况，我不会让每个人都阅读。大多数故障诊断都是由我通过chat的指导完成的，因为它访问了我公司内部的一个web服务器。最终，我们开始让我使用<code class="eh kg kh ki kj b">strace</code>测试，看看<code class="eh kg kh ki kj b">snaprs</code>实际接收到了什么。借助一点帮助:</p><pre class="ky kz la lb fq lc kj ld le aw lf dt"><span id="d198" class="lg lh hu kj b fv li lj l lk ll">JoshTriplett - bushidoboy: So, the response you got seems completely reasonable; it has a valid status.</span><span id="5068" class="lg lh hu kj b fv mi lj l lk ll">JoshTriplett - bushidoboy: “HTTP/1.1 200\r\n”</span><span id="0016" class="lg lh hu kj b fv mi lj l lk ll">[Truncated]</span><span id="f564" class="lg lh hu kj b fv mi lj l lk ll">JoshTriplett - bushidoboy: So, the error from hyper means that it thought it got an invalid status code.</span><span id="8f51" class="lg lh hu kj b fv mi lj l lk ll">JoshTriplett - bushidoboy: That error in turn gets set from httparse.</span><span id="67b6" class="lg lh hu kj b fv mi lj l lk ll">bushidoboy - Yeah, I just don’t know why it looks at a 200 and thinks it’s an error</span><span id="0668" class="lg lh hu kj b fv mi lj l lk ll">bushidoboy - Like, that’s the literal HTTP textbook definition of success</span></pre><p id="b000" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">至少，当我知道我得到了200分时，我确实感觉好了一点。现在，剩下的就是找出<em class="mj">为什么</em>对客户来说不够好。发生了什么事？怎么回事？</p><pre class="ky kz la lb fq lc kj ld le aw lf dt"><span id="ef0b" class="lg lh hu kj b fv li lj l lk ll">JoshTriplett - httparse’s parse_code just reads three literal bytes and expects something in the range 000–999.</span><span id="07b6" class="lg lh hu kj b fv mi lj l lk ll">JoshTriplett - Wait, no…</span><span id="9aa6" class="lg lh hu kj b fv mi lj l lk ll">JoshTriplett - Oh. </span><span id="1d73" class="lg lh hu kj b fv mi lj l lk ll">JoshTriplett - Hang on, I think I might have figured it out.</span></pre><p id="8c82" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我在座位的边缘。我已经下班很久了，一直在等着找出这一切的潜在问题。</p><p id="fa40" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们终于来了。</p><p id="8268" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">就是这个。</p><pre class="ky kz la lb fq lc kj ld le aw lf dt"><span id="24e1" class="lg lh hu kj b fv li lj l lk ll">JoshTriplett - bushidoboy: “200” is not the textbook definition of success. “200 OK” is. :)</span></pre><p id="bf55" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">…就这样？</p><pre class="ky kz la lb fq lc kj ld le aw lf dt"><span id="ec66" class="lg lh hu kj b fv li lj l lk ll">JoshTriplett - bushidoboy: httparse chokes on the lack of a space after 200.</span><span id="e3c2" class="lg lh hu kj b fv mi lj l lk ll">JoshTriplett - bushidoboy: curl, on the other hand, puts up with it.</span><span id="bb80" class="lg lh hu kj b fv mi lj l lk ll">JoshTriplett - bushidoboy: You’re not *required* to use the literal string “OK”, but you have to have a space and then a “reason”.</span><span id="c2fa" class="lg lh hu kj b fv mi lj l lk ll">JoshTriplett - bushidoboy: <a class="ae kf" href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec6.html#sec6.1" rel="noopener ugc nofollow" target="_blank">https://www.w3.org/Protocols/rfc2616/rfc2616-sec6.html#sec6.1</a></span><span id="6d3b" class="lg lh hu kj b fv mi lj l lk ll">JoshTriplett - bushidoboy: No provision for leaving out the last SP.</span><span id="cca4" class="lg lh hu kj b fv mi lj l lk ll">* misdreavus *slow clap*</span></pre><p id="5351" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">读着这些文字，我沉思着，这个简单的失败实际上代表了我到目前为止的生活。</p><figure class="ky kz la lb fq ml fe ff paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="fe ff mo"><img src="../Images/3a50cc620df71f122a5ff699d906e992.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v9E9u1TCimNv2jYCy2aBrg.jpeg"/></div></div></figure><h1 id="07f1" class="lm lh hu bd ln lo lp lq lr ls lt lu lv ja lw jb lx jd ly je lz jg ma jh mb mc dt translated">但是等等！还有呢！</h1><p id="468d" class="pw-post-body-paragraph jj jk hu jl b jm md iv jo jp me iy jr js mf ju jv jw mg jy jz ka mh kc kd ke hn dt translated">虽然我仍然很沮丧，但我很高兴知道这不是我自己的错。但对我来说很奇怪的是，在我使用过的<code class="eh kg kh ki kj b">reqwest</code>中，这是我第一次遇到非标准的错误代码。我测试过的开放互联网上的其他网站都没有这个问题。</p><p id="5699" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后我突然想到:</p><pre class="ky kz la lb fq lc kj ld le aw lf dt"><span id="50d6" class="lg lh hu kj b fv li lj l lk ll">bushidoboy - Oh goodness.</span><span id="4f4e" class="lg lh hu kj b fv mi lj l lk ll">bushidoboy - You just reminded me</span><span id="5c12" class="lg lh hu kj b fv mi lj l lk ll">bushidoboy - We run a custom server we forked.</span><span id="d386" class="lg lh hu kj b fv mi lj l lk ll">wyvern - yikes.</span></pre><p id="3a72" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">没错。我们内部开发的服务器返回不兼容的HTTP状态行。一天两个虫子。一个在<code class="eh kg kh ki kj b">httparse</code>中，一个在我公司的定制网络服务器上。我不觉得自己很特别吗？</p><p id="0da6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"># rust-初学者的居民也非常同情我的困境。</p><pre class="ky kz la lb fq lc kj ld le aw lf dt"><span id="3e1c" class="lg lh hu kj b fv li lj l lk ll">misdreavus - this just keeps getting better and better</span><span id="bf9d" class="lg lh hu kj b fv mi lj l lk ll">* misdreavus reaches for the popcorn</span><span id="07fc" class="lg lh hu kj b fv mi lj l lk ll">JoshTriplett - httpopcorn</span><span id="c419" class="lg lh hu kj b fv mi lj l lk ll">* cmyr : refills popcorn</span><span id="80a9" class="lg lh hu kj b fv mi lj l lk ll">Xion - HTTP POP /corn</span></pre><h1 id="106b" class="lm lh hu bd ln lo lp lq lr ls lt lu lv ja lw jb lx jd ly je lz jg ma jh mb mc dt translated">结论</h1><p id="1eea" class="pw-post-body-paragraph jj jk hu jl b jm md iv jo jp me iy jr js mf ju jv jw mg jy jz ka mh kc kd ke hn dt translated">这就是我第一次真正报告Rust错误的故事的结尾。我已经提交了一个关于<code class="eh kg kh ki kj b">httparse</code>回购的问题，所以希望这个问题能尽快解决。</p><p id="220d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="mj">2016年12月4日更新:</em> Sean引入了一个<a class="ae kf" href="https://github.com/seanmonstar/httparse/pull/30" rel="noopener ugc nofollow" target="_blank"> commit </a>来允许省略原因短语的HTTP状态——万岁！</p><figure class="ky kz la lb fq ml fe ff paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="fe ff mt"><img src="../Images/3d180242e5a08ace3a2b8c56290cfef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d8ye2q-6CKMJehBcSII36Q.jpeg"/></div></div></figure><p id="d625" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我想向# rust-初学者中的人们致以最深切的感谢——特别是JoshTriplett和misdreavus。在我使用Rust的整个过程中，这个社区给了我很大的帮助。</p><p id="cc00" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">虽然这很令人沮丧，但我真的从中学到了很多，而且我觉得经历这些比没有经历更开心。要做的事情很多，要学的东西也很多。</p><pre class="ky kz la lb fq lc kj ld le aw lf dt"><span id="8907" class="lg lh hu kj b fv li lj l lk ll">bushidoboy - Well, I hope I gave everyone a good laugh and a read. I’m gonna go cry in a corner and mourn the death of this project</span></pre><div class="ky kz la lb fq ab cb"><figure class="mu ml mv mw mx my mz paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mu ml mv mw mx my mz paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mu ml mv mw mx my mz paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="na nb nc"><p id="f922" class="jj jk mj jl b jm jn iv jo jp jq iy jr nd jt ju jv ne jx jy jz nf kb kc kd ke hn dt translated"><a class="ae kf" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kf" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kf" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae kf" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jj jk mj jl b jm jn iv jo jp jq iy jr nd jt ju jv ne jx jy jz nf kb kc kd ke hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kf" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kf" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ky kz la lb fq ml fe ff paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="fe ff ng"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="ky kz la lb fq ml"><div class="bz el l di"><div class="nh ni l"/></div></figure></div></div>    
</body>
</html>