<html>
<head>
<title>The Ubuntu Recovery Menu: demystifying Linux system recovery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ubuntu恢复菜单:揭秘Linux系统恢复</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-ubuntu-recovery-menu-demystifying-linux-system-recovery-12d622b1b990?source=collection_archive---------2-----------------------#2017-10-10">https://medium.com/hackernoon/the-ubuntu-recovery-menu-demystifying-linux-system-recovery-12d622b1b990?source=collection_archive---------2-----------------------#2017-10-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="d0dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">本文改编自我的曼宁书</em><strong class="it hv"><em class="jp"/></strong><a class="ae jq" href="https://www.manning.com/books/linux-in-action?a_aid=bootstrap-it&amp;a_bid=4ca15fc9" rel="noopener ugc nofollow" target="_blank"><strong class="it hv"><em class="jp">Linux in Action</em></strong></a><strong class="it hv"><em class="jp">中“应急工具:构建系统恢复设备”一章。Y </em> </strong> <em class="jp"> ou也可以通过</em><a class="ae jq" href="https://www.manning.com/livevideo/linux-in-motion?a_aid=bootstrap-it&amp;a_bid=0c56986f&amp;chan=motion1" rel="noopener ugc nofollow" target="_blank"><em class="jp"/><strong class="it hv"><em class="jp">Linux in Motion</em></strong><em class="jp"/></a><em class="jp">——一个混合课程，由两个多小时的视频和大约40%的Linux in Motion文本组成。</em></p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff jr"><img src="../Images/3e1a031b7e1f6e2037f948fea7464ed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/0*we_eoL0rBiAgSdh_.jpg"/></div></figure><p id="cfa4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不要试图说服你自己:除了所有的好东西，你还会有不愉快的日子。</p><ul class=""><li id="2541" class="jz ka hu it b iu iv iy iz jc kb jg kc jk kd jo ke kf kg kh dt translated">您(或您支持的用户)将会输入错误的命令并永久性地销毁文档。</li><li id="20cc" class="jz ka hu it b iu ki iy kj jc kk jg kl jk km jo ke kf kg kh dt translated">当你意识到某个真正重要的硬件或软件刚刚出了故障时，你会体验到那种沮丧的感觉。那是你多年来为它所做的一切后的感激。</li></ul><p id="8c11" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正确备份意味着您可以离开无法正常运行的操作系统或计算机，并在其他地方重新构建。但那永远是b计划。A计划是恢复。</p><h2 id="d92e" class="kn ko hu bd kp kq kr ks kt ku kv kw kx jc ky kz la jg lb lc ld jk le lf lg lh dt translated">在Ubuntu上使用恢复模式</h2><p id="b2e8" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">Linux不允许您正常登录(例如，可能引导过程在显示登录屏幕之前意外停止)？你需要一些基本的系统管理工具。</p><p id="6a23" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是等等:如果Linux不能加载，你将如何启动这些工具？好吧，即使Linux不能加载到一个正常的命令提示符下，它通常会带你到GRUB菜单。在那里，您可以使用上下箭头键，然后回车选择一个运行在恢复模式下的Linux内核，您很快就会看到，这将打开一个完整的锦囊妙计。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff ln"><img src="../Images/cd3bdddfc730d8ff5d7ff18d1c2a15f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*RjY3jvtn6xbAjMpJjWOXZQ.png"/></div><figcaption class="lo lp fg fe ff lq lr bd b be z ek">The GRUB “Advance options” menu of an Ubuntu installation with links to both current and older kernel versions along with options for launching in recovery mode</figcaption></figure><p id="91ad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如下图所示，一旦Ubuntu在恢复模式下加载，你会看到一个工具菜单，解决一些常见的启动时问题。值得尝试每一个看起来能解决你的根本问题的方法。例如，如果您怀疑问题源于磁盘已满，则“清理”会删除未使用的文件。“dpkg”将试图修复任何可能会把事情搞砸的基于apt的软件包。(“dpkg”工具可能要求您首先启用网络。)</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff ls"><img src="../Images/fca9809b597ad442f48da7328c047575.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qm3DD1pRygY9oaPY9jIFoQ.png"/></div></div><figcaption class="lo lp fg fe ff lq lr bd b be z ek">The Ubuntu Recovery Menu with links to some basic diagnostic and repair tools, along with the option of opening a shell session as “root”</figcaption></figure><p id="38ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">“root”选项将为您打开一个root命令行shell会话，在这里您可以随意使用Bash。一般来说，使用简单的shell会话而不是完整的GUI桌面进行恢复是非常有意义的，因为您运行的复杂服务越少，您至少能够让系统运行的可能性就越大。一旦你<em class="jp">确实</em>设法得到了一个有效的命令提示符，你就可以开始四处探索，看看你是否能识别并修复这个问题。</p><p id="e2d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但至少，你这样做看起来会很酷。</p><p id="3469" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是那些工具是什么<em class="jp">？有运行Ubuntu的机器吗？你自己去看看吧。运行菜单的代码必须已经存在于Ubuntu文件系统中的某个地方。使用“定位”找到它。</em></p><pre class="js jt ju jv fq lx ly lz ma aw mb dt"><span id="970f" class="kn ko hu ly b fv mc md l me mf">$ locate recovery-mode<br/>/lib/recovery-mode<br/>/lib/recovery-mode/l10n.sh<br/>/lib/recovery-mode/options<br/>/lib/recovery-mode/recovery-menu<br/>/lib/recovery-mode/options/apt-snapshots<br/>/lib/recovery-mode/options/clean<br/>/lib/recovery-mode/options/dpkg<br/>/lib/recovery-mode/options/failsafeX<br/>/lib/recovery-mode/options/fsck<br/>/lib/recovery-mode/options/grub<br/>/lib/recovery-mode/options/network<br/>/lib/recovery-mode/options/root<br/>/lib/recovery-mode/options/system-summary</span></pre><p id="9832" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请注意，“l10n.sh”脚本为菜单设置了适当的环境变量。如果您导航到/lib/recovery-mode/目录，您会看到“recovery-menu”文件是显示您在上面看到的菜单界面的脚本。/lib/recovery-mode/options/目录包含用于执行每个菜单项的文件…比如“fsck ”,它将检查并在可能的情况下修复任何损坏的文件系统。</p><p id="ac88" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">根据本书前面的章节，既然您现在已经是一名出色的Bash脚本专家，为什么不看看options/目录中的每一个脚本，看看您是否能弄清楚它们是如何工作的。下面是让您入门的“fsck”脚本的内容。请注意该脚本是如何被很好地记录下来的(使用“#”字符)，以帮助您理解发生了什么。</p><pre class="js jt ju jv fq lx ly lz ma aw mb dt"><span id="8e85" class="kn ko hu ly b fv mc md l me mf">$ cat /lib/recovery-mode/options/fsck<br/>#!/bin/sh</span><span id="0b33" class="kn ko hu ly b fv mg md l me mf">. /lib/recovery-mode/l10n.sh  &lt;1&gt;</span><span id="5710" class="kn ko hu ly b fv mg md l me mf">if [ "$1" = "test" ]; then<br/>  echo $(eval_gettext "Check all file systems")<br/>  exit 0<br/>fi</span><span id="2b8a" class="kn ko hu ly b fv mg md l me mf"># Actual code is in recovery-menu itself  &lt;2&gt;<br/>exit 0</span></pre><p id="0d5a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里有一些你可以自己尝试的事情:</p><ul class=""><li id="9604" class="jz ka hu it b iu iv iy iz jc kb jg kc jk kd jo ke kf kg kh dt translated">在Debian/Ubuntu机器上手动运行“清理”脚本。发生了什么事？</li><li id="f52c" class="jz ka hu it b iu ki iy kj jc kk jg kl jk km jo ke kf kg kh dt translated">然后尝试<em class="jp">仔细</em>编辑/lib/recovery-mode/recovery-menu脚本(先做个备份)。也许只是改变一些简单的东西，比如菜单标题或者脚本描述。然后重启你的机器，从GRUB菜单进入恢复模式，看看是什么样子。</li></ul><p id="ed37" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过一些变化和例外，您应该能够在其他地方很好地使用这些示例。</p><p id="37d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">本文改编自我的</em> <a class="ae jq" href="https://www.manning.com/books/linux-in-action?a_aid=bootstrap-it&amp;a_bid=4ca15fc9" rel="noopener ugc nofollow" target="_blank"> <em class="jp">曼宁《Linux in Action》一书</em> </a> <em class="jp">的第六章(应急工具:搭建系统恢复装置)。这其中有更多的乐趣，包括一个名为Linux in Motion的混合课程，由两个多小时的视频和大约40%的文本组成</em><a class="ae jq" href="https://www.manning.com/livevideo/linux-in-motion?a_aid=bootstrap-it&amp;a_bid=0c56986f&amp;chan=motion1" rel="noopener ugc nofollow" target="_blank"><em class="jp">Linux in Action</em></a><em class="jp">。谁知道呢……你可能也会喜欢我的</em> <a class="ae jq" href="https://www.manning.com/books/learn-amazon-web-services-in-a-month-of-lunches?a_aid=bootstrap-it&amp;amp;a_bid=1c1b5e27" rel="noopener ugc nofollow" target="_blank"> <em class="jp">在一个月的午餐中学习亚马逊网络服务</em> </a> <em class="jp">。</em></p></div></div>    
</body>
</html>