<html>
<head>
<title>CI/CD pipeline using Github, Docker, CircleCI &amp; Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Github、Docker、CircleCI和Heroku的CI/CD管道</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/ci-cd-pipeline-using-github-docker-circleci-heroku-ef7f8a90a6f9?source=collection_archive---------6-----------------------#2017-10-21">https://medium.com/hackernoon/ci-cd-pipeline-using-github-docker-circleci-heroku-ef7f8a90a6f9?source=collection_archive---------6-----------------------#2017-10-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="76ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这篇文章将带你了解如何用<strong class="it hv"> CircleCI </strong>、<strong class="it hv"> Docker </strong>、<strong class="it hv"> Heroku </strong>轻松设置一个<strong class="it hv">持续集成</strong>、&amp;、<strong class="it hv">持续部署</strong> (CI/CD)管道。在本教程的最后，你应该能够设置你自己的<strong class="it hv"> CI/CD </strong>，如上图所示。</p><p id="fdb9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本教程假设您已经:</p><ul class=""><li id="b0e3" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated">一个<strong class="it hv"> Heroku </strong>账号— <a class="ae jy" href="https://signup.heroku.com/signup/dc" rel="noopener ugc nofollow" target="_blank">免费注册</a>。</li><li id="150d" class="jp jq hu it b iu jz iy ka jc kb jg kc jk kd jo ju jv jw jx dt translated">安装了一个<a class="ae jy" href="https://devcenter.heroku.com/articles/heroku-cli" rel="noopener ugc nofollow" target="_blank"> Heroku CLI </a>。</li><li id="be6f" class="jp jq hu it b iu jz iy ka jc kb jg kc jk kd jo ju jv jw jx dt translated">一个<strong class="it hv"> CircleCI </strong>账号— <a class="ae jy" href="https://circleci.com/signup/" rel="noopener ugc nofollow" target="_blank">用你的Github账号免费注册</a>。</li><li id="e8b5" class="jp jq hu it b iu jz iy ka jc kb jg kc jk kd jo ju jv jw jx dt translated"><strong class="it hv">Python</strong>3.5版本本地安装。</li></ul><p id="6acc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本演示中使用的应用程序的源代码可以在我的<a class="ae jy" href="https://github.com/mlabouardy/circleci-heroku-flask" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ke"><img src="../Images/b2fcc5b80d42a069fbab2e7fc1af4f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*dWOQEtbQ3ESrZ5JL."/></div></figure><p id="1e9f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1 — Heroku </p><p id="cd25" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，使用您创建<strong class="it hv"> Heroku </strong>账户时使用的电子邮件地址和密码登录:</p><blockquote class="km kn ko"><p id="2fd3" class="ir is kp it b iu iv iw ix iy iz ja jb kq jd je jf kr jh ji jj ks jl jm jn jo hn dt translated">heroku登录</p></blockquote><p id="404a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要克隆示例应用程序，以便您拥有可以部署到<strong class="it hv"> Heroku </strong>的代码的本地版本，请在本地命令shell或终端中执行以下命令</p><blockquote class="km kn ko"><p id="2d1c" class="ir is kp it b iu iv iw ix iy iz ja jb kq jd je jf kr jh ji jj ks jl jm jn jo hn dt translated">git克隆<a class="ae jy" href="https://github.com/mlabouardy/circleci-heroku-flask.git" rel="noopener ugc nofollow" target="_blank">https://github.com/mlabouardy/circleci-heroku-flask.git</a><br/>CD circle ci-heroku-flask/</p></blockquote><p id="5054" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意:如果您使用自己的应用程序，您应该将以下文件添加到代码库中:</p><ol class=""><li id="1725" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo kt jv jw jx dt translated"><strong class="it hv"> <em class="kp"> Procfile </em> </strong>:它告诉<strong class="it hv"> Heroku </strong>应该运行什么命令</li><li id="862e" class="jp jq hu it b iu jz iy ka jc kb jg kc jk kd jo kt jv jw jx dt translated"><strong class="it hv"><em class="kp">requirements . txt</em></strong>:在这个文件中你会列出<strong class="it hv"> pip </strong>应该为你安装的包/依赖</li></ol><p id="b8f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<strong class="it hv"> Heroku </strong>上创建一个应用程序，让<strong class="it hv"> Heroku </strong>准备好接收你的源代码:</p><blockquote class="km kn ko"><p id="9e26" class="ir is kp it b iu iv iw ix iy iz ja jb kq jd je jf kr jh ji jj ks jl jm jn jo hn dt translated">heroku创建电影-商店-演示</p></blockquote><p id="dd16" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">提供一个<strong class="it hv"> MySQL </strong>数据库附件:</p><blockquote class="km kn ko"><p id="58db" class="ir is kp it b iu iv iw ix iy iz ja jb kq jd je jf kr jh ji jj ks jl jm jn jo hn dt translated">heroku addons:添加cleardb:ignite —应用程序电影—商店—演示</p></blockquote><p id="de1f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Heroku 会自动添加一个配置变量，其中包含URL形式的数据库凭证。在设置选项卡下找到配置变量，点击按钮“<strong class="it hv">显示配置变量</strong></p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/9e4d079a1994c8e664ee9e6a91dd5b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*24Ob9b0Gc9ud7NlX."/></div></figure><p id="1aa6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在部署应用程序:</p><blockquote class="km kn ko"><p id="377b" class="ir is kp it b iu iv iw ix iy iz ja jb kq jd je jf kr jh ji jj ks jl jm jn jo hn dt translated">git远程添加heroku<a class="ae jy" href="https://git.heroku.com/movies-store-demo.git" rel="noopener ugc nofollow" target="_blank">https://git.heroku.com/movies-store-demo.git</a></p></blockquote><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff kv"><img src="../Images/62105cfd60e573d8e8deacebcdfa2cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/0*-v_T8wiqz6t1exTK."/></div></figure><p id="5ef2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">进入<strong class="it hv"> Heroku仪表盘</strong>，点击<strong class="it hv">打开App </strong>按钮:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/29829777c818db5f4189988fd34019ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*EI2-AMQ-6IwwHMgC."/></div></figure><p id="4efc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您应该看到:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/2e365d452408154e3dc77b8135dfafaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*57OT4g4Sr3xbyKqu."/></div></figure><p id="ff9b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意:作为一种方便的快捷方式，您可以按如下方式打开应用程序:</p><blockquote class="km kn ko"><p id="36df" class="ir is kp it b iu iv iw ix iy iz ja jb kq jd je jf kr jh ji jj ks jl jm jn jo hn dt translated">heroku公开赛</p></blockquote><p id="77e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> 2 — CircleCI </strong></p><p id="ea64" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以下部分将介绍如何为该应用程序配置<strong class="it hv"> CI/CD </strong>步骤，如何运行单元测试，构建&amp;将<strong class="it hv"> Docker映像</strong>推送到<a class="ae jy" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> DockerHub </a>，以及如何将演示应用程序部署到<strong class="it hv"> Heroku </strong>:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/3ac4adcd671aa14fe4802d91cc744662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*plSziXmLPbvUqpbc."/></div></figure><p id="9dab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kp">。circleci/config.yml </em>包含<strong class="it hv"> CI/CD </strong>步骤:</p><figure class="kf kg kh ki fq kj"><div class="bz el l di"><div class="kw kx l"/></div></figure><ul class=""><li id="d266" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated">我们使用<strong class="it hv"> Python 3.5 </strong>作为构建环境的主要容器&amp; <strong class="it hv"> MySQL </strong>。</li><li id="09d4" class="jp jq hu it b iu jz iy ka jc kb jg kc jk kd jo ju jv jw jx dt translated">为了加速构建，我们将Python <strong class="it hv"> virtualenv </strong>放入CircleCi缓存，并在运行<strong class="it hv"> pip install之前恢复缓存。</strong></li><li id="73be" class="jp jq hu it b iu jz iy ka jc kb jg kc jk kd jo ju jv jw jx dt translated">单元测试需要MySQL数据库，因此我们需要等待容器准备好。</li><li id="cd71" class="jp jq hu it b iu jz iy ka jc kb jg kc jk kd jo ju jv jw jx dt translated">我们安装<strong class="it hv"> Docker客户端</strong>，从<strong class="it hv"> Github </strong>库中存储的<strong class="it hv">Docker文件</strong>构建<strong class="it hv"> docker镜像</strong>，然后将镜像推送到<strong class="it hv"> DockerHub </strong>。</li><li id="1d92" class="jp jq hu it b iu jz iy ka jc kb jg kc jk kd jo ju jv jw jx dt translated">最后，我们安装<strong class="it hv">Heroku CLI</strong>T72】把修改推送给<strong class="it hv"> Heroku。</strong></li></ul><p id="32f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如上面的配置文件所示，我们需要设置一些<strong class="it hv">环境变量</strong>，因此导航到项目设置:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/dae3fa9365f4b22b3d14568f0e845ac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*FrhsRn8uDN7SJ5Wr."/></div></figure><p id="d4c6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，为了启用从<strong class="it hv"> CircleCI </strong>到<strong class="it hv"> Heroku Git服务器</strong>的连接，我们需要创建一个不带密码短语的SSH密钥。发出以下命令:</p><blockquote class="km kn ko"><p id="ac3e" class="ir is kp it b iu iv iw ix iy iz ja jb kq jd je jf kr jh ji jj ks jl jm jn jo hn dt translated">ssh-keygen -t rsa</p></blockquote><p id="19f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，在主机名为<strong class="it hv">git.heroku.com</strong>的CircleCI UI SSH权限页面中添加私钥，如下所示:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/9d13ae3222de328a3c310cb56401199a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*puScYEhrZB2YS7iw."/></div></figure><p id="bbbc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">公钥被添加到Heroku的<a class="ae jy" href="https://dashboard.heroku.com/account" rel="noopener ugc nofollow" target="_blank">账户</a>页面:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/2db8198de9b38571fda268fbdcb626a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*3p4jy7A2YpABZJPy."/></div></figure><p id="4e93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，每当你对你的<strong class="it hv"> Github </strong> repo进行修改时，<strong class="it hv"> CircleCI </strong>会自动将修改部署到<strong class="it hv"> Heroku </strong>。这是一个临时构建:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/a4c24d49183391c9b6cd3d653d1f92b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*MGZv8OWnRJf5n_4P."/></div></figure><p id="69a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> CI/CD管道</strong>步骤如<em class="kp"> config.yml </em>文件所述:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/6e76f876086df051715394bbf507129a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*hhKPTxodpB0omx6a."/></div></figure><p id="a95c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> Docker hub</strong>上的<strong class="it hv">Docker镜像</strong>库:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/c2def253303b71720ac58657c374620a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*MWRFUmtcy9KuEESm."/></div></figure><p id="a333" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">来自<strong class="it hv"> CircleCI </strong>的Heroku 最后一次建造:</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/d2725a1846d3faa79440d24d4ef42c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*p7BFprhLy3fJE4fW."/></div></figure><p id="774c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">更多文章请查看我的<a class="ae jy" href="http://labouardy.com" rel="noopener ugc nofollow" target="_blank">博客</a> ❤</p></div></div>    
</body>
</html>