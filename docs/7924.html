<html>
<head>
<title>Getting into Puppeteer : Inject | Interact | Keys | Capture | Select</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">进入木偶师:注射|互动|按键|捕捉|选择</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/puppeteer-on-fire-inject-interact-keys-capture-select-1cd903d37287?source=collection_archive---------7-----------------------#2017-11-13">https://medium.com/hackernoon/puppeteer-on-fire-inject-interact-keys-capture-select-1cd903d37287?source=collection_archive---------7-----------------------#2017-11-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/632667fa2a7a2c09810e6d4f3105b4d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CUeUltl1MEkiQ5NF."/></div></div></figure><p id="4d61" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本文的最后，我们将学习如何</p><ol class=""><li id="3ff8" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated">将自定义Javascript函数注入到另一个页面的上下文中。</li><li id="fdc7" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">与表单交互以实现自动化。</li><li id="5720" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">从页面中捕获特定元素的屏幕截图</li><li id="963b" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">使用键盘/鼠标事件来键入/单击选定的元素。</li><li id="752e" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">截图</li><li id="8cf2" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">从DOM中选择元素。</li><li id="7945" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">访问cookies</li></ol><h1 id="8618" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">介绍</h1><p id="d2cb" class="pw-post-body-paragraph jc jd hu je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">无头浏览器确实在浏览器自动化和测试领域做出了一些很好的贡献。其中大多数用于单元/端到端测试，而很少用于浏览器自动化。不可见浏览器或技术上称为无头浏览器是那些具有普通浏览器的所有功能/特征，但通常通过命令行/代码执行的浏览器。主要用于测试，但也可以用于网页抓取，截图捕捉，注入脚本，以自动化网站上的交互。</p><p id="6de2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这篇文章中，我们将通过谷歌开发工具团队新推出的谷歌chrome节点api木偶。除了puppet er，最近还发布了其他一些产品，包括Chromeless、Chrominator、Chromy、Navalia、Lambdium、nightmare js(类似于puppet er，但在幕后使用电子，而puppet er仅基于chromium)以及提供可靠的跨浏览器api进行测试的优秀旧phantomjs。</p><h1 id="67a1" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">关于木偶师</h1><p id="0bb1" class="pw-post-body-paragraph jc jd hu je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">“Puppeteer是一个节点库，它提供高级API来通过<a class="ae lr" href="https://github.com/ChromeDevTools/devtools-protocol" rel="noopener ugc nofollow" target="_blank"> devtools协议</a>控制无头Chrome。它也可以被配置成使用完整的(或非headless) Chrome”这是谷歌开发团队所说的。</p><p id="9647" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">木偶师可以用来</p><ul class=""><li id="e020" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz ls kg kh ki dt translated">自动化视觉测试。</li><li id="d92f" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz ls kg kh ki dt translated">在不打开浏览器的情况下生成网站的图像/pdf截图。</li><li id="1bdf" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz ls kg kh ki dt translated">表单提交/浏览器使用模拟</li><li id="d301" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz ls kg kh ki dt translated">抓取网站</li><li id="9f9a" class="ka kb hu je b jf kj jj kk jn kl jr km jv kn jz ls kg kh ki dt translated">或者捕捉时间线</li></ul><p id="97fe" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">还有很多。</p><p id="ab59" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们从木偶师的基本用法开始。</p><p id="d0de" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你也可以在新的木偶游乐场<a class="ae lr" href="https://try-puppeteer.appspot.com/" rel="noopener ugc nofollow" target="_blank">https://try-puppeteer.appspot.com/</a>试一试</p><p id="e45b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">安装木偶师一点也不复杂，我将带您快速安装，</p><p id="6ca1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在Ubuntu机器上</p><p id="5a7f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh lt lu lv lw b">sudo apt-get update</code></p><p id="37b2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正在从节点源安装节点v8.4.0。在<a class="ae lr" href="https://github.com/nodesource/distributions" rel="noopener ugc nofollow" target="_blank">https://github.com/nodesource/distributions</a>找到你的</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="e295" class="mf kp hu lw b fv mg mh l mi mj"># This installs nodejs on ubuntu based system</span><span id="7152" class="mf kp hu lw b fv mk mh l mi mj">curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -</span><span id="e763" class="mf kp hu lw b fv mk mh l mi mj">sudo apt-get install -y nodejs</span></pre><p id="404c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">除此之外，你还需要这些</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="2449" class="mf kp hu lw b fv mg mh l mi mj">gconf-service libasound2 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget</span></pre><p id="fdff" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在Ubuntu上</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="3bc8" class="mf kp hu lw b fv mg mh l mi mj">sudo apt-get install gconf-service libasound2 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wgetsudo apt-get install gconf-service libasound2 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget</span></pre><p id="f39e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">安装npm</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="2a9b" class="mf kp hu lw b fv mg mh l mi mj">sudo apt-get install npm</span></pre><p id="b21f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在进入您的工作目录运行</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="bf10" class="mf kp hu lw b fv mg mh l mi mj">npm init</span><span id="06f7" class="mf kp hu lw b fv mk mh l mi mj">npm -i puppeteer</span></pre><p id="6d19" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以走了。运行上面的命令，它安装最新版本的铬和木偶。请记住，没有必要安装显示器，因为它是一个无头浏览器，可以在服务器/命令行上运行。如果你遇到了一些问题，请访问此链接进行故障排除<a class="ae lr" href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md" rel="noopener ugc nofollow" target="_blank">https://github . com/Google chrome/puppet eer/blob/master/docs/trouble shooting . MD</a>如果你使用的是ubuntu xenial完全没有问题，请跟随我的领导<a class="ae lr" href="https://github.com/GoogleChrome/puppeteer/issues/290#issuecomment-324838511" rel="noopener ugc nofollow" target="_blank">https://github . com/Google chrome/puppet eer/issues/290 # issuecomment-324838511</a></p><h1 id="3610" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">入门指南</h1><p id="55e0" class="pw-post-body-paragraph jc jd hu je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">让我们在iPad pro dimensions中生成一个网站的屏幕截图。(768px * 1024px)(根据http://screensiz.es/<a class="ae lr" href="http://screensiz.es/" rel="noopener ugc nofollow" target="_blank"/>)。</p><p id="cd04" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">安装完木偶师后，打开一个. js文件，我们称之为npm项目文件夹中的snapshot . js文件，并添加以下代码..</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="6777" class="mf kp hu lw b fv mg mh l mi mj">const puppeteer = require('puppeteer');<br/>(async () =&gt; {<br/> const browser = await puppeteer.launch();<br/> const page = await browser.newPage();<br/> await page.goto('<a class="ae lr" href="https://google.com'" rel="noopener ugc nofollow" target="_blank">https://google.com'</a>);<br/> await page.setViewport({width : 768 , height : 1024});<br/> await page.screenshot({path: 'google.png'});<br/> browser.close();<br/>})();</span></pre><p id="1c85" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在在终端中运行脚本</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="0f4c" class="mf kp hu lw b fv mg mh l mi mj">node screenshot.js</span></pre><p id="c038" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">代码成功运行后，你将得到一张google.com的截图，只需一行代码，你甚至可以将其保存为pdf格式。在browser.close()之前添加以下代码</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="83da" class="mf kp hu lw b fv mg mh l mi mj">await page.pdf({path: 'google.pdf', format: 'A4'});</span></pre><p id="ac0f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">除了A4，你甚至可以捕捉其他尺寸的信，法律，小报，分类帐，A0，A1，A2，A3，A4，A5。更多信息请点击<a class="ae lr" href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pagepdfoptions" rel="noopener ugc nofollow" target="_blank">这里</a></p><p id="7712" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们以稍微不同的方式使用截图功能。最近，当我在twitter上浏览我的feed时，我看到一个用户在某个X公司上发推文，该公司为一项新功能提供屏幕捕捉服务。他想要的是，当你传递一个元素的ID或类时，这个元素必须被捕获，而不是整个页面。只是元素。所以想到在这里实现。</p><p id="9006" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">来做这个。我们必须找到那个元素的位置和尺寸。使用这些细节，我们可以剪辑截图。在木偶师，你可以剪辑屏幕截图的特定区域。更多关于这个api的方法在这里<a class="ae lr" href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pagescreenshotoptions" rel="noopener ugc nofollow" target="_blank">https://github . com/Google chrome/puppet eer/blob/master/docs/API . MD # pagescreenshotoptions</a></p><p id="7608" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将使用页面api的$eval方法来实现这一点。它接受一个选择器和要在页面上下文中执行的函数作为参数。offset height和width给出了元素的尺寸，offsetTop和offsetLeft给出了裁剪该区域所需的位置。</p><p id="f931" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面的脚本捕获了Smashing杂志的侧栏。</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="28fa" class="mf kp hu lw b fv mg mh l mi mj">const puppeteer = require('puppeteer');</span><span id="425c" class="mf kp hu lw b fv mk mh l mi mj">(async () =&gt; {<br/> const browser = await puppeteer.launch();<br/> const page = await browser.newPage();<br/> await page.goto('<a class="ae lr" href="https://www.smashingmagazine.com/'" rel="noopener ugc nofollow" target="_blank">https://www.smashingmagazine.com/'</a>);<br/> page.setViewport({width : 1400 , height : 2500})<br/> const html = await page.$eval('.sn', e =&gt; [e.offsetWidth,e.offsetHeight,e.offsetTop,e.offsetLeft] );<br/> await page.screenshot({path : "clip.png", clip : {x : html[2],y : html[3] , width : html[0] , height : html[1]}});<br/>   browser.close();<br/>})();</span></pre><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/49ab9f7812b287c21885b32a9cf4f4c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*jf2xm2ju46Mh9tmB2w2JoQ.png"/></div></figure><p id="9fff" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">左图是SM网站的侧边栏。这些调整在许多情况下特别有用。它可以根据你的需要，以你自己的方式即兴创作和实现。</p><p id="e7ce" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在让我们继续与表单交互</p><h1 id="de43" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">与网页/表单交互</h1><p id="230d" class="pw-post-body-paragraph jc jd hu je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">我认为这是无头浏览器最强大的部分。如同在浏览器中打开页面一样与页面进行交互。</p><p id="5ce2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们捕捉一个老大哥<a class="ae lr" href="https://google.com/" rel="noopener ugc nofollow" target="_blank">https://google.com</a>的屏幕截图</p><p id="6a8d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">页面api的屏幕截图方法为我们完成了这项工作。</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="7c2f" class="mf kp hu lw b fv mg mh l mi mj">const puppeteer = require('puppeteer');<br/>(async () =&gt; {<br/> const browser = await puppeteer.launch();<br/> const page = await browser.newPage();<br/> await page.goto('<a class="ae lr" href="https://google.com'" rel="noopener ugc nofollow" target="_blank">https://google.com'</a>);<br/> await page.screenshot({path : "google.png"});<br/>})();</span></pre><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mm"><img src="../Images/abb648bee8aa05526156bf546bcdd23f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4VX-noPQpEi8KCvWL6bO6w.png"/></div></div></figure><p id="ba07" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">检查点#1:现在让我们开始在不打开浏览器的情况下输入，多酷啊！！！。在你输入之前，你必须像使用浏览器一样关注输入元素。为此，我们必须关注输入元素。在此之前，让我们找到关注的元素</p><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/587ff2b413c7dbc5de7e8a5bc2133fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LR8X2k_zB5h2D4DHKrZefg.png"/></div></div></figure><p id="1726" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">检查点#2:右键单击输入搜索栏并选择inspect element。(【https://developer.chrome.com/devtools】点击这里<a class="ae lr" href="https://developer.chrome.com/devtools" rel="noopener ugc nofollow" target="_blank"><em class="mo"/></a>)了解更多关于使用devtools检查的信息。现在选择该元素的id，顺便说一下它的“lst-ib ”,我不知道lst-ib是什么意思，page.click()、page.type()、page.tap()是许多交互处理函数中的几个。通过使用page.click单击元素来聚焦元素，然后使用page.type(“传递需要键入的内容”)开始键入，然后捕获屏幕截图。</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="328c" class="mf kp hu lw b fv mg mh l mi mj">const puppeteer = require('puppeteer');<br/>(async () =&gt; {<br/>   const browser = await puppeteer.launch();<br/>   const page = await browser.newPage();<br/>   await page.goto('<a class="ae lr" href="https://google.com'" rel="noopener ugc nofollow" target="_blank">https://google.com'</a>);<br/>   await page.screenshot({path : "google.png"});<br/>   page.click("#lst-ib");<br/>   page.type("Smashing magazine");</span><span id="6b26" class="mf kp hu lw b fv mk mh l mi mj">   ## before v0.12.0<br/>   page.click("#lst-ib");<br/>   page.type("Smashing magazine");</span><span id="f14a" class="mf kp hu lw b fv mk mh l mi mj">   ## after v0.12.0 as per suggestion by <a class="ae lr" rel="noopener" href="/@dan_kim">https://medium.com/@dan_kim</a><br/>   page.type("#lst-ib","Smashing magazine");   <br/>   <br/>   await page.screenshot({path : "google1.png"});<br/>   browser.close();<br/>})();</span></pre><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mm"><img src="../Images/4f30ebfa43826753a293226cb2fe1611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*REuKf1fzyo1Jv4ubmwC8xQ.png"/></div></div></figure><p id="b81d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">检查点3:现在我们必须点击提交或者按回车键。让我们探索这两种方法，你将会知道api在处理按键时有多灵活。</p><p id="d0a0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们已经输入了，让我们点击“谷歌搜索”按钮。因为它没有指定任何id(元素检查),我们必须使用任何其他选择器，你可以在谷歌主页的控制台中尝试这一点</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="8075" class="mf kp hu lw b fv mg mh l mi mj">document.querySelectorAll('input[type="submit"]')[0]</span></pre><p id="23d4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为您提供提交输入元素。</p><p id="4d41" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在puppeteer中，我们必须单击按钮并等待它导航，这可以通过page.waitForNavigation()来完成；然后再抓图。</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="7663" class="mf kp hu lw b fv mg mh l mi mj">const puppeteer = require('puppeteer');</span><span id="2a36" class="mf kp hu lw b fv mk mh l mi mj">(async () =&gt; {</span><span id="acf1" class="mf kp hu lw b fv mk mh l mi mj">  const browser = await puppeteer.launch();<br/>  const page = await browser.newPage();<br/>  await page.goto('https://google.com');<br/>  await page.screenshot({path : "google.png"});<br/>  page.click("#lst-ib");<br/>  page.type("Smashing magazine");<br/>  await page.screenshot({path : "google1.png"});<br/>  page.click('input[type="submit"]');<br/>  // Note although the page has two input[type="submit"] elements it picks up the   first one more <a class="ae lr" href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pageclickselector-options" rel="noopener ugc nofollow" target="_blank">about it here.</a><br/>  await page.waitForNavigation();<br/>  await page.screenshot({path : "google2.png"});<br/>  browser.close();</span><span id="dba0" class="mf kp hu lw b fv mk mh l mi mj">})();</span></pre><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mm"><img src="../Images/c3a88ff292e9bb5a023f1ec9982a4412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PbZzKAJVA1no81mCFAkBKw.png"/></div></div></figure><p id="58ab" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在让我们试试回车键搜索方式。在检查点#2之后，注意使用<a class="ae lr" href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#class-keyboard" rel="noopener ugc nofollow" target="_blank">键盘类的</a>方法down()。</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="5a94" class="mf kp hu lw b fv mg mh l mi mj">(async () =&gt; {<br/>    const browser = await puppeteer.launch();<br/>    const page = await browser.newPage();<br/>    await page.goto('https://google.com');<br/>    await page.screenshot({path : "google.png"});<br/>    page.click("#lst-ib"); //Focus on input element<br/>    page.type("Medium top articles");<br/>    await page.screenshot({path : "google1.png"});<br/>    page.keyboard.down('Enter'); // Press enter<br/>    await page.waitForNavigation();<br/>    await page.screenshot({path : "google2.png"});<br/>    browser.close();<br/>})();</span></pre><h2 id="db62" class="mf kp hu bd kq mp mq mr ku ms mt mu ky jn mv mw lc jr mx my lg jv mz na lk nb dt translated">到目前为止，我们已经看到了如何使用选择器和操纵器来选择元素，以与表单字段交互，模拟鼠标和键盘事件。</h2><h1 id="2fd6" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">在pages上下文中运行自定义javascript函数。</h1><p id="b2a6" class="pw-post-body-paragraph jc jd hu je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">让我们在页面的上下文中执行一个函数，将google的标志改为smashing magazine的标志。</p><p id="f706" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过检查谷歌在google.com的标识，它的id是“hplogo”。我们将使用木偶师的页面api的eval函数，它接受选择器和函数以及它的参数作为它的参数，在页面的上下文中评估传递的函数，在这个例子中是google.com</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="28cc" class="mf kp hu lw b fv mg mh l mi mj">const puppeteer = require('puppeteer');</span><span id="ae9f" class="mf kp hu lw b fv mk mh l mi mj">const sleep = require('sleep'); </span><span id="e2ab" class="mf kp hu lw b fv mk mh l mi mj">// Not necessary, becuase we are loading the smahingmagazine's logo it takes time to load the image. Hence if we wait its for a while the image will be loaded and then a screenshot can be taken.</span><span id="e664" class="mf kp hu lw b fv mk mh l mi mj">(async () =&gt; {<br/> const browser = await puppeteer.launch();<br/> const page = await browser.newPage();<br/> await page.goto('<a class="ae lr" href="https://google.com'" rel="noopener ugc nofollow" target="_blank">https://google.com'</a>);<br/> const html = await page.$eval('#hplogo', e =&gt; e.children[0].innerHTML = '&lt;img src="<a class="ae lr" href="https://media-mediatemple.netdna-ssl.com/wp-content/themes/smashing-magazine/assets/images/logo.svg" rel="noopener ugc nofollow" target="_blank">https://media-mediatemple.netdna-ssl.com/wp-content/themes/smashing-magazine/assets/images/logo.svg</a>"&gt;');</span><span id="5e70" class="mf kp hu lw b fv mk mh l mi mj"> sleep.sleep(2); // wait for 2 seconds so that the SM logo loads completely.</span><span id="9b4d" class="mf kp hu lw b fv mk mh l mi mj">await page.screenshot({path : "jack.png"}); //capture the screenshot</span><span id="10b5" class="mf kp hu lw b fv mk mh l mi mj"> browser.close();<br/>})();</span></pre><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mm"><img src="../Images/070db53ee112dd9e10efca090ce1ac4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYtlAcUJw7iyMb62SXsYbA.png"/></div></div></figure><h1 id="adee" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">混杂的</h1><p id="2ee9" class="pw-post-body-paragraph jc jd hu je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">有时你必须看到浏览器显示的内容，所以如果你想无头运行它</p><p id="8905" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh lt lu lv lw b">const browser = await.puppeteer.launch({headless : false});</code></p><p id="9025" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这将运行脚本并启动浏览器。</p><h1 id="bcb3" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">让我们访问google.com存储的cookies</h1><p id="e9ea" class="pw-post-body-paragraph jc jd hu je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">page.cookiess类将为您提供对页面cookie的访问。</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="0540" class="mf kp hu lw b fv mg mh l mi mj">(async () =&gt; {</span><span id="6150" class="mf kp hu lw b fv mk mh l mi mj"> const browser = await puppeteer.launch();<br/> const page = await browser.newPage();<br/> await page.goto('<a class="ae lr" href="https://google.com'" rel="noopener ugc nofollow" target="_blank">https://google.com'</a>);<br/> var c = await page.cookies();<br/> console.log(c); // outputs the cookie<br/> browser.close();</span><span id="d31b" class="mf kp hu lw b fv mk mh l mi mj">})();</span></pre><p id="45de" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我的盒子上的输出。</p><pre class="lx ly lz ma fq mb lw mc md aw me dt"><span id="9720" class="mf kp hu lw b fv mg mh l mi mj">[ <br/> { <br/>  name: '1P_JAR',<br/>  value: '2017-9-12-13',<br/>  domain: '.google.co.in',<br/>  path: '/',<br/>  expires: 1505827402,<br/>  size: 18,<br/>  httpOnly: false,<br/>  secure: false,<br/>  session: false <br/> },<br/> {<br/>  name: 'NID',<br/>  value: 'I have erased the cookies value. Just incase',<br/>  domain: '.google.co.in',<br/>  path: '/',<br/>  expires: 1521033802.002931,<br/>  size: 135,<br/>  httpOnly: true,<br/>  secure: false,<br/>  session: false<br/> }<br/>]</span></pre><p id="79ea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最近很多无头浏览器在太空像无铬:<a class="ae lr" href="https://github.com/graphcool/chromeless" rel="noopener ugc nofollow" target="_blank">https://github.com/graphcool/chromeless</a>Chrominator:<a class="ae lr" href="https://github.com/jesg/chrominator" rel="noopener ugc nofollow" target="_blank">https://github.com/jesg/chrominator</a>。还有<a class="ae lr" href="https://www.google.co.in/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=3&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwiT0ZOsveXWAhXBF5QKHV2iCTQQFggzMAI&amp;url=https%3A%2F%2Fgist.github.com%2Fevandrix%2F3694955&amp;usg=AOvVaw2swRsqm_AY8z8I1fC96MB8" rel="noopener ugc nofollow" target="_blank">很多其他的</a>。</p><h1 id="7fc9" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">有用的链接</h1><p id="9f1c" class="pw-post-body-paragraph jc jd hu je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated"><a class="ae lr" href="https://github.com/GoogleChrome/puppeteer/" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleChrome/puppeteer/</a></p><div class="nc nd fm fo ne nf"><a href="https://github.com/GoogleChrome/puppeteer/issues/290#issuecomment-324838511" rel="noopener  ugc nofollow" target="_blank"><div class="ng ab ej"><div class="nh ab ni cl cj nj"><h2 class="bd hv fv z el nk eo ep nl er et ht dt translated">Chrome Headless没有在Debian上发布</h2><div class="nm l"><h3 class="bd b fv z el nk eo ep nl er et ek translated">运行自述文件中的示例代码:const puppeter = require('puppeter')；(async() = &gt; { const…</h3></div><div class="nn l"><p class="bd b gc z el nk eo ep nl er et ek translated">github.com</p></div></div><div class="no l"><div class="np l nq nr ns no nt ja nf"/></div></div></a></div><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nu"><img src="../Images/a36c44ea1fc22e5995c6a4e1a8fcc505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jNle40yksJFRersdt4ZAUg.gif"/></div></div></figure></div></div>    
</body>
</html>