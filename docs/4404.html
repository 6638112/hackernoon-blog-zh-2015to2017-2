<html>
<head>
<title>Deep Learning CNN’s in Tensorflow with GPUs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深度学习CNN的Tensorflow与GPU</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/deep-learning-cnns-in-tensorflow-with-gpus-cba6efe0acc2?source=collection_archive---------0-----------------------#2017-05-31">https://medium.com/hackernoon/deep-learning-cnns-in-tensorflow-with-gpus-cba6efe0acc2?source=collection_archive---------0-----------------------#2017-05-31</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/46cd1cff4068ef1acdb1db4352f76c3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4-9rcFvShvsA4mhCpRHaSg.jpeg"/></div></div></figure><p id="4f8b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在我的上一篇教程中，你从一个预先训练的inception v3模型中创建了一个复杂的卷积神经<a class="ae ka" href="https://hackernoon.com/tagged/network" rel="noopener ugc nofollow" target="_blank">网络</a>。</p><p id="ecac" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本教程中，您将学习卷积神经网络(CNN)的架构，如何在Tensorflow中创建CNN，并在图像标签上提供预测。最后，您将学习如何在GPU上运行模型，以便您可以花时间创建更好的模型，而不是等待它们收敛。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/ba61524f2875f2a2ce41b5ce8217573c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*yoZCHE1TOfCNbCXoNYx3Tw.gif"/></div></figure><h1 id="05f8" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated"><strong class="ak">概述</strong></h1><ul class=""><li id="413b" class="le lf hu je b jf lg jj lh jn li jr lj jv lk jz ll lm ln lo dt translated">CNN简介</li><li id="d124" class="le lf hu je b jf lp jj lq jn lr jr ls jv lt jz ll lm ln lo dt translated">创建您的第一个CNN和CPU培训</li><li id="729e" class="le lf hu je b jf lp jj lq jn lr jr ls jv lt jz ll lm ln lo dt translated">在GPU上训练</li></ul><h1 id="2e59" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">先决条件</h1><ul class=""><li id="0a66" class="le lf hu je b jf lg jj lh jn li jr lj jv lk jz ll lm ln lo dt translated">基本的机器学习理解</li><li id="3e43" class="le lf hu je b jf lp jj lq jn lr jr ls jv lt jz ll lm ln lo dt translated">基本张量流理解</li><li id="81e9" class="le lf hu je b jf lp jj lq jn lr jr ls jv lt jz ll lm ln lo dt translated">AWS帐户(用于gpu)</li></ul></div><div class="ab cl lu lv hc lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hn ho hp hq hr"><h1 id="1391" class="kg kh hu bd ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz mf lb lc ld dt translated">卷积神经网络</h1><p id="8c0f" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">卷积神经网络是当前用于图像分类的最新架构。今天，它们在实践中被用于面部识别、自动驾驶汽车和检测一个物体是否是热狗。</p><h2 id="713f" class="mj kh hu bd ki mk ml mm km mn mo mp kq jn mq mr ku jr ms mt ky jv mu mv lc mw dt translated">基础建筑</h2><p id="1e34" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">CNN架构的基础包括3个部分。卷积、汇集和完全连接层。这些组件协同工作来学习输入的密集特征表示。</p><p id="2042" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">卷积</strong></p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/8d0c8d79ca7ffa7b613f2c4923420c69.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/1*1VJDP6qDY9-ExTuQVEOlVg.gif"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Image from <a class="ae ka" href="https://github.com/vdumoulin/conv_arithmetic" rel="noopener ugc nofollow" target="_blank">https://github.com/vdumoulin/conv_arithmetic</a></figcaption></figure><p id="d5f0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">卷积由一个<strong class="je hv">内核</strong> <em class="nc">(上面的绿色方块)</em>组成，也称为滤波器，它以滑动窗口的方式从输入中提取特征。每次操作后，该滤波器在输入端移动一个称为<strong class="je hv">步长的量。</strong>在每个操作中，计算输入的内核和当前区域的矩阵乘法。可以堆叠过滤器来创建输入的高维表示。</p><blockquote class="nd"><p id="7572" class="ne nf hu bd ng nh ni nj nk nl nm jz ek translated">如果过滤器没有均匀地映射到输入的大小，会发生什么？</p></blockquote><p id="6ae6" class="pw-post-body-paragraph jc jd hu je b jf nn jh ji jj no jl jm jn np jp jq jr nq jt ju jv nr jx jy jz hn dt translated">有两种方式处理不同的过滤器尺寸和输入尺寸，称为<strong class="je hv">相同的</strong>填充和<strong class="je hv">有效的</strong>填充<strong class="je hv">。</strong>相同的填充会用零填充输入边界(如上所示),以确保输入宽度和高度被保留。有效填充不填充。</p><p id="4e57" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通常，您会希望使用相同的填充，或者您会迅速减少输入的维数。</p><p id="a8d9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，应用一个激活函数(通常是一个<a class="ae ka" href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)" rel="noopener ugc nofollow" target="_blank"> ReLU </a>)来给出卷积非线性。ReLU与其他激活函数有点不同，如sigmoid或tanh，因为ReLU是单侧的。这种单侧属性允许网络创建稀疏表示(隐藏单元的零值)，从而提高计算效率。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff ns"><img src="../Images/3162c600e8de32bd937bcdd355da168f.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*5dklg6CDKStDhmkL2SPfmA.png"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">ReLU</figcaption></figure><p id="5535" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">联营</strong></p><p id="e514" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">池化是一种降维操作。它应用了一个总结相邻信息的函数。两个常见的函数是最大池和平均池。通过计算输入区域的最大值，输出汇总了周围值的强度。</p><p id="6138" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">池层也有一个内核，填充，并在大步移动。要计算池化操作的输出大小，可以使用以下公式</p><pre class="kc kd ke kf fq nt nu nv nw aw nx dt"><span id="e758" class="mj kh hu nu b fv ny nz l oa ob"> (Input Width - kernel width + 2 * padding) / strides + 1. </span></pre><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff oc"><img src="../Images/c0a3ff1792d0a5e0a49bfe42bf977faf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ixw2W_3ZPiaerKNOrEcXig.jpeg"/></div></div></figure><p id="4cd8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">全连接层</strong></p><p id="712a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可能从神经网络中熟悉的完全连接的层。输入中的每个神经元都连接到输出中的每个神经元；完全连接。由于这种连接性，输出中的每个神经元将最多被使用一次。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff od"><img src="../Images/d378225c1a217e76e15e69740fa82f3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:176/1*JnvYW8ehgC92BYY9v9ZXZg.gif"/></div></figure><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff oe"><img src="../Images/43893cb0f429408bbbabc139f54eaf91.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*Kdnux0Kw1yQ4D8dq__mYCA.png"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Fully connected neural network</figcaption></figure><p id="6eb7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在CNN中，输入从汇集层馈入全连接层。根据任务，可以应用回归或分类算法来创建所需的输出。</p><p id="2c36" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">回顾</strong></p><p id="d7b5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您现在已经了解了卷积神经网络的构成。通过卷积传递输入，可以提取高维特征。汇集汇总了空间信息并降低了维度。最后，该特征表示通过完全连接的层传递到分类器或回归器。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff of"><img src="../Images/8fa83c805a3cd6ad6beee0b7635270cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbuW8WuRrAY5pC4t-9DZAQ.jpeg"/></div></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Full CNN Architecture (<a class="ae ka" href="https://www.mathworks.com/content/mathworks/www/en/discovery/convolutional-neural-network/jcr:content/mainParsys/image_copy.adapt.full.high.jpg/1492406018870.jpg" rel="noopener ugc nofollow" target="_blank">source</a>)</figcaption></figure></div><div class="ab cl lu lv hc lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hn ho hp hq hr"><h1 id="b5a1" class="kg kh hu bd ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz mf lb lc ld dt translated">在Tensorflow中创建CNN</h1><p id="7346" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">现在您已经有了卷积神经网络背后的想法，您将在Tensorflow中编写一个。</p><p id="7523" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你将创建一个CNN来训练<a class="ae ka" href="https://pjreddie.com/projects/mnist-in-csv/" rel="noopener ugc nofollow" target="_blank"> MNIST(手写数字的图像)数据集</a>。训练后，你将在10k次迭代中达到大约98.0%的准确率。</p><p id="9501" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">设置环境</strong></p><p id="95b6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先您需要设置您的环境。此外，您将创建一个setup.py文件。下面列出了python3.5和python2.7的Anaconda环境文件。</p><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="og oh l"/></div></figure><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="og oh l"/></div></figure><p id="4863" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果不使用anaconda，可以通过pip安装tensorflow:</p><pre class="kc kd ke kf fq nt nu nv nw aw nx dt"><span id="0ec3" class="mj kh hu nu b fv ny nz l oa ob">$ pip install tensorflow</span></pre><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="og oh l"/></div></figure><p id="2a94" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">运行:</p><pre class="kc kd ke kf fq nt nu nv nw aw nx dt"><span id="b82a" class="mj kh hu nu b fv ny nz l oa ob">python3 setup.py develop</span></pre><h1 id="2862" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">数据</h1><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff oi"><img src="../Images/4b82f0e9b69fecb94430d3eec6e9e4be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*llfCENtH771mzqPs3SGabA.png"/></div></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Mnist Data</figcaption></figure><p id="23c1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，您将创建3个独立的输入；训练集、验证集和测试集。通过提供额外的数据来调整超参数，验证集允许您更好地训练模型。</p><p id="7c35" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">下载数据</strong></p><p id="4a35" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">可以使用以下命令检索数据:</p><pre class="kc kd ke kf fq nt nu nv nw aw nx dt"><span id="c68f" class="mj kh hu nu b fv ny nz l oa ob">$ curl <a class="ae ka" href="https://pjreddie.com/media/files/mnist_train.csv" rel="noopener ugc nofollow" target="_blank">https://pjreddie.com/media/files/mnist_train.csv</a> -o data/mnist_train.csv # 104 MB</span><span id="a59c" class="mj kh hu nu b fv oj nz l oa ob">$ curl <a class="ae ka" href="https://pjreddie.com/media/files/mnist_test.csv" rel="noopener ugc nofollow" target="_blank">https://pjreddie.com/media/files/mnist_test.csv</a> -o data/mnist_test.csv # 17.4 MB</span></pre><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="og oh l"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">mnist.py</figcaption></figure><h2 id="a243" class="mj kh hu bd ki mk ml mm km mn mo mp kq jn mq mr ku jr ms mt ky jv mu mv lc mw dt translated">体系结构</h2><p id="e950" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">在这里，您将创建一些用于创建网络的辅助函数。这些函数用于创建前面讨论过的单个组件。</p><p id="c7e1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">辅助功能/模型定义:</strong></p><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="og oh l"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Helper Functions and Model Definition</figcaption></figure><p id="d24c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">型号</strong></p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ok"><img src="../Images/9a38ad14be71adbae3b866d6646e0068.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fUR04A6OBbjmgQ-QJ87-Lg.png"/></div></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Tensorflow Graph of Model</figcaption></figure><p id="d8bf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是训练模型的代码。三个公共函数解释如下:</p><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="og oh l"/></div></figure><blockquote class="ol om on"><p id="cab6" class="jc jd nc je b jf jg jh ji jj jk jl jm oo jo jp jq op js jt ju oq jw jx jy jz hn dt translated">代码在这里:<a class="ae ka" href="https://github.com/ColeMurray/tensorflow-cnn-tutorial/tree/add_model_functions" rel="noopener ugc nofollow" target="_blank">https://github . com/cole Murray/tensor flow-CNN-tutorial/tree/add _ model _ functions</a></p></blockquote><p id="4b7c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">推论。</strong> <em class="nc"> </em>这个函数负责创建一个它认为输入代表的预测。这里，它将为每个输入返回一个1x10张量。包含在该张量中的值将被传递给损失函数，以确定该预测与真实情况有多远。</p><p id="b9c6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如batch_size超级参数所示，您一次处理128个图像。这种技术被称为小批量。通过以较小的批次处理输入，而不是整个数据集，输入可以适合内存。此外，由于在每一批之后而不是在处理完所有的例子之后更新权重，该模型将更快地收敛。</p><p id="95d5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> <em class="nc">失落。</em> </strong>这里，您将使用softmax交叉熵函数来执行N路分类。softmax函数用于对推理函数产生的输入进行归一化(将张量相加为一)。</p><p id="2a7a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">利用这个归一化张量，针对一个热编码标签计算交叉熵。交叉熵给出了预测离真实情况有多远的度量。每次迭代，应用一个优化器来最小化这个交叉熵。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff or"><img src="../Images/6f57bac9e0c1b5ff394383926f98ba04.png" data-original-src="https://miro.medium.com/v2/resize:fit:280/1*yoVaLBlsQhytzMDbfx300g.gif"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">cross entropy</figcaption></figure><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff os"><img src="../Images/f47c167bcb2dfb48ab0c685f23f8f2d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0U4IG8NWW3c1W3XbG-09jA.png"/></div></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Loss after training</figcaption></figure><h2 id="a598" class="mj kh hu bd ki mk ml mm km mn mo mp kq jn mq mr ku jr ms mt ky jv mu mv lc mw dt translated">培训和评估</h2><p id="5679" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">下面，您将为10k迭代训练模型。每1000次迭代，您将根据验证集测试模型，以了解准确性。最后，您将根据测试数据集评估训练好的模型，以获得样本外准确性的度量。在10k次迭代时，您应该看到大约98.0%的准确性。</p><p id="ec98" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要执行此代码，请运行以下命令:</p><pre class="kc kd ke kf fq nt nu nv nw aw nx dt"><span id="1c79" class="mj kh hu nu b fv ny nz l oa ob">$ python3 mnist_conv2d_medium_tutorial/train.py</span><span id="a16e" class="mj kh hu nu b fv oj nz l oa ob"><em class="nc">(Building the computational graph can take a few seconds depending on hardware)</em></span></pre><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="og oh l"/></div></figure><p id="b8bf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有了训练好的模型，您现在将在来自上一个检查点的测试集上对它进行评估。</p><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="og oh l"/></div></figure><pre class="kc kd ke kf fq nt nu nv nw aw nx dt"><span id="57a4" class="mj kh hu nu b fv ny nz l oa ob">$ python3 mnist_conv2d_medium_tutorial/evaluate.py</span></pre><blockquote class="ol om on"><p id="039c" class="jc jd nc je b jf jg jh ji jj jk jl jm oo jo jp jq op js jt ju oq jw jx jy jz hn dt translated">到目前为止的代码:<a class="ae ka" href="https://github.com/ColeMurray/tensorflow-cnn-tutorial/tree/train_and_evaluate" rel="noopener ugc nofollow" target="_blank">https://github . com/cole Murray/tensor flow-CNN-tutorial/tree/train _ and _ evaluate</a></p></blockquote><p id="61d4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以通过运行以下命令来可视化您的结果:</p><pre class="kc kd ke kf fq nt nu nv nw aw nx dt"><span id="b4c2" class="mj kh hu nu b fv ny nz l oa ob">$ tensorboard --logdir=graphs/ --port=6006</span><span id="cf9d" class="mj kh hu nu b fv oj nz l oa ob">navigate in browser: localhost:6006</span></pre></div><div class="ab cl lu lv hc lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hn ho hp hq hr"><h1 id="5c89" class="kg kh hu bd ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz mf lb lc ld dt translated">在GPU上训练</h1><p id="71a7" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">正如你所注意到的，由于每次迭代所需的计算量，训练CNN可能非常慢。现在，您将使用GPU来加速计算。</p><p id="b438" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">默认情况下，如果CPU和GPU都可用于给定的操作，Tensorflow在放置操作时会给予GPU更高的优先级。为了简化教程，您不会显式定义操作位置。你可以在这里阅读更多关于如何做这件事的<a class="ae ka" href="https://www.tensorflow.org/tutorials/using_gpu" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="f1f7" class="mj kh hu bd ki mk ml mm km mn mo mp kq jn mq mr ku jr ms mt ky jv mu mv lc mw dt translated">创建一个GPU盒子</h2><p id="da5d" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">对于本教程，您将使用一个社区AMI。转到AWS控制台，启动一个新的EC2实例。在AMI屏幕上，选择community并输入AMI id: <strong class="je hv"> ami-5e853c48。</strong>这款AMI自带Tensorflow和Nvidia驱动，预装CUDA。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ot"><img src="../Images/10ea987e28897ec460c27f6b14eb3f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ht_GJ2WfTCf1RwlJFwO0zg.png"/></div></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Ami id: <strong class="bd ou">ami-5e853c48</strong></figcaption></figure><p id="49cb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于实例类型，选择G2.2xlarge。选择实例类型后，请确保创建一个密钥对。这个密匙对将允许您<a class="ae ka" href="https://en.wikipedia.org/wiki/Secure_Shell" rel="noopener ugc nofollow" target="_blank"> ssh </a>进入实例并复制/执行您的代码。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ov"><img src="../Images/e9be42b474ef09e96337cf56c6749acf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QSxuckLyy7-lDNnE6r269g.png"/></div></div><figcaption class="my mz fg fe ff na nb bd b be z ek">G2.2xlarge</figcaption></figure><p id="4da7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">同步你的代码</strong></p><p id="d3e6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">既然已经创建了实例，您需要将代码和数据集复制到其上。最简单的方法是使用rsync。<a class="ae ka" href="https://linux.die.net/man/1/rsync" rel="noopener ugc nofollow" target="_blank"> Rsync </a>是构建在ssh之上的unix命令，允许高效的文件传输。它非常灵活，提供了多种选项来直接改变行为。下面，该命令会将您的项目目录复制到您的gpu实例用户的主目录。</p><pre class="kc kd ke kf fq nt nu nv nw aw nx dt"><span id="44fb" class="mj kh hu nu b fv ny nz l oa ob">rsync -trucv mnist_conv2d_medium_tutorial <strong class="nu hv">ip-address-of-your-gpu-box:/home/ubuntu/</strong></span></pre><p id="e494" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">运行代码</strong></p><p id="b6bc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面，您将ssh到实例并安装软件包。安装后，运行train命令。运行train命令后，您将看到输出，指示操作的位置。如下所示，操作按预期被放置到gpu上。</p><pre class="kc kd ke kf fq nt nu nv nw aw nx dt"><span id="a01a" class="mj kh hu nu b fv ny nz l oa ob">$ ssh ubuntu@ip-address-of-your-gpu-box<br/>$ cd mnist-conv2d-medium-tutorial<br/>$ pip3 install .<br/>$ python3 mnist_conv2d_medium_tutorial/train.py</span></pre><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ow"><img src="../Images/4c75a17d182bf907961d4cfee7f92b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJDHnJWa5pbNwAbulk3hxg.png"/></div></div><figcaption class="my mz fg fe ff na nb bd b be z ek">Operations being placed on GPU</figcaption></figure><p id="b4b3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">大约20分钟后，培训将完成，您可以运行evaluate命令根据测试集进行测试。</p><pre class="kc kd ke kf fq nt nu nv nw aw nx dt"><span id="fbb3" class="mj kh hu nu b fv ny nz l oa ob">$ python3 mnist_conv2d_medium_tutorial/evaluate.py</span></pre><p id="9b2f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">结论</strong></p><p id="0013" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本教程中，您学习了卷积神经网络背后的概念。此外，您还学习了基本CNN的Tensorflow实现，实现了大约98.0%的准确率。最后，您学习了如何在GPU上运行代码以提高性能。</p><p id="af23" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此处为完整代码:</p><div class="ox oy fm fo oz pa"><a href="https://github.com/ColeMurray/tensorflow-cnn-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="pb ab ej"><div class="pc ab pd cl cj pe"><h2 class="bd hv fv z el pf eo ep pg er et ht dt translated">cole Murray/tensor flow-CNN-教程</h2><div class="ph l"><h3 class="bd b fv z el pf eo ep pg er et ek translated">关于卷积神经网络的教程。</h3></div><div class="pi l"><p class="bd b gc z el pf eo ep pg er et ek translated">github.com</p></div></div><div class="pj l"><div class="pk l pl pm pn pj po ja pa"/></div></div></a></div><p id="dc76" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">下一步:</strong></p><ul class=""><li id="22b7" class="le lf hu je b jf jg jj jk jn pp jr pq jv pr jz ll lm ln lo dt translated">使用超参数(批量大小、<a class="ae ka" href="https://hackernoon.com/tagged/learning" rel="noopener ugc nofollow" target="_blank">学习</a>速率、内核大小、迭代次数)来查看它如何影响模型性能</li><li id="0f5e" class="le lf hu je b jf lp jj lq jn lr jr ls jv lt jz ll lm ln lo dt translated">根据其他数据集训练和评估您的模型(<a class="ae ka" href="https://www.cs.toronto.edu/~kriz/cifar.html" rel="noopener ugc nofollow" target="_blank"> CIFAR-10 </a>)</li><li id="9df2" class="le lf hu je b jf lp jj lq jn lr jr ls jv lt jz ll lm ln lo dt translated">深入一点</li></ul></div><div class="ab cl lu lv hc lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hn ho hp hq hr"><h1 id="f2c7" class="kg kh hu bd ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz mf lb lc ld dt translated"><strong class="ak">行动号召:</strong></h1><blockquote class="ol om on"><p id="dca0" class="jc jd nc je b jf jg jh ji jj jk jl jm oo jo jp jq op js jt ju oq jw jx jy jz hn dt translated">如果你喜欢这个教程，请关注并推荐！</p><p id="2ead" class="jc jd nc je b jf jg jh ji jj jk jl jm oo jo jp jq op js jt ju oq jw jx jy jz hn dt translated">有兴趣了解更多关于深度学习/机器学习的知识吗？查看我的其他教程:</p><p id="dbbd" class="jc jd nc je b jf jg jh ji jj jk jl jm oo jo jp jq op js jt ju oq jw jx jy jz hn dt translated"><a class="ae ka" rel="noopener" href="/google-cloud/keras-inception-v3-on-google-compute-engine-a54918b0058"> -在谷歌计算引擎上使用Keras进行深度学习</a></p><p id="ea59" class="jc jd nc je b jf jg jh ji jj jk jl jm oo jo jp jq op js jt ju oq jw jx jy jz hn dt translated"><a class="ae ka" rel="noopener" href="/google-cloud/recommendation-systems-with-spark-on-google-dataproc-bbb276c0dafd"> -谷歌计算引擎上的Apache Spark推荐系统</a></p><p id="d08b" class="jc jd nc je b jf jg jh ji jj jk jl jm oo jo jp jq op js jt ju oq jw jx jy jz hn dt translated">你可以在其他地方找到我:</p><p id="3d78" class="jc jd nc je b jf jg jh ji jj jk jl jm oo jo jp jq op js jt ju oq jw jx jy jz hn dt translated">——推特:<a class="ae ka" href="https://twitter.com/_ColeMurray" rel="noopener ugc nofollow" target="_blank">https://twitter.com/_ColeMurray</a></p></blockquote><div class="kc kd ke kf fq ab cb"><figure class="ps iv pt pu pv pw px paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ps iv pt pu pv pw px paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ps iv pt pu pv pw px paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ol om on"><p id="f922" class="jc jd nc je b jf jg jh ji jj jk jl jm oo jo jp jq op js jt ju oq jw jx jy jz hn dt translated"><a class="ae ka" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ka" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ka" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae ka" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd nc je b jf jg jh ji jj jk jl jm oo jo jp jq op js jt ju oq jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ka" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ka" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff py"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="kc kd ke kf fq iv"><div class="bz el l di"><div class="pz oh l"/></div></figure></div></div>    
</body>
</html>