<html>
<head>
<title>Serverless ‘contact us’ form for static websites</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">静态网站的无服务器“联系我们”表单</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/serverless-contact-us-form-for-static-websites-facccb7be27f?source=collection_archive---------8-----------------------#2017-08-22">https://medium.com/hackernoon/serverless-contact-us-form-for-static-websites-facccb7be27f?source=collection_archive---------8-----------------------#2017-08-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="bba0" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">启动简单、易于使用、可扩展且价格低廉！</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/07064a8f3201aedaeab2451bad2473de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-XA0bzWy_ZlIkf5cK7oiUA.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Serverless ‘Contact Us’ Stack</figcaption></figure><p id="af87" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">你是否曾想在你的静态网站上添加一个“联系我们”的表单，但又不想花钱买一个全天候运行的后端服务器来处理这些请求？我也是。这就是为什么我建立了这个<a class="ae kv" href="https://github.com/thestackshack/serverless-contact-us-form" rel="noopener ugc nofollow" target="_blank">便利的云形成栈</a>，它通过AWS API网关&amp; Lambda创建一个单一的API端点。</p><p id="0449" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">后端验证Google reCAPTCHA并通过SNS发送电子邮件。</p><blockquote class="kw"><p id="0a69" class="kx ky hu bd kz la lb lc ld le lf ku ek translated">只需启动CloudFormation堆栈并添加您的“联系我们”表单！就这么简单。</p></blockquote><figure class="lh li lj lk ll jo fe ff paragraph-image"><a href="https://console.aws.amazon.com/cloudformation/home#/stacks/new?stackName=&amp;templateURL=https://s3.amazonaws.com/thestackshack/serverless-contact-us-form/cloudformation.yml"><div class="fe ff lg"><img src="../Images/041e2bb303b11c98a9ae4c877b418cc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*Z2PO_ioDZEow7eb3SD6rsg.png"/></div></a><figcaption class="jv jw fg fe ff jx jy bd b be z ek">click here to launch the stack</figcaption></figure></div><div class="ab cl lm ln hc lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hn ho hp hq hr"><h1 id="ac7b" class="lt lu hu bd lv lw lx ly lz ma mb mc md ja me jb mf jd mg je mh jg mi jh mj mk dt translated">让我们看看这个堆栈是如何工作的</h1><p id="a953" class="pw-post-body-paragraph jz ka hu kb b kc ml iv ke kf mm iy kh ki mn kk kl km mo ko kp kq mp ks kt ku hn dt translated">你可以在这里看到整个筹码<a class="ae kv" href="https://github.com/thestackshack/serverless-contact-us-form/blob/master/cloudformation.yml" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="a669" class="mq lu hu bd lv mr ms mt lz mu mv mw md ki mx my mf km mz na mh kq nb nc mj nd dt translated">输入参数</h2><p id="e099" class="pw-post-body-paragraph jz ka hu kb b kc ml iv ke kf mm iy kh ki mn kk kl km mo ko kp kq mp ks kt ku hn dt translated">有2个输入参数:</p><ol class=""><li id="6184" class="ne nf hu kb b kc kd kf kg ki ng km nh kq ni ku nj nk nl nm dt translated"><strong class="kb hv">电子邮件地址</strong> —您希望“联系我们”表单提交到的电子邮件地址。您必须使用此地址验证SNS主题订阅。</li><li id="ca50" class="ne nf hu kb b kc nn kf no ki np km nq kq nr ku nj nk nl nm dt translated"><strong class="kb hv">reCAPTCHA secret</strong>——你可以在这里获得你的reCAPTCHA秘密:<a class="ae kv" href="https://www.google.com/recaptcha/admin" rel="noopener ugc nofollow" target="_blank">https://www.google.com/recaptcha/admin</a></li></ol><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="3262" class="mq lu hu nt b fv nx ny l nz oa"><strong class="nt hv">Metadata:<br/>  AWS::CloudFormation::Interface:<br/>    ParameterGroups:<br/>      </strong>-<br/>        <strong class="nt hv">Label:<br/>          default: </strong>"Configuration"<br/>        <strong class="nt hv">Parameters:<br/>          </strong>- ToEmailAddress<br/>          - ReCaptchaSecret<br/><strong class="nt hv">Parameters:<br/>  ToEmailAddress:<br/>    Type: </strong>String<br/>    <strong class="nt hv">Description: </strong>Email address you want contact form submittions to go to<br/>  <strong class="nt hv">ReCaptchaSecret:<br/>    Type: </strong>String<br/>    <strong class="nt hv">Description: </strong>Your Google reCAPTCHA secret</span></pre><p id="32e6" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated"><em class="ob">元数据</em>部分描述了当您使用此模板时，哪些参数将显示在AWS CloudFormation“创建新堆栈”向导中。这使得用户只需点击上面的按钮就可以轻松创建他们的堆栈。</p><h2 id="5647" class="mq lu hu bd lv mr ms mt lz mu mv mw md ki mx my mf km mz na mh kq nb nc mj nd dt translated">社交网络话题</h2><p id="9043" class="pw-post-body-paragraph jz ka hu kb b kc ml iv ke kf mm iy kh ki mn kk kl km mo ko kp kq mp ks kt ku hn dt translated">我们用一个内嵌订阅创建了一个新的SNS主题。订阅是您提供的电子邮件地址。我们处理“联系我们”表单提交的Lambda会将表单发布到SNS主题，然后SNS主题会向您发送电子邮件。</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="49dd" class="mq lu hu nt b fv nx ny l nz oa"><strong class="nt hv">ContactUsSNSTopic:<br/>  Type: </strong>AWS::SNS::Topic<br/>  <strong class="nt hv">Properties:<br/>    DisplayName:<br/>      Fn::Join:<br/>        </strong>- ''<br/>        - - <strong class="nt hv">Ref: </strong>AWS::StackName<br/>          - ' Topic'<br/>    <strong class="nt hv">Subscription:<br/>      </strong>- <strong class="nt hv">Endpoint: </strong>!Ref ToEmailAddress<br/>        <strong class="nt hv">Protocol: </strong>email<br/>    <strong class="nt hv">TopicName:<br/>      Fn::Join:<br/>        </strong>- ''<br/>        - - <strong class="nt hv">Ref: </strong>AWS::StackName<br/>          - '-topic'</span></pre><h2 id="0913" class="mq lu hu bd lv mr ms mt lz mu mv mw md ki mx my mf km mz na mh kq nb nc mj nd dt translated">Lambda IAM角色</h2><p id="6e07" class="pw-post-body-paragraph jz ka hu kb b kc ml iv ke kf mm iy kh ki mn kk kl km mo ko kp kq mp ks kt ku hn dt translated">我们需要为Lambda创建一个IAM角色，赋予Lambda访问其他AWS资源的权限。</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="5d53" class="mq lu hu nt b fv nx ny l nz oa"><em class="ob">#<br/># Role that our Lambda will assume to provide access to other AWS resources<br/>#<br/></em><strong class="nt hv">IamRoleLambdaExecution:<br/>  Type: </strong>AWS::IAM::Role<br/>  <strong class="nt hv">Properties:<br/>    AssumeRolePolicyDocument:<br/>      Version: </strong>'2012-10-17'<br/>      <strong class="nt hv">Statement:<br/>        </strong>- <strong class="nt hv">Effect: </strong>Allow<br/>          <strong class="nt hv">Principal:<br/>            Service:<br/>              </strong>- lambda.amazonaws.com<br/>          <strong class="nt hv">Action:<br/>            </strong>- sts:AssumeRole<br/>    <strong class="nt hv">Path: </strong>'/'<br/><br/><em class="ob">#<br/># Create a Policy and attach it to our Lambda Role.<br/>#<br/></em><strong class="nt hv">IamPolicyLambdaExecution:<br/>  Type: </strong>AWS::IAM::Policy<br/>  <strong class="nt hv">Properties:<br/>    PolicyName: </strong>IamPolicyLambdaExecution<br/>    <strong class="nt hv">PolicyDocument:<br/>      Version: </strong>'2012-10-17'<br/>      <strong class="nt hv">Statement:<br/>      </strong>- <strong class="nt hv">Effect: </strong>Allow<br/>        <strong class="nt hv">Action:<br/>          </strong>- logs:CreateLogGroup<br/>          - logs:CreateLogStream<br/>        <strong class="nt hv">Resource: </strong>arn:aws:logs:us-east-1:*:*<br/>      - <strong class="nt hv">Effect: </strong>Allow<br/>        <strong class="nt hv">Action:<br/>          </strong>- logs:PutLogEvents<br/>        <strong class="nt hv">Resource: </strong>arn:aws:logs:us-east-1:*:*<br/>        <strong class="nt hv">Resource: </strong>'*'<br/>      - <strong class="nt hv">Effect: </strong>Allow<br/>        <strong class="nt hv">Action:<br/>          </strong>- sns:Publish<br/>        <strong class="nt hv">Resource: </strong>!Ref ContactUsSNSTopic<br/>    <strong class="nt hv">Roles:<br/>    </strong>- <strong class="nt hv">Ref: </strong>IamRoleLambdaExecution</span></pre><p id="4e65" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">我们的Lambda需要访问AWS CloudWatch日志，这样它才能写日志。它还需要<strong class="kb hv">发布</strong>访问我们的SNS主题，这样它就可以发布到主题。</p><h2 id="b587" class="mq lu hu bd lv mr ms mt lz mu mv mw md ki mx my mf km mz na mh kq nb nc mj nd dt translated">希腊字母的第11个</h2><p id="6639" class="pw-post-body-paragraph jz ka hu kb b kc ml iv ke kf mm iy kh ki mn kk kl km mo ko kp kq mp ks kt ku hn dt translated">我们的lambda通过API Gateway接收“联系我们”表单提交，然后将表单细节发布到我们的SNS主题。</p><p id="ed3f" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">我们在CloudFormation模板中内嵌了Lambda代码。我们这样做是为了有一个简单的部署过程。用户只需点击上面的按钮即可部署整个堆栈。</p><p id="624f" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">我们还想在代码中引用CloudFormation参数。参见<code class="eh oc od oe nt b">${ReCaptchaSecret}</code>和<code class="eh oc od oe nt b">${ContactUsSNSTopic}</code>。</p><p id="c4d4" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">如果lambda大于4096个字符，你就不能内嵌它，你必须先把Lambda上传到S3，然后包含一个引用。</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="5d70" class="mq lu hu nt b fv nx ny l nz oa"><strong class="nt hv">ContactUsFunction:<br/>  Type: </strong>AWS::Lambda::Function<br/>  <strong class="nt hv">Properties:<br/>    Handler: </strong>index.handler<br/>    <strong class="nt hv">Timeout: </strong>5<br/>    <strong class="nt hv">Role:<br/>      Fn::GetAtt:<br/>        </strong>- IamRoleLambdaExecution<br/>        - Arn<br/>    <strong class="nt hv">Code:<br/>      ZipFile: </strong>!Sub | <br/>        &lt;inline code&gt;<br/>  <strong class="nt hv">Runtime: </strong>nodejs6.10</span></pre><p id="dc84" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">λ代码:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="of og l"/></div></figure><p id="779a" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">看看我们添加的CORS标题。当发布到API网关端点时，这些是必需的。</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="71df" class="mq lu hu nt b fv nx ny l nz oa">headers: {<br/>  "Access-Control-Allow-Origin" : "*", // Required for CORS support to work<br/>  "Access-Control-Allow-Credentials" : true // Required for cookies, authorization headers with HTTPS<br/>},</span></pre><h2 id="d13e" class="mq lu hu bd lv mr ms mt lz mu mv mw md ki mx my mf km mz na mh kq nb nc mj nd dt translated">API网关</h2><p id="6f27" class="pw-post-body-paragraph jz ka hu kb b kc ml iv ke kf mm iy kh ki mn kk kl km mo ko kp kq mp ks kt ku hn dt translated"><code class="eh oc od oe nt b">AWS::ApiGateway::RestApi</code>资源包含一组Amazon API网关资源和方法，可以通过HTTPS端点调用。</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="dbc8" class="mq lu hu nt b fv nx ny l nz oa"><strong class="nt hv">ApiGatewayContactUs:<br/>  Type: </strong>AWS::ApiGateway::RestApi<br/>  <strong class="nt hv">Properties:<br/>    Name: </strong>ApiGatewayContactUs</span></pre><p id="e117" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated"><code class="eh oc od oe nt b">AWS::ApiGateway::Resource</code>资源在Amazon API Gateway(API Gateway)API中创建一个资源。</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="acd6" class="mq lu hu nt b fv nx ny l nz oa"><strong class="nt hv">ApiGatewayResource:<br/>  Type: </strong>AWS::ApiGateway::Resource<br/>  <strong class="nt hv">Properties:<br/>    ParentId:<br/>      Fn::GetAtt:<br/>        </strong>- ApiGatewayContactUs<br/>        - RootResourceId<br/>    <strong class="nt hv">PathPart: </strong>api<br/>    <strong class="nt hv">RestApiId:<br/>      Ref: </strong>ApiGatewayContactUs</span></pre><p id="3c24" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">现在我们需要添加两个方法的<code class="eh oc od oe nt b">Options</code>和<code class="eh oc od oe nt b">Post</code>。<code class="eh oc od oe nt b">Options</code>方法将处理CORS标题，而<code class="eh oc od oe nt b">Post</code>方法将处理“联系我们”表单提交。</p><p id="36fb" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">CORS期权方法:</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="e035" class="mq lu hu nt b fv nx ny l nz oa"><strong class="nt hv">ApiGatewayMethodOptions:<br/>  Type: </strong>AWS::ApiGateway::Method<br/>  <strong class="nt hv">Properties:<br/>    AuthorizationType: </strong>NONE<br/>    <strong class="nt hv">ResourceId:<br/>      Ref: </strong>ApiGatewayResource<br/>    <strong class="nt hv">RestApiId:<br/>      Ref: </strong>ApiGatewayContactUs<br/>    <strong class="nt hv">HttpMethod: </strong>OPTIONS<br/>    <strong class="nt hv">Integration:<br/>      IntegrationResponses:<br/>      </strong>- <strong class="nt hv">StatusCode: </strong>200<br/>        <strong class="nt hv">ResponseParameters:<br/>          method.response.header.Access-Control-Allow-Headers: </strong>"'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'"<br/>          <strong class="nt hv">method.response.header.Access-Control-Allow-Methods: </strong>"'POST,OPTIONS'"<br/>          <strong class="nt hv">method.response.header.Access-Control-Allow-Origin: </strong>"'*'"<br/>          <strong class="nt hv">method.response.header.Access-Control-Allow-Credentials: </strong>"'false'"<br/>        <strong class="nt hv">ResponseTemplates:<br/>          application/json: </strong>''<br/>      <strong class="nt hv">PassthroughBehavior: </strong>WHEN_NO_MATCH<br/>      <strong class="nt hv">RequestTemplates:<br/>        application/json: </strong>'{"statusCode": 200}'<br/>      <strong class="nt hv">Type: </strong>MOCK<br/>    <strong class="nt hv">MethodResponses:<br/>    </strong>- <strong class="nt hv">StatusCode: </strong>200<br/>      <strong class="nt hv">ResponseModels:<br/>        application/json: </strong>'Empty'<br/>      <strong class="nt hv">ResponseParameters:<br/>          method.response.header.Access-Control-Allow-Headers: </strong>false<br/>          <strong class="nt hv">method.response.header.Access-Control-Allow-Methods: </strong>false<br/>          <strong class="nt hv">method.response.header.Access-Control-Allow-Origin: </strong>false<br/>          <strong class="nt hv">method.response.header.Access-Control-Allow-Credentials: </strong>true</span></pre><p id="443f" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">发布方法:</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="a8d3" class="mq lu hu nt b fv nx ny l nz oa"><strong class="nt hv">ApiGatewayMethodPost:<br/>  Type: </strong>AWS::ApiGateway::Method<br/>  <strong class="nt hv">Properties:<br/>    HttpMethod: </strong>POST<br/>    <strong class="nt hv">RequestParameters: </strong>{}<br/>    <strong class="nt hv">ResourceId:<br/>      Ref: </strong>ApiGatewayResource<br/>    <strong class="nt hv">RestApiId:<br/>      Ref: </strong>ApiGatewayContactUs<br/>    <strong class="nt hv">AuthorizationType: </strong>NONE<br/>    <strong class="nt hv">Integration:<br/>      IntegrationHttpMethod: </strong>POST<br/>      <strong class="nt hv">Type: </strong>AWS_PROXY<br/>      <strong class="nt hv">Uri:<br/>        Fn::Join:<br/>          </strong>- ''<br/>          - - 'arn:aws:apigateway:'<br/>            - <strong class="nt hv">Ref: </strong>AWS::Region<br/>            - ':lambda:path/2015-03-31/functions/'<br/>            - <strong class="nt hv">Fn::GetAtt:<br/>              </strong>- ContactUsFunction<br/>              - Arn<br/>            - '/invocations'<br/>    <strong class="nt hv">MethodResponses: </strong>[]</span></pre><p id="5802" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">这个方法使用Api网关<code class="eh oc od oe nt b">AWS_PROXY</code> Lambda集成类型。</p><blockquote class="oh oi oj"><p id="e280" class="jz ka ob kb b kc kd iv ke kf kg iy kh ok kj kk kl ol kn ko kp om kr ks kt ku hn dt translated">在API Gateway REST API中用<code class="eh oc od oe nt b">AWS_PROXY</code>表示的Lambda代理集成用于在后端集成方法请求和Lambda函数。使用这种集成类型，API Gateway应用默认映射模板将整个请求发送到Lambda函数，并将Lambda函数的输出转换为HTTP响应。</p></blockquote><p id="e194" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated"><code class="eh oc od oe nt b">AWS::ApiGateway::Deployment</code>资源将Amazon API Gateway(API Gateway)<code class="eh oc od oe nt b"><a class="ae kv" href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-restapi.html" rel="noopener ugc nofollow" target="_blank">RestApi</a></code>资源部署到一个阶段，以便客户端可以通过互联网调用API。舞台就像一个环境。</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="b197" class="mq lu hu nt b fv nx ny l nz oa"><strong class="nt hv">ApiGatewayDeployment:<br/>  Type: </strong>AWS::ApiGateway::Deployment<br/>  <strong class="nt hv">Properties:<br/>    RestApiId:<br/>      Ref: </strong>ApiGatewayContactUs<br/>    <strong class="nt hv">StageName: </strong>prod<br/>  <strong class="nt hv">DependsOn:<br/>  </strong>- ApiGatewayMethodPost<br/>  - ApiGatewayMethodOptions</span></pre><p id="94d3" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">最后，我们需要授予Api网关端点调用Lambda的权限。</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="f2e9" class="mq lu hu nt b fv nx ny l nz oa"><strong class="nt hv">ContactUsFunctionPermission:<br/>  Type: </strong>AWS::Lambda::Permission<br/>  <strong class="nt hv">Properties:<br/>    Action: </strong>lambda:invokeFunction<br/>    <strong class="nt hv">FunctionName:<br/>      Ref: </strong>ContactUsFunction<br/>    <strong class="nt hv">Principal: </strong>apigateway.amazonaws.com<br/>    <strong class="nt hv">SourceArn:<br/>      Fn::Join:<br/>        </strong>- ''<br/>        - - 'arn:aws:execute-api:'<br/>          - <strong class="nt hv">Ref: </strong>AWS::Region<br/>          - ':'<br/>          - <strong class="nt hv">Ref: </strong>AWS::AccountId<br/>          - ':'<br/>          - <strong class="nt hv">Ref: </strong>ApiGatewayContactUs<br/>          - '/*/*'</span></pre><h2 id="8a06" class="mq lu hu bd lv mr ms mt lz mu mv mw md ki mx my mf km mz na mh kq nb nc mj nd dt translated">输出</h2><p id="0e0b" class="pw-post-body-paragraph jz ka hu kb b kc ml iv ke kf mm iy kh ki mn kk kl km mo ko kp kq mp ks kt ku hn dt translated">我们现在在我们的云形成脚本的末尾。让我们输出新的API网关端点，以便在“联系我们”表单中使用它。</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="09ef" class="mq lu hu nt b fv nx ny l nz oa"><strong class="nt hv">Outputs:<br/>  ApiUrl:<br/>    Description: </strong>URL of your API endpoint<br/>    <strong class="nt hv">Value: </strong>!Join<br/>      - ''<br/>      - - https://<br/>        - !Ref ApiGatewayContactUs<br/>        - '.execute-api.'<br/>        - !Ref 'AWS::Region'<br/>        - '.amazonaws.com/prod/api'</span></pre><h1 id="fd03" class="lt lu hu bd lv lw on ly lz ma oo mc md ja op jb mf jd oq je mh jg or jh mj mk dt translated">让我们看看“联系我们”表单是如何工作的</h1><h2 id="0f3f" class="mq lu hu bd lv mr ms mt lz mu mv mw md ki mx my mf km mz na mh kq nb nc mj nd dt translated">HTML</h2><p id="20a6" class="pw-post-body-paragraph jz ka hu kb b kc ml iv ke kf mm iy kh ki mn kk kl km mo ko kp kq mp ks kt ku hn dt translated">我们使用Bootstrap作为CSS框架。在表单操作属性中使用API网关url。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="of og l"/></div></figure><h2 id="b8c5" class="mq lu hu bd lv mr ms mt lz mu mv mw md ki mx my mf km mz na mh kq nb nc mj nd dt translated">JavaScript</h2><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="of og l"/></div></figure><p id="39d1" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">当我发布JSON对象时，我遇到了一个CORS问题。当我发布一个stringified JSON对象时，它工作了。</p><p id="cca8" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">这不起作用:</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="687c" class="mq lu hu nt b fv nx ny l nz oa">$.post(url, {}, function(data) {}, 'json');</span></pre><p id="1af2" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">这确实有效:</p><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="d7e0" class="mq lu hu nt b fv nx ny l nz oa">$.post(url, <strong class="nt hv">JSON.stringify({})</strong>, function(data) {}, 'json');</span></pre><h2 id="3098" class="mq lu hu bd lv mr ms mt lz mu mv mw md ki mx my mf km mz na mh kq nb nc mj nd dt translated">一些CSS</h2><pre class="jk jl jm jn fq ns nt nu nv aw nw dt"><span id="5d93" class="mq lu hu nt b fv nx ny l nz oa">.errors {<br/>    color: red;<br/>    display: none;<br/>}</span><span id="3e8b" class="mq lu hu nt b fv os ny l nz oa">.thanks, .sending {<br/>    display: none;<br/>}</span><span id="deb6" class="mq lu hu nt b fv os ny l nz oa">.grecaptcha-badge {<br/>    float: right;<br/>}</span></pre><h1 id="4f49" class="lt lu hu bd lv lw on ly lz ma oo mc md ja op jb mf jd oq je mh jg or jh mj mk dt translated">结论</h1><p id="af74" class="pw-post-body-paragraph jz ka hu kb b kc ml iv ke kf mm iy kh ki mn kk kl km mo ko kp kq mp ks kt ku hn dt translated">我希望你喜欢这篇文章，我也希望这个CloudFormation模板能让一些开发人员的生活稍微轻松一些。请让我知道你的想法。</p></div></div>    
</body>
</html>