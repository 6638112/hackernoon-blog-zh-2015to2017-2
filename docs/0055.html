<html>
<head>
<title>The Spring Factory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">弹簧工厂</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-spring-factory-4c3d988e7129?source=collection_archive---------0-----------------------#2015-09-02">https://medium.com/hackernoon/the-spring-factory-4c3d988e7129?source=collection_archive---------0-----------------------#2015-09-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="78fb" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">使用物理弹簧方程创建弹簧动画。</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/c52856890f3f7e80fc54825a1d4d48b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XN0ZwyFBgTHW8u3JI-sAqQ.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Figure 1. A spring with damping 0.125, initial position 1, and 13 half cycles.</figcaption></figure></div><div class="ab cl jz ka hc kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hn ho hp hq hr"><p id="31c2" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">弹簧效果，其中对象的属性(通常是位置)随时间振荡，对于给应用程序添加有弹性的物理感觉非常有用。在这里，我们讨论如何在物理弹簧上模拟弹性，并创建一个系统，允许您使用时间、反弹次数、阻尼以及可选的初始位置和初始速度来轻松设计弹簧效果。重要的是，这个spring库只处理常见的振荡情况，以使其更易于使用。</p><p id="771c" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">下面是一个演示效果的视频和一个JSFiddle，这样你就可以玩代码了。继续阅读，了解是什么让<a class="ae lc" href="https://hackernoon.com/tagged/animation" rel="noopener ugc nofollow" target="_blank">动画</a>滴答作响。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="ld le l"/></div></figure><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="lf le l"/></div></figure><h1 id="f7b5" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated">使用适应症</h1><p id="1329" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">这个spring库专门设计已知持续时间和弹跳次数的弹跳动画。例如，您可能希望屏幕上的元素在出现时就弹回原位。有了固定、精确的持续时间，就可以更容易地协调其他动画。</p><p id="fd71" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">这种弹簧实现可以用于对弹簧进行建模，但效率较低，因为力的幅度变化会影响动画的稳定时间，所以弹簧会实时对未知的力做出反应。</p><p id="e0a4" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">该弹簧实现包括欠阻尼和无阻尼弹簧条件，但不模拟临界阻尼或过阻尼条件。虽然弹簧可以有效地用于这些情况，但在某些情况下，可能更容易推断出<a class="ae lc" rel="noopener" href="/analytic-animations/ease-in-out-the-sigmoid-factory-c5116d8abce9">缓入缓出</a>或缓出。</p><p id="72ed" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">如果您需要这些特性，请参阅下面的参考资料部分，了解其他spring实现。</p><h2 id="99b0" class="md lh hu bd li me mf mg lm mh mi mj lq kp mk ml ls kt mm mn lu kx mo mp lw mq dt translated">对比CSS动画</h2><p id="96f7" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">现代网络浏览器包含高度优化的图形例程，你可以通过<a class="ae lc" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Transitions/Using_CSS_transitions?redirectlocale=en-US&amp;redirectslug=CSS%2FTutorials%2FUsing_CSS_transitions" rel="noopener ugc nofollow" target="_blank">转换</a>或<a class="ae lc" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Animations/Using_CSS_animations?redirectlocale=en-US&amp;redirectslug=CSS%2FTutorials%2FUsing_CSS_animations" rel="noopener ugc nofollow" target="_blank">动画</a>指令用CSS访问这些例程。然而，仅使用贝塞尔曲线很难接近完全自然的弹性效果。这里有一个<a class="ae lc" href="http://codepen.io/Venerons/pen/BvHbK" rel="noopener ugc nofollow" target="_blank">的例子</a>。寻找“向右弹跳”动画。</p><p id="8520" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">此外，网页上还有一些CSS无法到达的地方。在这些情况下，使用这里描述的spring技术将是有利的，因为无论如何都必须使用<a class="ae lc" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> Javascript </a>。例子包括动画滚动条和画布。</p><p id="f6d3" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">在下面的实现部分，我提供了一个基于<a class="ae lc" href="https://gist.github.com/william-silversmith/8e9b89a0eaad9d168bb9343b1f13df19" rel="noopener ugc nofollow" target="_blank">手写笔的CSS spring </a>实现。</p><h1 id="79ae" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated">如何使用它</h1><pre class="jk jl jm jn fq mr ms mt mu aw mv dt"><span id="33cf" class="md lh hu ms b fv mw mx l my mz">// LISTING 1 (Javascript)<br/>// springFactory produces a function representing a spring.</span><span id="4d7e" class="md lh hu ms b fv na mx l my mz">var spring_easing = springFactory({ <br/>    halfcycles: 2, // accepts integers &gt; 1<br/>    damping: 0.15, // must be between 0 and 1 excluding 1,<br/>    initial_position: 1, // typically in -1..1 inclusive<br/>    initial_velocity: 0, // at start, how fast in either direction<br/>});</span><span id="2295" class="md lh hu ms b fv na mx l my mz">spring_easing(0.00); //  1.00000<br/>spring_easing(0.15); //  0.75796<br/>spring_easing(0.30); //  0.21033<br/>spring_easing(0.45); // -0.32669<br/>spring_easing(0.60); // -0.60467<br/>spring_easing(0.75); // -0.54533<br/>spring_easing(0.90); // -0.24334<br/>spring_easing(1.00); // nearly 0: 9.290299969698109e-17</span></pre><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nb"><img src="../Images/ac5c0569627a2237ff948405fcbb774a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f9Shm1MhyUPcTQfgWT44VA.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Figure 2. A a graphic representation of the spring produced in Listing 1. For simplicity, only two half cycles were used.</figcaption></figure><p id="1c17" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated"><em class="nc"> springFactory </em>将产生一个函数，该函数采用一个参数<em class="nc"> t </em>来表示动画完成的百分比，该百分比是一个介于0和1之间的数字。值得注意的是，这个派生函数只为每个输入<em class="nc"> t </em>生成一个数字，用于动画框架(可能需要构建)中的<em class="nc"> </em>。一个示例框架包含在<a class="ae lc" href="https://jsfiddle.net/s1a7140a/2/" rel="noopener ugc nofollow" target="_blank">jsdild</a>中。</p><p id="2b78" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">这种实现的一个独特方面是<em class="nc"> springFactory </em>生产的弹簧主要根据其输出、持续时间、循环次数和阻尼来描述，而不是其他弹簧通常使用的输入，如质量和刚度。[1]这对于有多个交互组件的物理模拟来说不太好，但是对于你确切知道你想要什么的时候来说是完美的。此外，它总是在指定时间内解析到其最终位置零。如果您没有指定足够的周期数，这可能看起来不稳定，但是您总是可以添加更多的周期数。</p><p id="4a63" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">弹簧上有以下控件:</p><ol class=""><li id="9518" class="nd ne hu ki b kj kk km kn kp nf kt ng kx nh lb ni nj nk nl dt translated"><em class="nc">时间</em>(以毫秒为单位)——您可以根据需要设置动画的持续时间。动画越长，弹簧移动越慢。注意，这是你在动画框架中设置的东西，而不是<em class="nc"> springFactory </em>本身。</li><li id="c179" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated"><em class="nc"> halfcycles — </em>一个大于或等于一的整数，它指定弹簧在停止前通过静止点的次数。一个半周期将在第一次突然恢复时停止。两个将继续下去，反弹一次，以此类推。在数学术语中，它是正弦波的半周期数。</li><li id="3b51" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated"><em class="nc">阻尼</em> —一个介于0(含)和1(不含)之间的数字[2]，主要影响运动的衰减。阻尼为0将产生一个完全弹性的弹簧，看起来它永远不会停止(直到它达到您指定的半周期数，此时它将突然停止)。接近1的阻尼将产生几乎完全无弹性的弹簧，根本不会反弹。0.15是一个相当不错的值。试试看。</li><li id="7a93" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated"><em class="nc"> initial_position </em>(可选，默认为1) —介于-1和1之间的数字。静止的弹簧位于0，1被认为是完全伸展的。想象拿一根弹簧，拉它，然后放开它。你这样做的高度用这个数字来表示。</li><li id="370e" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated"><em class="nc"> initial_velocity </em>(可选，默认为0)——这个有点难理解。如果你把一个球放在弹簧的顶端，扔出去，这就是它移动的速度。弹簧很容易从静止状态释放，在这种情况下，该参数为0。当你想让它移动的时候，你必须自己去感觉，但是通常的值可能在-2到2之间。你可以把它想象成和<em class="nc"> initial_position </em>差不多大小，但是方向相反。</li></ol><p id="48ea" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">这里有一个例子，描述了一个弹簧在静止时开始完全伸展，然后被释放。然后，它执行两个半周期，阻尼常数为0.15。</p><h2 id="a399" class="md lh hu bd li me mf mg lm mh mi mj lq kp mk ml ls kt mm mn lu kx mo mp lw mq dt translated">春季设计师</h2><p id="4478" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">在将这个spring框架用于一个<a class="ae lc" href="http://eyewire.org/explore" rel="noopener ugc nofollow" target="_blank">项目</a>时，我发现使用一个<a class="ae lc" href="https://en.wikipedia.org/wiki/Grapher" rel="noopener ugc nofollow" target="_blank"> Grapher </a>文件很有帮助:</p><p id="4fd7" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated"><a class="ae lc" href="https://drive.google.com/file/d/0BzMVmsOw9DxnbUdaT0VHSFN5anc/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">下载Spring Designer Grapher文件</a>(针对OS X)</p><p id="d003" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">grapher文件允许您在更费力地感受弹簧之前，非常容易地绘制弹簧并调整它们。由于涉及到数值解的原因，这个文件不包括初速度的参数，这一点以后会清楚。[3]文件中，<em class="nc"> k </em>为半周数，ζ(ζ)为阻尼系数，<em class="nc"> y0 </em>为初始位置。</p><p id="19d6" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">图2中的图表是使用上述文件生成的。</p><h1 id="09a2" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated">该理论</h1><p id="7e8d" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">根据谷歌的一项简短调查，实现弹性效果的主要技术是使用衰减的正弦或余弦波。“<a class="ae lc" href="http://www.motionscript.com/articles/bounce-and-overshoot.html" rel="noopener ugc nofollow" target="_blank">真实的反弹和过冲</a>”对此进行了详细说明，但在我们深入讨论之前，让我在这里概括一下要点。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff nr"><img src="../Images/3d707e7073c9b9cb593c730b214b442e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*hcMgCrP-8ocFBT6xwwzgQw.png"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Equation 1. A decaying cosine wave.</figcaption></figure><p id="4080" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">这里，<em class="nc"> x </em>是行进的距离，<em class="nc"> t </em>是时间，<em class="nc"> k </em>是衰减常数，<em class="nc">ω</em>(ω)是正弦波的频率。它乘以2π使<em class="nc"> ω = </em> 1成为一个完整的周期，而不是必须记住在<em class="nc"> ω </em>中说明它。下面是它在图表中的样子(为简单起见，将<em class="nc"> k </em>和<em class="nc"> ω </em>设为1)。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ns"><img src="../Images/dc87784771fdb54eccd6b38275a11a29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JbzpMK_wWz-wY--k2h-3FA.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Figure 3. A damped sinusoid approximates a spring.</figcaption></figure><p id="a27e" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">请注意，该图从1开始，下降，超过0，但不会一直到-1。它慢慢衰减到稳态值0。我们可以使用正弦或余弦，这取决于我们是想从1还是0开始。[4]</p><p id="ac24" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">您可以调整<em class="nc"> k </em>和<em class="nc"> ω </em>来实现相当逼真的反弹。然而，如果你想精确地模拟一个物理弹簧，<a class="ae lc" href="https://en.wikipedia.org/wiki/Damping" rel="noopener ugc nofollow" target="_blank">事情变得有点复杂</a>。这样做的主要优点是对波形进行了细微的修改，并且能够以初始速度启动弹簧。</p><p id="3a10" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">引入ζ(ζ)，阻尼系数。这个变量代表了弹簧的弹性有多大。当ζ大于1时，弹簧阻尼过大，不会振动。当它等于1时，称为临界阻尼，不振荡。我们关注的是0 &lt; ζ &lt; 1, underdamped, where it will oscillate but decay towards zero. <a class="ae lc" href="https://en.wikipedia.org/wiki/Damping#Under-damping_.280_.E2.89.A4_.CE.B6_.3C_1.29" rel="noopener ugc nofollow" target="_blank">的情况，查阅维基百科</a>，下面是欠阻尼情况下的公式:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nt"><img src="../Images/a258e58a1684e346e1abef4ad058640a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fPYOkJeFmVXEexgjlSEMvA.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Equation 2. The underdamped spring equation.</figcaption></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff nu"><img src="../Images/affcf37ea583459b51053ac367cf7263.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*8nK2y-9k5vop4zBuX14_aA.png"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Equation 3. Coefficient A in Eqn. 2</figcaption></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nv"><img src="../Images/9ed93e2f44b27d421c1964f64d03c0cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QmHxt-cRnm60Jfrmwk1VRw.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Equation 4. Coefficient B in Eqn. 2</figcaption></figure><p id="7d46" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">在等式中。2，可以看到真正的欠阻尼弹簧方程是正弦和余弦的线性组合，阻尼指数。从公式中得到的k<em class="nc">k</em>。1变成了2ππ，余弦的自变量有了前缀sqrt(1–ζ^2).我们来解剖一下是怎么回事。2π使ω成为一个易于控制的旋钮，因为1π代表一个完整的周期。ζ具有双重功能，既影响阻尼，又调整振荡频率。<em class="nc"> t </em>，自变量，在0到1之间变化——一个完整的动画。</p><p id="fc50" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">一个重要的考虑因素是，当<em class="nc"> t </em> = 1时，我们希望曲线通过0，否则动画将根据框架，要么在目标之外停止，要么非常突然地跳到最终位置。这意味着只允许某些ω值。我们可以设置“无滑移”边界条件y(1) = 0，求解ω: [5]</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff nw"><img src="../Images/2b7264d58cb7eeb5859c82ea0749a9fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*UbgGh_GdmQ8203syhZ4csQ.png"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Equation 5. Solution for ω such that y(1) = 0, that is to say, there is no slip at the end of the animation. A and B are defined in Eqn. 3 and 4 respectively.</figcaption></figure><p id="6bf1" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">这很好，但是有一个恼人的细节。ω用<em class="nc"> B </em>定义，而<em class="nc"> B </em>用ω定义。这里有很多细节，但是把情况简化一下更清楚，归结为解这个方程:w = tan(w)，这个方程没有解析解。</p><p id="9a81" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">然而，并没有失去一切。首先，如果初速度为0，<em class="nc"> B </em>简化为一个不依赖于ω的方程:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff nx"><img src="../Images/fd9e7502ba889cc7d9e9b706d868f4eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*mh4JdlhK6ZMfWi4d8cbvLQ.png"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Equation 6. Eqn. 4 with 0 initial velocity.</figcaption></figure><p id="6882" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">在这个特例中，幸运的是一个常见的用例，我们有一个完全解析的spring解决方案。</p><p id="f069" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">然而，在一般情况下并没有失去一切。幸运的是，<em class="nc"> B </em>和ω可以用数值方法求解。我使用了简单的二分法，众所周知这种方法有点慢，但在这种情况下，只需相对较少的步骤就可以快速收敛。重要的是，这个数值解在创建弹簧时出现一次，而不是在实际使用弹簧时出现，所以对性能的影响是最小的。</p><p id="7686" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">这是一个例子，当你给弹簧一个初速度时，会是什么样子。图4与图2相同，图2的初始速度为0，但初始速度为2。请注意，动画的开始是上升而不是下降，范围没有限制在-1到1之间。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ny"><img src="../Images/6ea545d2fa8e604aafa38ba062db85f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VXAPLs_oA6aVkrzNQixZYA.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Figure 4. A spring with initial velocity 2, damping 0.15, halfcycles 2, and initial position 1.</figcaption></figure><p id="8964" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">我们现在有五个易于控制的旋钮来调节我们真正的弹簧:</p><ol class=""><li id="90d6" class="nd ne hu ki b kj kk km kn kp nf kt ng kx nh lb ni nj nk nl dt translated">ζ —弹簧质量，0到1。(0为最大弹性)[6]</li><li id="206e" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated">k——在到达<em class="nc"> t = </em> 1处的<br/>休息点之前执行的半周期数。你也可以认为这是过零点的数量。</li><li id="7454" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated"><em class="nc"> t </em> — <em class="nc"> t </em>从0运行到1，但这只是一个百分比。你可以把动画的长度调整到你想要的长度。</li><li id="4a35" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated"><em class="nc">初始位置，y(0) </em> —您可以在任何高度启动弹簧，但通常您会希望将其保持在1，因为您可以在使用后缩放输出。</li><li id="38d8" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated"><em class="nc">初始速度，dy/dt (0) </em> —这允许您通过用一定的力驱动弹簧来扭曲弹簧的自然运动(例如，来自用户输入的运动)。</li></ol><h2 id="f520" class="md lh hu bd li me mf mg lm mh mi mj lq kp mk ml ls kt mm mn lu kx mo mp lw mq dt translated">履行</h2><p id="be2d" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">下面是<em class="nc"> springFactory </em>的实现。值得注意的是，如果我们只支持初始速度为零的常见特例，那么实现的规模可能会缩小50%以上，因为B和ω的数值解需要大约100行。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nz le l"/></div></figure><p id="7f83" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">你可以在这里找到CSS动画方面的<a class="ae lc" href="http://stylus-lang.com/" rel="noopener ugc nofollow" target="_blank">手写笔CSS预处理器</a>实现:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nz le l"/></div></figure><h2 id="8547" class="md lh hu bd li me mf mg lm mh mi mj lq kp mk ml ls kt mm mn lu kx mo mp lw mq dt translated">动画</h2><p id="fff2" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">在我们继续之前，稍微讲一下如何把这个方程变成一个动画。虽然数学适用于任何语言，但让我们使用javascript，因为它很流行。请参阅旁白animation.js，了解动画对象的基本框架。[7]</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nz le l"/></div></figure><p id="27b0" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">在本文中，我们将重点放在缓和函数上。缓动函数提供了在给定时刻要跨越的起点和终点之间的距离比例。有时它可以是正的，动画向前移动，有时它可以是负的，动画似乎向后运行。所示的框架只是将缓解功能放在上下文中。</p><p id="b889" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">在第25行，可以看到<em class="nc"> t </em>是动画完成的比例，是[0，1]中的一个值，提供给了缓动函数。</p><p id="afd6" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">在第14行，您可以看到缓动函数的默认值是线性缓动。也就是说，动画将与时间的进展成正比。</p><h1 id="072c" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated">新颖性声明</h1><p id="01a9" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">我不敢说这个实现的这些方面真的很新颖，但是在评估了许多spring库之后，我还没有看到它们以这种形式出现。在为web构建的Javascript欠阻尼spring公式领域，以下特性的组合可能是独一无二的。</p><h2 id="b666" class="md lh hu bd li me mf mg lm mh mi mj lq kp mk ml ls kt mm mn lu kx mo mp lw mq dt translated">分析解</h2><p id="a006" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">虽然指定初始速度需要正弦系数的数值解，但总的来说，使用标准的代数工具可以很容易地分析该方程。这使得动画可以很容易地跳到任何一点，向前或向后运行，随时开始、停止或恢复。</p><p id="da94" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">大多数(但不是全部)其他实现似乎依赖于对<a class="ae lc" href="https://en.wikipedia.org/wiki/Damping#Linear_damping" rel="noopener ugc nofollow" target="_blank">粘性质量-弹簧-阻尼器模型</a>中的力进行物理模拟，或者通过使用<a class="ae lc" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods" rel="noopener ugc nofollow" target="_blank"> RK4方法</a>求解常微分方程。</p><p id="78a2" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">基于物理模拟的方法可以向前运行，也可能向后运行，但跳过需要非常快速地运行模拟，这是一种低性能条件。</p><h2 id="771f" class="md lh hu bd li me mf mg lm mh mi mj lq kp mk ml ls kt mm mn lu kx mo mp lw mq dt translated">按时建立</h2><p id="abe3" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">如本文所述，ω和<em class="nc"> B </em>的代数和数值解保证了当<em class="nc"> t </em> = 1时弹簧将位于0。其他解决方案也在其算法中寻找收敛，但这有时会以失去对动画持续时间或停止点的控制为代价，需要摆弄数字直到它看起来正确。</p><h2 id="f3af" class="md lh hu bd li me mf mg lm mh mi mj lq kp mk ml ls kt mm mn lu kx mo mp lw mq dt translated">更简单的参数</h2><p id="630e" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">虽然许多框架都提供了不带参数调用函数并从中获得某种弹性的能力，但是比较它们完全指定一个特定函数需要多少工作量仍然是公平的。这个框架需要三个参数:持续时间、半周期和阻尼，尽管初始位置和速度可以达到五个。</p><p id="534f" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">最常见的完整备选集是持续时间、质量、张力(刚度)、摩擦力(粘度)、初始位置和初始速度。</p><p id="6fe4" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">与全套相比，这个公式少了一个参数，尽管允许质量为1并且只改变张力和摩擦力是公平的。尽管如此，关于这些参数的推理的相对复杂性是不同的。</p><p id="1e34" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">在这个公式中，持续时间、半周期和初始位置很容易推理。你可以在没有工具的帮助下预测改变它们的影响。调整阻尼和速度的效果需要更多的猜测和检查，除非你准备开始计算。</p><p id="3216" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">在最常见的替代方案中，持续时间和初始位置仍然很容易推理，但调整质量、张力、摩擦力和初始速度的效果需要猜测和检查。</p><h2 id="0ca7" class="md lh hu bd li me mf mg lm mh mi mj lq kp mk ml ls kt mm mn lu kx mo mp lw mq dt translated">表演数学</h2><p id="2c8b" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">在2013年末配备2个2.8 GHz英特尔i7内核的13英寸Macbook Pro上，测试了以下代码:</p><pre class="jk jl jm jn fq mr ms mt mu aw mv dt"><span id="7582" class="md lh hu ms b fv mw mx l my mz">var easing = springFactory({<br/> damping: 0.2,<br/> halfcycles: 15,<br/> initial_position: 0.5, // +50% screen, from center<br/> initial_velocity: 0,<br/>});</span><span id="cb75" class="md lh hu ms b fv na mx l my mz">for (var t = 0; t &lt; 1; t += 1 / 1e8) {<br/> easing(t);<br/>}</span></pre><p id="de77" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">节点版本5.1.1的结果如下:</p><pre class="jk jl jm jn fq mr ms mt mu aw mv dt"><span id="cb40" class="md lh hu ms b fv mw mx l my mz">$ time node springFactory.js</span><span id="d3d1" class="md lh hu ms b fv na mx l my mz">real 0m6.136s</span><span id="6b59" class="md lh hu ms b fv na mx l my mz">user 0m6.104s</span><span id="b083" class="md lh hu ms b fv na mx l my mz">sys 0m0.027s</span></pre><p id="da22" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">我还运行了一个空载for循环控制组测试，用了0.220秒。这证实了JIT优化器由于缺少副作用而没有删除缓和函数调用。</p><p id="a611" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">这相当于每秒更新1630万次。如果你以60 fps的速度运行，spring math本身将在这台笔记本电脑上支持大约271，000个弹簧，如果渲染它们和调用许多不同的函数不需要开销的话；不切实际的情况，但有助于比较。</p><h2 id="b41a" class="md lh hu bd li me mf mg lm mh mi mj lq kp mk ml ls kt mm mn lu kx mo mp lw mq dt translated">丢弃严重阻尼和过度阻尼的弹簧</h2><p id="5402" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">我没有经验证据，但我的直觉告诉我，大多数设计师在接触弹簧时都在寻找反弹。消除非振荡弹簧条件可能通过防止混淆和减少掌握所需的学习时间来提高易用性。</p><p id="6545" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">人们可以合理地批评这一点，认为这是将缺陷误认为特性，但是我很想看看它在现实世界中的表现。</p><h2 id="8844" class="md lh hu bd li me mf mg lm mh mi mj lq kp mk ml ls kt mm mn lu kx mo mp lw mq dt translated">图表产生器文件</h2><p id="7ac5" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">分析解决方案允许Grapher(默认情况下安装在OS X上的绘图程序)作为设计弹簧的可视化辅助工具。</p></div><div class="ab cl jz ka hc kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hn ho hp hq hr"><p id="829a" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated"><em class="nc">如果你对这幅作品感兴趣，你可能会喜欢</em> <a class="ae lc" rel="noopener" href="/@willsilversmith/ease-in-out-the-sigmoid-factory-c5116d8abce9"> <em class="nc">进出:乙状结肠工厂</em> </a> <em class="nc">或</em> <a class="ae lc" rel="noopener" href="/@willsilversmith/the-bounce-factory-3498de1e5262"> <em class="nc">弹跳工厂</em> </a> <em class="nc">。</em></p><h1 id="4518" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated">资源</h1><ol class=""><li id="8838" class="nd ne hu ki b kj ly km lz kp oa kt ob kx oc lb ni nj nk nl dt translated">看这个框架<a class="ae lc" href="https://jsfiddle.net/s1a7140a/2/" rel="noopener ugc nofollow" target="_blank">玩个JS提琴</a>。</li><li id="b758" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated"><a class="ae lc" href="https://drive.google.com/file/d/0BzMVmsOw9DxnbUdaT0VHSFN5anc/view" rel="noopener ugc nofollow" target="_blank"> Spring Designer Grapher文件</a>(针对OS X)</li><li id="fa73" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated">罗伯特·彭纳(Robert Penner)是第一个将放松方程命名为“放松-放松”的人，他在书中自由地分享了动态运动部分。有点过时(最初是为ActionScript编写的，action script是一种为Flash设计的类似JS的语言)，但非Flash的逻辑仍然是健全的(尤其是本章的前半部分)。他的代码有一点过度优化，很难阅读，但他当时是为更慢的机器编写的。</li><li id="d2ee" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated"><a class="ae lc" href="http://easings.net/" rel="noopener ugc nofollow" target="_blank">http://easings.net/</a>—一组你可以在CSS动画中使用的计时功能。它们是用贝塞尔曲线描述的，所以它们有点难以用Javascript动画即插即用，除非你使用贝塞尔曲线库。这是留给读者的练习。</li><li id="87b3" class="nd ne hu ki b kj nm km nn kp no kt np kx nq lb ni nj nk nl dt translated"><a class="ae lc" href="http://mtdevans.com/2013/05/fourth-order-runge-kutta-algorithm-in-javascript-with-demo/" rel="noopener ugc nofollow" target="_blank"> Runge-Kutta四阶(RK4)解算器</a> — Javascript实现，如果你有兴趣制作自己的spring库。</li></ol><h1 id="bf20" class="lg lh hu bd li lj lk ll lm ln lo lp lq ja lr jb ls jd lt je lu jg lv jh lw lx dt translated"><strong class="ak">尾注</strong></h1><p id="812e" class="pw-post-body-paragraph kg kh hu ki b kj ly iv kl km lz iy ko kp ma kr ks kt mb kv kw kx mc kz la lb hn dt translated">[1]一些示例框架:</p><p id="2bba" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated"><a class="ae lc" href="https://github.com/robb/RBBAnimation/blob/07d79f57b37373bac9d9c9e5c27487d9a9f8720b/RBBAnimation/RBBSpringAnimation.m" rel="noopener ugc nofollow" target="_blank">RBBAnimation</a>——需要阻尼、质量和刚度。使用标准微分方程解，但不强制spring在您选择的特定时间进行求解。</p><p id="4194" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated"><a class="ae lc" href="https://github.com/intuit/AnimationEngine/blob/master/INTUAnimationEngine/SpringSolver/INTUSpringSolver.c" rel="noopener ugc nofollow" target="_blank"> Intuit动画引擎</a> —需要阻尼、质量和刚度。使用RK4自动获得过阻尼、临界阻尼和欠阻尼的解决方案。</p><p id="e6e5" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">脸书流行音乐似乎只需要跳跃、动画开始和结束。我对iOS核心动画的理解还不足以完全解释它的API，但是<a class="ae lc" href="https://github.com/facebook/pop/blob/1d666021f595a513a0812bb5da313bb0219369ee/pop/POPSpringSolver.h" rel="noopener ugc nofollow" target="_blank">内部</a>它似乎在微分方程上插上插下，直到<a class="ae lc" href="https://github.com/facebook/pop/blob/1d666021f595a513a0812bb5da313bb0219369ee/pop/POPSpringAnimationInternal.h" rel="noopener ugc nofollow" target="_blank">收敛</a>。</p><p id="8715" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated"><a class="ae lc" href="https://github.com/julianshapiro/velocity/blob/9c9c052a5fb6d5854c9aad931d9410c6790816ee/velocity.js#L818" rel="noopener ugc nofollow" target="_blank"> Velocity.js </a> —需要持续时间、张力、摩擦力。使用RK4。运行两个过程，以确定如何使弹簧在设定的持续时间内收敛。</p><p id="df68" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">[2]阻尼允许您描述弹簧的“弹力”或“弹性”程度，由变量ζ(ζ)表示。如果ζ &gt; 1，则弹簧“阻尼过大”,并在没有反弹的情况下停止。如果ζ = 1，则称为“临界阻尼”,它会在最小时间内停止，并有轻微的超调。如果0 &lt; ζ &lt; 1，则称之为“欠阻尼”,它会振荡，并随时间衰减至零。如果ζ = 0，振荡将无衰减地发生，称为“无阻尼”。在本文中，我们主要关注欠阻尼情况。</p><p id="eb7d" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">[3]好吧，你问倒我了。我有一个grapher文件，可以让你计算出初速度，但是很难使用。本质上，你选择一个初始速度<em class="nc"> v0 </em>，然后通过猜测变量<em class="nc"> B </em>的值，看看你是否能得到一条表示误差的线到达零。</p><p id="4095" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated"><a class="ae lc" href="https://drive.google.com/file/d/0BzMVmsOw9DxnbUdaT0VHSFN5anc/view" rel="noopener ugc nofollow" target="_blank">下载初速弹簧设计器</a></p><p id="7f8f" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">[4]回想一下sin(<em class="nc">x</em>)= cos(<em class="nc">x</em>-π/2)。你可以通过增加相移φ(φ)来调整正弦波的起始位置，如下所示:sin(x + φ)</p><p id="6b3f" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">稍微细说一下，sin( <em class="nc"> f </em> x)，其中<em class="nc"> f </em>为倍频器，可以相移为sin( <em class="nc"> f </em> x + φ)。</p><p id="98a9" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">[5]这里是代数。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff od"><img src="../Images/2e01e3e53496f6c3d4ef4f0890a886d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FCbLHy6eux3yQG5bSKSltQ.jpeg"/></div></div></figure><p id="5a33" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">[6]这似乎有点尴尬。1不应该是最大弹性吗？</p><p id="39f5" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">ζ来自物理学界，他们对事物衰变的速度感兴趣。你可以用一个新的变量ɛ(ε)来代替ζ，因为ɛ = 1-ζ，它在0附近弹性最小，在1处弹性最大。除此之外，请注意，在ɛ = 0(或ζ = 1)时，方程。2分解了，因为余弦自变量归零了。你可以尽可能接近零，但你不能去那里。</p><p id="8442" class="pw-post-body-paragraph kg kh hu ki b kj kk iv kl km kn iy ko kp kq kr ks kt ku kv kw kx ky kz la lb hn dt translated">[7]在可能的情况下，您会想要使用<a class="ae lc" href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame?redirectlocale=en-US&amp;redirectslug=DOM%2Fwindow.requestAnimationFrame" rel="noopener ugc nofollow" target="_blank">window . requestanimationframe</a>。与setInterval相比，这是一种现代的计时渲染方法。它提供与浏览器刷新率同步的一致刷新率，并尊重电池寿命。两种方法我都试过了，setInterval总是不稳定。请注意，cancelAnimationFrame与clearInterval一样存在。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="oe le l"/></div></figure></div></div>    
</body>
</html>