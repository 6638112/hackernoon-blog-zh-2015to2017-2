<html>
<head>
<title>Testing for the novice JavaScript developer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向JavaScript开发新手的测试</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/testing-for-the-novice-javascript-developer-f41f22563855?source=collection_archive---------2-----------------------#2016-12-11">https://medium.com/hackernoon/testing-for-the-novice-javascript-developer-f41f22563855?source=collection_archive---------2-----------------------#2016-12-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><blockquote class="ir"><p id="8eb5" class="is it hu bd iu iv iw ix iy iz ja jb ek translated">“如果建筑者像程序员写程序那样建造房屋，那么第一只啄木鸟就会毁灭文明。”~杰拉尔德·温伯格</p></blockquote><p id="af59" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jb hn dt translated">我喜欢测试。在我学习编码的早期，我听说过“测试驱动开发”这个东西。大约在同一时间，我开始扩大我的项目范围，并遇到了非常棘手的错误。有时有用的东西会停止工作，我不知道为什么。测试只是揭示了更多的问题；我的代码是一个无法测试的巨大混乱。测试我的代码从根本上改进了我的编码，我希望这篇介绍也能帮助你。</p><p id="2d34" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">我希望你能从这篇文章中得到什么:</p><ul class=""><li id="7726" class="ke kf hu je b jf jz jj ka jn kg jr kh jv ki jb kj kk kl km dt translated">设置Mocha(测试框架)和chai(断言库)。</li><li id="8300" class="ke kf hu je b jf kn jj ko jn kp jr kq jv kr jb kj kk kl km dt translated">编写和运行您的测试。</li><li id="738c" class="ke kf hu je b jf kn jj ko jn kp jr kq jv kr jb kj kk kl km dt translated">同步测试。</li><li id="ff7e" class="ke kf hu je b jf kn jj ko jn kp jr kq jv kr jb kj kk kl km dt translated">异步测试(回调)。</li><li id="4b3e" class="ke kf hu je b jf kn jj ko jn kp jr kq jv kr jb kj kk kl km dt translated">有些功能我用了很多(只是让你知道它们的存在)。</li></ul><p id="8163" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">我希望对命令行和npm有非常基本的了解。</p><h2 id="0146" class="ks kt hu bd ku kv kw kx ky kz la lb lc jn ld le lf jr lg lh li jv lj lk ll lm dt translated">设置</h2><p id="0623" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jb hn dt translated">首先让我们做一个新项目。创建一个文件夹，在命令行中输入<code class="eh ls lt lu lv b">npm init -y</code>，用npm初始化项目。</p><p id="9373" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">用下面的命令安装mocha。</p><p id="28ac" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated"><code class="eh ls lt lu lv b">npm install mocha -g</code>或<code class="eh ls lt lu lv b">sudo npm install mocha -g</code></p><p id="d0a3" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">并安装chai与:</p><p id="0026" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated"><code class="eh ls lt lu lv b">npm install chai --save-dev</code></p><p id="8705" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">Mocha是一个框架，用于设置测试、运行测试、命名测试和进行测试管理。Chai是一个断言库，意思是你可以用它来检查事情是否如你所期望的那样进行。通过下面的例子，这将变得更加清楚。</p><p id="0771" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">在你的根目录下创建一个名为<code class="eh ls lt lu lv b">index.js</code>的文件。这将是我们要测试的文件。还要创建一个名为<code class="eh ls lt lu lv b">test</code>的文件夹，并将一个名为<code class="eh ls lt lu lv b">index.spec.js</code>的文件放入其中。这个文件是我们为<code class="eh ls lt lu lv b">index.js</code>编写测试的地方。</p><p id="69d5" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">您的项目应该是这样的:</p><pre class="lx ly lz ma fq mb lv mc md aw me dt"><span id="5222" class="ks kt hu lv b fv mf mg l mh mi">├── yourAwesomeProject/<br/>│   ├── index.js<br/>│   ├── test<br/>│   │   ├── index.spec.js<br/>│   ├── package.json</span></pre><p id="a5e4" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">好吧！我们什么也没做，但现在是确保摩卡正常工作的最佳时机。在命令提示符下键入<code class="eh ls lt lu lv b">mocha test</code>。</p><p id="bd0d" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">希望你得到这样的东西-&gt; <code class="eh ls lt lu lv b">0 passing (3ms)</code></p><p id="c178" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">你刚刚跑完了测试赛！那里没有测试，但那不重要。我们很快就会用测试来填充它。</p><h1 id="0e34" class="mj kt hu bd ku mk ml mm ky mn mo mp lc mq mr ms lf mt mu mv li mw mx my ll mz dt translated">编写您的第一个测试！</h1><p id="ede4" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jb hn dt translated">将以下代码写入index.js。</p><pre class="lx ly lz ma fq mb lv mc md aw me dt"><span id="d946" class="ks kt hu lv b fv mf mg l mh mi">// Stub<br/>exports.addTwoNumbers = function (a, b) {<br/>    return 0;<br/>}</span></pre><p id="1d37" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">这个函数被称为“存根”函数。这段代码没有任何逻辑，但它仍然返回一个数字。这使得我们可以为它编写一个测试，而不需要费力去实现函数逻辑。</p><p id="1c05" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">跳到您的index.spec.js文件。我给你看代码，然后再分解。一定要自己打出来。</p><pre class="lx ly lz ma fq mb lv mc md aw me dt"><span id="ac07" class="ks kt hu lv b fv mf mg l mh mi">var index = require("../index");<br/>var chai = require("chai");</span><span id="64da" class="ks kt hu lv b fv na mg l mh mi">var expect = chai.expect;</span><span id="4544" class="ks kt hu lv b fv na mg l mh mi">describe("index.js tests", function() {<br/>    it("addTwoNumbers returns a number", function() {<br/>        expect(index.addTwoNumbers(0, 0)).to.be.a("number");<br/>    });<br/>});</span></pre><p id="60ae" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">为了确保一切正常，再次输入<code class="eh ls lt lu lv b">mocha test</code>。您应该在终端中得到这个很酷很时髦的输出:</p><pre class="lx ly lz ma fq mb lv mc md aw me dt"><span id="99f8" class="ks kt hu lv b fv mf mg l mh mi">index.js tests<br/>    ✓ addTwoNumbers returns a number</span><span id="af39" class="ks kt hu lv b fv na mg l mh mi">1 passing (11ms)</span></pre><p id="1775" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">一切正常，让我们来理解一下我们写了什么。</p><p id="e733" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">前两行导入您的文件<code class="eh ls lt lu lv b">index.js</code>和<code class="eh ls lt lu lv b">chai</code>，前者包含您想要测试的函数，后者是您之前使用npm安装的断言库。<code class="eh ls lt lu lv b">var expect = chai.expect;</code>只是给了我们一个简单的称呼<code class="eh ls lt lu lv b">chai.expect</code>。</p><h2 id="0e23" class="ks kt hu bd ku kv kw kx ky kz la lb lc jn ld le lf jr lg lh li jv lj lk ll lm dt translated">describe()——对一组单独的测试进行分组</h2><p id="5bdf" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jb hn dt translated"><code class="eh ls lt lu lv b">describe(&lt;Heading of Tests&gt;,testsInCallback);</code></p><p id="20ab" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">描述就像一个标题。这是一种将一组测试组合在一起的方法。你会注意到在上面的例子中，“index.js tests”是标题，“addTwoNumbers returns a number”是与它组合在一起的<strong class="je hv">I</strong>n individual<strong class="je hv">t</strong>est(<strong class="je hv">it</strong>)。</p><h2 id="dd9b" class="ks kt hu bd ku kv kw kx ky kz la lb lc jn ld le lf jr lg lh li jv lj lk ll lm dt translated">it() —“个人测试”</h2><p id="1b3f" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jb hn dt translated"><code class="eh ls lt lu lv b">it(&lt;Name of Test&gt;, testInCallback);</code></p><p id="54ae" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">每个测试断言都需要它自己的单独测试。例如，为了测试我们的函数“addTwoNumbers”实际上可以将两个数字相加，我们应该至少添加一个其他测试。</p><p id="cac5" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">我们将添加另一个测试:</p><pre class="lx ly lz ma fq mb lv mc md aw me dt"><span id="5f5e" class="ks kt hu lv b fv mf mg l mh mi">var index = require("../index");<br/>var chai = require("chai");</span><span id="9ca4" class="ks kt hu lv b fv na mg l mh mi">var expect = chai.expect;</span><span id="d2a7" class="ks kt hu lv b fv na mg l mh mi">describe("index.js tests", function() {<br/>    it("addTwoNumbers returns a number", function() {<br/>        expect(index.addTwoNumbers(0, 0)).to.be.a("number");<br/>    });</span><span id="ef56" class="ks kt hu lv b fv na mg l mh mi">    it("addTwoNumbers can add 1 + 2", function() {<br/>        expect(index.addTwoNumbers(1,2)).to.equal(3);<br/>    });<br/>});</span></pre><p id="9b92" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">我们将它添加到由describe函数划分的组“index.js tests”中，并将其添加到前面的单个测试的下面。您会注意到expect使用的语法非常易读。</p><p id="75df" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated"><code class="eh ls lt lu lv b">expect(&lt;your function&gt;).to.equal(&lt;something&gt;);</code>就是你如何检查平等。如果你正在检查深度相等，例如检查对象内部的字段是否相等，你可以像这样把“深度”加到链中:</p><p id="d14b" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated"><code class="eh ls lt lu lv b">expect(&lt;yourObject&gt;).to.deep.equal(&lt;anotherObject&gt;);</code></p><p id="85ea" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">柴<em class="lw">期望</em>的文档清晰明了，所以我<a class="ae nb" href="http://chaijs.com/api/bdd/" rel="noopener ugc nofollow" target="_blank">推荐你看一下</a>。</p><p id="3dc1" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">如果你现在运行<code class="eh ls lt lu lv b">mocha tests</code>，你会发现测试失败了。</p><pre class="lx ly lz ma fq mb lv mc md aw me dt"><span id="d88a" class="ks kt hu lv b fv mf mg l mh mi">index.js tests<br/>    ✓ addTwoNumbers returns a number<br/>    1) addTwoNumbers can add 1 + 2</span><span id="b628" class="ks kt hu lv b fv na mg l mh mi">1 passing (19ms)<br/>  1 failing</span><span id="ae70" class="ks kt hu lv b fv na mg l mh mi">1) index.js tests addTwoNumbers can add 1 + 2:</span><span id="2b9a" class="ks kt hu lv b fv na mg l mh mi">AssertionError: expected 0 to equal 3<br/>      + expected - actual</span><span id="2e04" class="ks kt hu lv b fv na mg l mh mi">      -0<br/>      +3</span><span id="c2ba" class="ks kt hu lv b fv na mg l mh mi">at Context.&lt;anonymous&gt; (test/index.spec.js:9:45)</span></pre><p id="7aa7" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">我发现这个信息非常有价值，因为它可以让您看到您的期望实际返回了什么(在本例中是零)。</p><p id="18dc" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">既然您的测试失败了，您可以通过修复您的<code class="eh ls lt lu lv b">index.js</code>中的代码来解决它。我通常会编写更多的测试，但是现在你有了一种方法来确保你正在做的工作。这并不能使你的代码完美，但至少可以让你安心一些。</p><p id="5114" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">简单地说，这种技术叫做“红绿重构”。我们只讨论了“红色、绿色”的部分，但是我们的想法是编写一个失败的测试。然后修改你的代码以通过测试。最后，您可以安心地重构代码，因为您已经进行了测试来检查您的重构没有破坏所有东西。</p><p id="f88a" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">到目前为止，我们一直在进行同步测试。但是如果你需要测试回调或者承诺呢？</p><h1 id="6ba5" class="mj kt hu bd ku mk ml mm ky mn mo mp lc mq mr ms lf mt mu mv li mw mx my ll mz dt translated">异步测试</h1><p id="0452" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jb hn dt translated">测试异步代码并不困难，但是需要一段额外的代码，这段代码还没有介绍过，叫做<code class="eh ls lt lu lv b">done()</code>。如果没有<code class="eh ls lt lu lv b">done</code>，mocha将分派您的异步代码并继续执行，而不等待您的回调的断言或执行。我用一个具体的例子给你看。</p><pre class="lx ly lz ma fq mb lv mc md aw me dt"><span id="88fe" class="ks kt hu lv b fv mf mg l mh mi">describe("Broken Async Code", function() {<br/>    it('Async test', function() {<br/>        setTimeout(function(){<br/>            //failing test<br/>            expect(true).to.be.false;<br/>        }, 1000);<br/>    });<br/>});</span></pre><p id="4f07" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">以上测试通过。这是因为<code class="eh ls lt lu lv b">it</code>只有在捕捉到来自<code class="eh ls lt lu lv b">expect</code>的错误时才会测试失败。因为这是异步执行的(延迟1秒)，所以mocha跳过这一步作为通过测试。我们需要通过添加done来告诉Mocha等待。<code class="eh ls lt lu lv b">done</code>必须作为论据加在断言之后。</p><pre class="lx ly lz ma fq mb lv mc md aw me dt"><span id="ba6b" class="ks kt hu lv b fv mf mg l mh mi">describe("Fixed Async Code", function() {<br/>    it('Async test', function(done) {     // Done added here.<br/>        setTimeout(function(){<br/>            //failing test<br/>            expect(true).to.be.false;<br/>            done();     // Tells mocha to run next test.<br/>        }, 1000);<br/>    });<br/>});</span></pre><p id="0e3b" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">你会注意到，当你运行<code class="eh ls lt lu lv b">mocha test</code>时，它会暂停1秒，然后给出一个失败。遗憾的是，这并不是mocha在前面的同步示例中给出的真正详细的错误。这可以通过mocha的内置承诺来解决，但这是另一个话题，不在本文讨论范围之内。如果你感兴趣，我推荐<a class="ae nb" href="http://tobyho.com/2015/12/16/mocha-with-promises/" rel="noopener ugc nofollow" target="_blank">看看这个</a>(这是一个编写带有详细响应的异步测试的好方法)。</p><h1 id="8594" class="mj kt hu bd ku mk ml mm ky mn mo mp lc mq mr ms lf mt mu mv li mw mx my ll mz dt translated">我使用的一些超级有用的功能</h1><ul class=""><li id="e5a7" class="ke kf hu je b jf ln jj lo jn nc jr nd jv ne jb kj kk kl km dt translated">要运行单个测试或测试组，只需将<code class="eh ls lt lu lv b">.only</code>添加到<code class="eh ls lt lu lv b">describe</code>或<code class="eh ls lt lu lv b">it</code>的末尾。示例:<code class="eh ls lt lu lv b">describe.only("index.js tests", function () {</code>或<code class="eh ls lt lu lv b">it.only("addTwoNumbers returns a number", function () {</code></li><li id="9dd2" class="ke kf hu je b jf kn jj ko jn kp jr kq jv kr jb kj kk kl km dt translated">研究可在<code class="eh ls lt lu lv b">describe</code>模块内使用的以下功能。<code class="eh ls lt lu lv b">before()</code>、<code class="eh ls lt lu lv b">beforeEach()</code>、<code class="eh ls lt lu lv b">after()</code>、<code class="eh ls lt lu lv b">afterEach()</code>。这些允许事情发生在你的每一次个人尝试之前和之后。(适合设置和清理)</li><li id="d594" class="ke kf hu je b jf kn jj ko jn kp jr kq jv kr jb kj kk kl km dt translated">浏览器里可以用摩卡！它加载了一个很酷的web页面，带有todo列表样式的格式，包含所有的测试。(这使得测试网页更加容易)。</li></ul><p id="2d69" class="pw-post-body-paragraph jc jd hu je b jf jz jh ji jj ka jl jm jn kb jp jq jr kc jt ju jv kd jx jy jb hn dt translated">祝你好运。记住测试是一种技能，所以熟能生巧。:)</p><figure class="lx ly lz ma fq nf"><div class="bz el l di"><div class="ng nh l"/></div></figure><blockquote class="ni nj nk"><p id="ae81" class="jc jd lw je b jf jz jh ji jj ka jl jm nl kb jp jq nm kc jt ju nn kd jx jy jb hn dt translated"><a class="ae nb" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae nb" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae nb" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae nb" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="jc jd lw je b jf jz jh ji jj ka jl jm nl kb jp jq nm kc jt ju nn kd jx jy jb hn dt translated">要了解更多信息，请<a class="ae nb" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">阅读我们的“关于”页面</a>、<a class="ae nb" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上点赞/给我们发消息</a>，或者简单地说，<a class="ae nb" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="jc jd lw je b jf jz jh ji jj ka jl jm nl kb jp jq nm kc jt ju nn kd jx jy jb hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae nb" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae nb" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote></div></div>    
</body>
</html>