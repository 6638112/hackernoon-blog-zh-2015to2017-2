<html>
<head>
<title>Building an insanely fast image classifier on Android with MobileNets in TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用TensorFlow中的MobileNets在Android上构建一个超快的图像分类器</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/building-an-insanely-fast-image-classifier-on-android-with-mobilenets-in-tensorflow-dc3e0c4410d4?source=collection_archive---------3-----------------------#2017-07-25">https://medium.com/hackernoon/building-an-insanely-fast-image-classifier-on-android-with-mobilenets-in-tensorflow-dc3e0c4410d4?source=collection_archive---------3-----------------------#2017-07-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="6f34" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">两部分系列的第二部分:这就像热狗不是热狗，而是为道路</h2></div><p id="bb22" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在第1部分中，<a class="ae kf" href="https://hackernoon.com/creating-insanely-fast-image-classifiers-with-mobilenet-in-tensorflow-f030ce0a2991" rel="noopener ugc nofollow" target="_blank">在TensorFlow </a>中使用MobileNet创建速度惊人的图像分类器，我们介绍了如何在新的数据集上重新训练一个<a class="ae kf" href="https://hackernoon.com/tagged/mobilenet" rel="noopener ugc nofollow" target="_blank"> MobileNet </a>。具体来说，我们训练了一个分类器，在笔记本电脑上以每秒超过400帧的速度检测道路或非道路。</p><p id="6bbb" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">移动互联网是为移动设备制造的。所以，让我们把我们的road not road模型转移到一个<a class="ae kf" href="https://hackernoon.com/tagged/android" rel="noopener ugc nofollow" target="_blank"> Android </a>应用程序上，这样我们就可以看到它的实际应用了。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff kg"><img src="../Images/1ab363439ca47ab9b043a4800c52ce07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJhJcHCK_8geVTldKzCB-Q.png"/></div></div></figure><h1 id="3154" class="ks kt hu bd ku kv kw kx ky kz la lb lc ja ld jb le jd lf je lg jg lh jh li lj dt translated">目标和计划</h1><p id="6103" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">让我们设定一些限制，这样我们就有具体的目标了。我们将尝试:</p><ul class=""><li id="4fe1" class="lp lq hu jl b jm jn jp jq js lr jw ls ka lt ke lu lv lw lx dt translated">在非常少量专门构建的数据上重新训练MobileNet</li><li id="748b" class="lp lq hu jl b jm ly jp lz js ma jw mb ka mc ke lu lv lw lx dt translated">在保留测试集上达到95%的分类准确率</li><li id="7cf7" class="lp lq hu jl b jm ly jp lz js ma jw mb ka mc ke lu lv lw lx dt translated">在运行推理时，使用不到5%的300美元设备的CPU</li></ul><p id="c0e7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为此，我们将遵循以下步骤:</p><ol class=""><li id="9009" class="lp lq hu jl b jm jn jp jq js lr jw ls ka lt ke md lv lw lx dt translated">生成新的训练数据集</li><li id="9615" class="lp lq hu jl b jm ly jp lz js ma jw mb ka mc ke md lv lw lx dt translated">训练几个MobileNet配置，以找到将达到我们的精度目标的最小网络</li><li id="c864" class="lp lq hu jl b jm ly jp lz js ma jw mb ka mc ke md lv lw lx dt translated">通过在Android上运行Inception V3获得性能指标评测</li><li id="110f" class="lp lq hu jl b jm ly jp lz js ma jw mb ka mc ke md lv lw lx dt translated">更新TensorFlow Android示例应用程序以使用我们的MobileNet模型</li><li id="4a38" class="lp lq hu jl b jm ly jp lz js ma jw mb ka mc ke md lv lw lx dt translated">在野外试试吧</li><li id="71f7" class="lp lq hu jl b jm ly jp lz js ma jw mb ka mc ke md lv lw lx dt translated">将其调整到低于5%的CPU使用率</li></ol><h1 id="a563" class="ks kt hu bd ku kv kw kx ky kz la lb lc ja ld jb le jd lf je lg jg lh jh li lj dt translated">构建数据集</h1><p id="7b2e" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">在之前的帖子中，我们将道路/非道路<em class="me">统称为</em>，所以我们从几个来源提取了图像。现在我们要更深入地研究这个问题。如果你还记得，这个项目的目的是为了用户隐私:在<a class="ae kf" href="http://coast.ai" rel="noopener ugc nofollow" target="_blank">海岸线</a>，我们正在为使用摄像头的移动设备建立驾驶安全功能。因此，当有人打开应用程序时，我们希望验证我们看到的是一条道路。如果不是，我们将禁用记录。</p><p id="d0bf" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">因此，为了建立我们的训练集，我将在录制视频的同时做一些日常的事情:在我的房子周围，在我的车外，在我的车内摆弄收音机，抚摸猫，等等。这将是我们的“非路”训练数据。</p><div class="kh ki kj kk fq ab cb"><figure class="mf kl mg mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/1e93ff3ccf3d7b8e32293e62ddd3f7ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*wDOEASFtCYydVS5c6sL6-w.jpeg"/></div></figure><figure class="mf kl mg mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/c7502173aab1aa6adcffe8269579b69c.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*69-HbMgiYpmRsAGGWgduPw.jpeg"/></div></figure><figure class="mf kl mg mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/735e02ff373ebf90a00bbd6cb1324bd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Gs1OvZgI63oymQ27odTvww.jpeg"/></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek mp di mq mr">Some “not road” examples.</figcaption></figure></div><p id="96f9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对于我们的“道路”数据，我将从海岸线驾驶数据集中随机采样，这些数据来自面向汽车前方的摄像头。</p><div class="kh ki kj kk fq ab cb"><figure class="mf kl mg mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/c0b04b7d5a0f47be50f682c75c847a3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*qfd3DSw-dQO-ah5pPhfwNw.jpeg"/></div></figure><figure class="mf kl mg mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/b5db421db8ea12090b5e7b5edcb3694e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Sbj4-bXPUWH27YyonLD1AA.jpeg"/></div></figure><figure class="mf kl mg mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/10866e4ead819758bb24d08a71c5edcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*TWoG2DE4z3y1NBDk_FGfnA.jpeg"/></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek mp di mq mr">“Road” examples. Notice each image has a mount in view. We need to be careful that the network doesn’t simply learn to recognize that object. We’ll take care of that through data augmentation.</figcaption></figure></div><p id="82ed" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">每组有3000个样本，我们就可以开始训练了。</p><h1 id="fc82" class="ks kt hu bd ku kv kw kx ky kz la lb lc ja ld jb le jd lf je lg jg lh jh li lj dt translated">在我们的自定义数据集上训练MobileNet</h1><p id="d555" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">下一步是看看我们可以从不同的MobileNet配置中获得什么样的精度。我们先来训练最宽的一个:MoileNet 1.0 @ 128。因为我们将把它放在移动设备上，我们将使用量化权重，这将进一步减少模型内存占用。</p><p id="48dc" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="me">关于如何在自己的数据上重新训练MobileNet的详细信息，请务必查看我的</em> <a class="ae kf" href="https://hackernoon.com/creating-insanely-fast-image-classifiers-with-mobilenet-in-tensorflow-f030ce0a2991" rel="noopener ugc nofollow" target="_blank"> <em class="me">之前的帖子</em> </a> <em class="me">。</em></p><p id="1ec7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">从根TensorFlow文件夹，我们将运行:</p><pre class="kh ki kj kk fq ms mt mu mv aw mw dt"><span id="9115" class="mx kt hu mt b fv my mz l na nb">python tensorflow/examples/image_retraining/retrain.py \<br/>  --image_dir ~/ml/blogs/road-not-road/data/ \<br/>  --learning_rate=<!-- -->0.0005<!-- --> \<br/>  --testing_percentage=15 \<br/>  --validation_percentage=15 \<br/>  --train_batch_size=32 \<br/>  --validation_batch_size=-1 \<br/>  --flip_left_right True \<br/>  --random_scale=30 \<br/>  --random_brightness=30 \<br/>  --eval_step_interval=100 \<br/>  --how_many_training_steps=1000 \<br/>  --architecture mobilenet_1.0_128_quantized</span></pre><p id="65f0" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">经过1000个训练步骤后，我们达到了99.7%的准确率。哇！显然手机用户非常擅长道路分类。</p><p id="aae6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这里有一些它误分类的图片:</p><div class="kh ki kj kk fq ab cb"><figure class="mf kl nc mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/caa9ee7d4a9a1c3ea1db4ecadffd1e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*K_CLg2zSmtEVFCmT.jpeg"/></div></figure><figure class="mf kl nc mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/86cf22762015bd1f8a48a299f54bb304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*BemGCYJ-qLDGUl-V.jpeg"/></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek nd di ne mr"><strong class="bd nf">Left</strong>: A “not road” image classified as road. I’d say that’s an acceptable failure. It’s clearly a road, just not the type of road we’re looking for. <strong class="bd nf">Right</strong>: A “road” image classified as “not road”. I think this is because there were no bridges in the training set. Could be fixed with more data.</figcaption></figure></div><p id="4ab8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们做同样的事情，但是用最小的MobileNet: 0.25 @ 128，量化。经过1000步的训练，我们达到了92.6%。不符合我们的精度目标。</p><p id="c4a6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">宽一点的怎么样，比如0.5？</p><p id="c0b1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">95.0%!最终的模型只有1.6 MB。看起来我们的钱打光了，如果只是勉强。(<em class="me">应该注意的是，这整个模型是在以10fps捕获的仅仅10分钟的视频上训练的。通过堆积数据，有很大的改进空间。)</em></p><p id="a39e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们快速尝试一下，以确保它按预期工作:</p><pre class="kh ki kj kk fq ms mt mu mv aw mw dt"><span id="f30c" class="mx kt hu mt b fv my mz l na nb">python tensorflow/examples/label_image/label_image.py \ <br/>  --graph=/tmp/output_graph.pb \<br/>  --labels=/tmp/output_labels.txt \<br/>  --image=/home/harvitronix/ml/blogs/road-not-road/test-image.jpg \<br/>  --input_layer=input \<br/>  --output_layer=final_result \<br/>  --input_mean=128 \<br/>  --input_std=128 \<br/>  --input_width=128 \<br/>  --input_height=128</span></pre><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff ng"><img src="../Images/61096f1cc339c53f65fbc0aac579be8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*FY8lNwyGqOafXPNa.jpeg"/></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek">Road: 0.99023 confidence. Looks good!</figcaption></figure><p id="7d6e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">由于我们的标题中有“快得惊人”的字眼，我们在笔记本电脑上运行NVIDIA GeForce 960m GPU能有多快？它可以在3.36秒内浏览1000张图片。也就是每秒297.6帧！</p><h1 id="a085" class="ks kt hu bd ku kv kw kx ky kz la lb lc ja ld jb le jd lf je lg jg lh jh li lj dt translated">在Android应用中使用我们的MobileNet模型</h1><p id="883b" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">现在我们有了一个足够小、足够快、足够准确的模型，让我们将它加载到Android应用程序中，以便我们可以在现实世界中测试它。</p><p id="e887" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="me">还没有训练好的模特？</em> <a class="ae kf" href="https://s3-us-west-1.amazonaws.com/coastline-automation/demo/mobilenet-road-not-road.tar.gz" rel="noopener ugc nofollow" target="_blank"> <em class="me">下载我根据上述数据训练的模型</em> </a> <em class="me">。它包含了。pb和标签文件。提取并遵循以下说明。</em></p><p id="0cb6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">坚持我们的主题，使用TensorFlow提供的工具(顺便说一句，这有多棒？)，我们将利用Android示例项目来快速运行这个东西。</p><h2 id="1e60" class="mx kt hu bd ku nh ni nj ky nk nl nm lc js nn no le jw np nq lg ka nr ns li nt dt translated">获取和构建项目</h2><p id="ea30" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">如果您还没有，请继续克隆TensorFlow repo:</p><pre class="kh ki kj kk fq ms mt mu mv aw mw dt"><span id="aae7" class="mx kt hu mt b fv my mz l na nb">git clone <a class="ae kf" href="https://github.com/tensorflow/tensorflow.git" rel="noopener ugc nofollow" target="_blank">https://github.com/tensorflow/tensorflow.git</a> --depth 1</span></pre><p id="b9de" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你会在<code class="eh nu nv nw mt b">tesnorflow/examples/android</code>文件夹中找到一个现成的Android项目来完成这类任务。在Android Studio中打开文件夹，构建它，在手机上加载APK，你就有了一个图像分类器，它使用在ImageNet上训练的Inception V3模型，准备区分你的猫和鸭嘴兽。</p><p id="5731" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="me">如果你在构建app时遇到了问题，一定要看看</em> <a class="ae kf" href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android" rel="noopener ugc nofollow" target="_blank"> <em class="me"> TensorFlow Android自述</em> </a> <em class="me">中的说明。我最大的挑战是NDK版本。降级到</em><a class="ae kf" href="https://developer.android.com/ndk/downloads/older_releases.html" rel="noopener ugc nofollow" target="_blank"><em class="me">r12b</em></a><em class="me">解决了我的问题。</em></p><h2 id="040e" class="mx kt hu bd ku nh ni nj ky nk nl nm lc js nn no le jw np nq lg ka nr ns li nt dt translated">初始速度基准</h2><p id="13eb" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">因为我们已经在应用程序上运行了Inception，所以让我们进行一些测量，以便我们可以将其与我们的MobileNet进行比较。</p><p id="720b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">示例项目附带的初始模型是53.9 mb。相比之下，我们的MobileNet只有1.6 mb！它的运行速度约为240毫秒/推理，即每秒4帧(fps)。它使用了大约40%的CPU。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff nx"><img src="../Images/fac967f97faf79aa59a919dfb7697d12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dMUICGVG0tcwT6lpdtJRwA.png"/></div></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek">Inception V3 running at 4fps.</figcaption></figure><p id="1b0a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们以每秒1帧的速度尝试一下:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff ny"><img src="../Images/e870c39f05bfbff2de0a03f3a75745b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*YIvCIZ3cGVCoZYhnKV1fLQ.png"/></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek">Inception V3 running at 1fps.</figcaption></figure><p id="05c0" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">仍然上涨了35%以上。希望我们的MobileNet可以做得更好，否则我们将无法接近我们的最高5%使用率的目标。</p><h2 id="152f" class="mx kt hu bd ku nh ni nj ky nk nl nm lc js nn no le jw np nq lg ka nr ns li nt dt translated">切换到MobileNet</h2><p id="e291" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">现在让我们对Android项目做一些小的修改，以使用我们定制的MobileNet模型。</p><p id="bf4f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先，将您的模型和标签复制到项目的<code class="eh nu nv nw mt b">assets</code>文件夹中。我的分别在<code class="eh nu nv nw mt b">/tmp/output_graph.pb</code>和<code class="eh nu nv nw mt b">/tmp/output_labels.txt</code>。</p><p id="b17b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，打开ClassifierActivity，它位于:</p><pre class="kh ki kj kk fq ms mt mu mv aw mw dt"><span id="2f9c" class="mx kt hu mt b fv my mz l na nb">tensorflow/examples/android/src/org/tensorflow/demo/ClassifierActivity.java</span></pre><p id="727e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您需要更新文件顶部的常量来定义新模型的设置。第一次打开时，它看起来是这样的:</p><pre class="kh ki kj kk fq ms mt mu mv aw mw dt"><span id="f393" class="mx kt hu mt b fv my mz l na nb">private static final int <em class="me">INPUT_SIZE </em>= 224;<br/>private static final int <em class="me">IMAGE_MEAN </em>= 117;<br/>private static final float <em class="me">IMAGE_STD </em>= 1;<br/>private static final String <em class="me">INPUT_NAME </em>= "input";<br/>private static final String <em class="me">OUTPUT_NAME </em>= "output";<br/><br/>private static final String <em class="me">MODEL_FILE </em>= "file:///android_asset/tensorflow_inception_graph.pb";<br/>private static final String <em class="me">LABEL_FILE </em>=<br/>    "file:///android_asset/imagenet_comp_graph_label_strings.txt";</span></pre><p id="e527" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">将其更改为:</p><pre class="kh ki kj kk fq ms mt mu mv aw mw dt"><span id="3594" class="mx kt hu mt b fv my mz l na nb">private static final int <em class="me">INPUT_SIZE </em>= 128;<br/>private static final int <em class="me">IMAGE_MEAN </em>= 128;<br/>private static final float <em class="me">IMAGE_STD </em>= 128;<br/>private static final String <em class="me">INPUT_NAME </em>= "input";<br/>private static final String <em class="me">OUTPUT_NAME </em>= "final_result";<br/><br/>private static final String <em class="me">MODEL_FILE </em>= "file:///android_asset/output_graph.pb";<br/>private static final String <em class="me">LABEL_FILE </em>=<br/>    "file:///android_asset/output_labels.txt";</span></pre><p id="1f9a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">点击run构建项目并将APK加载到您的设备上，您就拥有了自己的道路/非道路分类器！</p><h1 id="5600" class="ks kt hu bd ku kv kw kx ky kz la lb lc ja ld jb le jd lf je lg jg lh jh li lj dt translated">结果呢</h1><p id="85b7" class="pw-post-body-paragraph jj jk hu jl b jm lk iv jo jp ll iy jr js lm ju jv jw ln jy jz ka lo kc kd ke hn dt translated">这里有一个我的道路/非道路应用程序的视频。我对UI做了一些调整，以便更容易看到正在发生的事情:</p><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="nz oa l"/></div></figure><p id="63cb" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">那么它有多快呢，CPU使用率呢？</p><p id="4e0d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在我的小米米5上，这个东西会飞。它在55ms左右做推理，也就是每秒18帧！就一个<a class="ae kf" href="http://www.gearbest.com/cell-phones/pp_602057.html?wid=81" rel="noopener ugc nofollow" target="_blank"> $300的小米Mi5s </a>！</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff ob"><img src="../Images/74683476dfd9d88d04963f480fe19c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/1*1VZUa3mn3569l3ePzq3piA.gif"/></div></figure><p id="4f96" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">不过，这是相当CPU密集型的，全速运行时使用25–30%。有道理，因为我们正以最快的速度运行它。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff oc"><img src="../Images/195b5d3d6194beb7b06a14b3963d74a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mCDsVraF_cSTL-UtFlktEw.png"/></div></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek">MobileNEt CPU monitor, running at 18fps.</figcaption></figure><p id="af85" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们希望降低到5%以下，我们将通过降低它运行的频率来做到这一点，因为我们的用例不需要连续运行推理来实现我们上面讨论的隐私目标。将它改为每18帧分类一次(大约每秒一次)会将平均使用率降低到大约5.5%！</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff od"><img src="../Images/083b7bf9427bc0868e3971b98092f4fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oF84bARe2CJwx_ixBZOvFA.png"/></div></div><figcaption class="ml mm fg fe ff mn mo bd b be z ek">MobileNet running at 1fps.</figcaption></figure><p id="1619" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">所以我们的MobileNet模型只有Inception的1/30大。每帧运行速度提高了3倍以上。而且它使用的CPU资源要少得多。</p><p id="84e9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">可以肯定地说，我和MobileNets将会像这样:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff oe"><img src="../Images/caee46e5b85daa2696489082581adf6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/1*HtR4hdJiLvTReR_0608K0w.gif"/></div></figure><blockquote class="of og oh"><p id="e130" class="jj jk me jl b jm jn iv jo jp jq iy jr oi jt ju jv oj jx jy jz ok kb kc kd ke hn dt translated"><em class="hu">喜欢这篇文章吗？通过点击小❤.帮助其他人找到它感谢阅读！</em></p></blockquote><figure class="kh ki kj kk fq kl"><div class="bz el l di"><div class="ol oa l"/></div></figure></div></div>    
</body>
</html>