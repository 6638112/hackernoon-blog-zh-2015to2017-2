<html>
<head>
<title>Spy your pet with a Raspberry Pi Camera Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">间谍您的宠物与树莓Pi相机服务器</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/spy-your-pet-with-a-raspberry-pi-camera-server-e71bb74f79ea?source=collection_archive---------1-----------------------#2017-08-23">https://medium.com/hackernoon/spy-your-pet-with-a-raspberry-pi-camera-server-e71bb74f79ea?source=collection_archive---------1-----------------------#2017-08-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/bd907d4554e62848986637d67f93cc7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*TOAsp2aWKgMjkaWQi8q8Vw.gif"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">nom nom nom nom nom</figcaption></figure><p id="8cf1" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">本教程是我的“用树莓派窥探你的宠物”的第一部分。我有一只叫“莫奇”的小兔子，当我不在家的时候，我经常担心他。因此，我决定建造一个互动的笼子，以便在我工作或旅行时与Mochi联系。</p><p id="14d8" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">构建一个交互式笼子涉及3个主要挑战:</p><ul class=""><li id="8e1f" class="ke kf hu ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">安装一个监视连接的摄像机，</li><li id="0cf2" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">建造一个自动食物分发器，</li><li id="7205" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">从世界任何地方访问您的相机和食物分发器</li></ul><p id="2d2e" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我的第一个挑战是间谍相机系统，我将在本教程中描述。</p><h1 id="27b4" class="ks kt hu bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">所需设备</h1><ul class=""><li id="3426" class="ke kf hu ji b jj lq jn lr jr ls jv lt jz lu kd kj kk kl km dt translated"><a class="ae lv" href="https://thepihut.com/collections/raspberry-pi" rel="noopener ugc nofollow" target="_blank">树莓派</a>带<a class="ae lv" href="https://www.raspbian.org/" rel="noopener ugc nofollow" target="_blank"> Raspbian OS </a>(正常情况下应该是带Raspbian OS的SD卡发货)</li><li id="2d1c" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">带有HDMI、usb键盘、usb鼠标和以太网线缆的屏幕，适合您的raspberry PI</li><li id="c50f" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae lv" href="https://thepihut.com/products/raspberry-pi-camera-module?variant=758603005" rel="noopener ugc nofollow" target="_blank"> Pi摄像头</a>或<a class="ae lv" href="https://thepihut.com/products/raspberry-pi-noir-camera-module" rel="noopener ugc nofollow" target="_blank"> Pi摄像头</a>(红外线)</li><li id="11dc" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae lv" href="https://thepihut.com/products/official-raspberry-pi-wifi-adapter?variant=3036568516" rel="noopener ugc nofollow" target="_blank"> Wifi加密狗</a></li></ul><h1 id="c901" class="ks kt hu bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">在您的PI上安装摄像头</h1><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lw"><img src="../Images/1cf4d4142caf9afbadcd1d3b89c5aa63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KzRqBrD9kcA7Uc7csfOQPQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Raspberry Pi 3</figcaption></figure><p id="16fe" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">首先，关掉你的树莓派，小心避免手上有任何静电。如上图所示，将相机蓝带插入树莓接口。要插上相机，你必须慢慢松开白色塑料部分，插上带子，然后再次夹住白色部分。</p><p id="ce3c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在，将以太网电缆、键盘、鼠标和屏幕连接到您的PI。别忘了插含有Raspbian OS的SD卡！最后，插上电源打开它。几秒钟后，您应该会看到:</p><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/cc9233530e320c5fb533c79ab4a07a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wGNxhwKh1SiL9KXEHxnhRQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Raspbian Operating System on your Raspberry Pi</figcaption></figure><h1 id="9026" class="ks kt hu bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">在您的PI上启用摄像机配置</h1><p id="ca3e" class="pw-post-body-paragraph jg jh hu ji b jj lq jl jm jn lr jp jq jr mb jt ju jv mc jx jy jz md kb kc kd hn dt translated">为了在Pi相机上使用兼容的库或软件，您首先需要在您的Raspberry Pi选项上启用其配置。在您的<strong class="ji hv"> Pi终端</strong>(导航栏中的屏幕图标)上运行以下命令:</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="b213" class="mj kt hu mf b fv mk ml l mm mn">sudo raspi-config</span></pre><p id="7193" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">选择<strong class="ji hv">摄像头</strong>，选择<strong class="ji hv">启用对树莓派摄像头的支持</strong>。出现提示时重新启动，就大功告成了！相机现在应该有几个可用的功能:</p><ul class=""><li id="0f4e" class="ke kf hu ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">捕获图像的raspistill(可通过Raspbian直接获得)</li></ul><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="71a0" class="mj kt hu mf b fv mk ml l mm mn"># Test your camera ! <br/>raspistill -o cam.jpg</span></pre><ul class=""><li id="0a8f" class="ke kf hu ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">raspivid来捕捉视频，</li><li id="4a35" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae lv" href="https://github.com/Motion-Project/motion" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hv">运动</strong> </a>这就是我们要用的</li></ul><h1 id="3110" class="ks kt hu bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">安装动作</h1><p id="c4a7" class="pw-post-body-paragraph jg jh hu ji b jj lq jl jm jn lr jp jq jr mb jt ju jv mc jx jy jz md kb kc kd hn dt translated"><a class="ae lv" href="https://github.com/Motion-Project/motion" rel="noopener ugc nofollow" target="_blank"> Motion </a>是一款摄像头信号监控软件，也具有有趣的运动检测功能。</p><p id="acd3" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">首先，让我们确保您的Pi上的所有内容都是最新的。在Pi终端中运行以下命令:</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="dafc" class="mj kt hu mf b fv mk ml l mm mn">sudo apt-get update<br/>sudo apt-get upgrade</span></pre><p id="be8d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在，让我们在我们的Pi上安装运动软件，并激活相机的官方驱动程序。</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="81ae" class="mj kt hu mf b fv mk ml l mm mn">sudo apt-get install motion</span><span id="18e8" class="mj kt hu mf b fv mo ml l mm mn"># Careful, on the v4l2 it's an 'L', not the number 1<br/>sudo modprobe bcm2835-v4l2</span></pre><p id="7538" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">为了完成这个过程，我们还必须告诉Pi在任何重新启动后激活驱动程序，这样我们的摄像机将始终可用。</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="fdfe" class="mj kt hu mf b fv mk ml l mm mn">sudo nano /etc/modules<br/># at the end of the file, add this line :<br/>bcm2835-v4l2</span></pre><p id="0763" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">因为我们希望我们的摄像机服务器持续运行，所以让我们将它设置为一个<a class="ae lv" href="https://en.wikipedia.org/wiki/Daemon_(computing)" rel="noopener ugc nofollow" target="_blank">守护进程</a>(后台进程)并自动启动它。</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="2c50" class="mj kt hu mf b fv mk ml l mm mn">sudo nano /etc/default/motion<br/># in this file, search for <!-- -->start_motion_daemon and activate it<br/># start_motion_daemon=yes</span></pre><p id="a0a4" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们完成了Motion安装！让我们配置它，这样我们就可以有一个摄像头服务器！</p><h1 id="2bb2" class="ks kt hu bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">配置运动</h1><p id="259e" class="pw-post-body-paragraph jg jh hu ji b jj lq jl jm jn lr jp jq jr mb jt ju jv mc jx jy jz md kb kc kd hn dt translated">创建备份并打开运动配置文件</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="35ac" class="mj kt hu mf b fv mk ml l mm mn">sudo cp /etc/motion/motion.conf /etc/motion/motion.conf.bak<br/>sudo nano /etc/motion/motion.conf</span></pre><p id="2224" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">找到下面的选项，并按如下方式编辑它们</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="4a36" class="mj kt hu mf b fv mk ml l mm mn"># Allow motion to run the daemon we've set earlier<br/>daemon on</span><span id="1753" class="mj kt hu mf b fv mo ml l mm mn"># Set the logfile (important to debug motion if you webservers crashes)<br/>logfile /tmp/motion.log</span><span id="531f" class="mj kt hu mf b fv mo ml l mm mn"># we want to be able to access the stream outside off the Pi's localhost<br/>stream_localhost off</span><span id="55f1" class="mj kt hu mf b fv mo ml l mm mn"># disable pictures and movies saving<br/>output_pictures off <br/>ffmpeg_output_movies off</span><span id="d8c4" class="mj kt hu mf b fv mo ml l mm mn"># set the framerate of the stream (100 for higher quality)<br/>framerate 100</span><span id="4290" class="mj kt hu mf b fv mo ml l mm mn"># set the width and height of your video<br/>width 640<br/>height 480</span><span id="97e4" class="mj kt hu mf b fv mo ml l mm mn"># control de port 8080 by default<br/>webcontrol_port 8081</span><span id="c839" class="mj kt hu mf b fv mo ml l mm mn"># careful ! don't set the stream_port just like the webcontrol port</span></pre><p id="638f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">请注意，选择高分辨率需要更大的带宽，如果您的互联网连接较低，您的流将会滞后。你还必须为Pi <strong class="ji hv">选择一个<strong class="ji hv">兼容的分辨率</strong>(否则流不会启动)</strong>。请检查<a class="ae lv" href="https://www.raspberrypi.org/documentation/hardware/camera/" rel="noopener ugc nofollow" target="_blank">树莓Pi可用的视频模式</a>。</p><h2 id="e799" class="mj kt hu bd ku mp mq mr ky ms mt mu lc jr mv mw lg jv mx my lk jz mz na lo nb dt translated">可选:保存移动侦测图片</h2><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="77ca" class="mj kt hu mf b fv mk ml l mm mn"><strong class="mf hv">## OPTIONAL - motion detection</strong><br/>## define the number of images saved when a movement is detected<br/>output_pictures on<br/>pre_capture 1<br/>post_capture 1</span><span id="3929" class="mj kt hu mf b fv mo ml l mm mn">## define the folder where captures are going <strong class="mf hv">(don't forget the chmod rights if necessary)</strong><br/>target_dir /&lt;path_of_your_choice&gt;</span></pre><h1 id="fa1e" class="ks kt hu bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">从本地计算机测试我们的摄像机服务器</h1><p id="1dc9" class="pw-post-body-paragraph jg jh hu ji b jj lq jl jm jn lr jp jq jr mb jt ju jv mc jx jy jz md kb kc kd hn dt translated">首先，让我们启动我们的运动服务器！</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="280c" class="mj kt hu mf b fv mk ml l mm mn">sudo service motion start</span></pre><p id="9d2f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在，您应该能够直接在您的Pi上查看摄像机流。在Raspbian的home菜单中搜索默认的web浏览器，查看网址<a class="ae lv" href="http://localhost:8081" rel="noopener ugc nofollow" target="_blank"><strong class="ji hv">http://localhost:8081</strong></a>。你应该看看你的相机服务器！但是现在，我们希望能够从任何连接到我们Wifi的设备上窥探我们的宠物，也可以从家里以外的任何地方窥探！</p><p id="3ab3" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">将Wifi加密狗插入您的raspberry Pi，然后<strong class="ji hv">在其上配置Wifi连接</strong>。</p><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lw"><img src="../Images/111c500404ab1281ff9e5ba6e752e7f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KIdFSczyBX0PChYJPLv-SQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">The official Raspberry PI Wifi Dongle</figcaption></figure><p id="bdd5" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在您的Pi终端中运行以下命令</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="77d3" class="mj kt hu mf b fv mk ml l mm mn"># will open the network configuration file<br/>sudo nano /etc/network/interfaces</span></pre><p id="8cd6" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在下面的文件中，输入您自己的SSID和Wifi密码。</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="0503" class="mj kt hu mf b fv mk ml l mm mn">auto lo<br/>iface lo inet loopback<br/>iface eth0 inet dhcp<br/><br/>allow-hotplug wlan0<br/>auto wlan0<br/><br/><strong class="mf hv">iface wlan0 inet dhcp<br/>   wpa-ssid "Your Network SSID"<br/>   wpa-psk "Your Password"</strong></span></pre><p id="759c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">重启网络接口</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="7dba" class="mj kt hu mf b fv mk ml l mm mn">sudo service networking reload</span></pre><p id="c713" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在，让我们通过启动以下命令来获取您的Pi的本地IP地址:</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="699e" class="mj kt hu mf b fv mk ml l mm mn">ifconfig</span></pre><p id="c8fb" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在命令行响应中，找到<strong class="ji hv">“inet addr”</strong>，这将为您提供Raspberry Pi IP</p><pre class="lx ly lz ma fq me mf mg mh aw mi dt"><span id="191d" class="mj kt hu mf b fv mk ml l mm mn">wlan0 Link encap:Ethernet HWaddr 80:1f:02:aa:12:58<br/>      <strong class="mf hv">inet addr:192.168.1.8</strong> Bcast:192.168.1.255 Mask:255.255.255.0<br/>      ...</span></pre><p id="8992" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们准备在所有连接到我们家庭Wifi的设备中测试我们的摄像头服务器！拿起你的手机或笔记本电脑，进入→ <strong class="ji hv"> http:// &lt;用你的inet地址&gt;替换它:8081。</strong>你应该看到相机流了！</p><h1 id="d7d9" class="ks kt hu bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">结论和下一步措施</h1><p id="a9a8" class="pw-post-body-paragraph jg jh hu ji b jj lq jl jm jn lr jp jq jr mb jt ju jv mc jx jy jz md kb kc kd hn dt translated">耶！现在我们有我们的本地间谍相机流！向Mochi问好！</p><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/b5b93a9f0cfce24a5dc736f3e81d331e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g_8XnUVhuewctASkTHADfQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Our little friend is now under surveillance</figcaption></figure><p id="8857" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">然而，我们希望能够从任何地方查看它！为此，我建议使用动态DNS服务。关于详细的解释，你可以查看我的下一篇教程<a class="ae lv" rel="noopener" href="/@michelparreno/how-to-access-your-raspberry-pi-camera-from-anywhere-544ab9e5bacc"> <strong class="ji hv">如何从任何地方访问你的树莓派。</strong>T3】</a></p><p id="2d99" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">给你的宠物造一个食物分配器怎么样？用<a class="ae lv" rel="noopener" href="/@michelparreno/build-a-connected-food-dispenser-with-raspberry-pi-19f5cdcc1541"> <strong class="ji hv">搞定一切用树莓Pi </strong> </a> <strong class="ji hv">搭建一个联网的食物分配器。</strong></p></div></div>    
</body>
</html>