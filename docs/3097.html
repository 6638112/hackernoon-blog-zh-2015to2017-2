<html>
<head>
<title>Building a face recognition web app in under an hour</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在不到一小时的时间内构建一个人脸识别网络应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/building-a-face-recognition-web-app-in-under-an-hour-345aa91487c?source=collection_archive---------2-----------------------#2017-03-13">https://medium.com/hackernoon/building-a-face-recognition-web-app-in-under-an-hour-345aa91487c?source=collection_archive---------2-----------------------#2017-03-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/9e9bca6c5798d53d4247999d83962413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfRu4hOMn5Cm6f1SdFGZRQ.png"/></div></div></figure><blockquote class="jc jd je"><p id="76b6" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><a class="ae ke" href="https://devan-sabaratnam.squarespace.com/blog/2017/3/13/building-a-face-recognition-app-in-less-than-an-hour" rel="noopener ugc nofollow" target="_blank">原载@ devan-sabaratnam.squarespace.com</a>。</p></blockquote><p id="e82e" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">上周末，我在浏览我的亚马逊<a class="ae ke" href="https://hackernoon.com/tagged/aws" rel="noopener ugc nofollow" target="_blank"> AWS </a>控制台，我注意到上面有一项名为“<a class="ae ke" href="https://aws.amazon.com/rekognition/" rel="noopener ugc nofollow" target="_blank"> Rekognition </a>的新服务。我猜这是引起我注意的拼写错误，但我想知道这项服务是什么？亚马逊习惯于以惊人的频率向他们的平台添加新服务，这一次不知何故逃过了我的注意。</p><p id="932a" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">所以我深入调查了一下，原来在2016年末，亚马逊在他们的平台上发布了他们自己的<a class="ae ke" href="https://aws.amazon.com/rekognition/" rel="noopener ugc nofollow" target="_blank">图像识别引擎</a>。它不仅可以进行面部识别，还可以进行一般的照片对象识别。它仍然是相当新的，所以细节是粗略的，但我立即兴奋地尝试它。长话短说，不到一个小时，我就完成了一个快速的样本网页，可以从我的电脑摄像头中抓取照片，并在上面进行基本的面部识别。想知道同样怎么做吗？请继续阅读…</p><p id="a1aa" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我以前曾尝试过面部识别技术，使用第三方库，以及微软的Face API，但是组装一个简单的原型充满了复杂性和陡峭的学习曲线。但是在浏览Rekognition文档时(尽管它们很薄)，我意识到AWS API实际上很容易使用，虽然看起来很强大。我等不及了，决定先动手做一个快速原型。</p><h1 id="8e8e" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">目标</h1><p id="6afe" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">我想要一个“快速而肮脏”的单一网页，允许我使用iMac相机拍摄照片，并对照片进行一些基本的识别——基本上，我想识别坐在电脑前的用户。</p><p id="fc13" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">Amazon Rekognition服务允许您创建一个或多个<em class="jh">集合</em>。一个集合就是，嗯，一个你告诉它保存的样本照片的面部向量的集合。注意:该服务不存储实际的照片，而是从参考照片获得的测量值的JSON表示。</p><p id="efd6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">一旦你在亚马逊上有了一个收藏，你就可以拍摄一张主题照片，让它将主题的特征与其参考收藏进行比较，并返回最接近的匹配。听起来很简单，不是吗？的确如此。老实说，编码该网页的前端以获取相机数据实际上比后端执行识别花费了更长的时间——相差3比1！！</p><p id="4a52" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">因此，简而言之，该网页允许你(1)在Amazon上创建或删除面部数据集合，(2)通过捕获的照片将面部数据上传到你的集合，以及(3)将新照片与现有集合进行比较以找到匹配。</p><p id="2b17" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">哦，作为一个巧妙的附加(4)，我还在这个演示中添加了Amazon <a class="ae ke" href="https://aws.amazon.com/polly/" rel="noopener ugc nofollow" target="_blank"> Polly </a>服务，这样在识别出一张照片后，页面就会向照片中的人发送一个口头的、定制的问候！</p><figure class="lm ln lo lp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ll"><img src="../Images/cf092a6bbcfd8538c97b5049641656db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*StFwtSQPkdg0uvOsyGOKdw.png"/></div></div><figcaption class="lq lr fg fe ff ls lt bd b be z ek">The simple app (Note: Not my real face! :D )</figcaption></figure><h2 id="5d17" class="lu kj hu bd kk lv lw lx ko ly lz ma ks kf mb mc kw kg md me la kh mf mg le mh dt translated">前端</h2><p id="5bd0" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">我的第一个问题是用什么库来用我的iMac相机捕捉图像。在谷歌上快速搜索后，我在GitHub上找到了由<a class="ae ke" href="https://github.com/amw" rel="noopener ugc nofollow" target="_blank"> amw </a>开发的惊人的<a class="ae ke" href="https://github.com/amw/jpeg_camera" rel="noopener ugc nofollow" target="_blank"> JPEG相机库</a>，它允许你使用标准的HTML5画布来执行捕捉，或者回退到用于旧浏览器的Flash小部件。我很快拿到了这个库，并根据我的需要修改了示例<a class="ae ke" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> javascript </a>文件。</p><h2 id="8ef8" class="lu kj hu bd kk lv lw lx ko ly lz ma ks kf mb mc kw kg md me la kh mf mg le mh dt translated">后端</h2><p id="a220" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">对于后端，我完成了一个快速的Sinatra项目，这是一个基于Ruby的轻量级框架，可以完成AWS的所有繁重工作。我实际上广泛使用了Sinatra(实际上是,<a class="ae ke" href="http://padrinorb.com/" rel="noopener ugc nofollow" target="_blank"> Padrino </a>)来构建我所有的网络应用，并强烈推荐这个平台。</p><p id="daf0" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">注意:Amazon Rekognition示例实际上提倡首先将API中使用的源照片上传到Amazon S3 bucket，然后处理它们。我想避免这个双重步骤，而是将图像数据直接发送给他们的API，我设法做到了这一点。</p><p id="a92d" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我也设法用他们的波利问候做了一件类似的事情。我没有将音频保存到MP3文件中并播放，而是设法将MP3数据直接编码到页面上的<audio>标签中，并从那里播放！</audio></p><h2 id="2889" class="lu kj hu bd kk lv lw lx ko ly lz ma ks kf mb mc kw kg md me la kh mf mg le mh dt translated">代码</h2><p id="7ebe" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">我已经把这个项目的所有代码放在我的GitHub页面上。随便抓，随便叉，随便改进。我将尽力在这里更详细地解释代码。</p><h1 id="bed7" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">台阶</h1><p id="41fe" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">首先，你需要一个亚马逊AWS账户。我不会在这里详细介绍如何设置它，因为你可以在Google上找到很多这样做的文章。</p><h2 id="5468" class="lu kj hu bd kk lv lw lx ko ly lz ma ks kf mb mc kw kg md me la kh mf mg le mh dt translated">创建AWS IAM用户</h2><p id="e040" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">但是一旦你在AWS上设置好了，我们需要做的第一件事就是创建一个Amazon IAM(身份和访问管理)用户，该用户拥有使用Rekognition服务的权限。哦，我们还将为亚马逊的<a class="ae ke" href="https://aws.amazon.com/polly/" rel="noopener ugc nofollow" target="_blank"> Polly </a>服务设置权限，因为一旦我开始使用这些新服务，我就无法停止。</p><p id="8e69" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">在亚马逊控制台中，点击左上角的“<strong class="ji hv">服务</strong>，然后从大量亚马逊服务列表中选择“<strong class="ji hv"> IAM </strong>”。然后，在左侧菜单中，点击“<strong class="ji hv">用户</strong>”。这将显示您在控制台上创建的现有IAM用户的列表，如果您过去曾经这样做过的话。</p><figure class="lm ln lo lp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ll"><img src="../Images/b384cc766e3a23cf8cd333b973070c0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64Wpd_A8x1Ckulxezb1cdQ.png"/></div></div></figure><p id="8c17" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">单击该列表顶部的“<strong class="ji hv">添加用户</strong>”蓝色按钮，添加新的IAM用户。</p><figure class="lm ln lo lp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ll"><img src="../Images/05f3bbab72734ea0f76aa0e598bd1a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xB51KkweWldyl1qSDfwQzQ.png"/></div></div></figure><p id="6705" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">给用户一个可识别的名称(更多供您参考)，并确保您勾选了“<em class="jh">编程访问</em>”，因为您将在API调用中使用这个IAM。</p><figure class="lm ln lo lp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ll"><img src="../Images/330bd28f3ffc4906c12a440aa6fbdd39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UUcRh-IL4e2lOvSUoh0hXw.png"/></div></div></figure><p id="9079" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">接下来是权限设置。确保您单击屏幕上的第三个框，即“<em class="jh">直接附加现有策略</em>”。然后，在下面的“<em class="jh"> Filter: Policy Type </em>”搜索框中，键入“<strong class="ji hv"> rekognition </strong>”(注意亚马逊语的拼写)以仅过滤rekognition策略。从列表中选择“<em class="jh">amazonrecognitionfullaccess</em>”，勾选旁边的复选标记。</p><p id="cfbd" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">接下来，将搜索过滤器更改为“<strong class="ji hv">波莉</strong>”，并在“<em class="jh"> AmazonPollyFullAccess </em>”旁边放置一个复选标记。</p><p id="17bc" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">快到了。我们现在拥有Amazon Rekognition和Amazon Polly的IAM的完全权限。点击右下方的<strong class="ji hv">下一步:复习</strong>。</p><figure class="lm ln lo lp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ll"><img src="../Images/c8b14d74219b35ff8bf1632e0a215bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TANvFHveWMzNWAg3dgSFeQ.png"/></div></div></figure><p id="9344" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">在review页面上，您应该看到2个托管策略，它们赋予您对Rekognition和Polly的完全访问权限。如果没有，请返回并按照上一步重新选择策略。如果是，则点击右下角的“<strong class="ji hv">创建用户</strong>”。</p><figure class="lm ln lo lp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ll"><img src="../Images/6872b531aac601408e67948f71f057ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MB4NeaAuI6PxX9yzc_1nmw.png"/></div></div></figure><p id="020d" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">现在这一页很重要。记下您在此页面上获得的AWS密钥和密码，因为我们需要将其合并到下面的应用程序中。</p><blockquote class="jc jd je"><p id="5ed4" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这是您唯一一次看到这个用户的密钥/秘密，所以请将信息复制并粘贴到安全的地方，并从这个页面下载包含信息的CSV文件并妥善保存。</p></blockquote><h1 id="09a5" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">下载代码</h1><p id="a3d6" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">下一步，从我的<a class="ae ke" href="https://github.com/CyberFerret/FaceRekognition-Demo" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>下载示例代码，这样你就可以根据需要修改它。转到这个链接，或者下载代码作为ZIP文件，或者执行“git clone”将其克隆到您的工作文件夹中。</p><p id="c05a" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">你需要做的第一件事是在你的工作文件夹中创建一个名为<code class="eh mi mj mk ml b">.env</code>的文件，并输入这两行，在那里替换你的Amazon IAM密钥和秘密(注意:下面这些不是真正的密钥细节):</p><pre class="lm ln lo lp fq mm ml mn mo aw mp dt"><span id="1e95" class="lu kj hu ml b fv mq mr l ms mt">export AWS_KEY=A1B2C3D4E5J6K7L10<br/>export AWS_SECRET=T/9rt344Ur+ln89we3552H5uKp901</span></pre><p id="4c92" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">可选:您也可以在命令行(Linux和OSX)上运行这两行代码，将它们设置为应用程序可以使用的环境变量。Windows用户也可以运行它们，只需将“导出”前缀替换为“设置”。</p><p id="04c1" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">现在，如果您的系统上安装了Ruby(注意:不需要完整的Ruby on Rails，只需要基本的Ruby语言)，那么您就可以运行</p><pre class="lm ln lo lp fq mm ml mn mo aw mp dt"><span id="272e" class="lu kj hu ml b fv mq mr l ms mt">bundle install</span></pre><p id="c928" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">安装所有先决条件(Sinatra等)。)，然后就可以打字了</p><pre class="lm ln lo lp fq mm ml mn mo aw mp dt"><span id="27f6" class="lu kj hu ml b fv mq mr l ms mt">ruby faceapp.rb</span></pre><p id="a41d" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">来运行这个应用程序。这应该会在端口4567上启动一个web浏览器，这样您就可以启动浏览器并转到</p><pre class="lm ln lo lp fq mm ml mn mo aw mp dt"><span id="5704" class="lu kj hu ml b fv mq mr l ms mt"><a class="ae ke" href="http://localhost:4567" rel="noopener ugc nofollow" target="_blank">http://localhost:4567</a></span></pre><p id="f9c9" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">查看网页并开始测试。</p><h1 id="7630" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">使用应用程序</h1><p id="f296" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">网页本身相当简单。您应该会在顶部中间看到一个实时流图像，这是来自您的车载摄像头的反馈。</p><p id="a48e" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">您需要做的第一件事是通过单击页面左下方的链接来创建一个收藏。这将在Amazon的服务器上创建一个空集合来保存您的图像数据。注意，这个集合的默认名称是<code class="eh mi mj mk ml b">faceapp_test</code>，但是您可以在<code class="eh mi mj mk ml b">faceapp.rb</code> ruby代码中更改它(第17行)。</p><p id="cd4d" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">然后，要开始将面孔添加到您的收藏中，请几个人在您的电脑或桌子/手机前坐下，并确保他们的面孔仅出现在相框中(多个面孔会导致扫描失败)。准备就绪后，在文本输入框中输入他们的姓名，然后点击“<strong class="ji hv">添加到收藏库</strong>”按钮。您应该会看到一条消息，表明他们的面部数据已经添加到数据库中。</p><p id="9d7b" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">一旦你在数据库中建立了几个面孔，你就可以让随机的人坐在摄像机前，点击“比较图像”。希望对于已经加入收藏的人，你可以在屏幕上看到他们的名字，以及个性化的口头问候。</p><p id="31ea" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">请注意，亚马逊Rekognition通常的工作方式是将JPEG/PNG照片上传到亚马逊S3桶，然后从那里运行处理，但我想绕过这两个步骤，实际上将照片数据作为Base64编码的字节流直接发送到Rekognition。幸运的是，用于Ruby的aws-sdk允许您使用这两种方法。</p><p id="310c" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">现在让我们浏览一下代码。</p><p id="b4fc" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">首先，让我们看看原始HTML页面本身。</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="mu mv l"/></div></figure><p id="2bbe" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">这是一个非常简单的页面，对于任何熟悉HTML创建的人来说都是一目了然的。只是一系列的名称div，以及按钮和链接。请注意，我们使用jQuery，还使用<a class="ae ke" href="https://momentjs.com/" rel="noopener ugc nofollow" target="_blank"> Moment.js </a>进行自定义问候。值得注意的是<code class="eh mi mj mk ml b">faceapp.js</code>代码，它完成了所有棘手的事情，以及到JPEG相机库的链接。</p><p id="9f0a" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">您可能还会注意到文件底部的<code class="eh mi mj mk ml b">&lt;audio&gt;</code>标签，您可能会问这是怎么回事——嗯，这将是我们发送给用户的音频问候的占位符(见下文)。</p><p id="64ba" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我们来分解一下主app js文件。</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="mu mv l"/></div></figure><p id="7ee6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">这将设置JPEG相机库，以在屏幕上显示相机馈送，并处理图像的上传。</p><p id="bb69" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated"><code class="eh mi mj mk ml b">add_to_collection()</code>函数很简单，它从相机获取捕获的图像，然后将用户名作为参数发送到<code class="eh mi mj mk ml b">/upload</code>端点。该功能将检查您是否实际输入了姓名，否则将不会继续，因为您需要一个短名称作为此面部数据的唯一标识符。</p><p id="78bf" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">上传功能只是检查对<code class="eh mi mj mk ml b">/upload</code>的调用是否干净地完成了，如果没有完成，要么显示一条成功消息，要么显示错误。</p><p id="6a9d" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated"><code class="eh mi mj mk ml b">compare_image()</code>函数是当你点击<strong class="ji hv">比较图像</strong>按钮时调用的函数。它只是从相机中抓取一帧，并将照片数据发送到<code class="eh mi mj mk ml b">/compare</code>端点。这个端点要么返回一个错误，要么返回一个JSON结构，其中包含找到的人脸的id(名称),以及置信度百分比。</p><p id="e910" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">如果有一个成功的面部匹配，该函数将继续前进，并将找到的面部名称发送到<code class="eh mi mj mk ml b">/speech</code>端点。该端点调用Amazon Polly服务将自定义问候语转换为MP3文件，该文件可以向用户播放。</p><p id="eee6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">Amazon Polly服务以二进制MP3流的形式返回问候，因此我们获取该IO流并对其进行BaseEncode64，然后将其作为编码的源链接放在我们的网页上的<code class="eh mi mj mk ml b">&lt;audio&gt;</code>占位符标记中，然后我们可以对该元素执行一个<code class="eh mi mj mk ml b">play()</code>，以便使用HTML5 Web Audio API通过用户的扬声器播放MP3。</p><p id="8f95" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">这也是我第一次将编码数据放在audio src属性中，而不是一个物理MP3文件的链接，我很高兴地告诉大家，它非常有效！</p><p id="9781" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">app js文件的最后一个是<code class="eh mi mj mk ml b">greetingTime()</code>函数。这只是根据用户一天中的时间来决定是否说“早上好/下午好/晚上好”。这么简单的东西有很多代码，但我想让他们听到的自定义问候适合他们一天中的时间。感谢<a class="ae ke" href="https://gist.github.com/James1x0" rel="noopener ugc nofollow" target="_blank">詹姆斯1x0 </a>给我偷来的<a class="ae ke" href="https://gist.github.com/James1x0/8443042" rel="noopener ugc nofollow" target="_blank">代码片段</a>！</p><p id="7e8d" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">最后，让我们看看Sinatra应用程序的Ruby代码。</p><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="mu mv l"/></div></figure><p id="c1d8" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">非常简单的辛纳特拉的东西。顶部是我们对各种AWS SDK和其他库的需求。</p><p id="a5ad" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">然后是设置AWS身份验证配置的块，以及我们将使用的默认集合名称(您可以随意更改)。</p><p id="58b4" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">然后，代码的其余部分就是Sinatra将监听的端点。它监听GET on '/'以便向最终用户显示实际的web页面，它还监听上面的javascript文件向其发送数据的/upload、/compare和/speech的POST调用。每个端点只有大约3或4行代码来实际执行面部识别和语音任务，所有这些都记录在<a class="ae ke" href="http://docs.aws.amazon.com/sdkforruby/api/Aws/Rekognition/Client.html" rel="noopener ugc nofollow" target="_blank"> AWS SDK文档</a>中。</p><p id="4efb" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">这是我目前能想到的所有分享内容。请享受这个项目，并让我知道你最终用它来构建什么。就我个人而言，我将这个项目作为一些令人惊叹的新功能的起点，我希望我们的主要网络应用程序<a class="ae ke" href="https://hrpartner.io/" rel="noopener ugc nofollow" target="_blank">人力资源合作伙伴</a>能够拥有这些新功能。</p><h1 id="b22c" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">改进的想法</h1><p id="86f2" class="pw-post-body-paragraph jf jg hu ji b jj lg jl jm jn lh jp jq kf li jt ju kg lj jx jy kh lk kb kc kd hn dt translated">Amazon Rekognition和Polly仍然相当新，所以示例应用程序和文档目前还有点基础，但是这可能是意料之中的，因为与他们的大多数其他服务相比，API非常容易使用。</p><p id="94e6" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">我希望他们能改进的一点是对这些服务的控制台支持——特别是检查当前图像集合以进行重新识别的能力。目前，如果不借助纯API调用，就不可能看到您有多少个集合，以及每个集合中有多少个图像描述符(或图像id)。希望这将在未来得到改善。</p><p id="8dab" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">哦，我还希望有一种更简单的方法在本地创建图像JSON概要文件，而不必将编码的图像BLOB一路发送到Amazon服务器进行解释。我希望API的未来版本可以有这样做的本地化功能，因为目前，点击“比较图像”后到服务器的往返可能需要4或5秒来完成识别。</p><p id="543c" class="pw-post-body-paragraph jf jg hu ji b jj jk jl jm jn jo jp jq kf js jt ju kg jw jx jy kh ka kb kc kd hn dt translated">祝你好运，享受你的面部识别/语音合成之旅。</p><div class="lm ln lo lp fq ab cb"><figure class="mw iv mx my mz na nb paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mw iv mx my mz na nb paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mw iv mx my mz na nb paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="jc jd je"><p id="f922" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><a class="ae ke" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ke" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ke" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae ke" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jf jg jh ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ke" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ke" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lm ln lo lp fq iv"><div class="bz el l di"><div class="nc mv l"/></div></figure></div></div>    
</body>
</html>