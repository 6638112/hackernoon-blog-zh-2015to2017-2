<html>
<head>
<title>Dispelling the magic!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">驱散魔法！</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/dispelling-the-magic-6dc0fdfe476c?source=collection_archive---------8-----------------------#2017-07-09">https://medium.com/hackernoon/dispelling-the-magic-6dc0fdfe476c?source=collection_archive---------8-----------------------#2017-07-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="37a1" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">蛋糕的层和块</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff jj"><img src="../Images/34d74eeb0f392edd7ff5c5b3cc9b28a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*gI9A8N_j67D5HzmlkXTn2g.png"/></div></figure><p id="8129" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">当你不知道一项技术背后的细节时，很容易将它视为魔术，但如果你敢看幕后——它可能没有你已经知道的那么复杂或陌生。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff kn"><img src="../Images/9daa2deba9f9fcd89485b71ba0520173.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/0*oNT053BHLA7c23bK.png"/></div></figure><p id="7d19" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">在这篇博文中，我将介绍一下开源构建流程编排工具<a class="ae ko" href="http://cakebuild.net" rel="noopener ugc nofollow" target="_blank">蛋糕</a>的一些组成部分。</p><p id="5cca" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">我将向您展示如何在不同的环境甚至语言中重用蛋糕，我将详细介绍一些部分，并浏览其他部分。</p><p id="bf47" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">如果有任何部分你想让我去更详细的请让我现在！我会在这篇博文的最后提供例子和资源的链接。</p><h1 id="75f3" class="kp kq hu bd kr ks kt ku kv kw kx ky kz ja la jb lb jd lc je ld jg le jh lf lg dt translated">“只是C#和。净”</h1><p id="8bb8" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">这是我经常说的一句话，因为Cake脚本提供了C#的一个超集——这意味着你可以用C#做任何事情。Cake DSL通过它的别名仅仅提供了一个快捷方式来使API和工具更容易使用，但是你总是可以选择喜欢“常规的”代码引用程序集，编写方法和类。</p><p id="e596" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">这方面的一个例子是使用JSON，在你的控制台或MVC应用程序中，你可能会使用JSON.Net来序列化/反序列化你的JSON。NET对象，并用Cake脚本做同样的事情，这与普通的C#没有太大区别</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="lm ln l"/></div></figure><p id="3ecd" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">基本上，唯一的区别是<code class="eh lo lp lq lr b">#addin</code>预处理器，它从NuGet获取并引用一个程序集，并且不需要在名称空间/类/方法中包装代码。</p><p id="639d" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">成为“公正的”C#和。NET意味着你将永远拥有安全网。NET、C#和大量可用于这些技术的资源。</p><h1 id="b7ce" class="kp kq hu bd kr ks kt ku kv kw kx ky kz ja la jb lb jd lc je ld jg le jh lf lg dt translated">蛋糕块</h1><p id="821b" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">蛋糕分两种口味，一种为全经典。NET，它也适用于Mono和。NET Core——微软新推出的跨平台框架/运行时。</p><p id="7d77" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">获得蛋糕工具最常见的方式是通过<code class="eh lo lp lq lr b">Cake</code>和<code class="eh lo lp lq lr b">Cake.CoreCLR</code> NuGet包(<em class="ls">蛋糕也可以通过Chocolatey、Homebrew、GitHub和官方docker容器获得</em>)。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff lt"><img src="../Images/7eb1cb936f9db237d2d57ac420d0df31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*XOMfw14AAyz06hMiV_q4zQ.png"/></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Cake / Cake.CoreCLR NuGet package</figcaption></figure><p id="0097" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">NuGet包包含在各自的运行时下执行所需的所有依赖项，但是“魔力”在于三个程序集和一个控制台应用程序</p><h2 id="6c1e" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">Cake.exe/Cake.dll——“工具”</h2><p id="5fde" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">举几个它处理的事情</p><ul class=""><li id="0a6f" class="mm mn hu jt b ju jv jx jy ka mo ke mp ki mq km mr ms mt mu dt translated">脚本的编译</li><li id="36b4" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">参数解析</li><li id="ba51" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">控制台日志记录</li><li id="cbe5" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">模块/组件的组成</li><li id="f823" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">基本上，它将所有东西粘合在一起，并提供“蛋糕体验”</li></ul><h2 id="82a9" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">蛋糕。核心——“心脏”</h2><p id="d2ec" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">提供诸如</p><ul class=""><li id="4aaf" class="mm mn hu jt b ju jv jx jy ka mo ke mp ki mq km mr ms mt mu dt translated">Cake工具/插件/模块使用的核心抽象/接口/属性<br/> ( <em class="ls">这是创建Cake插件/模块</em>时唯一需要引用的程序集)</li><li id="1fd3" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">DSL解析和将/codegen转换为罗斯林理解并能编译的C#</li><li id="c659" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">基础工具实现<em class="ls">(工具解析、执行、设置等。</em>)</li><li id="c6cf" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">蛋糕任务运行时(<em class="ls">任务运行器/依赖图/设置&amp;拆机等。</em>)</li></ul><h2 id="fe2f" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">蛋糕。普通—“实干家”</h2><p id="f3cb" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">这个程序集提供了近400个方便的别名/扩展方法，例如</p><ul class=""><li id="0adc" class="mm mn hu jt b ju jv jx jy ka mo ke mp ki mq km mr ms mt mu dt translated">工具(<em class="ls"> MSBuild，NuGet，.NET核心CLI，代码签名等。</em>)</li><li id="12b1" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">API(<em class="ls">压缩、项目文件解析、文本模板化、HTTP等。</em>)</li><li id="9aca" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">构建系统支持(<em class="ls"> AppVeyor，VSTS，詹金斯，TeamCity，MyGet等。)</em></li></ul><h2 id="9497" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">蛋糕。nu get——“取物者”</h2><p id="00c1" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">Cake模块，支持从NuGet获取依赖项，例如像<code class="eh lo lp lq lr b">#addin</code>、<code class="eh lo lp lq lr b">#tool</code>和<code class="eh lo lp lq lr b">#load</code>这样的预处理器指令。</p><h1 id="aec3" class="kp kq hu bd kr ks kt ku kv kw kx ky kz ja la jb lb jd lc je ld jg le jh lf lg dt translated">蛋糕作文—“就是C#和。净部分二”</h1><p id="2aed" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">组件<code class="eh lo lp lq lr b">Cake.Core</code>、<code class="eh lo lp lq lr b">Cake.Common</code>和<code class="eh lo lp lq lr b">Cake.NuGet</code>都可以在NuGet.org上找到，目标是两者。NET Full/Desktop和。网芯。</p><p id="c58a" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">这意味着你可以引用和利用几乎所有的投入到蛋糕中的部分/大部分工作和努力。NET应用程序、环境或平台——它只是标准的C#代码和程序集！</p><p id="a0ec" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">也就是说，蛋糕在很大程度上依赖于依赖注入，并且随着时间的推移已经被重构为定制模块——因此，对于项目的新手来说，如何将它们组合在一起可能会有点令人生畏。使用AutoFac之类的控制容器的反转来实现这一点的一个粗略的基本示例如下所示:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="lm ln l"/></div></figure><p id="1855" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">正如观察力敏锐的人可能从评论中看到的，有一些情况下，实现目前驻留在<code class="eh lo lp lq lr b">Cake.exe/Cake.dll</code> ( <em class="ls">这可能是我们在未来的重构中看到的东西</em>)，它们实现的接口存在于核心中，因此您可以实现并提供您自己的实现，或者根据您重用的蛋糕的哪些部分，您可能不需要它们(<em class="ls">对于单元测试，我们提供蛋糕。为工具测试提供虚假的上下文和文件系统、环境抽象等的测试。单元测试Cake插件/模块可能是另一篇博文的好主题——如果你认为是这样的话，请告诉我。</em></p><h1 id="0d2b" class="kp kq hu bd kr ks kt ku kv kw kx ky kz ja la jb lb jd lc je ld jg le jh lf lg dt translated">概念验证自定义脚本主机</h1><p id="61a7" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">因此，要为您自己的“构建脚本”实现创建您自己的定制主机，您目前需要实现几个接口:<code class="eh lo lp lq lr b">ICakeArguments</code>、<code class="eh lo lp lq lr b">ICakeConfiguration</code>、<code class="eh lo lp lq lr b">ICakeLog</code>、<code class="eh lo lp lq lr b">ICakeReportPrinter</code>和<code class="eh lo lp lq lr b">IScriptHost</code>，因为前面提到的这些实现目前驻留在<code class="eh lo lp lq lr b">Cake.exe/Cake.dll</code>中，但是所有其他的都可以在<code class="eh lo lp lq lr b">Cake.Core</code>中获得，以便在任何。NET项目。</p><p id="06bf" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">为了证明这一点，我创建了<em class="ls">“概念验证，绝不是官方的，不要在生产中使用，只是为了看看香肠是如何制作的，等等。”</em>汇编名为<code class="eh lo lp lq lr b">Cake.Bridge</code>，编译为两者。NET和。NET核心，这意味着它可以用在大多数地方。NET今天可以使用了(<em class="ls">二进制文件在NuGet上，源代码在GitHub上，我会在这篇文章的最后提供所有资源的链接</em>)。</p><p id="0deb" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated"><code class="eh lo lp lq lr b">Cake.Bridge</code>提供了一个静态的<code class="eh lo lp lq lr b">CakeBridge</code>类，该类提供了使用Cake任务运行器和<code class="eh lo lp lq lr b">ICakeContext</code> ( <em class="ls">是所有Cake别名/方法扩展的</em>)的简单访问，创建该类的目的是演示一种简单的方法来重用来自任何。NET语言，而不仅仅是Cake所支持的C#。</p><p id="5a26" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">你得不到的是DSL提供的蛋糕，没有插件和模块支持。</p><p id="b4e6" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">为了说明这一点，我编写了一些代码片段，介绍如何使用来自不同的。NET语言使用<code class="eh lo lp lq lr b">Cake.Bridge</code>汇编，<strong class="jt hv"> <em class="ls">免责声明</em> </strong>代码片段是概念的快速和粗略的证明，主要是证明它可以做到，显然需要做更多的改进，以使它们在习惯用法上更加正确。</p><p id="0d6a" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">通常已经存在更多本地的、突出的和广泛使用的构建系统。</p><h2 id="3b17" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">PowerShell</h2><p id="2e68" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">即使可能主要选择sysadmin语言——PowerShell仍然是一种基于. NET的语言，并且它能够利用。NET使它成为一种非常强大的脚本语言，因为该语言本身没有提供的任何东西通常都可以通过接触它所运行的框架来解决。这也意味着你可以用它来做蛋糕:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="lm ln l"/></div></figure><h2 id="3b0c" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">visualbasic语言</h2><p id="cec9" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">你不能谈论。NET语言，但没有提到Visual Basic，现在它也加入了。网络核心党也是它与时俱进。很明显，你可以用一些基本的东西来烤蛋糕(<em class="ls">据我所知，VB.NET没有交互控制台，所以我创建了一个简单的VB.NET核心控制台应用程序)</em></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="lm ln l"/></div></figure><h2 id="958d" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">F#</h2><p id="5647" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">F#是一种. NET语言，它使Cake完全有可能与F#一起使用。<br/>完全免责声明虽然，由于我对F#语言不是很精通，想要一个看起来有点像F#的东西，我请我的朋友<a class="ae ko" href="https://github.com/mrange" rel="noopener ugc nofollow" target="_blank">马腾·朗格</a>帮忙做了一个从C#到F#的快速移植，结果是:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="lm ln l"/></div></figure><h2 id="3553" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">蛋糕/ C#</h2><p id="28ef" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">作为参考，下面是移植到其他语言/运行时的灵感来源，其中涉及的引导较少，但除此之外，它们非常相似:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="lm ln l"/></div></figure><h1 id="4826" class="kp kq hu bd kr ks kt ku kv kw kx ky kz ja la jb lb jd lc je ld jg le jh lf lg dt translated">结论</h1><p id="d542" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">尽管蛋糕看起来有一些魔力，而且它是DSL，但它基本上只是。NET和C#拥有这些领域的技能，这些技能可以用于Cake脚本或以其他方式使用Cake程序集。如果你的需求与官方支持的方式有所不同，你仍然可以分一杯羹。</p><h1 id="d466" class="kp kq hu bd kr ks kt ku kv kw kx ky kz ja la jb lb jd lc je ld jg le jh lf lg dt translated">资源</h1><h2 id="d424" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">蛋糕。桥</h2><ul class=""><li id="d9ad" class="mm mn hu jt b ju lh jx li ka na ke nb ki nc km mr ms mt mu dt translated">GitHub:<a class="ae ko" href="https://github.com/devlead/Cake.Bridge" rel="noopener ugc nofollow" target="_blank">https://github.com/devlead/Cake.Bridge</a></li><li id="5418" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">https://www.nuget.org/packages/Cake.Bridge</li></ul><h2 id="0dbf" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">PowerShell概念验证</h2><ul class=""><li id="9969" class="mm mn hu jt b ju lh jx li ka na ke nb ki nc km mr ms mt mu dt translated"><a class="ae ko" href="https://github.com/devlead/PsPoC" rel="noopener ugc nofollow" target="_blank">https://github.com/devlead/PsPoC</a></li></ul><h2 id="d2b3" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">Visual Basic概念证明</h2><ul class=""><li id="0617" class="mm mn hu jt b ju lh jx li ka na ke nb ki nc km mr ms mt mu dt translated"><a class="ae ko" href="https://github.com/devlead/VBPoC" rel="noopener ugc nofollow" target="_blank">https://github.com/devlead/VBPoC</a></li></ul><h2 id="0aee" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">F#交互式脚本概念验证</h2><ul class=""><li id="4187" class="mm mn hu jt b ju lh jx li ka na ke nb ki nc km mr ms mt mu dt translated"><a class="ae ko" href="https://github.com/devlead/FsxPoC" rel="noopener ugc nofollow" target="_blank">https://github.com/devlead/FsxPoC</a></li></ul><h2 id="02e3" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">C#交互式概念验证</h2><ul class=""><li id="5181" class="mm mn hu jt b ju lh jx li ka na ke nb ki nc km mr ms mt mu dt translated"><a class="ae ko" href="https://github.com/devlead/CsxPoC" rel="noopener ugc nofollow" target="_blank">https://github.com/devlead/CsxPoC</a></li></ul><h2 id="95c2" class="ly kq hu bd kr lz ma mb kv mc md me kz ka mf mg lb ke mh mi ld ki mj mk lf ml dt translated">蛋糕</h2><ul class=""><li id="b309" class="mm mn hu jt b ju lh jx li ka na ke nb ki nc km mr ms mt mu dt translated">网址:<a class="ae ko" href="http://cakebuild.net" rel="noopener ugc nofollow" target="_blank">http://cakebuild.net</a></li><li id="837f" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">GitHub:<a class="ae ko" href="https://github.com/cake-build/cake" rel="noopener ugc nofollow" target="_blank">https://github.com/cake-build/cake</a></li><li id="bd91" class="mm mn hu jt b ju mv jx mw ka mx ke my ki mz km mr ms mt mu dt translated">https://www.nuget.org/profiles/cake-build</li></ul></div></div>    
</body>
</html>