<html>
<head>
<title>Compiling Rust to WebAssembly Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Rust编译到web汇编指南</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/compiling-rust-to-webassembly-guide-411066a69fde?source=collection_archive---------2-----------------------#2017-01-04">https://medium.com/hackernoon/compiling-rust-to-webassembly-guide-411066a69fde?source=collection_archive---------2-----------------------#2017-01-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b459" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以你对什么是<a class="ae jp" href="http://webassembly.org/" rel="noopener ugc nofollow" target="_blank"> WebAssembly </a>很感兴趣，并想尝试一下？自12月22日起，<a class="ae jp" href="https://blog.rust-lang.org/2016/12/22/Rust-1.14.html" rel="noopener ugc nofollow" target="_blank">有可能将铁锈编译成WASM </a>。如果你对<a class="ae jp" href="https://www.rust-lang.org/en-US/" rel="noopener ugc nofollow" target="_blank">锈语</a>一无所知，推荐你<a class="ae jp" href="https://brson.github.io/fireflowers/" rel="noopener ugc nofollow" target="_blank">了解一下</a>，太牛逼了！然而，对于本指南，你不需要知道如何用Rust编写程序。</p><p id="4977" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在VM中运行WASM之前，我已经被卡过很多次了。我花了几个小时找出每一步的错误，我想帮你节省时间。所以我们开始吧！</p><p id="0789" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先你应该在你的电脑上安装Rust language。最好的方法是使用一个名为rustup的工具。您可以像下面这样简单地安装它</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="5b07" class="jz ka hu jv b fv kb kc l kd ke">curl <a class="ae jp" href="https://sh.rustup.rs" rel="noopener ugc nofollow" target="_blank">https://sh.rustup.rs</a> -sSf | sh</span></pre><p id="10f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">可选地<a class="ae jp" href="https://www.rust-lang.org/en-US/install.html" rel="noopener ugc nofollow" target="_blank">配置你的</a> <code class="eh kf kg kh jv b"><a class="ae jp" href="https://www.rust-lang.org/en-US/install.html" rel="noopener ugc nofollow" target="_blank">PATH</a></code> <a class="ae jp" href="https://www.rust-lang.org/en-US/install.html" rel="noopener ugc nofollow" target="_blank">环境</a>变量(如果你打算学习和使用Rust，我推荐这么做)。</p><p id="93ac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">安装稳定的防锈目标</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="832e" class="jz ka hu jv b fv kb kc l kd ke">rustup install stable<br/>rustup default stable<br/>rustup target add wasm32-unknown-emscripten</span></pre><p id="da0a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">需要安装新的目标来将你的代码从你的平台交叉编译到WASM。</p><p id="ba96" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下载一个<a class="ae jp" href="http://kripken.github.io/emscripten-site/docs/getting_started/downloads.html#download-and-install" rel="noopener ugc nofollow" target="_blank">Emscripten SDK的便携版本</a>，然后运行下面的命令:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="7c02" class="jz ka hu jv b fv kb kc l kd ke">source .<strong class="jv hv">/</strong>emsdk_env.sh</span></pre><p id="97b1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在检查emcc版本</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="0596" class="jz ka hu jv b fv kb kc l kd ke">emcc -v</span></pre><p id="7494" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可能会安装Emscripten SDK(又名em SDK)1 . 35 . 0版，但您需要1.37.0(或更高版本)才能编译到WASM。不幸的是，(在发布本指南时)没有预编译的二进制文件，所以您应该从源代码中编译Emscriten SDK。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="08d5" class="jz ka hu jv b fv kb kc l kd ke">emsdk update<br/>emsdk install sdk-incoming-64bit<br/>emsdk activate sdk-incoming-64bit</span></pre><p id="49ae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这需要时间(对我来说大约需要2个小时)，所以请耐心等待。完成后，再次检查<code class="eh kf kg kh jv b">emcc -v</code>。它应该告诉你你现在已经(至少)安装了1.37.1。</p><p id="19fa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从现在开始，你已经准备好了！让我们试试吧！</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="b415" class="jz ka hu jv b fv kb kc l kd ke">rustc --target=wasm32-unknown-emscripten hello.rs -o hello.html</span></pre><p id="c53f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将生成一堆文件。我们只对其中的三个感兴趣:</p><ul class=""><li id="25d0" class="ki kj hu it b iu iv iy iz jc kk jg kl jk km jo kn ko kp kq dt translated">你好wasm</li><li id="b6af" class="ki kj hu it b iu kr iy ks jc kt jg ku jk kv jo kn ko kp kq dt translated">hello.js</li><li id="0dcd" class="ki kj hu it b iu kr iy ks jc kt jg ku jk kv jo kn ko kp kq dt translated">hello.html</li></ul><p id="2c65" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一个是<a class="ae jp" href="https://hackernoon.com/tagged/webassembly" rel="noopener ugc nofollow" target="_blank"> WebAssembly </a>二进制。我们不能独自运行wasm。WebAssembly没有任何I/O，所以我们需要将它封装到将加载、编译和运行wasm的<a class="ae jp" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>中。生成的HTML文件提供了一个我们可以运行代码的环境(带有画布和控制台)。</p><p id="df96" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要在浏览器中运行WebAssembly，您需要Chrome Canary</p><figure class="jq jr js jt fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff kw"><img src="../Images/8b3f97a69b185b9efc32520187f3907a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gEapboFHxXxGS4Af5X71nA.png"/></div></div><figcaption class="le lf fg fe ff lg lh bd b be z ek">Enabling WebAssembly in Chrome Canary</figcaption></figure><p id="0f65" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者Firefox Nightly</p><figure class="jq jr js jt fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff li"><img src="../Images/68dcef226382d084a04a5077a462ac2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r15o8D3JYqZHxQiZk3Q2Hw.png"/></div></div><figcaption class="le lf fg fe ff lg lh bd b be z ek">Enabling WebAssembly in Firefox Nightly</figcaption></figure><p id="213b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在运行<code class="eh kf kg kh jv b">python -m SimpleHTTPServer</code>(或任何其他web服务器)并在浏览器中打开<a class="ae jp" href="http://localhost:8000/hello.html" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/hello . html</a>(端口可能有所不同)。您将在Emscripten控制台中看到<code class="eh kf kg kh jv b">Hello, Emscripten!</code>。</p><figure class="jq jr js jt fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff lj"><img src="../Images/a9c888c49bd5e6130e550dd01468e345.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rt3SQUTFL1ri17OSNbZ9Tg.png"/></div></div><figcaption class="le lf fg fe ff lg lh bd b be z ek"><strong class="bd lk">Achievement unlocked</strong>: Rust &amp; WebAssembly hacker.</figcaption></figure><p id="2e77" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">恭喜你。您刚刚在浏览器中运行了wasm！看起来把Rust编译成wasm没那么难，但是相信我，很多人都放弃这么做了。请关注布兰登·艾希的推特评论。在那里你可以找到我对各种问题的解决方案。如果你一步一步地遵循这个指南，你不太可能有任何问题。</p><p id="8de4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不幸的是，Node.js并不完全支持WebAssembly。然而，你可以使用<a class="ae jp" href="https://github.com/WebAssembly/polyfill-prototype-1" rel="noopener ugc nofollow" target="_blank"> polyfill </a>或<code class="eh kf kg kh jv b"><a class="ae jp" href="https://github.com/kripken/emscripten/wiki/WebAssembly#binaryen-methods" rel="noopener ugc nofollow" target="_blank">interpret-wasm</a></code>binary en方法(我在使用rustc时运气不好)。</p><p id="62d4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">更新(2017 . 1 . 6)</strong>:你<strong class="it hv">可以</strong>在Node.js中运行wasm！克隆<a class="ae jp" href="https://github.com/v8/node/tree/vee-eight-lkgr" rel="noopener ugc nofollow" target="_blank">这个repo </a>，然后切换到<code class="eh kf kg kh jv b">vee-eight-lkgr</code>分支<a class="ae jp" href="https://github.com/nodejs/node/blob/master/BUILDING.md" rel="noopener ugc nofollow" target="_blank">从sources构建Node.js </a>。使用带有<code class="eh kf kg kh jv b">--expose-wasm</code>选项的构建节点运行<code class="eh kf kg kh jv b">hello.js</code>脚本。</p><figure class="jq jr js jt fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff ll"><img src="../Images/bfbaaddadd27c80f6331a92c8ad5b2e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tIcEJ57LStC519ojrnxMUA.png"/></div></div><figcaption class="le lf fg fe ff lg lh bd b be z ek">WebAssembly running in Node.js</figcaption></figure><p id="9cac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">呼呼！</p><p id="4c25" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">下一个目标</strong>:将Rust编译成<a class="ae jp" href="https://github.com/kripken/emscripten/wiki/WebAssembly-Standalone" rel="noopener ugc nofollow" target="_blank"> WebAssembly单机版</a>。这需要一些工作，因为我需要以某种方式将rustc连接到emcc，但我还不知道如何做。如果你能帮忙，请联系我！</p></div><div class="ab cl lm ln hc lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hn ho hp hq hr"><p id="16a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请让我知道，如果你有任何问题，按照这个指南。我会尽力帮助你，并更新指南来帮助其他人。</p><p id="775e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">非常感谢</p><ul class=""><li id="18c4" class="ki kj hu it b iu iv iy iz jc kk jg kl jk km jo kn ko kp kq dt translated"><a class="lt lu gr" href="https://medium.com/u/649eac8108d2?source=post_page-----411066a69fde--------------------------------" rel="noopener" target="_blank">阿龙·扎凯</a>(<a class="ae jp" href="https://twitter.com/kripken" rel="noopener ugc nofollow" target="_blank">@克里普肯</a>)感谢他对艾姆斯普滕和比纳瑞恩的帮助和辛勤工作。</li><li id="158d" class="ki kj hu it b iu kr iy ks jc kt jg ku jk kv jo kn ko kp kq dt translated">Sean t . Larkin(<a class="ae jp" href="https://twitter.com/thelarkinn" rel="noopener ugc nofollow" target="_blank">@ TheLarkinn</a>)感谢你审阅本指南，并一直表现出色。</li><li id="2c23" class="ki kj hu it b iu kr iy ks jc kt jg ku jk kv jo kn ko kp kq dt translated">Ali Ijaz Sheikh(<a class="ae jp" href="https://twitter.com/ofrobots" rel="noopener ugc nofollow" target="_blank">@ of robots</a>)讲述Node.js的<code class="eh kf kg kh jv b">vee-eight-lkgr</code>分支。</li></ul><h1 id="6dd1" class="lv ka hu bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr dt translated">关于我:</h1><p id="03a7" class="pw-post-body-paragraph ir is hu it b iu ms iw ix iy mt ja jb jc mu je jf jg mv ji jj jk mw jm jn jo hn dt translated">GitHub挖掘者。TypeScript用户。铁锈新手。我爱事物的传道者。公共演讲者(如果你会说俄语，你可能会喜欢我关于WebAssembly的<a class="ae jp" href="https://www.youtube.com/watch?v=eWF_1nMM5Yo" rel="noopener ugc nofollow" target="_blank">公共演讲</a>或<a class="ae jp" href="https://github.com/chicoxyzzy/public-talks" rel="noopener ugc nofollow" target="_blank">其他演讲</a>)。促成了React，Babel等。帮助维护<a class="ae jp" href="http://kangax.github.io/compat-table/esnext/" rel="noopener ugc nofollow" target="_blank">兼容表</a>和<a class="ae jp" href="https://github.com/babel/babel-preset-env" rel="noopener ugc nofollow" target="_blank"> babel-preset-env </a>。莫斯科<a class="ae jp" href="http://moscowjs.ru/" rel="noopener ugc nofollow" target="_blank">剧组的一员，</a><a class="ae jp" href="https://www.meetup.com/BeerJS-Moscow/" rel="noopener ugc nofollow" target="_blank">啤酒莫斯科</a>的协办方。一个杯子总是半满的人。</p><p id="596c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在推特上关注我<a class="ae jp" href="https://twitter.com/chicoxyzzy" rel="noopener ugc nofollow" target="_blank"> @chicoxyzzy </a></p><div class="jq jr js jt fq ab cb"><figure class="mx kx my mz na nb nc paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mx kx my mz na nb nc paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mx kx my mz na nb nc paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nd ne nf"><p id="f922" class="ir is ng it b iu iv iw ix iy iz ja jb nh jd je jf ni jh ji jj nj jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿美族家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is ng it b iu iv iw ix iy iz ja jb nh jd je jf ni jh ji jj nj jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jq jr js jt fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff nk"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="jq jr js jt fq kx"><div class="bz el l di"><div class="nl nm l"/></div></figure></div></div>    
</body>
</html>