<html>
<head>
<title>How to Build an Angular Image Feed</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建有角度的图像馈送</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-an-angular-js-image-feed-ea6193fa0b75?source=collection_archive---------4-----------------------#2017-07-06">https://medium.com/hackernoon/how-to-build-an-angular-js-image-feed-ea6193fa0b75?source=collection_archive---------4-----------------------#2017-07-06</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/3d721ccc9d7cd0cce5e93045a43681ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IJuontFcECRo0VeV.jpg"/></div></div></figure><p id="1e08" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本教程中，我将向你展示如何建立一个用户驱动的图片库，由Angular提供支持，托管在<a class="ae ka" href="https://cosmicjs.com" rel="noopener ugc nofollow" target="_blank"> Cosmic JS </a>应用服务器上。</p><h1 id="65f3" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">TL；速度三角形定位法(dead reckoning)</h1><p id="a9d9" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><a class="ae ka" href="https://cosmicjs.com/apps/angular-js-image-feed/demo" rel="noopener ugc nofollow" target="_blank">查看演示</a> <br/> <a class="ae ka" href="https://github.com/cosmicjs/angular-image-feed" rel="noopener ugc nofollow" target="_blank">在GitHub上查看完整源代码</a> <br/> <a class="ae ka" href="https://cosmicjs.com/apps/angular-js-image-feed" rel="noopener ugc nofollow" target="_blank">安装App并部署到Cosmic App服务器</a></p><h1 id="0a87" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">先决条件</h1><p id="cba5" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">您需要预先安装节点JS、npm和Angular cli。在开始之前，确保你已经有了它们。关于如何操作，请参考<a class="ae ka" href="https://angular.io/guide/quickstart" rel="noopener ugc nofollow" target="_blank">角度文件</a>。</p><h1 id="7d24" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">入门指南</h1><p id="c57e" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">首先，我们需要创建角度项目。我们将使用ng cli来完成。因此，一旦安装了所有的先决条件，就需要设置新的Angular项目:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="eb43" class="ln kc hu lj b fv lo lp l lq lr">ng new cosmic-angular</span></pre><p id="e1ba" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">设置好这个项目后，您就可以运行了</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="e739" class="ln kc hu lj b fv lo lp l lq lr">cd cosmic-angular<br/>ng serve --open</span></pre><p id="890d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在浏览器中玩你的应用程序</p><h1 id="cc15" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">使用现有的git repo做任何事情</h1><p id="87f0" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">首先，您必须确保安装了node &gt; 6.x，然后运行以下命令:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="6424" class="ln kc hu lj b fv lo lp l lq lr">npm install -g @angular/cli<br/>git clone https://github.com/cosmicjs/angular-image-feed<br/>cd cosmic-angular<br/>npm install<br/>ng serve --open</span></pre><p id="f811" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">文章创建时最新的ng cli版本是1.1.3。运行最后一个命令后，浏览器窗口将自动打开</p><h1 id="7797" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">建立宇宙JS库</h1><p id="464c" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">首先安装<a class="ae ka" href="https://cosmicjs.com/knowledge-base/javascript-cms" rel="noopener ugc nofollow" target="_blank"> Cosmic JS npm模块</a>用于Angular/JavaScript应用:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="83ec" class="ln kc hu lj b fv lo lp l lq lr">npm install cosmicjs --save</span></pre><p id="9875" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在你应该能够导入宇宙对象并执行宇宙JS API调用，如下所示:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="0313" class="ln kc hu lj b fv lo lp l lq lr">import Cosmic from 'cosmicjs';<br/>const bucket = { slug: 'your-bucket-slug' };</span><span id="dd16" class="ln kc hu lj b fv ls lp l lq lr">Cosmic.getObjects({ bucket }, (err, res) =&gt; {<br/>  console.log(res.objects);<br/>});</span></pre><h1 id="824f" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">用宇宙JS设置事物</h1><p id="7b03" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">创建存储桶并记住存储桶名称(在我们的例子中为<code class="eh lt lu lv lj b">‘cosmic-angular’</code>):</p><p id="49c9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后创建一个名为Photo的新对象类型，请记住对象类型slug (photos ')。</p><p id="95e0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们还需要一种存储图片本身的方法。请进入“图元字段模板”选项卡，用键<code class="eh lt lu lv lj b">'photo'</code>添加“图像/文件”类型的图元字段。这个元字段将存储图像。我们不需要更多的东西，所以只需设置名称和保存对象类型。保存后，您将被重定向到“新照片”页面。使用此页面创建一些照片并保存它们-我们将使用它们作为测试数据。</p><p id="6492" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您还需要创建Bucket write键。允许用户上传图片和创建照片对象是必要的。打开设置页面，单击API写访问密钥上的“生成新密钥”,然后复制生成的密钥并保存更改。</p><figure class="le lf lg lh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lw"><img src="../Images/ec47b38a3da484685afbab605498edf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3OURYIZkcHs604Lg.png"/></div></div></figure><h1 id="cb9a" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">角度环境</h1><p id="1e52" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">编辑<code class="eh lt lu lv lj b">src/environments/environment.ts</code>以匹配以下内容:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="389e" class="ln kc hu lj b fv lo lp l lq lr">export const environment = {<br/>  production: false,<br/>  write_key: 'YOURWRITEKEY',<br/>  bucket_name: 'YOURBUCKETNAME',<br/>  photos_type: 'photos'<br/>};</span></pre><h1 id="ec4c" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">角度的配置服务</h1><p id="7119" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们计划在不止一个角度分量中使用宇宙JS物体。在这种情况下，创建一个专用的配置服务并在一个地方存储所有与Cosmic JS相关的东西是有意义的，比如bucket名称、write key等。让我们用以下内容创建<code class="eh lt lu lv lj b">src/services/cosmic_config.ts</code>:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="8dd9" class="ln kc hu lj b fv lo lp l lq lr">import {Injectable} from '@angular/core';</span><span id="10be" class="ln kc hu lj b fv ls lp l lq lr">@Injectable()<br/>export class CosmicConfigService {<br/>    private write_key;<br/>    private bucket_name;<br/>    private photos_type;</span><span id="1db1" class="ln kc hu lj b fv ls lp l lq lr">    constructor() {<br/>        this.photos_type = environment.photos_type;<br/>        this.write_key = environment.write_key;<br/>        this.bucket_name = environment.bucket_name<br/>    }</span><span id="a2c2" class="ln kc hu lj b fv ls lp l lq lr">    public getReadCfg(): any {<br/>        return {<br/>            bucket: {<br/>                slug: this.bucket_name<br/>            }<br/>        };<br/>    }</span><span id="ef12" class="ln kc hu lj b fv ls lp l lq lr">    public getWriteCfg(): any {<br/>        return {<br/>            bucket: {<br/>                slug: this.bucket_name,<br/>                write_key: this.write_key<br/>            }<br/>        };<br/>    }</span><span id="60f3" class="ln kc hu lj b fv ls lp l lq lr">    public buildPhotoUploadObj(title, file): any {<br/>        return {<br/>            write_key: this.write_key,<br/>            type_slug: this.photos_type,<br/>            title: title,<br/>            metafields: [{<br/>                key: 'picture',<br/>                type: 'file',<br/>                value: file<br/>            }]<br/>        };<br/>    }</span><span id="589d" class="ln kc hu lj b fv ls lp l lq lr">    getPhotoSlug() {<br/>        return this.photos_type;<br/>    }<br/>}</span></pre><p id="a9c8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">该服务有几种方法:</p><ul class=""><li id="907d" class="lx ly hu je b jf jg jj jk jn lz jr ma jv mb jz mc md me mf dt translated"><code class="eh lt lu lv lj b">getReadCfg</code> -返回用于读取数据的配置对象</li><li id="dc9f" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated"><code class="eh lt lu lv lj b">getWriteCfg</code> -返回写数据的配置对象(指定write_key)</li><li id="6363" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated"><code class="eh lt lu lv lj b">buildPhotoUploadObj</code> -使用文件名和标题构建创建照片的对象</li><li id="80e0" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated"><code class="eh lt lu lv lj b">getPhotoSlug</code> -返回照片的对象类型slug</li></ul><p id="8375" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将从角度分量调用这些方法。</p><h1 id="049e" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">查看图库-角度部分</h1><p id="f589" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">创建包含以下内容的<code class="eh lt lu lv lj b">src/components/picture/picture.ts</code>文件:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="77c7" class="ln kc hu lj b fv lo lp l lq lr">import { Component, Input } from '@angular/core';</span><span id="6f77" class="ln kc hu lj b fv ls lp l lq lr">@Component({<br/>    selector: 'picture',<br/>    templateUrl: './picture.html'<br/>})<br/>export class Picture {<br/>    @Input() picture: any;</span><span id="a19a" class="ln kc hu lj b fv ls lp l lq lr">    constructor() {<br/>    }<br/>}</span></pre><p id="4f5e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后为图片组件创建一个模板:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="2ea3" class="ln kc hu lj b fv lo lp l lq lr">&lt;div class="ui card picture-item"&gt;<br/>  &lt;div class="image"&gt;<br/>    &lt;img class="ui fluid image" [src]="picture.metafield.picture.url" alt="{{ picture.title }}"&gt;<br/>  &lt;/div&gt;<br/>  &lt;div class="content"&gt;<br/>    &lt;div class="description"&gt;{{ picture.title }}&lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="2beb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将使用这个组件来显示一个画廊图片项目。</p><p id="39b2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在用以下内容创建<code class="eh lt lu lv lj b">src/components/picture_upload/picture_upload.ts</code>文件:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="98d8" class="ln kc hu lj b fv lo lp l lq lr">import { Component, Input, Output, EventEmitter } from '@angular/core';<br/>import Cosmic from 'cosmicjs';<br/>import { CosmicConfigService } from '../../services/cosmic_config';</span><span id="9a6f" class="ln kc hu lj b fv ls lp l lq lr">@Component({<br/>    selector: 'picture-upload',<br/>    templateUrl: './picture_upload.html'<br/>})<br/>export class PictureUpload {<br/>    private fl;<br/>    private title;<br/>    public uploading;<br/>    @Output() onUpload = new EventEmitter&lt;any&gt;();</span><span id="e2db" class="ln kc hu lj b fv ls lp l lq lr">    constructor(<br/>        private cosmicConfig: CosmicConfigService<br/>    ) {<br/>        this.uploading = false;<br/>        this.fl = null;<br/>        this.title = "";<br/>    }</span><span id="b161" class="ln kc hu lj b fv ls lp l lq lr">    onFileChange(ev) {<br/>        if (ev.target.files &amp;&amp; ev.target.files.length) {<br/>            this.fl = ev.target.files[0];<br/>        }<br/>    }</span><span id="3e7c" class="ln kc hu lj b fv ls lp l lq lr">    upload() {<br/>        this.uploading = true;<br/>        Cosmic.addMedia(this.cosmicConfig.getWriteCfg(), {<br/>            media: this.fl,<br/>            folder: this.fl.name<br/>        }, (error, response) =&gt; {<br/>            Cosmic.addObject(this.cosmicConfig.getWriteCfg(),<br/>                this.cosmicConfig.buildPhotoUploadObj(this.title, response.body.media.name),<br/>            (error, response) =&gt; {<br/>                this.title = '';<br/>                this.fl = null;<br/>                this.uploading = false;<br/>                this.onUpload.emit({});<br/>            });<br/>        });<br/>    }<br/>}</span></pre><p id="6a4b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后添加以下模板:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="ea22" class="ln kc hu lj b fv lo lp l lq lr">&lt;div class="picture-upload"&gt;<br/>    &lt;div class="ui form" [ngClass]="{ 'active dimmer': uploading }"&gt;<br/>        &lt;div class="ui grid" *ngIf="!uploading"&gt;<br/>            &lt;div class="five wide column"&gt;<br/>                &lt;div class="field"&gt;<br/>                    &lt;input type="text" placeholder="Title..." (input)="title = $event.target.value" [value]="title"/&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="six wide column"&gt;<br/>                &lt;div class="field"&gt;<br/>                    &lt;input type="file" (change)="onFileChange($event)"/&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="five wide column"&gt;<br/>                &lt;button class="ui primary button fluid" (click)="upload()"&gt;Upload photo&lt;/button&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>        &lt;div *ngIf="uploading" class="ui text loader"&gt;Upload is in progress&lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="09a4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">向app.module.ts添加<code class="eh lt lu lv lj b">Picture</code>和<code class="eh lt lu lv lj b">PictureUpload</code>组件，就像对AppComponent等其他组件一样。这将允许我们在应用程序中使用它。</p><h1 id="39e5" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">这里发生了什么？</h1><p id="f210" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们的<code class="eh lt lu lv lj b">Picture</code>组件不执行任何有趣的事情——它只是显示对象属性。然而<code class="eh lt lu lv lj b">PuctureUpload</code>组件做着更有趣的事情。它在Cosmic JS服务器上创建了一个记录，但是这个记录附有一个图像，所以这使得整个过程更加复杂:</p><ul class=""><li id="e5cc" class="lx ly hu je b jf jg jj jk jn lz jr ma jv mb jz mc md me mf dt translated">将图像上传到Cosmic JS服务器(使用<code class="eh lt lu lv lj b">addMedia</code>方法)</li><li id="a4ee" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">获取上传的图像名称</li><li id="28c4" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">创建新的Cosmic JS对象(使用<code class="eh lt lu lv lj b">addObject</code>方法),传递它获得的图像名称</li><li id="992a" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">激发一个事件来通知父组件上传完成</li></ul><h1 id="22d3" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">将一切串联在一起</h1><p id="f46f" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">现在我们需要修改我们的<code class="eh lt lu lv lj b">AppComponent</code>来使用这些新创建的组件。修改<code class="eh lt lu lv lj b">src/app/app.component.ts</code>如下所示:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="ff0d" class="ln kc hu lj b fv lo lp l lq lr">import { Component } from '@angular/core';<br/>import Cosmic from 'cosmicjs';<br/>import {CosmicConfigService} from '../services/cosmic_config';</span><span id="8534" class="ln kc hu lj b fv ls lp l lq lr">@Component({<br/>  selector: 'app-root',<br/>  templateUrl: './app.component.html',<br/>  styleUrls: ['./app.component.css']<br/>})<br/>export class AppComponent {<br/>  public items = [];<br/>  page = 0;<br/>  page_size = 2;<br/>  scrollEnabled = true;</span><span id="0425" class="ln kc hu lj b fv ls lp l lq lr">  constructor(<br/>    public cosmicCfg: CosmicConfigService<br/>  ) {<br/>    this.reload();<br/>  }</span><span id="2ecc" class="ln kc hu lj b fv ls lp l lq lr">  reload() {<br/>    this.items = [];<br/>    this.page = 0;<br/>    this.scrollEnabled = true;<br/>    let params = {<br/>      type_slug: this.cosmicCfg.getPhotoSlug(),<br/>      limit: this.page_size,<br/>      skip: 0<br/>    };<br/>    Cosmic.getObjectType(this.cosmicCfg.getReadCfg(), params, (err, res) =&gt; {<br/>      this.items = res.objects.all;<br/>    });<br/>  }</span><span id="2223" class="ln kc hu lj b fv ls lp l lq lr">  onUpload() {<br/>    this.reload();<br/>  }</span><span id="36a3" class="ln kc hu lj b fv ls lp l lq lr">  onScroll() {<br/>    if (!this.scrollEnabled) {<br/>      return;<br/>    }<br/>    this.page++;<br/>    let params = {<br/>      type_slug: this.cosmicCfg.getPhotoSlug(),<br/>      limit: this.page_size,<br/>      skip: this.page * this.page_size<br/>    };<br/>    Cosmic.getObjectType(this.cosmicCfg.getReadCfg(), params, (err, res) =&gt; {<br/>      if (res.objects &amp;&amp; res.objects.all) {<br/>        res.objects.all.forEach((itm) =&gt; {<br/>          this.items.push(itm);<br/>        });<br/>      }<br/>      else {<br/>        this.scrollEnabled = false;<br/>      }<br/>    });<br/>  }<br/>}</span></pre><p id="6649" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">并制作如下模板:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d261" class="ln kc hu lj b fv lo lp l lq lr">&lt;div infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="300" (scrolled)="onScroll()"&gt;<br/>    &lt;picture-upload (onUpload)="onUpload()"&gt;&lt;/picture-upload&gt;<br/>&lt;picture *ngFor="let item of items" [picture]="item"&gt;&lt;/picture&gt;<br/>&lt;/div&gt;</span></pre><p id="505c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们计划拥有无限滚动的图库(你已经可以在代码中看到它的指令)。这意味着我们必须安装正确的库:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="dc6e" class="ln kc hu lj b fv lo lp l lq lr">npm install --save ngx-infinite-scroll</span></pre><h1 id="88c5" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">这里发生了什么事？</h1><ul class=""><li id="99f9" class="lx ly hu je b jf kz jj la jn ml jr mm jv mn jz mc md me mf dt translated">在我们得到空响应之前，我们假设服务器上还有更多照片</li><li id="7501" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">我们正在获取2个整批的照片(<code class="eh lt lu lv lj b">page_size</code>属性)</li><li id="9fb5" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">我们只获取“照片”类型的对象(如果我们有更多的对象类型，这很有用)</li><li id="37ef" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">一旦我们得到空响应，我们就设置标志并停止获取更多照片</li><li id="8248" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">一旦我们从<code class="eh lt lu lv lj b">PhotoUpload</code>组件得到一个事件，我们就重置整个列表。</li></ul><h1 id="e3fc" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">部署到Cosmic JS服务器</h1><p id="425e" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">Cosmic JS对部署应用有一些要求:</p><ul class=""><li id="3d66" class="lx ly hu je b jf jg jj jk jn lz jr ma jv mb jz mc md me mf dt translated">它必须在公共git repo中，或者您需要<a class="ae ka" href="https://cosmicjs.com/integrations" rel="noopener ugc nofollow" target="_blank">连接您的GitHub帐户</a>进行私有repo部署</li><li id="4197" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated"><a class="ae ka" href="https://devcenter.heroku.com/" rel="noopener ugc nofollow" target="_blank">必须满足取决于您的平台的特定要求</a></li></ul><p id="35dc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在我们的例子中，我们实际上有HTML5应用程序，所以我们需要一些额外的软件。</p><h1 id="7dd1" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">准备配置</h1><p id="0014" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">在您的项目目录中创建一个<code class="eh lt lu lv lj b">prepare.js</code>文件:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="54fd" class="ln kc hu lj b fv lo lp l lq lr">var fs = require('fs');</span><span id="19ad" class="ln kc hu lj b fv ls lp l lq lr">var str = `<br/>    export const environment = {<br/>        production: true,<br/>        write_key: '${process.env.COSMIC_WRITE_KEY}',<br/>        bucket_name: '${process.env.COSMIC_BUCKET}',<br/>        photos_type: 'photos'<br/>    };<br/>`;<br/>fs.writeFile("./src/environments/environment.prod.ts", str, function(err) {<br/>    if(err) {<br/>        return console.log(err);<br/>    }<br/>    console.log("The file was saved!");<br/>});</span></pre><p id="0be0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此脚本将重写默认角度生产设置文件，以使用您的Cosmic JS存储桶写入密钥和存储桶名称。</p><h1 id="3143" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">修改package.json</h1><p id="f17c" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">Angular cli在<code class="eh lt lu lv lj b">package.json</code>上增加了一些包装作为<code class="eh lt lu lv lj b">devDependencies</code>。我们必须把他们转移到<code class="eh lt lu lv lj b">dependencies</code>才能让我们的剧本发挥作用:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="9ecf" class="ln kc hu lj b fv lo lp l lq lr">...<br/>"dependencies": {<br/>    "@angular/cli": "^1.1.3",<br/>    "@angular/compiler-cli": "^4.0.0",<br/>    ...<br/>},<br/>...</span></pre><h1 id="575f" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">准备软件</h1><p id="ab7f" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们还需要一些东西来服务我们的Angular应用程序。我们将使用快速框架:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="83e9" class="ln kc hu lj b fv lo lp l lq lr">npm install --save express</span></pre><p id="8de9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将以下内容添加到package.json中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="6b52" class="ln kc hu lj b fv lo lp l lq lr">{<br/>  ...<br/>  "scripts": {<br/>    ...<br/>    "start": "node app.js"<br/>  },<br/>  ...<br/>  "engines": {<br/>    "node": "6.9.4",<br/>    "npm": "4.2.0"<br/>  }<br/>  ...<br/>}</span></pre><p id="9793" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要点是在<code class="eh lt lu lv lj b">scripts</code>部分定义了<code class="eh lt lu lv lj b">start</code>命令(您可以安全地替换默认角度<code class="eh lt lu lv lj b">start</code>命令)。这是将运行来启动我们的应用程序的命令。所以现在我们只剩下一件事了——创建<code class="eh lt lu lv lj b">app.js</code>文件:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="f255" class="ln kc hu lj b fv lo lp l lq lr">const express = require('express')<br/>const app = express()</span><span id="0745" class="ln kc hu lj b fv ls lp l lq lr">app.use(express.static('./dist'));</span><span id="3038" class="ln kc hu lj b fv ls lp l lq lr">app.listen(process.env.PORT, function () {<br/>});</span></pre><p id="4258" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是一个简单的Express应用程序，它将<code class="eh lt lu lv lj b">dist</code>目录作为静态文件的目录。请注意-应用程序监听通过<code class="eh lt lu lv lj b">PORT</code>环境变量指定的端口，在Cosmic JS应用程序服务器上运行应用程序很重要。</p><h1 id="8da4" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">为生产构建Angular应用程序</h1><p id="d7f2" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们将使用<code class="eh lt lu lv lj b">app.json</code>来完成这项工作(dokku <code class="eh lt lu lv lj b">predeploy</code>部分):</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="bc88" class="ln kc hu lj b fv lo lp l lq lr">{<br/>    "scripts": {<br/>        "dokku": {<br/>            "predeploy": "node prepare.js &amp;&amp; ng build --aot --prod"<br/>        }<br/>    }<br/>}</span></pre><p id="20f9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这个脚本将在我们启动express应用程序来构建Angular应用程序用于生产之前执行。</p><h1 id="727f" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">运行它！</h1><p id="f91b" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">现在你可以在你的宇宙JS仪表板中进入“部署Web应用程序”页面。</p><figure class="le lf lg lh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mo"><img src="../Images/362932cf9c22e963a529e43840be8036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BTWwc-e3ewIAr9K6.png"/></div></div></figure><p id="5e41" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">只需输入您的回购网址，然后点击“部署到网站”，部署过程将开始，应用程序将在几分钟内准备就绪。</p><h1 id="7fa7" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="adbb" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">使用Cosmic JS应用服务器允许我们使用git repo将应用程序快速部署到主机，并且您不用担心服务器配置和软件安装——一切都将由Cosmic JS服务器完成。</p><blockquote class="mp mq mr"><p id="0272" class="jc jd ms je b jf jg jh ji jj jk jl jm mt jo jp jq mu js jt ju mv jw jx jy jz hn dt translated">本文原载于<a class="ae ka" href="https://cosmicjs.com/blog/how-to-build-an-angular-js-image-feed" rel="noopener ugc nofollow" target="_blank">宇宙JS博客</a>。</p></blockquote></div></div>    
</body>
</html>