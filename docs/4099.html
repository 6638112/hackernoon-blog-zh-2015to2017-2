<html>
<head>
<title>How to Build an AngularJS Events App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建AngularJS事件应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-an-angularjs-events-app-8b2d7e87052d?source=collection_archive---------7-----------------------#2017-05-12">https://medium.com/hackernoon/how-to-build-an-angularjs-events-app-8b2d7e87052d?source=collection_archive---------7-----------------------#2017-05-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/048645f5b36bc54bae4e99960eeca8af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QqvPUc8bDONPXGYntALzbw.png"/></div></div></figure><p id="8771" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本教程中，我将向你展示如何使用一点Node、Angular JS和<a class="ae ka" href="https://cosmicjs.com" rel="noopener ugc nofollow" target="_blank"> Cosmic JS </a>创建一个“事件”应用程序。为了理解如何使用Restful APIs，本教程将展示如何向Cosmic JS API发出简单的AJAX请求，以便检索、更新和删除我们的Cosmic JS Bucket中的数据。让我们开始吧。</p><h1 id="b189" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">TL；速度三角形定位法(dead reckoning)</h1><p id="1b20" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><a class="ae ka" href="https://github.com/cosmicjs/events-app" rel="noopener ugc nofollow" target="_blank">下载GitHub回购。</a> <br/> <a class="ae ka" href="https://cosmicjs.com/apps/events-app" rel="noopener ugc nofollow" target="_blank">查看试玩。</a></p><h1 id="8bfb" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">开始使用:</h1><p id="b227" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">首先，让我们创建一个新目录来构建我们的项目，并创建一个package.json文件。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="7f95" class="ln kc hu lj b fv lo lp l lq lr">mkdir events-app</span><span id="550d" class="ln kc hu lj b fv ls lp l lq lr">events-app$ touch package.json</span></pre><p id="7f7c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在您的package.json中，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="e1d7" class="ln kc hu lj b fv lo lp l lq lr">//events-app/package.json<br/>{<br/>  "name": "events-app",<br/>  "version": "1.0.0",<br/>  "main": "app-server.js",<br/>  "engines": {<br/>    "node": "4.1.2",<br/>    "npm": "3.5.2"<br/>  },<br/>  "description": "",<br/>  "dependencies": {<br/>    "bower": "^1.7.7",<br/>    "http-server": "^0.9.0",<br/>    "gulp": "^3.9.1",<br/>    "gulp-autoprefixer": "^3.1.0",<br/>    "gulp-concat": "^2.6.0",<br/>    "gulp-concat-css": "^2.2.0",<br/>    "gulp-minify-css": "^1.2.4",<br/>    "gulp-webserver": "^0.9.1",<br/>    "wiredep": "^3.0.0",<br/>    "express": "^4.13.3"<br/>  },<br/>  "scripts": {<br/>    "postinstall": "bower install",<br/>    "start": "npm run production",<br/>    "production": "node app-server.js"<br/>  },<br/>  "author": "",<br/>  "license": "ISC"<br/>}</span></pre><p id="d255" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">其次，我们来做一个bower.json文件。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="2523" class="ln kc hu lj b fv lo lp l lq lr">events-app$ touch bower.json</span></pre><p id="1dd9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在您的bower.json中，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="b4e3" class="ln kc hu lj b fv lo lp l lq lr">//events-app/bower.json<br/>{<br/>  "name": "events-app",<br/>  "description": "Events App",<br/>  "version": "0.0.0",<br/>  "homepage": "https://github.com/cosmicjs/events-app",<br/>  "license": "MIT",<br/>  "private": true,<br/>  "dependencies": {<br/>    "angular": "~1.4.x",<br/>    "angular-mocks": "~1.4.x",<br/>    "angular-bootstrap": "~1.1.x",<br/>    "angular-cookies": "~1.4.x",<br/>    "angular-route": "~1.4.x",<br/>    "angular-ui-router": "0.2.x",<br/>    "angular-resource": "1.4.x",<br/>    "angular-animate": "~1.4.x",<br/>    "ng-dialog": "0.6.1",<br/>    "bootstrap": "3.3.x",<br/>    "cr-acl": "",<br/>    "angular-chosen-localytics": "*",<br/>    "bootstrap-chosen": "*",<br/>    "ng-flow": "^2.7.4",<br/>    "angular-mask": "*",<br/>    "checklist-model": "0.9.0",<br/>    "angular-ui-notification": "^0.2.0",<br/>    "angular-ui-calendar": "^1.0.2",<br/>    "angular-ui-switch": "^0.1.1",<br/>    "ng-scrollbars": "^0.0.11",<br/>    "jquery.scrollbar": "*",<br/>    "angular-nvd3": "*",<br/>    "infinity-angular-chosen": "^0.2.0",<br/>    "angular-flash-alert": "^2.4.0",<br/>    "components-font-awesome": "^4.7.0",<br/>    "textAngular": "^1.5.16",<br/>    "angular-loading-bar": "^0.9.0"<br/>  },<br/>  "resolutions": {<br/>    "angular": "~1.4.x"<br/>  },<br/>  "devDependencies": {<br/>    "cr-acl": "^0.5.0"<br/>  }<br/>}</span></pre><p id="1e84" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">配置应用服务器:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="c422" class="ln kc hu lj b fv lo lp l lq lr">events-app$ touch app-server.js</span><span id="abf0" class="ln kc hu lj b fv ls lp l lq lr">//events-app/app-server.js<br/>var express = require('express')<br/>var app = express()<br/>app.set('port', process.env.PORT || 3000)<br/>app.use(express.static(__dirname))<br/>var http = require('http').Server(app)<br/>// Route<br/>app.get('/', (req, res) =&gt; {<br/>  res.sendFile(__dirname + '/index.html')<br/>})<br/>http.listen(app.get('port'), () =&gt; {<br/>  console.log('Wedding Site listening on ' + app.get('port'))<br/>})</span></pre><h1 id="b6bd" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">我们正在安装什么，为什么:</h1><ol class=""><li id="8f0a" class="lt lu hu je b jf kz jj la jn lv jr lw jv lx jz ly lz ma mb dt translated">我们将使用AngularJS框架构建一个单页面应用程序。</li><li id="4152" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们正在为创建多视图安装angular-ui-router。</li><li id="60ba" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们将使用gulp把所有的js和css文件构建成一个文件。</li></ol><h1 id="5f98" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">构建我们的应用程序:</h1><p id="0594" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">现在我们将构建我们的文件结构，这样我们就可以组织我们的angular模块和js文件。我们的events-app目录应该是这样的:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="b8bc" class="ln kc hu lj b fv lo lp l lq lr">events-app<br/>|----app<br/>|       |----auth<br/>|                 |----auth.ctrl.js<br/>|                 |----auth.service.js<br/>|       |----config<br/>|                 |----config.js<br/>|       |----event<br/>|                 |----add<br/>|                           |----event.add.ctrl.js<br/>|                           |----event.add.mdl.js<br/>|                 |----feed<br/>|                           |----event.feed.ctrl.js<br/>|                           |----event.feed.mdl.js<br/>|                 |----profile<br/>|                           |----event.profile.ctrl.js<br/>|                           |----event.profile.mdl.js<br/>|                 |----event.ctrl.js<br/>|                 |----event.mdl.js<br/>|                 |----event.service.js<br/>|       |----user<br/>|                 |----profile<br/>|                           |----user.profile.ctrl.js<br/>|                           |----user.profile.mdl.js<br/>|                 |----settings<br/>|                           |----user.settings.ctrl.js<br/>|                           |----user.settings.mdl.js<br/>|                 |----user.ctrl.js<br/>|                 |----user.mdl.js<br/>|                 |----user.service.js<br/>|       |----main.mdl.js<br/>|----dist<br/>|       |----css<br/>|       |----img<br/>|       |----js<br/>|----css<br/>|----views<br/>|----gulpfile.js<br/>|----app-server.js<br/>|----bower.json<br/>|----package.json</span></pre><p id="dbff" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们将建立我们的index.html。将以下代码复制并粘贴到您的index.html文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="9277" class="ln kc hu lj b fv lo lp l lq lr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en" ng-app="main"&gt;<br/>&lt;head&gt;<br/>    &lt;meta charset="utf-8"&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>    &lt;meta name="description" content=""&gt;<br/>    &lt;meta name="author" content=""&gt;</span><span id="5848" class="ln kc hu lj b fv ls lp l lq lr">    &lt;title&gt;Events App&lt;/title&gt;</span><span id="6f02" class="ln kc hu lj b fv ls lp l lq lr">    &lt;!-- bower:css --&gt;<br/>    &lt;!-- endbower --&gt;</span><span id="3d7b" class="ln kc hu lj b fv ls lp l lq lr">    &lt;!-- Bootstrap Core CSS --&gt;<br/>    &lt;link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"&gt;</span><span id="77bd" class="ln kc hu lj b fv ls lp l lq lr">    &lt;!-- Custom CSS --&gt;</span><span id="c95a" class="ln kc hu lj b fv ls lp l lq lr">    &lt;link href="dist/css/main.min.css" rel="stylesheet"&gt;<br/></span><span id="c071" class="ln kc hu lj b fv ls lp l lq lr">    <br/>    <br/>    &lt;!--[if lt IE 9]&gt;<br/>    &lt;script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"&gt;&lt;/script&gt;<br/>    &lt;script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"&gt;&lt;/script&gt;<br/>    &lt;![endif]--&gt;</span><span id="d158" class="ln kc hu lj b fv ls lp l lq lr">&lt;/head&gt;<br/>&lt;body&gt;</span><span id="233f" class="ln kc hu lj b fv ls lp l lq lr">&lt;div ui-view&gt;&lt;/div&gt;</span><span id="da15" class="ln kc hu lj b fv ls lp l lq lr">&lt;!-- bower:js --&gt;<br/>&lt;!-- endbower --&gt;</span><span id="c8b7" class="ln kc hu lj b fv ls lp l lq lr">&lt;script src="dist/js/main.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="045f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，我们将把我们的“根”视图作为目标，稍后放置我们的角度模块。位于我们的dist目录中的<a class="ae ka" href="https://cosmicjs.com/blog/main.js" rel="noopener ugc nofollow" target="_blank"> main.js </a>文件是我们的<a class="ae ka" href="https://cosmicjs.com/blog/gulpfile.js" rel="noopener ugc nofollow" target="_blank"> gulpfile.js </a>文件在捆绑了我们所有的angular模块之后将会吐出来的。现在，设置我们的<a class="ae ka" href="https://cosmicjs.com/blog/gulpfile.js" rel="noopener ugc nofollow" target="_blank"> gulpfile.js </a>文件来捆绑我们所有的js文件，并将这个捆绑文件导出到我们的dist目录。将以下代码复制到您的<a class="ae ka" href="https://cosmicjs.com/blog/gulpfile.js" rel="noopener ugc nofollow" target="_blank"> gulpfile.js </a>文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="9351" class="ln kc hu lj b fv lo lp l lq lr">//events-app/gulpfile.js<br/>'use strict';</span><span id="b43e" class="ln kc hu lj b fv ls lp l lq lr">var gulp = require('gulp'),<br/>    webserver = require('gulp-webserver'),<br/>    minifyCSS = require('gulp-minify-css'),<br/>    concatCss = require('gulp-concat-css'),<br/>    concat = require('gulp-concat'),<br/>    wiredep = require('wiredep').stream,<br/>    autoprefixer = require('gulp-autoprefixer');</span><span id="c6ec" class="ln kc hu lj b fv ls lp l lq lr">gulp.task('css', function () {<br/>  return gulp.src('css/**/*.css')<br/>    .pipe(minifyCSS())<br/>    .pipe(concat('main.min.css'))<br/>    .pipe(autoprefixer())<br/>    .pipe(gulp.dest('dist/css'));<br/>});</span><span id="17a0" class="ln kc hu lj b fv ls lp l lq lr">gulp.task('js', function() {<br/>  return gulp.src('app/**/**/*.js')<br/>    .pipe(concat('main.js'))<br/>    .pipe(gulp.dest('dist/js/'));<br/>});</span><span id="fc20" class="ln kc hu lj b fv ls lp l lq lr">gulp.task('default', function () {<br/>  gulp.watch('css/**/*.css', ['css']);<br/>  gulp.watch('app/**/**/*.js', ['js']);<br/>  gulp.watch('bower.json', ['bower']);<br/>});</span><span id="f6d6" class="ln kc hu lj b fv ls lp l lq lr">gulp.task('bower', function () {<br/>  gulp.src('index.html')<br/>    .pipe(wiredep({<br/>      directory: 'bower_components'<br/>    }))<br/>    .pipe(gulp.dest(''));<br/>});</span></pre><p id="a764" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">之后，我们可以创建config.js。将以下代码复制并粘贴到您的app/config/config.js文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="33fa" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="958c" class="ln kc hu lj b fv ls lp l lq lr">    var app = angular<br/>                .module('main');</span><span id="f28d" class="ln kc hu lj b fv ls lp l lq lr">    app.constant('BUCKET_SLUG', 'your-bucket-slug');<br/>    app.constant('URL', 'https://api.cosmicjs.com/v1/');<br/>    app.constant('MEDIA_URL', 'https://api.cosmicjs.com/v1/your-bucket-slug/media');<br/>    app.constant('READ_KEY', 'your-read-key');<br/>    app.constant('WRITE_KEY', 'your-write-key');<br/>    app.constant('DEFAULT_EVENT_IMAGE', 'url-image');</span><span id="7d7d" class="ln kc hu lj b fv ls lp l lq lr">})();</span></pre><p id="23f7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">之后，我们可以创建我们的主模块。将以下代码复制并粘贴到app/main.mdl.js文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="7c9e" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="a991" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main', [<br/>            'ui.router',<br/>            'ui.bootstrap',<br/>            'ngMask',<br/>            'ngCookies',<br/>            'ngRoute',<br/>            'ngDialog',<br/>            'cr.acl',<br/>            'ui-notification',<br/>            'ngFlash',<br/>            'textAngular',<br/>            'flow',<br/>            'angular-loading-bar',</span><span id="0848" class="ln kc hu lj b fv ls lp l lq lr">            'event',<br/>            'user'<br/>        ])<br/>        .config(config)<br/>        .run(run);</span><span id="de20" class="ln kc hu lj b fv ls lp l lq lr">    config.$inject = ['$stateProvider', '$urlRouterProvider', 'cfpLoadingBarProvider', 'WRITE_KEY'];<br/>    function config($stateProvider, $urlRouterProvider, cfpLoadingBarProvider, WRITE_KEY) {<br/>        cfpLoadingBarProvider.includeSpinner = false;</span><span id="e016" class="ln kc hu lj b fv ls lp l lq lr">        $urlRouterProvider.otherwise(function ($injector) {<br/>            var $state = $injector.get("$state");<br/>            var $location = $injector.get("$location");<br/>            var crAcl = $injector.get("crAcl");</span><span id="16b2" class="ln kc hu lj b fv ls lp l lq lr">            var state = "";</span><span id="60a8" class="ln kc hu lj b fv ls lp l lq lr">            switch (crAcl.getRole()) {<br/>                case 'ROLE_USER':<br/>                    state = 'main.event.feed';<br/>                    break;<br/>            }</span><span id="3b71" class="ln kc hu lj b fv ls lp l lq lr">            if (state) $state.go(state);<br/>            else $location.path('/login');<br/>        });</span><span id="c0ae" class="ln kc hu lj b fv ls lp l lq lr">        $stateProvider<br/>            .state('main', {<br/>                url: '/',<br/>                abstract: true,<br/>                templateUrl: '../views/main.html',<br/>                controller: 'UserCtrl as global',<br/>                data: {<br/>                    is_granted: ['ROLE_USER']<br/>                }<br/>            })<br/>            .state('auth', {<br/>                url: '/login',<br/>                templateUrl: '../views/auth/login.html',<br/>                controller: 'AuthCtrl as auth',<br/>                onEnter: ['AuthService', function(AuthService) {<br/>                    AuthService.clearCredentials();<br/>                }],<br/>                data: {<br/>                    is_granted: ['ROLE_GUEST']<br/>                }<br/>            });<br/>    }</span><span id="8f09" class="ln kc hu lj b fv ls lp l lq lr">    run.$inject = ['$rootScope', '$cookieStore', '$http', 'crAcl', 'AuthService'];<br/>    function run($rootScope, $cookieStore, $http, crAcl, AuthService) {</span><span id="415a" class="ln kc hu lj b fv ls lp l lq lr">        $rootScope.globals = $cookieStore.get('globals') || {};<br/>        $http.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';</span><span id="a37c" class="ln kc hu lj b fv ls lp l lq lr">        crAcl<br/>            .setInheritanceRoles({<br/>                'ROLE_SUPER_ADMIN': ['ROLE_SUPER_ADMIN', 'ROLE_GUEST'],<br/>                'ROLE_USER': ['ROLE_USER', 'ROLE_GUEST'],<br/>                'ROLE_GUEST': ['ROLE_GUEST']<br/>            });</span><span id="48d5" class="ln kc hu lj b fv ls lp l lq lr">        crAcl<br/>            .setRedirect('auth');</span><span id="7601" class="ln kc hu lj b fv ls lp l lq lr">        if ($rootScope.globals.currentUser) {</span><span id="3964" class="ln kc hu lj b fv ls lp l lq lr">            crAcl.setRole($rootScope.globals.currentUser.metadata.role);<br/>        }<br/>        else {<br/>            crAcl.setRole();<br/>        }</span><span id="9159" class="ln kc hu lj b fv ls lp l lq lr">    }</span><span id="18a9" class="ln kc hu lj b fv ls lp l lq lr">})();</span></pre><p id="8f12" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们将设置我们的授权控制器。将以下代码复制并粘贴到您的<a class="ae ka" href="https://cosmicjs.com/blog/auth.ctrl.js" rel="noopener ugc nofollow" target="_blank"> auth.ctrl.js </a>文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d861" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="bbfb" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .controller('AuthCtrl', AuthCtrl);</span><span id="54ef" class="ln kc hu lj b fv ls lp l lq lr">    function AuthCtrl(crAcl, $state, AuthService, Flash, $log) {<br/>        var vm = this;</span><span id="761d" class="ln kc hu lj b fv ls lp l lq lr">        vm.login = login;<br/>        vm.register = register;</span><span id="9004" class="ln kc hu lj b fv ls lp l lq lr">        vm.showRegisterForm = false;</span><span id="ef65" class="ln kc hu lj b fv ls lp l lq lr">        vm.loginForm = null;<br/>        vm.registerForm = null;</span><span id="1e8c" class="ln kc hu lj b fv ls lp l lq lr">        vm.credentials = {};<br/>        vm.user = {};</span><span id="928e" class="ln kc hu lj b fv ls lp l lq lr">        function login(credentials) {<br/>            function success(response) {<br/>                function success(response) {<br/>                    if (response.data.status !== 'empty') {<br/>                        var currentUser = response.data.objects[0];</span><span id="8115" class="ln kc hu lj b fv ls lp l lq lr">                        crAcl.setRole(currentUser.metadata.role);<br/>                        AuthService.setCredentials(currentUser);<br/>                        $state.go('main.event.feed');<br/>                    }<br/>                    else<br/>                        Flash.create('danger', 'Incorrect username or password');<br/>                }</span><span id="edf3" class="ln kc hu lj b fv ls lp l lq lr">                function failed(response) {<br/>                    $log.error(response);<br/>                }</span><span id="8431" class="ln kc hu lj b fv ls lp l lq lr">                if (response.data.status !== 'empty')<br/>                    AuthService<br/>                        .checkPassword(credentials)<br/>                        .then(success, failed);<br/>                else<br/>                    Flash.create('danger', 'Incorrect username or password');</span><span id="e4ba" class="ln kc hu lj b fv ls lp l lq lr">                $log.info(response);<br/>            }</span><span id="d533" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="f481" class="ln kc hu lj b fv ls lp l lq lr">            if (vm.loginForm.$valid)<br/>                AuthService<br/>                    .checkUsername(credentials)<br/>                    .then(success, failed);<br/>        }</span><span id="c55e" class="ln kc hu lj b fv ls lp l lq lr">        function register(credentials) {<br/>            function success(response) {<br/>                $log.info(response);</span><span id="7402" class="ln kc hu lj b fv ls lp l lq lr">                var currentUser = response.data.object.metafields;</span><span id="1c00" class="ln kc hu lj b fv ls lp l lq lr">                Flash.create('success', 'You have successfully signed up!');<br/>                vm.credentials = {<br/>                    username: currentUser[0].value,<br/>                    password: currentUser[3].value<br/>                };<br/>                vm.showRegisterForm = false;<br/>            }</span><span id="9aa5" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="6436" class="ln kc hu lj b fv ls lp l lq lr">            if (vm.registerForm.$valid)<br/>                AuthService<br/>                    .register(credentials)<br/>                    .then(success, failed);<br/>        }</span><span id="1379" class="ln kc hu lj b fv ls lp l lq lr">    }<br/>})();</span></pre><p id="b806" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们将在app/auth/auth.service.js中创建我们的身份验证服务:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="4280" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="b611" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .service('AuthService', function ($http,<br/>                                          $cookieStore,<br/>                                          $q,<br/>                                          $rootScope,<br/>                                          URL, BUCKET_SLUG, READ_KEY, WRITE_KEY) {<br/>            var authService = this;<br/>            $http.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';</span><span id="ac80" class="ln kc hu lj b fv ls lp l lq lr">            authService.checkUsername = function (credentials) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object-type/users/search', {<br/>                    params: {<br/>                        metafield_key: 'username',<br/>                        metafield_value_has: credentials.username,<br/>                        limit: 1,<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            authService.checkPassword = function (credentials) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object-type/users/search', {<br/>                    ignoreLoadingBar: true,<br/>                    params: {<br/>                        metafield_key: 'password',<br/>                        metafield_value: credentials.password,<br/>                        limit: 1,<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            authService.register = function (user) {</span><span id="55ad" class="ln kc hu lj b fv ls lp l lq lr">                return $http.post(URL + BUCKET_SLUG + '/add-object', {<br/>                    title: user.full_name,<br/>                    type_slug: 'users',<br/>                    slug: user.username,<br/>                    metafields: [<br/>                        {<br/>                            key: "username",<br/>                            type: "text",<br/>                            value: user.username<br/>                        },<br/>                        {<br/>                            key: "email",<br/>                            type: "text",<br/>                            value: user.email<br/>                        },<br/>                        {<br/>                            key: "full_name",<br/>                            type: "text",<br/>                            value: user.full_name<br/>                        },<br/>                        {<br/>                            key: "password",<br/>                            type: "text",<br/>                            value: user.password<br/>                        },<br/>                        {<br/>                            key: "image",<br/>                            type: "file",<br/>                            value: "3b2180f0-2c40-11e7-85ac-e98751218524-1493421969_male.png"<br/>                        },<br/>                        {<br/>                            key: "role",<br/>                            type: "radio-buttons",<br/>                            options: [<br/>                                {<br/>                                    value: "ROLE_USER"<br/>                                },<br/>                                {<br/>                                    value: "ROLE_SUPER_ADMIN"<br/>                                }<br/>                            ],<br/>                            value: "ROLE_USER"<br/>                        }<br/>                    ],</span><span id="1562" class="ln kc hu lj b fv ls lp l lq lr">                    write_key: WRITE_KEY<br/>                });<br/>            };<br/>            authService.setCredentials = function (user) {<br/>                $rootScope.globals = {<br/>                    currentUser: user<br/>                };</span><span id="c1b7" class="ln kc hu lj b fv ls lp l lq lr">                $cookieStore.put('globals', $rootScope.globals);<br/>            };<br/>            authService.clearCredentials = function () {<br/>                var deferred = $q.defer();<br/>                $cookieStore.remove('globals');</span><span id="556b" class="ln kc hu lj b fv ls lp l lq lr">                if (!$cookieStore.get('globals')) {<br/>                    $rootScope.globals = {};<br/>                    deferred.resolve('Credentials clear success');<br/>                } else {<br/>                    deferred.reject('Can\'t clear credentials');<br/>                }</span><span id="505c" class="ln kc hu lj b fv ls lp l lq lr">                return deferred.promise;<br/>            };<br/>        });<br/>})();</span></pre><h1 id="3046" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">这是怎么回事:</h1><ol class=""><li id="17fc" class="lt lu hu je b jf kz jj la jn lv jr lw jv lx jz ly lz ma mb dt translated">我们使用ui路由器来配置路由。</li><li id="4c9a" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们为对我们的Cosmic JS API的异步调用创建了Auth Service。</li><li id="2120" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们创建了身份验证控制器来检查凭证。</li></ol><p id="9cf1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为获取和更新用户创建用户服务，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="f4f5" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="d98c" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .service('UserService', function ($http,<br/>                                          $cookieStore,<br/>                                          $q,<br/>                                          $rootScope,<br/>                                          URL, BUCKET_SLUG, READ_KEY, WRITE_KEY) {<br/>            $http.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';</span><span id="c0bb" class="ln kc hu lj b fv ls lp l lq lr">            this.getCurrentUser = function (ignoreLoadingBar) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object/' + $rootScope.globals.currentUser.slug, {<br/>                    ignoreLoadingBar: ignoreLoadingBar,<br/>                    params: {<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.getUser = function (slug, ignoreLoadingBar) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object/' + slug, {<br/>                    ignoreLoadingBar: ignoreLoadingBar,<br/>                    params: {<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.updateUser = function (user) {<br/>                user.write_key = WRITE_KEY;</span><span id="dba5" class="ln kc hu lj b fv ls lp l lq lr">                return $http.put(URL + BUCKET_SLUG + '/edit-object', user, {<br/>                    ignoreLoadingBar: false<br/>                });<br/>            };</span><span id="9b1e" class="ln kc hu lj b fv ls lp l lq lr">        });<br/>})();</span></pre><p id="9ac2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建用户控制器以获取当前用户并注销，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="84e1" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="8637" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .controller('UserCtrl', UserCtrl);</span><span id="08f1" class="ln kc hu lj b fv ls lp l lq lr">    function UserCtrl($rootScope, $scope, $state, AuthService, Flash, $log) {<br/>        var vm = this;</span><span id="cfdd" class="ln kc hu lj b fv ls lp l lq lr">        vm.currentUser = $rootScope.globals.currentUser.metadata;</span><span id="43c4" class="ln kc hu lj b fv ls lp l lq lr">        vm.logout = logout;</span><span id="f407" class="ln kc hu lj b fv ls lp l lq lr">        function logout() {<br/>            function success(response) {<br/>                $state.go('auth');</span><span id="8e08" class="ln kc hu lj b fv ls lp l lq lr">                $log.info(response);<br/>            }</span><span id="c748" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="903c" class="ln kc hu lj b fv ls lp l lq lr">            AuthService<br/>                .clearCredentials()<br/>                .then(success, failed);<br/>        }</span><span id="0c21" class="ln kc hu lj b fv ls lp l lq lr">        $scope.state = $state;</span><span id="9886" class="ln kc hu lj b fv ls lp l lq lr">    }<br/>})();</span></pre><p id="78d3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们将创建创建用户模块:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="214b" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="b82a" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('user', [<br/>            'user.profile',<br/>            'user.settings'<br/>        ])<br/>        .config(config);</span><span id="e518" class="ln kc hu lj b fv ls lp l lq lr">    config.$inject = ['$stateProvider', '$urlRouterProvider'];<br/>    function config($stateProvider, $urlRouterProvider) {</span><span id="ef8c" class="ln kc hu lj b fv ls lp l lq lr">        $stateProvider<br/>            .state('main.user', {<br/>                url: 'user',<br/>                abstract: true,<br/>                data: {<br/>                    is_granted: ['ROLE_USER']<br/>                }<br/>            });<br/>    }<br/>})();</span></pre><h1 id="eacb" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">这是怎么回事:</h1><ol class=""><li id="eca7" class="lt lu hu je b jf kz jj la jn lv jr lw jv lx jz ly lz ma mb dt translated">我们为对我们的Cosmic JS API的异步调用创建了用户服务。</li><li id="f26a" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们为获取当前用户和注销创建了用户控制器。</li></ol><p id="8cd6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们将创建事件服务，从Cosmic JS API获取、更新、添加和删除事件:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="c241" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="0813" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .service('EventService', function ($http,<br/>                                          $cookieStore,<br/>                                          $q,<br/>                                          $rootScope,<br/>                                          URL, BUCKET_SLUG, READ_KEY, WRITE_KEY, MEDIA_URL) {</span><span id="4ac2" class="ln kc hu lj b fv ls lp l lq lr">            $http.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';</span><span id="0922" class="ln kc hu lj b fv ls lp l lq lr">            this.getEvents = function () {<br/>                return $http.get(URL + BUCKET_SLUG + '/object-type/events', {<br/>                    params: {<br/>                        limit: 100,<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.getEventsByUsername = function (username, ignoreLoadingBar) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object-type/events/search',<br/>                    {<br/>                        ignoreLoadingBar: ignoreLoadingBar,<br/>                        params: {<br/>                            metafield_key: 'user',<br/>                            metafield_object_slug: username,<br/>                            limit: 10,<br/>                            read_key: READ_KEY<br/>                        }<br/>                    }<br/>                );<br/>            };<br/>            this.getEventById = function (slug) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object/' + slug, {<br/>                    params: {<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.updateEvent = function (event) {<br/>                event.write_key = WRITE_KEY;</span><span id="ec41" class="ln kc hu lj b fv ls lp l lq lr">                return $http.put(URL + BUCKET_SLUG + '/edit-object', event);<br/>            };<br/>            this.removeEvent = function (slug) {<br/>                return $http.delete(URL + BUCKET_SLUG + '/' + slug, {<br/>                    ignoreLoadingBar: true,<br/>                    headers:{<br/>                        'Content-Type': 'application/json'<br/>                    },<br/>                    data: {<br/>                        write_key: WRITE_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.createEvent = function (event) {<br/>                event.write_key = WRITE_KEY;</span><span id="1ae2" class="ln kc hu lj b fv ls lp l lq lr">                var beginDate = new Date(event.metafields[1].value);<br/>                var endDate = new Date(event.metafields[2].value);</span><span id="ee35" class="ln kc hu lj b fv ls lp l lq lr">                event.metafields[1].value = beginDate.getFullYear() + '-' + (beginDate.getMonth() + 1) + '-' + beginDate.getDate();<br/>                event.metafields[2].value = endDate.getFullYear() + '-' + (beginDate.getMonth() + 1) + '-' + endDate.getDate();</span><span id="2295" class="ln kc hu lj b fv ls lp l lq lr">                event.slug = event.title;<br/>                event.type_slug = 'events';</span><span id="4371" class="ln kc hu lj b fv ls lp l lq lr">                event.metafields[4] = {<br/>                    key: "user",<br/>                    type: "object",<br/>                    object_type: "users",<br/>                    value: $rootScope.globals.currentUser._id<br/>                };<br/>                return $http.post(URL + BUCKET_SLUG + '/add-object', event);<br/>            };<br/>            this.upload = function (file) {<br/>                var fd = new FormData();<br/>                fd.append('media', file);<br/>                fd.append('write_key', WRITE_KEY);</span><span id="64f3" class="ln kc hu lj b fv ls lp l lq lr">                var defer = $q.defer();</span><span id="427f" class="ln kc hu lj b fv ls lp l lq lr">                var xhttp = new XMLHttpRequest();</span><span id="83ca" class="ln kc hu lj b fv ls lp l lq lr">                xhttp.upload.addEventListener("progress",function (e) {<br/>                    defer.notify(parseInt(e.loaded * 100 / e.total));<br/>                });<br/>                xhttp.upload.addEventListener("error",function (e) {<br/>                    defer.reject(e);<br/>                });</span><span id="faf5" class="ln kc hu lj b fv ls lp l lq lr">                xhttp.onreadystatechange = function() {<br/>                    if (xhttp.readyState === 4) {<br/>                        defer.resolve(JSON.parse(xhttp.response)); //Outputs a DOMString by default<br/>                    }<br/>                };</span><span id="a974" class="ln kc hu lj b fv ls lp l lq lr">                xhttp.open("post", MEDIA_URL, true);</span><span id="3580" class="ln kc hu lj b fv ls lp l lq lr">                xhttp.send(fd);</span><span id="80d8" class="ln kc hu lj b fv ls lp l lq lr">                return defer.promise;<br/>            }<br/>        });<br/>})();</span></pre><p id="aba9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的事件控制器将获取所有事件并移除事件:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="1b3e" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="4fd5" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .controller('EventCtrl', EventCtrl);</span><span id="92d8" class="ln kc hu lj b fv ls lp l lq lr">    function EventCtrl(EventService, Notification, $log, $rootScope, DEFAULT_EVENT_IMAGE) {<br/>        var vm = this;</span><span id="ef2c" class="ln kc hu lj b fv ls lp l lq lr">        vm.getEvents = getEvents;<br/>        vm.removeEvent = removeEvent;<br/>        vm.DEFAULT_EVENT_IMAGE = DEFAULT_EVENT_IMAGE;</span><span id="8c9c" class="ln kc hu lj b fv ls lp l lq lr">        function getEvents(username) {<br/>            function success(response) {<br/>                $log.info(response);</span><span id="e1a9" class="ln kc hu lj b fv ls lp l lq lr">                vm.events = response.data.objects;<br/>            }</span><span id="b1cf" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }<br/>            console.log(username);</span><span id="052a" class="ln kc hu lj b fv ls lp l lq lr">            EventService<br/>                .getEventsByUsername(username)<br/>                .then(success, failed);<br/>        }</span><span id="46c1" class="ln kc hu lj b fv ls lp l lq lr">        function removeEvent(slug) {<br/>            function success(response) {<br/>                $log.info(response);</span><span id="6fa7" class="ln kc hu lj b fv ls lp l lq lr">                getEvents($rootScope.globals.currentUser.metadata.username);</span><span id="3614" class="ln kc hu lj b fv ls lp l lq lr">                Notification.success('Deleted');<br/>            }</span><span id="361a" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                Notification.error(response.data.message);</span><span id="6af7" class="ln kc hu lj b fv ls lp l lq lr">                $log.error(response);<br/>            }</span><span id="0ff3" class="ln kc hu lj b fv ls lp l lq lr">            EventService<br/>                .removeEvent(slug)<br/>                .then(success, failed);<br/>        }<br/>    }<br/>})();</span></pre><p id="80e5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的事件模块将呈现我们的事件视图:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="9a10" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="8aea" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('event', [<br/>            'event.profile',<br/>            'event.feed',<br/>            'event.add'<br/>        ])<br/>        .config(config);</span><span id="e5a0" class="ln kc hu lj b fv ls lp l lq lr">    config.$inject = ['$stateProvider', '$urlRouterProvider'];<br/>    function config($stateProvider, $urlRouterProvider) {</span><span id="c694" class="ln kc hu lj b fv ls lp l lq lr">        $stateProvider<br/>            .state('main.event', {<br/>                url: 'events',<br/>                views: {<br/>                    '': {<br/>                        templateUrl: '../views/event/events.html',<br/>                        controller: 'EventCtrl as vm'<br/>                    }<br/>                },<br/>                data: {<br/>                    is_granted: ['ROLE_USER']<br/>                }<br/>            });<br/>    }</span><span id="f101" class="ln kc hu lj b fv ls lp l lq lr">})();</span></pre><h1 id="0c48" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">这是怎么回事:</h1><ol class=""><li id="eabf" class="lt lu hu je b jf kz jj la jn lv jr lw jv lx jz ly lz ma mb dt translated">我们为对我们的Cosmic JS API的异步调用创建了事件服务。我们可以创建、更新、删除和获取事件。</li><li id="e6a6" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们创建了事件控制器来获取所有事件和移除事件。</li><li id="7820" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们创建了一个事件模块来呈现我们的视图。</li></ol><p id="bd38" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在让我们为添加事件创建事件添加控制器:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="bc84" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="15ff" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .controller('EventAddCtrl', EventAddCtrl);</span><span id="2bb1" class="ln kc hu lj b fv ls lp l lq lr">    function EventAddCtrl(EventService, Notification, $state, $log, $scope, MEDIA_URL, DEFAULT_EVENT_IMAGE, $timeout) {<br/>        var vm = this;</span><span id="fa89" class="ln kc hu lj b fv ls lp l lq lr">        vm.createEvent = createEvent;<br/>        vm.cancelUpload = cancelUpload;<br/>        vm.upload = upload;</span><span id="9507" class="ln kc hu lj b fv ls lp l lq lr">        vm.dateBeginPicker = false;<br/>        vm.dateEndPicker = false;<br/>        vm.contentEditor = true;<br/>        vm.uploadProgress = 0;</span><span id="7553" class="ln kc hu lj b fv ls lp l lq lr">        vm.event = {<br/>            title: null,<br/>            slug: null,<br/>            content: null,<br/>            metafields: [<br/>                {<br/>                    key: "image",<br/>                    type: "file",<br/>                    value: null<br/>                },<br/>                {<br/>                    key: "date_begin",<br/>                    type: "date",<br/>                    value: null<br/>                },<br/>                {<br/>                    key: "date_end",<br/>                    type: "date",<br/>                    value: null<br/>                },<br/>                {<br/>                    key: "type",<br/>                    type: "select-dropdown",<br/>                    options: [<br/>                        {<br/>                            key: "social",<br/>                            value: "Social"<br/>                        },<br/>                        {<br/>                            key: "fun",<br/>                            value: "Fun"<br/>                        }<br/>                    ],<br/>                    value: "Social"<br/>                }<br/>            ]<br/>        };</span><span id="2407" class="ln kc hu lj b fv ls lp l lq lr">        $timeout(function() {<br/>            vm.event.metafields[1].value = new Date();<br/>            vm.event.metafields[2].value = new Date();<br/>        }, 100);</span><span id="d14a" class="ln kc hu lj b fv ls lp l lq lr">        vm.flow = {};<br/>        vm.background = {<br/>            'background-image': 'url(' + DEFAULT_EVENT_IMAGE + ')'<br/>        };</span><span id="f879" class="ln kc hu lj b fv ls lp l lq lr">        vm.flowConfig = {<br/>            target: MEDIA_URL,<br/>            singleFile: true<br/>        };</span><span id="5e5f" class="ln kc hu lj b fv ls lp l lq lr">        function createEvent() {<br/>            if (vm.flow.files[0])<br/>                upload();<br/>            else<br/>                _createEvent(vm.event);<br/>        }</span><span id="6843" class="ln kc hu lj b fv ls lp l lq lr">        function _createEvent(event) {<br/>            function success(response) {<br/>                $log.info(response);</span><span id="7bc5" class="ln kc hu lj b fv ls lp l lq lr">                Notification.success(<br/>                    {<br/>                        message: 'Created',<br/>                        delay: 800,<br/>                        replaceMessage: true<br/>                    }<br/>                );</span><span id="0088" class="ln kc hu lj b fv ls lp l lq lr">                $state.go('main.event');<br/>            }</span><span id="ed8e" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                Notification.error(<br/>                    {<br/>                        message: response.data.error,<br/>                        delay: 4000,<br/>                        replaceMessage: true<br/>                    }<br/>                );</span><span id="96b0" class="ln kc hu lj b fv ls lp l lq lr">                $log.error(response);<br/>            }</span><span id="e9d5" class="ln kc hu lj b fv ls lp l lq lr">            EventService<br/>                .createEvent(event)<br/>                .then(success, failed);<br/>        }</span><span id="264b" class="ln kc hu lj b fv ls lp l lq lr">        function cancelUpload() {<br/>            vm.flow.cancel();<br/>            vm.background = {<br/>                'background-image': 'url(' + DEFAULT_EVENT_IMAGE.url + ')'<br/>            };<br/>        }</span><span id="f38c" class="ln kc hu lj b fv ls lp l lq lr">        $scope.$watch('vm.flow.files[0].file.name', function () {<br/>            if (!vm.flow.files[0]) {<br/>                return ;<br/>            }<br/>            var fileReader = new FileReader();<br/>            fileReader.readAsDataURL(vm.flow.files[0].file);<br/>            fileReader.onload = function (event) {<br/>                $scope.$apply(function () {<br/>                    vm.background = {<br/>                        'background-image': 'url(' + event.target.result + ')'<br/>                    };<br/>                });<br/>            };<br/>        });</span><span id="bac3" class="ln kc hu lj b fv ls lp l lq lr">        function upload() {<br/>            EventService<br/>                .upload(vm.flow.files[0].file)<br/>                .then(function(response){</span><span id="46b8" class="ln kc hu lj b fv ls lp l lq lr">                    vm.event.metafields[0].value = response.media.name;</span><span id="9d26" class="ln kc hu lj b fv ls lp l lq lr">                    createEvent(vm.event);</span><span id="e290" class="ln kc hu lj b fv ls lp l lq lr">                    vm.flow.cancel();<br/>                    vm.uploadProgress = 0;</span><span id="4f8c" class="ln kc hu lj b fv ls lp l lq lr">                }, function(){<br/>                    console.log('failed :(');<br/>                }, function(progress){<br/>                    vm.uploadProgress = progress;<br/>                });</span><span id="d1a0" class="ln kc hu lj b fv ls lp l lq lr">        }</span><span id="74da" class="ln kc hu lj b fv ls lp l lq lr">    }<br/>})();</span></pre><p id="e75f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们创建事件模块:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="2717" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="396f" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('event.add', [])<br/>        .config(config);</span><span id="1acb" class="ln kc hu lj b fv ls lp l lq lr">    config.$inject = ['$stateProvider', '$urlRouterProvider'];<br/>    function config($stateProvider, $urlRouterProvider) {</span><span id="7b8d" class="ln kc hu lj b fv ls lp l lq lr">        $stateProvider<br/>            .state('main.event.add', {<br/>                url: '/add',<br/>                views: {<br/>                    '@main': {<br/>                        templateUrl: '../views/event/event.profile.html',<br/>                        controller: 'EventAddCtrl as vm'<br/>                    }<br/>                },<br/>                data: {<br/>                    is_granted: ['ROLE_USER']<br/>                }<br/>            });<br/>    }</span><span id="5d71" class="ln kc hu lj b fv ls lp l lq lr">})();</span></pre><h1 id="7b5d" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">这是怎么回事:</h1><ol class=""><li id="fac4" class="lt lu hu je b jf kz jj la jn lv jr lw jv lx jz ly lz ma mb dt translated">我们可以添加事件。</li><li id="1c33" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们可以上传图像。</li></ol><h1 id="dc8b" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论:</h1><p id="dea0" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们能够通过Cosmic JS API创建一个非常复杂的应用程序来管理用户、会话、添加/编辑事件。我希望你和我一样喜欢这个教程，如果你有任何问题<a class="ae ka" href="https://twitter.com/cosmic_js" rel="noopener ugc nofollow" target="_blank">在Twitter上联系我们</a>和<a class="ae ka" href="https://cosmicjs.com/community" rel="noopener ugc nofollow" target="_blank">加入我们的Slack社区</a>。</p><blockquote class="mh mi mj"><p id="f03e" class="jc jd mk je b jf jg jh ji jj jk jl jm ml jo jp jq mm js jt ju mn jw jx jy jz hn dt translated">这篇文章最初出现在<a class="ae ka" href="https://cosmicjs.com/blog/how-to-build-an-angularjs-events-app" rel="noopener ugc nofollow" target="_blank">的宇宙JS博客</a>上。</p></blockquote><div class="le lf lg lh fq ab cb"><figure class="mo iv mp mq mr ms mt paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mo iv mp mq mr ms mt paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mo iv mp mq mr ms mt paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mh mi mj"><p id="f922" class="jc jd mk je b jf jg jh ji jj jk jl jm ml jo jp jq mm js jt ju mn jw jx jy jz hn dt translated"><a class="ae ka" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ka" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ka" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ka" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd mk je b jf jg jh ji jj jk jl jm ml jo jp jq mm js jt ju mn jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ka" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ka" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="le lf lg lh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mu"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>