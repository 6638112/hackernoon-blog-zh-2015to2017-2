<html>
<head>
<title>An Intro to Vim Macros</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vim宏简介</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/an-intro-to-vim-macros-f690d8c3c3fd?source=collection_archive---------2-----------------------#2016-10-12">https://medium.com/hackernoon/an-intro-to-vim-macros-f690d8c3c3fd?source=collection_archive---------2-----------------------#2016-10-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="f78e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当试图解释为什么<a class="ae jp" href="https://hackernoon.com/tagged/vim" rel="noopener ugc nofollow" target="_blank"> Vim </a>如此神奇时，人们经常会说“你不必使用鼠标”“模态编辑”“命令是<a class="ae jp" href="https://hackernoon.com/tagged/composable" rel="noopener ugc nofollow" target="_blank">可组合的</a>”之类的话。这些都是让编码更快更容易的好东西。它们也<em class="jq">碰巧</em>导致了Vim最强大且不被公开的特性之一:宏。</p><h1 id="bd31" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">什么是宏？</h1><p id="465e" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">宏是“编程编辑”的一种形式，或者使用代码来更改文本。宏对于粘贴就像普通模式对于插入模式一样。粘贴将文本插入到代码中。宏运行文本就好像它是一系列命令。除此之外，它们是相同的，甚至使用相同的寄存器来存储文本/击键。如果你写一个宏来注册一个，你可以输入" ap来粘贴你的宏的原始文本到缓冲区。如果你把文本“ZZ”拉进寄存器a，@a会保存并退出你的窗口。这种同构有两个结果:</p><ul class=""><li id="4b3c" class="ku kv hu it b iu iv iy iz jc kw jg kx jk ky jo kz la lb lc dt translated">如果你想编辑一个宏，你可以粘贴它，修改文本，并复制回你的寄存器，这是非常方便的。</li><li id="e644" class="ku kv hu it b iu ld iy le jc lf jg lg jk lh jo kz la lb lc dt translated">运行宏与手动输入按键完全一样，这意味着宏可以访问Vim中的所有内容。宏可以拆分窗口、创建新文件、运行命令，甚至更改设置。唯一的限制是一个宏不能直接记录另一个宏。</li></ul><p id="92db" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">宏概括命令:命令自动化简单的任务，而宏自动化复杂的任务。</p><h2 id="6100" class="li js hu bd jt lj lk ll jx lm ln lo kb jc lp lq kf jg lr ls kj jk lt lu kn lv dt translated">例子</h2><p id="4c64" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">假设我们有一个包含以下HTML的rails项目:</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="757b" class="li js hu mb b fv mf mg l mh mi">&lt;ul id="soup_options"&gt;<br/>   &lt;li id="apple"&gt;Apple Soup&lt;/li&gt;<br/>   &lt;li id="cotton"&gt;Cotton Soup&lt;/li&gt;<br/>   &lt;li id="bees"&gt;Bee Soup&lt;/li&gt; <br/>            ...<br/>&lt;/ul&gt;</span></pre><p id="aef3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为重构的一部分，您需要将列表项中的文本转换为I18n。根据设置，一种方法是使用以下宏:</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="e10f" class="li js hu mb b fv mf mg l mh mi">^"ayi""bcit&lt;%=t 'soup_options.&lt;c-R&gt;a'%&gt;&lt;c-C&gt;&lt;c-W&gt;wo&lt;c-R&gt;a: &lt;c-R&gt;b&lt;c-C&gt;&lt;c-W&gt;wj</span></pre><p id="6e25" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其中<c- class="jq">XT18】为ctrl+ <em class="jq"> X. </em></c-></p><figure class="lw lx ly lz fq mk fe ff paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="fe ff mj"><img src="../Images/8e71a1bba5160cfa98e3aae522722bc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UOZKEq8OMCv9auBtuwwTLw.gif"/></div></div><figcaption class="mr ms fg fe ff mt mu bd b be z ek">I am bad at making gifs</figcaption></figure><h1 id="294b" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">宏观思维</h1><p id="4682" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">让我们仔细分析一下我们刚刚使用的宏:</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="54e3" class="li js hu mb b fv mf mg l mh mi">^                       Move to beginning of line   | Prefix<br/>"ayi"                   Copy in quotes (id) to reg a  |<br/>"bcit                   Change in tag (text) to reg b |<br/>  &lt;%=t 'soup_options.   Text                          |<br/>  &lt;c-R&gt;a                Paste reg a                   |<br/>  '%&gt;                   Text                          |<br/>&lt;c-C&gt;                   Exit insert mode              | Body<br/>&lt;c-W&gt;w                  Switch to next window         |<br/>o                       Newline                       |<br/>  &lt;c-R&gt;a:               Paste reg a                   |<br/>  &lt;c-R&gt;b                Paste reg b                   |<br/>&lt;c-C&gt;                   Exit                          |<br/>&lt;c-W&gt;w                  Switch to next window       |<br/>j                       Down one line               | Suffix</span></pre><p id="1a26" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，宏有一个清晰的结构:</p><ul class=""><li id="e4c1" class="ku kv hu it b iu iv iy iz jc kw jg kx jk ky jo kz la lb lc dt translated">大多数宏都以前缀<strong class="it hv">开始，这是一组确保宏正常运行的命令。我们的设置只是^，所以我们在生产线的开始。其他设置可能包括从一个特定的字符串或字符开始，跳到一个标记，清除寄存器等。</strong></li><li id="dcfb" class="ku kv hu it b iu ld iy le jc lf jg lg jk lh jo kz la lb lc dt translated">接下来是一个<strong class="it hv">主体</strong>，它完成编辑任务。</li><li id="b7c2" class="ku kv hu it b iu ld iy le jc lf jg lg jk lh jo kz la lb lc dt translated">我们以一个<strong class="it hv">后缀</strong>结束，它设置我们重复宏。没有后缀，宏仍然可以工作，但是我们必须手动移动到下一行。有了它，我们已经定位在下一行，可以用@q重复。我们也可以使宏<em class="jq">递归。</em>虽然宏不能记录宏，但它可以运行宏，包括宏本身。如果我们在后缀后面加上@q，我们的宏会一直重复，直到用完所有的行。</li></ul><p id="6206" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">身体是最复杂的部分，有一些特别的地方值得注意。</p><h2 id="6de8" class="li js hu bd jt lj lk ll jx lm ln lo kb jc lp lq kf jg lr ls kj jk lt lu kn lv dt translated">寄存器的使用</h2><p id="1f13" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">寄存器在vim命令中很有用；在宏中，它们是绝对重要的。寄存器实际上是您在宏中的“变量”,让您为将来的转换存储信息。这里我们最终使用了两个，一个存储id，一个存储文本。</p><p id="6a77" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">同样，标记也非常有用，尤其是大写的。虽然我们在这里使用了两个窗口，但是我们也可以在html文件中放置一个标记mA，在I18n文件中放置一个标记mB，并使用它们进行切换。</p><p id="f143" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，保留几个寄存器作为宏使用，几个寄存器供宏使用通常是个好主意。</p><h2 id="d9cd" class="li js hu bd jt lj lk ll jx lm ln lo kb jc lp lq kf jg lr ls kj jk lt lu kn lv dt translated">选择不变量</h2><p id="cc44" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">由于这些行都略有不同，我们不能依赖基于计数的命令总是正确的。幸运的是，vim有强大的相对运动和选择命令，我们可以使用。yi”和cit使用文本对象作为不变量。我们感兴趣的是id和li值，“引号内的第一个文本”和“标签内的文本”将总是描述它们。请注意，这里有多个可能的不变量可供选择，不同的上下文会改变哪些是有效的，哪些是无效的。假设我们有以下内容:</p><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="48b3" class="li js hu mb b fv mf mg l mh mi">&lt;li id="apple"&gt;Apple Soup&lt;/li&gt;<br/>&lt;li id='cotton'&gt;Cotton Soup&lt;/li&gt;<br/>&lt;li class="foo" id="bees"&gt;Bee Soup&lt;/li&gt;</span></pre><p id="d58a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">易”会猛拉“苹果”，但“棉花”是在单引号里的。“棉花”可以用“易”，但“苹果”就不行了。这里的一个不变量是f=2lyw，或者“在第一个=”之后，从两个字符开始抽取单词。这将破坏第三行(复制“foo”而不是“bees”)。我们可以通过用F &gt; f=(last = before of first &gt;)替换F =来解决这个问题。</p><p id="cf9f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">(这里的其他不变量可能是/id=或f&gt;B3w (ew)。使用最简单的符合你的上下文的。)</p><h1 id="e01f" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">使用宏</h1><p id="83c4" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">您可以通过按q[a-z]开始录制新宏，并通过按q结束录制。您可以使用q[A-Z]追加到现有宏。您也可以通过使用“[a-z]y将文本字符串直接复制到寄存器中来创建宏。编写宏的一种常见方法是:</p><ol class=""><li id="11e4" class="ku kv hu it b iu iv iy iz jc kw jg kx jk ky jo mv la lb lc dt translated">记录宏的第一次迭代。</li><li id="949f" class="ku kv hu it b iu ld iy le jc lf jg lg jk lh jo mv la lb lc dt translated">运行您的第二个案例，看看它是否仍然有效。如有必要，请撤消。</li><li id="8107" class="ku kv hu it b iu ld iy le jc lf jg lg jk lh jo mv la lb lc dt translated">如果第二次运行失败，将宏粘贴到缓冲区，手动添加适当的击键，并将其复制回寄存器。必要时重复。</li></ol><p id="e6ca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通常问题是不正确的不变量或相对运动，应该很容易解决。</p><p id="085f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">直接编辑宏时，可以在插入模式下使用ctrl-V按字面插入特殊字符。你可以用它来添加ctrl命令，escape等等。</p><h1 id="f453" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">何时不使用宏</h1><ul class=""><li id="5105" class="ku kv hu it b iu kp iy kq jc mw jg mx jk my jo kz la lb lc dt translated">当元编码不必要时。你不需要一个宏来缩进一个页面，因为你已经有了gg=G。</li><li id="c12e" class="ku kv hu it b iu ld iy le jc lf jg lg jk lh jo kz la lb lc dt translated">当另一个更简单的工具就足够了。Vim提供了许多其他命令来满足更常见的用例，比如。，:norm，和:bufdo。</li><li id="03f2" class="ku kv hu it b iu ld iy le jc lf jg lg jk lh jo kz la lb lc dt translated">当你有一致的用例时。宏是快速的、一次性的转换。如果你期望长期需要它，或者需要更灵活的东西，考虑写一个函数。</li><li id="3476" class="ku kv hu it b iu ld iy le jc lf jg lg jk lh jo kz la lb lc dt translated">当你应该使用编程语言的时候。</li></ul><h1 id="d21c" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">摘要</h1><p id="40f9" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">Medium需要内联代码格式。</p><h1 id="fd1a" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">进一步阅读</h1><pre class="lw lx ly lz fq ma mb mc md aw me dt"><span id="3129" class="li js hu mb b fv mf mg l mh mi">:h complex-repeat<br/>:h multi-repeat<br/>:h registers<br/>:h i_CTRL-V</span></pre><div class="lw lx ly lz fq ab cb"><figure class="mz mk na nb nc nd ne paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mz mk na nb nc nd ne paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mz mk na nb nc nd ne paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nf ng nh"><p id="f922" class="ir is jq it b iu iv iw ix iy iz ja jb ni jd je jf nj jh ji jj nk jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is jq it b iu iv iw ix iy iz ja jb ni jd je jf nj jh ji jj nk jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lw lx ly lz fq mk fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff nl"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure><figure class="lw lx ly lz fq mk"><div class="bz el l di"><div class="nm nn l"/></div></figure></div></div>    
</body>
</html>