<html>
<head>
<title>An Easier Way to Authenticate Users in E2E Tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一种在E2E测试中验证用户身份的简单方法</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/an-easier-way-to-authenticate-users-in-e2e-tests-230d86071f48?source=collection_archive---------4-----------------------#2017-07-24">https://medium.com/hackernoon/an-easier-way-to-authenticate-users-in-e2e-tests-230d86071f48?source=collection_archive---------4-----------------------#2017-07-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="288d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在许多情况下，您可能需要您的测试来代表一个经过身份验证的用户。例如，如果您的Web应用程序为授权用户提供特殊功能，您将需要您的测试来进行身份验证。</p><p id="53c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Web应用程序中有两种流行的身份验证类型</p><ul class=""><li id="112c" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated">由用户在网页上输入凭据执行的基于表单的身份验证</li><li id="730f" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated">协议级HTTP身份验证，包括HTTP Basic和Windows NTLM身份验证</li></ul><p id="ec56" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，现有的测试工具不能为这两种认证类型提供完全的支持。</p><p id="a1d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">大多数测试框架没有专门处理基于表单的身份验证——它是通过一系列常规的测试操作来执行的。假设一些框架在测试运行之间共享cookies，而另一些不共享，那么您可能需要在每个测试中手工登录或注销。</p><p id="0672" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最近的<a class="ae kd" href="https://hackernoon.com/tagged/e2e" rel="noopener ugc nofollow" target="_blank"> E2E </a>测试<a class="ae kd" href="https://hackernoon.com/tagged/tools" rel="noopener ugc nofollow" target="_blank">工具</a>也对HTTP基本或NTLM认证有有限或没有内置支持。例如，Selenium只能在第三方浏览器自动化工具的帮助下处理HTTP认证。</p><p id="2009" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">幸运的是，事情发生了变化，新的解决方案出现在E2E测试领域。我们在DevExpress开发了自己的测试框架<a class="ae kd" href="https://github.com/DevExpress/testcafe/" rel="noopener ugc nofollow" target="_blank"> TestCafe </a>，为Web认证提供了广泛的支持。</p><p id="ecfa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">TestCafe支持现成的HTTP基本和NTLM认证。为了处理基于表单的认证，TestCafe引入了一个新概念— <em class="ke">用户角色</em>。用户角色代表其帐户参与测试的个人用户。用户可以登录多个网站，所有帐户都将与用户角色相关联。您可以通过一次函数调用在角色之间切换来更改活动用户。</p><p id="10ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本文中，我将描述如何在TestCafe测试中执行认证。我还将展示一个在GitHub上进行身份验证的真实例子。</p><h2 id="ef92" class="kf kg hu bd kh ki kj kk kl km kn ko kp jc kq kr ks jg kt ku kv jk kw kx ky kz dt translated">用户角色</h2><p id="7392" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">假设您需要测试一个在表格中显示数据的应用程序页面。普通用户可以查看数据，而管理员也可以删除单个行。</p><p id="e1cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们编写一个测试来检查这一点</p><ul class=""><li id="c94d" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated">只有管理员可以看到“删除行”按钮；</li><li id="d5ca" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated">该按钮实际上删除了表格行。</li></ul><figure class="lf lg lh li fq lj"><div class="bz el l di"><div class="lk ll l"/></div></figure><p id="13d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这个测试中，我们必须登录三次，并为一个普通用户提供两次相同的凭证。</p><p id="eefc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了简化认证操作，TestCafe引入了用户角色。用户角色由登录用户的测试操作初始化。</p><figure class="lf lg lh li fq lj"><div class="bz el l di"><div class="lk ll l"/></div></figure><p id="7486" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们创建了两个用户角色:一个用于普通用户帐户，另一个用于管理帐户。现在让我们重写测试，以便它使用角色而不是身份验证操作。</p><figure class="lf lg lh li fq lj"><div class="bz el l di"><div class="lk ll l"/></div></figure><p id="3c43" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们隔离了身份验证操作，测试现在集中在测试场景上。我们还通过在角色之间切换而不是再次认证节省了几行代码。</p><h2 id="6dea" class="kf kg hu bd kh ki kj kk kl km kn ko kp jc kq kr ks jg kt ku kv jk kw kx ky kz dt translated">示例:在GitHub上验证</h2><p id="a647" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">在这个例子中，我们将编写一个测试，登录到GitHub并检查认证是否成功。</p><p id="53cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，让我们创建一个页面对象。</p><figure class="lf lg lh li fq lj"><div class="bz el l di"><div class="lk ll l"/></div></figure><p id="e10a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lm ln lo lp b">LoginPage</code>类描述了GitHub登录页面，有两个凭证输入和<code class="eh lm ln lo lp b">Sign in</code>按钮。</p><p id="b9c6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">描述了登录页面后，我们可以创建用户角色。</p><figure class="lf lg lh li fq lj"><div class="bz el l di"><div class="lk ll l"/></div></figure><p id="d99c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些用户角色通过输入用户凭证并点击<code class="eh lm ln lo lp b">Sign In</code>按钮的测试动作来初始化。</p><p id="c32c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们为GitHub主页添加一个page对象。我们将在测试中使用两个元素:头像和下拉菜单标题。</p><figure class="lf lg lh li fq lj"><div class="bz el l di"><div class="lk ll l"/></div></figure><p id="d857" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，我们可以编写一个通过用户角色进行身份验证的测试。然后，它检查通过单击头像调用的下拉菜单是否显示正确的用户名。</p><figure class="lf lg lh li fq lj"><div class="bz el l di"><div class="lk ll l"/></div></figure><h2 id="1f9f" class="kf kg hu bd kh ki kj kk kl km kn ko kp jc kq kr ks jg kt ku kv jk kw kx ky kz dt translated">HTTP基本/NTLM身份验证</h2><p id="1e5b" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">要登录受HTTP Basic或NTLM认证保护的网站，请向<code class="eh lm ln lo lp b">httpAuth</code>方法提供您的凭据。您可以为整个设备或单个测试指定这些凭证。</p><figure class="lf lg lh li fq lj"><div class="bz el l di"><div class="lk ll l"/></div></figure><p id="3d89" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">NTLM身份验证需要额外的参数:域名和工作站名称。你可以将它们传递给<code class="eh lm ln lo lp b">httpAuth</code>方法。如果您省略它们，TestCafe将自动使用当前机器的域名和工作站名。</p><h2 id="fcb3" class="kf kg hu bd kh ki kj kk kl km kn ko kp jc kq kr ks jg kt ku kv jk kw kx ky kz dt translated">结论</h2><p id="a8e6" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">在本文中，我展示了TestCafe如何对被测试的网页进行认证。TestCafe支持现成的HTTP基本/NTLM身份验证，并提供用户角色来处理基于表单的身份验证。</p><p id="843b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">参考TestCafe文档，了解更多关于<a class="ae kd" href="https://devexpress.github.io/testcafe/documentation/test-api/authentication/user-roles.html" rel="noopener ugc nofollow" target="_blank">用户角色</a>和<a class="ae kd" href="https://devexpress.github.io/testcafe/documentation/test-api/authentication/http-authentication.html" rel="noopener ugc nofollow" target="_blank"> HTTP认证</a>的信息。如果你有关于TestCafe的问题，请访问我们的论坛。要报告错误或留下建议，请访问我们的<a class="ae kd" href="https://github.com/DevExpress/testcafe/" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>。</p><p id="bded" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你已经尝试过TestCafe认证，请在评论中分享你的经验。</p><figure class="lf lg lh li fq lj"><div class="bz el l di"><div class="lq ll l"/></div></figure></div></div>    
</body>
</html>