<html>
<head>
<title>Android — How to add Gradle dependencies using ‘foreach’</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android —如何使用“foreach”添加梯度依赖关系</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/android-how-to-add-gradle-dependencies-using-foreach-c4cbcc070458?source=collection_archive---------2-----------------------#2016-10-07">https://medium.com/hackernoon/android-how-to-add-gradle-dependencies-using-foreach-c4cbcc070458?source=collection_archive---------2-----------------------#2016-10-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/83717e492a0d5776e155850721c7166a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7sOvHU05nKu58zJv5Rld4Q.png"/></div></div></figure><div class=""/><p id="9cca" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Android中一个有几个模块的大项目也有几个需要配置的Gradle文件，这是一项单调乏味的任务。通常做的事情是给每个模块添加依赖关系，在这篇文章中，将解释如何使用一个单独的Gradle文件来控制所有模块的依赖关系。</p><p id="1f33" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的目标是转换这个文件</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure><p id="6442" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">变成这个</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="f6bc" class="kn ko if bd kp kq kr ks kt ku kv kw kx jn ky kz la jr lb lc ld jv le lf lg lh dt translated">依赖文件</h2><p id="313b" class="pw-post-body-paragraph jc jd if je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">为了完成这个转换，首先创建一个文件来控制所有的项目依赖项。</p><p id="c3d7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在根项目中创建一个名为<strong class="je ig"> dependencies.gradle </strong>的文件，并指定将要使用的所有库版本。</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure><p id="4498" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦完成，让我们创建依赖关系定义映射。为了使文件尽可能有组织，将定义三个映射:一个用于Android库，另一个用于第三方库，最后一个用于测试库。</p><p id="9b26" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">文件应该是这样的</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure><p id="563f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，每个模块都需要创建一个列表，分别包含所有需要的依赖项。</p><p id="c570" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">例如，定义了一个名为app的模块，它将使用AppCompat、Dagger、RxJava和RxAndroid，如下所示。</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure><p id="19b3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">列表中的每个对象都包含一个定义依赖关系的映射及其配置。在这个例子中，使用了“编译”和“apt”配置，但是还有更多诸如“提供”、“测试编译”、“Android测试编译”等…</p><p id="37db" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在打开app模块的gradle文件，使用下面的代码。</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="180d" class="kn ko if bd kp kq kr ks kt ku kv kw kx jn ky kz la jr lb lc ld jv le lf lg lh dt translated">这是如何工作的？(◔_◔)?</h2><p id="20f3" class="pw-post-body-paragraph jc jd if je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">通常在dependencies块中添加一个依赖项如下所示。</p><pre class="ka kb kc kd fq ln lo lp lq aw lr dt"><span id="87a6" class="kn ko if lo b fv ls lt l lu lv">compile 'com.google.code.gson:gson:2.7'</span></pre><p id="3bf7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">直接调用DependencyHandle对象添加方法。</p><p id="c8ac" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们来看看add方法。</p><pre class="ka kb kc kd fq ln lo lp lq aw lr dt"><span id="fb4e" class="kn ko if lo b fv ls lt l lu lv"><a class="ae lw" href="https://docs.gradle.org/current/javadoc/org/gradle/api/artifacts/dsl/DependencyHandler.html#add%28java.lang.String,%20java.lang.Object%29" rel="noopener ugc nofollow" target="_blank"><strong class="lo ig">add</strong></a>(<a class="ae lw" href="https://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" rel="noopener ugc nofollow" target="_blank"><strong class="lo ig">String</strong></a> configurationName, <a class="ae lw" href="https://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" rel="noopener ugc nofollow" target="_blank"><strong class="lo ig">Object</strong></a> dependencyNotation)</span><span id="af8d" class="kn ko if lo b fv lx lt l lu lv">Adds a dependency to the given configuration.</span></pre><p id="7024" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这个方法将配置名(compile，testCompile，androidTestCompile…)作为第一个参数，将依赖项本身作为第二个参数。</p><p id="cdcc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">依赖性可以以常规方式定义为字符串变量。</p><pre class="ka kb kc kd fq ln lo lp lq aw lr dt"><span id="6cdc" class="kn ko if lo b fv ls lt l lu lv">'com.google.code.gson:gson:2.7'</span></pre><p id="4dc0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果使用最新版本(Android Studio的方式)，它可能被定义为一个地图。</p><pre class="ka kb kc kd fq ln lo lp lq aw lr dt"><span id="e656" class="kn ko if lo b fv ls lt l lu lv">[group: ‘com.google.code.gson’, name: ‘gson’, version: '2.7']</span></pre><p id="ec13" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">回到代码…</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure><p id="7c20" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正在迭代之前创建的appDependencies列表，每次迭代都会添加一个依赖项及其配置。要用Groovy表示迭代中的当前元素，请使用'<strong class="je ig"> it' </strong>变量。</p><p id="ff6e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这个过程应该在每个模块的<strong class="je ig"> build.gradle </strong>文件中重复，这样任何时候需要一个新的依赖项，只要把它添加到依赖项文件中相应的列表中。这就是如何用一个文件来控制所有的依赖关系。注意，这个文件可以在其他Android项目中重用。</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h1 id="71be" class="ly ko if bd kp lz ma mb kt mc md me kx mf mg mh la mi mj mk ld ml mm mn lg mo dt translated">模块之间的依赖关系</h1><p id="8ab1" class="pw-post-body-paragraph jc jd if je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">这个过程可以应用于添加模块之间的依赖性。</p><p id="c567" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为此，首先应该在<strong class="je ig"> dependencies.gradle </strong>中指定所有模块。比如app，数据，领域模块。</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure><p id="4ca8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果应用程序模块将使用域模块，则应按以下方式添加依赖关系:</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="d36f" class="kn ko if bd kp kq kr ks kt ku kv kw kx jn ky kz la jr lb lc ld jv le lf lg lh dt translated">选择</h2><p id="083c" class="pw-post-body-paragraph jc jd if je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">如果需要任何额外的选项，比如排除模块或使用transitive，通常的做法是:</p><pre class="ka kb kc kd fq ln lo lp lq aw lr dt"><span id="d242" class="kn ko if lo b fv ls lt l lu lv">androidTestCompile ('com.android.support.test:runner:0.5') {<br/>    exclude module: 'support-annotations'<br/>}</span></pre><p id="0809" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要做的第一件事是在依赖项中添加一个额外的键值来表示选项。让我们看一个例子:</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure><p id="3ff3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，需要修改应用程序模块内部的build.gradle文件，并更改add方法，以便添加一个闭包作为额外的参数来添加选项。</p><pre class="ka kb kc kd fq ln lo lp lq aw lr dt"><span id="40b1" class="kn ko if lo b fv ls lt l lu lv"><a class="ae lw" href="https://docs.gradle.org/current/javadoc/org/gradle/api/artifacts/dsl/DependencyHandler.html#add%28java.lang.String,%20java.lang.Object,%20groovy.lang.Closure%29" rel="noopener ugc nofollow" target="_blank"><strong class="lo ig">add</strong></a>(<a class="ae lw" href="https://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" rel="noopener ugc nofollow" target="_blank"><strong class="lo ig">String</strong></a> configurationName, <a class="ae lw" href="https://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" rel="noopener ugc nofollow" target="_blank"><strong class="lo ig">Object</strong></a> dependencyNotation, <a class="ae lw" href="http://docs.groovy-lang.org/docs/groovy-2.4.7/html/gapi/groovy/lang/Closure.html?is-external=true" rel="noopener ugc nofollow" target="_blank"><strong class="lo ig">Closure</strong></a> configureClosure)</span><span id="5866" class="kn ko if lo b fv lx lt l lu lv">Adds a dependency to the given configuration, and configures the dependency using the given closure.</span></pre><p id="2b99" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">build.gradle文件应该如下所示:</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="492b" class="kn ko if bd kp kq kr ks kt ku kv kw kx jn ky kz la jr lb lc ld jv le lf lg lh dt translated">插件</h2><p id="1d83" class="pw-post-body-paragraph jc jd if je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">通过这个过程，也可以管理我们在每个模块中使用的插件，并从dependencies.gradle文件中控制所有插件，让我们来看一个例子，其中这个文件</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure><p id="c7c1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">可以用这个代替</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure><p id="a131" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">只需在<strong class="je ig"> dependencies.gradle </strong>文件中创建一个插件列表，这些插件将被模块使用。</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="a969" class="kn ko if bd kp kq kr ks kt ku kv kw kx jn ky kz la jr lb lc ld jv le lf lg lh dt translated">调用dependencies.gradle</h2><p id="939f" class="pw-post-body-paragraph jc jd if je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">所有这些过程的工作方式是从位于根项目中的build.gradle文件调用dependencies.gradle文件。</p><pre class="ka kb kc kd fq ln lo lp lq aw lr dt"><span id="c9fa" class="kn ko if lo b fv ls lt l lu lv">apply from: 'dependencies.gradle'</span></pre><p id="6f48" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从GitHub库中查看这个<a class="ae lw" href="https://github.com/fabiomsr/centralize-dependencies-gradle" rel="noopener ugc nofollow" target="_blank">示例</a>。</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="2f22" class="kn ko if bd kp kq kr ks kt ku kv kw kx jn ky kz la jr lb lc ld jv le lf lg lh dt translated">不足之处</h2><p id="aa3d" class="pw-post-body-paragraph jc jd if je b jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz hn dt translated">这个过程中并不是一切都是美好的，这种添加管理依赖项的方式使得Android Studio无法通知库何时过期。</p><p id="ab72" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了解决这个问题，您可以混合使用添加和管理依赖项的两种方法，并使用常规方法来管理Android库，以便在任何库过期时通知它。</p><figure class="ka kb kc kd fq hw"><div class="bz el l di"><div class="ke kf l"/></div></figure><div class="ka kb kc kd fq ab cb"><figure class="mp hw mq mr ms mt mu paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mp hw mq mr ms mt mu paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mp hw mq mr ms mt mu paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mv mw mx"><p id="f922" class="jc jd my je b jf jg jh ji jj jk jl jm mz jo jp jq na js jt ju nb jw jx jy jz hn dt translated"><a class="ae lw" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae lw" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae lw" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae lw" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd my je b jf jg jh ji jj jk jl jm mz jo jp jq na js jt ju nb jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae lw" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae lw" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ka kb kc kd fq hw fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff nc"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure></div></div>    
</body>
</html>