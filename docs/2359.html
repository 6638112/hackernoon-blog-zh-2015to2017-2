<html>
<head>
<title>Benchmarking Amazon SNS &amp; SQS For Inter-Process Communication In A Microservices Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微服务架构中进程间通信的亚马逊社交网络和SQS基准测试</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/benchmarking-amazon-sns-sqs-for-inter-process-communication-in-a-microservice-architecture-de0dfa8d6ac6?source=collection_archive---------2-----------------------#2017-01-22">https://medium.com/hackernoon/benchmarking-amazon-sns-sqs-for-inter-process-communication-in-a-microservice-architecture-de0dfa8d6ac6?source=collection_archive---------2-----------------------#2017-01-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="fbca" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">放弃</h2></div><p id="2d66" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">此内容是我们在线课程/培训的一部分/灵感来源。在2019年黑色星期五期间，我们对这些材料提供高达80%的折扣。</p><p id="ede3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以在这里享受您的<a class="ae kf" href="http://bf.eralabs.io" rel="noopener ugc nofollow" target="_blank">折扣。</a></p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><a href="http://bf.eralabs.io"><div class="fe ff kg"><img src="../Images/f322772403668f8316905cec24b85586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0qBLWIa0zP-zJcrenZN8w.png"/></div></a></figure></div><div class="ab cl ko kp hc kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hn ho hp hq hr"><p id="fe85" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt kv translated"><span class="l kw kx ky bm kz la lb lc ld di"> T </span>这是我撰写的一系列<strong class="jl hv">实用</strong>帖子的第一部分<strong class="jl hv">，旨在帮助开发者和架构师理解和构建微服务。</strong></p><p id="1363" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我在同样的背景下写了其他的故事，比如这些链接:</p><ul class=""><li id="75f9" class="le lf hu jl b jm jn jp jq js lg jw lh ka li ke lj lk ll lm dt translated"><a class="ae kf" rel="noopener" href="/@eon01/microservices-from-development-to-production-using-docker-docker-compose-docker-swarm-3cf37f97706b">微服务从开发到生产使用Docker，Docker组成&amp; Docker群</a></li><li id="1335" class="le lf hu jl b jm ln jp lo js lp jw lq ka lr ke lj lk ll lm dt translated"><a class="ae kf" rel="noopener" href="/@eon01/easy-docker-orchestration-with-docker-1-12-aws-efs-and-the-swarm-mode-87d51b6d5ad2#.59os1v6fd">利用Docker 1.12、AWS EFS和Swarm模式实现简单的Docker编排</a></li></ul><p id="eeb8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">注意，我在这个例子中使用了Python、SNS和SQS。</p><p id="d2e5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这篇博文中使用了亚马逊社交网站和SQS，因为它们易于配置，但你可能会找到几个开源的替代品。</p><p id="1c8e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">该基准测试中的结果是相对于我使用的互联网连接和我的笔记本电脑性能而言的。</p><p id="8e9f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我的连接带宽是9.73 Mbps下载/11.09 Mbps上传。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff ls"><img src="../Images/005f6339adf031ff6c2c9975ff0cc463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*UTwWpuwHqYJTHhzfBSuonw.png"/></div></figure><p id="f829" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我有4个CPU和7.5 GB的内存:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff lt"><img src="../Images/590288226677940026ba5776fc25a268.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*SoZii4a7MgNUuTfiDujeSQ.png"/></div></figure></div><div class="ab cl ko kp hc kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hn ho hp hq hr"><h1 id="1d9e" class="lu lv hu bd lw lx ly lz ma mb mc md me ja mf jb mg jd mh je mi jg mj jh mk ml dt translated">亚马逊简单通知服务</h1><p id="8bc3" class="pw-post-body-paragraph jj jk hu jl b jm mm iv jo jp mn iy jr js mo ju jv jw mp jy jz ka mq kc kd ke hn dt kv translated">这是一个完全托管的推送通知服务，可以让您发送单个消息或将消息分散给大量收件人。社交网络可以用来向移动设备用户、电子邮件收件人发送推送通知，或者向其他服务发送消息(比如SQS)。</p><h1 id="9a29" class="lu lv hu bd lw lx mr lz ma mb ms md me ja mt jb mg jd mu je mi jg mv jh mk ml dt translated">亚马逊简单队列服务</h1><p id="ef08" class="pw-post-body-paragraph jj jk hu jl b jm mm iv jo jp mn iy jr js mo ju jv jw mp jy jz ka mq kc kd ke hn dt kv translated">QS是一个完全管理的消息队列服务。亚马逊SQS用于传输任何数量的数据，而不会丢失消息。亚马逊SQS可以充当FIFO队列(先进先出)。</p></div><div class="ab cl ko kp hc kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hn ho hp hq hr"><h1 id="31ce" class="lu lv hu bd lw lx ly lz ma mb mc md me ja mf jb mg jd mh je mi jg mj jh mk ml dt translated">Unix理念和基于微服务的软件</h1><p id="019c" class="pw-post-body-paragraph jj jk hu jl b jm mm iv jo jp mn iy jr js mo ju jv jw mp jy jz ka mq kc kd ke hn dt kv translated">我相信微服务正在改变我们对软件和DevOps的看法。我并不是说它是你所有问题的解决方案，但是在一起工作的程序之间共享堆栈的复杂性(Unix哲学)可以解决许多问题。</p><p id="b05a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">使用Docker或rkt和编排工具(Swarm、K8S)向您的微服务架构添加容器化层..)将真正简化从开发到运营的整个流程，并帮助您管理网络，提高堆栈性能、可扩展性和自我修复能力..</p><p id="04f7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我和你们中的许多人一样，采用每个容器一个流程的理念。这也是我为这个教程所考虑的，所以进程间通信和微服务容器一样；每个微服务运行一个独立的进程，做好一件事，并与其他进程通信(Unix哲学)。</p><p id="8af3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">道格·麦克洛伊在1978年的《贝尔系统技术杂志》中记录了UNIX的基本原理:</p><ol class=""><li id="ec61" class="le lf hu jl b jm jn jp jq js lg jw lh ka li ke mw lk ll lm dt translated">让每个程序做好一件事。要做一项新的工作，就要重新构建，而不是通过添加新的“特性”使旧的程序变得复杂。</li><li id="8c21" class="le lf hu jl b jm ln jp lo js lp jw lq ka lr ke mw lk ll lm dt translated">期望每个程序的输出成为另一个未知程序的输入。不要用无关的信息混淆输出。避免严格的列或二进制输入格式。不要坚持交互输入。</li><li id="043f" class="le lf hu jl b jm ln jp lo js lp jw lq ka lr ke mw lk ll lm dt translated">设计和构建软件，甚至是操作系统，尽早试用，最好在几周内。不要犹豫，扔掉笨拙的部分，重建它们。</li><li id="9d89" class="le lf hu jl b jm ln jp lo js lp jw lq ka lr ke mw lk ll lm dt translated">优先使用工具，而不是不熟练的帮助来减轻编程任务，即使你不得不绕道去构建工具，并期望在用完后扔掉一些工具。</li></ol><p id="d486" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">根据经验，我相信在开发软件的同时牢记Unix哲学原理将会为您避免很多麻烦。</p></div><div class="ab cl ko kp hc kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hn ho hp hq hr"><blockquote class="mx"><p id="6b05" class="my mz hu bd na nb nc nd ne nf ng ke ek translated">别忘了检查我的培训<a class="ae kf" href="http://practicalaws.com" rel="noopener ugc nofollow" target="_blank">实用AWS </a></p></blockquote><figure class="ni nj nk nl nm kl fe ff paragraph-image"><a href="http://practicalaws.com"><div class="fe ff nh"><img src="../Images/d5d1ad8547b7e2dc12a5df0141b7411a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9WfQeLwyP7DIpDejDcN5MQ.png"/></div></a></figure><h1 id="fbed" class="lu lv hu bd lw lx mr lz ma mb ms md me ja mt jb mg jd mu je mi jg mv jh mk ml dt translated">基于消息的微服务的通用架构</h1><p id="0df0" class="pw-post-body-paragraph jj jk hu jl b jm mm iv jo jp mn iy jr js mo ju jv jw mp jy jz ka mq kc kd ke hn dt kv translated"><span class="l kw kx ky bm kz la lb lc ld di">正如</span>你可以看到一个发布者向SNS发送一个预先选定的主题，在它的作用下，SNS发送一个消息到一个订阅的SQS队列。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="fe ff nn"><img src="../Images/669d124b62ce2e810e3f53b398405722.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wpfBNIfSLYbDnyEfIW-Hxg.png"/></div></div><figcaption class="ns nt fg fe ff nu nv bd b be z ek">A Simplified Architecture</figcaption></figure><p id="86f0" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在本教程中，我们将使用Python和Boto编写一个原型。</p><h1 id="5dc0" class="lu lv hu bd lw lx mr lz ma mb ms md me ja mt jb mg jd mu je mi jg mv jh mk ml dt translated">构建发布者</h1><p id="90e7" class="pw-post-body-paragraph jj jk hu jl b jm mm iv jo jp mn iy jr js mo ju jv jw mp jy jz ka mq kc kd ke hn dt kv translated">从创建一个虚拟环境并安装Boto(亚马逊网络服务的Python接口)开始</p><pre class="kh ki kj kk fq nw nx ny nz aw oa dt"><span id="58a4" class="ob lv hu nx b fv oc od l oe of">virtualenv sns_test</span><span id="b347" class="ob lv hu nx b fv og od l oe of">cd sns_test</span><span id="7ab0" class="ob lv hu nx b fv og od l oe of">pip install boto</span></pre><p id="f6bc" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是发布者代码:</p><pre class="kh ki kj kk fq nw nx ny nz aw oa dt"><span id="c896" class="ob lv hu nx b fv oc od l oe of">import boto.sns, time, json, logging<br/>from datetime import datetime</span><span id="b7f7" class="ob lv hu nx b fv og od l oe of">logging.basicConfig(filename="sns-publish.log", level=logging.DEBUG)</span><span id="029f" class="ob lv hu nx b fv og od l oe of"># Connect to SNS<br/>c = boto.sns.connect_to_region("eu-west-1")</span><span id="2eb4" class="ob lv hu nx b fv og od l oe of">sns_topic_arn = "arn:aws:sns:eu-west-1:953414735923:test"</span><span id="495c" class="ob lv hu nx b fv og od l oe of"># Send 100 messages<br/>for x in range(100):</span><span id="e0db" class="ob lv hu nx b fv og od l oe of">    body = "Message Body From Microservice Number" + str(x)<br/>    subject = "Message Subject Number" + str(x)</span><span id="62e9" class="ob lv hu nx b fv og od l oe of">    publication = c.publish(sns_topic_arn, body, subject=subject + str(x))</span><span id="3866" class="ob lv hu nx b fv og od l oe of"># Choosing what we want to print to the terminal<br/>m = json.loads(json.dumps(publication, ensure_ascii=False))</span><span id="a8f4" class="ob lv hu nx b fv og od l oe of">message_id = m["PublishResponse"]["PublishResult"]["MessageId"]</span><span id="2835" class="ob lv hu nx b fv og od l oe of">print str(datetime.now()) + " : " + subject + " : " + body + " : " + message_id<br/></span><span id="8c08" class="ob lv hu nx b fv og od l oe of">    time.sleep(5)</span></pre><p id="c7bd" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这段代码将打印发送的消息id和时间。</p><h1 id="88d0" class="lu lv hu bd lw lx mr lz ma mb ms md me ja mt jb mg jd mu je mi jg mv jh mk ml dt translated">构建消费者</h1><p id="68f9" class="pw-post-body-paragraph jj jk hu jl b jm mm iv jo jp mn iy jr js mo ju jv jw mp jy jz ka mq kc kd ke hn dt kv translated">从创建一个虚拟环境并安装Boto(亚马逊网络服务的Python接口)开始</p><pre class="kh ki kj kk fq nw nx ny nz aw oa dt"><span id="b8d1" class="ob lv hu nx b fv oc od l oe of">virtualenv sqs_test</span><span id="31cd" class="ob lv hu nx b fv og od l oe of">cd sqs_test</span><span id="ed66" class="ob lv hu nx b fv og od l oe of">pip install boto</span></pre><p id="79b7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是原型代码:</p><pre class="kh ki kj kk fq nw nx ny nz aw oa dt"><span id="333a" class="ob lv hu nx b fv oc od l oe of">import boto.sqs, time, json<br/>from datetime import datetime</span><span id="0022" class="ob lv hu nx b fv og od l oe of"># Connect to SQS<br/>conn = boto.sqs.connect_to_region(<br/>               "eu-west-1", aws_access_key_id='xxxxxx',<br/>                aws_secret_access_key='xxxxxx')</span><span id="373c" class="ob lv hu nx b fv og od l oe of"># Choose the used queue<br/>queue = conn.get_queue('test')</span><span id="16ce" class="ob lv hu nx b fv og od l oe of"># While true read the queue, if the program reads everything then it will wait (pass)</span><span id="2f19" class="ob lv hu nx b fv og od l oe of">while 1:<br/>    try:<br/>        result_set = queue.get_messages()</span><span id="56c3" class="ob lv hu nx b fv og od l oe of">message = result_set[0]<br/>        message_body = message.get_body()<br/>        m = json.loads(message_body)</span><span id="4230" class="ob lv hu nx b fv og od l oe of">        subject = m["Subject"][:-1]<br/>        body = m["Message"]<br/>        message_id = m["MessageId"]</span><span id="6361" class="ob lv hu nx b fv og od l oe of">        print str(datetime.now()) + " : " + subject + " : " + body + " : " + message_id</span><span id="03e2" class="ob lv hu nx b fv og od l oe of">        conn.delete_message(queue, message)</span><span id="7f78" class="ob lv hu nx b fv og od l oe of">    except IndexError:<br/>        pass</span></pre><p id="d6c6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">该代码将打印接收到的消息id和时间。</p><h1 id="9fcb" class="lu lv hu bd lw lx mr lz ma mb ms md me ja mt jb mg jd mu je mi jg mv jh mk ml dt translated">测试我们的原型</h1><p id="a934" class="pw-post-body-paragraph jj jk hu jl b jm mm iv jo jp mn iy jr js mo ju jv jw mp jy jz ka mq kc kd ke hn dt kv translated"><span class="l kw kx ky bm kz la lb lc ld di">我</span>将我的终端分成两个窗口，首先启动订阅者脚本，然后是发布者:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="fe ff oh"><img src="../Images/da0bbe6a920696b06033c808055f6341.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x-rzsQ2Vbf3orpvBgEy_Fg.png"/></div></div></figure><h1 id="e83c" class="lu lv hu bd lw lx mr lz ma mb ms md me ja mt jb mg jd mu je mi jg mv jh mk ml dt translated">SNS+SQS有多快？</h1><p id="1311" class="pw-post-body-paragraph jj jk hu jl b jm mm iv jo jp mn iy jr js mo ju jv jw mp jy jz ka mq kc kd ke hn dt kv translated"><span class="l kw kx ky bm kz la lb lc ld di">在</span>中，为了查看文本消息的传输需要多长时间，我们将在两个脚本中使用时间戳。这是简化的流程图:</p><blockquote class="oi oj ok"><p id="9292" class="jj jk ol jl b jm jn iv jo jp jq iy jr om jt ju jv on jx jy jz oo kb kc kd ke hn dt translated">发布者-&gt; SNS -&gt; SQS -&gt;订阅者</p></blockquote><p id="650c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们正在发送一条差不多75B的消息(目前是一条小消息，只是为了测试)。</p><p id="761f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了更精确和更好地测量响应时间，我修改了两个程序:</p><p id="ba4e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv"> pub.py </strong></p><pre class="kh ki kj kk fq nw nx ny nz aw oa dt"><span id="9542" class="ob lv hu nx b fv oc od l oe of">import boto.sns, time, json, logging<br/>from datetime import datetime</span><span id="3f31" class="ob lv hu nx b fv og od l oe of">logging.basicConfig(filename="sns-publish.log", level=logging.DEBUG)<br/>c = boto.sns.connect_to_region("eu-west-1")<br/>sns_topic_arn = "arn:aws:sns:eu-west-1:953414735923:test"</span><span id="0911" class="ob lv hu nx b fv og od l oe of">for x in range(100):<br/>    body = "Message Body From Microservice Number" + str(x)<br/>    subject = "Message Subject Number" + str(x)<br/>    publication = c.publish(sns_topic_arn, body, subject=subject + str(x))<br/>    print str(time.time())</span><span id="da87" class="ob lv hu nx b fv og od l oe of">   time.sleep(1)</span></pre><p id="3029" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">sub py</strong></p><pre class="kh ki kj kk fq nw nx ny nz aw oa dt"><span id="4741" class="ob lv hu nx b fv oc od l oe of">import boto.sqs, time, json<br/>from datetime import datetime</span><span id="eff5" class="ob lv hu nx b fv og od l oe of">conn = boto.sqs.connect_to_region("eu-west-1", aws_access_key_id='xxxxxxxxxxx', aws_secret_access_key='xxxx')<br/>queue = conn.get_queue('test')</span><span id="c0e0" class="ob lv hu nx b fv og od l oe of">x = 0</span><span id="e1d1" class="ob lv hu nx b fv og od l oe of">while 1:<br/>    try:       <br/>        result_set = queue.get_messages()<br/>        if result_set != []:<br/>            print str(time.time()))<br/>            x += 1<br/>        message = result_set[0]       <br/>        conn.delete_message(queue, message)<br/>    except IndexError:<br/>        pass</span></pre><p id="3a33" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">计算接收时间和发送时间之间的差值(作为发送数据大小的函数)。</p><p id="cbee" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对于每种尺寸，每次发送20个串行请求。</p><p id="6781" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">以下是从社交网站发送到SQS的不同数据大小:</p><ul class=""><li id="6c86" class="le lf hu jl b jm jn jp jq js lg jw lh ka li ke lj lk ll lm dt translated">75B</li><li id="5b6b" class="le lf hu jl b jm ln jp lo js lp jw lq ka lr ke lj lk ll lm dt translated">700B</li><li id="7553" class="le lf hu jl b jm ln jp lo js lp jw lq ka lr ke lj lk ll lm dt translated">1.65KB</li><li id="5ce8" class="le lf hu jl b jm ln jp lo js lp jw lq ka lr ke lj lk ll lm dt translated">3.3KB</li><li id="9776" class="le lf hu jl b jm ln jp lo js lp jw lq ka lr ke lj lk ll lm dt translated">6.6KB</li><li id="9a0e" class="le lf hu jl b jm ln jp lo js lp jw lq ka lr ke lj lk ll lm dt translated">26.38KB</li></ul><p id="bf93" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">SQS收到的消息不会与发送的数据相同，因为其他数据和元数据也与一起发送。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="fe ff op"><img src="../Images/3b5308f8bac4b6cca54623536989f6f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_aJm4jBaLBsPivBxbznUTw.png"/></div></div><figcaption class="ns nt fg fe ff nu nv bd b be z ek">Sent Message Size Read By SQS</figcaption></figure><p id="f37a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我在26.38KB停止了基准测试，因为有一个限制:</p><blockquote class="oi oj ok"><p id="fe0f" class="jj jk ol jl b jm jn iv jo jp jq iy jr om jt ju jv on jx jy jz oo kb kc kd ke hn dt translated">有了亚马逊社交网络和亚马逊SQS，你现在有能力发送最大<strong class="jl hv"> 256KB </strong> (262，144字节)的大型有效载荷消息。要发送大的有效负载(64KB 和256 kb<strong class="jl hv">之间的消息)，必须使用支持AWS Signature Version 4 (SigV4)签名的AWS SDK。</strong></p></blockquote><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="fe ff oq"><img src="../Images/e4bca4250337b0bfdc0f23c211d53695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2bz82CwGnAhpTKon4x-NDQ.png"/></div></div><figcaption class="ns nt fg fe ff nu nv bd b be z ek">SNS-&gt;SQS Response Time In Function Of Sent Data Size</figcaption></figure><p id="0c9d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果数据量增加，响应时间不会改变，这是一件好事。</p><p id="5139" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们看看平均响应时间与数据大小的函数关系:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="fe ff or"><img src="../Images/9694527637d9808d4320b3cade628125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*znVyS51JIdYfOIWpaFZWhg.png"/></div></div></figure><p id="0b89" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对于合理的数据大小，将数据发送到SNS并将其发送到SQS的过程+我的Python程序读取数据的时间在0.5到0.9秒之间。</p><p id="3ff9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这个基准测试中，发送了将近1000条消息，我注意到所有的消息都被传递了，没有丢失消息。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="fe ff os"><img src="../Images/9d17405098ed4a532e7564a7db67e41c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fhplcxzqge4hY2ecLVzK5Q.png"/></div></div><figcaption class="ns nt fg fe ff nu nv bd b be z ek">Number Of Sent Messages</figcaption></figure><h1 id="2699" class="lu lv hu bd lw lx mr lz ma mb ms md me ja mt jb mg jd mu je mi jg mv jh mk ml dt translated">多个地区的社交网络/SQS</h1><p id="dfdf" class="pw-post-body-paragraph jj jk hu jl b jm mm iv jo jp mn iy jr js mo ju jv jw mp jy jz ka mq kc kd ke hn dt kv translated">从我的互联网连接和笔记本电脑配置来看，速度取决于你如何管理你的社交网络/SQS地区。(我一直用巴黎的都柏林地区。)</p><p id="6d67" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">使用该消息堆栈优化微服务之间(或发布者和订阅者之间)的消息传输的方法之一是将您的微服务和SNS/SQS保持在同一区域。</p><p id="372f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果出版商不在同一个地区(假设你有多个出版商，一个在亚洲，另一个在非洲，第三个在美国)，这里最好的办法是在不同的地区创建多个社交网络/SQS。</p><h1 id="d7ff" class="lu lv hu bd lw lx mr lz ma mb ms md me ja mt jb mg jd mu je mi jg mv jh mk ml dt translated">连接更深</h1><p id="d89b" class="pw-post-body-paragraph jj jk hu jl b jm mm iv jo jp mn iy jr js mo ju jv jw mp jy jz ka mq kc kd ke hn dt kv translated"><span class="l kw kx ky bm kz la lb lc ld di">M</span>micro services正在改变我们制作软件的方式，但它的缺点之一是网络部分有时会很复杂，消息传递会直接受到网络问题的影响。使用SNS/SQS和发布/订阅模型似乎是创建跨服务消息中间件的一个好的解决方案。我使用的发布者/订阅者脚本并没有真正针对负载和速度进行优化，但它们可能是最基本的形式。</p><p id="5da7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt kv translated"><span class="l kw kx ky bm kz la lb lc ld di">如果</span>你对这篇文章产生了共鸣，请加入成千上万来自世界各地的热情的DevOps工程师、开发人员和IT专家，订阅<a class="ae kf" href="http://devopslinks.com" rel="noopener ugc nofollow" target="_blank"> DevOpsLinks </a>。</p><blockquote class="mx"><p id="4940" class="my mz hu bd na nb nc nd ne nf ng ke ek translated">别忘了查看我的培训<a class="ae kf" href="http://practicalaws.com" rel="noopener ugc nofollow" target="_blank">实用AWS </a></p></blockquote><figure class="ni nj nk nl nm kl fe ff paragraph-image"><a href="http://practicalaws.com"><div class="fe ff nh"><img src="../Images/d5d1ad8547b7e2dc12a5df0141b7411a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9WfQeLwyP7DIpDejDcN5MQ.png"/></div></a></figure><p id="5d3d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以在<a class="ae kf" href="https://twitter.com/eon01" rel="noopener ugc nofollow" target="_blank">推特</a>、<a class="ae kf" href="https://clarity.fm/aymenelamri/" rel="noopener ugc nofollow" target="_blank"> Clarity </a>或者我的<a class="ae kf" href="http://aymenlamri.com" rel="noopener ugc nofollow" target="_blank">网站</a>上找到我，你也可以查看我的书:<a class="ae kf" href="http://saltstackfordevops.com" rel="noopener ugc nofollow" target="_blank"> SaltStack For DevOps </a>、&amp;T10】无痛码头。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="ab fr cl ot"><img src="../Images/9be788c6c2620a6f8af98543b867b658.png" data-original-src="https://miro.medium.com/v2/1*koUfnfQ-YkmwubsUs4zwwQ.gif"/></div></figure><p id="e1de" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你喜欢这篇文章，请推荐并分享给你的追随者。</p></div></div>    
</body>
</html>