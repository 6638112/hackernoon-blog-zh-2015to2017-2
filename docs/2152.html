<html>
<head>
<title>Developing isomorphic applications using webpack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用webpack开发同构应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/developing-isomorphic-applications-using-webpack-eca814a418ad?source=collection_archive---------5-----------------------#2017-01-09">https://medium.com/hackernoon/developing-isomorphic-applications-using-webpack-eca814a418ad?source=collection_archive---------5-----------------------#2017-01-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><blockquote class="ir is it"><p id="3213" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><strong class="ix hv">TL；dr；</strong>我已经着手开发一个程序，能够使用webpack在服务器端呈现任何客户端代码。最终的结果是<a class="ae jt" href="https://github.com/gajus/isomorphic-webpack" rel="noopener ugc nofollow" target="_blank">https://github.com/gajus/isomorphic-webpack</a>前往“你好，世界”。</p></blockquote><p id="4caa" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">在过去的6个月里，我一直在做一个需要在服务器端提供内容的项目。这个未命名的项目是Alexa全球100强网站的一部分。网站本身广泛利用<a class="ae jt" href="https://en.wikipedia.org/wiki/Edge_Side_Includes" rel="noopener ugc nofollow" target="_blank"> Edge Side Includes </a> (ESI)来“在互联网的边缘”组装页面内容。服务于内容服务器端的需求来自于对ESI的利用。</p><p id="c341" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">这是一个独特的挑战:我在一个更大的前端团队中工作；代码将需要由前端团队维护。因此，我的重点是使用前端团队已知的框架，尽可能避免后端特定的框架。我已经开始使用React和webpack开发应用程序。</p><p id="6d48" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">我已经启动并运行了应用程序，但是有一个问题——现有的同构渲染解决方案都没有现成的代码库。现有的解决方案需要模糊的配置，运行多个节点进程(使应用程序容器化变得很困难)，并且不能与所有的webpack加载器(例如<code class="eh jx jy jz ka b">style-loader</code>)一起工作。</p><p id="cbc3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">我已经着手开发一个程序来解决上述所有问题。我把它叫做https://github.com/gajus/isomorphic-webpack。这篇文章的其余部分介绍了它的工作原理和使用方法。</p></div><div class="ab cl kb kc hc kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hn ho hp hq hr"><h1 id="5b5c" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">“你好，世界！”</h1><p id="3fc3" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf ju li ji jj jv lj jm jn jw lk jq jr js hn dt translated">让我们从“你好，世界”开始，并以此为基础。</p><p id="3ad9" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">我们的示例是一个React应用程序。它使用<code class="eh jx jy jz ka b">react-dom</code>来呈现<code class="eh jx jy jz ka b">ReactElement</code>，并将结果DOM添加到<code class="eh jx jy jz ka b">#app</code>元素中。</p><p id="a0bd" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh jx jy jz ka b">/src/app/index.js</code></p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="10e5" class="lt kj hu ka b fv lu lv l lw lx">import React from 'react';<br/>import ReactDOM from 'react-dom';</span><span id="960e" class="lt kj hu ka b fv ly lv l lw lx">const app = &lt;div&gt;Hello, World!&lt;/div&gt;;</span><span id="d6fb" class="lt kj hu ka b fv ly lv l lw lx">ReactDOM.render(app, document.getElementById('app'));</span></pre><p id="5e4b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh jx jy jz ka b">webpack</code>配置为使用<code class="eh jx jy jz ka b">babel-loader</code>加载JavaScript文件。</p><p id="63ee" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh jx jy jz ka b">/src/webpack.config.js</code></p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="fca8" class="lt kj hu ka b fv lu lv l lw lx">import path from 'path';</span><span id="7391" class="lt kj hu ka b fv ly lv l lw lx">export default {<br/>  context: __dirname,<br/>  entry: {<br/>    app: [<br/>      path.resolve(__dirname, './app')<br/>    ]<br/>  },<br/>  module: {<br/>    loaders: [<br/>      {<br/>        include: path.resolve(__dirname, './app'),<br/>        loader: 'babel-loader',<br/>        test: /\.js$/<br/>      }<br/>    ]<br/>  },<br/>  output: {<br/>    filename: '[name].js',<br/>    path: path.resolve(__dirname, './dist')<br/>  }<br/>};</span></pre><p id="ceeb" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">一个服务器端脚本使用<code class="eh jx jy jz ka b">webpack</code>来编译应用程序，使用<code class="eh jx jy jz ka b">express</code>来提供内容。</p><p id="2e92" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh jx jy jz ka b">/src/bin/server.js</code></p><blockquote class="ir is it"><p id="23f0" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">注意:<code class="eh jx jy jz ka b">webpack-dev-middleware</code>不是<code class="eh jx jy jz ka b">isomorphic-webpack</code>的依赖。这里它仅用于服务客户端应用程序。</p></blockquote><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="1c7b" class="lt kj hu ka b fv lu lv l lw lx">import express from 'express';<br/>import webpack from 'webpack';<br/>import webpackDevMiddleware from 'webpack-dev-middleware';<br/>import webpackConfiguration from '../webpack.configuration';</span><span id="8761" class="lt kj hu ka b fv ly lv l lw lx">const compiler = webpack(webpackConfiguration);</span><span id="e8dd" class="lt kj hu ka b fv ly lv l lw lx">const app = express();</span><span id="6472" class="lt kj hu ka b fv ly lv l lw lx">app.use(webpackDevMiddleware(compiler, {<br/>  noInfo: false,<br/>  publicPath: '/static',<br/>  quiet: false,<br/>  stats: 'minimal'<br/>}));</span><span id="27c6" class="lt kj hu ka b fv ly lv l lw lx">app.get('/', (req, res) =&gt; {<br/>  res.send(`<br/>  &lt;!doctype html&gt;<br/>  &lt;html&gt;<br/>    &lt;head&gt;&lt;/head&gt;<br/>    &lt;body&gt;<br/>      &lt;div id='app'&gt;&lt;/div&gt;</span><span id="98d1" class="lt kj hu ka b fv ly lv l lw lx">      &lt;script src='/static/app.js'&gt;&lt;/script&gt;<br/>    &lt;/body&gt;<br/>  &lt;/html&gt;<br/>  `);<br/>});</span><span id="ed7a" class="lt kj hu ka b fv ly lv l lw lx">app.listen(8000);</span></pre><p id="d5b5" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">这不是同构的应用程序。发出HTTP请求只需用服务器端脚本中硬编码的字符串进行响应。</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="d330" class="lt kj hu ka b fv lu lv l lw lx">$ curl <a class="ae jt" href="http://127.0.0.1:8000" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000</a></span><span id="f963" class="lt kj hu ka b fv ly lv l lw lx">&lt;!doctype html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;&lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id='app'&gt;&lt;/div&gt;</span><span id="bcc4" class="lt kj hu ka b fv ly lv l lw lx">    &lt;script src='/static/app.js'&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="5113" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">同构应用程序将评估React应用程序代码，并使用呈现的应用程序进行响应。</p><p id="7e92" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">如果您只想签出代码，请使用以下命令:</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="394f" class="lt kj hu ka b fv lu lv l lw lx">$ git clone <a class="ae jt" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:gajus/isomorphic-webpack-demo.git<br/>$ cd isomorphic-webpack-demo<br/>$ git reset --hard f66783c89040c0fc19a19df961cbb2633f27348d<br/>$ npm install<br/>$ npm start</span></pre><h1 id="c5d1" class="ki kj hu bd kk kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf dt translated">同构“你好，世界！”</h1><p id="10a2" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf ju li ji jj jv lj jm jn jw lk jq jr js hn dt translated">让上面的应用程序同构需要什么？</p><p id="86db" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">需要对我们的代码库进行以下更改:</p><ol class=""><li id="d5e6" class="me mf hu ix b iy iz jc jd ju mg jv mh jw mi js mj mk ml mm dt translated">安装<code class="eh jx jy jz ka b">isomorphic-webpack</code></li><li id="3040" class="me mf hu ix b iy mn jc mo ju mp jv mq jw mr js mj mk ml mm dt translated">使用webpack配置设置<code class="eh jx jy jz ka b">isomorphic-webpack</code></li><li id="8f69" class="me mf hu ix b iy mn jc mo ju mp jv mq jw mr js mj mk ml mm dt translated">将应用程序作为模块导出。</li><li id="6650" class="me mf hu ix b iy mn jc mo ju mp jv mq jw mr js mj mk ml mm dt translated">使用<code class="eh jx jy jz ka b"><a class="ae jt" href="https://facebook.github.io/react/docs/react-dom-server.html" rel="noopener ugc nofollow" target="_blank">react-dom/server</a></code> <code class="eh jx jy jz ka b"><a class="ae jt" href="https://facebook.github.io/react/docs/react-dom-server.html#rendertostring" rel="noopener ugc nofollow" target="_blank">renderToString</a></code>渲染应用程序。</li></ol><p id="64f5" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">下面是它如何改变我们的示例应用程序:</p><p id="918a" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh jx jy jz ka b">/src/app/index.js</code>需要导出应用程序:</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="8bc6" class="lt kj hu ka b fv lu lv l lw lx">import React from 'react';<br/>import ReactDOM from 'react-dom';</span><span id="15e3" class="lt kj hu ka b fv ly lv l lw lx">const app = &lt;div&gt;Hello, World!&lt;/div&gt;;</span><span id="5530" class="lt kj hu ka b fv ly lv l lw lx">if (typeof ISOMORPHIC_WEBPACK === 'undefined') {<br/>  ReactDOM.render(app, document.getElementById('app'));<br/>}</span><span id="2472" class="lt kj hu ka b fv ly lv l lw lx">export default app;</span></pre><blockquote class="ir is it"><p id="1e01" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><code class="eh jx jy jz ka b"><a class="ae jt" href="https://github.com/gajus/isomorphic-webpack#how-to-differentiate-between-nodejs-and-browser-environment" rel="noopener ugc nofollow" target="_blank">ISOMORPHIC_WEBPACK</a></code>是用来区分Node.js和浏览器环境的常数。常数的存在表明它是Node.js环境。</p></blockquote><p id="807e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">服务器端脚本需要初始化<code class="eh jx jy jz ka b">createIsomorphicWebpack</code>编译器，并使用<code class="eh jx jy jz ka b">react-dom/server</code> <code class="eh jx jy jz ka b">renderToString</code>来呈现应用程序的内容:</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="dd72" class="lt kj hu ka b fv lu lv l lw lx">import express from 'express';<br/>import webpack from 'webpack';<br/>import webpackDevMiddleware from 'webpack-dev-middleware';<br/>import {<br/>  renderToString<br/>} from 'react-dom/server';<br/>import {<br/>  createIsomorphicWebpack<br/>} from 'isomorphic-webpack';<br/>import webpackConfiguration from '../webpack.configuration';</span><span id="ff8f" class="lt kj hu ka b fv ly lv l lw lx">const compiler = webpack(webpackConfiguration);</span><span id="2bce" class="lt kj hu ka b fv ly lv l lw lx">createIsomorphicWebpack(webpackConfiguration);</span><span id="3ef7" class="lt kj hu ka b fv ly lv l lw lx">const app = express();</span><span id="fa95" class="lt kj hu ka b fv ly lv l lw lx">app.use(webpackDevMiddleware(compiler, {<br/>  noInfo: false,<br/>  publicPath: '/static',<br/>  quiet: false,<br/>  stats: 'minimal'<br/>}));</span><span id="1009" class="lt kj hu ka b fv ly lv l lw lx">const renderFullPage = (body) =&gt; {<br/>  return `<br/>  &lt;!doctype html&gt;<br/>  &lt;html&gt;<br/>    &lt;head&gt;&lt;/head&gt;<br/>    &lt;body&gt;<br/>      &lt;div id='app'&gt;${body}&lt;/div&gt;</span><span id="8d5c" class="lt kj hu ka b fv ly lv l lw lx">      &lt;script src='/static/app.js'&gt;&lt;/script&gt;<br/>    &lt;/body&gt;<br/>  &lt;/html&gt;<br/>  `;<br/>};</span><span id="6f5e" class="lt kj hu ka b fv ly lv l lw lx">app.get('/', (req, res) =&gt; {<br/>  const appBody = renderToString(require('../app').default);</span><span id="b506" class="lt kj hu ka b fv ly lv l lw lx">  res<br/>    .send(renderFullPage(appBody));<br/>});</span><span id="a054" class="lt kj hu ka b fv ly lv l lw lx">app.listen(8000);</span></pre><p id="1c41" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh jx jy jz ka b">createIsomorphicWebpack</code>覆盖Node.js模块解析系统，即所有引用属于<code class="eh jx jy jz ka b">webpack</code>包的资源的<code class="eh jx jy jz ka b">require()</code>调用将由<code class="eh jx jy jz ka b">isomorphic-webpack</code>处理。</p><p id="41df" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">这使得我们的应用程序同构。发出一个HTTP请求，用呈现的React应用程序进行响应:</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="ce55" class="lt kj hu ka b fv lu lv l lw lx">$ curl <a class="ae jt" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/</a></span><span id="4bcf" class="lt kj hu ka b fv ly lv l lw lx">&lt;!doctype html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;&lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id='app'&gt;<br/>      &lt;div data-reactroot="" data-reactid="1" data-react-checksum="1607472067"&gt;Hello, World!&lt;/div&gt;<br/>    &lt;/div&gt;</span><span id="49ff" class="lt kj hu ka b fv ly lv l lw lx">&lt;script src='/static/app.js'&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="ll lm ln lo fq mt fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/b7e28c95a0e740446f1ac9a4d8480bfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/1*Ko3-2SutuDi-ov-zEQYGbg.gif"/></div><figcaption class="mw mx fg fe ff my mz bd b be z ek">Free isomorphism.</figcaption></figure><p id="90ec" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">如果您只想签出代码，请使用以下命令:</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="6be1" class="lt kj hu ka b fv lu lv l lw lx">$ git reset --hard 4fb6c11d488405a7c9b7f5a7cda4abec2396be00<br/>$ npm install<br/>$ npm start</span></pre><h1 id="8d82" class="ki kj hu bd kk kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf dt translated">使用Webpack加载器</h1><blockquote class="ir is it"><p id="414e" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">加载器允许您在<code class="eh jx jy jz ka b">require()</code>或“加载”文件时对其进行预处理。[..]loader可以将文件从不同的语言转换成JavaScript，或者将内嵌图像转换成数据URL。加载器甚至允许你在你的JavaScript中做像require() css文件这样的事情！</p></blockquote><p id="dea5" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">–<a class="ae jt" href="https://webpack.github.io/docs/loaders.html" rel="noopener ugc nofollow" target="_blank">https://webpack.github.io/docs/loaders.html</a></p><p id="3246" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">出于演示的目的，我将展示如何使用<code class="eh jx jy jz ka b">style-loader</code>和<code class="eh jx jy jz ka b">css-loader</code>。</p><p id="b529" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">首先，我们需要更新我们的webpack配置。</p><p id="ab3e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh jx jy jz ka b">/src/webpack.config.js</code></p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="9b4f" class="lt kj hu ka b fv lu lv l lw lx">import path from 'path';</span><span id="a5f2" class="lt kj hu ka b fv ly lv l lw lx">export default {<br/>  context: __dirname,<br/>  entry: {<br/>    app: [<br/>      path.resolve(__dirname, './app')<br/>    ]<br/>  },<br/>  module: {<br/>    loaders: [<br/>      {<br/>        include: path.resolve(__dirname, './app'),<br/>        loader: 'babel-loader',<br/>        test: /\.js$/<br/>      },<br/>      {<br/>        loaders: [<br/>          {<br/>            loader: 'style-loader',<br/>            query: {<br/>              sourceMap: 1<br/>            }<br/>          },<br/>          {<br/>            loader: 'css-loader',<br/>            query: {<br/>              importLoaders: 1,<br/>              localIdentName: '[path]___[name]___[local]',<br/>              modules: 1<br/>            }<br/>          }<br/>        ],<br/>        test: /\.css$/<br/>      }<br/>    ]<br/>  },<br/>  output: {<br/>    filename: '[name].js',<br/>    path: path.resolve(__dirname, './dist')<br/>  }<br/>};</span></pre><blockquote class="ir is it"><p id="f986" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">注:以上配置没有什么<code class="eh jx jy jz ka b">isomorphic-webpack</code>具体的。我包括配置只是为了示例的完整性。</p></blockquote><p id="3c74" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">接下来，创建一个样式表。</p><p id="0e6a" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh jx jy jz ka b">/src/app/style.css</code></p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="6831" class="lt kj hu ka b fv lu lv l lw lx">.greetings {<br/>  color: #f00;<br/>}</span></pre><p id="0925" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">更新应用程序以使用样式表:</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="9f64" class="lt kj hu ka b fv lu lv l lw lx">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import style from './style.css';</span><span id="7a42" class="lt kj hu ka b fv ly lv l lw lx">const app = &lt;div className={style.greetings}&gt;Hello, World!&lt;/div&gt;;</span><span id="2b47" class="lt kj hu ka b fv ly lv l lw lx">if (typeof ISOMORPHIC_WEBPACK === 'undefined') {<br/>  ReactDOM.render(app, document.getElementById('app'));<br/>}</span><span id="024d" class="lt kj hu ka b fv ly lv l lw lx">export default app;</span></pre><p id="316e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">最后，重启应用程序并发出HTTP请求。</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="5ef6" class="lt kj hu ka b fv lu lv l lw lx">$ curl <a class="ae jt" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/</a></span><span id="e96c" class="lt kj hu ka b fv ly lv l lw lx">&lt;!doctype html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;&lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id='app'&gt;<br/>      &lt;div class="app-___style___greetings" data-reactroot="" data-reactid="1" data-react-checksum="72097819"&gt;Hello, World!&lt;/div&gt;<br/>    &lt;/div&gt;</span><span id="fbaa" class="lt kj hu ka b fv ly lv l lw lx">    &lt;script src='/static/app.js'&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="658b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">如您所见，服务器用属性<code class="eh jx jy jz ka b">class</code>的评估值<code class="eh jx jy jz ka b">app-___style___greetings</code>进行响应。</p><p id="20b5" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">如果你觉得在这一部分没有学到任何新东西，那是因为没有任何具体的东西。配置或应用没有<code class="eh jx jy jz ka b">isomorphic-webpack</code>具体变化。这是一个真正通用的代码库。</p><figure class="ll lm ln lo fq mt fe ff paragraph-image"><div class="fe ff na"><img src="../Images/970a8ed0f1c86ca6870a07c4d6a8411f.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*uGJG9zGLl_uZNhFUX9bfDA.gif"/></div><figcaption class="mw mx fg fe ff my mz bd b be z ek">You just won all the loaders!</figcaption></figure><p id="4b34" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">如果您只想签出代码，请使用以下命令:</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="ad16" class="lt kj hu ka b fv lu lv l lw lx">$ git reset --hard 90d6e2708719a1727f2f8afd06f8b47432707b88<br/>$ npm install<br/>$ npm start</span></pre><h1 id="1d9c" class="ki kj hu bd kk kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf dt translated">路线</h1><blockquote class="ir is it"><p id="97a6" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">本节描述了一个实验性的实现。我没有在生产中测试过这个。小心行事。不过，还是挺酷的。</p></blockquote><p id="642c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">文档中已经包含了关于<a class="ae jt" href="https://github.com/ReactTraining/react-router/blob/master/docs/guides/ServerRendering.md" rel="noopener ugc nofollow" target="_blank">服务器渲染</a>的部分。您可以遵循这条路径……(但它需要编写服务器端特定的代码)或者您可以欺骗<code class="eh jx jy jz ka b">react-router</code>认为脚本正在浏览器中运行，并避免对您的应用程序进行任何更改。</p><p id="e240" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">默认情况下，<code class="eh jx jy jz ka b">createIsomorphicWebpack</code>不评估<code class="eh jx jy jz ka b">node_modules</code>目录中的脚本。这样做是出于性能原因:很少有脚本依赖于浏览器环境。然而，<code class="eh jx jy jz ka b">react-router </code>(和<code class="eh jx jy jz ka b">history</code>)确实依赖于浏览器环境。</p><p id="84a8" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">我将告诉<code class="eh jx jy jz ka b">createIsomorphicWebpack</code>评估<code class="eh jx jy jz ka b">react-router</code>(和<code class="eh jx jy jz ka b">history</code>)，就像它在浏览器中运行一样。这是使用<code class="eh jx jy jz ka b">nodeExternalsWhitelist</code>配置完成的。</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="5821" class="lt kj hu ka b fv lu lv l lw lx">createIsomorphicWebpack(webpackConfiguration, {<br/>  nodeExternalsWhitelist: [<br/>    /^react\-router/,<br/>    /^history/<br/>  ]<br/>});</span></pre><p id="48eb" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">现在<code class="eh jx jy jz ka b">react-router</code>和<code class="eh jx jy jz ka b">history</code>包包含在webpack包中，并将使用仿浏览器环境执行。</p><p id="93b0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">然而，我们还没有完成。在评估代码时，我们需要知道什么是<code class="eh jx jy jz ka b">window</code> URL。可以使用<code class="eh jx jy jz ka b">evalCode</code>函数(<code class="eh jx jy jz ka b">evalCode</code>是<code class="eh jx jy jz ka b">createIsomorphicWebpack</code>结果的一个属性)来评估包代码，例如</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="d9cc" class="lt kj hu ka b fv lu lv l lw lx">const {<br/>  evalCode<br/>} = createIsomorphicWebpack(webpackConfiguration, {<br/>  nodeExternalsWhitelist: [<br/>    /^react\-router/,<br/>    /^history/<br/>  ]<br/>});</span><span id="d4f2" class="lt kj hu ka b fv ly lv l lw lx">app.get('/*', (req, res) =&gt; {<br/>  evalCode(req.protocol + '://' + req.get('host') + req.originalUrl);<br/>  const appBody = renderToString(require('../app').default);<br/>  res.send(renderFullPage(appBody));<br/>});</span></pre><p id="bd27" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">现在，让我们提出一些要求:</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="e40f" class="lt kj hu ka b fv lu lv l lw lx">$ curl <a class="ae jt" href="http://127.0.0.1:8000/hello-world" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/hello-world</a></span><span id="7438" class="lt kj hu ka b fv ly lv l lw lx">&lt;!doctype html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;&lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id='app'&gt;&lt;div class="app-___style___greetings" data-reactroot="" data-reactid="1" data-react-checksum="72097819"&gt;Hello, World!&lt;/div&gt;&lt;/div&gt;</span><span id="a15b" class="lt kj hu ka b fv ly lv l lw lx">&lt;script src='/static/app.js'&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span><span id="5303" class="lt kj hu ka b fv ly lv l lw lx">$ curl <a class="ae jt" href="http://127.0.0.1:8000/hello-magic" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/hello-magic</a></span><span id="e814" class="lt kj hu ka b fv ly lv l lw lx">&lt;!doctype html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;&lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id='app'&gt;&lt;div data-reactroot="" data-reactid="1" data-react-checksum="1580012444"&gt;Hello, Magic!&lt;/div&gt;&lt;/div&gt;</span><span id="cc19" class="lt kj hu ka b fv ly lv l lw lx">&lt;script src='/static/app.js'&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;<br/></span></pre><figure class="ll lm ln lo fq mt fe ff paragraph-image"><div class="fe ff nb"><img src="../Images/2c066ccf74a8428d80886ce49337a10b.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/1*mPUc2fU1VPbW6gjbw1DjeQ.gif"/></div><figcaption class="mw mx fg fe ff my mz bd b be z ek">It takes a magician to know a magician.</figcaption></figure><p id="7fa6" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">如果您只想签出代码，请使用以下命令:</p><pre class="ll lm ln lo fq lp ka lq lr aw ls dt"><span id="41b7" class="lt kj hu ka b fv lu lv l lw lx">$ git reset --hard 2959593fe217abada30d6ebe2c510e07a477c76b<br/>$ npm install<br/>$ npm start</span></pre><h1 id="1271" class="ki kj hu bd kk kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf dt translated">结论</h1><p id="9544" class="pw-post-body-paragraph iu iv hu ix b iy lg ja jb jc lh je jf ju li ji jj jv lj jm jn jw lk jq jr js hn dt translated">已经有很多文章讨论了服务器端渲染的利弊(例如<a class="ae jt" href="http://tomdale.net/2015/02/youre-missing-the-point-of-server-side-rendered-javascript-apps/" rel="noopener ugc nofollow" target="_blank">你忽略了服务器端渲染JavaScript应用</a>)。在我的具体案例中，我需要服务器端渲染来支持边缘包含(ESI)。我通过首先编写客户端应用程序，然后使用<a class="ae jt" href="https://github.com/gajus/isomorphic-webpack" rel="noopener ugc nofollow" target="_blank">同构webpack </a>来呈现服务器端应用程序，实现了这一点。</p><p id="d534" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">评估服务器端呈现的利弊，如果利大于弊，那么考虑使用同构webpack使您的应用程序呈现服务器端。</p><h1 id="4aa7" class="ki kj hu bd kk kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf dt translated">接下来去哪里？</h1><ul class=""><li id="f790" class="me mf hu ix b iy lg jc lh ju nc jv nd jw ne js nf mk ml mm dt translated">拉动<a class="ae jt" href="https://github.com/gajus/isomorphic-webpack-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/gajus/isomorphic-webpack-demo</a></li><li id="215d" class="me mf hu ix b iy mn jc mo ju mp jv mq jw mr js nf mk ml mm dt translated">阅读 <code class="eh jx jy jz ka b"><a class="ae jt" href="https://github.com/gajus/isomorphic-webpack#isomorphic-webpack-faq" rel="noopener ugc nofollow" target="_blank">isomorphic-webpack</a></code>的<a class="ae jt" href="https://github.com/gajus/isomorphic-webpack#isomorphic-webpack-faq" rel="noopener ugc nofollow" target="_blank">常见问题解答。有一些有用的提示，比如当<code class="eh jx jy jz ka b">isomorphic-webpack</code>没有完成编译时，如何停止HTTP请求处理。</a></li></ul><div class="ll lm ln lo fq ab cb"><figure class="ng mt nh ni nj nk nl paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ng mt nh ni nj nk nl paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ng mt nh ni nj nk nl paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ir is it"><p id="f922" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><a class="ae jt" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是AMI家庭的一员。我们现在<a class="ae jt" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jt" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jt" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jt" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ll lm ln lo fq mt fe ff paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="fe ff nm"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>