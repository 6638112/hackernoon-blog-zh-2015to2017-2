<html>
<head>
<title>How people talk about marijuana on Reddit: a natural language analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">人们如何在Reddit上谈论大麻:自然语言分析</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-people-talk-about-marijuana-on-reddit-a-natural-language-analysis-a8d595882a7a?source=collection_archive---------1-----------------------#2017-04-20">https://medium.com/hackernoon/how-people-talk-about-marijuana-on-reddit-a-natural-language-analysis-a8d595882a7a?source=collection_archive---------1-----------------------#2017-04-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0b13" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了纪念今天是4月20日<a class="ae jp" href="https://en.wikipedia.org/wiki/420_(cannabis_culture)" rel="noopener ugc nofollow" target="_blank">，我觉得在Reddit上做一些关于大麻的NLP评论会很有趣(为这个想法向</a><a class="ae jp" href="https://twitter.com/yufengg?lang=en" rel="noopener ugc nofollow" target="_blank">国玉峰</a>大声喊出来！).我的队友<a class="jq jr gr" href="https://medium.com/u/279fe54c149a?source=post_page-----a8d595882a7a--------------------------------" rel="noopener" target="_blank"> Felipe Hoffa </a>已经方便地让<a class="ae jp" href="https://bigquery.cloud.google.com/dataset/fh-bigquery:reddit_comments?pli=1" rel="noopener ugc nofollow" target="_blank">所有Reddit评论在BigQuery </a>中可用，所以我提取了这些评论的子集，并通过谷歌的<a class="ae jp" href="https://cloud.google.com/natural-language/" rel="noopener ugc nofollow" target="_blank">自然语言API </a>运行它们。</p><h1 id="f1e0" class="js jt hu bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dt translated">评论数据</h1><ul class=""><li id="a1bf" class="kq kr hu it b iu ks iy kt jc ku jg kv jk kw jo kx ky kz la dt translated">我只看了2016年11月表格中的评论，因为在那段时间通过了许多大麻立法</li><li id="8ce5" class="kq kr hu it b iu lb iy lc jc ld jg le jk lf jo kx ky kz la dt translated">在2016年11月的7100万条评论中<strong class="it hv">，49717条评论(. 07%)包含“大麻”或“大麻”字样</strong>。</li><li id="8f83" class="kq kr hu it b iu lb iy lc jc ld jg le jk lf jo kx ky kz la dt translated">为了质量控制，我只查看Reddit评分&gt; 100的评论。我还将数据集缩小到英文评论。这样，我只剩下<strong class="it hv"> 12，789条评论来分析</strong>。以下是我的BigQuery模式:</li></ul><figure class="lh li lj lk fq ll fe ff paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="fe ff lg"><img src="../Images/7275a279986de93f8867e57b45dba9c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NtTL1NxwQZ2UcYTtXo-quw.png"/></div></div></figure><h1 id="730b" class="js jt hu bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dt translated"><strong class="ak">2016年11月日评论数</strong></h1><p id="691b" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">整个11月与大麻相关的评论量是什么样的？</p><figure class="lh li lj lk fq ll"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="2eee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们看到围绕选举的评论数量激增，这是有道理的:七个州在2016年选举期间改变了大麻法律。</p><h1 id="3eb4" class="js jt hu bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dt translated">人们在谈论大麻时会用什么形容词？</h1><p id="270e" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">自然语言API的语法分析方法告诉我们一个句子中每个单词的词性，这使得获取这些注释中使用的所有形容词变得很容易。哪些形容词最常与“大麻”和“大麻”连用？</p><figure class="lh li lj lk fq ll"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="0e5c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我还想知道一个月中每天使用的最常用的形容词是否会发生变化。利用BigQuery便利的分区功能，我用这个查询找到了每天使用最多的三个形容词:</p><pre class="lh li lj lk fq lx ly lz ma aw mb dt"><span id="608c" class="mc jt hu ly b fv md me l mf mg">SELECT * FROM (<br/>  SELECT day, adjective, count(*) c, <br/>  row_number() over(partition by day order by count(*) desc) seqnum<br/>  FROM `sara-bigquery.reddit_pot_nlp.adj_day`<br/>  GROUP BY 1, 2<br/>  ORDER BY day, c desc<br/>)<br/>WHERE seqnum &lt;= 3<br/>ORDER BY day</span></pre><p id="cfb6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是从11月5日到10日的输出片段(第4列是一个单词的提及次数，最后一列是上面查询中的<code class="eh mh mi mj ly b">seqnum</code>):</p><figure class="lh li lj lk fq ll fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/db343649783ed8a71d9b4ae1edfcf28f.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*E6gn6_e7fj6sDbNJXutxIQ.png"/></div></figure><p id="86b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以看到，“好”、“更多”、“其他”和“法律”是整个月份词汇的一部分，但在选举期间，形容词“医疗”和“娱乐”开始发挥作用。</p><h1 id="5ff4" class="js jt hu bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dt translated">人们在谈论大麻的时候还会谈论些什么？</h1><p id="9e69" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">自然语言API的<a class="ae jp" href="https://cloud.google.com/natural-language/docs/reference/rest/v1/documents/analyzeEntities" rel="noopener ugc nofollow" target="_blank"> analyzeEntities </a>端点可以告诉我们！它将从我们的文本中提取任何已知的实体，以及它们的维基百科URL(如果存在的话)。以下是Reddit上最常见的与大麻相关的实体:</p><figure class="lh li lj lk fq ll"><div class="bz el l di"><div class="lv lw l"/></div></figure><h1 id="ff16" class="js jt hu bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dt translated">开始使用您自己的文本</h1><p id="766b" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">想在与大麻无关的文本上做这种事情吗？那也很酷。这种NL分析可以应用于任何类型的文本——新闻文章、客户服务反馈、语音转录等等。</p><p id="1128" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以用你自己的文本直接在浏览器中尝试自然语言API <a class="ae jp" href="https://cloud.google.com/natural-language/" rel="noopener ugc nofollow" target="_blank">。例如，下面是我上面的数据集中的一个注释的语法注释结果:</a></p><figure class="lh li lj lk fq ll fe ff paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="fe ff ml"><img src="../Images/b4c249476ff78d6d8d739d851f8f7d51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hco0POT1Ypiiz1wBnDu2CA.png"/></div></div></figure><p id="fbdf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您想遵循我在本分析中使用的方法，以下是步骤:</p><ul class=""><li id="85cd" class="kq kr hu it b iu iv iy iz jc mm jg mn jk mo jo kx ky kz la dt translated">从BigQuery获取您想要分析的<a class="ae jp" href="https://bigquery.cloud.google.com/dataset/fh-bigquery:reddit_comments?pli=1" rel="noopener ugc nofollow" target="_blank"> Reddit数据</a>。将结果作为JSON下载到本地文件</li><li id="ffbd" class="kq kr hu it b iu lb iy lc jc ld jg le jk lf jo kx ky kz la dt translated">从本地文件读取，将文本发送到NL API，并将NL输出写入一个单独的文件。你可以用你最喜欢的语言做到这一点，我在这里用了Node.js — <a class="ae jp" href="https://gist.github.com/sararob/b0b299cad9c1aa7558cedbdf95fad65f" rel="noopener ugc nofollow" target="_blank">代码</a>。</li><li id="1dec" class="kq kr hu it b iu lb iy lc jc ld jg le jk lf jo kx ky kz la dt translated">将您的换行符分隔的JSON文件上传到BigQuery，它可以自动检测模式:</li></ul><figure class="lh li lj lk fq ll fe ff paragraph-image"><div class="fe ff mp"><img src="../Images/1c8212f931796f8db2809de49dff0ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*vUrPMLeu0eYB8UXC_JMK_Q.png"/></div></figure><p id="8929" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">前进，处理你的文本！</p><h1 id="d614" class="js jt hu bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dt translated"><strong class="ak">额外:使用单词嵌入训练自定义文本模型</strong></h1><p id="54a3" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">机器学习API非常神奇，因为它们获取你的数据，并向你返回关于它的详细信息——所有这些都不需要你思考引擎盖下发生了什么。</p><p id="f0db" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以把它想象成订购糕点:你付钱，面包店给你一块巧克力曲奇。这将导致一个美味的饼干很多时候，但有时你可能会决定你想添加白巧克力片或太妃糖位到您的饼干。在这种情况下，你将不得不<em class="mq">定制</em>它，这可能包括自己制作它，即使它可能会破坏一些魔力。当你克服了这种恐惧之后，你可以使用别人写的食谱(BYO配料),或者过危险的生活，写你自己的食谱。</p><p id="e319" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">机器学习相当于从零开始制作你的cookie，是用你自己的数据建立和训练一个模型。我最近开始通过查看<a class="ae jp" href="https://code.google.com/archive/p/word2vec/" rel="noopener ugc nofollow" target="_blank"> word2vec </a>来探索机器学习的这一方面:一个用于学习数据集中单词之间关系的模型。顾名思义，它将单词作为输入，输出<em class="mq">单词向量</em>:一组文本中一个单词的向量表示。</p><p id="c5a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用GitHub 和本教程上的word2vec <a class="ae jp" href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/tutorials/word2vec/word2vec_basic.py" rel="noopener ugc nofollow" target="_blank">示例，我向模型输入了Reddit评论数据的子集(约55k个单词，8k个唯一单词)，以生成单词嵌入的可视化:</a></p><figure class="lh li lj lk fq ll fe ff paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="fe ff mr"><img src="../Images/a78d458a7459640671d42d35fe92bf93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z5nvF5SUL6QruIbd6uTV-g.png"/></div></div></figure><p id="0d33" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">单词嵌入本质上是通过从大的文本数据集中提取有意义的单词并确定它们之间的语义关系来将单词映射到向量。我们可以在上面的可视化中看到，该模型在将相关单词聚集在一起方面做得非常好:“权利”、“法律”和“合法化”被分组在一起，就像“大麻”和“大麻”一样。</p><p id="d8f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">下一步？我可以使用这个训练好的模型来预测评论的主题或者生成新的评论。我刚开始做定制款，所以很想听听大家的反馈和建议！请发表评论或在Twitter上找到我。</strong></p><h1 id="2e16" class="js jt hu bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dt translated">想做更多的大麻分析？</h1><p id="c41b" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">我的同事艾伦·戴(Allen Day)在BigQuery上发布了1000种大麻的基因组数据。<a class="ae jp" rel="noopener" href="/google-cloud/dna-sequencing-of-1000-cannabis-strains-publicly-available-in-google-bigquery-a33430d63998">详情在此</a>，或者前往BigQuery查看<a class="ae jp" href="https://bigquery.cloud.google.com/dataset/bigquery-public-data:genomics_cannabis" rel="noopener ugc nofollow" target="_blank">公共数据集</a>。</p><div class="lh li lj lk fq ab cb"><figure class="ms ll mt mu mv mw mx paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ms ll mt mu mv mw mx paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ms ll mt mu mv mw mx paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="my mz na"><p id="f922" class="ir is mq it b iu iv iw ix iy iz ja jb nb jd je jf nc jh ji jj nd jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is mq it b iu iv iw ix iy iz ja jb nb jd je jf nc jh ji jj nd jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lh li lj lk fq ll fe ff paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="fe ff ne"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>