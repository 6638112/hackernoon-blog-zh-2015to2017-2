<html>
<head>
<title>Streamlining the management of AWS Marketplace AMIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简化AWS市场ami的管理</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/streamlining-the-management-of-aws-marketplace-amis-1f2200d7fe58?source=collection_archive---------18-----------------------#2017-05-15">https://medium.com/hackernoon/streamlining-the-management-of-aws-marketplace-amis-1f2200d7fe58?source=collection_archive---------18-----------------------#2017-05-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/49755735d057a1f7e7d991ea6e27adcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZeYn3i9uoG0yFYa3x8QPQ.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">The slippy game of AMI management! <em class="jg">(credit: </em><a class="ae jh" href="https://unsplash.com/collections/501656/the-glories-of-man-is-only-fulfilled-by-utter-abandonment" rel="noopener ugc nofollow" target="_blank"><em class="jg">Unsplash</em></a><em class="jg">)</em></figcaption></figure><p id="6a3b" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">AWS市场实际上是我们发布<a class="ae jh" href="https://predicsis.ai/#product" rel="noopener ugc nofollow" target="_blank">预测的商店。对于我们的用户来说，这是一种非常方便的方式，可以在几分钟内部署产品。事实上，AWS市场的简单性是PredicSis.ai也从中受益的一个关键特性。我们相信，我们的用户应该在几分钟内而不是几个月内获得他们的第一次预测洞察力，这也是他们可以在没有任何配置的情况下立即配置它的关键。</a></p><p id="ce05" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">截至今天<a class="ae jh" href="https://aws.amazon.com/marketplace/search/results?page=1&amp;filters=pricing_plan_attributes&amp;pricing_plan_attributes=HOURLY&amp;searchTerms=predicsis" rel="noopener ugc nofollow" target="_blank">基于亚马逊机器镜像<strong class="jk hv"> </strong> (AMI)的产品</a>有两个版本。创建AMI并将其提交给AWS marketplace以发布新产品是一个相当简单的过程。困难的部分是自动化生产这些ami。一旦你实现了这种自动化，你就会面临第二个问题:我如何跟踪这些ami？</p><p id="a2a9" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">AMI版本控制是这里的关键。在深入研究版本管理之前，我想简单解释一下PredicSis.ai的ami是如何构建的。显然，我们不会通过AWS web控制台手动创建ami。PredicSis.ai基于微服务架构[1]，其中每个微服务都有自己的Git存储库。每一个推送到其中一个存储库的新提交都会触发一个由<a class="ae jh" href="https://aws.amazon.com/fr/codepipeline/" rel="noopener ugc nofollow" target="_blank"> AWS代码管道</a>处理的新构建。管道的最后一步是用封隔器建造<a class="ae jh" href="https://www.packer.io/" rel="noopener ugc nofollow" target="_blank"> AMI。你可以想象，我们最终会有一个很长的ami列表😏</a></p><p id="5200" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">AWS管理控制台是一个很棒的<a class="ae jh" href="https://hackernoon.com/tagged/tool" rel="noopener ugc nofollow" target="_blank">工具</a>，但它并不是为将生产就绪的ami推向AWS市场而设计的。Grégoire，我们了不起的DevOps，已经开始开发一个叫做<a class="ae jh" href="https://github.com/wnkz/shipami" rel="noopener ugc nofollow" target="_blank"> ShipAMI </a>的工具，它最初只列出AMI。经过几次迭代之后，它现在使我们能够安全快速地与AWS Marketplace帐户共享正确的AMI。</p><p id="e3f1" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><a class="ae jh" href="https://github.com/wnkz/shipami" rel="noopener ugc nofollow" target="_blank"> ShipAMI </a>是一个类似于<a class="ae jh" href="http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a>的命令行工具。</p><p id="0e2f" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">这里有一个简单的工作流程，演示了我们如何使用ShipAMI。</p><p id="f848" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><strong class="jk hv">选择一个AMI并“释放”它</strong></p><p id="ce63" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">PredicSis.ai的每个主要版本都是由CodePipeline自动构建的。我们以3.6版本为例。</p><pre class="kg kh ki kj fq kk kl km kn aw ko dt"><span id="d99f" class="kp kq hu kl b fv kr ks l kt ku">[~]$ shipami <strong class="kl hv">list</strong></span></pre><figure class="kg kh ki kj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kv"><img src="../Images/6e6c925f350ba0741bb553b839fdf0f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e-H5wshxrCEizUU2xMjN8Q.png"/></div></div></figure><p id="dee8" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">ami_id <em class="kw"> ami-b5eae5d3 </em>是该版本的最新版本，经过一些严格的测试后，我们决定在3.6.1版本下发布。</p><pre class="kg kh ki kj fq kk kl km kn aw ko dt"><span id="2213" class="kp kq hu kl b fv kr ks l kt ku">[~]$ shipami <strong class="kl hv">release</strong> ami-b5eae5d3 3.6.1 --name prds-ai<br/>ami-16ebe570</span></pre><p id="f9e9" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">这个新创建的AMI，<em class="kw"> ami-16ebe570 </em>，将被发送到AWS市场。</p><p id="af20" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><strong class="jk hv">“复制”发布AMI到us-east-1地区</strong></p><pre class="kg kh ki kj fq kk kl km kn aw ko dt"><span id="67e2" class="kp kq hu kl b fv kr ks l kt ku">[~]$ shipami --region us-east-1 <strong class="kl hv">copy</strong> ami-16ebe570 --source-region eu-west-1<br/>ami-93116085</span></pre><p id="4497" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><strong class="jk hv">“分享”AWS Marketplace帐户上的AMI</strong></p><p id="06bc" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">成功复制AMI后，您可以将其共享到AWS Marketplace帐户。同样，ShipAMI提供了一种简单的方法:</p><pre class="kg kh ki kj fq kk kl km kn aw ko dt"><span id="e558" class="kp kq hu kl b fv kr ks l kt ku">[~]$ shipami — region us-east-1 <strong class="kl hv">share</strong> ami-93116085</span></pre><p id="43c5" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">默认情况下，ShipAMI与AWS Marketplace帐户共享AMI。共享AMI现在出现在管理门户上:</p><figure class="kg kh ki kj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kx"><img src="../Images/6a9c152ce9317f7ce562ff3907d1fccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HwrRec1tfBuiAl9LqJTBFw.png"/></div></div></figure><p id="d633" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">任务完成。👏几天之内，你的AMI将出现在AWS市场上。</p><p id="b259" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated"><strong class="jk hv">合成</strong></p><p id="c46d" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">由于我们的全自动构建链，从开发人员提交新的提交到新的AMI准备就绪只需要不到20分钟的时间。对于我们的开发团队来说，这是一个巨大的效率提升。更好的是，由于有了<a class="ae jh" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"> AWS CloudFormation </a>，每个新的AMI都被自动部署到EC2实例。然后，我们的QA团队可以不断地验证新特性或错误修复(当然，他们会在Slack中收到通知😏)</p><p id="dc8b" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果能在评论中看到你的想法和问题，我将不胜感激。不要犹豫，打开ShipAMI的GitHub库！</p><p id="8143" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">巴斯滕</p><p id="40ba" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">[1]如果你对构建基于微服务架构的应用感兴趣，我强烈推荐书<a class="ae jh" href="https://info.thoughtworks.com/building-microservices-book" rel="noopener ugc nofollow" target="_blank">《构建微服务》，作者山姆·纽曼</a>。</p><p id="9445" class="pw-post-body-paragraph ji jj hu jk b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">文章最初发表在我们的博客上<a class="ae jh" href="https://predicsis.ai/blog/2017/4/12/streamlining-the-management-of-aws-marketplace-amis" rel="noopener ugc nofollow" target="_blank"/></p><figure class="kg kh ki kj fq iv"><div class="bz el l di"><div class="ky kz l"/></div></figure></div></div>    
</body>
</html>