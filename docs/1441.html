<html>
<head>
<title>Get access to raw profiling results with plugins for Pury</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pury插件访问原始分析结果</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/get-access-to-raw-profiling-results-with-plugins-for-pury-f9a7cc5e8345?source=collection_archive---------2-----------------------#2016-10-28">https://medium.com/hackernoon/get-access-to-raw-profiling-results-with-plugins-for-pury-f9a7cc5e8345?source=collection_archive---------2-----------------------#2016-10-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/613c2eef8ccd578188985d68943cb5cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EShCeKS0ZRkzp3YBjNXNiA.jpeg"/></div></div></figure><div class=""/><p id="d681" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从一开始，我设计Pury的方式就是让它可以发展成一个拥有一个内核和多个插件和扩展的系统。这样人们就可以用最合适的方式来定制它。作为迈向这个方向的第一步，我想向大家展示一下<em class="kb">插件</em>。</p><h2 id="5455" class="kc kd if bd ke kf kg kh ki kj kk kl km jn kn ko kp jr kq kr ks jv kt ku kv kw dt translated">自定义插件</h2><p id="000d" class="pw-post-body-paragraph jc jd if je b jf kx jh ji jj ky jl jm jn kz jp jq jr la jt ju jv lb jx jy jz hn dt translated">在以前的版本中，可以改变一个<em class="kb">记录器</em>来利用像Timber这样的库。插件允许更加灵活的定制。它们提供对原始结果的访问，以便以最合适的方式进行处理。例如，比较主分支和特性分支之间的性能可能会很有趣，我有一些想法，但是还没有尝试过。或者将格式更改为JSON，在设备群中运行应用程序，收集结果并与一些脚本进行比较。我一直想实时测量应用程序的性能。所以我用谷歌<a class="ae ka" href="https://hackernoon.com/tagged/google" rel="noopener ugc nofollow" target="_blank">分析进行了一点尝试，并得到了有希望的结果。不是得到标准的Pury输出:</a></p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="9415" class="kc kd if lh b fv ll lm l ln lo">App Start --&gt; 0ms<br/>  Splash Screen --&gt; 5ms<br/>    Splash Load Data --&gt; 37ms<br/>    Splash Load Data &lt;-- 1042ms, execution = 1005ms<br/>  Splash Screen &lt;-- 1042ms, execution = 1037ms<br/>  Main Activity Launch --&gt; 1043ms <br/>    onCreate() --&gt; 1077ms <br/>    onCreate() &lt;-- 1100ms, execution = 23ms<br/>    onStart() --&gt; 1101ms <br/>    onStart() &lt;-- 1131ms, execution = 30ms<br/>  Main Activity Launch &lt;-- 1182ms, execution = 139ms<br/>App Start &lt;-- 1182ms</span></pre><p id="8132" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我将执行时间发送给<a class="ae ka" href="https://developers.google.com/analytics/devguides/collection/android/v4/usertimings" rel="noopener ugc nofollow" target="_blank">谷歌分析计时API </a>，得到了这个:</p><figure class="lc ld le lf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lp"><img src="../Images/51d9305ddeef0fd4a4025b35247cf4dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUvNPN3o4OSj8WtH-qu1FQ.jpeg"/></div></div></figure><p id="3546" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如您所见，我在一个表中获得了所有的执行时间。考虑到<a class="ae ka" href="https://support.google.com/analytics/topic/3123779" rel="noopener ugc nofollow" target="_blank"> GA细分</a>，它可能是一个非常强大的<a class="ae ka" href="https://hackernoon.com/tagged/tool" rel="noopener ugc nofollow" target="_blank">工具</a>来分析不同版本和设备的应用性能。我计划写一篇关于谷歌分析计时API和谷歌分析插件的文章，但同时我想回到Pury插件上来。</p><h2 id="27a0" class="kc kd if bd ke kf kg kh ki kj kk kl km jn kn ko kp jr kq kr ks jv kt ku kv kw dt translated">插件创建</h2><p id="87e2" class="pw-post-body-paragraph jc jd if je b jf kx jh ji jj ky jl jm jn kz jp jq jr la jt ju jv lb jx jy jz hn dt translated">要创建自定义插件，您需要实现<em class="kb">插件</em>接口:</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="f946" class="kc kd if lh b fv ll lm l ln lo">public interface Plugin {<em class="kb"><br/>    </em>void handleResult(ProfileResult result, ProfilerId profilerId);<br/>}</span></pre><p id="537e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在<em class="kb">中，handleResult()插件</em>接收分析结果和产生该结果的分析器的标识符。值得一提的是<em class="kb"> ProfileResult </em>是一个具有4种不同实现的接口。为了简化结果处理，我使用了<a class="ae ka" href="https://en.wikipedia.org/wiki/Visitor_pattern" rel="noopener ugc nofollow" target="_blank">访问者模式</a>，每个结果都有一个方法<em class="kb"> accept(ResultVisitor)。</em>这是<em class="kb"> ResultVisitor </em>界面:</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="3e64" class="kc kd if lh b fv ll lm l ln lo">public interface ResultVisitor {<br/>    void visit(AverageProfileResult averageProfileResult);<br/><br/>    void visit(RootAverageProfileResult rootAverageProfileResult);<br/><br/>    void visit(RootSingleProfileResult rootSingleProfileResult);<br/><br/>    void visit(SingleProfileResult singleProfileResult);<br/>}</span></pre><p id="1663" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">每种结果类型都有一个方法，所以不需要检查或强制转换。希望你会觉得有用。</p><p id="26ab" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当我在编写对<em class="kb">插件的支持时，</em>我认为通过profiler名称过滤输入可能是一个非常常见的用例。所以如果你认为实现<em class="kb">插件</em>并进行过滤的抽象类有用，请在GitHub 上提出一个问题<a class="ae ka" href="https://github.com/NikitaKozlov/Pury" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="cd0e" class="kc kd if bd ke kf kg kh ki kj kk kl km jn kn ko kp jr kq kr ks jv kt ku kv kw dt translated">如何使用插件</h2><p id="d218" class="pw-post-body-paragraph jc jd if je b jf kx jh ji jj ky jl jm jn kz jp jq jr la jt ju jv lb jx jy jz hn dt translated">要动态添加和删除插件，请使用以下方法:</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="a5c2" class="kc kd if lh b fv ll lm l ln lo">public final class Pury {</span><span id="d5ce" class="kc kd if lh b fv lq lm l ln lo">    .... </span><span id="5174" class="kc kd if lh b fv lq lm l ln lo">    public static void addPlugin(String key, Plugin plugin) {}<br/><em class="kb"><br/>    </em>public static void removePlugin(String key) {}</span><span id="4a89" class="kc kd if lh b fv lq lm l ln lo">    ....</span><span id="7206" class="kc kd if lh b fv lq lm l ln lo">}</span></pre><p id="f4cb" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">那两个方法后面都有一个<em class="kb">映射</em>，所以如果添加了两个相同key的插件，第一个就被移除了。</p><h2 id="58a3" class="kc kd if bd ke kf kg kh ki kj kk kl km jn kn ko kp jr kq kr ks jv kt ku kv kw dt translated">日志插件</h2><p id="9af1" class="pw-post-body-paragraph jc jd if je b jf kx jh ji jj ky jl jm jn kz jp jq jr la jt ju jv lb jx jy jz hn dt translated">随着<em class="kb">插件</em>的引入，我决定改变日志工作的方式。所以现在日志只是另一个<em class="kb">插件，</em>仅此而已。要查看代码，请检查<em class="kb"> LoggerPlugin </em>类。</p><p id="03b6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kb"> LoggerPlugin </em>是默认添加的，所以日志记录是开箱即用的。要拆除或更换它，使用钥匙<em class="kb"> Pury。LOGGER _插件。LoggerPlugin </em>使用与之前用于记录结果相同的<em class="kb">记录器</em>。使用<em class="kb"> Pury.setLogger(Logger) </em>方法进行更改。</p><h2 id="2135" class="kc kd if bd ke kf kg kh ki kj kk kl km jn kn ko kp jr kq kr ks jv kt ku kv kw dt translated">结论</h2><p id="a263" class="pw-post-body-paragraph jc jd if je b jf kx jh ji jj ky jl jm jn kz jp jq jr la jt ju jv lb jx jy jz hn dt translated"><em class="kb">插件</em>支持定制和更好地控制报告分析结果。它们给Pury增加了一定程度的灵活性，我希望这是有用的。你可以在GitHub 上找到带有示例<a class="ae ka" href="https://github.com/NikitaKozlov/Pury" rel="noopener ugc nofollow" target="_blank">的代码。</a></p><p id="faeb" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正如我已经提到的，现在我正在与谷歌分析整合Pury。如果你对结果感兴趣，请在Twitter或这里关注我。如果你有关于分析结果还能做什么的想法，请写在评论中或者在Gitter 中写<a class="ae ka" href="https://gitter.im/NikitaKozlov/Pury" rel="noopener ugc nofollow" target="_blank">。</a></p><div class="lc ld le lf fq ab cb"><figure class="lr hw ls lt lu lv lw paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lr hw ls lt lu lv lw paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lr hw ls lt lu lv lw paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="lx ly lz"><p id="f922" class="jc jd kb je b jf jg jh ji jj jk jl jm ma jo jp jq mb js jt ju mc jw jx jy jz hn dt translated"><a class="ae ka" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ka" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ka" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ka" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd kb je b jf jg jh ji jj jk jl jm ma jo jp jq mb js jt ju mc jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ka" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ka" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lc ld le lf fq hw fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff md"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure><figure class="lc ld le lf fq hw"><div class="bz el l di"><div class="me mf l"/></div></figure></div></div>    
</body>
</html>