<html>
<head>
<title>How to install NGINX and HHVM with PHP5-FPM Fallback on Ubuntu 16/14</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Ubuntu 16/14上用PHP5-FPM回退安装NGINX和HHVM</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-install-nginx-and-hhvm-with-php5-fpm-fallback-on-ubuntu-14-04-7faf07225013?source=collection_archive---------8-----------------------#2017-01-19">https://medium.com/hackernoon/how-to-install-nginx-and-hhvm-with-php5-fpm-fallback-on-ubuntu-14-04-7faf07225013?source=collection_archive---------8-----------------------#2017-01-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b48e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本教程中，我将指导你安装<a class="ae jp" href="https://hackernoon.com/tagged/nginx" rel="noopener ugc nofollow" target="_blank"> NGINX </a> stable，HHVM 3.9和<a class="ae jp" href="https://hackernoon.com/tagged/php" rel="noopener ugc nofollow" target="_blank"> PHP </a> 5 FPM。</p><ul class=""><li id="1342" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated"><a class="ae jp" href="https://nginx.org" rel="noopener ugc nofollow" target="_blank"> Nginx </a>是一个很棒的web服务器或反向代理，它的默认配置比Apache 2.4的默认MPM (Prefork)快得多。</li><li id="3ca9" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">HHVM是一个使用JIT(实时)编译方法的虚拟机。</li><li id="e13c" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">PHP-FPM  (FastCGI进程管理器)是一个替代的PHP FastCGI实现，具有一些额外的功能，适用于任何规模的网站，尤其是繁忙的网站。</li></ul><p id="cc20" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一点设置背景:</p><ul class=""><li id="7503" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">用Ubuntu 16/14 LTS清理KVM机器，带有1GB RAM和一个来自<a class="ae jp" href="http://www.vultr.com/?ref=6823526" rel="noopener ugc nofollow" target="_blank"> Vultr </a>的CPU内核(如果捆绑MySQL，小于1GB的RAM会给你带来麻烦)</li><li id="6368" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">Root访问权限(否则您必须执行sudo[命令])</li></ul><p id="4c5a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，Nginx:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="6760" class="kn ko hu kj b fv kp kq l kr ks">add-apt-repository ppa:nginx/stable<br/>apt-get update &amp;&amp; apt-get upgrade<br/>apt-get install nginx</span></pre><p id="b901" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第二，HHVM:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="7ba2" class="kn ko hu kj b fv kp kq l kr ks">apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0x5a16e7281be7a449<br/>add-apt-repository "deb http://dl.hhvm.com/ubuntu $(lsb_release -sc) main"<br/>apt-get update<br/>apt-get install hhvm<br/>update-rc.d hhvm defaults<br/>/usr/bin/update-alternatives --install /usr/bin/php php /usr/bin/hhvm 60<br/>/usr/share/hhvm/install_fastcgi.sh</span></pre><p id="faeb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们想在Unix套接字上运行HHVM，所以让我们编辑它的配置:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="69f1" class="kn ko hu kj b fv kp kq l kr ks">nano /etc/hhvm/server.ini</span></pre><p id="f802" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">用注释“hhvm . server . port = 9000”；并添加“hhvm . server . file _ socket =/var/run/hhvm/hhvm . sock”</p><p id="155b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它应该是这样的:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="c9e3" class="kn ko hu kj b fv kp kq l kr ks">; php options<br/>pid = /var/run/hhvm/pid</span><span id="18ce" class="kn ko hu kj b fv kt kq l kr ks">; hhvm specific<br/>;hhvm.server.port = 9000<br/>hhvm.server.file_socket = /var/run/hhvm/hhvm.sock<br/>hhvm.server.type = fastcgi<br/>hhvm.server.default_document = index.php<br/>hhvm.log.use_log_file = true<br/>hhvm.log.file = /var/log/hhvm/error.log<br/>hhvm.repo.central.path = /var/run/hhvm/hhvm.hhbc</span></pre><p id="81f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">按Ctrl + X保存，然后按“Y”</p><p id="6bdf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在PHP-FPM:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="5b88" class="kn ko hu kj b fv kp kq l kr ks">apt-get install php5-fpm</span></pre><p id="950b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">默认情况下，这会安装FPM并监听/var/run/php5-fpm.sock</p></div><div class="ab cl ku kv hc kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hn ho hp hq hr"><p id="66f8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们安装完毕！让我们现在配置东西。让我们首先为nginx创建一个上游配置文件:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="2b2d" class="kn ko hu kj b fv kp kq l kr ks">nano /etc/nginx/conf.d/upstream.conf</span></pre><p id="f364" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">添加以下内容并保存:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="66d7" class="kn ko hu kj b fv kp kq l kr ks">upstream php {<br/>        server unix:/var/run/hhvm/hhvm.sock;<br/>        server unix:/var/run/php5-fpm.sock backup;<br/>}</span></pre><p id="3a5f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如你所见，PHP-FPM将是一个备份，以防HHVM失败。</p><p id="9c57" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们编辑Nginx的HHVM配置文件:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="86ab" class="kn ko hu kj b fv kp kq l kr ks">nano /etc/nginx/hhvm.confg</span></pre><p id="4dc7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将“fastcgi _ pass 127 . 0 . 0 . 1:9000；”用“fastcgi _ pass php”。它应该是这样的:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="dce7" class="kn ko hu kj b fv kp kq l kr ks">location ~ \.(hh|php)$ {<br/>    fastcgi_keep_conn on;<br/>    fastcgi_pass   php;<br/>    fastcgi_index  index.php;<br/>    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;<br/>    include        fastcgi_params;<br/>}</span></pre><p id="7d0c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用以下命令重新启动服务:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="e83a" class="kn ko hu kj b fv kp kq l kr ks">service hhvm restart &amp;&amp; service php5-fpm restart &amp;&amp; service nginx restart</span></pre><p id="bc3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">测试方式:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="cb57" class="kn ko hu kj b fv kp kq l kr ks">curl -I localhost/test.php</span></pre><p id="176f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">应该是一个404(因为实际的test.php不存在),具有以下标题:</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="0188" class="kn ko hu kj b fv kp kq l kr ks">Server: nginx/1.8.0<br/>X-Powered-By: HHVM/3.9.0</span></pre><p id="8ec4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">仅此而已！我们在fastcgi中有最新的稳定的Nginx和最新的HHVM，还有php-fpm回退！</p><blockquote class="lb lc ld"><p id="4973" class="ir is le it b iu iv iw ix iy iz ja jb lf jd je jf lg jh ji jj lh jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是AMI家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is le it b iu iv iw ix iy iz ja jb lf jd je jf lg jh ji jj lh jl jm jn jo hn dt translated">要了解更多信息，<a class="ae jp" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a> , <a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">喜欢/在脸书给我们发消息</a>，或者简单地，<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank">发推文/DM @HackerNoon。</a></p><p id="708a" class="ir is le it b iu iv iw ix iy iz ja jb lf jd je jf lg jh ji jj lh jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ke kf kg kh fq li"><div class="bz el l di"><div class="lj lk l"/></div></figure></div></div>    
</body>
</html>