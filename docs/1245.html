<html>
<head>
<title>GraphQL Api With Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有Rails的GraphQL Api</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/graphql-api-with-rails-faab252aaffa?source=collection_archive---------0-----------------------#2016-10-01">https://medium.com/hackernoon/graphql-api-with-rails-faab252aaffa?source=collection_archive---------0-----------------------#2016-10-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="870f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Graphql是一项令人敬畏的新技术，它让客户端开发者更容易快速迭代和批量处理网络请求。<br/> <br/>我真的很喜欢GraphQl提供的承诺，但是它不像rest那么容易<br/>立即开始运行。这篇博文<br/>展示了如何使用rails通过几个步骤构建一个工作的GraphQL后端。<br/> <br/>我正在使用我自己的项目<a class="ae jp" href="https://github.com/coldog/graphql-api" rel="noopener ugc nofollow" target="_blank"> graphql-api </a>作为构建graphql后端的框架。我们将看看如何构建一个基本的博客应用程序。一个博客会有一个作者和一些标签。</p><p id="8242" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先创建rails后端。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="cd62" class="jz ka hu jv b fv kb kc l kd ke">rails new blog-api --api</span></pre><p id="7285" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将必要的库添加到gem文件中</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="c5a3" class="jz ka hu jv b fv kb kc l kd ke">gem 'graphql'<br/>gem 'graphql-api'</span></pre><p id="402d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">创建我们的模型</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="a888" class="jz ka hu jv b fv kb kc l kd ke">rails g model Author name:string<br/>rails g model Blog title:string content:text author:references<br/>rails db:migrate</span></pre><p id="5e92" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">添加我们的与author类有许多关系</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="0458" class="jz ka hu jv b fv kb kc l kd ke">class Author<br/>  has_many :blogs<br/>end</span></pre><p id="537b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">太好了！现在我们有了博客后端的基本设置。让我们添加一些<br/>控制器来服务基本的Graphql查询。<br/> <br/>将以下文件添加到<strong class="it hv"><em class="kf">app/controllers/graph QL _ controller . Rb</em></strong>中。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="fa31" class="jz ka hu jv b fv kb kc l kd ke">class GraphqlController &lt; ApplicationController<br/>  SCHEMA = GraphQL::Api::Schema.new.schema</span><span id="d8b8" class="jz ka hu jv b fv kg kc l kd ke">  def create<br/>    render json: SCHEMA.execute(<br/>      params[:query], <br/>      variables: params[:variables] || {},<br/>    )<br/>  end<br/><br/>end</span></pre><p id="c1d1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将以下路线添加到<strong class="it hv"><em class="kf">config/routes . Rb</em></strong></p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="3f48" class="jz ka hu jv b fv kb kc l kd ke">resources :graphql, only: :create</span></pre><p id="4d41" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们用curl测试新的api。启动服务器并运行下面的<br/>命令，看看我们是否有博客文章</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="69ec" class="jz ka hu jv b fv kb kc l kd ke">curl -XPOST -d 'query=query { blogs { id } }' \<br/>     localhost:3000/graphql</span><span id="afd4" class="jz ka hu jv b fv kg kc l kd ke">{"data":{"blogs":[]}}</span></pre><p id="8410" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们创建一个作者</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="5757" class="jz ka hu jv b fv kb kc l kd ke">curl -XPOST \<br/>  -d 'query=mutation { <br/>         createAuthor(input: {name: "foobar"}) { <br/>            author { id } <br/>     }}' localhost:3000/graphql</span><span id="727f" class="jz ka hu jv b fv kg kc l kd ke">{"data":{"createAuthor":{"author":{"id":1}}}}</span></pre><p id="1239" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们用作者的id创建一个博客</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="4faa" class="jz ka hu jv b fv kb kc l kd ke">curl -XPOST \<br/>  -d 'query=mutation { <br/>         createBlog(input: {title: "foobar", author_id: 1}) { <br/>             blog { id } <br/>      }}' localhost:3000/graphql</span><span id="ea2f" class="jz ka hu jv b fv kg kc l kd ke">{"data":{"createBlog":{"blog":{"id":1}}}}</span></pre><p id="75bf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们再次尝试第一个查询，但是这次让我们尝试返回博客作者以及博客名称。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="f7e6" class="jz ka hu jv b fv kb kc l kd ke">curl -XPOST -d 'query=query { <br/>        blogs { <br/>          id<br/>          title<br/>          content<br/>          author {<br/>            name<br/>          }<br/>        }<br/>     }' localhost:3000/graphql</span></pre><p id="2e9a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你也可以运行<strong class="it hv"> <em class="kf">更新博客</em> </strong>突变以及<strong class="it hv"> <em class="kf">更新作者</em> </strong>突变。试着删除一个作者或博客，看看你会得到什么回应。</p><blockquote class="kh ki kj"><p id="39c6" class="ir is kf it b iu iv iw ix iy iz ja jb kk jd je jf kl jh ji jj km jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is kf it b iu iv iw ix iy iz ja jb kk jd je jf kl jh ji jj km jl jm jn jo hn dt translated">要了解更多信息，<a class="ae jp" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a>、<a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">赞/在脸书给我们发消息</a>，或者简单地说，<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is kf it b iu iv iw ix iy iz ja jb kk jd je jf kl jh ji jj km jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote></div></div>    
</body>
</html>