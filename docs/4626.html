<html>
<head>
<title>How I made a food recognizing bot for Telegram and why it doesn’t have a future (yet)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何为Telegram制作一个食物识别机器人，为什么它没有未来</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-i-made-a-food-recognizing-bot-for-telegram-and-why-it-doesnt-have-a-future-yet-c97d9c6e249b?source=collection_archive---------6-----------------------#2017-06-11">https://medium.com/hackernoon/how-i-made-a-food-recognizing-bot-for-telegram-and-why-it-doesnt-have-a-future-yet-c97d9c6e249b?source=collection_archive---------6-----------------------#2017-06-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/cfdc320f210b90c116fdf153d8815d47.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*gtur7ND3bY4fBNHLePd0HQ.png"/></div></figure><p id="594d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">认识一下<strong class="ja hv"> @ItadakimasuBot。</strong>他是一个<strong class="ja hv"> </strong>真正的好人，被创造出来帮助你维持你的饮食。他记录下你吃的所有东西，并给你相关的统计数据。</p><p id="a0cb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">但是他很特别——他能从你的照片中认出食物<strong class="ja hv">。你不需要手写下所有的营养信息——他会自己做所有的事情。</strong></p><p id="5df6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><em class="jw">注1:这个项目主要是以学习为目的的，所以它仍然需要大量的工作</em></p><p id="2aaf" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><em class="jw">注2:在文章的第一部分，我将解释是什么让机器人工作，所以如果你对技术部分不感兴趣，跳过它，开始阅读第二部分，在那里我解释了我对机器人现状的看法。</em></p><h2 id="68d9" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">第一部分。@ItadakimasuBot如何工作</h2><figure class="ks kt ku kv fq iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/d03074904deca9c44367f7bd93a41762.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*RflaC4aE31WJY8ZyygHPlA.png"/></div></figure><p id="92d5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> @ItadakimasuBot </strong>是一个针对<strong class="ja hv">电报</strong>(暂时)的Bot，纯<strong class="ja hv"> JavaScript </strong>编写。它将Node.js用于Bot逻辑和统计页面的生成。</p><p id="d6fe" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">为了识别食物，我使用了<strong class="ja hv">clari fai</strong>API——尽管它远非完美(它不能识别品牌食物，例如，士力架和bounty都会被标记为“巧克力棒”)，但它目前已经足够好了，所以我决定不开发自己的系统。</p><p id="01e5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">为了得到营养信息，我找到了两个可能的选择:<strong class="ja hv"> FatSecret </strong>和<strong class="ja hv"> Nutrionix </strong>。它们都支持完整的美国农业部信息，但是FatSecret 支持自定义部分。</p><p id="41b0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我决定继续使用Nutrionix，因为我认为，它的信息更加用户友好。</p><p id="2fbf" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">由于bot没有内置会话，我决定使用<strong class="ja hv"> Redis </strong>来获取中间信息，比如当前bot状态。</p><p id="63bb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">为了保存长期信息，比如食物日志、统计URL和用户信息，我使用了<strong class="ja hv"> Postgres。</strong></p><p id="6135" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">除了机器人，我也有一个服务器来处理显示用户建立的统计数据。它构建于<strong class="ja hv"> Express.js之上。</strong>它实际上非常简单，只管理两个不同的请求——一个返回*。html页面，一个返回数据。</p><p id="ae2f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我没有在前端使用任何花哨的框架，如<strong class="ja hv"> React </strong>或<strong class="ja hv"> Angular </strong>，因为老实说，为一个包含3个图形的页面使用大框架是荒谬的。因此，我只是使用了<strong class="ja hv"> jQuery </strong>(我不想使用它，但因为我选择的DatePicker使用了它，所以我就用了它)，用于图形<strong class="ja hv"> </strong>的<strong class="ja hv"> Chart.js </strong>和用于最小化的<strong class="ja hv"> Webpack </strong>。</p><p id="e619" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">机器人对下一个命令做出反应:</p><p id="1ea1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> /help </strong> —简单地显示一条带有命令列表的消息</p><p id="0525" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">/定额</strong> —显示每日定额并允许更改</p><p id="67b5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">/记录食物名称</strong> —根据名称记录食物</p><p id="1ea8" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> /start </strong> —显示开始消息，为用户设置日常定额，并创建用户对象</p><p id="5285" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> /stats </strong> —生成并发送用户URL以查看统计数据</p><p id="587d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">【图片】</strong> —识别食物并记录</p><p id="ab9b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">为了与用户交流，我决定使用<strong class="ja hv"> InlineKeyboard </strong>，因为<strong class="ja hv"> ReplyKeyboard </strong>(修改后的OS键盘)不允许设置自定义键值，这需要额外使用会话或额外使用API。</p><figure class="ks kt ku kv fq iv fe ff paragraph-image"><div class="fe ff kw"><img src="../Images/f310d07b84a992e6311eb40821c976d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*Ujpui52TJbeqU48oJQ170A.png"/></div><figcaption class="kx ky fg fe ff kz la bd b be z ek">Daily norms input flowchart</figcaption></figure><figure class="ks kt ku kv fq iv fe ff paragraph-image"><div class="fe ff lb"><img src="../Images/05f60fa5b0b3602801b495d31dc1cf01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*D8q2Ce1yLy2Aoanv7f7btg.png"/></div><figcaption class="kx ky fg fe ff kz la bd b be z ek">Food logging flowchart</figcaption></figure><h2 id="ae5d" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">第二部分。为什么机器人没用。暂时如此。</h2><figure class="ks kt ku kv fq iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/5801067c5e70a02b375c9f85b30d3290.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*A5vF7WSdTur5l_7u1Ya0Dg.png"/></div></figure><p id="2c7f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">玩机器人很有趣。你不需要安装独立的应用程序，它们在任何平台上都是一样的。</p><p id="e40a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">开发机器人既容易又有趣。你根本不用担心GUI或者平台。</p><p id="60e1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">但是有几个严重的缺陷。</p><p id="62a7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">第一个问题是，每一个简单的操作，比如营养值的输入，都变得非常笨拙，需要额外的验证——你想让用户每次都验证他们的信息，还是只在最后才验证？但是如果用户不小心从info输入到其中一个字段，他应该重新输入所有内容吗？</p><p id="8463" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">可以通过允许自定义输入法、禁用普通键盘和自定义输入法来解决。</p><p id="4d4c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">截至目前，有两种不同的输入法:<strong class="ja hv"> InlineKeyboard </strong>和<strong class="ja hv"> ReplyKeyboard。他们都有自己的优点，但也有自己的问题。</strong></p><p id="1c7d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">InlineKeyboard 没有隐藏普通的输入框，这需要额外的验证，以防用户输入列表之外的内容。由于InlineKeyboard answer发送InlineQuery而不是普通的消息事件，这个问题得到了一定程度的解决，但是由于旧的InlineKeyboard没有被禁用，它没有完全解决这个问题。</p><p id="c1f9" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> ReplyKeyboard </strong>用于替代普通键盘，并对用户隐藏原稿。然而，原来的QWERTY仍然可以访问。它的另一个问题是，目前不可能用它来发送自定义信息key发送的数据将与它上面的文本完全一样，这将需要额外使用会话或API。</p><figure class="ks kt ku kv fq iv fe ff paragraph-image"><div class="fe ff lc"><img src="../Images/aed0ceea281966d7b8d0369d3e7d269b.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*39ldj7dfSN1HIkNc9EIEOA.png"/></div><figcaption class="kx ky fg fe ff kz la bd b be z ek">Even without entering the nutrition info, a minimum of two validations is required</figcaption></figure><p id="0e05" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">第二个问题是缺乏任何视觉控制。目前，不可能在机器人内部显示图形和表格，只有两种选择:</p><ol class=""><li id="5852" class="ld le hu ja b jb jc jf jg jj lf jn lg jr lh jv li lj lk ll dt translated">在后端生成图形图像。非常糟糕的选择，因为大多数机器人用户使用小屏幕的手机。另外，它删除了大部分图表信息——不可能看到精确的值。</li><li id="2964" class="ld le hu ja b jb lm jf ln jj lo jn lp jr lq jv li lj lk ll dt translated">发送一个URL到包含所有内容的网页。这很有效，但话说回来，我们为什么需要机器人？</li></ol><figure class="ks kt ku kv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff lr"><img src="../Images/81ad2be9cc97132656e1513d7d0e520e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a-9R1DoUPgMmrToMp5zpLA.png"/></div></div><figcaption class="kx ky fg fe ff kz la bd b be z ek">Imagine looking at this on your mobile phone screen</figcaption></figure><p id="e16f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">2017年的机器人与20年前我们在IRC或Jabber中使用的机器人没有太大区别。它们有一个非常光明的未来，但是现在——很难让它们对任何比控制你房子里的灯更复杂的事情变得用户友好。</p><h2 id="6fb4" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">第三部分。将来的</h2><figure class="ks kt ku kv fq iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/ce722388e76324f4ba28c8682f451b26.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*Y8TfyyKvssqVjK66-D3EJg.png"/></div></figure><p id="b915" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">到目前为止，@ItadakimasuBot并不真的打算在日常生活中使用。我在几周内完成了它，作为一名学生(<strong class="ja hv"> <em class="jw">请雇用我</em> </strong>)，我真的不能再为它工作了。</p><p id="cee0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">但如果我愿意，我会:</p><ol class=""><li id="3d6e" class="ld le hu ja b jb jc jf jg jj lf jn lg jr lh jv li lj lk ll dt translated">把它传到Facebook Messenger。</li><li id="ce74" class="ld le hu ja b jb lm jf ln jj lo jn lp jr lq jv li lj lk ll dt translated">制作我自己的食物识别系统和营养数据库</li><li id="fa84" class="ld le hu ja b jb lm jf ln jj lo jn lp jr lq jv li lj lk ll dt translated">添加对不同语言的支持</li><li id="84cd" class="ld le hu ja b jb lm jf ln jj lo jn lp jr lq jv li lj lk ll dt translated">添加对英国/美国单位的支持(我可能会在不久的将来这样做)</li></ol><p id="e1cb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我把它开源了，所以如果有人想对它进行代码审查(作为一个有抱负的程序员，我希望有更有经验的人来审查我的代码！)或者用它做点什么——不客气。</p><p id="44e3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">GitHub:【https://github.com/nausik/ItadakimasuBot T4】</p><p id="aab0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">机器人:<a class="ae lw" href="https://t.me/Itadakimasubot" rel="noopener ugc nofollow" target="_blank">https://t.me/Itadakimasubot</a></p><p id="fc4c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">感谢您的宝贵时间！</p><div class="ks kt ku kv fq ab cb"><figure class="lx iv ly lz ma mb mc paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lx iv ly lz ma mb mc paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lx iv ly lz ma mb mc paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="md me mf"><p id="f922" class="iy iz jw ja b jb jc jd je jf jg jh ji mg jk jl jm mh jo jp jq mi js jt ju jv hn dt translated"><a class="ae lw" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae lw" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae lw" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae lw" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="iy iz jw ja b jb jc jd je jf jg jh ji mg jk jl jm mh jo jp jq mi js jt ju jv hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae lw" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae lw" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ks kt ku kv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff mj"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>