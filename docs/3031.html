<html>
<head>
<title>4 Ways to manage the configuration in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python中管理配置的4种方法</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/4-ways-to-manage-the-configuration-in-python-4623049e841b?source=collection_archive---------0-----------------------#2017-03-08">https://medium.com/hackernoon/4-ways-to-manage-the-configuration-in-python-4623049e841b?source=collection_archive---------0-----------------------#2017-03-08</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><blockquote class="ir is it"><p id="9663" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">我的母语不是英语。抱歉，我的英语不好。请理解。</p></blockquote><p id="a0cd" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在开发服务器应用程序时，您可能会遇到管理配置的问题。当然，这个问题在每个需要配置管理的地方都会遇到，服务器应用程序也是如此。</p><p id="ef59" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">如果你是初学者或者没有配置管理的经验，这可能有点难。特别是，如果你有像数据库信息、AWS凭证这样的秘密值，在开放的VCS(版本控制系统)上管理配置可能是非常危险的，比如Github、Bitbucket。事实上，在某些情况下，由于粗心的配置管理，web应用程序可能会被其他黑客攻击或占用他们的服务器资源，因此会意外地收取大量费用。因此，配置管理，尤其是秘密值管理是一个非常重要的问题。</p><p id="fcab" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在我的例子中，我主要开发服务器应用程序，并为每个项目以不同的方式管理配置。所以，我想向那些不太了解配置管理的人介绍一下我用来帮助他们的方法。</p><p id="ec0e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">我主要在开发服务器应用程序时使用Python，所以我将介绍的这些方法都是在Python中工作的。当然，这些是管理配置的“方法”,所以您也可以在其他语言中使用这些思想。没有任何问题。</p><p id="1729" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在这篇文章中，我将介绍如下4种管理方法。(但是，在这里，我不会谈论基础设施或分布式系统级别的大规模管理。我一会儿再贴)</p><ul class=""><li id="d611" class="jw jx hu ix b iy iz jc jd jt jy ju jz jv ka js kb kc kd ke dt translated">使用内置数据结构</li><li id="3393" class="jw jx hu ix b iy kf jc kg jt kh ju ki jv kj js kb kc kd ke dt translated">使用外部配置文件</li><li id="e3b3" class="jw jx hu ix b iy kf jc kg jt kh ju ki jv kj js kb kc kd ke dt translated">使用环境变量</li><li id="ba3f" class="jw jx hu ix b iy kf jc kg jt kh ju ki jv kj js kb kc kd ke dt translated">使用动态加载</li></ul><p id="5ec4" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">现在就来探索一下吧！</p><h1 id="c5ca" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">使用内置数据结构</h1><p id="7bff" class="pw-post-body-paragraph iu iv hu ix b iy li ja jb jc lj je jf jt lk ji jj ju ll jm jn jv lm jq jr js hn dt translated">这是一种非常简单直观的方法。顾名思义，它使用内置的数据结构来管理配置，基本上，它可以如下使用。</p><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="ls lt l"/></div></figure><p id="fc66" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">然后，看一个稍微复杂一点的案例。例如，如果您是web开发人员，您可能需要为每个开发、测试、生产环境进行不同的配置，因此，您可以按照下面的方法来做。</p><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="ls lt l"/></div></figure><p id="4fc3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">它使用起来简单直观，因为您可以直接从同一个项目中导入配置文件，并按原样使用内置的数据结构。但是，如果您使用的是VCS，您的代码库将会公开，因此，如果存在秘密值，可能会有安全问题。因此，您应该在VCS上使用虚拟数据(非真实数据)而不是真实的秘密数据来保护您免受外部安全攻击。然后，您将自己在生产服务器中用真实的配置值替换虚拟数据，但是，这会很麻烦。有一种稍微高级一点的方法是使用动态加载<strong class="ix hv">，我们将在后面讨论。</strong></p><p id="11d4" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">所以，如果你在配置中没有秘密值，我推荐这种方式。</p><h1 id="5f08" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated"><strong class="ak">使用外部配置文件</strong></h1><p id="4533" class="pw-post-body-paragraph iu iv hu ix b iy li ja jb jc lj je jf jt lk ji jj ju ll jm jn jv lm jq jr js hn dt translated">这种方式加载外部文件中定义的配置值，而不是内置的数据结构。这是一种更通用的方式，因为这种方式将配置视为仅仅是<em class="iw">配置</em>，而不是代码的一部分。让我们看看使用<strong class="ix hv"> ini </strong>和<strong class="ix hv"> json </strong>格式作为配置的基本例子。(注意<code class="eh lu lv lw lx b">configparser</code>是针对Python 3.x的，在Python 2.x中，应该用<code class="eh lu lv lw lx b">ConfigParser</code>代替)</p><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="ls lt l"/></div></figure><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="ls lt l"/></div></figure><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="ls lt l"/></div></figure><p id="d3de" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">也可以使用其他格式比如<strong class="ix hv"> xml，yaml。基本方法是一样的，所以，如果有一种方法可以解析格式，任何格式都可以。</strong></p><p id="5c3c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在这种方法中，配置将从代码中分离出来，所以如果你使用Git，只需要能够从VCS中指定文件来忽略。但是，当配置完全脱离VCS时，您的同事可能无法使用该配置。所以，你可以使用下面的技巧来解决这个问题。</p><p id="80fc" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">假设<strong class="ix hv"> config.json </strong>有真实的配置值。然后创建一个示例配置文件，其名称表明它是一个类似于<strong class="ix hv"> config.json.example. </strong>的示例，您应该在VCS上管理唯一的<strong class="ix hv"> config.json.example </strong>而不是<strong class="ix hv"> config.json </strong>。这允许其他开发人员知道格式并自己操作配置。当然，他们应该用<strong class="ix hv"> config.json </strong>重命名该文件名，以便正确地使用它作为配置。</p><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="ls lt l"/></div></figure><h1 id="343f" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">使用环境变量</h1><p id="d602" class="pw-post-body-paragraph iu iv hu ix b iy li ja jb jc lj je jf jt lk ji jj ju ll jm jn jv lm jq jr js hn dt translated">这种方式不使用文件，而是使用系统环境变量作为配置值。</p><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="ls lt l"/></div></figure><p id="e17d" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">配置值不是作为一个单独的文件来管理的，所以暴露秘密值的风险较小，而且它非常容易使用，可以在codebase中的任何地方使用。</p><p id="1c88" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">但是，当然，最终，您可能不得不使用shell脚本或其他脚本来系统地管理每个环境变量。所以，如果你熟悉系统和脚本，这种方式是适合你的。但是，如果有些环境无法使用环境变量，如Apache、Nginx web服务器，就应该使用其他方法。</p><h1 id="9da8" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">使用动态加载</h1><p id="c31d" class="pw-post-body-paragraph iu iv hu ix b iy li ja jb jc lj je jf jt lk ji jj ju ll jm jn jv lm jq jr js hn dt translated">如上所述，这是一种比使用<strong class="ix hv">内置数据结构</strong>更先进的方法。前一种方式应该导入配置。py文件来自需要使用配置的特定文件，因此，配置文件必须位于可导入的路径上。但是，在这种方法中，配置文件不必位于可导入的路径上，甚至可以位于其他存储库中。</p><p id="e303" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">原理就是这么简单。只是注册和加载配置的路径。py文件。也就是说，见下文。</p><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="ls lt l"/></div></figure><p id="3ecc" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">是的，这似乎非常类似于第一种方式:<strong class="ix hv">使用内置数据结构。</strong>但是，它最大的优点是可以分离配置。项目本身的py文件。所以，这种方式在同时利用第一种和第二种方式的优点，并且想要(或需要)分离配置时是合适的。项目代码库中的py文件。</p><p id="24ca" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">在我的例子中，我使用这种方式独立管理配置存储库和API服务器存储库。API服务器只是通过导入那个文件来使用配置，但是真正的配置值是在其他存储库上管理的。然后，在配置服务器时，我克隆了两个存储库，并使API服务器能够动态地使用配置。</p><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="ls lt l"/></div></figure><p id="cff7" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">通过这样做，您可以在利用第一种方法的优势的同时管理配置，还可以最小化安全风险并更容易地管理配置。此外，特别是，随着配置环境的规模变得越来越大，独立于项目存储库来维护配置将变得更加容易和有效。</p><h1 id="c220" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">结论</h1><p id="2b3b" class="pw-post-body-paragraph iu iv hu ix b iy li ja jb jc lj je jf jt lk ji jj ju ll jm jn jv lm jq jr js hn dt translated">到目前为止，我们已经讨论了4种管理配置的方法。事实上，这取决于你的应用。当然，你可以将它们混合使用，可能会有比这些方法更好的方法。而且，当系统规模非常大时，最好使用主要提供配置管理的第三方工具或服务。</p><p id="ce87" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf jt jh ji jj ju jl jm jn jv jp jq jr js hn dt translated">我希望这篇文章能帮助那些有配置管理问题的人。</p><blockquote class="ir is it"><p id="ff65" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated"><a class="ae ly" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ly" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ly" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ly" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">要了解更多信息，<a class="ae ly" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a>，<a class="ae ly" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上点赞/给我们发消息</a>，或者简单地说，<a class="ae ly" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ly" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ly" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ln lo lp lq fq lr"><div class="bz el l di"><div class="lz lt l"/></div></figure></div></div>    
</body>
</html>