<html>
<head>
<title>A tour of Elixir performance &amp; monitoring tools</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Elixir性能和监控工具之旅</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-tour-of-elixir-performance-monitoring-tools-aac2df726e8c?source=collection_archive---------2-----------------------#2017-02-14">https://medium.com/hackernoon/a-tour-of-elixir-performance-monitoring-tools-aac2df726e8c?source=collection_archive---------2-----------------------#2017-02-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/159bc016b897dd4395a892d5b383c96a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*udY41F3f3goAOLKoEuhhOA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae jg" href="https://www.flickr.com/photos/nasa2explore/10352415865/in/photolist-gLNQyH-axB2m8-fh7uFh-fgSeWX-aYNiur-fh7uKS-cLdGCG-fgSfH6-fh7uoL-7gen7Y-8F6YCW-fgSfEz-7hMmS6-fh7um9-mfmWNX-PKdsT-fh7ufm-7F1c8L-fh7utW-fgSfvK-a5ndVV-9Tt1RW-9xdj52-fbbuD1-aYPr34-6iESHq-dXP2YJ-9thy5Z-9gY15J-nGtCYw-7F96Kp-7DMwnz-7F96et-kwBTxc-fgSfwT-fgSf78-fh7uzS-fgSfJ4-fh7u9Y-fgSfuk-nsTceK-4YDEcH-9MbsEM-hHabGn-fWFsuV-gTzjT2-oE2Vqt-6oCWSV-6oH7Kw-6oH74C" rel="noopener ugc nofollow" target="_blank">NASA Mission Control Room</a></figcaption></figure><p id="be25" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="kf">2017年4月23日更新:AppSignal已经退出测试版，Scout发布了一个测试版代理。</em></p><p id="730f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你正在钻研长生不老药，并且即将发布你的第一个长生不老药应用。您如何在生产中分析和监控它？</p><p id="5bae" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">下面是今天在灵药生态系统中可用的一个游览。请注意，许多工具都是基于Erlang的，您可以通过Elixir访问这些工具。</p><h1 id="d47b" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">度量收集</h1><p id="19a1" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">通用指标收集是应用程序的传感器阵列:这里是用户注册的计数器，那里是收集关键HTTP调用的平均调用时间，等等。这些服务帮助收集和聚合指标，并将指标发送给另一个服务(例如:Graphite、InfluxDB、Datadog等)进行可视化和警报。</p><h2 id="f6fe" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">外测速仪</h2><p id="6374" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">Ulf Wiger和Magnus Feuer的<a class="ae jg" href="https://github.com/Feuerlabs/exometer" rel="noopener ugc nofollow" target="_blank"> Exometer </a>是事实上的Erlang仪器包。Exometer有几个部分:</p><ol class=""><li id="605e" class="lx ly hu jj b jk jl jo jp js lz jw ma ka mb ke mc md me mf dt translated"><strong class="jj hv">记录指标</strong>:您可以告诉Exometer更新值，并让Exometer以您选择的时间间隔运行函数来记录值。</li><li id="e9b7" class="lx ly hu jj b jk mg jo mh js mi jw mj ka mk ke mc md me mf dt translated"><strong class="jj hv">存储指标</strong>:原始指标存储在Beam VM的via ETFs中。</li><li id="c234" class="lx ly hu jj b jk mg jo mh js mi jw mj ka mk ke mc md me mf dt translated"><strong class="jj hv">报告指标</strong>:指标被聚合，然后转发到外部系统，如Graphite、AMNQ或StatsD。</li></ol><p id="8910" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">下面这个由<a class="ml mm gr" href="https://medium.com/u/fbf66cd702d2?source=post_page-----aac2df726e8c--------------------------------" rel="noopener" target="_blank">Michael schfer Meyer</a>撰写的故事很好地概述了Exometer:</p><div class="mn mo fm fo mp mq"><a rel="noopener follow" target="_blank" href="/@mschae/measuring-your-phoenix-app-d63a77b13bda"><div class="mr ab ej"><div class="ms ab mt cl cj mu"><h2 class="bd hv fv z el mv eo ep mw er et ht dt translated">监视凤凰</h2><div class="mx l"><h3 class="bd b fv z el mv eo ep mw er et ek translated">作为Elixir社区中的许多工程师，我有ruby背景，使用rails作为我的首选MVC框架。</h3></div><div class="my l"><p class="bd b gc z el mv eo ep mw er et ek translated">medium.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne ja mq"/></div></div></a></div><h2 id="84f0" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">Elixometer</h2><p id="10b1" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">Pinterest的<a class="ae jg" href="https://github.com/pinterest/elixometer" rel="noopener ugc nofollow" target="_blank"> Elixometer </a>是一个围绕Exometer的轻量级包装器，它使定义/更新指标变得更加容易，另外还有一个漂亮的<code class="eh nf ng nh ni b">@timed</code>注释，可以方便地计算函数的执行时间:</p><pre class="nj nk nl nm fq nn ni no np aw nq dt"><span id="78b1" class="lj kh hu ni b fv nr ns l nt nu"># Timing a function. The metric name will be [:timed, :function]<br/># Key will be: prefix.dev.timers.timed.function<br/>@timed(key: "timed.function") <br/>def function_that_is_timed do<br/>  OtherModule.slow_method<br/>end</span></pre><h1 id="e457" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">波束资源使用</h1><p id="8887" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">有几个工具可以监控BEAM VM的资源使用情况，它运行您的Elixr和Erlang应用程序。BEAM感觉上更像一个操作系统，而不是典型的虚拟机，它的监控工具有与之匹配的复杂性。</p><h2 id="eb00" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">观察者</h2><figure class="nj nk nl nm fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nv"><img src="../Images/af03e09d7e93287ed4fa285185f28898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bD0Wg9J6YEzoOGREqacj5g.png"/></div></div></figure><p id="6fe9" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">默认的goto是<a class="ae jg" href="http://erlang.org/doc/man/observer.html" rel="noopener ugc nofollow" target="_blank"> Observer </a>:它可能已经安装在你的电脑上了。尝试通过iex启动Observer:</p><pre class="nj nk nl nm fq nn ni no np aw nq dt"><span id="bcfc" class="lj kh hu ni b fv nr ns l nt nu">iex(9)&gt; :observer.start</span></pre><p id="171c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">观察者也可以连接到远程系统。</p><h2 id="75ac" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">袋熊</h2><p id="5f97" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">一个全功能的操作和维护框架，<a class="ae jg" href="https://www.erlang-solutions.com/products/wombat-oam.html" rel="noopener ugc nofollow" target="_blank"> Wombat </a>是通过Erlang Solutions提供的商业软件。</p><h2 id="ad94" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">侦察</h2><p id="050d" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">Recon 是Erlang Recon应用程序中的一个模块。该模块提供对Beam VM的高级资源使用信息的访问。</p><p id="9274" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">例如:</p><pre class="nj nk nl nm fq nn ni no np aw nq dt"><span id="e154" class="lj kh hu ni b fv nr ns l nt nu">iex(11)&gt; :recon.info(self)</span><span id="b32c" class="lj kh hu ni b fv nw ns l nt nu">[meta: [registered_name: [],<br/>memory_used: [memory: 143208, message_queue_len: 4, heap_size: 10958,<br/>total_heap_size: 17730,<br/>garbage_collection: [max_heap_size: %{error_logger: true, kill: true,<br/>size: 0}, min_bin_vheap_size: 46422, min_heap_size: 233,<br/>...</span></pre><h1 id="1aa6" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">应用程序监控</h1><p id="3323" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">应用程序性能监控(APM)服务检测您的Elixir函数调用，并通过事务跟踪提供性能分析。大多数APM工具都是以监控web请求和一般性能监控为导向的。</p><h2 id="5133" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">AppSignal</h2><p id="383f" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">AppSignal有一个官方支持的<a class="ae jg" href="https://github.com/appsignal/appsignal-elixir" rel="noopener ugc nofollow" target="_blank">应用监控代理</a>用于Elixir。</p><h2 id="6bb5" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">侦察</h2><p id="48a2" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">在我的日常工作中，我们已经发布了一个针对Elixir的应用程序监控代理。<a class="ae jg" href="https://scoutapp.com" rel="noopener ugc nofollow" target="_blank">了解更多</a>。</p><h2 id="4336" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">新遗迹</h2><p id="8ad2" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">New Relic没有官方支持的代理，但是有几个社区开发的代理可用:</p><ul class=""><li id="8185" class="lx ly hu jj b jk jl jo jp js lz jw ma ka mb ke nx md me mf dt translated"><a class="ae jg" href="https://github.com/TheRealReal/new-relixir" rel="noopener ugc nofollow" target="_blank">新版本</a></li><li id="a39c" class="lx ly hu jj b jk mg jo mh js mi jw mj ka mk ke nx md me mf dt translated"><a class="ae jg" href="https://github.com/romul/newrelic.ex" rel="noopener ugc nofollow" target="_blank">new _ relic</a>—<code class="eh nf ng nh ni b">new_relic</code>模块的作者(<a class="ml mm gr" href="https://medium.com/u/dc0c9e48353a?source=post_page-----aac2df726e8c--------------------------------" rel="noopener" target="_blank"> Roman Smirnov </a>)在回应中提到<code class="eh nf ng nh ni b">new_relixir</code>可以触发<code class="eh nf ng nh ni b">newrelic-erlang</code>触发的性能(内存&amp; cpu)问题。他的模块解决了这些问题。</li></ul><blockquote class="ny nz oa"><p id="a24c" class="jh ji kf jj b jk jl jm jn jo jp jq jr ob jt ju jv oc jx jy jz od kb kc kd ke hn dt translated"><strong class="jj hv">我的观点</strong>:应用监控是一种神奇的监控形式:你可以事半功倍。然而，让这种神奇的事情发生确实涉及到可能导致崩溃的应用程序挂钩。出于这个原因，我倾向于那些有官方支持的服务，以及一个致力于保持其监控代理更新的团队。</p></blockquote><h1 id="d424" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">跟踪和分析</h1><p id="f854" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">有时，您需要一帧一帧地遍历应用程序的执行过程来调试问题。有几个工具可以为Erlang和Elixir应用程序提供这种功能。</p><h2 id="7743" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">侦察跟踪</h2><p id="685c" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">作为前面提到的Recon应用程序的一部分，<a class="ae jg" href="http://ferd.github.io/recon/recon_trace.html" rel="noopener ugc nofollow" target="_blank"> Recon Trace </a>是一个Erlang模块，它允许在生产环境中安全地跟踪函数。</p><h2 id="95bd" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">轻敲，水龙头</h2><p id="88b1" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated"><a class="ae jg" href="https://github.com/eproxus/tap" rel="noopener ugc nofollow" target="_blank"> Tap </a>是Recon Trace的一个薄薄的药剂包装，为Recon Trace提供了一个简单的药剂接口:</p><pre class="nj nk nl nm fq nn ni no np aw nq dt"><span id="c1ac" class="lj kh hu ni b fv nr ns l nt nu">iex(1)&gt; require Tap<br/>nil<br/>iex(2)&gt; Tap.call(String.strip(_, _), max: 4)<br/>2<br/>iex(4)&gt; String.strip("test", ?t)<br/>"es"<br/>21:52:36.972255 #PID&lt;0.88.0&gt; String.strip("test", 116)<br/><br/>21:52:36.972711 #PID&lt;0.88.0&gt; String.strip/2 --&gt; "es"</span></pre><h2 id="0232" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">厄尔利</h2><p id="bb4f" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">Elyberly 提供了一个GUI界面，用于调试和分析Erlang和Elixir应用程序。除了跟踪之外，Elyberly还收集关于进程和内存使用的信息。这并不是说Elyberly不打算跟踪生产系统，因为它没有过载保护。</p><figure class="nj nk nl nm fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff oe"><img src="../Images/c9c3c912ddcf67acf6b8cac4ec25be72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I1WYvjkiqSCq2M1-QsOAEw.png"/></div></div></figure><p id="3946" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Plataformatec的人有一个很棒的《爱丽舍宫的<a class="ae jg" href="http://blog.plataformatec.com.br/2016/04/how-to-trace-elixir-nodes-with-erlyberly/" rel="noopener ugc nofollow" target="_blank">入门指南。</a></p><h2 id="0597" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">沙蚤</h2><p id="6ef5" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated"><a class="ae jg" href="https://github.com/massemanet/redbug" rel="noopener ugc nofollow" target="_blank"> Redbug </a>是Erlang的一个生产安全调试/跟踪工具。Roberto Aloi在他的博客上有一个很棒的红虫教程。</p><h2 id="2e98" class="lj kh hu bd ki lk ll lm km ln lo lp kq js lq lr ku jw ls lt ky ka lu lv lc lw dt translated">DBG</h2><p id="8ba3" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">DBG是一个用于追踪的Erlang模块。DBG周围还有一种薄薄的仙丹包装纸，叫做… <a class="ae jg" href="https://github.com/fishcakez/dbg" rel="noopener ugc nofollow" target="_blank"> DBG </a>。</p><h1 id="d43e" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">异常监控</h1><p id="aa18" class="pw-post-body-paragraph jh ji hu jj b jk le jm jn jo lf jq jr js lg ju jv jw lh jy jz ka li kc kd ke hn dt translated">许多现有的异常监控服务已经支持Elixir。Elixir和Erlang对异常有独特的理解，因此了解每个服务的异常逻辑如何满足您的需求非常重要。</p><p id="8db3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">一些选项:</p><ul class=""><li id="b832" class="lx ly hu jj b jk jl jo jp js lz jw ma ka mb ke nx md me mf dt translated"><a class="ae jg" href="https://github.com/honeybadger-io/honeybadger-elixir" rel="noopener ugc nofollow" target="_blank">蜜獾</a></li><li id="c3ab" class="lx ly hu jj b jk mg jo mh js mi jw mj ka mk ke nx md me mf dt translated"><a class="ae jg" href="https://github.com/getsentry/sentry-elixir" rel="noopener ugc nofollow" target="_blank">哨兵</a></li><li id="8a2f" class="lx ly hu jj b jk mg jo mh js mi jw mj ka mk ke nx md me mf dt translated"><a class="ae jg" href="https://github.com/elixir-addicts/rollbax" rel="noopener ugc nofollow" target="_blank">滚动条</a></li></ul><blockquote class="ny nz oa"><p id="efa0" class="jh ji kf jj b jk jl jm jn jo jp jq jr ob jt ju jv oc jx jy jz od kb kc kd ke hn dt translated"><strong class="jj hv"> <em class="hu">我的观点</em> </strong>:我更喜欢使用他们在生产中监控的语言的服务，因为他们对监控的痛苦有第一手的经验。HoneyBadger在他们自己的生产应用程序中有使用酏剂的经验。</p></blockquote><div class="nj nk nl nm fq ab cb"><figure class="of iv og oh oi oj ok paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="of iv og oh oi oj ok paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="of iv og oh oi oj ok paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ny nz oa"><p id="f922" class="jh ji kf jj b jk jl jm jn jo jp jq jr ob jt ju jv oc jx jy jz od kb kc kd ke hn dt translated"><a class="ae jg" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿美族家庭的一员。我们现在<a class="ae jg" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jg" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jh ji kf jj b jk jl jm jn jo jp jq jr ob jt ju jv oc jx jy jz od kb kc kd ke hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jg" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jg" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="nj nk nl nm fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ol"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>