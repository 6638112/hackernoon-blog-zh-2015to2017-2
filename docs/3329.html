<html>
<head>
<title>Harbor — secure shelter for your Dockers from VMWare</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">harbor—VMWare为您的码头工人提供安全的避难所</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/harbor-secure-shelter-for-your-dockers-4c87e83341c9?source=collection_archive---------13-----------------------#2017-03-27">https://medium.com/hackernoon/harbor-secure-shelter-for-your-dockers-4c87e83341c9?source=collection_archive---------13-----------------------#2017-03-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div class="fe ff hs"><img src="../Images/690a0ea2eaa5f378576446f94bf7a2dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*wcGVRmWde2zYZCrnt3vwjw.png"/></div><figcaption class="hz ia fg fe ff ib ic bd b be z ek"><a class="ae id" href="http://vmware.github.io/harbor/" rel="noopener ugc nofollow" target="_blank">http://vmware.github.io/harbor/</a></figcaption></figure><div class=""/><p id="b685" class="pw-post-body-paragraph jd je ig jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">自从我第一次了解Docker和Docker注册表已经有一段时间了。我必须说——就产品的功能、速度和质量而言，Docker团队做得非常好。社区还创建和扩展了Docker平台，提供了各种各样的解决方案。</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/ac2b063f99d589b75fea39f32491618e.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*GUVzssBqiHcPR6xdU5O0uQ.png"/></div></figure><p id="c49c" class="pw-post-body-paragraph jd je ig jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">从一开始，Docker就引入了Docker hub——图像的公共注册表。它对平台的采用和扩展帮助很大。虽然DockerHub让你可以访问所有官方图片和社区贡献，但你总是有必要存储越来越多的自己的图片。</p><p id="aaf7" class="pw-post-body-paragraph jd je ig jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">当然你可以使用<a class="ae id" href="https://hub.docker.com" rel="noopener ugc nofollow" target="_blank"> DockerHub </a>，但是你只能有一个私人回购，否则你需要付费。也有一些第三方解决方案，如<a class="ae id" href="https://bintray.com" rel="noopener ugc nofollow" target="_blank">纸盒</a>、<a class="ae id" href="https://www.twistlock.com" rel="noopener ugc nofollow" target="_blank">扭锁</a>等。如果您只需要保存您的私人图像，并且您没有大量的存储库(可能有100个以上的存储库)，这些解决方案会很好地工作。</p><p id="e9ce" class="pw-post-body-paragraph jd je ig jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">但是，当您不仅需要管理您的图像，还需要管理您的客户时，这可能会变得过于昂贵。</p><h1 id="0b8b" class="kg kh ig bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">Docker注册表</h1><p id="cd3e" class="pw-post-body-paragraph jd je ig jf b jg le ji jj jk lf jm jn jo lg jq jr js lh ju jv jw li jy jz ka hn dt translated">现在登场的是— <a class="ae id" href="https://docs.docker.com/registry/deploying/" rel="noopener ugc nofollow" target="_blank"> Docker安全注册表</a>。<a class="ae id" href="https://github.com/docker/distribution" rel="noopener ugc nofollow" target="_blank"> Docker Registry </a> —出色的解决方案，支持各种存储后端(文件系统、AWS、Azure、Swift、Google Cloud)、授权(LDAP、令牌、基本)等等。</p><p id="7dc2" class="pw-post-body-paragraph jd je ig jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">一旦我们开始在我当前的项目中采用Docker——我们部署了简单的Docker registry，并且非常满意。</p><p id="1097" class="pw-post-body-paragraph jd je ig jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">当时我们的注册表并不安全(我们在一些内部主机上运行它:5000，显然我们使用了自签名证书)，我们需要配置我们所有的Docker主机来信任这个不安全的注册表(Docker团队非常重视安全性)。我们不时需要清理硬盘，因为Docker注册表没有例行清理过时的图像。</p><p id="5f70" class="pw-post-body-paragraph jd je ig jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">大约一年前，我们开始公开展示我们的图像，只对我们的一些客户开放，这种设置运行良好。我们为几个用户设置了基本认证，每个人都很高兴。</p><p id="6d62" class="pw-post-body-paragraph jd je ig jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">最近，我们在产品中添加了一些功能，允许客户将图像上传到我们的注册表。起初它工作得很好，因为每个人都使用不同的名称，没有命名冲突(因为我们为客户构建存储库的名称)。</p><p id="8944" class="pw-post-body-paragraph jd je ig jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">两三个月前，我们开始寻找带有认证服务器的Docker注册解决方案。这样的没有那么多。我们选择的VMWare产品名为Harbor。</p><h1 id="86dd" class="kg kh ig bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">海港</h1><p id="a650" class="pw-post-body-paragraph jd je ig jf b jg le ji jj jk lf jm jn jo lg jq jr js lh ju jv jw li jy jz ka hn dt translated"><a class="ae id" href="https://vmware.github.io/harbor/" rel="noopener ugc nofollow" target="_blank"> Harbor </a> —是Docker Registry的开源令牌认证服务。它允许你创建/邀请用户，或者用户可以自己注册。港口实施<a class="ae id" href="https://github.com/docker/distribution/blob/8be8b60ce505af40e31cb842b56de67a40910251/docs/spec/auth/token.md" rel="noopener ugc nofollow" target="_blank">令牌认证规范</a>。</p><p id="ec43" class="pw-post-body-paragraph jd je ig jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">至于权限和ACL，有三种抽象。项目、成员和图像。每个项目都有成员(管理员、开发人员或来宾)。来宾只能拉取、开发人员-拉取/推送和管理员管理权限、添加新用户等。</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="fe ff lj"><img src="../Images/24387a2199787e9de13183689a2dfa4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g1ZFc_pDGL_pxf3NmA8pLw.png"/></div></div></figure><h1 id="485d" class="kg kh ig bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">部署</h1><p id="a4d0" class="pw-post-body-paragraph jd je ig jf b jg le ji jj jk lf jm jn jo lg jq jr js lh ju jv jw li jy jz ka hn dt translated">看起来该项目正在积极开发和高需求。约2000颗星，约450个开放问题，但仍处于良好状态。您可以通过两种不同的方式进行部署:脱机模式和联机模式。你可以下载tar包，拷贝到你的linux机器上，运行安装脚本就可以了。你有自己的Docker注册表。但是不安全。为了确保安全，您需要在负载平衡器或代理服务器上终止ssl。或者，如果您还没有为您的域生成证书，您可以使用Let's Encrypt来生成证书。</p><p id="950a" class="pw-post-body-paragraph jd je ig jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">此外，如果您使用Kubernetes港有单独的部署程序。这真的很好——因为在生产中，我们使用Kubernetes来部署我们的容器。</p><h1 id="4878" class="kg kh ig bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">REST API</h1><p id="6b09" class="pw-post-body-paragraph jd je ig jf b jg le ji jj jk lf jm jn jo lg jq jr js lh ju jv jw li jy jz ka hn dt translated">我们一直在寻找的特性之一是REST API。我们需要以编程方式管理项目和用户，从我们的应用程序设置权限。这对我们来说至关重要。Harbor在Swagger中很好地记录了API这是另一个优点。</p><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="fe ff lo"><img src="../Images/7c9784410c2b06a5317df27706534e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0t8yIbXSzBka1sHv0GYNDw.png"/></div></div></figure><h1 id="c233" class="kg kh ig bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">配置</h1><p id="e9f8" class="pw-post-body-paragraph jd je ig jf b jg le ji jj jk lf jm jn jo lg jq jr js lh ju jv jw li jy jz ka hn dt translated">当您使用部署脚本时，Harbor会部署它自己的注册表实例。你可以配置它与AWS，Azure，谷歌云等一起使用。或者Docker注册表可用的任何其他<a class="ae id" href="https://github.com/docker/distribution/blob/8be8b60ce505af40e31cb842b56de67a40910251/docs/configuration.md" rel="noopener ugc nofollow" target="_blank">配置选项</a>。但这并不意味着你不能已经安装了注册表，并将其配置为用作Harbor UI的注册表后端。</p><h1 id="ab2e" class="kg kh ig bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">结束了</h1><p id="c40a" class="pw-post-body-paragraph jd je ig jf b jg le ji jj jk lf jm jn jo lg jq jr js lh ju jv jw li jy jz ka hn dt translated">如果您正在为您的公司或您自己的项目寻找Docker注册表，Harbor绝对值得一查。它有所有必要的功能，简单的安装脚本，所有组件捆绑在一起。5分钟就可以安装，开始玩了。</p><div class="kc kd ke kf fq ab cb"><figure class="lp hw lq lr ls lt lu paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lp hw lq lr ls lt lu paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lp hw lq lr ls lt lu paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="lv lw lx"><p id="f922" class="jd je ly jf b jg jh ji jj jk jl jm jn lz jp jq jr ma jt ju jv mb jx jy jz ka hn dt translated"><a class="ae id" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae id" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae id" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae id" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jd je ly jf b jg jh ji jj jk jl jm jn lz jp jq jr ma jt ju jv mb jx jy jz ka hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae id" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae id" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kc kd ke kf fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="fe ff mc"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>