<html>
<head>
<title>Server Side Rendering with Create React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Create React应用程序进行服务器端渲染</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/server-side-rendering-with-create-react-app-1faf5a9d1eff?source=collection_archive---------1-----------------------#2017-02-19">https://medium.com/hackernoon/server-side-rendering-with-create-react-app-1faf5a9d1eff?source=collection_archive---------1-----------------------#2017-02-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="00d1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">更新:我为此写了一个v2，它的推理更好一些，在这里查看:<a class="ae jp" rel="noopener" href="/@benlu/ssr-with-create-react-app-v2-1b8b520681d9">https://medium . com/@鲁本/SSR-with-create-react-app-v2-1b 8 b 520681d 9</a></p><p id="b898" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我一直在使用create react应用程序，并希望通过在我制作的应用程序中添加服务器端渲染来提高性能。这并不像我最初想的那样简单，但要开始，您可以查看这篇medium文章:<a class="ae jp" rel="noopener" href="/@patriciolpezjuri/using-create-react-app-with-react-router-express-js-8fa658bf892d#.4uaa27t0d">https://medium . com/@ patriciolpezjuri/using-create-react-app-with-react-router-express-js-8fa 658 BF 892d</a></p><blockquote class="jq"><p id="f8c4" class="jr js hu bd jt ju jv jw jx jy jz jo ek translated">这是关于服务器端渲染和redux</p></blockquote><p id="a42b" class="pw-post-body-paragraph ir is hu it b iu ka iw ix iy kb ja jb jc kc je jf jg kd ji jj jk ke jm jn jo hn dt translated">源代码可用:【https://github.com/ayroblu/ssr-create-react-app T4】</p></div><div class="ab cl kf kg hc kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hn ho hp hq hr"><h1 id="4539" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">借口</h1><p id="2e70" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">在生产中，create react app基本上只是一些静态文件，这对于基本部署来说很好，但合并服务器端渲染需要服务器，我已经使用了nodejs相当多，所以遵循一点<a class="ae jp" rel="noopener" href="/@patriciolpezjuri/using-create-react-app-with-react-router-express-js-8fa658bf892d#.4uaa27t0d">https://medium . com/@ patriciolpezjuri/using-create-react-app-with-react-router-express-js-8fa 658 BF 892d</a>，您可以设置一个express + create react app网站，并开始添加服务器端渲染。</p><p id="bf95" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我所做的并不涉及会话状态修改或服务工作者，我认为这两者都是自然的进展，但只是还没有实现。</p><h1 id="de7d" class="km kn hu bd ko kp lp kr ks kt lq kv kw kx lr kz la lb ls ld le lf lt lh li lj dt translated">理论</h1><p id="872d" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">对于服务器端渲染，我们希望渲染一些基本的页面，我不想在认证用户或复杂的条件下乱来，因为我通常在客户端以单页应用程序(SPA)的方式处理这些。这很大程度上意味着我想呈现原始的html，而不是别的，让html保持原样，但是用路由信息填充react 'root '元素</p><h1 id="0b30" class="km kn hu bd ko kp lp kr ks kt lq kv kw kx lr kz la lb ls ld le lf lt lh li lj dt translated">做出改变</h1><h2 id="628c" class="lu kn hu bd ko lv lw lx ks ly lz ma kw jc mb mc la jg md me le jk mf mg li mh dt translated">应用程序设置</h2><p id="a99d" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">对于那些不熟悉redux、react-router设置或好奇我是如何做到的人来说:我一直在尝试不同的redux风格，所以目前我有三个文件夹，动作、reducers和类型，看起来像:</p><figure class="mi mj mk ml fq mm"><div class="bz el l di"><div class="mn mo l"/></div></figure><p id="e0d4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">store.js看起来像:</p><figure class="mi mj mk ml fq mm"><div class="bz el l di"><div class="mn mo l"/></div></figure><p id="77fd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">显然，基于我相信的react样板文件，我坚持在我觉得合适的地方(redux-saga、logger、dev tools……)居中</p><p id="9607" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于您的路线，将它们移动到它们自己的组件routes.js中，如下所示:</p><figure class="mi mj mk ml fq mm"><div class="bz el l di"><div class="mn mo l"/></div></figure><p id="21b3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">显然，我也有一个组件和容器目录，容器是主页面，组件是没有状态的东西，实际上只是提供简单的功能，似乎是事情进展的方式</p><h2 id="13fa" class="lu kn hu bd ko lv lw lx ks ly lz ma kw jc mb mc la jg md me le jk mf mg li mh dt translated">现在实际的服务器端渲染</h2><p id="bc1c" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">好了，有了样板文件，如果您已经按照链接的文章进行了express server设置，那么您现在已经得到了一个<em class="mp"> server/app.js </em>文件。首先，有几个重要的导入:</p><figure class="mi mj mk ml fq mm"><div class="bz el l di"><div class="mn mo l"/></div></figure><p id="ef0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些将你的客户端react代码带到nodejs端，(如果你还没有使用<em class="mp"> npm install/yarn add </em>，不要忘记安装ignore-styles)。我们忽略-styles，因为你在create react app中导入css，没有webpack，我们真的不能处理，所以这是一个快速的欺骗。babel-register对于生产来说显然不是一个好主意，但是，在很大程度上，它很好，而且你需要它，因为你已经将你的客户端代码babel化了。剩下的就不言自明了，你需要创建你的react元素并把它们转换成字符串。</p><p id="c21f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意:因为我们在路由器级别工作，如果你有父组件在那之上，在这种情况下，redux，但是也许material-ui或类似的，那么你将需要在这里重建它们(或者需要文件以便你能使用import等)</p><p id="e139" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是代码，它并不漂亮，但它完成了工作:</p><figure class="mi mj mk ml fq mm"><div class="bz el l di"><div class="mn mo l"/></div></figure><p id="efad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以快速浏览一下，这个函数放在一个快速处理程序中，你首先读取create-react-app生成的文件(index.html在构建目录中)。使用react-router的匹配方法来匹配url，并给定一些道具，将我的react元素创建为html。最后替换一些文本(因此进入public/index.html并向根元素添加一些内容，如{{SSR}}，然后数据被替换并最终发送给用户。</p><p id="2359" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你完了！不要忘记一些零碎的东西，比如:</p><pre class="mi mj mk ml fq mq mr ms mt aw mu dt"><span id="af22" class="lu kn hu mr b fv mv mw l mx my">app.use('^/$', universalLoader)<br/>app.use(express.static(path.resolve(__dirname, '..', 'build')))<br/>app.use('/', universalLoader)</span></pre><p id="5915" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于更高级的项目，比如那些已经退出了webpack配置的人，这可能还不够，但是如果你正在创建一些简单的网站，这是一个加快加载速度的好方法！</p><p id="30d1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">https://github.com/ayroblu/ssr-create-react-app<a class="ae jp" href="https://github.com/ayroblu/ssr-create-react-app" rel="noopener ugc nofollow" target="_blank">的check out</a>这是我在这里使用的样板代码(这意味着这里有图标，代码更加分散)。让我知道你的想法，肯定要增加服务人员，除了其他事情！</p><blockquote class="mz na nb"><p id="25a8" class="ir is mp it b iu iv iw ix iy iz ja jb nc jd je jf nd jh ji jj ne jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is mp it b iu iv iw ix iy iz ja jb nc jd je jf nd jh ji jj ne jl jm jn jo hn dt translated">要了解更多信息，<a class="ae jp" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a> , <a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">喜欢/在脸书给我们发消息</a>，或者简单地，<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank">发推文/DM @HackerNoon。</a></p><p id="708a" class="ir is mp it b iu iv iw ix iy iz ja jb nc jd je jf nd jh ji jj ne jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote></div></div>    
</body>
</html>