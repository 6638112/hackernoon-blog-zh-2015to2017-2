<html>
<head>
<title>The Wonderful World of Web Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Web组件的奇妙世界</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-wonderful-world-of-web-components-e4c1675c6901?source=collection_archive---------5-----------------------#2017-07-02">https://medium.com/hackernoon/the-wonderful-world-of-web-components-e4c1675c6901?source=collection_archive---------5-----------------------#2017-07-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="8954" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Web组件是一组新的浏览器API，允许您创建具有自己的封装样式和功能的自定义HTML元素。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/e47b7cb54131e59ca6fe0436d965c54f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*coE532SusBRWI36eyxZ35A.jpeg"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">NASA, ESA and M. Livio (STScl)</figcaption></figure><p id="46a2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些API使开发人员能够以基于组件的方式构建web应用程序，而不是“默认的”基于文档的web方法。</p><p id="ab33" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">整个“Web组件”包由四个子API组成，这四个子API也可以相互独立使用。然而，当这四个人走到一起时，真正的奇迹就发生了。</p><h1 id="6042" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">HTML模板</h1><p id="f1b5" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated"><a class="ae li" href="https://hackernoon.com/tagged/html" rel="noopener ugc nofollow" target="_blank"> HTML </a>模板允许你声明<a class="ae li" href="https://hackernoon.com/tagged/markup" rel="noopener ugc nofollow" target="_blank">标记</a>的片段，这些片段被解析为HTML，在页面加载时不使用，但是可以在以后的运行时实例化。</p><blockquote class="lj lk ll"><p id="82b3" class="ir is lm it b iu iv iw ix iy iz ja jb ln jd je jf lo jh ji jj lp jl jm jn jo hn dt translated">它们是一个放一大堆HTML的地方，你根本不想让浏览器弄乱它们…不管是出于什么原因。<br/>拉斐尔·温斯坦(HTML模板规范作者)</p></blockquote><p id="b15c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">创建模板就像创建任何其他常规DOM元素一样简单:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="2f18" class="lv kg hu lr b fv lw lx l ly lz">&lt;template id="template-author"&gt;<br/>  &lt;h2&gt;Rijk&lt;/h2&gt;<br/>  &lt;img src="..." alt="The author of this article (Rijk)" /&gt;&lt;/template&gt;</span></pre><p id="95e6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关键要点:</p><ul class=""><li id="59b2" class="ma mb hu it b iu iv iy iz jc mc jg md jk me jo mf mg mh mi dt translated">模板内容在激活之前是惰性的</li><li id="535f" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">在使用模板之前没有副作用</li><li id="3974" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">该内容被认为不在DOM中</li><li id="01c5" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">模板可以放在任何地方</li><li id="bb6a" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">没有任何形式的本地数据绑定。因此，您仍然需要一个库来处理这个问题，或者自己编写一些业务逻辑来用有用的内容填充模板。</li></ul><h1 id="60f1" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">HTML导入</h1><p id="f9d1" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">现在，我们已经有了将CSS和JavaScript文件等资产导入HTML标记的方法。有了HTML导入，我们现在有了一种在其他HTML文档中包含HTML文档的方法。这也不仅限于标记。导入还可以包含它自己的CSS、JavaScript或任何其他内容。</p><p id="adfb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">导入HTML文档与包含CSS文件非常相似:</p><p id="781a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh mo mp mq lr b">&lt;link rel="import" href="/author.html" /&gt;</code></p><p id="a799" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦加载了导入的文件，它的嵌入式脚本将运行，并且可以通过引用元素的<code class="eh mo mp mq lr b">import</code>属性来使用内容:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="4e4a" class="lv kg hu lr b fv lw lx l ly lz">const content = document.querySelector('link[rel="import"]').import;</span></pre><p id="fde8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在导入其他定制元素时，可以非常有效地使用这个API，稍后将演示这一点。</p><p id="308e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关于浏览器支持HTML导入的一个重要注意事项:Chrome已经实现并发布了它，但是WebKit和Firefox  <strong class="it hv"> <em class="lm">根本不打算实现它。</em> </strong> <em class="lm"> WebKit提供了他们想要调查的一个与ES6模块的组合。</em></p><p id="7160" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关键要点:</p><ul class=""><li id="9093" class="ma mb hu it b iu iv iy iz jc mc jg md jk me jo mf mg mh mi dt translated"><code class="eh mo mp mq lr b">link rel=import</code>自动删除所有重复请求。</li><li id="059a" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">导入的文档并不放在DOM中，只是供使用</li><li id="fbbf" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">导入文档中的脚本标签将在导入时运行</li><li id="6571" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">默认情况下，导入语句是阻塞的，但是接受<code class="eh mo mp mq lr b">async</code>属性</li><li id="2ca0" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">当从要导入的文档中访问<code class="eh mo mp mq lr b">document</code>时，您实际上是在访问父文档。<code class="eh mo mp mq lr b">document.currentScript.ownerDocument</code>是对“子”文档的引用。</li><li id="00ca" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">深度嵌套的html导入将会影响<code class="eh mo mp mq lr b">document.currentScript.ownerDocument</code>。用<code class="eh mo mp mq lr b">document.currentScript.ownerDocument</code>作为参数将嵌套脚本包装在iife中以防止这种情况。</li></ul><h1 id="5b25" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">阴影DOM</h1><p id="278f" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">来自<a class="ae li" href="https://developers.google.com/web/fundamentals/getting-started/primers/shadowdom" rel="noopener ugc nofollow" target="_blank">谷歌的影子DOM基础</a>:</p><blockquote class="lj lk ll"><p id="0d8c" class="ir is lm it b iu iv iw ix iy iz ja jb ln jd je jf lo jh ji jj lp jl jm jn jo hn dt translated">影子DOM只是普通的DOM，有两个不同点:<br/> 1)它是如何被创建/使用的，以及<br/> 2)它如何与页面的其他部分相关联。</p><p id="c948" class="ir is lm it b iu iv iw ix iy iz ja jb ln jd je jf lo jh ji jj lp jl jm jn jo hn dt translated">通常，您创建DOM节点并将它们作为另一个元素的子元素追加。使用shadow DOM，您可以创建一个作用域DOM树，该树附加到元素上，但与其实际的子元素分开。这个限定了作用域的子树被称为影子树。它所依附的元素是它的影子宿主。你在阴影中添加的任何东西都会成为宿主元素的一部分，包括<code class="eh mo mp mq lr b"><em class="hu">&lt;style&gt;</em></code>。这就是影子DOM实现CSS样式范围的方式。</p></blockquote><p id="ba82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可能以前用过shadow DOM，甚至在你没有意识到的时候。浏览器对许多不同的原生HTML元素使用阴影DOM，如范围输入:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mr"><img src="../Images/536d380c8a76e51ecceaeeedef565cbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ij_tSixheboYNFR1LQf5UA.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Shadow DOM of a standard &lt;input type=”range”&gt;</figcaption></figure><p id="1fe1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">shadow DOM API允许开发人员创建自己的shadow DOM并将其附加到元素上，这与定制元素非常匹配。</p><p id="13b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关键要点:</p><ul class=""><li id="0bd1" class="ma mb hu it b iu iv iy iz jc mc jg md jk me jo mf mg mh mi dt translated">shadow-root中的所有内容都是有作用域的。</li><li id="0350" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">使用<code class="eh mo mp mq lr b">:host</code>选择器来样式化父容器</li><li id="f4c9" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated"><code class="eh mo mp mq lr b">position: fixed</code>和其他css定位使用组件边界作为"视口"</li><li id="d75c" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">shadow-root中元素的样式可以被light-dom覆盖(“常规”/“父”-dom)。</li></ul><h1 id="610f" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">自定义元素</h1><p id="62cd" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">使用自定义元素，开发人员可以创建新的HTML标记，扩展现有的HTML标记，或者扩展其他开发人员已经构建的组件。它提供了一种创建可重用组件的本地方式。</p><p id="e032" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">定制元素必须在JavaScript中定义。它们有几个生命周期挂钩:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="4b31" class="lv kg hu lr b fv lw lx l ly lz">class ArticleAuthor extends HTMLElement {</span><span id="57b9" class="lv kg hu lr b fv ms lx l ly lz">  // When element is created or upgraded  <br/>  constructor() {...}</span><span id="47bd" class="lv kg hu lr b fv ms lx l ly lz">  // When element is inserted into a document <br/>  connectedCallback() {...}</span><span id="cdf5" class="lv kg hu lr b fv ms lx l ly lz">  // When element is removed from a document<br/>  disconnectedCallback() {...}</span><span id="01c7" class="lv kg hu lr b fv ms lx l ly lz">  // When an <a class="ae li" href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Custom_Elements#Observed_attributes" rel="noopener ugc nofollow" target="_blank">observed attribute</a> changes<br/>  attributeChangedCallback() {...}</span><span id="0e74" class="lv kg hu lr b fv ms lx l ly lz">  // When the element is adopted into a new document<br/>  adoptedCallback() {...}<br/>}</span><span id="0d7a" class="lv kg hu lr b fv ms lx l ly lz">// Register &lt;article-author&gt;<br/>customElements.define('article-author', ArticleAuthor);</span></pre><p id="73a5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将DOM添加到元素中可以通过将标记插入到<code class="eh mo mp mq lr b">this.innerHTML</code>中来完成:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="cba8" class="lv kg hu lr b fv lw lx l ly lz">...<br/>connectedCallback() {<br/>  this.innerHTML = '&lt;b&gt;Hi there!&lt;/b&gt;';<br/>}<br/>...</span></pre><p id="5ea8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">添加内容(imo)的一个更好的方法是结合上面提到的HTML模板和影子DOM(见下面的演示)。</p><p id="880a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关键要点:</p><ul class=""><li id="a368" class="ma mb hu it b iu iv iy iz jc mc jg md jk me jo mf mg mh mi dt translated">名称必须包含连字符(-)(例如<code class="eh mo mp mq lr b">&lt;article-author&gt;</code>)</li><li id="424f" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">名称必须是唯一的</li><li id="8724" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">自定义元素不能自结束</li><li id="9053" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">根据规范，你可以扩展现有的HTML元素(比如<code class="eh mo mp mq lr b">HTMLButtonElement</code>)，而不是默认的<code class="eh mo mp mq lr b">HTMLElement</code>。这将继承该元素的所有默认功能(如按钮上的tabindex)。遗憾的是，到目前为止，这还没有在任何地方实现。</li><li id="7ee2" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">HTML模板是标记自定义元素的(影子)DOM的理想方式。</li><li id="b645" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated">总是为组件将要使用的任何属性添加getter和setter方法。</li></ul><h1 id="cd8d" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">现在都在一起</h1><p id="43ec" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">让我们创建一个<code class="eh mo mp mq lr b">nasa-apod</code>标签，它使用<a class="ae li" href="https://api.nasa.gov/api.html#apod" rel="noopener ugc nofollow" target="_blank">他们的API </a>来呈现美国宇航局当天的天文图片(APOD)。</p><p id="c20f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了清晰起见，我将在这个演示中内嵌所有的CSS和JS。完整的演示可以在https://github.com/rijkvanzanten/nasa-apod找到。</p><p id="11e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">目标是创建一个支持如下<code class="eh mo mp mq lr b">caption</code>属性的元素:</p><p id="648c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh mo mp mq lr b">&lt;nasa-apod caption="Supercool Web Components Demo"&gt;&lt;/nasa-apod&gt;</code></p><p id="7a36" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们从创建一个<code class="eh mo mp mq lr b">nasa-apod.html</code>文件开始，该文件将创建并注册定制元素。</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="4550" class="lv kg hu lr b fv lw lx l ly lz">&lt;!-- nasa-apod.html --&gt;</span><span id="1ea4" class="lv kg hu lr b fv ms lx l ly lz">&lt;script&gt;</span><span id="6d51" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">  class NasaApod extends HTMLElement {}</strong></span><span id="1835" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">  customElements.define('nasa-apod', NasaApod);</strong></span><span id="86df" class="lv kg hu lr b fv ms lx l ly lz">&lt;/script&gt;</span></pre><p id="c117" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的元素需要显示图像。为了实现这一点，我们将向元素的shadow DOM添加一个常规的<code class="eh mo mp mq lr b">&lt;img&gt;</code>标签。</p><p id="e1c2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，让我们从给元素附加一个阴影DOM开始，并添加一个模板供以后使用。</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="d7fb" class="lv kg hu lr b fv lw lx l ly lz">&lt;!-- nasa-apod.html --&gt;</span><span id="b7f1" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">&lt;template&gt;<br/>  &lt;img src="" /&gt;<br/>  &lt;p&gt;&lt;/p&gt;<br/>&lt;/template&gt;</strong></span><span id="5ec4" class="lv kg hu lr b fv ms lx l ly lz">&lt;script&gt;</span><span id="ce03" class="lv kg hu lr b fv ms lx l ly lz">  class NasaApod extends HTMLElement {<br/> <strong class="lr hv">   constructor() {<br/>      super();</strong></span><span id="c381" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">      this.attachShadow({mode: 'open'});<br/>    }</strong><br/>  }</span><span id="4537" class="lv kg hu lr b fv ms lx l ly lz">  customElements.define('nasa-apod', NasaApod);</span><span id="3537" class="lv kg hu lr b fv ms lx l ly lz">&lt;/script&gt;</span></pre><p id="c394" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要将模板插入阴影DOM，我们需要用<code class="eh mo mp mq lr b">document.querySelector</code>或其他选择方法选择它。但是，因为这个元素被导入到另一个文档中，<code class="eh mo mp mq lr b">document</code>实际上引用了导入当前文档的<em class="lm">文档。为了获得对<code class="eh mo mp mq lr b">ownerDocument</code>的引用，我们需要将我们的<code class="eh mo mp mq lr b">random-img.html</code>逻辑包装到一个生命中，在这个生命中我们提供<code class="eh mo mp mq lr b">document.currentScript.ownerDocument</code>作为参数:</em></p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="badd" class="lv kg hu lr b fv lw lx l ly lz">&lt;!-- nasa-apod.html --&gt;</span><span id="4518" class="lv kg hu lr b fv ms lx l ly lz">&lt;template&gt;<br/>  &lt;img src="" /&gt;<br/>  &lt;p&gt;&lt;/p&gt;<br/>&lt;/template&gt;</span><span id="c7f1" class="lv kg hu lr b fv ms lx l ly lz">&lt;script&gt;</span><span id="38e9" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">(function(ownerDocument) {</strong></span><span id="183b" class="lv kg hu lr b fv ms lx l ly lz">  class NasaApod extends HTMLElement {<br/> <strong class="lr hv">  </strong> constructor() {<br/>      super();</span><span id="7fd7" class="lv kg hu lr b fv ms lx l ly lz">      this.attachShadow({mode: 'open'});<br/>    }<br/>  }</span><span id="b3c7" class="lv kg hu lr b fv ms lx l ly lz">  customElements.define('nasa-apod', NasaApod);</span><span id="74e8" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">}(document.currentScript.ownerDocument))</strong></span><span id="e1ac" class="lv kg hu lr b fv ms lx l ly lz">&lt;/script&gt;</span></pre><p id="1f6d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们有了对正确文档的引用，我们可以选择模板并将其插入到影子DOM中。</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="747e" class="lv kg hu lr b fv lw lx l ly lz">&lt;!-- nasa-apod.html --&gt;</span><span id="e97e" class="lv kg hu lr b fv ms lx l ly lz">&lt;template&gt;<br/>  &lt;img src="" /&gt;<br/>  &lt;p&gt;&lt;/p&gt;<br/>&lt;/template&gt;</span><span id="e7ab" class="lv kg hu lr b fv ms lx l ly lz">&lt;script&gt;</span><span id="9d94" class="lv kg hu lr b fv ms lx l ly lz">(function(ownerDocument) {</span><span id="2877" class="lv kg hu lr b fv ms lx l ly lz">  class NasaApod extends HTMLElement {<br/> <strong class="lr hv">  </strong> constructor() {<br/>      super();</span><span id="cdc8" class="lv kg hu lr b fv ms lx l ly lz">      this.attachShadow({mode: 'open'});</span><span id="af5d" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">      const {shadowRoot} = this;<br/>      const template = ownerDocument.querySelector('template');<br/>      const instance = template.content.cloneNode(true);<br/>      shadowRoot.append(instance);<br/>    </strong>}<br/>  }</span><span id="965d" class="lv kg hu lr b fv ms lx l ly lz">  customElements.define('nasa-apod', NasaApod);</span><span id="a495" class="lv kg hu lr b fv ms lx l ly lz">}(document.currentScript.ownerDocument))</span><span id="1878" class="lv kg hu lr b fv ms lx l ly lz">&lt;/script&gt;</span></pre><p id="0f25" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们有了一个可以实际呈现的元素，让我们通过将它导入到我们的主HTML文档中来尝试一下。</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="c4a3" class="lv kg hu lr b fv lw lx l ly lz">&lt;!-- index.html --&gt;</span><span id="c2b8" class="lv kg hu lr b fv ms lx l ly lz">&lt;!doctype html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>  &lt;meta charset="utf-8"&gt;<br/>  <br/>  &lt;!-- import and register the nasa-apod component --&gt;  <br/>  <strong class="lr hv">&lt;link rel="import" href="nasa-apod.html" /&gt;<br/></strong>&lt;/head&gt;<br/>&lt;body&gt;<strong class="lr hv"><br/>  &lt;nasa-apod caption="Supercool Web Components Demo"&gt;&lt;/nasa-apod&gt;<br/></strong>&lt;/body&gt;<strong class="lr hv"><br/></strong>&lt;/html&gt;</span></pre><p id="9a62" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你的浏览器支持所有的webcomponents规范(目前只支持Chrome ),你应该可以在检查器中看到:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mt"><img src="../Images/0edb1f2ae63c1f6947ec353ea3793c14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YBZhIpk4V_173rfv5p987Q.png"/></div></div></figure><p id="5c77" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它还没有做任何特别有用的事情，但是它工作了！</p><p id="8d1c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们继续让我们的元素从API获取一个图像，并在shadow DOM中显示它。</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="f309" class="lv kg hu lr b fv lw lx l ly lz">&lt;!-- nasa-apod.html --&gt;</span><span id="f82f" class="lv kg hu lr b fv ms lx l ly lz">&lt;template&gt;<br/>  &lt;img src="" /&gt;<br/>  &lt;p&gt;&lt;/p&gt;<br/>&lt;/template&gt;</span><span id="335f" class="lv kg hu lr b fv ms lx l ly lz">&lt;script&gt;</span><span id="8fa9" class="lv kg hu lr b fv ms lx l ly lz">(function(ownerDocument) {</span><span id="5bc3" class="lv kg hu lr b fv ms lx l ly lz">  class NasaApod extends HTMLElement {<br/> <strong class="lr hv">  </strong> constructor() {<br/>      super();</span><span id="554d" class="lv kg hu lr b fv ms lx l ly lz">      this.attachShadow({mode: 'open'});</span><span id="7629" class="lv kg hu lr b fv ms lx l ly lz">      const {shadowRoot} = this;<br/>      const template = ownerDocument.querySelector('template');<br/>      const instance = template.content.cloneNode(true);<br/>      shadowRoot.append(instance);<br/>    }</span><span id="23d9" class="lv kg hu lr b fv ms lx l ly lz">    connectedCallback() {<br/>      const {shadowRoot} = this;<br/>    <br/>      <strong class="lr hv">fetch('</strong><a class="ae li" href="https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'" rel="noopener ugc nofollow" target="_blank"><strong class="lr hv">https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'</strong></a><strong class="lr hv">)<br/>        .then(res =&gt; res.json())<br/>        .then(res =&gt; {<br/>          const image = shadowRoot.querySelector('img');<br/>          image.src = res.hdurl;<br/>        })<br/>        .catch(err =&gt; console.error);</strong><br/>    }<br/>  }</span><span id="7916" class="lv kg hu lr b fv ms lx l ly lz">  customElements.define('nasa-apod', NasaApod);</span><span id="4125" class="lv kg hu lr b fv ms lx l ly lz">}(document.currentScript.ownerDocument))</span><span id="0f55" class="lv kg hu lr b fv ms lx l ly lz">&lt;/script&gt;</span></pre><p id="06d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这难道不可爱吗？</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mu"><img src="../Images/7b5212b8b1978c649ddae340138b5b95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6_ZwaRsOd1tO1NqMFyifNA.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">The rendered picture in our &lt;nasa-apod&gt; element</figcaption></figure><p id="6eac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们添加对<code class="eh mo mp mq lr b">caption</code>属性的支持。</p><p id="8d95" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我们需要让元素知道它需要观察<code class="eh mo mp mq lr b">caption</code>属性，并为它提供一个getter和setter方法。这允许通过检查器或JavaScript改变元素的属性来更新主文档中的元素。</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="faa3" class="lv kg hu lr b fv lw lx l ly lz">&lt;!-- nasa-apod.html --&gt;</span><span id="a129" class="lv kg hu lr b fv ms lx l ly lz">&lt;template&gt;<br/>  &lt;img src="" /&gt;<br/>  &lt;p&gt;&lt;/p&gt;<br/>&lt;/template&gt;</span><span id="3273" class="lv kg hu lr b fv ms lx l ly lz">&lt;script&gt;</span><span id="efc0" class="lv kg hu lr b fv ms lx l ly lz">(function(ownerDocument) {</span><span id="25b5" class="lv kg hu lr b fv ms lx l ly lz">  class NasaApod extends HTMLElement {<br/> <strong class="lr hv">  </strong> constructor() {<br/>      super();</span><span id="90b1" class="lv kg hu lr b fv ms lx l ly lz">      this.attachShadow({mode: 'open'});</span><span id="cf86" class="lv kg hu lr b fv ms lx l ly lz">      const {shadowRoot} = this;<br/>      const template = ownerDocument.querySelector('template');<br/>      const instance = template.content.cloneNode(true);<br/>      shadowRoot.append(instance);<br/>    }</span><span id="52b8" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">    static get observedAttributes() {<br/>      return ['caption'];<br/>    }</strong></span><span id="c4cd" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">    get caption() {<br/>      return this.getAttribute('caption');<br/>    }</strong></span><span id="90b2" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">    set caption(val) {<br/>      this.setAttribute('caption', val);<br/>    }</strong></span><span id="a43d" class="lv kg hu lr b fv ms lx l ly lz">    connectedCallback() {<br/>      const {shadowRoot} = this;</span><span id="4d4d" class="lv kg hu lr b fv ms lx l ly lz">      fetch('<a class="ae li" href="https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'" rel="noopener ugc nofollow" target="_blank">https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'</a>)<br/>        .then(res =&gt; res.json())<br/>        .then(res =&gt; {<br/>          const image = shadowRoot.querySelector('img');<br/>          image.src = res.hdurl;<br/>        })<br/>        .catch(err =&gt; console.error);<br/>    }<br/>  }</span><span id="b354" class="lv kg hu lr b fv ms lx l ly lz">  customElements.define('nasa-apod', NasaApod);</span><span id="b1c1" class="lv kg hu lr b fv ms lx l ly lz">}(document.currentScript.ownerDocument))</span><span id="deb2" class="lv kg hu lr b fv ms lx l ly lz">&lt;/script&gt;</span></pre><p id="6225" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后我们需要动态更新影子根中段落标签<code class="eh mo mp mq lr b">&lt;p&gt;</code>的内容。</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="5670" class="lv kg hu lr b fv lw lx l ly lz">&lt;!-- nasa-apod.html --&gt;</span><span id="6dce" class="lv kg hu lr b fv ms lx l ly lz">&lt;template&gt;<br/>  &lt;img src="" /&gt;<br/>  &lt;p&gt;&lt;/p&gt;<br/>&lt;/template&gt;</span><span id="bb1e" class="lv kg hu lr b fv ms lx l ly lz">&lt;script&gt;</span><span id="849a" class="lv kg hu lr b fv ms lx l ly lz">(function(ownerDocument) {</span><span id="9682" class="lv kg hu lr b fv ms lx l ly lz">  class NasaApod extends HTMLElement {<br/> <strong class="lr hv">  </strong> constructor() {<br/>      super();</span><span id="7826" class="lv kg hu lr b fv ms lx l ly lz">      this.attachShadow({mode: 'open'});</span><span id="e591" class="lv kg hu lr b fv ms lx l ly lz">      const {shadowRoot} = this;<br/>      const template = ownerDocument.querySelector('template');<br/>      const instance = template.content.cloneNode(true);<br/>      shadowRoot.append(instance);<br/>    }</span><span id="e324" class="lv kg hu lr b fv ms lx l ly lz">    static get observedAttributes() {<br/>      return ['caption'];<br/>    }</span><span id="bda0" class="lv kg hu lr b fv ms lx l ly lz">    get caption() {<br/>      return this.getAttribute('caption');<br/>    }</span><span id="892d" class="lv kg hu lr b fv ms lx l ly lz">    set caption(val) {<br/>      this.setAttribute('caption', val);<br/>    }</span><span id="6fed" class="lv kg hu lr b fv ms lx l ly lz">    connectedCallback() {<br/>      const {shadowRoot} = this;</span><span id="8683" class="lv kg hu lr b fv ms lx l ly lz">      <strong class="lr hv">const caption = this.getAttribute('caption');</strong></span><span id="392e" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">      if (caption) {<br/>        const paragraph = shadowRoot.querySelector('p');<br/>        paragraph.innerText = caption;<br/>      }</strong></span><span id="b7e2" class="lv kg hu lr b fv ms lx l ly lz">      fetch('<a class="ae li" href="https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'" rel="noopener ugc nofollow" target="_blank">https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'</a>)<br/>        .then(res =&gt; res.json())<br/>        .then(res =&gt; {<br/>          const image = shadowRoot.querySelector('img');<br/>          image.src = res.hdurl;<br/>        })<br/>        .catch(err =&gt; console.error);<br/>    }</span><span id="2eb5" class="lv kg hu lr b fv ms lx l ly lz">   <strong class="lr hv"> attributeChangedCallback(name, oldVal, newVal) {<br/>      if (name === 'caption') {<br/>        const {shadowRoot} = this;<br/>        const paragraph = shadowRoot.querySelector('p');<br/>        paragraph.innerText = newVal;<br/>      }<br/>    }</strong><br/>  }</span><span id="dd92" class="lv kg hu lr b fv ms lx l ly lz">  customElements.define('nasa-apod', NasaApod);</span><span id="e172" class="lv kg hu lr b fv ms lx l ly lz">}(document.currentScript.ownerDocument))</span><span id="58f3" class="lv kg hu lr b fv ms lx l ly lz">&lt;/script&gt;</span></pre><p id="0c7a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您在浏览器的元素检查器中更新属性，或者通过设置属性用JavaScript动态更新它们，元素会实时更新！</p><p id="4572" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后但同样重要的是，给我们的元素添加一些限定范围的样式，然后就到此为止。</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="b6b1" class="lv kg hu lr b fv lw lx l ly lz">&lt;!-- nasa-apod.html --&gt;</span><span id="61b3" class="lv kg hu lr b fv ms lx l ly lz">&lt;template&gt;<br/><strong class="lr hv">  &lt;style&gt;<br/>    :host {<br/>      display: flex;<br/>      flex-direction: column;<br/>      align-items: center;<br/>      padding: 15px;<br/>      border: 2px dashed grey;<br/>      width: max-content;<br/>    }</strong></span><span id="a778" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">    img {<br/>      max-width: 500px;<br/>      max-height: 500px;<br/>      object-fit: cover;<br/>    }</strong></span><span id="181d" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">    p {<br/>      text-align: center;<br/>      text-transform: uppercase;<br/>      color: grey;<br/>    }<br/>  &lt;/style&gt;</strong><br/>  &lt;img src="" /&gt;<br/>  &lt;p&gt;&lt;/p&gt;<br/>&lt;/template&gt;</span><span id="5cf5" class="lv kg hu lr b fv ms lx l ly lz">&lt;script&gt;</span><span id="a838" class="lv kg hu lr b fv ms lx l ly lz">(function(ownerDocument) {</span><span id="4975" class="lv kg hu lr b fv ms lx l ly lz">  class NasaApod extends HTMLElement {<br/> <strong class="lr hv">  </strong> constructor() {<br/>      super();</span><span id="4338" class="lv kg hu lr b fv ms lx l ly lz">      this.attachShadow({mode: 'open'});</span><span id="a726" class="lv kg hu lr b fv ms lx l ly lz">      const {shadowRoot} = this;<br/>      const template = ownerDocument.querySelector('template');<br/>      const instance = template.content.cloneNode(true);<br/>      shadowRoot.append(instance);<br/>    }</span><span id="1c79" class="lv kg hu lr b fv ms lx l ly lz">    static get observedAttributes() {<br/>      return ['caption'];<br/>    }</span><span id="7dd9" class="lv kg hu lr b fv ms lx l ly lz">    get caption() {<br/>      return this.getAttribute('caption');<br/>    }</span><span id="7e8d" class="lv kg hu lr b fv ms lx l ly lz">    set caption(val) {<br/>      this.setAttribute('caption', val);<br/>    }</span><span id="bb20" class="lv kg hu lr b fv ms lx l ly lz">    connectedCallback() {<br/>      const {shadowRoot} = this;</span><span id="fba8" class="lv kg hu lr b fv ms lx l ly lz"><strong class="lr hv">    </strong>  const caption = this.getAttribute('caption');</span><span id="3ff3" class="lv kg hu lr b fv ms lx l ly lz">      if (caption) {<br/>        const paragraph = shadowRoot.querySelector('p');<br/>        paragraph.innerText = caption;<br/>      }</span><span id="1dcf" class="lv kg hu lr b fv ms lx l ly lz">      fetch('<a class="ae li" href="https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'" rel="noopener ugc nofollow" target="_blank">https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'</a>)<br/>        .then(res =&gt; res.json())<br/>        .then(res =&gt; {<br/>          const image = shadowRoot.querySelector('img');<br/>          image.src = res.hdurl;<br/>        })<br/>        .catch(err =&gt; console.error);<br/>    }</span><span id="5ea5" class="lv kg hu lr b fv ms lx l ly lz">    attributeChangedCallback(name, oldVal, newVal) {<br/>      if (name === 'caption') {<br/>        const {shadowRoot} = this;<br/>        const paragraph = shadowRoot.querySelector('p');<br/>        paragraph.innerText = newVal;<br/>      }<br/>    }<br/>  }</span><span id="b1e7" class="lv kg hu lr b fv ms lx l ly lz">  customElements.define('nasa-apod', NasaApod);</span><span id="aadf" class="lv kg hu lr b fv ms lx l ly lz">}(document.currentScript.ownerDocument))</span><span id="a326" class="lv kg hu lr b fv ms lx l ly lz">&lt;/script&gt;</span></pre><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mv"><img src="../Images/edf9d71565615980d0a28fa9bf1881f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*w8NC1qt93rUJLYTe-tA1Zw.gif"/></div></div></figure><p id="928f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lm">注意:我在这个例子中使用了NASA的演示api-key，它的速率限制非常低。在https://api.nasa.gov</em><a class="ae li" href="https://api.nasa.gov" rel="noopener ugc nofollow" target="_blank"/>注册自己的(免费)api_key。</p></div></div>    
</body>
</html>