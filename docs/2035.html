<html>
<head>
<title>[MySQL] Note: Relation: 1–1, 1-n, n-n, nest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[MySQL]注意:关系:1–1，1-n，n-n，nest</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/mysql-tutorial-example-relation-foreign-key-database-funtion-join-table-query-one-namy-nest-41dd09648fbd?source=collection_archive---------1-----------------------#2017-01-03">https://medium.com/hackernoon/mysql-tutorial-example-relation-foreign-key-database-funtion-join-table-query-one-namy-nest-41dd09648fbd?source=collection_archive---------1-----------------------#2017-01-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/07059d4460feb7d72b3e526d919e9f3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tUtOa7_2qqEwm5wn4FGZqg.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">pixabay.com</figcaption></figure><blockquote class="jg"><p id="471a" class="jh ji hu bd jj jk jl jm jn jo jp jq ek translated">关系数据库的优势包括<strong class="ak"> <em class="jr">连接表查询</em> </strong>，避免数据重复，避免记录不一致，更好的安全性，迎合未来需求(tech-ict.com<a class="ae js" href="http://www.teach-ict.com/as_as_computing/ocr/H447/F453/3_3_9/database_design/miniweb/pg8.htm" rel="noopener ugc nofollow" target="_blank"/>)。</p></blockquote><p id="abd6" class="pw-post-body-paragraph jt ju hu jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp jq hn dt translated">在过去的几年里，我通过<strong class="jv hv"><em class="kq">【MongoDB】</em></strong>构建了几个电子商务或内容共享平台，并意识到对于复杂关系表(如用户、权限、产品或商店关系)的架构和快速移动的特性需求(它会导致记录/数据类型不一致)，它并不是一个理想的数据库。每隔几个月就会有新的需求出现，修改脏数据就像从我的屁股上拔牙一样。</p><h1 id="d2bc" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">内容</h1><ol class=""><li id="659c" class="lp lq hu jv b jw lr ka ls ke lt ki lu km lv jq lw lx ly lz dt translated">一对一关系</li><li id="27cc" class="lp lq hu jv b jw ma ka mb ke mc ki md km me jq lw lx ly lz dt translated">一对多关系</li><li id="deea" class="lp lq hu jv b jw ma ka mb ke mc ki md km me jq lw lx ly lz dt translated">n-n关系</li><li id="f821" class="lp lq hu jv b jw ma ka mb ke mc ki md km me jq lw lx ly lz dt translated">筑巢</li></ol><h2 id="c074" class="mf ks hu bd kt mg mh mi kx mj mk ml lb ke mm mn lf ki mo mp lj km mq mr ln ms dt translated">备注:</h2><p id="689b" class="pw-post-body-paragraph jt ju hu jv b jw lr jy jz ka ls kc kd ke mt kg kh ki mu kk kl km mv ko kp jq hn dt translated"><em class="kq">在本例中有一个默认的产品和供应商表</em></p><pre class="mw mx my mz fq na nb nc nd aw ne dt"><span id="f272" class="mf ks hu nb b fv nf ng l nh ni">mysql&gt; <strong class="nb hv">SHOW DATABASES;<br/></strong>mysql&gt; <strong class="nb hv">USE yourdatabse;<br/></strong>mysql&gt; <strong class="nb hv">CREATE TABLE product_details (<br/>          productID  INT UNSIGNED   NOT NULL,<br/>                     -- same data type as the parent table<br/>          comment    TEXT  NULL,<br/>                     -- up to 64KB<br/>          PRIMARY KEY (productID),<br/>          FOREIGN KEY (productID) REFERENCES products (productID)<br/>       );</strong><br/>mysql&gt; <strong class="nb hv">CREATE TABLE IF NOT EXISTS products (<br/>         productID    INT UNSIGNED  NOT NULL AUTO_INCREMENT,<br/>         productCode  CHAR(3)       NOT NULL DEFAULT '',<br/>         name         VARCHAR(30)   NOT NULL DEFAULT '',<br/>         quantity     INT UNSIGNED  NOT NULL DEFAULT 0,<br/>         price        DECIMAL(7,2)  NOT NULL DEFAULT 99999.99,<br/>         supplierID   INT UNSIGNED  NOT NULL DEFAULT 0,<br/>         PRIMARY KEY  (productID)<br/>       );</strong></span><span id="f1c3" class="mf ks hu nb b fv nj ng l nh ni"><strong class="nb hv">...</strong></span><span id="ee8e" class="mf ks hu nb b fv nj ng l nh ni">mysql&gt; <strong class="nb hv">UPDATE products SET supplierID = 501;</strong></span></pre><figure class="mw mx my mz fq iv fe ff paragraph-image"><div class="fe ff nk"><img src="../Images/4019c385272fdff9ba30fe4934ae53b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*yJ8kmB3Jp5kgqSScA_zP_w.png"/></div></figure></div><div class="ab cl nl nm hc nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="hn ho hp hq hr"><h1 id="c8ba" class="kr ks hu bd kt ku ns kw kx ky nt la lb lc nu le lf lg nv li lj lk nw lm ln lo dt translated">1)一对一关系</h1><p id="06c1" class="pw-post-body-paragraph jt ju hu jv b jw lr jy jz ka ls kc kd ke mt kg kh ki mu kk kl km mv ko kp jq hn dt translated">如果有另外一个表叫做<strong class="jv hv"><em class="kq">product _ details</em></strong>，用一对一的关系链接到产品上，如图。</p><figure class="mw mx my mz fq iv fe ff paragraph-image"><div class="fe ff nk"><img src="../Images/4019c385272fdff9ba30fe4934ae53b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*yJ8kmB3Jp5kgqSScA_zP_w.png"/></div></figure><h2 id="78fe" class="mf ks hu bd kt mg mh mi kx mj mk ml lb ke mm mn lf ki mo mp lj km mq mr ln ms dt translated">写入外键列</h2><pre class="mw mx my mz fq na nb nc nd aw ne dt"><span id="a48e" class="mf ks hu nb b fv nf ng l nh ni">mysql&gt; INSERT INTO product_details VALUES (1001, ‘good one’);</span></pre><h2 id="2b91" class="mf ks hu bd kt mg mh mi kx mj mk ml lb ke mm mn lf ki mo mp lj km mq mr ln ms dt translated">按外键列查询关系</h2><pre class="mw mx my mz fq na nb nc nd aw ne dt"><span id="965d" class="mf ks hu nb b fv nf ng l nh ni">mysql&gt; SELECT products.productID,price,product_details.comment<br/>       FROM products <br/>          <strong class="nb hv"><em class="kq">JOIN product_details ON products.productID = product_details.productID</em></strong><br/>       WHERE price &lt; 5;</span></pre><h1 id="0d05" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">2)一对多关系</h1><p id="9a06" class="pw-post-body-paragraph jt ju hu jv b jw lr jy jz ka ls kc kd ke mt kg kh ki mu kk kl km mv ko kp jq hn dt translated">假设每个产品有一个供应商，每个供应商供应一个或多个产品，<strong class="jv hv"> <em class="kq">供应商-产品是1-n关系模型</em> </strong>的基础。要实现1-n关系，技术上与1–1关系相同，只需确保不超过行与同一产品相关。</p><h2 id="17bf" class="mf ks hu bd kt mg mh mi kx mj mk ml lb ke mm mn lf ki mo mp lj km mq mr ln ms dt translated">创建外键列</h2><p id="4e29" class="pw-post-body-paragraph jt ju hu jv b jw lr jy jz ka ls kc kd ke mt kg kh ki mu kk kl km mv ko kp jq hn dt translated">将<code class="eh nx ny nz nb b">products</code>子表的<code class="eh nx ny nz nb b">supplierID</code>列的<strong class="jv hv"> <em class="kq">外键</em> </strong>添加到<code class="eh nx ny nz nb b">suppliers</code>父表:</p><ol class=""><li id="b17c" class="lp lq hu jv b jw oa ka ob ke oc ki od km oe jq lw lx ly lz dt translated">在产品表中添加INT类型的<strong class="jv hv"> <em class="kq"> supplierID </em> </strong>列</li><li id="8ad1" class="lp lq hu jv b jw ma ka mb ke mc ki md km me jq lw lx ly lz dt translated">设置所有<strong class="jv hv"> <em class="kq"> supplierID </em> </strong>的现有记录</li><li id="d403" class="lp lq hu jv b jw ma ka mb ke mc ki md km me jq lw lx ly lz dt translated">设置<strong class="jv hv"> <em class="kq"> supplierID </em> </strong>为外键列，由相关<strong class="jv hv"> <em class="kq">产品</em> </strong>表到父<strong class="jv hv"> <em class="kq">供应商表</em> </strong> mysql &gt; <strong class="jv hv"> ALTER表产品<br/>添加列supplierID INT UNSIGNED NOT NULL</strong></li></ol><pre class="mw mx my mz fq na nb nc nd aw ne dt"><span id="c537" class="mf ks hu nb b fv nf ng l nh ni">mysql&gt; <strong class="nb hv">UPDATE products SET supplierID = 501;</strong></span><span id="bbd5" class="mf ks hu nb b fv nj ng l nh ni">mysql&gt; <strong class="nb hv">ALTER TABLE products<br/>       ADD FOREIGN KEY (supplierID) REFERENCES suppliers (supplierID);</strong></span></pre><h2 id="e6dd" class="mf ks hu bd kt mg mh mi kx mj mk ml lb ke mm mn lf ki mo mp lj km mq mr ln ms dt translated">写入外键列</h2><p id="cb54" class="pw-post-body-paragraph jt ju hu jv b jw lr jy jz ka ls kc kd ke mt kg kh ki mu kk kl km mv ko kp jq hn dt translated">这和写一个INT列是一样的</p><pre class="mw mx my mz fq na nb nc nd aw ne dt"><span id="adf6" class="mf ks hu nb b fv nf ng l nh ni">mysql&gt; <strong class="nb hv">INSERT INTO products VALUES (1001, 'PEN', 'Pen Red', 5000, 1.23, 503);<br/></strong>Query OK, 1 row affected (0.00 sec)</span></pre><h2 id="ac64" class="mf ks hu bd kt mg mh mi kx mj mk ml lb ke mm mn lf ki mo mp lj km mq mr ln ms dt translated">按外键列查询关系</h2><pre class="mw mx my mz fq na nb nc nd aw ne dt"><span id="e285" class="mf ks hu nb b fv nf ng l nh ni">mysql&gt; SELECT products.name, price, suppliers.name <br/>       FROM products <br/>          <strong class="nb hv"><em class="kq">JOIN suppliers ON products.supplierID =  suppliers.supplierID</em></strong><br/>       WHERE price &lt; 5;</span></pre><h1 id="50a0" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">3)n-n关系</h1><p id="97a6" class="pw-post-body-paragraph jt ju hu jv b jw lr jy jz ka ls kc kd ke mt kg kh ki mu kk kl km mv ko kp jq hn dt translated">假设一个产品有很多供应商；一个供应商以所谓的多对多关系供应许多产品。<strong class="jv hv">对于多对多的关系，它需要第三表，称为连接表。</strong></p><h2 id="d16e" class="mf ks hu bd kt mg mh mi kx mj mk ml lb ke mm mn lf ki mo mp lj km mq mr ln ms dt translated">创建连接表<strong class="ak">产品_供应商</strong></h2><pre class="mw mx my mz fq na nb nc nd aw ne dt"><span id="82a1" class="mf ks hu nb b fv nf ng l nh ni">mysql&gt; <strong class="nb hv">CREATE TABLE products_suppliers (<br/>         productID   INT UNSIGNED  NOT NULL,<br/>         supplierID  INT UNSIGNED  NOT NULL,<br/>                     -- Same data types as the parent tables<br/>         PRIMARY KEY (productID, supplierID),<br/>                     -- uniqueness<br/>         FOREIGN KEY (productID)  REFERENCES products  (productID),<br/>         FOREIGN KEY (supplierID) REFERENCES suppliers (supplierID)<br/>       );</strong></span></pre><h2 id="0643" class="mf ks hu bd kt mg mh mi kx mj mk ml lb ke mm mn lf ki mo mp lj km mq mr ln ms dt translated">插入关系</h2><pre class="mw mx my mz fq na nb nc nd aw ne dt"><span id="ad11" class="mf ks hu nb b fv nf ng l nh ni">mysql&gt; <strong class="nb hv">INSERT INTO products_suppliers VALUES (1001, 501), (1001, 503), (1002, 501), (1003, 501), (1004, 502);</strong></span></pre><h2 id="5185" class="mf ks hu bd kt mg mh mi kx mj mk ml lb ke mm mn lf ki mo mp lj km mq mr ln ms dt translated">查询3相关表</h2><p id="1b40" class="pw-post-body-paragraph jt ju hu jv b jw lr jy jz ka ls kc kd ke mt kg kh ki mu kk kl km mv ko kp jq hn dt translated">使用<code class="eh nx ny nz nb b">SELECT</code>和<code class="eh nx ny nz nb b">JOIN</code>从3个表中查询数据，例如:</p><pre class="mw mx my mz fq na nb nc nd aw ne dt"><span id="d71a" class="mf ks hu nb b fv nf ng l nh ni">mysql&gt; SELECT products.name AS `Product Name`, price, suppliers.name AS `Supplier Name`<br/>       FROM products_suppliers <br/>          JOIN products  ON products_suppliers.productID = products.productID<br/>          JOIN suppliers ON products_suppliers.supplierID = suppliers.supplierID<br/>       WHERE price &lt; 5 AND products.name = "Pen Red1" AND suppliers.name = "QQ Corp";</span></pre></div><div class="ab cl nl nm hc nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="hn ho hp hq hr"><h1 id="e68d" class="kr ks hu bd kt ku ns kw kx ky nt la lb lc nu le lf lg nv li lj lk nw lm ln lo dt translated">摘要</h1><p id="d639" class="pw-post-body-paragraph jt ju hu jv b jw lr jy jz ka ls kc kd ke mt kg kh ki mu kk kl km mv ko kp jq hn dt translated">如果您使用多对多关系，您必须引入一个<em class="kq">连接</em>表(或连接表),它保存两个参与表的外键，这进一步增加了连接操作的成本。</p><h1 id="5392" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">你可能也喜欢</h1><ul class=""><li id="27b6" class="lp lq hu jv b jw lr ka ls ke lt ki lu km lv jq of lx ly lz dt translated"><a class="ae js" rel="noopener" href="/curiousian/mysql-handbook-tutorial-example-for-beginner-setup-admin-query-curd-relation-583b05106c1f#.v7tni8uoj"> MySQL手册</a></li><li id="23c2" class="lp lq hu jv b jw ma ka mb ke mc ki md km me jq of lx ly lz dt translated"><a class="ae js" href="https://hackernoon.com/nodejs-mysql-install-setup-tutorial-example-connection-insert-query-fd5c5032d3b0#.hpp65qg28" rel="noopener ugc nofollow" target="_blank">【MySQL】注意:在Node.js中快速设置和运行</a></li><li id="976c" class="lp lq hu jv b jw ma ka mb ke mc ki md km me jq of lx ly lz dt translated"><a class="ae js" href="https://hackernoon.com/mysql-note-create-admin-user-5e77b43ecc8e#.uncmszepg" rel="noopener ugc nofollow" target="_blank">【MySQL】注意:创建管理员用户</a></li><li id="ee9a" class="lp lq hu jv b jw ma ka mb ke mc ki md km me jq of lx ly lz dt translated"><a class="ae js" href="https://hackernoon.com/mysql-note-database-curd-b62a21404678#.jm4eqcmgu" rel="noopener ugc nofollow" target="_blank">【MySQL】注:数据库凝乳</a></li><li id="f50c" class="lp lq hu jv b jw ma ka mb ke mc ki md km me jq of lx ly lz dt translated"><a class="ae js" rel="noopener" href="/hacker-daily/mysql-tutorial-query-limit-offset-condition-row-foreign-key-join-select-d3835b28e1a#.dob477vn4">【MySQL】注:排凝乳</a></li><li id="b4c0" class="lp lq hu jv b jw ma ka mb ke mc ki md km me jq of lx ly lz dt translated"><a class="ae js" href="https://hackernoon.com/mysql-tutorial-example-relation-foreign-key-database-funtion-join-table-query-one-namy-nest-41dd09648fbd" rel="noopener ugc nofollow" target="_blank">【MySQL】注:关系:1–1，1-n，n-n，嵌套</a></li></ul><p id="3b44" class="pw-post-body-paragraph jt ju hu jv b jw oa jy jz ka ob kc kd ke og kg kh ki oh kk kl km oi ko kp jq hn dt translated"><em class="kq">非常感谢</em><a class="ae js" href="https://www.ntu.edu.sg/home/ehchua/programming/sql/MySQL_Beginner.html" rel="noopener ugc nofollow" target="_blank"><em class="kq">NTU</em></a><em class="kq">的社区，他们贡献了这么好的教程和有价值的例子。</em></p></div><div class="ab cl nl nm hc nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="hn ho hp hq hr"><h1 id="8482" class="kr ks hu bd kt ku ns kw kx ky nt la lb lc nu le lf lg nv li lj lk nw lm ln lo dt translated">参考:</h1><p id="8ff9" class="pw-post-body-paragraph jt ju hu jv b jw lr jy jz ka ls kc kd ke mt kg kh ki mu kk kl km mv ko kp jq hn dt translated"><a class="ae js" href="https://www.ntu.edu.sg/home/ehchua/programming/sql/MySQL_Beginner.html" rel="noopener ugc nofollow" target="_blank">https://www . NTU . edu . SG/home/ehchua/programming/SQL/MySQL _ beginner . html</a></p><div class="mw mx my mz fq ab cb"><figure class="oj iv ok ol om on oo paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="oj iv ok ol om on oo paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="oj iv ok ol om on oo paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="op oq or"><p id="f922" class="jt ju kq jv b jw oa jy jz ka ob kc kd os og kg kh ot oh kk kl ou oi ko kp jq hn dt translated"><a class="ae js" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是这个家庭的一员。我们现在<a class="ae js" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae js" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jt ju kq jv b jw oa jy jz ka ob kc kd os og kg kh ot oh kk kl ou oi ko kp jq hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae js" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae js" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="mw mx my mz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ov"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>