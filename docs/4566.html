<html>
<head>
<title>The Network Stack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络堆栈</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-network-stack-153c92e35b26?source=collection_archive---------23-----------------------#2017-06-07">https://medium.com/hackernoon/the-network-stack-153c92e35b26?source=collection_archive---------23-----------------------#2017-06-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="782c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你一直在阅读关于Linux名称空间的文章/书籍，你可能会遇到这种说法的变体"<strong class="it hv">每个网络名称空间都有它自己的网络栈</strong>"。</p><p id="ed67" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你以前看过这个，你可能会想知道它到底是什么意思？这似乎是非常抽象的东西，就像有人会猜测，然后一个名称空间将有它自己的和隔离的“方法/函数”来管理进出的网络连接？</p><p id="0ad9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我想说的是，一个“<strong class="it hv">网络栈</strong>对我来说没有意义，它太抽象了，我很想知道一个“<strong class="it hv">网络栈</strong>在内核中是什么样子的。</p><p id="8ab7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是我发现的，大多数书都称“<strong class="it hv">网络栈</strong>”为Linux内核中最基本的数据结构之一，<strong class="it hv"> struct net </strong>。</p><p id="46d5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Struct net位于<a class="ae jp" href="https://github.com/torvalds/linux/blob/master/include/net/net_namespace.h#L48" rel="noopener ugc nofollow" target="_blank"> net_namespace.h </a>中，应该是这样的:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><p id="cbf6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，想法是每个<strong class="it hv">名称空间</strong>至少持有一个<strong class="it hv">结构网</strong>(可以是多个，因为名称空间可以是递归的)。</p><p id="d6b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个结构非常重要，因为它将在用于<strong class="it hv">forward/transmit</strong>(xmit)skb<strong class="it hv">(socket buffers</strong>)的方法中传递，这个结构几乎总是比<strong class="it hv"> xmit </strong>函数要求的参数多一个参数:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff jx"><img src="../Images/ca4f471da4e99db68166a5eb4e0f2531.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mkw7nwUWac3U10mhOk3M1A.png"/></div></div></figure><p id="2785" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Struct net很庞大，但是稍微探索一下，你会发现很多有趣的东西，例如从<strong class="it hv"> struct net_device </strong>到<strong class="it hv"> loopback </strong>的指针，因此当我们创建一个新的名称空间时，我们总是会得到一个loopback:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff ke"><img src="../Images/f2ac8c396d707441e77ad46a854106c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i5vEwZOAsw2KPhRsTnqDEQ.png"/></div></div></figure><p id="8aab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">无论如何，这是目前，我想保持这些到最低限度。</p><p id="f98c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">谢谢大家的观点和阅读。</p><div class="jq jr js jt fq ab cb"><figure class="kf ju kg kh ki kj kk paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="kf ju kg kh ki kj kk paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="kf ju kg kh ki kj kk paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="kl km kn"><p id="f922" class="ir is ko it b iu iv iw ix iy iz ja jb kp jd je jf kq jh ji jj kr jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是这个家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is ko it b iu iv iw ix iy iz ja jb kp jd je jf kq jh ji jj kr jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff ks"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>