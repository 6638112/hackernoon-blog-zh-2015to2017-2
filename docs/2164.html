<html>
<head>
<title>How I built a super fast Uber clone for mobile web</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何为移动网络建立一个超快的优步克隆</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-i-built-a-super-fast-uber-clone-for-mobile-web-863680d2100f?source=collection_archive---------2-----------------------#2017-01-10">https://medium.com/hackernoon/how-i-built-a-super-fast-uber-clone-for-mobile-web-863680d2100f?source=collection_archive---------2-----------------------#2017-01-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4f1b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这篇文章是关于我的<a class="ae jp" href="https://hackernoon.com/tagged/learning" rel="noopener ugc nofollow" target="_blank">学习</a>使用<a class="ae jp" href="https://hackernoon.com/tagged/react" rel="noopener ugc nofollow" target="_blank">让优步移动网络尽可能快地反应</a>的性能技巧。</p><p id="cbe8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Flipkart Lite推出已经一年了，Housing Go推出也有几个月了，我一直对移动网络的未来很感兴趣，我想尝试一下。</p><p id="b208" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我需要一个可以实现perf技术的应用程序，优步最近刚刚推出了他们的新设计的应用程序，它看起来很有前途，所以我决定使用React克隆这个应用程序。</p><p id="a705" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我花了一些时间来构建应用程序的基本实现，我使用了<a class="ae jp" href="https://github.com/uber/react-map-gl" rel="noopener ugc nofollow" target="_blank">https://github.com/uber/react-map-gl</a>来绘制地图，并使用<code class="eh jq jr js jt b">svg-overlay</code>来创建从源和目的地以及<code class="eh jq jr js jt b">html-overlay.</code>的路径</p><p id="5c2b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是有基本交互的app的gif。</p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div class="fe ff ju"><img src="../Images/07a357d8b16a1ed9bbeef4f75664ae47.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*VafcAamXnGXW1VXasjjLxg.gif"/></div></figure><p id="5cb5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我有了基本的应用程序，我开始改进它的性能。</p><p id="71de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经用<a class="ae jp" href="https://github.com/GoogleChrome/lighthouse" rel="noopener ugc nofollow" target="_blank"> Chrome Lighthouse </a>检查了web app在各个阶段的表现。</p><p id="c2c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最初的加载时间是这样的。</p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff kc"><img src="../Images/6d8645ab67752b384ce518908cb5c8d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0qW1NDfHCQSE3rrxgpB85A.png"/></div></div></figure><h1 id="a5ed" class="kh ki hu bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">为了提高上面的属性，我使用了下面的技巧</h1><p id="cd7b" class="pw-post-body-paragraph ir is hu it b iu lf iw ix iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo hn dt translated"><strong class="it hv"> <em class="lk">代码分割——将加载时间从19秒减少到4秒<br/> </em> </strong>我做的第一件事是使用<a class="ae jp" href="https://webpack.github.io/docs/code-splitting.html" rel="noopener ugc nofollow" target="_blank"> webpack代码分割</a>技术，根据路线将应用程序分成不同的块，并加载特定路线所需的内容。</p><p id="9630" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我通过使用<code class="eh jq jr js jt b">react-router</code>的<code class="eh jq jr js jt b">getComponent</code> api做到了这一点，其中我只在请求路线时才需要组件。</p><figure class="jv jw jx jy fq jz"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="c1ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我还使用webpack中的<a class="ae jp" href="https://webpack.github.io/docs/list-of-plugins.html#commonschunkplugin" rel="noopener ugc nofollow" target="_blank"> CommonChunkPlugin </a>提取了供应商代码。</p><figure class="jv jw jx jy fq jz"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="e444" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有了这个，我把加载时间从19秒减少到了4秒。</p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff kc"><img src="../Images/191bb5f4903329f9a61db45f72f4e489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*coCCoCJszIAb24lJOY0yJA.png"/></div></div><figcaption class="ln lo fg fe ff lp lq bd b be z ek">Performance metrics using code splitting</figcaption></figure><p id="d3c2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> <em class="lk"> 2。服务器端渲染—将加载时间从4秒减少到921毫秒<br/> </em> </strong>然后，我通过在服务器上渲染初始路线并传递给客户端来实现SSR。</p><p id="7970" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我在后端使用了Express，并使用了<code class="eh jq jr js jt b">react-router</code>的<code class="eh jq jr js jt b">match</code> api</p><figure class="jv jw jx jy fq jz"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="1dab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">多亏了SSR，现在加载时间是921毫秒。</p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff lr"><img src="../Images/e8acfadebd76578d0028a32cb3544004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pjqE_HYJ9QhjROJJ_RyVog.png"/></div></div><figcaption class="ln lo fg fe ff lp lq bd b be z ek">Performance metrics using SSR</figcaption></figure><p id="7454" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> <em class="lk"> 3。压缩静态资产— </em> </strong> <em class="lk"> </em> <strong class="it hv"> <em class="lk">将加载时间从921毫秒减少到546毫秒<br/> </em> </strong>然后我决定压缩所有的静态文件，这是通过使用webpack中的<a class="ae jp" href="https://github.com/webpack/compression-webpack-plugin" rel="noopener ugc nofollow" target="_blank"> CompressionPlugin </a>实现的</p><figure class="jv jw jx jy fq jz"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="ab28" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和<a class="ae jp" href="https://github.com/tkoenig89/express-static-gzip" rel="noopener ugc nofollow" target="_blank"> express-static-gzip </a>来提供来自服务器的压缩文件，如果没有找到所需的文件，则退回到未压缩状态。</p><figure class="jv jw jx jy fq jz"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="89cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">耶，我保存了将近400毫秒。干得好，纳伦德拉！</p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff ls"><img src="../Images/cadf090cc3712447e325066cbb68e773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXiQJMHEFRZkpZjmGKTybA.png"/></div></div><figcaption class="ln lo fg fe ff lp lq bd b be z ek">Performance metrics after compressing the assets</figcaption></figure><p id="3904" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> <em class="lk"> 4。缓存—帮助将重复访问的加载时间从大约500毫秒缩短到大约300毫秒<br/> </em> </strong>现在，我已经将我的web应用程序的性能从19秒提高到546毫秒，我希望缓存静态资产，以便加快重复访问的速度。</p><p id="386a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我通过在支持服务人员的浏览器上使用<code class="eh jq jr js jt b">sw-toolbox</code>来做到这一点</p><figure class="jv jw jx jy fq jz"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="86a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和不支持的浏览器的标题。</p><figure class="jv jw jx jy fq jz"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="e5e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过这样做，我将重复访问时间缩短了大约200毫秒。</p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff lt"><img src="../Images/65491a4dcb9242d4f7bdab844e5a9181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T0pk7v_1TOh58Jq3C1whiQ.png"/></div></div><figcaption class="ln lo fg fe ff lp lq bd b be z ek">Repeat visit without service worker</figcaption></figure><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff lu"><img src="../Images/9ddd5946a8cc6b259877c3ae41631d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fz5fap_8Y1qIgi9Umhm4kg.png"/></div></div><figcaption class="ln lo fg fe ff lp lq bd b be z ek">Repeat visit with service worker</figcaption></figure><p id="aa62" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> 5。预加载然后加载<br/> </strong>我在<code class="eh jq jr js jt b">head</code>标签中使用了<code class="eh jq jr js jt b">&lt;link rel="preload" ... as="script"&gt;</code>，在不支持预加载的浏览器中使用了<code class="eh jq jr js jt b">prefetch</code>。在主体的最后，我在一个常规的<code class="eh jq jr js jt b">&lt;script&gt;</code>标签中加载了应用程序JS。<br/>有关预加载和预取的更多信息，请访问<a class="ae jp" href="https://css-tricks.com/prefetching-preloading-prebrowsing/" rel="noopener ugc nofollow" target="_blank">https://css-tricks.com/prefetching-preloading-prebrowsing/</a></p><p id="3f4c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后用谷歌页面速度测试，这是结果</p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff lv"><img src="../Images/6ff281517b2d439565464bc41638f686.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FKPoRNdWWfp9NiYtWMCwuQ.png"/></div></div><figcaption class="ln lo fg fe ff lp lq bd b be z ek">Scores from <a class="ae jp" href="https://testmysite.thinkwithgoogle.com/intl/en-in" rel="noopener ugc nofollow" target="_blank">PageSpeed Insights</a></figcaption></figure><p id="72f2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这对我是一个很好的学习，我知道我可以优化更多，并将继续探索。绩效改进是一个持续的过程，这只是我所取得成就的一个基准。试试你的应用程序，让我知道你的故事。</p><p id="ec5c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">github:<a class="ae jp" href="https://github.com/narendrashetty/uber-mobile-web" rel="noopener ugc nofollow" target="_blank">https://github.com/narendrashetty/uber-mobile-web</a><br/>现场演示:<a class="ae jp" href="https://uberweb-v2.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://uberweb.herokuapp.com/</a>或者<br/><a class="ae jp" href="https://uberweb-v2.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://uberweb-v2.herokuapp.com/</a></p><p id="0e79" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请在您的手机浏览器上观看演示，并与我分享您的意见。(因为我在heroku上托管了它，所以当它没有人访问时就会关闭。如果一开始加载不了也不要失去耐心:P这么讽刺)。</p><p id="9017" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">保持性能就像下棋一样，走错一步就会前功尽弃。</p><p id="6670" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">感谢您的阅读，如果您喜欢这篇文章，请点击“推荐”或在下面写一个回复。你可以在推特上联系我<a class="ae jp" href="https://twitter.com/narendra_shetty" rel="noopener ugc nofollow" target="_blank"> @narendra_shetty </a>。</p><div class="jv jw jx jy fq ab cb"><figure class="lw jz lx ly lz ma mb paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lw jz lx ly lz ma mb paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lw jz lx ly lz ma mb paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mc md me"><p id="f922" class="ir is lk it b iu iv iw ix iy iz ja jb mf jd je jf mg jh ji jj mh jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is lk it b iu iv iw ix iy iz ja jb mf jd je jf mg jh ji jj mh jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff mi"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="jv jw jx jy fq jz"><div class="bz el l di"><div class="mj lm l"/></div></figure></div></div>    
</body>
</html>