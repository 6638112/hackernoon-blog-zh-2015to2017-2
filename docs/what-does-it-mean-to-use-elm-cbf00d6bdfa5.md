# 用榆树是什么意思？

> 原文：<https://medium.com/hackernoon/what-does-it-mean-to-use-elm-cbf00d6bdfa5>

学习一门新的[编程](https://hackernoon.com/tagged/programming)语言似乎每次都遵循相同的步骤:安装、Hello World、算术、一些很酷的功能，然后你就拥有了自己的语言。虽然导游可能会在你的旅程开始时提供一些流行语，但要看到森林的树木并意识到这种新语言的独特性、值得了解和使用并不容易。

这是我最近才明白的一点。当我们在录制《T4》榆树镇播客第八集时，墨菲·兰德尔和我扯到了哈斯克尔。他说:

> 当我读 Haskell 的时候，我真的不明白为什么，为什么我读的所有的书都在谈论类型类，应用函数，函子等等。我为什么在乎？一年来，这种语言并没有真正成为一种语言。学习使用语言就是学习那些东西是什么。

我最近也在看一堆 Ruby 大会的讲座。一个常见的主题是随着应用程序的老化和遗留代码的积累，重构和发展应用程序。这些 OOP 大师传播他们的设计模式和代码味道的知识，旨在指导他们的追随者何时以及如何提取一个对象。从表面上看，Ruby 关心的是类、继承、对象和方法。但是据我所知，Ruby 实际上是关于对象可以扮演的角色，以及在这些角色之间划分职责和知识。它是关于用几十或几百行程序代码来交换一组连贯的、松散耦合的对象及其消息。

所有这些都引出了一个问题，使用 Elm 意味着什么？这门语言到底是关于什么的？这些原则给你带来了什么？学习语法和库而不真正理解他们试图讲述的故事是可能的。如果他们会说话，我想他们会这么说。

![](img/4f6972389d772a2d6116c43746531a90.png)

Elm enforces a strict separation between the programmer and effects. The effects must be handled carefully, but the rest of the program is much less constrained. (Photo: ESA Astronaut André Kuipers in 2009)

编写 Elm 代码的基本原则是将效果从计算中分离出来，并对每种效果使用不同的技术。

所有的计算都是“纯”的，这意味着函数返回什么只取决于它的参数。这是可以预测的，也很容易理解。

“效果”就是其他一切。这些可以是随机数生成(如果您没有显式地管理种子)、当前时间，当然，也可以是来自外部世界的任何东西。所以网络请求、本地存储和 URL 都是影响。毕竟，我们没有办法保证 HTTP 请求每次都会返回相同的内容。

Elm 将效果分开，使它们更难使用，因此计算更容易编写。这样做的原因是你的大部分代码是计算，而不是效果。有一些通用策略可以帮助你编写计算代码:

*拥抱管道*。如果 C 是一系列不太明显的机器指令，而 Ruby 是一系列对象之间的消息，那么 Elm 代码通常采用一系列转换的形式。这些通常由| >操作符连接。如果您需要直觉，请考虑 UNIX 管道。它用于将数据从一个操作传递到下一个操作。(此外，它是由编译器优化的，因此不会比圆括号更贵。)这里有个例子:

```
sanitize : String -> Maybe Float
sanitize token =
  token
    |> String.trim
    |> String.toFloat
    |> Result.toMaybesumOfString : Float
sumOfString =
  commaSeparatedFloats
    |> String.split ","
    |> List.filterMap sanitize
    |> List.sum
```

*提取功能*。没有人喜欢给一个函数传递大量的参数，不管是什么语言。但是在 Elm 中，您特别需要找到一个地方，在那里可以干净地拆分计算，传递最少的状态。这导致了连贯的功能:它们很好地完成一件事。相同的属性使得函数是可测试的:没有隐藏状态可模仿。分解函数有助于将算法分解成有用的、可能可重用的代码块。

*建模问题*。在 Elm 中，数据是哑的，但是可预测的。(对比 OOP，数据是隐藏的，和行为捆绑在一起。)你应该明确地描述你在做什么。不同的州应该分开。不可能的国家不应该有代表性。通常这意味着定义联合类型，然后使用 case 语句处理每个可能的值。您可以使用类型别名来表示值的含义(例如 URL、PersonID、ShoppingCartItem)，而不是表示值的方式(例如字符串、整数、记录)。

*编译器是你的助手*。使用类型注释来指定您的意图，因为代码被读取的次数远远多于它被编写的次数。适应映射几乎任何东西的想法；你会及时发现其他有用的模式和习惯用法。对于应用程序，不要担心大量代码是否知道模型是如何定义的；如果你改变它，编译器会告诉你什么中断了。(对于库，您应该尝试隐藏实现，以避免做出破坏性的更改。)不，但是说真的:Elm 的编译器消息不同于你在 C 语言中看到的任何东西。

这是对计算代码工具箱的高级概述。当需要处理这些讨厌的影响时，纯计算的一切仍然有效。您显式地对消息类型建模，并在一个巨大的 case 语句中使用它。编译器仍然会给你有用的错误信息，如果你真的需要，你可以写一些函数来管理效果，管道操作符仍然有效。只有一个主要的补充:榆树建筑。

人们亲切地称 TEA 为处理程序外围效果的一种模式，每个 Elm 程序都使用它。如果你没有看过[指南](https://guide.elm-lang.org/architecture/)，大意是你定义了一个模型类型和一个 Msg(消息)类型。当消息传入您的应用程序时，您更新模型，该模型被传递给创建虚拟 DOM 的视图函数(如 React)。你也可以向外界发送信息。

您为 TEA 定义了更新、查看和一些其他函数，Elm 运行时会在必要时调用它们。所有的计算——记住，大部分程序——都是从这些函数中的一个调用的。

所以，也许榆树的秘密就是没有秘密。你不需要像在 Haskell 中那样预先学习很多抽象。你不必像在 Ruby 中那样，为了避免六个月内的灾难而做得完全正确。Elm 不鼓励事后批评自己:如果代码做了你想让它做的事情，它可能是好的。以后很容易改变，所以现在不要担心变得完美。

所以试试吧。你可能会惊讶于它的工作效率。

[![](img/50ef4044ecd4e250b5d50f368b775d38.png)](http://bit.ly/HackernoonFB)[![](img/979d9a46439d5aebbdcdca574e21dc81.png)](https://goo.gl/k7XYbx)[![](img/2930ba6bd2c12218fdbbf7e02c8746ff.png)](https://goo.gl/4ofytp)

> [黑客中午](http://bit.ly/Hackernoon)是黑客如何开始他们的下午。我们是 [@AMI](http://bit.ly/atAMIatAMI) 家庭的一员。我们现在[接受投稿](http://bit.ly/hackernoonsubmission)并乐意[讨论广告&赞助](mailto:partners@amipublications.com)机会。
> 
> 如果你喜欢这个故事，我们推荐你阅读我们的[最新科技故事](http://bit.ly/hackernoonlatestt)和[趋势科技故事](https://hackernoon.com/trending)。直到下一次，不要把世界的现实想当然！

![](img/be0ca55ba73a573dce11effb2ee80d56.png)