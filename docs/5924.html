<html>
<head>
<title>Why and How to implement Web Notification API.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么以及如何实现Web通知API。</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/why-and-how-to-implement-web-notification-api-4eb795c5b05d?source=collection_archive---------0-----------------------#2017-08-24">https://medium.com/hackernoon/why-and-how-to-implement-web-notification-api-4eb795c5b05d?source=collection_archive---------0-----------------------#2017-08-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/b2c3e98f6b6e627c7281269ab8bb1de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2nrOrpLRtgn6S6JxdfsUKw.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Web Notification API in action on desktop browsers and Android devices.</figcaption></figure><p id="3fc8" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在大多数网站都使用网络通知API，比如脸书，Twitter，Flowdock，Slack …你说吧。想过这是怎么发生的吗？想要实施它，但是困难和对学习曲线的恐惧正在驱使你离开？让我告诉你，它只有几行代码，即使初学者也能理解并开始编写。所以不要犹豫，马上和我一起实施吧。</p><p id="e3db" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">首先，我们需要检查我们的浏览器是否支持通知。你可能想知道每个人都这样做，为什么我要检查它？这是网络，市场上有n种浏览器，每种平台都有。对于如此众多的浏览器，我们无法知道谁支持谁不支持。所以预防胜于治疗，因此，我建议我们在你的用户在不同的浏览器上发疯之前检查一下。此外，测试这些代码的最好方法是立即在浏览器控制台上输入所有内容。</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="524c" class="kn ko hu kj b fv kp kq l kr ks">if (‘Notification’ in window) {<br/> alert(“Congrats you are using a modern browser and it supports Notification”);<br/>}</span></pre><p id="b49e" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><em class="kt">注意:目前对于移动设备来说，只有Android支持这一功能，Android也不是核心的Web通知API，而是WebKit的混合版本。点击</em> <a class="ae ku" href="http://caniuse.com/#search=Web%20Notifications" rel="noopener ugc nofollow" target="_blank"> <em class="kt">我可以使用Web通知</em> </a> <em class="kt">了解支持的平台和浏览器。</em></p><p id="1722" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">接下来，我们需要请求允许在我们网站的浏览器上通知。还记得脸书手机和桌面上的弹出窗口吗？</p><figure class="ke kf kg kh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kv"><img src="../Images/77fe85fa6e4e4b5de7856b5d57c2cd22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uhvYqcxn1Osm9QZV2UZ6HQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Facebook Web Notification for Chrome for Desktop and Chrome for Android</figcaption></figure><p id="796b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">是的，这正是这部分代码要做的。请记住，如果用户阻止来自您的域的通知，您将无法再次要求他/她允许通知访问，除非他/她非常需要您的通知，并且他/她决定转到设置并手动允许来自浏览器的通知。如果你想对你之前屏蔽的一些域名进行手动操作，这里有一些链接，供<a class="ae ku" href="https://support.google.com/chrome/answer/3220216?co=GENIE.Platform=Desktop&amp;hl=en" rel="noopener ugc nofollow" target="_blank"> Chrome </a>和<a class="ae ku" href="https://support.mozilla.org/en-US/kb/push-notifications-firefox" rel="noopener ugc nofollow" target="_blank"> Firefox </a>使用。现在让我们看看代码</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="1d63" class="kn ko hu kj b fv kp kq l kr ks">requestDesktopNotificationPermission(){<br/> if(Notification &amp;&amp; Notification.permission === 'default') {<br/>   Notification.requestPermission(function (permission) {<br/>      if(!('permission' in Notification)) {<br/>        Notification.permission = permission;<br/>      }<br/>   });<br/> }<br/>}</span></pre><p id="d751" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这很好，但是我如何显示我的通知弹出窗口及其内容呢？这正是我们现在要看的。让我们看一些通知示例，并尝试了解它们的外观以及它们的组件。</p><figure class="ke kf kg kh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kw"><img src="../Images/24628431815800a96c040c21688c5881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p-lpleBYczbN_pNmdLyz3g.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Components of Notification API</figcaption></figure><p id="8b44" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我现在从代码开始，稍后解释每个部分</p><pre class="ke kf kg kh fq ki kj kk kl aw km dt"><span id="e42a" class="kn ko hu kj b fv kp kq l kr ks">//1.check permission <br/>//we can request permission here again if its value is 'default' //using the previously discussed code</span><span id="7712" class="kn ko hu kj b fv kx kq l kr ks">desktopNotification: function() {<br/>    if (Notification.permission === “granted”) {<br/>      var text = "your Notification Body goes here";<br/>      this.sendDesktopNotification(text);<br/>    }<br/>  },</span><span id="8def" class="kn ko hu kj b fv kx kq l kr ks">//2. send Notification<br/>sendDesktopNotification: function(text) {<br/>    let notification = new Notification(‘Your Page Title’, {<br/>      icon: ‘https://your_domain.com/your_web_page_image_icon.png’,<br/>      body: text,<br/>      tag: ‘soManyNotification’<br/>    });<br/>    //’tag’ handles muti tab scenario i.e when multiple tabs are <br/>    // open then only one notification is sent</span><span id="24dc" class="kn ko hu kj b fv kx kq l kr ks">//3. handle notification events and set timeout <br/>notification.onclick = function() {<br/>      parent.focus();<br/>      window.focus(); //just in case, older browsers<br/>      this.close();<br/>    };<br/>    setTimeout(notification.close.bind(notification), 5000);<br/>  }</span></pre><ol class=""><li id="8b2a" class="ky kz hu ji b jj jk jn jo jr la jv lb jz lc kd ld le lf lg dt translated"><strong class="ji hv">检查权限</strong> <br/>在继续创建通知之前，我们需要检查我们是否拥有来自用户的通知访问权限。如果' notification . permission = = = " default " '那么我们可以使用前面讨论的代码请求权限。如果许可被阻止，我们不想继续，因为即使我们试图显示它，它也不会显示。</li><li id="3688" class="ky kz hu ji b jj lh jn li jr lj jv lk jz ll kd ld le lf lg dt translated"><strong class="ji hv">创建并发送通知<br/> </strong>现在我们需要使用通知构造函数来创建一个通知实例，它以图标、标题、正文和标签作为参数。上面的代码和代码上面的通知截图非常简单明了。</li><li id="a715" class="ky kz hu ji b jj lh jn li jr lj jv lk jz ll kd ld le lf lg dt translated"><strong class="ji hv">处理通知事件并设置超时<br/> </strong>该部分定义了当用户点击通知时会发生什么。在大多数情况下，我们希望将用户重定向到我们的网页或我们应用程序的某些特定页面。我们可以在这里通过给出动态网页URL或者简单地使用<code class="eh lm ln lo kj b">parent.focus(;)</code>或<code class="eh lm ln lo kj b">window.focus();</code>来定义(我们使用两者是因为一些浏览器与<code class="eh lm ln lo kj b">parent.focus()</code>不兼容)。一旦用户点击通知，我们已经完成重定向到适当的页面，然后我们想关闭通知，所以我们使用<code class="eh lm ln lo kj b">this.close();</code>我们也可以控制多长时间这个通知出现在用户面前。这可以通过使用<code class="eh lm ln lo kj b">setTimeout()</code>来完成。它还在一个<code class="eh lm ln lo kj b"><a class="ae ku" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setTimeout" rel="noopener ugc nofollow" target="_blank">setTimeout()</a></code>函数中调用<code class="eh lm ln lo kj b">close()</code>在5秒钟后关闭通知(有些浏览器会自动关闭衍生通知，有些如Chrome和Opera则不会。)还要注意使用<code class="eh lm ln lo kj b"><a class="ae ku" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" rel="noopener ugc nofollow" target="_blank">bind()</a></code>来确保<code class="eh lm ln lo kj b">close()</code>调用与通知相关联。</li></ol><p id="ac92" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">感谢阅读。希望它能帮助你为你的web应用程序创建web通知。</p></div></div>    
</body>
</html>