<html>
<head>
<title>TensorFlow (GPU) Setup for Developers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向开发人员的TensorFlow (GPU)设置</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/tensorflow-gpu-setup-for-developers-7371ec0f04de?source=collection_archive---------19-----------------------#2017-10-31">https://medium.com/hackernoon/tensorflow-gpu-setup-for-developers-7371ec0f04de?source=collection_archive---------19-----------------------#2017-10-31</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/199bf2e3e94bd593eeab20887a726689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*Pgd8qomkwTZG_PbBuzxFaQ.png"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">tensorflow, machine learning, gpu, setup-guide</figcaption></figure><h1 id="8fb9" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">介绍</h1><p id="219e" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">…适用于希望使用TensorFlow运行一些很酷的模型或实验的开发人员(在GPU上进行更高强度的训练)。这可能不适合专业数据科学家或任何创建实际模型的人——我想他们的设置可能会更冗长一些。</p><p id="6051" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">这篇博文将涵盖我用<a class="ae ld" href="https://hackernoon.com/tagged/gpu" rel="noopener ugc nofollow" target="_blank"> GPU </a>支持设置/构建TensorFlow的手工实现。我已经花了相当多的时间阅读帖子和进行演练…并从中学习了很多…所以我拼凑了这个安装指南，我一直在使用它(应该很快就会有CloudFormation脚本)。很明显，通过pip/conda可以进行简单的安装，但是我们想要手动构建TF并让它在GPU上运行……本安装指南仍然针对简单/默认的配置和设置。</p><p id="aa0a" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">核心(我们将继续讨论这些内容):</p><ul class=""><li id="5b99" class="le lf hu kc b kd ky kh kz kl lg kp lh kt li kx lj lk ll lm dt translated">AWS EC2 p2.xlarge</li><li id="12a5" class="le lf hu kc b kd ln kh lo kl lp kp lq kt lr kx lj lk ll lm dt translated">Ubuntu 16.04</li><li id="8cbd" class="le lf hu kc b kd ln kh lo kl lp kp lq kt lr kx lj lk ll lm dt translated">CUDA 8.0(以及CUDDN)</li><li id="fb41" class="le lf hu kc b kd ln kh lo kl lp kp lq kt lr kx lj lk ll lm dt translated">张量流1.0</li><li id="0c0a" class="le lf hu kc b kd ln kh lo kl lp kp lq kt lr kx lj lk ll lm dt translated">Python 2.x和libs(这里不直接需要libs，但是我的安装是基于Python的使用)</li></ul><h1 id="daa7" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">启动AWS EC2实例</h1><ol class=""><li id="e1e1" class="le lf hu kc b kd ke kh ki kl ls kp lt kt lu kx lv lk ll lm dt translated">选择操作系统类型:<strong class="kc hv"> Ubuntu Server 16.04 </strong></li><li id="bce7" class="le lf hu kc b kd ln kh lo kl lp kp lq kt lr kx lv lk ll lm dt translated">选择实例类型:GPU Compute &gt; <strong class="kc hv"> p2.xlarge </strong></li></ol><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="fe ff lw"><img src="../Images/871dffdbd3b6bab39407d15f2914c7c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GiHn1PtaqZjAwHFO5b4hAg.png"/></div></div></figure><p id="b56d" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">为什么是p2？它们是专门为我们想要做的事情而制造的，即在GPU上运行密集的计算。p2.xlarge为我们提供了12gb的GPU。我们将能够在这台机器上很好地进行(批量)计算密集型<a class="ae ld" href="https://hackernoon.com/tagged/learning" rel="noopener ugc nofollow" target="_blank">学习</a></p><p id="d179" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated"><strong class="kc hv">警告:</strong> p2实例在运行时的价格是<strong class="kc hv">$ 0.90/小时</strong> —所以我建议您只在执行训练等任务时保持实例状态运行。</p><p id="0044" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">3)配置:基本配置就可以了，您需要使用VPC(默认VPC和子网设置也可以)</p><p id="181d" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">4)存储:<strong class="kc hv">注意:</strong>添加存储时，考虑您最有可能进行训练的数据量。例如，COCO 2014数据集(图像)约为15GB，COCO最常用的训练神经网络为. 5GB。此外，我们将下载数百MB的单个软件和库。我在工作中选择了<strong class="kc hv"> 50GB的存储空间</strong>，并且已经使用了大约30-40GB。</p><p id="ae5c" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">5)继续，使用您的首选项或默认值进行设置。没有其他特殊设置需要继续，所以启动并等待实例启动。</p><p id="dc7a" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">启动实例，等待它运行，我们应该可以继续了。</p><h1 id="5f95" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">安装指南</h1><p id="3fcb" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">SSH到您新启动的实例中。</p><h2 id="d986" class="mg jd hu bd je mh mi mj ji mk ml mm jm kl mn mo jq kp mp mq ju kt mr ms jy mt dt translated">Ubuntu更新</h2><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="f65b" class="mg jd hu mv b fv mz na l nb nc">$ sudo apt-get update<br/>$ sudo apt-get upgrade</span></pre><blockquote class="nd ne nf"><p id="358a" class="ka kb mf kc b kd ky kf kg kh kz kj kk ng la kn ko nh lb kr ks ni lc kv kw kx hn dt translated"><strong class="kc hv">注意:</strong>如果得到回应:</p><p id="46ef" class="ka kb mf kc b kd ky kf kg kh kz kj kk ng la kn ko nh lb kr ks ni lc kv kw kx hn dt translated">“boot/grub/menu.lst的新版本…”</p><p id="4c3e" class="ka kb mf kc b kd ky kf kg kh kz kj kk ng la kn ko nh lb kr ks ni lc kv kw kx hn dt translated">—我在测试环境中保留了本地版本。对于生产用途，需要进行尽职调查。</p></blockquote><h2 id="166f" class="mg jd hu bd je mh mi mj ji mk ml mm jm kl mn mo jq kp mp mq ju kt mr ms jy mt dt translated">属国</h2><p id="7f66" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">我们需要的有用工具:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="434f" class="mg jd hu mv b fv mz na l nb nc">$ sudo apt-get -y git vim curl build-essential cmake pkg-config zip</span></pre><p id="f3a6" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">这也是我安装将要使用的python库的地方(tensorflow安装不需要):</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="cbea" class="mg jd hu mv b fv mz na l nb nc">$ sudo apt-get -y install python-pip python-dev python-numpy python-scipy ipython python-matplotlib python-sklearn python-wheel</span></pre><p id="1b4e" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">我发现在构建和使用tensorflow时需要其他系统库:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="665a" class="mg jd hu mv b fv mz na l nb nc">$ sudo apt-get -y install -y libpng12-dev ibjasper-dev libfreetype6 libjpeg-dev libtiff5-dev libgtk2.0-dev libavcodec-dev libavformat-dev libswscale-dev libv4l-dev swig</span></pre><p id="8737" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">现在为我们创建一个目录:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="1ccd" class="mg jd hu mv b fv mz na l nb nc">$ mkdir install &amp;&amp; cd install</span></pre><h2 id="fe15" class="mg jd hu bd je mh mi mj ji mk ml mm jm kl mn mo jq kp mp mq ju kt mr ms jy mt dt translated">建筑张量流</h2><p id="0c27" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">我们将从源头建立张量流。有一个简单的pip安装，但是我们将通过构建获得更好的性能</p><p id="e7e8" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated"><a class="ae ld" href="https://www.tensorflow.org/performance/performance_guide#build_and_install_from_source" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/performance/performance _ guide # build _ and _ install _ from _ source</a></p><p id="1e1e" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">Bazel是TenorFlow的构建工具。Bazel需要使用我们的ip，因为我们在VPC，我们需要更改主机文件。</p><p id="4c18" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">为了让<strong class="kc hv">获得您的私有ip地址</strong>，在终端中运行<em class="mf">ifconfig</em>…您将获得一个输出，因此查找<em class="mf"> inet adds </em>并注意ip —(也可以在AWS控制台中获得)</p><ol class=""><li id="a3d9" class="le lf hu kc b kd ky kh kz kl lg kp lh kt li kx lv lk ll lm dt translated">修改/etc/hosts:</li></ol><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="1293" class="mg jd hu mv b fv mz na l nb nc">$ sudo vim /etc/hosts<br/>// [vim opens the file …]<br/>## change this line:<br/>127.0.0.1 localhost<br/>## to (if your private ip is 155.10.100.10)<br/>127.0.0.1 ip-155–10–100–10</span></pre><p id="65fb" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">2.安装Java(Bazel需要):</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="cc0e" class="mg jd hu mv b fv mz na l nb nc">$ sudo add-apt-repository ppa:webupd8team/java<br/>// [press enter]<br/>$ sudo apt-get update<br/>$ sudo apt-get install -y oracle-java8-installer<br/>// [accept terms]</span></pre><p id="b49d" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">3.安装Bazel (0.5.1):</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="b529" class="mg jd hu mv b fv mz na l nb nc">$ wget <a class="ae ld" href="https://github.com/bazelbuild/bazel/releases/download/0.5.1/bazel-0.5.1-installer-linux-x86_64.sh" rel="noopener ugc nofollow" target="_blank">https://github.com/bazelbuild/bazel/releases/download/0.5.1/bazel-0.5.1-installer-linux-x86_64.sh</a></span><span id="ccee" class="mg jd hu mv b fv nj na l nb nc">$ chmod +x bazel-0.5.1-installer-linux-x86_64.sh<br/>$ ./bazel-0.5.1-installer-linux-x86_64.sh</span></pre><p id="438d" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">巴泽尔现在将被安装。让我们把它加进去。巴沙尔</p><p id="f00c" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">修改~/。bashrc(将这两行添加到文件末尾):</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="ef10" class="mg jd hu mv b fv mz na l nb nc">$ vim ~/.bashrc<br/>// [vim opens the file]</span><span id="6b03" class="mg jd hu mv b fv nj na l nb nc"># Add to end of file:<br/># BAZEL<br/>source /home/ubuntu/.bazel/bin/bazel-complete.bash<br/>export PATH=”$PATH:$HOME/bin”</span></pre><p id="c61b" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">让我们装货。巴沙尔现在变成了我们的外壳:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="d5c3" class="mg jd hu mv b fv mz na l nb nc">$ source ~/.bashrc</span></pre><p id="ca12" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">我们现在有了巴泽尔。</p><p id="8163" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">好了，在我们得到TensorFlow和build之前，我们需要为GPU支持安装我们的依赖项。其中包括CUDA和CUDNN。<br/>了解更多信息:<a class="ae ld" href="https://en.wikipedia.org/wiki/CUDA" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/CUDA</a></p><p id="c36d" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">安装CUDA:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="0fb1" class="mg jd hu mv b fv mz na l nb nc">$ wget <a class="ae ld" href="http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1404/x86_64/cuda-repo-ubuntu1404_8.0.44-1_amd64.deb" rel="noopener ugc nofollow" target="_blank">http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1404/x86_64/cuda-repo-ubuntu1404_8.0.44-1_amd64.deb</a></span><span id="fb38" class="mg jd hu mv b fv nj na l nb nc">$ sudo dpkg -i cuda-repo-ubuntu1404_8.0.44–1_amd64.deb<br/>$ sudo apt-get -y update<br/>$ sudo apt-get -y upgrade<br/>$ sudo apt-get install -y cuda</span><span id="3c71" class="mg jd hu mv b fv nj na l nb nc">// [will take a couple of minutes]</span><span id="a3b6" class="mg jd hu mv b fv nj na l nb nc">$ sudo sh -c “sudo echo ‘/usr/local/cuda/lib64’ &gt; /etc/ld.so.conf.d/cuda.conf”<br/>$ sudo ldconfig</span></pre><p id="3d83" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">要测试我们是否正确安装了这个，运行一个简单的命令:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="fa72" class="mg jd hu mv b fv mz na l nb nc">$ nvidia-smi</span><span id="1318" class="mg jd hu mv b fv nj na l nb nc">## note, using:<br/>## watch -n 0.5 nvidia-smi<br/>## is a useful way to launch a “live” monitor of GPU stats, use this when you train your models</span></pre><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/37e2bc8ccebb2209edf978eb5289ba09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*V-j2HMcC7NI3hWAmlDJm9Q.png"/></div></figure><p id="39b1" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated"><strong class="kc hv">注意:</strong>对于CUDNN，你需要一个Nvidia开发者账号。你可以从这里得到这个:<a class="ae ld" href="https://developer.nvidia.com/rdp/cudnn-download" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/rdp/cudnn-download</a></p><p id="2ecc" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">在你设置好你的账户后，继续<strong class="kc hv">下载<em class="mf">8.0-Linux-x64-v 5.1</em>tarball到你自己的机器上。</strong></p><p id="8f95" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">我们将使用<em class="mf"> scp将这个文件(以及来自我们机器的所有其他文件)传输到我们的EC2实例。</em></p><p id="e459" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated"><strong class="kc hv">注意:</strong>在scp cud nn tarball之前，用您的ec2和正确的路径编辑下面的命令</p><p id="43ce" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">从您自己的机器上运行<a class="ae ld" href="https://en.wikipedia.org/wiki/Secure_copy" rel="noopener ugc nofollow" target="_blank"> scp </a>命令(替换ip):</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="8960" class="mg jd hu mv b fv mz na l nb nc">$ scp -i \<br/>     ~/keys/learner-key.pem \<br/>     ~/Downloads/cudnn-8.0-linux-x64-v5.1.tgz \<br/>     ubuntu@ec2–34–203–215–27.compute-1.amazonaws.com:~/install/</span><span id="b0f4" class="mg jd hu mv b fv nj na l nb nc">## the syntax:<br/>## scp -i &lt;path_to_ec2_private_key&gt; &lt;path_to_file_to_transfer&gt; &lt;receiving_machine_and_path_to_dest&gt;</span></pre><p id="f210" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">tarball转移后，拉开拉链并放置:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="e7b4" class="mg jd hu mv b fv mz na l nb nc">$ tar -zxf cudnn-8.0-linux-x64-v5.1.tgz<br/>$ sudo cp -P cuda/lib64/* /usr/local/cuda/lib64/</span></pre><p id="f740" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated"><strong class="kc hv"> <em class="mf">张量时间</em> </strong></p><p id="9006" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">赞成..酷毙了。我们去找张量流吧。这里用v1。</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="9164" class="mg jd hu mv b fv mz na l nb nc">$ git clone <a class="ae ld" href="https://github.com/tensorflow/tensorflow" rel="noopener ugc nofollow" target="_blank">https://github.com/tensorflow/tensorflow</a><br/>$ cd tensorflow<br/>$ git checkout v1.0.0</span><span id="48b4" class="mg jd hu mv b fv nj na l nb nc">$ ./configure</span><span id="65c0" class="mg jd hu mv b fv nj na l nb nc">// [launches configuration]</span></pre><p id="247f" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">这将启动配置脚本。</p><p id="28d1" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated"><strong class="kc hv">注意:</strong>您需要配置一个非默认设置:CUDA使用。所以[回车]获得所有默认设置，直到你看到询问你是否要支持CUDA的问题。<strong class="kc hv">是的</strong>我们有。以下CUDA设置也可以是默认设置。</p><p id="d6e3" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">好了，TensorFlow配置好了，可以开始构建了。构建过程是及时的。通常在p2.xlarge上持续大约1小时。所以为了解决这个问题，并且不把你的进程绑定到开放的shell上，我们将使用<em class="mf">屏幕。Screen </em>是一个工具，它允许我们在shell中启动一个新窗口，启动一个进程，然后<em class="mf">将</em>从该窗口中分离……并最终允许我们返回/重新连接到该窗口/进程。更多见此:<a class="ae ld" href="https://www.rackaid.com/blog/linux-screen-tutorial-and-how-to/" rel="noopener ugc nofollow" target="_blank">https://www . rackaid . com/blog/Linux-screen-tutorial-and-how-to/</a></p><p id="4fc6" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">(在训练您的模型和运行那些相应的流程时，屏幕也很方便)</p><p id="d914" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">启动新的屏幕窗口:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="596e" class="mg jd hu mv b fv mz na l nb nc">$ screen</span></pre><p id="8ace" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">我们应该还在install/tensorflow目录中</p><p id="6eaf" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">使用Bazel构建TensorFlow:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="56f2" class="mg jd hu mv b fv mz na l nb nc">$ bazel build -c opt — config=cuda //tensorflow/tools/pip_package:build_pip_package</span><span id="276a" class="mg jd hu mv b fv nj na l nb nc">// [bazel builds tensorflow here — long process]</span></pre><p id="aa8b" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated"><strong class="kc hv">注意:</strong>这是一个漫长的过程，预计需要一个小时。多亏了screen，我们可以脱离这个窗口(如果您愿意，可以关闭ssh连接)并休息一下</p><p id="6ad1" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">要从巴泽尔正在建造的纱窗上拆下来:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="0437" class="mg jd hu mv b fv mz na l nb nc">ctrl-a + d</span></pre><p id="5fb9" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">…张量流建筑的时间段…</p><p id="f68f" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">休息后，重新连接到正在建造/建造TensorFlow的纱窗:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="d1d6" class="mg jd hu mv b fv mz na l nb nc">$ screen -r</span></pre><p id="eff6" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">使用pip安装新版本:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="dc59" class="mg jd hu mv b fv mz na l nb nc">$ bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg</span><span id="3e80" class="mg jd hu mv b fv nj na l nb nc">$ sudo pip install /tmp/tensorflow_pkg/tensorflow-1.0.0-cp27-cp27mu-linux_x86_64.whl</span></pre><p id="f051" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">我们现在要确保TensorFlow可以在运行之前找到cuda。我们需要将它添加到我们的环境中。</p><p id="1a1c" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">修改~/。bashrc</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="fcc1" class="mg jd hu mv b fv mz na l nb nc">$ vim ~/.bashrc<br/>// [vim opens the file]</span><span id="30de" class="mg jd hu mv b fv nj na l nb nc"># Add to end of file:<br/># CUDA<br/>export LD_LIBRARY_PATH=”$LD_LIBRARY_PATH:/usr/local/cuda/lib64:/usr/local/cuda/extras/CUPTI/lib64"</span><span id="bd42" class="mg jd hu mv b fv nj na l nb nc">export CUDA_HOME=/usr/local/cuda</span></pre><p id="42a8" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">cd输出到主目录(确保您不在tensflow目录下)</p><p id="8060" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">和</p><h1 id="f4de" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">TENSORFLOW安装完毕！</h1><p id="80e7" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">让我们在交互式Python中测试一下:</p><pre class="lx ly lz ma fq mu mv mw mx aw my dt"><span id="5195" class="mg jd hu mv b fv mz na l nb nc">$ python<br/>// [python interpreter opens]</span><span id="ec18" class="mg jd hu mv b fv nj na l nb nc">&gt;&gt;&gt;<br/>&gt;&gt;&gt; import tensorflow as tf</span><span id="af93" class="mg jd hu mv b fv nj na l nb nc">I tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcublas.so.8.0 locally<br/>I tensorflow/stream_executor/dso_loader.cc:135] successfully opened CUDA library libcudnn.so.5 locally</span><span id="6ac4" class="mg jd hu mv b fv nj na l nb nc">… more like output like this (good sign that we see CUDA)</span><span id="bebb" class="mg jd hu mv b fv nj na l nb nc"><br/>## TEST SCRIPT:</span><span id="0cce" class="mg jd hu mv b fv nj na l nb nc">&gt;&gt;&gt; with tf.Session() as sess:</span><span id="5e21" class="mg jd hu mv b fv nj na l nb nc">…… sess.run(tf.global_variables_initializer())</span><span id="3f9f" class="mg jd hu mv b fv nj na l nb nc">…… print sess.run(output)</span><span id="bf90" class="mg jd hu mv b fv nj na l nb nc">……</span><span id="ceb9" class="mg jd hu mv b fv nj na l nb nc">[press enter]</span><span id="1a1b" class="mg jd hu mv b fv nj na l nb nc">// [script runs — you will see an initial output]</span></pre><p id="4476" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated">为了确认我们正在使用GPU，请查看以下输出:</p><figure class="lx ly lz ma fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="fe ff nk"><img src="../Images/98d78c0d1164972766b69180397f4f6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EwjwaYKNJ3X8yjyX0hlhKA.png"/></div></div></figure><p id="6634" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated"><strong class="kc hv"> <em class="mf">现在去做点爽的s***。</em>T15】</strong></p><p id="ec14" class="pw-post-body-paragraph ka kb hu kc b kd ky kf kg kh kz kj kk kl la kn ko kp lb kr ks kt lc kv kw kx hn dt translated"><a class="ae ld" href="https://twitter.com/rambossa" rel="noopener ugc nofollow" target="_blank">跟着我</a></p><figure class="lx ly lz ma fq iv"><div class="bz el l di"><div class="nl nm l"/></div></figure></div></div>    
</body>
</html>