<html>
<head>
<title>Build Dummy Data with Relationships</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用关系构建虚拟数据</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/weve-all-been-there-adedc9e82b42?source=collection_archive---------24-----------------------#2017-12-21">https://medium.com/hackernoon/weve-all-been-there-adedc9e82b42?source=collection_archive---------24-----------------------#2017-12-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="c492" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们都经历过。您正在构建一个具有大型数据集的rails应用程序，并且您计划让该应用程序在<a class="ae jp" href="https://hackernoon.com/tagged/dataset" rel="noopener ugc nofollow" target="_blank">数据集</a>上运行分析。如果你遵循测试驱动<a class="ae jp" href="https://hackernoon.com/tagged/design" rel="noopener ugc nofollow" target="_blank">设计</a> (TDD)模型，那么你将需要测试你的分析方法。问题是，您的数据集太大，无法上传到您的测试套件中。您总是可以复制测试夹具的前500行左右，但最终总是会产生奇怪的结果。您真正需要的是对测试数据集的外观有更多的控制。让我们从一个例子开始:</p><p id="0955" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我正在开发一个应用程序来分析来自自行车共享网络的数据。我有一个站点网络，所有站点都有一个名称和bike_dock_count，并且作为起点站和终点站属于许多行程。行程有持续时间、起点站标识和终点站标识。</p><p id="2f94" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">Station attributes: name, dock_count <br/>Trip attributes: duration, start_station_id, end_station_id</code></p><p id="005a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我知道我希望每个车站都有一些与之相关联的行程，但是我们如何设置呢？首先，让我们从在Ruby中构建一些虚拟站开始。我可以为此创建5个工作站:</p><p id="b100" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">Station.create(name: "station 1", dock_count: 5)<br/>Station.create(name: "station 2", dock_count: 6)<br/>Station.create(name: "station 3", dock_count: 7)<br/>Station.create(name: "station 4", dock_count: 8)<br/>Station.create(name: "station 5", dock_count: 9)</code></p><p id="3798" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者，我可以用一个times循环来构建它们，这样可以避免重复:</p><p id="2e34" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">5.times do |time|<br/> Station.create(name: "station #{time}", dock_count: time + 5)<br/>end</code></p><p id="79dd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">太好了，现在我的站点都被覆盖了。我将总是有5个站，它们将被一致地命名(我假设数据库正在被清理，所以id总是1–5)。接下来，让我们继续为这些站点构建行程。我们也许应该仔细看看我想从这些分析中得到什么。为了简单起见，我想计算一下:</p><ul class=""><li id="5562" class="ju jv hu it b iu iv iy iz jc jw jg jx jk jy jo jz ka kb kc dt translated">每个车站开始的平均行程数</li><li id="f02b" class="ju jv hu it b iu kd iy ke jc kf jg kg jk kh jo jz ka kb kc dt translated">在每个车站结束的平均行程数</li><li id="9c65" class="ju jv hu it b iu kd iy ke jc kf jg kg jk kh jo jz ka kb kc dt translated">旅行的平均持续时间</li><li id="267f" class="ju jv hu it b iu kd iy ke jc kf jg kg jk kh jo jz ka kb kc dt translated">行程持续时间的标准偏差。</li></ul><p id="d9f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好吧，那我们怎么做？我想指出平均值是多少，然后构建反映该计数的数据集。假设每站平均要5趟。因为每个车站的平均行程简单来说就是:</p><p id="1aec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">total_trips / total_stations = average_trips_per_station</code></p><p id="bfc7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此</p><p id="7d80" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">total_trips = average_trips_per_station * total_stations</code></p><p id="493a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们知道，无论如何，如果我们有5个站点，并且希望每个站点平均有5次旅行，我们需要构建25次旅行，这些旅行的实际站点并不重要。我们可以使用另一个循环来构建它:</p><p id="2174" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">25.times do<br/> Trip.create(duration: 1, start_trip_id: rand(1..5), end_trip_id: rand(1..5))<br/>end</code></p><p id="6808" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为什么我用兰德(1..5)那里？因为我知道我只有id为1-5的站点，并且我并不真正关心每个行程分配了哪些站点。这很好，但是我们真的希望我们的持续时间总是1吗？这有点无聊，我想我们可以在这里做些更有趣的事情。如果我们设置我们的旅行，使我们的持续时间遵循一个<a class="ae jp" href="https://en.wikipedia.org/wiki/Normal_distribution" rel="noopener ugc nofollow" target="_blank">正态分布</a>(钟形曲线)。稍微搜索了一下，我发现了这个<a class="ae jp" href="http://rosettacode.org/wiki/Random_numbers#Ruby" rel="noopener ugc nofollow" target="_blank">方便的公式</a>，它将构建一个指定长度(desired_count)、平均值(avg)和标准偏差(stdev)的数据数组:</p><p id="33a5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">Array.new(desired_count) {avg + stdev * Math.sqrt(-2 * Math.log(rand)) * Math.cos(2 * Math::PI * rand)}</code></p><p id="8085" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们如何在数据生成器中使用它？简单来说，我们需要建立25次旅行的数据，假设我们期望的平均持续时间是60，标准差是5。代码将如下所示:</p><p id="c9a7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">trip_durations = Array.new(25) {60 + 5 * Math.sqrt(-2 * Math.log(rand)) * Math.cos(2 * Math::PI * rand)}</code></p><p id="712c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将此代入IRB，并使用<a class="ae jp" href="https://github.com/thirtysixthspan/descriptive_statistics" rel="noopener ugc nofollow" target="_blank">描述性统计</a> gem，它为我提供了#均值和#标准差方法，我得到了以下结果:</p><figure class="kj kk kl km fq kn fe ff paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="fe ff ki"><img src="../Images/bffb7c444db7d763c57ce1062a3ca26b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UbFwTJDGrzJpeWC4K31XhQ.png"/></div></div></figure><p id="d379" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">很漂亮，很接近。由于数据集是使用rand函数构建的，因此对于像这样的小数据集，数据将会关闭。我想，随着构建的数组越来越大，均值和标准差越来越接近我们想要的。当然，在每次测试开始时随机运行这种水平的准确性是不可接受的，所以我们可能希望在IRB中运行代码</p><p id="8d92" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">无论如何，我们可以这样实现它:</p><p id="c42b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">5.times do |time|<br/> Station.create(name: "Station #{time}", dock_count: time+5<br/>end</code></p><p id="0339" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">trip_durations = Array.new(25) {60 + 5 * Math.sqrt(-2 * Math.log(rand)) * Math.cos(2 * Math::PI * rand)}</code></p><p id="0697" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">25.times do<br/> Trip.create(duration: trip_durations.pop, start_trip_id: rand(1..5), end_trip_id: rand(1..5))<br/>end</code></p><p id="6f67" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就是这样！现在我已经有了一组代码，可以构建5个站点和25次旅行。另外，我很清楚我会得到什么(大部分)！</p><figure class="kj kk kl km fq kn"><div class="bz el l di"><div class="ku kv l"/></div></figure></div></div>    
</body>
</html>