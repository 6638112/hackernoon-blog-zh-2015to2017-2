# 用 PromiseKit 包装 API

> 原文：<https://medium.com/hackernoon/wrapping-up-apis-with-promisekit-d1302f446ad6>

## 实际上，我只是想和你分享一些代码片段

![](img/c9d91c86a6441ea86b41de03973e8e8e.png)

对承诺感到陌生，如何在 iOS 开发中使用它们？那么请随意阅读我之前写的关于这个主题的简短介绍:[https://hacker noon . com/promise-pattern-on-swift-with-promise kit-620 efad 7 a5 BD](https://hackernoon.com/promise-pattern-on-swift-with-promisekit-620efad7a5bd)

承诺很有趣，我发誓！

在我的上一篇文章中，我展示了一些例子，告诉你如何将异步呼叫金字塔转化为更有组织的承诺链，如下所示:

更重要的是，在不改变原始 API 实现的情况下将它们打包，最终得到如下结果:

上面的[实现](https://hackernoon.com/tagged/implementation)是通过创建一个可重用的包装器[函数](https://hackernoon.com/tagged/function)来实现的，它提供了处理异步回调时所需的闭包:

包装器函数*保存了对完成块的引用，您可以将完成块赋予您的异步调用，然后返回给您一个****Promise****对象，您可以改为监听*。下面是我们的自定义包装器的更详细的实现:

考虑到这一点，我们来看看在我们的代码中还能怎么整理~

## **让第三方参与你的流程**

社交媒体登录在应用程序设计中很常见，甚至是我们大多数应用程序的主要用户需求。正因为如此，脸书 SDK 的 *LoginManager* 和 *GraphAPI* 是我们非常熟悉的两个库，它们经常是我们架构的一部分。

第三方 SDK 之所以简洁，有几个原因:

1.  当你不需要重新发明轮子的时候，节省你和你的团队很多时间。
2.  可靠的第三方意味着他们能够很好地维护和测试他们的代码。
3.  成千上万人使用的公共图书馆意味着问题更容易被发现和解决。

当然，它们也有一些缺点，尤其是:

1.  SDK 通常很大。这么多东西你往往不需要看。
2.  他们的设计也经常与你的团队不同。做好抽象的准备。

脸书 SDK 也不例外。在这个非常特殊的案例中，我们将研究如何将脸书 API 调用集成到我们的承诺链中。

## API 示例:FB LoginManager

让脸书成为应用程序社交平台的是 LoginManager。

但是它有自己的异步回调可能会给你的数据流带来一些问题，特别是当你已经通过承诺设计好的时候。让我们看看它的“完成”回调，看看我们如何为它设计一个包装器。

这里我们想要的是能够替换完成闭包' **((LoginResult) - > Void)？= nil'** ,其中一个来自我们的包装函数。

首先，让我们声明我们的新包装器，它采用一个参数类型与登录完成相同的完成块:

接下来，让我们通过使用完成块参数来触发 Promise 的 fulfil()和 reject()来准备 Promise 对象。现在，让我们继续返回结果承诺，当然是使用 LoginResult 的成功对象类型。

当这些都很好地完成后，您应该能够像这样链接您的脸书登录调用:

Voila, no need to reimplement anything. Just wrap them up :D

## 下一步是什么？

构建了这么多 Restful 应用程序后，我和我的团队已经习惯了一有机会就用 PromiseKit 组织和链接异步调用。

根据我们在这里学到的知识，我鼓励你也仔细检查你的代码库，找出那些讨厌的异步调用金字塔，并找到一个清理它们的好方法。

祝你好运！

# 你大老远跑来了！

> 我希望当你打开这篇文章的时候，你已经得到了你想要的东西。如果是这样，如果你能把这个推荐给你的朋友^^，我将非常感激

如果您还有任何问题/反馈，请随时留言！