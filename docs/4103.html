<html>
<head>
<title>[Webpack] — Smart Loading Assets For Production</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[Webpack] —为生产智能加载资产</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/webpack-smart-loading-assets-for-production-3571e0a29c2e?source=collection_archive---------11-----------------------#2017-05-12">https://medium.com/hackernoon/webpack-smart-loading-assets-for-production-3571e0a29c2e?source=collection_archive---------11-----------------------#2017-05-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><h1 id="0329" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated"><strong class="ak">优化</strong></h1><p id="ed75" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">最近，当我们检查我们的<a class="ae kn" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> javascript </a>错误日志时，我们注意到有几个问题与“旧浏览器”有关，比如</p><pre class="ko kp kq kr fq ks kt ku kv aw kw dt"><span id="b1fb" class="kx is hu kt b fv ky kz l la lb">Uncaught ReferenceError: Promise is not defined<br/>Uncaught ReferenceError: fetch is not defined</span></pre><p id="5bbd" class="pw-post-body-paragraph jp jq hu jr b js lc ju jv jw ld jy jz ka le kc kd ke lf kg kh ki lg kk kl km hn dt translated">经过讨论，我们有两种方法:</p><ol class=""><li id="4781" class="lh li hu jr b js lc jw ld ka lj ke lk ki ll km lm ln lo lp dt translated">当用户前往使用“<a class="ae kn" href="https://hackernoon.com/tagged/modern" rel="noopener ugc nofollow" target="_blank">现代</a>功能的特定路线时。我们检查浏览器是否支持这个特性。如果没有，我们将懒惰加载它。</li><li id="34fc" class="lh li hu jr b js lq jw lr ka ls ke lt ki lu km lm ln lo lp dt translated">将all-in-one polyfill(我们选择<code class="eh lv lw lx kt b">babel-polyfill</code>)添加到我们的js资产中，并在加载任何js资产之前先加载它。</li></ol><p id="ebaa" class="pw-post-body-paragraph jp jq hu jr b js lc ju jv jw ld jy jz ka le kc kd ke lf kg kh ki lg kk kl km hn dt translated">这种方法似乎给我们的项目增加了更多的复杂性，我们必须知道“旧浏览器”不支持哪种功能，并且在检查每条路线的功能时要重复。一件更重要的事情是我们当前的代码库，我们必须以这种方式重构工作。因此，我们倾向于方法二。方法二的问题是，即使在“现代浏览器”的情况下，我们也必须加载polyfill。因此，优化它的方法是跳过polyfill，我们通过这样的延迟加载来实现:</p><figure class="ko kp kq kr fq ly"><div class="bz el l di"><div class="lz ma l"/></div></figure><blockquote class="mb mc md"><p id="0521" class="jp jq me jr b js lc ju jv jw ld jy jz mf le kc kd mg lf kg kh mh lg kk kl km hn dt translated"><code class="eh lv lw lx kt b"><em class="hu">old_browser</em></code> <em class="hu">取决于你使用的功能。在我们的例子中，它们是</em><code class="eh lv lw lx kt b"><em class="hu">Promise</em></code><em class="hu"/><code class="eh lv lw lx kt b"><em class="hu">fetch</em></code></p></blockquote><p id="87e4" class="pw-post-body-paragraph jp jq hu jr b js lc ju jv jw ld jy jz ka le kc kd ke lf kg kh ki lg kk kl km hn dt translated">目前，我们使用webpack来构建我们的资产。有了上面这样的输出，我们必须在webpack中定制构建过程(在本例中是<code class="eh lv lw lx kt b">html-webpack-plugin</code>插件)，基本上，代码片段如下所示:</p><figure class="ko kp kq kr fq ly"><div class="bz el l di"><div class="lz ma l"/></div></figure><p id="cfe2" class="pw-post-body-paragraph jp jq hu jr b js lc ju jv jw ld jy jz ka le kc kd ke lf kg kh ki lg kk kl km hn dt translated">我提取上面的代码片段并在这里创建一个包<a class="ae kn" href="https://github.com/MQuy/html-webpack-condition-assets" rel="noopener ugc nofollow" target="_blank">https://github.com/MQuy/html-webpack-condition-assets</a></p><p id="c2c2" class="pw-post-body-paragraph jp jq hu jr b js lc ju jv jw ld jy jz ka le kc kd ke lf kg kh ki lg kk kl km hn dt translated">在加载js资产方面，这种方法不如上面的方法好，为了改善这一点，我们可以使用新功能<code class="eh lv lw lx kt b">preload</code>。在构建过程中，我们通过<a class="ae kn" href="https://github.com/GoogleChrome/preload-webpack-plugin" rel="noopener ugc nofollow" target="_blank"> preload-webpack-plugin </a>添加格式为<code class="eh lv lw lx kt b">&lt;link red="preload" ...&gt;</code>的js资产</p><p id="abcc" class="pw-post-body-paragraph jp jq hu jr b js lc ju jv jw ld jy jz ka le kc kd ke lf kg kh ki lg kk kl km hn dt translated">最后，模板将如下所示:</p><figure class="ko kp kq kr fq ly"><div class="bz el l di"><div class="lz ma l"/></div></figure><p id="7172" class="pw-post-body-paragraph jp jq hu jr b js lc ju jv jw ld jy jz ka le kc kd ke lf kg kh ki lg kk kl km hn dt translated">关于webpack配置，我们可以在这里找到更多的细节</p><div class="mi mj fm fo mk ml"><a href="https://github.com/MQuy/redux-boilerplate/blob/master/cli/webpack.config.js#L99" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab ej"><div class="mn ab mo cl cj mp"><h2 class="bd hv fv z el mq eo ep mr er et ht dt translated">MQuy/redux-样板文件</h2><div class="ms l"><h3 class="bd b fv z el mq eo ep mr er et ek translated">redux-boilerplate - redux样板(Node.js，Express，React，Redux，React-Router，Babel 6，PostCSS，Webpack)</h3></div><div class="mt l"><p class="bd b gc z el mq eo ep mr er et ek translated">github.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz na ml"/></div></div></a></div><h1 id="2783" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">基准</h1><p id="5078" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">之后，我们用https://www.webpagetest.org/的T21来测试我们的结果。我们为“现代”浏览器节省了0.3秒。更多细节，你可以查看我们的基准</p><ol class=""><li id="c36c" class="lh li hu jr b js lc jw ld ka lj ke lk ki ll km lm ln lo lp dt translated">加载同步</li></ol><p id="10c8" class="pw-post-body-paragraph jp jq hu jr b js lc ju jv jw ld jy jz ka le kc kd ke lf kg kh ki lg kk kl km hn dt translated"><a class="ae kn" href="https://www.webpagetest.org/result/170504_HD_15BD/" rel="noopener ugc nofollow" target="_blank">https://www.webpagetest.org/result/170504_HD_15BD/</a>https://www.webpagetest.org/result/170504_QN_15EJ/T2<a class="ae kn" href="https://www.webpagetest.org/result/170504_KT_15HP/" rel="noopener ugc nofollow" target="_blank">https://www.webpagetest.org/result/170504_KT_15HP/</a></p><p id="88bc" class="pw-post-body-paragraph jp jq hu jr b js lc ju jv jw ld jy jz ka le kc kd ke lf kg kh ki lg kk kl km hn dt translated">2.负载条件异步</p><p id="2d69" class="pw-post-body-paragraph jp jq hu jr b js lc ju jv jw ld jy jz ka le kc kd ke lf kg kh ki lg kk kl km hn dt translated"><a class="ae kn" href="https://www.webpagetest.org/result/170504_H3_15MN/" rel="noopener ugc nofollow" target="_blank">https://www.webpagetest.org/result/170504_H3_15MN/</a>T8】https://www.webpagetest.org/result/170504_VR_15Q1/T10】https://www.webpagetest.org/result/170504_38_15VF/</p><blockquote class="mb mc md"><p id="2847" class="jp jq me jr b js lc ju jv jw ld jy jz mf le kc kd mg lf kg kh mh lg kk kl km hn dt translated"><a class="ae kn" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是AMI家庭的一员。我们现在<a class="ae kn" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kn" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="jp jq me jr b js lc ju jv jw ld jy jz mf le kc kd mg lf kg kh mh lg kk kl km hn dt translated">要了解更多信息，请<a class="ae kn" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">阅读我们的“关于”页面</a>、<a class="ae kn" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">喜欢/在脸书给我们发消息</a>，或者简单地说，<a class="ae kn" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="jp jq me jr b js lc ju jv jw ld jy jz mf le kc kd mg lf kg kh mh lg kk kl km hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kn" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kn" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ko kp kq kr fq ly"><div class="bz el l di"><div class="nb ma l"/></div></figure></div></div>    
</body>
</html>