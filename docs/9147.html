<html>
<head>
<title>An Introduction to Docker Through Story</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过故事介绍Docker</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/an-introduction-to-docker-through-story-8ae5594d7446?source=collection_archive---------6-----------------------#2017-12-28">https://medium.com/hackernoon/an-introduction-to-docker-through-story-8ae5594d7446?source=collection_archive---------6-----------------------#2017-12-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="23be" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我之前的几篇基于故事的文章似乎真的很合得来，我从你们那里得到了一些非常好的反馈。因此，我想我会继续这个系列，并开始介绍更细粒度的主题，如集装箱化和码头工人。</p><p id="1f46" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将再次关注我们的高级开发人员Gemma，她致力于改进在线漫画浏览/商店的<a class="ae jp" href="https://hackernoon.com/tagged/codebase" rel="noopener ugc nofollow" target="_blank">代码库</a>。如果你有兴趣了解这个故事是如何开始的，我建议你看看:</p><div class="jq jr fm fo js jt"><a href="https://hackernoon.com/an-introduction-to-microservice-based-architecture-through-story-part-1-55c553ac4bd9" rel="noopener  ugc nofollow" target="_blank"><div class="ju ab ej"><div class="jv ab jw cl cj jx"><h2 class="bd hv fv z el jy eo ep jz er et ht dt translated">通过故事介绍基于微服务的架构—第1部分</h2><div class="ka l"><h3 class="bd b fv z el jy eo ep jz er et ek translated">如今，对基于微服务的架构的推动似乎对许多大型、分布式……</h3></div><div class="kb l"><p class="bd b gc z el jy eo ep jz er et ek translated">hackernoon.com</p></div></div><div class="kc l"><div class="kd l ke kf kg kc kh ki jt"/></div></div></a></div><blockquote class="kj kk kl"><p id="c2e3" class="ir is km it b iu iv iw ix iy iz ja jb kn jd je jf ko jh ji jj kp jl jm jn jo hn dt translated">如果你想在docker上了解更多，那么我强烈推荐你去看看这本书——<a class="ae jp" href="http://amzn.to/2Ch8DyN" rel="noopener ugc nofollow" target="_blank">Docker:Up&amp;Running:Shipping Reliable Containers in Production</a></p></blockquote></div><div class="ab cl kq kr hc ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hn ho hp hq hr"><h2 id="79d1" class="kx ky hu bd kz la lb lc ld le lf lg lh jc li lj lk jg ll lm ln jk lo lp lq lr dt translated">这些问题</h2><p id="fedc" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">在过渡到基于微服务的方法期间，Gemma监督了几个新面孔加入她的团队。当加入一个新团队时，总会有一个学习曲线和一个过渡期，这会降低团队的整体效率，因为他们希望在工作机器上设置好一切。</p><p id="fc30" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">新来的人不应该感到束手无策，因此Gemma让她的一些高级工程师和新来的人在一起，试图让他们尽快开始运行代码库。</p><h2 id="4bb9" class="kx ky hu bd kz la lb lc ld le lf lg lh jc li lj lk jg ll lm ln jk lo lp lq lr dt translated">依赖和环境地狱</h2><p id="940e" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">最初，Gemma的团队中有4个人，他们作为一个紧密团结的单位工作，能够非常快速和轻松地修复彼此机器上的任何依赖问题或环境问题，而不会浪费太多时间。</p><p id="9ca0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，随着团队的扩大，不同环境的数量成为一个问题。一名团队成员可能运行CentOS，另一名运行MacOS，第三名运行Windows 10。这意味着他们必须确保每台机器都有正确的依赖项和环境变量才能运行。</p><p id="6201" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一个团队成员可能已经在他们的机器上安装了Python 3.1，而帐户服务实际上需要Asyncio才能工作。Asyncio仅在该语言的3.4版本中可用，因此该服务将无法在他们的机器上启动。</p><p id="27e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，虽然解决这个问题可能有些琐碎，但它确实代表了尝试将每个人同步到正确版本所花费的时间。随着代码库复杂性的增长，运行它所需的环境配置也在增长。</p><h2 id="f453" class="kx ky hu bd kz la lb lc ld le lf lg lh jc li lj lk jg ll lm ln jk lo lp lq lr dt translated">三。配置— 12因素应用</h2><p id="3637" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">如果你致力于让应用程序对云友好，那么你可能已经遇到了<a class="ae jp" href="https://12factor.net/" rel="noopener ugc nofollow" target="_blank"> 12个因素</a>。Gemma和她的团队试图确保应用程序中的每项服务都符合所有这些因素，以便只需很少甚至不需要手动操作就能轻松扩展和部署服务。</p><p id="651a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第三个因素是您将所有配置项存储在您的环境中。这通常意味着使用python命令，例如:</p><pre class="lx ly lz ma fq mb mc md me aw mf dt"><span id="f860" class="kx ky hu mc b fv mg mh l mi mj">import os</span><span id="dbdf" class="kx ky hu mc b fv mk mh l mi mj">db_pass = os.environ["DB_PASS"]</span></pre><p id="66a9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以便检索数据库密码等。然而，这使得在您的本地机器上运行它变得相当困难，为了让您的程序运行，您必须首先设置所有这些变量。您可以使用powershell脚本或bash脚本来实现这一点，但是使这种跨平台兼容需要时间和精力，并且任何更改都变得很困难。</p><h2 id="0759" class="kx ky hu bd kz la lb lc ld le lf lg lh jc li lj lk jg ll lm ln jk lo lp lq lr dt translated">问题</h2><p id="c02d" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">为所有新来者设置适当的依赖项和环境变量的组合开始变得有点麻烦，有时测试是针对生产数据库运行的。这是由于开发人员忘记将环境变量设置回开发值。</p><p id="47e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">随着未来团队的进一步扩展，这个问题需要得到解决。</p><h2 id="f178" class="kx ky hu bd kz la lb lc ld le lf lg lh jc li lj lk jg ll lm ln jk lo lp lq lr dt translated">解决方案— Docker</h2><p id="2048" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">这就是杰玛发现集装箱化和码头工的奇妙世界的时候。通过容器化，Gemma和她的团队能够在一个<code class="eh ml mm mn mc b">Dockerfile</code>内定义应用程序运行所需的一切，然后用一个简单的命令运行他们新发明的docker应用程序。</p><p id="a446" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">他们首先将使用Python编写的帐户服务转换为使用docker，然后想出了类似这样的东西:</p><pre class="lx ly lz ma fq mb mc md me aw mf dt"><span id="c222" class="kx ky hu mc b fv mg mh l mi mj">FROM python:3.6.3</span><span id="ff3f" class="kx ky hu mc b fv mk mh l mi mj">WORKDIR /app</span><span id="0e55" class="kx ky hu mc b fv mk mh l mi mj">ADD . /app</span><span id="6d1b" class="kx ky hu mc b fv mk mh l mi mj">RUN pip install -r requirements.txt</span><span id="4388" class="kx ky hu mc b fv mk mh l mi mj">EXPOSE 80</span><span id="c195" class="kx ky hu mc b fv mk mh l mi mj">ENV DB_PASS dolphins</span><span id="bc19" class="kx ky hu mc b fv mk mh l mi mj">CMD ["python", "app.py"]</span></pre><p id="57aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">他们指定了希望应用程序运行的精确Python版本，指定了应用程序的工作目录，并运行了一个<code class="eh ml mm mn mc b">pip install -r requirements.txt</code>,以便安装所有必要的Python依赖项。最后，他们公开了端口80，这是运行底层Python应用程序的端口。</p><p id="830d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您将在倒数第二行看到，他们还能够指定他们的<code class="eh ml mm mn mc b">DB_PASS</code>环境变量，这将允许他们连接到他们的开发数据库。</p><h2 id="0bc0" class="kx ky hu bd kz la lb lc ld le lf lg lh jc li lj lk jg ll lm ln jk lo lp lq lr dt translated">运行他们的应用</h2><p id="61e6" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">定义这个<code class="eh ml mm mn mc b">Dockerfile</code>的真正好处是，团队中的每个人在本地机器上安装Docker后，都可以使用以下两个命令来构建和启动应用程序:</p><pre class="lx ly lz ma fq mb mc md me aw mf dt"><span id="28d4" class="kx ky hu mc b fv mg mh l mi mj">docker build -t py36-account-service .</span><span id="ffb3" class="kx ky hu mc b fv mk mh l mi mj">docker run --name "py36-account-service" -d -p 9000:80 py36-account-service</span></pre><p id="75f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将随后消失，下载所有需要的需求，并建立我们的Docker镜像文件，我们可以随后运行。</p><figure class="lx ly lz ma fq mp fe ff paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="fe ff mo"><img src="../Images/901df9b8713351e22db607900d47ea05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQ9FdUpJQUP_KdgbHUa34A.png"/></div></div><figcaption class="mv mw fg fe ff mx my bd b be z ek">A screenshot of Gemma running this locally</figcaption></figure><p id="b264" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">之后，她就可以通过调用上面指定的第二个Docker命令来运行应用程序了。</p><figure class="lx ly lz ma fq mp fe ff paragraph-image"><div class="fe ff mz"><img src="../Images/fca2c16f8326474005de04c019ab20cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*MnncsSowWO4uOO1yoOrmMQ.png"/></div><figcaption class="mv mw fg fe ff mx my bd b be z ek">running the account service</figcaption></figure><p id="5e7c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过将应用程序迁移到这种新格式，这意味着团队的任何新成员都可以被告知只需安装Docker(如果他们还没有安装的话)，然后运行这两个命令，他们就会在自己的机器上拥有一个工作帐户服务。从长远来看，这最终会节省大量时间。</p><p id="1b11" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这可以在所有开发者的操作系统上轻松工作。</p><h2 id="ee09" class="kx ky hu bd kz la lb lc ld le lf lg lh jc li lj lk jg ll lm ln jk lo lp lq lr dt translated">应对多种环境</h2><p id="789e" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">因此，虽然上面的结构允许开发人员在一个环境中运行他们的应用程序，但是它没有解决开发人员在生产环境中意外运行应用程序测试的问题。</p><p id="ea05" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了解决这个问题，我们可以做一些事情，比如指定我们想要传递给应用程序的内容。在这些环境文件中，我们可以分别指定我们的开发、测试和生产凭证。然后，我们可以指定希望我们的应用程序像这样启动并使用我们的开发数据库:</p><pre class="lx ly lz ma fq mb mc md me aw mf dt"><span id="036b" class="kx ky hu mc b fv mg mh l mi mj">docker run my_app --env-file .dev</span></pre><h2 id="63d7" class="kx ky hu bd kz la lb lc ld le lf lg lh jc li lj lk jg ll lm ln jk lo lp lq lr dt translated">结论</h2><p id="44b5" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">通过利用docker，Gemma和她的团队能够最大限度地降低新开发人员进入团队的门槛，并极大地减少了让某人启动并运行工作开发环境所需的时间。</p><p id="b6f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将他们的应用程序对接也简化了部署，因为他们能够利用AWS服务，如弹性容器服务(ECS ),而不必太担心底层操作系统等。这最终节省了他们的时间和精力，并且成本与他们在一个普通的EC2实例上运行它是一样的。</p><figure class="lx ly lz ma fq mp fe ff paragraph-image"><div class="fe ff na"><img src="../Images/19c9e52e208ad97ec2add39ca71adb4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:342/format:webp/1*eGoCCABpgaZHOQ9-nhTI4g.png"/></div></figure></div><div class="ab cl kq kr hc ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hn ho hp hq hr"><h1 id="3952" class="nb ky hu bd kz nc nd ne ld nf ng nh lh ni nj nk lk nl nm nn ln no np nq lq nr dt translated">结论</h1><p id="35b1" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">希望你觉得这个故事既有趣又有启发性！我很喜欢这种新的写作风格，我希望它能改变大多数技术文章冗长乏味的风格。</p><p id="9270" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我希望这有助于突出Docker的好处，以及如何在日常应用中利用它来改进开发人员的工作流程。它不应该只用于微服务之类的应用，它还为更大的单片应用提供了很多价值。</p><p id="1e3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你觉得这很有用，请在评论区告诉我，或者发微博给我@ <a class="ns nt gr" href="https://medium.com/u/eb71d34fbe09?source=post_page-----8ae5594d7446--------------------------------" rel="noopener" target="_blank"> Elliot Forbes </a>。我非常乐意听到任何反馈！</p><figure class="lx ly lz ma fq mp"><div class="bz el l di"><div class="nu nv l"/></div></figure></div></div>    
</body>
</html>