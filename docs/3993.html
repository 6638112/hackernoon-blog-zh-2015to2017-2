<html>
<head>
<title>Missing part of Redux Saga Experience</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux Saga体验中缺失的部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/missing-part-of-redux-saga-experience-1d2d169ba765?source=collection_archive---------2-----------------------#2017-05-05">https://medium.com/hackernoon/missing-part-of-redux-saga-experience-1d2d169ba765?source=collection_archive---------2-----------------------#2017-05-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/253f2d94164feea2ad3618ca2335fa68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p3s4qTPe1Czua0akklszWw.jpeg"/></div></div></figure><p id="5ef5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Redux saga是应用程序和redux store之间的中间件，由redux actions处理。这意味着，它可以监听动作，截取它感兴趣的动作，并用其他动作替换它们。这可能对很多事情都有用。特别是，使用sagas，你可以保持你的组件尽可能简单，并将所有的逻辑转移到sagas中。</p><p id="8f60" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当您开始使用Redux saga时，编写描述单个组件或单个页面行为的saga似乎是非常自然的。它在有两三个页面的简单应用程序中运行良好，所有内容都是同步加载的。但是当一个项目成长的时候，这可能会让你陷入sagas部门的一片混乱，sagas没有明确的目的，在很多方面互相重复。这将很难管理、调试和做出哪怕是很小的改变。</p><p id="aaa8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">问题是萨加斯的工作应该协调一致。经过一段时间与这种混乱的局面作斗争，并最终阅读了文档之后，我们DashBouquet想出了一种新的方法，这种方法一直存在。描述一个传奇故事的完整流程。这就是文档所暗示的，你应该仔细阅读。让我们看看，它看起来像什么。</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ka"><img src="../Images/c02a4743260c7c7b95098938a185ac83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c_D61Vvo2Blk4NpxjaeSpA.jpeg"/></div></div></figure><p id="76ad" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它看起来像一朵花，不是吗？当然，在传奇中描述完整的流程并不意味着应该只有一个传奇。关键是所有事情都在一个地方处理。</p><p id="fa8f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，让我们看一个实际的例子。比方说，在我们的应用程序中，用户可以填写工作申请，并将其发送到服务器进行进一步处理。我们想创造一个传奇来描述这个过程的全部流程。</p><p id="e14a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当用户点击“申请工作”按钮并被重定向到申请表时，一切都开始于<strong class="je hv"> /create_application_page </strong>路径。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="8fd4" class="kk kl hu kg b fv km kn l ko kp"><strong class="kg hv">import </strong>{take, call, put, select, fork, cancel, race} <strong class="kg hv">from </strong>'redux-saga/effects';<br/><strong class="kg hv">import </strong>{<em class="kq">LOCATION_CHANGE</em>, <em class="kq">push</em>} <strong class="kg hv">from </strong>'react-router-redux';<br/><strong class="kg hv">import </strong>{takeEvery} <strong class="kg hv">from </strong>"redux-saga";<br/><strong class="kg hv">import </strong>* <strong class="kg hv">as </strong>api <strong class="kg hv">from </strong>'./api';</span><span id="acad" class="kk kl hu kg b fv kr kn l ko kp"><strong class="kg hv">function*</strong> createApplication(data) {<br/> <strong class="kg hv">yield</strong> put(<em class="kq">push</em>(`/application_form`));</span><span id="d3f1" class="kk kl hu kg b fv kr kn l ko kp">  <strong class="kg hv">const</strong> { saveApplication } = yield race({<br/> saveApplication: take(SAVE_APPLICATION),<br/> cancelApplication: take(CANCEL_APPLICATION),<br/> });</span><span id="5f6d" class="kk kl hu kg b fv kr kn l ko kp"> <strong class="kg hv">if</strong> (saveApplication) {<br/>    <strong class="kg hv">const</strong> { data } = saveApplication;<br/>    <strong class="kg hv">yield</strong> api.saveApplication(data);<br/>    <strong class="kg hv">yield</strong> put(<em class="kq">push</em>(`/application_saved`));<br/>} else {<br/>    yield put(<em class="kq">push</em>(`/application_cancaled`));<br/> }<br/>}<br/><strong class="kg hv">function*</strong> watchCreateApplication() {<br/><strong class="kg hv">const</strong> createApplicationTask = takeEvery(CREATE_APPLICATION, createApplication);</span><span id="8175" class="kk kl hu kg b fv kr kn l ko kp">   <strong class="kg hv">while (true)</strong> {<br/><strong class="kg hv">const</strong> {payload: {pathname}} = yield take(<em class="kq">LOCATION_CHANGE</em>);<br/><strong class="kg hv">if</strong> (pathname.search(/^\/create_application_page\/?$/) !== -1) {<br/>   <strong class="kg hv">yield</strong> cancel(createApplicationTask);<br/>   <strong class="kg hv">break;</strong><br/> }<br/>  }<br/>}</span></pre><p id="517c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里的<strong class="je hv"> CREATE_APPLICATION </strong>是用户点击“申请工作”时调度的动作。然后，他被重定向到另一个带有表单的页面。在用户填写完表单并单击Submit或Cancel后，他会根据所分派的操作被进一步重定向。只有当用户单击提交时，数据才会发送到服务器。</p><p id="c6c7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此外，用户可能会在填写表单的过程中改变主意，而只是通过另一个链接，而不是单击“取消”。在这种情况下，如果他稍后回到异步注入saga的<strong class="je hv"> /create_application_page </strong>，saga将被再注入一次，服务器上的数据将被创建两次，而用户打算只做一次。我们当然不希望这样，所以我们需要取消redux-router分派的LOCATION_CHANGE任务，因此检查<strong class="je hv"> watchCreateApplication </strong>中的路径名。</p><p id="8f19" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了让事情变得复杂一点，我们假设，在填写表单的过程中，用户可以调用另一个表单的对话框，在这个对话框中，他可以选择他申请的国家和城市，并将这些数据提交给服务器。我们可以通过简单地派生另一个与<strong class="je hv"> createApplication </strong>传奇非常相似的传奇来做到这一点:</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="efcc" class="kk kl hu kg b fv km kn l ko kp"><strong class="kg hv">function*</strong> chooseLocation() {<br/><strong class="kg hv">yield</strong> put(showDialog());<br/> <strong class="kg hv">const</strong> { saveLocation } = yield race({<br/>  saveLocation: take(SAVE_LOCATION),<br/>  cancelLocation: take(CANCEL_LOCATION),<br/>  });<br/> <strong class="kg hv">if</strong> (saveLocation) {<br/>     <strong class="kg hv">const</strong> { data } = saveLocation;<br/>     <strong class="kg hv">yield</strong> api.saveLocation(data);<br/> }<br/> <strong class="kg hv">yield</strong> put(closeDialog());<br/>}</span></pre></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><pre class="kf kg kh ki aw kj dt"><span id="3439" class="kk kl hu kg b fv kz la lb lc ld kn l ko kp"><strong class="kg hv">function*</strong> createApplication() {<br/> <strong class="kg hv">yield</strong> put(<em class="kq">push</em>(`/application_form`));<br/>  <strong class="kg hv">const</strong> createLocationTask = takeEvery(CREATE_LOCATION, createLocation)</span><span id="f25c" class="kk kl hu kg b fv kr kn l ko kp">  ...</span><span id="63e1" class="kk kl hu kg b fv kr kn l ko kp"><strong class="kg hv">  yield</strong> cancel(createLocationTask);</span><span id="3023" class="kk kl hu kg b fv kr kn l ko kp">}</span></pre><p id="9904" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里我们处理与<strong class="je hv"> showDialog </strong>和<strong class="je hv"> closeDialog </strong>传奇的对话。换句话说，如果此时必须显示或隐藏对话框，他们应该在存储中设置一些值来告诉页面。更详细地说，这是另一篇文章的主题。</p><p id="07f0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">重要的是不要忘记取消分叉的任务。如果在某个时候，您发现大量的请求被发送到服务器，而本应该只有一两个，那么您可能在某个地方忽略了这一点。</p><p id="0d90" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是一个非常简单的例子。一个流可能要复杂得多，有任意数量的子流(尽管从UX的角度来看，这可能不是一个好主意)。但无论如何，这种方法给你的是，你可以一步一步地建立你的流量。你可以很容易地在以后做出改变，而且它们不会导致其他传奇的意外行为。如果你需要，你可以把它变得更复杂，但是不管你的心流有多少分叉，你都不会迷失其中。</p></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><div class="kb kc kd ke fq le"><a href="https://hackernoon.com/using-normalizr-to-organize-data-in-stores-practical-guide-82fa061b60fb" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab ej"><div class="lg ab lh cl cj li"><h2 class="bd hv fv z el lj eo ep lk er et ht dt translated">使用Normalizr组织商店中的数据——实用指南</h2><div class="ll l"><h3 class="bd b fv z el lj eo ep lk er et ek translated">在对Normalizr的工作结果应用一些简单的操作之后，我们得到了可以存储的数据</h3></div><div class="lm l"><p class="bd b gc z el lj eo ep lk er et ek translated">hackernoon.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls ja le"/></div></div></a></div><div class="lt lu fm fo lv le"><a href="https://hackernoon.com/usage-of-reselect-in-a-react-redux-application-fcdca05cc00d" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab ej"><div class="lg ab lh cl cj li"><h2 class="bd hv fv z el lj eo ep lk er et ht dt translated">在React-Redux应用程序中使用重选</h2><div class="ll l"><h3 class="bd b fv z el lj eo ep lk er et ek translated">为什么重选这么好</h3></div><div class="lm l"><p class="bd b gc z el lj eo ep lk er et ek translated">hackernoon.com</p></div></div><div class="ln l"><div class="lw l lp lq lr ln ls ja le"/></div></div></a></div><div class="lt lu fm fo lv le"><a href="https://hackernoon.com/using-normalizr-to-organize-data-in-store-part-2-d9646133b7df" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab ej"><div class="lg ab lh cl cj li"><h2 class="bd hv fv z el lj eo ep lk er et ht dt translated">使用Normalizr组织存储中的数据。第二部分</h2><div class="ll l"><h3 class="bd b fv z el lj eo ep lk er et ek translated">文章的第二部分讲述了如何使用Normalizr来组织商店中的数据。</h3></div><div class="lm l"><p class="bd b gc z el lj eo ep lk er et ek translated">hackernoon.com</p></div></div><div class="ln l"><div class="lx l lp lq lr ln ls ja le"/></div></div></a></div><div class="lt lu fm fo lv le"><a href="https://hackernoon.com/how-to-stop-using-callbacks-and-start-living-1e5ed92e68e8" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab ej"><div class="lg ab lh cl cj li"><h2 class="bd hv fv z el lj eo ep lk er et ht dt translated">如何停止使用回调，开始生活</h2><div class="ll l"><h3 class="bd b fv z el lj eo ep lk er et ek translated">Javascript有两种处理异步任务的主要方式——回调和承诺。一般来说，承诺是…</h3></div><div class="lm l"><p class="bd b gc z el lj eo ep lk er et ek translated">hackernoon.com</p></div></div><div class="ln l"><div class="ly l lp lq lr ln ls ja le"/></div></div></a></div><p id="b98e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">作者:<a class="ae lz" href="https://github.com/iPhaeton" rel="noopener ugc nofollow" target="_blank">伊利亚·博哈斯洛克</a></p><div class="kb kc kd ke fq ab cb"><figure class="ma iv mb mc md me mf paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ma iv mb mc md me mf paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ma iv mb mc md me mf paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mg mh mi"><p id="f922" class="jc jd kq je b jf jg jh ji jj jk jl jm mj jo jp jq mk js jt ju ml jw jx jy jz hn dt translated"><a class="ae lz" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae lz" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae lz" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae lz" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd kq je b jf jg jh ji jj jk jl jm mj jo jp jq mk js jt ju ml jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae lz" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae lz" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mm"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>