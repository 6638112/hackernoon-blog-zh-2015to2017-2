<html>
<head>
<title>Dear Microsoft, This is How You Encrypt a File</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">亲爱的微软，这是你加密文件的方式</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/dear-microsoft-this-is-how-you-encrypt-a-file-779cc0a19bfc?source=collection_archive---------5-----------------------#2017-06-29">https://medium.com/hackernoon/dear-microsoft-this-is-how-you-encrypt-a-file-779cc0a19bfc?source=collection_archive---------5-----------------------#2017-06-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="feb7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我的上一篇文章中，我对一篇13年前的MSDN文章感到惊讶，这篇文章竟然出自一个不熟悉加密初始化向量正确用法的人之手。我的一些粉丝很友好地指出，在我戏剧性的咆哮和胡言乱语中，我忘了说任何有用的东西，比如你如何<em class="jq">实际上</em>应该加密一个文件。</p><p id="d94f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以，废话不多说，下面是你如何加密和解密一个文件:</p><pre class="jr js jt ju fq jv jw jx jy aw jz dt"><span id="0a9b" class="ka kb hu jw b fv kc kd l ke kf">$ gpg -c --cipher-algo AES128 [file]  # Encrypt<br/>$ gpg -d [file].gpg  # Decrypt</span></pre><p id="a1a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虎头蛇尾，对吧？它甚至没有提到静脉注射，但这是关键。包含手动处理IVs的文件加密教程有点像包含重新实现TCP的设置web服务器的教程。这样做毫无益处，而且你几乎肯定会做错。这就是<em class="jq">加密文件</em>和<em class="jq">实现文件加密</em>的区别。第一个是程序员的常见任务，第二个不应该由非密码专家来尝试。微软应该知道不要把这两者混为一谈，尤其是在面向外行读者的教程中。</p><h2 id="6b6b" class="ka kb hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">GPG？</h2><p id="936c" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">这篇文章不应该是关于GPG的教程，但是如果有人真的想接受我的建议，请查看文档。如果你想用[target<a class="ae jp" href="https://hackernoon.com/tagged/programming" rel="noopener ugc nofollow" target="_blank">programming</a>language]进行文件加密，只需用该语言的OpenPGP实现进行相同的操作。</p><h2 id="f521" class="ka kb hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">哇所以PGP是万无一失的？</h2><p id="b569" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">哦，上帝，不。它有许多缺陷，其中最大的可能是可怕的密钥分发。它恰好有一个体面的文件加密实现，可以在几乎每种平台和几乎每种编程语言上使用。如果你想彻底搞清楚这个话题，这里有<a class="ae jp" href="https://blog.cryptographyengineering.com/2014/08/13/whats-matter-with-pgp/" rel="noopener ugc nofollow" target="_blank">马修·格林</a>和<a class="ae jp" href="https://arstechnica.co.uk/security/2016/12/op-ed-im-giving-up-on-pgp/" rel="noopener ugc nofollow" target="_blank">菲利普·瓦尔索达</a>拉屎满PGP。</p><h2 id="f953" class="ka kb hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">嘿，我是来了解加密细节的！</h2><p id="4530" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">好了，现在我们都清楚了，当你想加密一个文件时，你应该只使用一个主流的、高级的加密库，而不要自己接触原语，这里有一个实现文件加密的基本方法，它并不完全糟糕:</p><ol class=""><li id="9a03" class="le lf hu it b iu iv iy iz jc lg jg lh jk li jo lj lk ll lm dt translated">选择安全的现代分组密码。我会坚持使用AES128，除非你有真正令人信服的理由使用其他东西。如果你愿意，你可以使用AES256，但实际上它不会增加<a class="ae jp" href="https://hackernoon.com/tagged/security" rel="noopener ugc nofollow" target="_blank">安全性</a>。你的密码没有接近128位的熵，所以它是这个链条中最薄弱的一环。</li><li id="53f8" class="le lf hu it b iu ln iy lo jc lp jg lq jk lr jo lj lk ll lm dt translated">获取加密安全的随机值以用作初始化向量。(提示:使用<a class="ae jp" href="https://security.stackexchange.com/a/3939" rel="noopener ugc nofollow" target="_blank"> /dev/urandom </a>)</li><li id="dc51" class="le lf hu it b iu ln iy lo jc lp jg lq jk lr jo lj lk ll lm dt translated">获取高熵密钥。在这种情况下，我会说选择一个强密码(完全是另一个话题)，然后通过<a class="ae jp" href="https://en.wikipedia.org/wiki/Bcrypt" rel="noopener ugc nofollow" target="_blank"> bcrypt </a>运行它以进行<a class="ae jp" href="https://en.wikipedia.org/wiki/Key_stretching" rel="noopener ugc nofollow" target="_blank">键拉伸</a>。为了简单起见，你可以用IV作为盐。</li><li id="e787" class="le lf hu it b iu ln iy lo jc lp jg lq jk lr jo lj lk ll lm dt translated">使用您的块密码、通过bcrypt发送密码创建的密钥和/dev/urandom生成的IV，执行<a class="ae jp" href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher_Block_Chaining_.28CBC.29" rel="noopener ugc nofollow" target="_blank">密码块链接</a>来加密您的明文。</li><li id="6f31" class="le lf hu it b iu ln iy lo jc lp jg lq jk lr jo lj lk ll lm dt translated">将IV附加到密文的开头，然后通过<a class="ae jp" href="https://en.wikipedia.org/wiki/Hash-based_message_authentication_code" rel="noopener ugc nofollow" target="_blank"> HMAC </a>运行整个过程，最好使用SHA2或SHA3。请注意，我们在加密后进行认证，避免了<a class="ae jp" href="https://moxie.org/blog/the-cryptographic-doom-principle/" rel="noopener ugc nofollow" target="_blank">毁灭法则</a>。</li><li id="a412" class="le lf hu it b iu ln iy lo jc lp jg lq jk lr jo lj lk ll lm dt translated">把HMAC的输出附加到IV和密文上，并输出结果。所以你的输出应该是IV || CT || HMAC(IV || CT)</li></ol><p id="187b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这就对了，用6个简单的步骤实现文件加密。如果您需要一个包含这里提到的原语的库，OpenSSL是一个不错的选择。如果您想解密，请通过从IV || CT重新计算HMAC并与给定的HMAC进行比较来验证它，然后只需撤消CBC加密。</p><h2 id="f356" class="ka kb hu bd kg kh ki kj kk kl km kn ko jc kp kq kr jg ks kt ku jk kv kw kx ky dt translated">太酷了…但是我们为什么要做那些事情呢？</h2><p id="e980" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">随机化的IV和密码块链接实现了语义安全，这样我们就不会泄露信息。HMAC实现<a class="ae jp" href="https://en.wikipedia.org/wiki/Data_integrity" rel="noopener ugc nofollow" target="_blank">数据完整性</a>和<a class="ae jp" href="https://en.wikipedia.org/wiki/Authentication" rel="noopener ugc nofollow" target="_blank">认证</a>。使用bcrypt进行密钥拉伸会使从您的密码生成的密钥不那么可怕。</p><p id="c584" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想通过编程来学习这些东西(你可以容忍一个由黑客设计UI的webapp ),去看看https://id0-rsa.pub/吧。</p><blockquote class="ls lt lu"><p id="49ab" class="ir is jq it b iu iv iw ix iy iz ja jb lv jd je jf lw jh ji jj lx jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is jq it b iu iv iw ix iy iz ja jb lv jd je jf lw jh ji jj lx jl jm jn jo hn dt translated">要了解更多信息，<a class="ae jp" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a>，<a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上点赞/给我们发消息</a>，或者简单地说，<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is jq it b iu iv iw ix iy iz ja jb lv jd je jf lw jh ji jj lx jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jr js jt ju fq ly"><div class="bz el l di"><div class="lz ma l"/></div></figure></div></div>    
</body>
</html>