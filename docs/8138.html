<html>
<head>
<title>Install Certificates in Alpine Image to establish Secured Communication (SSL/TLS)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Alpine映像中安装证书以建立安全通信(SSL/TLS)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/alpine-docker-image-with-secured-communication-ssl-tls-go-restful-api-128eb6b54f1f?source=collection_archive---------3-----------------------#2017-11-21">https://medium.com/hackernoon/alpine-docker-image-with-secured-communication-ssl-tls-go-restful-api-128eb6b54f1f?source=collection_archive---------3-----------------------#2017-11-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="47e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每个客户端/服务器通信都需要通过具有安全套接字层/传输层安全性的协议来保护。传输层安全性(TLS)的前身是安全套接字层(SSL)，TLS存在的原因是因为SSL容易受到攻击，并且SSL与TLS在应用程序间通信的加密标准上有所不同。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff jp"><img src="../Images/103a6932949b9b6edc7bcd390733c838.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*iGr6HAIJEckGdpTCUF5ydA.png"/></div></figure><p id="6d50" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">应用程序之间的安全通信依赖于由客户端和服务器双方同意的认证机构(CA)分发的证书(cert)。CA是一个发行数字证书的实体，它具有x.509标准(使用公钥加密)，少数领先的CA提供商是Comodo、GoDaddy、Global Sign &amp; Symantec。</p><p id="cf93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本文将关注如何将证书安装到带有RESTful API的docker映像中。我们可以将本文分为三个部分，解释安全性的关键概念以及如何实现它。</p><ul class=""><li id="97ad" class="jx jy hu it b iu iv iy iz jc jz jg ka jk kb jo kc kd ke kf dt translated">证书格式</li><li id="46f2" class="jx jy hu it b iu kg iy kh jc ki jg kj jk kk jo kc kd ke kf dt translated">客户机/服务器通信和单向认证</li><li id="894d" class="jx jy hu it b iu kg iy kh jc ki jg kj jk kk jo kc kd ke kf dt translated">将证书添加到docker映像</li></ul><h2 id="e67b" class="kl km hu bd kn ko kp kq kr ks kt ku kv jc kw kx ky jg kz la lb jk lc ld le lf dt translated">证书格式</h2><p id="5a7f" class="pw-post-body-paragraph ir is hu it b iu lg iw ix iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo hn dt translated">大多数证书格式都带有后缀-。pem，。cer，。crt，。钥匙。与服务器通信的客户端(浏览器/客户端系统)将保持*。pem(隐私增强邮件)或. cer(SSL证书的文件扩展名),用于建立安全连接。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="fe ff ll"><img src="../Images/a09e06554c5e5109f76720e3081d0373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XlBLha_CscXmICBU7Kxzdw.png"/></div></div><figcaption class="lq lr fg fe ff ls lt bd b be z ek"><strong class="bd lu">Common Format of a *.pem, *.cer, *.crt</strong></figcaption></figure><p id="b2de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">RSA(Rivest–sha mir–ad leman)算法用于加密和解密通信中的消息，其中一个密钥保持公开，另一个密钥保持私有，这定义了公钥加密(也称为非对称加密)的概念。使用TLS可以防止最常见的攻击，如MITMA(中间人攻击)。注册机构(RA)帮助认证来自可用公钥基础设施<strong class="it hv"> </strong> (PKI)的证书，并充当CA的中间人。</p><h2 id="d0b0" class="kl km hu bd kn ko kp kq kr ks kt ku kv jc kw kx ky jg kz la lb jk lc ld le lf dt translated">客户机/服务器通信和单向认证</h2><p id="7bd2" class="pw-post-body-paragraph ir is hu it b iu lg iw ix iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo hn dt translated">简而言之，下面总结了通过单向认证在两个资源之间建立安全连接的整个通信。</p><ol class=""><li id="e7da" class="jx jy hu it b iu iv iy iz jc jz jg ka jk kb jo lv kd ke kf dt translated">客户端从服务器请求受保护的资源(RESTful API调用)</li><li id="32ce" class="jx jy hu it b iu kg iy kh jc ki jg kj jk kk jo lv kd ke kf dt translated">客户端向服务器提供用其公钥加密的信息</li><li id="8c6f" class="jx jy hu it b iu kg iy kh jc ki jg kj jk kk jo lv kd ke kf dt translated">服务器使用其私钥(仅在服务器端可用)评估请求，并根据请求的资源做出响应</li></ol><p id="95e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于相互身份验证，它的工作方式是相同的，客户端和服务器都提供它们的公钥，并用它们自己的私钥解密它们的消息。</p><h2 id="a434" class="kl km hu bd kn ko kp kq kr ks kt ku kv jc kw kx ky jg kz la lb jk lc ld le lf dt translated">将证书添加到docker映像</h2><p id="dc8a" class="pw-post-body-paragraph ir is hu it b iu lg iw ix iy lh ja jb jc li je jf jg lj ji jj jk lk jm jn jo hn dt translated">我们可以看到一个演示如何在一个docker容器中实现单向认证，这个容器有Golang RESTful API。请参考文章<a class="ae lw" href="https://hackernoon.com/golang-docker-microservices-for-enterprise-model-5c79addfa811" rel="noopener ugc nofollow" target="_blank"> Golang &amp; Docker —企业模型的微服务(RESTful API)</a>来说明创建RESTful API并将其打包成Docker映像的步骤。</p><p id="79c1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">docker映像由多个资源组成，这些资源将构成一个容器，在云中独立地为请求提供服务，管理员负责在映像内部的根目录中安装相关证书，以确保其安全。另外，在代码中指示在调用其他安全API时考虑来自根的证书。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/103be9f64e4f13390ab96efa9ee68af0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*2V6S9p4AQiYFB7gy66TCvw.jpeg"/></div><figcaption class="lq lr fg fe ff ls lt bd b be z ek">Image with certs installed</figcaption></figure><p id="4de1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在alpine中，我们有一个名为<a class="ae lw" href="https://pkgs.alpinelinux.org/package/v3.3/main/x86/ca-certificates" rel="noopener ugc nofollow" target="_blank"> ca-certificates </a>的包实用程序，它带有Mozilla浏览器的预装证书。此外，您需要使用TLS所需的第三方证书来更新捆绑包，这可以通过指定Dockerfile中的更新证书命令来完成。</p><blockquote class="ly lz ma"><p id="51c0" class="ir is mb it b iu iv iw ix iy iz ja jb mc jd je jf md jh ji jj me jl jm jn jo hn dt translated">来自阿尔卑斯山:最新</p><p id="e9c2" class="ir is mb it b iu iv iw ix iy iz ja jb mc jd je jf md jh ji jj me jl jm jn jo hn dt translated">运行apk更新&amp;&amp; apk添加ca证书&amp;&amp; rm -rf /var/cache/apk/*</p><p id="a198" class="ir is mb it b iu iv iw ix iy iz ja jb mc jd je jf md jh ji jj me jl jm jn jo hn dt translated">收到。/mycert . CRT/usr/local/share/ca-certificates/mycert . CRT</p><p id="b2c9" class="ir is mb it b iu iv iw ix iy iz ja jb mc jd je jf md jh ji jj me jl jm jn jo hn dt translated">运行更新-ca-证书</p></blockquote><p id="0629" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将以下命令添加到解释以下步骤的Docker文件中。</p><ul class=""><li id="86c0" class="jx jy hu it b iu iv iy iz jc jz jg ka jk kb jo kc kd ke kf dt translated">从码头登记处调出阿尔卑斯山的图像</li><li id="c6c4" class="jx jy hu it b iu kg iy kh jc ki jg kj jk kk jo kc kd ke kf dt translated">在docker映像中安装ca-certificates包，并删除temp文件夹</li><li id="4198" class="jx jy hu it b iu kg iy kh jc ki jg kj jk kk jo kc kd ke kf dt translated">将证书从您的本地机器复制到要构建的映像中的所需文件夹。</li><li id="9454" class="jx jy hu it b iu kg iy kh jc ki jg kj jk kk jo kc kd ke kf dt translated">运行命令update-ca-certificates将新证书更新到相应的文件夹中</li></ul><p id="c8bc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以上步骤会将您的第三方证书添加到您的docker映像中，一旦映像构建完成且容器启动，Golang库将检测证书(x.509标准)并提供适当的公钥，以便与调用API建立安全连接</p></div></div>    
</body>
</html>