<html>
<head>
<title>Guide to Handling Internet Archive’s CDX Server API Response</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理Internet Archive的CDX服务器API响应指南</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/guide-to-handling-internet-archives-cdx-server-api-response-c469df5b81f4?source=collection_archive---------12-----------------------#2017-04-24">https://medium.com/hackernoon/guide-to-handling-internet-archives-cdx-server-api-response-c469df5b81f4?source=collection_archive---------12-----------------------#2017-04-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="c393" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">访问网页的数字档案</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/9899454ddd974d713d7617a6df82cb7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lOtv6SSmqX-ZmtRgNFmb1w.jpeg"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Photo credit: <a class="ae jz" href="http://www.adra.com/uk/products/balancer-balance-sheet-reconciliation-software/digital-archive/" rel="noopener ugc nofollow" target="_blank">Adra</a></figcaption></figure><p id="7548" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">对于那些还不知道的人来说，<a class="ae jz" href="https://archive.org/web/web.php" rel="noopener ugc nofollow" target="_blank">时光倒流机</a>是互联网上网页的综合数字<a class="ae jz" href="https://hackernoon.com/tagged/archive" rel="noopener ugc nofollow" target="_blank">档案库</a>——自2001年以来已经收集了超过2860亿个网页。</p><p id="4449" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">Wayback使用<a class="ae jz" href="https://github.com/internetarchive/wayback/blob/master/wayback-cdx-server/README.md" rel="noopener ugc nofollow" target="_blank"> CDX服务器API </a>来查找捕获——它允许对Wayback捕获数据进行复杂的查询、过滤和分析。我最近用这个API用d3的径向树形图可视化了一个网站。你可以在这里看到结果<a class="ae jz" href="http://juliageist.com/internet-archive-website-visualization/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="2ddd" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">因为我的项目中最困难的部分是弄清楚如何将CDX API的响应转换成我可以抓取的HTML页面，所以这篇文章是向<a class="ae jz" href="https://hackernoon.com/tagged/api" rel="noopener ugc nofollow" target="_blank"> API </a>发出请求并处理来自它的响应的指南。</p><h2 id="46a6" class="kw kx hu bd ky kz la lb lc ld le lf lg kj lh li lj kn lk ll lm kr ln lo lp lq dt translated">提出请求</h2><p id="e84b" class="pw-post-body-paragraph ka kb hu kc b kd lr iv kf kg ls iy ki kj lt kl km kn lu kp kq kr lv kt ku kv hn dt translated">发出请求只是对<a class="ae jz" href="http://web.archive.org/cdx/search/cdx." rel="noopener ugc nofollow" target="_blank">http://web.archive.org/cdx/search/cdx.</a>的一个<code class="eh lw lx ly lz b">GET</code>请求，一个网站是通过一个查询字符串指定的——这是唯一需要的查询字符串参数。(要查看还可以指定哪些查询字符串，<a class="ae jz" href="https://github.com/internetarchive/wayback/blob/master/wayback-cdx-server/README.md" rel="noopener ugc nofollow" target="_blank">查看文档</a>)。</p><p id="ea09" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">要获得reddit.com的所有存档版本或截图，你可以向http://web.archive.org/cdx/search/cdx?url=reddit.com.发出一个请求</p><p id="395b" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">太棒了。让我们重温一下目标——从CDX API获取网页的所有捕获，这样我就可以通过存档的HTML发送我的爬虫。好吧，接下来该怎么办？</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ma"><img src="../Images/789df96daaef0d13a28126afbb48cc74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v0V4eBVBgLZiFVx_ZjeK-Q.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Ummmmmm…</figcaption></figure><h2 id="4772" class="kw kx hu bd ky kz la lb lc ld le lf lg kj lh li lj kn lk ll lm kr ln lo lp lq dt translated">处理响应</h2><p id="dc40" class="pw-post-body-paragraph ka kb hu kc b kd lr iv kf kg ls iy ki kj lt kl km kn lu kp kq kr lv kt ku kv hn dt translated">响应的<code class="eh lw lx ly lz b">Content-Type</code>是<code class="eh lw lx ly lz b">text/plain</code>——所以我们将自己进行解析。如<a class="ae jz" href="https://github.com/internetarchive/wayback/blob/master/wayback-cdx-server/README.md" rel="noopener ugc nofollow" target="_blank">文档</a>中所述，由空格分开的列依次对应于:<code class="eh lw lx ly lz b">urlkey</code>、<code class="eh lw lx ly lz b">timestamp</code>、<code class="eh lw lx ly lz b">original url</code>、<code class="eh lw lx ly lz b">mimetype</code>、<code class="eh lw lx ly lz b">status code</code>、<code class="eh lw lx ly lz b">digest</code>和<code class="eh lw lx ly lz b">length</code>。</p><p id="5c68" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我创建了一个数据模型对象来表示一次捕获。</p><pre class="jk jl jm jn fq mb lz mc md aw me dt"><span id="8bf7" class="kw kx hu lz b fv mf mg l mh mi">// snapshot.py</span><span id="aa35" class="kw kx hu lz b fv mj mg l mh mi">class Snapshot(dict):<br/>   def __init__(self, urlkey=None, timestamp=None, original=None, mimetype=None, statuscode=None, digest=None, length=None):<br/>       super(Snapshot, self).__init__()<br/>       self[‘urlkey’] = urlkey<br/>       self[‘timestamp’] = timestamp<br/>       self[‘original’] = original<br/>       self[‘mimetype’] = mimetype<br/>       self[‘statuscode’] = statuscode<br/>       self[‘digest’] = digest<br/>       self[‘length’] = length<br/>       self[‘snapshot_url’] = ‘http://web.archive.org/web/%s/%s/’ % (timestamp, original)</span></pre><p id="583b" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我所做的只是在一个字典对象上设置键。请注意，我为我的<code class="eh lw lx ly lz b">Snapshot</code>模型— <code class="eh lw lx ly lz b">snapshot_url</code>添加了一个CDX响应中没有提供的键。</p><p id="c31e" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">任何给定捕获的HTML页面位于一个URL中，该URL由捕获的<code class="eh lw lx ly lz b">timestamp</code>和<code class="eh lw lx ly lz b">original URL</code>格式化。格式为<code class="eh lw lx ly lz b">http://web.archive.org/web/&lt;/TIMESTAMP&gt;/&lt;/URL&gt;</code>。</p><p id="87a1" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">如果您希望恢复原始页面(不需要Wayback机器重写页面上的URL以指向存档)，您应该使用这种格式:<code class="eh lw lx ly lz b">http://web.archive.org/web/&lt;/TIMESTAMP&gt;id_/&lt;/URL&gt;</code>。</p><p id="36aa" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">太棒了。现在我们已经建立了数据模型(即<code class="eh lw lx ly lz b">Snapshot</code>类),我们可以向CDX API发出请求，并使用响应创建<code class="eh lw lx ly lz b">Snapshot</code>类的实例。</p><p id="7a4d" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">因为我们得到了一个文本文件，我们将首先通过<code class="eh lw lx ly lz b">\n</code>或者新行来分割，以得到一个捕获字符串的列表。对于每个捕获，我们将按空格(“”)进行分割，以获得以列表格式返回的各个列。完成后，我们将有一个列表列表，代表从API返回的捕获。</p><pre class="jk jl jm jn fq mb lz mc md aw me dt"><span id="0f99" class="kw kx hu lz b fv mf mg l mh mi">// reddit.py</span><span id="8a24" class="kw kx hu lz b fv mj mg l mh mi">from snapshot import Snapshot<br/>import requests as req</span><span id="568d" class="kw kx hu lz b fv mj mg l mh mi">res = req.get(“http://web.archive.org/cdx/search/cdx?url=reddit.com")</span><span id="acde" class="kw kx hu lz b fv mj mg l mh mi">snapshots = res.text.split(‘\n’)</span><span id="5477" class="kw kx hu lz b fv mj mg l mh mi">for snapshot in snapshots:<br/>    snapshot_items = snapshot.split(‘ ‘)</span></pre><p id="6720" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">接下来，我们将为API返回的每个快照实例化一个新的快照对象。</p><pre class="jk jl jm jn fq mb lz mc md aw me dt"><span id="5d98" class="kw kx hu lz b fv mf mg l mh mi">// reddit.py</span><span id="789c" class="kw kx hu lz b fv mj mg l mh mi">from snapshot import Snapshot<br/>import requests as req</span><span id="24f6" class="kw kx hu lz b fv mj mg l mh mi">res = req.get("http://web.archive.org/cdx/search/cdx?url=reddit.com")</span><span id="788e" class="kw kx hu lz b fv mj mg l mh mi">snapshots = res.text.split('\n')<br/>snapshot_list = []</span><span id="eadf" class="kw kx hu lz b fv mj mg l mh mi">for snapshot in snapshots:<br/>    snapshot_items = snapshot.split(' ')<br/>    if len(snapshot_items) == 7:<br/>        snap = Snapshot(snapshot_items[0], snapshot_items[1], snapshot_items[2], snapshot_items[3], snapshot_items[4], snapshot_items[5], snapshot_items[6])<br/>    snapshot_list.append(snap)</span></pre><p id="7769" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">现在<code class="eh lw lx ly lz b">snapshot_list</code>变量包含了您可以使用的<code class="eh lw lx ly lz b">Snapshot</code>对象！在向那个特定的<code class="eh lw lx ly lz b">snapshot_url</code>发出请求之前，确保你检查了那个<code class="eh lw lx ly lz b">statuscode == 200</code>。</p><p id="78ea" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">希望这篇文章有所帮助！如果有任何问题，请告诉我！</p><div class="jk jl jm jn fq ab cb"><figure class="mk jo ml mm mn mo mp paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mk jo ml mm mn mo mp paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mk jo ml mm mn mo mp paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mq mr ms"><p id="f922" class="ka kb mt kc b kd ke iv kf kg kh iy ki mu kk kl km mv ko kp kq mw ks kt ku kv hn dt translated"><a class="ae jz" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jz" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jz" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jz" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ka kb mt kc b kd ke iv kf kg kh iy ki mu kk kl km mv ko kp kq mw ks kt ku kv hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jz" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jz" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mx"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="my mz l"/></div></figure></div></div>    
</body>
</html>