<html>
<head>
<title>How to Make a Simple Twitter Clone with React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用React Native制作一个简单的Twitter克隆</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-make-a-simple-twitter-clone-with-react-native-4b6c45940583?source=collection_archive---------4-----------------------#2017-06-21">https://medium.com/hackernoon/how-to-make-a-simple-twitter-clone-with-react-native-4b6c45940583?source=collection_archive---------4-----------------------#2017-06-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/83338940d874d34882eb307a217e906f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LdILubt6GwduXXvt.png"/></div></div></figure><p id="70e3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本教程中，我们将使用React Native创建一个小型的类似Twitter的移动应用程序。通过我们的应用程序，用户将能够创建帐户并登录，查看自己和其他用户创建的所有帖子的提要，并向提要添加自己的帖子。我们所有用户和帖子的数据将由Cosmic JS管理。</p><h1 id="f2e8" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">TL；速度三角形定位法(dead reckoning)</h1><p id="dbbc" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated"><a class="ae ld" href="https://github.com/cosmicjs/react-native-twitter-clone" rel="noopener ugc nofollow" target="_blank">在GitHub上查看源代码</a> <br/> <a class="ae ld" href="https://cosmicjs.com/apps/react-native-twitter-clone" rel="noopener ugc nofollow" target="_blank">在Cosmic JS上安装app(还需要本地运行)</a></p><h1 id="11fc" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">入门指南</h1><p id="057d" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">您需要安装node.js和yarn或npm。对于这个项目，我使用的是yarn和node v8.1.2。</p><p id="6f2d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有许多方法可以启动一个新的React原生项目；对于这一个，我使用了<a class="ae ld" href="https://github.com/react-community/create-react-native-app" rel="noopener ugc nofollow" target="_blank"> create-react-native-app </a>。我们可以通过运行以下命令来全局安装CRNA并启动一个新项目:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="3311" class="ln kb hu lj b fv lo lp l lq lr">$ yarn global add create-react-native-app<br/>$ create-react-native-app twitter-clone<br/>$ cd twitter-clone/<br/>$ yarn start</span></pre><p id="1344" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我还使用了Expo SDK，这样我就不用安装Xcode和Android Studio了。这也将为我提供一些功能，如加载字体和允许用户上传照片到应用程序。要开始使用Expo，请参考文档。</p><h1 id="e0fd" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">属国</h1><p id="5620" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">我们将在这个项目中使用几个工具；这里我们就讲几个关键的。</p><ul class=""><li id="5d9d" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">Native Base 是一个组件库，它允许我们快速制作一个跨平台的有吸引力的用户界面。</li><li id="4d51" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated"><a class="ae ld" href="https://github.com/aksonov/react-native-router-flux" rel="noopener ugc nofollow" target="_blank"> React Native Router Flux </a>将帮助我们在应用程序的不同屏幕之间导航。</li><li id="8aa6" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated"><a class="ae ld" href="https://github.com/reactjs/react-redux" rel="noopener ugc nofollow" target="_blank"> React-Redux </a>将把我们应用程序的不同组件连接到我们的商店，我们将在那里保存关于我们应用程序状态的数据。</li><li id="0dcd" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">Axios是一个基于承诺的HTTP客户端，我们将用它来调用Cosmic JS API。</li></ul><p id="31a8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">继续将以下内容复制并粘贴到package.json中，然后再次运行yarn install。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="e0a7" class="ln kb hu lj b fv lo lp l lq lr">{<br/>  "name": "twitter-clone",<br/>  "version": "1.0.0",<br/>  "private": true,<br/>  "devDependencies": {<br/>    "jest-expo": "~1.0.1",<br/>    "react-native-scripts": "0.0.30",<br/>    "react-test-renderer": "16.0.0-alpha.6"<br/>  },<br/>  "main": "./node_modules/react-native-scripts/build/bin/crna-entry.js",<br/>  "scripts": {<br/>    "start": ""react-native-scripts start",<br/>    "eject": "react-native-scripts eject",<br/>    "android": "react-native-scripts android",<br/>    "ios": "react-native-scripts ios",<br/>    "test": "node node_modules/jest/bin/jest.js --watch"<br/>  },<br/>  "jest": {<br/>    "preset": "jest-expo"<br/>  },<br/>  "dependencies": {<br/>    "@expo/vector-icons": "^5.0.0",<br/>    "axios": "^0.16.1",<br/>    "expo": "^17.0.0",<br/>    "form-data": "^2.2.0",<br/>    "native-base": "^2.1.4",<br/>    "react": "16.0.0-alpha.6",<br/>    "react-native": "^0.44.0",<br/>    "react-native-router-flux": "^3.39.2",<br/>    "react-redux": "^5.0.5",<br/>    "redux": "^3.6.0",<br/>    "redux-devtools-extension": "^2.13.2",<br/>    "redux-logger": "^3.0.6",<br/>    "redux-thunk": "^2.2.0",<br/>  }<br/>}</span></pre><h1 id="10eb" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">目录结构</h1><p id="9062" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">与其他一些样板文件相比，CRNA对我们如何在应用程序中构造文件没有太大的偏见；它只是给了我们一个index.ios.js和index.android.js和App.js作为起点。</p><p id="6dde" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将让我们的App.js指向一个名为App的文件夹，它将保存我们所有的组件、布局、配置文件以及redux存储和reducers。以下是我发现的最适合我的脚手架。我不会在这篇文章中详细讨论每个文件的内容，但是你可以在源代码中看到所有的内容。</p><p id="2f2f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是我们的应用程序文件夹的外观:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="2450" class="ln kb hu lj b fv lo lp l lq lr">.<br/>├── assets<br/>│   └── fonts<br/>│       └── Pacifico.ttf<br/>├── components<br/>│   ├── FeedNavbar<br/>│   │   ├── FeedNavbar.js<br/>│   │   ├── index.js<br/>│   │   └── styles.js<br/>│   ├── SinglePost<br/>│   │   ├── SinglePost.js<br/>│   │   ├── index.js<br/>│   │   └── styles.js<br/>│   ├── SmallButton<br/>│   │   ├── SmallButton.js<br/>│   │   ├── index.js<br/>│   │   └── styles.js<br/>│   └── TextField<br/>│       ├── TextField.js<br/>│       ├── index.js<br/>│       └── styles.js<br/>├── config<br/>│   ├── cosmic.js<br/>│   └── routes.js<br/>├── layouts<br/>│   ├── feed<br/>│   │   ├── Feed.js<br/>│   │   ├── index.js<br/>│   │   └── styles.js<br/>│   ├── login<br/>│   │   ├── Login.js<br/>│   │   ├── index.js<br/>│   │   └── styles.js<br/>│   ├── newPost<br/>│   │   ├── NewPost.js<br/>│   │   ├── index.js<br/>│   │   └── styles.js<br/>│   ├── signup<br/>│   │   ├── Signup.js<br/>│   │   ├── index.js<br/>│   │   └── styles.js<br/>│   └── welcome<br/>│       ├── Welcome.js<br/>│       ├── index.js<br/>│       └── styles.js<br/>└── redux<br/>    ├── reducers<br/>    │   ├── index.js<br/>    │   ├── posts.js<br/>    │   └── users.js<br/>    └── store.js</span></pre><h1 id="9168" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">应用</h1><p id="32e0" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">我们的App.js文件中将会发生一些事情。我们将:</p><ul class=""><li id="40e1" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">拉进我们的路线，导航到我们的各种布局</li><li id="e64b" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">将我们的提供者连接到我们的商店，这将让我们的布局访问我们的应用程序状态</li><li id="e3bf" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">提供对Natve Base使用的一些字体的访问</li><li id="af78" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">用AppRegistry建立我们的根组件</li></ul><p id="69c2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以将以下内容复制并粘贴到项目根目录下的App.js文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="81b4" class="ln kb hu lj b fv lo lp l lq lr">import React, { Component } from 'react';<br/>import { AppRegistry, View } from 'react-native';<br/>import { Provider, connect } from 'react-redux';<br/>import { Font, AppLoading } from 'expo';<br/>import store from './app/redux/store';<br/>import Router from './app/config/routes';</span><span id="0ae1" class="ln kb hu lj b fv mg lp l lq lr">export default class App extends Component {<br/>  constructor(){<br/>    super();<br/>    this.state = {<br/>      isReady: false,<br/>    }<br/>  }</span><span id="181f" class="ln kb hu lj b fv mg lp l lq lr">  async componentWillMount() {<br/>    await Font.loadAsync({<br/>      'Roboto': require('native-base/Fonts/Roboto.ttf'),<br/>      'Roboto_medium': require('native-base/Fonts/Roboto_medium.ttf'),<br/>      'Pacifico': require('./app/assets/fonts/Pacifico.ttf'),<br/>      'Ionicons': require('native-base/Fonts/Ionicons.ttf'),<br/>    });</span><span id="7056" class="ln kb hu lj b fv mg lp l lq lr">    this.setState({isReady: true});<br/>  }<br/></span><span id="8da6" class="ln kb hu lj b fv mg lp l lq lr">  render() {<br/>    if (!this.state.isReady) {<br/>      return &lt;AppLoading /&gt;;<br/>    }<br/>    return (<br/>      &lt;Provider store={store}&gt;<br/>        &lt;Router /&gt;<br/>      &lt;/Provider&gt;<br/>    );<br/>  }<br/>}</span><span id="5938" class="ln kb hu lj b fv mg lp l lq lr">AppRegistry.registerComponent('main', () =&gt; App);</span></pre><p id="08f9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，让我们看看routes.js文件:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="cb51" class="ln kb hu lj b fv lo lp l lq lr">import React from 'react';<br/>import { Scene, Router, Actions, ActionConst } from 'react-native-router-flux';<br/>import Welcome from '../layouts/welcome';<br/>import Login from '../layouts/login';<br/>import Signup from '../layouts/signup';<br/>import NewPost from '../layouts/newPost';<br/>import Feed from '../layouts/feed';</span><span id="7482" class="ln kb hu lj b fv mg lp l lq lr">const scenes = Actions.create(<br/>  &lt;Scene key="root"&gt;<br/>    &lt;Scene key="welcome" component={Welcome} title="Welcome" initial={true} /&gt;<br/>    &lt;Scene key="login" component={Login} title="Login" type={ActionConst.REPLACE} /&gt;<br/>    &lt;Scene key="signup" component={Signup} title="Create New Account" type={ActionConst.REPLACE} /&gt;<br/>    &lt;Scene key="feed" component={Feed} title="Your Feed" type={ActionConst.REPLACE} hideNavBar /&gt;<br/>    &lt;Scene key="newPost" component={NewPost} title="Make a new post" /&gt;<br/>  &lt;/Scene&gt;<br/>);</span><span id="c822" class="ln kb hu lj b fv mg lp l lq lr">export default () =&gt; (<br/>  &lt;Router scenes={scenes} /&gt;<br/>);</span></pre><p id="def8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用React Native Router Flux，我们刚刚创建了一系列场景，我们可以在应用程序中的任何位置轻松导航到这些场景。</p><p id="4b41" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的第一个场景是欢迎布局，用户将在登录和创建新帐户之间进行选择。看起来是这样的:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="31b3" class="ln kb hu lj b fv lo lp l lq lr">import React from 'react';<br/>import {<br/>  Container,<br/>  Content,<br/>  Icon,<br/>  Text,<br/>  Button,<br/>} from 'native-base';<br/>import { View } from 'react-native';<br/>import { Actions } from 'react-native-router-flux';</span><span id="bb8c" class="ln kb hu lj b fv mg lp l lq lr">import styles from './styles';<br/></span><span id="0a7b" class="ln kb hu lj b fv mg lp l lq lr">export default () =&gt; (<br/>  &lt;Container style={styles.container}&gt;<br/>    &lt;Content&gt;<br/>      &lt;View style={styles.iconBox}&gt;<br/>        &lt;Icon<br/>          style={styles.icon}<br/>          ios="ios-happy-outline"<br/>          android="md-happy"<br/>        /&gt;<br/>        &lt;Text style={styles.welcome}&gt;Welcome&lt;/Text&gt;<br/>      &lt;/View&gt;<br/>      &lt;View style={styles.buttonContainer}&gt;<br/>        &lt;Button<br/>          block<br/>          style={styles.button}<br/>          onPress={() =&gt; Actions.login()}<br/>        &gt;<br/>          &lt;Text&gt;Log in&lt;/Text&gt;<br/>        &lt;/Button&gt;<br/>        &lt;Text style={styles.or}&gt;OR&lt;/Text&gt;<br/>        &lt;Button<br/>          block<br/>          style={styles.button}<br/>          onPress={() =&gt; Actions.signup()}<br/>        &gt;<br/>          &lt;Text&gt;Sign up&lt;/Text&gt;<br/>        &lt;/Button&gt;<br/>      &lt;/View&gt;<br/>    &lt;/Content&gt;<br/>  &lt;/Container&gt;<br/>)</span></pre><p id="2948" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，我们刚刚创建了两个具有本地基础的按钮，它们将导航到登录和注册布局。</p><p id="9f01" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们看看我们的注册布局，看看当用户创建一个新帐户时会发生什么。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="3a15" class="ln kb hu lj b fv lo lp l lq lr">import React, { Component } from 'react';<br/>import { connect } from 'react-redux';<br/>import { ImagePicker } from 'expo';<br/>import { Actions } from 'react-native-router-flux';<br/>import {View} from 'react-native';<br/>import {<br/>  Container,<br/>  Content,<br/>  Button,<br/>  Text,<br/>  Form,<br/>  Thumbnail,<br/>  Icon<br/>} from 'native-base';<br/>import axios from 'axios';</span><span id="011f" class="ln kb hu lj b fv mg lp l lq lr">import TextField from '../../components/TextField';<br/>import styles from './styles';<br/>import { addUser } from '../../redux/reducers/users';<br/>import cosmicConfig from '../../config/cosmic';</span><span id="80a5" class="ln kb hu lj b fv mg lp l lq lr">const mapDispatchToProps = {addUser};</span><span id="a522" class="ln kb hu lj b fv mg lp l lq lr">const validate = form =&gt; {<br/>  let errorMessage = '';<br/>  if (form.username.includes(" ")){<br/>    errorMessage = "Username cannot contain spaces";<br/>  }<br/>  if (form.password.includes(" ")){<br/>    errorMessage = "Password cannot contain spaces";<br/>  }<br/>  Object.keys(form).slice(0, 5).map(field =&gt; {<br/>    if (!form[field]){<br/>      errorMessage = 'All fields must be filled';<br/>    }<br/>  })<br/>  return errorMessage;<br/>}</span><span id="d81b" class="ln kb hu lj b fv mg lp l lq lr">class Signup extends Component {<br/>  constructor() {<br/>    super();<br/>    this.state = {<br/>      firstName: '',<br/>      lastName: '',<br/>      username: '',<br/>      password: '',<br/>      image: null,<br/>      error: '',<br/>    };<br/>  }</span><span id="59b0" class="ln kb hu lj b fv mg lp l lq lr">  onSubmit(){<br/>    const error = validate(this.state);<br/>    if (error) {<br/>      this.setState({ error })<br/>    } else {<br/>      this.checkUsername(this.state.username);<br/>    }<br/>  }</span><span id="9924" class="ln kb hu lj b fv mg lp l lq lr">  checkUsername(username){<br/>    axios.get(`https://api.cosmicjs.com/v1/${cosmicConfig.bucket.slug}/object-type/users/search?metafield_key=username&amp;metafield_value=${username}`)<br/>    .then(res =&gt; res.data)<br/>    .then(data =&gt; {<br/>      if (data.objects) {<br/>        this.setState({ error: 'Username not available'})<br/>      } else {<br/>        this.props.addUser(this.state);<br/>      }<br/>    })<br/>  }</span><span id="06ea" class="ln kb hu lj b fv mg lp l lq lr">  uploadImage = async () =&gt; {<br/>    let result = await ImagePicker.launchImageLibraryAsync({<br/>      allowsEditing: true,<br/>      aspect: [4, 3],<br/>    });<br/>    if (!result.cancelled) {<br/>      this.setState({ image: result.uri });<br/>    }<br/>  };</span><span id="bdc0" class="ln kb hu lj b fv mg lp l lq lr">  render(){<br/>    return (<br/>      &lt;Container style={styles.container}&gt;<br/>        &lt;Content&gt;<br/>          &lt;Form style={styles.mar10}&gt;<br/>            &lt;TextField<br/>              name="First Name"<br/>              value={this.state.firstName}<br/>              onChangeText={(text) =&gt; this.setState({firstName: text})}<br/>            /&gt;<br/>            &lt;TextField<br/>              name="Last Name"<br/>              value={this.state.lastName}<br/>              onChangeText={(text) =&gt; this.setState({lastName: text})}<br/>            /&gt;<br/>            &lt;TextField<br/>              name="Username"<br/>              value={this.state.username}<br/>              onChangeText={(text) =&gt; this.setState({username: text})}<br/>            /&gt;<br/>            &lt;TextField<br/>              secureTextEntry<br/>              name="Password"<br/>              value={this.state.password}<br/>              onChangeText={(text) =&gt; this.setState({password: text})}<br/>            /&gt;<br/>          &lt;/Form&gt;<br/>          &lt;Text style={styles.addPic}&gt;Add a profile picture&lt;/Text&gt;<br/>          {<br/>            !this.state.image &amp;&amp;<br/>            &lt;Button<br/>              primary<br/>              bordered<br/>              onPress={this.uploadImage}<br/>              style={styles.uploadButton}&gt;<br/>              &lt;Icon<br/>                ios='ios-camera'<br/>                android='md-camera'<br/>              /&gt;<br/>            &lt;/Button&gt;<br/>          }<br/>          {<br/>            this.state.image &amp;&amp;<br/>            &lt;Thumbnail<br/>              size={80}<br/>              source={{uri: this.state.image}}<br/>              style={styles.thumbnail}<br/>            /&gt;<br/>          }<br/>          &lt;Button<br/>            block<br/>            style={styles.mar10}<br/>            onPress={() =&gt; this.onSubmit()}<br/>          &gt;<br/>            &lt;Text&gt;Create account&lt;/Text&gt;<br/>          &lt;/Button&gt;<br/>          &lt;Text style={styles.formMsg}&gt;{this.state.error}&lt;/Text&gt;<br/>          &lt;Button<br/>            transparent<br/>            style={styles.loginBtn}<br/>            onPress={() =&gt; Actions.login()}<br/>          &gt;<br/>            &lt;Text style={styles.loginTxt}&gt;Already have an account?&lt;/Text&gt;<br/>          &lt;/Button&gt;<br/>        &lt;/Content&gt;<br/>      &lt;/Container&gt;<br/>    );<br/>  }<br/>}</span><span id="2ac0" class="ln kb hu lj b fv mg lp l lq lr">export default connect(null, mapDispatchToProps)(Signup);</span></pre><p id="14b9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里发生了几件事:</p><ul class=""><li id="a28f" class="ls lt hu je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">当用户填写表单时，我们保持表单字段的内容不变。</li><li id="f926" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">当用户提交时，我们做一些简单的验证，以确保他们已经用有效的输入填写了字段。</li><li id="a2a7" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">然后，我们第一次调用Cosmic JS API，以确保他们选择的用户名没有被使用。</li><li id="3378" class="ls lt hu je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">最后，当所有字段都包含有效输入时，我们用addUserfunction将表单作为新用户提交给Cosmic JS API。</li></ul><p id="6927" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">addUser函数是在我们的usersreducer中定义的；看起来是这样的:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="9f4a" class="ln kb hu lj b fv lo lp l lq lr">export const addUser = user =&gt; dispatch =&gt; {<br/>  let data = new FormData();<br/>  data.append('media', {<br/>        uri: user.image,<br/>        type: 'image/jpeg',<br/>        name: 'image'<br/>      });</span><span id="ab48" class="ln kb hu lj b fv mg lp l lq lr">  return axios.post(`https://api.cosmicjs.com/v1/${cosmicConfig.bucket.slug}/media`, data)<br/>  .then(res =&gt; res.data.media)<br/>  .then(media =&gt; {<br/>    return axios.post(`https://api.cosmicjs.com/v1/${cosmicConfig.bucket.slug}/add-object`, {<br/>      title: user.firstName + ' ' + user.lastName,<br/>      type_slug: 'users',<br/>      metafields: [<br/>        {<br/>          key: 'name',<br/>          type: 'text',<br/>          value: user.firstName + ' ' + user.lastName,<br/>        },<br/>        {<br/>          key: 'username',<br/>          type: 'text',<br/>          value: user.username,<br/>        },<br/>        {<br/>          key: 'password',<br/>          type: 'text',<br/>          value: user.password,<br/>        },<br/>        {<br/>          key: 'profile_picture',<br/>          type: 'file',<br/>          value: media.name,<br/>              }<br/>            ]<br/>          }<br/>        )}<br/>      )<br/>      .then(res =&gt; formatUser(res.data))<br/>      .then(formattedUser =&gt; dispatch(createUser(formattedUser)))<br/>      .then(() =&gt; Actions.feed())<br/>      .catch(err =&gt; console.error(`Creating user unsuccessful`, err))<br/>}</span></pre><p id="2787" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里我们对Cosmic JS API进行了两次调用。第一个调用将用户的个人资料图片作为媒体发布到我们的bucket中，第二个调用将使用我们获得的图片的引用来发布作为新用户的所有用户信息。</p><p id="1403" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果用户已经创建了帐户，他们可以登录:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="c50b" class="ln kb hu lj b fv lo lp l lq lr">import React, { Component } from 'react';<br/>import { connect } from 'react-redux';<br/>import {<br/>  Container,<br/>  Content,<br/>  Icon,<br/>  Text,<br/>  Button,<br/>} from 'native-base';<br/>import { View } from 'react-native';<br/>import { Actions } from 'react-native-router-flux';<br/>import TextField from '../../components/TextField';<br/>import styles from './styles';</span><span id="6455" class="ln kb hu lj b fv mg lp l lq lr">import { authenticate } from '../../redux/reducers/users';</span><span id="4437" class="ln kb hu lj b fv mg lp l lq lr">const mapDispatchToProps = {authenticate};</span><span id="ce34" class="ln kb hu lj b fv mg lp l lq lr">const validate = form =&gt; {<br/>  let errorMessage = '';<br/>  if (form.username.includes(' ') || form.password.includes(' ')){<br/>    errorMessage = 'Username and password cannot contain spaces';<br/>  }<br/>  if (form.username === '' || form.password === ''){<br/>    errorMessage = 'All fields must be filled';<br/>  }<br/>  return errorMessage;<br/>}</span><span id="716f" class="ln kb hu lj b fv mg lp l lq lr">class Login extends Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.state = {<br/>      username: '',<br/>      password: '',<br/>      error: '',<br/>    };<br/>  }</span><span id="bb6a" class="ln kb hu lj b fv mg lp l lq lr">  onSubmit(){<br/>    const error = validate(this.state);<br/>    if (error) {<br/>      this.setState({ error })<br/>    } else {<br/>    this.login();<br/>    }<br/>  }</span><span id="7a1e" class="ln kb hu lj b fv mg lp l lq lr">  login(){<br/>    this.props.authenticate(this.state)<br/>      .then(res =&gt; {<br/>        if (res === 'Username invalid' || res === 'Password invalid'){<br/>          this.setState({<br/>            error: res,<br/>            username: '',<br/>            password: '',<br/>          })<br/>        } else {<br/>          Actions.feed();<br/>        }<br/>      });<br/>  }</span><span id="351d" class="ln kb hu lj b fv mg lp l lq lr">  render(){<br/>    return (<br/>      &lt;Container style={styles.container}&gt;<br/>        &lt;Content&gt;<br/>          &lt;Text style={styles.formMsg}&gt;{this.state.error}&lt;/Text&gt;<br/>          &lt;Icon<br/>            style={styles.icon}<br/>            ios="ios-happy-outline"<br/>            android="md-happy"<br/>          /&gt;<br/>          &lt;View style={styles.loginBox}&gt;<br/>            &lt;TextField<br/>            name="Enter Username"<br/>            type="big"<br/>            value={this.state.username}<br/>            onChangeText={(text) =&gt; this.setState({username: text})}<br/>            /&gt;<br/>            &lt;TextField<br/>            secureTextEntry<br/>            name="Enter Password"<br/>            type="big"<br/>            value={this.state.password}<br/>            onChangeText={(text) =&gt; this.setState({password: text})}<br/>            /&gt;<br/>          &lt;Button<br/>            block<br/>            style={styles.button}<br/>            onPress={() =&gt; this.onSubmit()}<br/>          &gt;<br/>            &lt;Text&gt;Log in&lt;/Text&gt;<br/>          &lt;/Button&gt;<br/>          &lt;/View&gt;<br/>          &lt;Button<br/>            transparent<br/>            style={styles.signupBtn}<br/>            onPress={() =&gt; Actions.signup()}&gt;<br/>            &lt;Text style={styles.signupTxt}&gt;Sign up for an account&lt;/Text&gt;<br/>          &lt;/Button&gt;<br/>        &lt;/Content&gt;<br/>      &lt;/Container&gt;<br/>    );<br/>  }<br/>}</span><span id="c01b" class="ln kb hu lj b fv mg lp l lq lr">export default connect(null, mapDispatchToProps)(Login);</span></pre><p id="2246" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">同样，我们检查以确保字段具有有效的输入，然后使用我们的authenticatefunction对照我们的bucket中的内容检查登录信息:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d86e" class="ln kb hu lj b fv lo lp l lq lr">export const authenticate = user =&gt; dispatch =&gt; {<br/>  return axios.get(`https://api.cosmicjs.com/v1/${cosmicConfig.bucket.slug}/object-type/users/search?metafield_key=username&amp;metafield_value=${user.username}`)<br/>    .then(res =&gt; res.data)<br/>    .then(data =&gt; {<br/>      console.log('RESPONSE: ', data);<br/>      if (data.objects) {<br/>        const userData = data.objects[0];<br/>        return {<br/>          password: userData.metadata.password,<br/>          username: userData.metadata.username,<br/>          name: userData.metadata.name,<br/>          profilePicture: userData.metadata.profile_picture,<br/>          slug: userData.slug,<br/>          id: userData._id,<br/>        }<br/>      } else {<br/>        return 'Username invalid';<br/>      }<br/>    })<br/>    .then(data =&gt; {<br/>      if (data === 'Username invalid'){<br/>        return data;<br/>      } else if (data.password === user.password){<br/>        dispatch(login({<br/>          name: data.name,<br/>          username: data.username,<br/>          profilePicture: data.profilePicture,<br/>          slug: data.slug,<br/>          id: data.id,<br/>        }))<br/>      } else {<br/>        return 'Password invalid';<br/>      }<br/>    })<br/>    .catch(error =&gt; console.error('Login unsuccessful', error))<br/>}</span></pre><p id="8f39" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">顺便提一下，我们通常不希望在没有某种加密的情况下将用户凭证直接存储到我们的数据库中，但是我们现在就让它这样，作为我们如何使用Cosmic API管理数据的简单说明。</p><p id="85f1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">用户登录后，将直接进入提要布局，如下所示:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="c62c" class="ln kb hu lj b fv lo lp l lq lr">import React, { Component } from 'react';<br/>import { connect } from 'react-redux';<br/>import { Actions } from 'react-native-router-flux';<br/>import {<br/>  Container,<br/>  Content,<br/>  List,<br/>  Button,<br/>  Icon,<br/>  Text,<br/>} from 'native-base';</span><span id="ed2d" class="ln kb hu lj b fv mg lp l lq lr">import SinglePost from '../../components/SinglePost';<br/>import FeedNavbar from '../../components/FeedNavbar';<br/>import { loadPosts } from '../../redux/reducers/posts';<br/>import { logoutUser } from '../../redux/reducers/users';<br/>import styles from './styles';</span><span id="6925" class="ln kb hu lj b fv mg lp l lq lr">const mapStateToProps = ({ posts }) =&gt; ({ posts });</span><span id="7900" class="ln kb hu lj b fv mg lp l lq lr">const mapDispatchToProps = { loadPosts, logoutUser };</span><span id="191e" class="ln kb hu lj b fv mg lp l lq lr">const renderPost = (post, index) =&gt; (<br/>  &lt;SinglePost<br/>    key={index}<br/>    name={post.name}<br/>    username={post.username}<br/>    profilePicture={post.profilePicture}<br/>    content={post.content}<br/>  /&gt;<br/>)</span><span id="b548" class="ln kb hu lj b fv mg lp l lq lr">class Feed extends Component {<br/>  componentDidMount(){<br/>    this.props.loadPosts();<br/>  }</span><span id="8b2f" class="ln kb hu lj b fv mg lp l lq lr">  render(){<br/>    const endMsg = this.props.posts.length === 0 ? "There aren't any posts yet!" : "That's all the posts for now!"</span><span id="a3ba" class="ln kb hu lj b fv mg lp l lq lr">    return (<br/>      &lt;Container&gt;<br/>        &lt;FeedNavbar logout={this.props.logoutUser} refresh={this.props.loadPosts} /&gt;<br/>        &lt;Content&gt;<br/>          &lt;List&gt;<br/>            {<br/>              !!this.props.posts.length &amp;&amp; this.props.posts.map(renderPost)<br/>            }<br/>          &lt;/List&gt;<br/>          &lt;Text style={styles.end}&gt;{endMsg}&lt;/Text&gt;<br/>        &lt;/Content&gt;<br/>        &lt;Button<br/>          rounded<br/>          style={styles.button}<br/>          onPress={() =&gt; Actions.newPost()}<br/>        &gt;<br/>          &lt;Icon<br/>            name="create"<br/>            style={{padding: 5}}<br/>          /&gt;<br/>        &lt;/Button&gt;<br/>      &lt;/Container&gt;<br/>    );<br/>  }<br/>}</span><span id="3150" class="ln kb hu lj b fv mg lp l lq lr">export default connect(mapStateToProps, mapDispatchToProps)(Feed);</span></pre><p id="ae7a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当提要布局挂载时，我们调用Cosmic API将我们的bucket中的所有帖子加载到我们的应用程序状态中。在我们的posts缩减器中，loadPostsfunction看起来像这样:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="0495" class="ln kb hu lj b fv lo lp l lq lr">export const loadPosts = () =&gt; dispatch =&gt; {<br/>  return axios.get(`https://api.cosmicjs.com/v1/${cosmicConfig.bucket.slug}/object-type/posts`)<br/>    .then(res =&gt; res.data.objects ? formatPosts(res.data.objects) : [])<br/>    .then(formattedPosts =&gt; formattedPosts.sort(postSorter))<br/>    .then(sortedPosts =&gt; dispatch(init(sortedPosts)))<br/>    .catch(err =&gt; console.error(`Could not load posts`, err));<br/>};</span></pre><p id="f19e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将所有的文章放入我们的桶中，以一种容易获得我们想要的数据的方式对它们进行格式化，并将它们加载到state中。然后它们会显示在提要中。</p><p id="a4f2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从提要中，用户可以点击一个按钮来发表新的帖子。然后它们被带到新的Postlayout:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="edd5" class="ln kb hu lj b fv lo lp l lq lr">import React, { Component } from 'react';<br/>import { connect } from 'react-redux';<br/>import {<br/>  Container,<br/>  Content,<br/>  Text,<br/>  Button,<br/>} from 'native-base';<br/>import { View } from 'react-native';<br/>import TextField from '../../components/TextField';<br/>import styles from './styles';</span><span id="3fda" class="ln kb hu lj b fv mg lp l lq lr">import { createPost } from '../../redux/reducers/posts';</span><span id="ad2c" class="ln kb hu lj b fv mg lp l lq lr">const mapStateToProps = state =&gt; ({<br/>  user: state.user,<br/>})</span><span id="76bc" class="ln kb hu lj b fv mg lp l lq lr">const mapDispatchToProps = { createPost };</span><span id="a115" class="ln kb hu lj b fv mg lp l lq lr">class NewPost extends Component {<br/>  constructor(){<br/>    super();<br/>    this.state = {<br/>      content: '',<br/>      error: '',<br/>    }<br/>  }<br/>  onSubmit() {<br/>    if (this.state.content){<br/>      this.props.createPost({<br/>        user: this.props.user,<br/>        content: this.state.content,<br/>      })<br/>    } else {<br/>      this.setState({error: 'You have to write something!'});<br/>    }<br/>  }</span><span id="cb08" class="ln kb hu lj b fv mg lp l lq lr">  render(){<br/>    return (<br/>      &lt;Container style={styles.container}&gt;<br/>        &lt;Content&gt;<br/>          &lt;Text style={styles.formMsg}&gt;{this.state.error}&lt;/Text&gt;<br/>          &lt;View style={styles.input}&gt;<br/>            &lt;TextField<br/>              big<br/>              name="What's up?"<br/>              value={this.state.post}<br/>              onChangeText={(text) =&gt; this.setState({content: text})}<br/>            /&gt;<br/>            &lt;Button<br/>              rounded<br/>              style={styles.button}<br/>              onPress={() =&gt; this.onSubmit()}<br/>            &gt;<br/>              &lt;Text&gt;Post&lt;/Text&gt;<br/>            &lt;/Button&gt;<br/>          &lt;/View&gt;<br/>        &lt;/Content&gt;<br/>      &lt;/Container&gt;<br/>    );<br/>  }<br/>}</span><span id="6e77" class="ln kb hu lj b fv mg lp l lq lr">export default connect(mapStateToProps, mapDispatchToProps)(NewPost);</span></pre><p id="c99f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当他们提交帖子时，我们会将其发送到我们的邮箱:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="7b9f" class="ln kb hu lj b fv lo lp l lq lr">export const createPost = post =&gt; dispatch =&gt; {<br/>  return axios.post(`https://api.cosmicjs.com/v1/${cosmicConfig.bucket.slug}/add-object`, {<br/>      title: post.user.username + ' post',<br/>      type_slug: 'posts',<br/>      content: post.content,<br/>      metafields: [<br/>        {<br/>          type: 'object',<br/>          title: 'User',<br/>          key: 'user',<br/>          object_type: 'users',<br/>          value: post.user.id<br/>        },<br/>      ]<br/>    })<br/>      .then(res =&gt; formatPost(res.data, post))<br/>      .then(formattedPost =&gt; dispatch(create(formattedPost)))<br/>      .then(() =&gt; Actions.feed({type: 'popAndReplace'}))<br/>      .catch(error =&gt; console.error('Post unsuccessful', error))<br/>}</span></pre><p id="22ba" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后重定向回提要，提要将获取更新的帖子列表。用户还可以刷新他们的提要来查看新的帖子，并从提要中注销。</p><h1 id="ea9b" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">结论</h1><p id="caf8" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">我们使用React Native制作了一个类似Twitter的应用程序，它利用了Cosmic JS API的强大功能来轻松维护我们的用户和帖子的所有数据。我们能够通过几个简单的操作快速启动并运行，这些操作将我们的数据发送到我们的Cosmic JS Bucket或从其中获取数据。</p><blockquote class="mh mi mj"><p id="4cd7" class="jc jd mk je b jf jg jh ji jj jk jl jm ml jo jp jq mm js jt ju mn jw jx jy jz hn dt translated">这篇文章最初出现在<a class="ae ld" href="https://cosmicjs.com/blog/how-to-make-a-simple-twitter-clone-with-react-native" rel="noopener ugc nofollow" target="_blank">宇宙JS博客</a>上。</p></blockquote><div class="le lf lg lh fq ab cb"><figure class="mo iv mp mq mr ms mt paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mo iv mp mq mr ms mt paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mo iv mp mq mr ms mt paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mh mi mj"><p id="f922" class="jc jd mk je b jf jg jh ji jj jk jl jm ml jo jp jq mm js jt ju mn jw jx jy jz hn dt translated"><a class="ae ld" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ld" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ld" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ld" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd mk je b jf jg jh ji jj jk jl jm ml jo jp jq mm js jt ju mn jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ld" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ld" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="le lf lg lh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mu"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>