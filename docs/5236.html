<html>
<head>
<title>Introducing Exoframe (beta) — self-hosted alternative to Now.sh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍exo frame(beta)—now . sh的自托管替代方案</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/introducing-exoframe-beta-self-hosted-alternative-to-now-sh-80643f96b84b?source=collection_archive---------14-----------------------#2017-07-17">https://medium.com/hackernoon/introducing-exoframe-beta-self-hosted-alternative-to-now-sh-80643f96b84b?source=collection_archive---------14-----------------------#2017-07-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="beff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">早在2016年9月，我已经<a class="ae jp" href="https://hackernoon.com/simplifying-docker-management-with-exoframe-9275e92c7406" rel="noopener ugc nofollow" target="_blank">展示了</a>第一个公开版本的Exoframe。我曾经把它定位为简化Docker管理的工具。这个想法非常简单——消除编写、维护docker映像并将其部署到服务器的痛苦。<br/>这是通过模板和项目检测完成的——exo frame alpha会读取你的项目目录，试图找出要使用的模板，从该模板添加Dockerfile，然后将其部署到你的服务器上，同时问你一堆问题。<br/>从长远来看——它对我(或其他任何人，根据下载统计)都不太管用。每次部署都要回答这么多问题，这很烦人，没有办法轻松地将域分配给演示，而且我编码到deploy step中的大多数Docker特性并没有像我想象的那样频繁使用。因此，在某个时候，我干脆完全停止使用它。</p><p id="0f4c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后我从<a class="ae jp" href="https://zeit.co/about" rel="noopener ugc nofollow" target="_blank"> ZEIT </a>发现了<a class="ae jp" href="http://now.sh/" rel="noopener ugc nofollow" target="_blank"> Now.sh </a>。这是一个非常简单的工具，允许你在一个命令中部署节点、HTML和Docker项目。不问任何问题。<br/>尽管现在很棒，而且每次更新都会变得更好(例如<a class="ae jp" href="https://zeit.co/blog/universal-now" rel="noopener ugc nofollow" target="_blank">最新更新</a>允许你使用GCP、AWS和Azure)，但它仍然有其局限性。对我来说最大的一个问题是，我不能在自己的服务器上使用它。我敢肯定，你们中的一些人也有一些演示服务器，一个或两个已经拥有的VPS，甚至可能有一些专用服务器只是为了好玩。遗憾的是，目前没有办法运行自托管。<br/>另一个问题是复杂的docker项目——虽然现在允许您从简单的docker文件部署项目，但现在有办法使用描述多个服务的<a class="ae jp" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> docker-compose </a>来部署项目(例如，具有后端和前端的数据库)。</p><p id="e237" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这就是为什么我决定重新思考和构建Exoframe来解决所有这些问题。可以把它看作是Now的一个自托管替代方案，它允许您轻松地将项目部署到您的服务器上，同时获得自动化的域配置、负载平衡、HTTPS(多亏了letsencrypt)和所有这些好东西。</p><p id="c61a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你喜欢视频格式，你可以在下面的视频中观看演示和解释它是如何工作的。如果您喜欢文本—滚动:)</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><h1 id="fdbd" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">Exoframe服务器及其工作原理</h1><p id="e8fb" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">Exoframe的工作方式非常简单——你唯一需要安装的就是一个带有<a class="ae jp" href="https://docs.docker.com/engine/installation/" rel="noopener ugc nofollow" target="_blank"> Docker守护进程</a>的服务器。一些服务器提供商甚至具有预配置的服务器(例如来自DigitalOcean 的<a class="ae jp" href="https://www.digitalocean.com/products/one-click-apps/docker/" rel="noopener ugc nofollow" target="_blank">一键式Docker服务器)。</a></p><p id="0654" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Exoframe服务器本身以一种非常简单的方式工作——在执行时，它将产生一个<a class="ae jp" href="https://traefik.io/" rel="noopener ugc nofollow" target="_blank"> Traefik </a>实例，该实例将处理域管理、HTTPS、负载平衡和所有这些事情。然后，它简单地从Exoframe CLI获得打包的项目，并将其部署到您的Docker守护进程，同时为您配置Traefik和Docker。<br/>身份验证是使用私有-公共RSA密钥完成的，所以如果您已经可以使用您的私有密钥SSH到您的服务器，那么通常您不需要任何额外的设置。如果您仍然使用SSH的登录名和密码，请参见本指南<a class="ae jp" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys--2" rel="noopener ugc nofollow" target="_blank">帮助您切换到更安全的密钥认证。</a></p><p id="c459" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你所需要做的就是在你的Docker守护进程中执行Exoframe server，就像这样:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="la jw l"/></div></figure><p id="f9fd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该命令将启动Exoframe服务器，允许它通过<em class="lb"> docker.sock </em>访问您的docker，将config文件夹链接到您的本地文件夹以在重启/更新/等时保存配置，链接您的<em class="lb"> authorized_keys </em>文件以进行身份验证，最后—为<a class="ae jp" href="https://traefik.io/" rel="noopener ugc nofollow" target="_blank"> Traefik </a>设置规则。您可以在<a class="ae jp" href="https://github.com/exoframejs/exoframe-server" rel="noopener ugc nofollow" target="_blank">服务器存储库</a>中找到每一行更详细的解释。</p><h1 id="f266" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">Exoframe客户端和命令</h1><p id="1a2e" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">一旦Exoframe服务器启动，您将需要安装Exoframe CLI。目前，这只能使用npm来完成，所以你需要在你的系统上安装最新的<a class="ae jp" href="https://nodejs.org/en/download/package-manager/" rel="noopener ugc nofollow" target="_blank"> Node.js和NPM</a>。<br/>一旦你有了它们，你可以使用下面的命令安装exoframe:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="69cd" class="lh jy hu ld b fv li lj l lk ll">npm install exoframe -g</span></pre><p id="b0eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">之后，您需要使用以下命令将Exoframe CLI指向新设置的服务器:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="2adb" class="lh jy hu ld b fv li lj l lk ll">exoframe endpoint http://exoframe.server.url</span></pre><p id="0fc8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后使用<code class="eh lm ln lo ld b">exoframe login</code>登录，并选择已经被授权访问您的服务器的私钥。</p><p id="fbe0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">登录后，您将可以访问主要命令:</p><ul class=""><li id="cb86" class="lp lq hu it b iu iv iy iz jc lr jg ls jk lt jo lu lv lw lx dt translated"><code class="eh lm ln lo ld b">exoframe [deploy]</code> —将当前项目部署到您的服务器</li><li id="1278" class="lp lq hu it b iu ly iy lz jc ma jg mb jk mc jo lu lv lw lx dt translated"><code class="eh lm ln lo ld b">exoframe config</code> —为当前项目生成新的配置文件</li><li id="da64" class="lp lq hu it b iu ly iy lz jc ma jg mb jk mc jo lu lv lw lx dt translated"><code class="eh lm ln lo ld b">exoframe list | ls</code> —列出活动部署</li><li id="81d5" class="lp lq hu it b iu ly iy lz jc ma jg mb jk mc jo lu lv lw lx dt translated"><code class="eh lm ln lo ld b">exoframe remove | rm &lt;id&gt;</code> —删除活动部署</li><li id="810a" class="lp lq hu it b iu ly iy lz jc ma jg mb jk mc jo lu lv lw lx dt translated"><code class="eh lm ln lo ld b">exoframe logs | log &lt;id&gt;</code> —显示活动部署的日志</li></ul><p id="d808" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lm ln lo ld b">deploy</code>命令目前理解并能够处理以下项目类型:</p><ol class=""><li id="f583" class="lp lq hu it b iu iv iy iz jc lr jg ls jk lt jo md lv lw lx dt translated">基于静态HTML的项目——将使用<a class="ae jp" href="http://hub.docker.com/_/nginx" rel="noopener ugc nofollow" target="_blank"> nginx </a>映像进行部署</li><li id="dc7b" class="lp lq hu it b iu ly iy lz jc ma jg mb jk mc jo md lv lw lx dt translated">基于Node.js的项目—将使用<a class="ae jp" href="https://hub.docker.com/_/node" rel="noopener ugc nofollow" target="_blank">节点:alpine </a>映像进行部署</li><li id="92d6" class="lp lq hu it b iu ly iy lz jc ma jg mb jk mc jo md lv lw lx dt translated">基于Docker的项目—将使用您的<a class="ae jp" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank">docker文件</a>进行部署</li><li id="d9a8" class="lp lq hu it b iu ly iy lz jc ma jg mb jk mc jo md lv lw lx dt translated">基于Docker-compose的项目——将使用您的<a class="ae jp" href="https://docs.docker.com/compose/compose-file/" rel="noopener ugc nofollow" target="_blank"> docker-compose </a>文件进行部署</li></ol><p id="c2b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用配置文件完成对<code class="eh lm ln lo ld b">deploy</code>命令的配置，该文件包含您的项目名称、您想要分配给它的域、您想要设置的环境、重启策略和内部容器主机名。配置文件的结构在Exoframe自述文件中有所介绍。</p><h2 id="7cc2" class="lh jy hu bd jz me mf mg kd mh mi mj kh jc mk ml kl jg mm mn kp jk mo mp kt mq dt translated">有letsencrypt的HTTPS</h2><p id="a4bc" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">因为Exoframe使用Traefik来管理域，所以您可以通过letsencrypt证书获得对HTTPS的现成支持！<br/>要启用它，您需要编辑您的服务器配置文件并设置以下字段:</p><pre class="jq jr js jt fq lc ld le lf aw lg dt"><span id="61f7" class="lh jy hu ld b fv li lj l lk ll">letsencrypt: true # whether to enable letsencrypt, default "false"<br/>letsencryptEmail: your@email.com # email used for letsencrypt</span></pre><p id="a41e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦设置完成，只需启动您的Exoframe服务器。<br/> <strong class="it hv">警告:</strong>如果您已经运行了Exoframe服务器和Traefik，您还需要从Docker守护进程中删除旧的Traefik实例并重启Exoframe服务器。这是必需的，因为Traefik需要用附加的letsencrypt参数重新创建。完成后，你所有的项目都将自动部署到HTTPS，并带有letsencrypt证书！</p><h2 id="f812" class="lh jy hu bd jz me mf mg kd mh mi mj kh jc mk ml kl jg mm mn kp jk mo mp kt mq dt translated">子域自动生成</h2><p id="a8ad" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">Exoframe server还允许您启用自动子域名称生成(类似于Now.sh的方式，但使用您的域)。这可以通过将服务器中的<code class="eh lm ln lo ld b">baseDomain</code>字段设置为您想要使用的顶级域名来实现。例如，将它设置为<code class="eh lm ln lo ld b">.codezen.net</code>将导致部署的服务没有明确指定的域名，而获得像<code class="eh lm ln lo ld b">exo-user-demo-d234ah3.codezen.net</code> <br/>这样的域名。当您想要快速部署和测试您的项目而不使用它们的真实域名时，这很有用。</p><h1 id="5c05" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">当前的限制</h1><p id="2a80" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">Exoframe显然有自己的局限性:</p><ul class=""><li id="3d84" class="lp lq hu it b iu iv iy iz jc lr jg ls jk lt jo lu lv lw lx dt translated">最大的一个问题是对docker-compose项目配置的有限支持。虽然Exoframe可以很容易地操作它直接部署的容器，但是改变docker-compose服务的配置是非常有限的。因此，您必须手动设置域的Traefik标签。不幸的是，除了提供更好的文档，没有真正的方法来“修复”这个问题。</li><li id="45ee" class="lp lq hu it b iu ly iy lz jc ma jg mb jk mc jo lu lv lw lx dt translated">另一个限制是，目前您只能使用私有-公共密钥对登录。虽然这对人们来说工作得很好，但是从CI/CD守护进程中使用它并不太好。我计划在未来通过添加部署令牌来解决这个问题，这将允许重新部署一个特定的项目，而不需要使用私钥进行身份验证。</li><li id="14c8" class="lp lq hu it b iu ly iy lz jc ma jg mb jk mc jo lu lv lw lx dt translated">一个更明显的限制是只支持4种项目类型。虽然Dockerfile和Docker-compose项目确实允许用户部署几乎任何东西，但拥有更多自动配置的项目可能会更好。如果有足够的兴趣的话，我计划将来通过在项目部署中引入插件系统来解决这个问题。</li></ul><h1 id="b8b3" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">结论</h1><p id="a22c" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">如果你觉得Exoframe有趣——试试吧！<br/>beta版<a class="ae jp" href="https://github.com/exoframejs/exoframe" rel="noopener ugc nofollow" target="_blank">现已在GitHub </a>上发布。<br/>一如既往——感谢您的任何反馈和贡献。</p></div></div>    
</body>
</html>