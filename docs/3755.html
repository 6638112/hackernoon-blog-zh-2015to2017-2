<html>
<head>
<title>Using Go dep as a project maintainer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Go dep作为项目维护者</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/using-go-dep-as-a-project-maintainer-641d1f3006d7?source=collection_archive---------1-----------------------#2017-04-21">https://medium.com/hackernoon/using-go-dep-as-a-project-maintainer-641d1f3006d7?source=collection_archive---------1-----------------------#2017-04-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/563c7332656c8377e4692c9212a40c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qs4PALlqb7cTbwxNIFxADQ.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">A Go dependency graph, generated using <a class="ae ih" href="https://github.com/davecheney/graphpkg" rel="noopener ugc nofollow" target="_blank">https://github.com/davecheney/graphpkg</a>.</figcaption></figure><div class=""/><p id="d737" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在Go中管理依赖关系可能不是你首先要注意的事情，但是总有一天你可能不得不面对这个任务。在这篇文章中，我将从项目维护者的角度分享我使用Go <code class="eh kf kg kh ki b">dep</code>的第一步的一些观察。</p></div><div class="ab cl kj kk hc kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hn ho hp hq hr"><p id="c110" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Go dependency management，或者像我们地鼠所说的<em class="kq"> vendoring </em>，有着相当漫长和稍微复杂的<a class="ae ih" href="https://blog.gopheracademy.com/advent-2016/saga-go-dependency-management/" rel="noopener ugc nofollow" target="_blank">历史</a>。随着Go <a class="ae ih" href="https://github.com/golang/dep" rel="noopener ugc nofollow" target="_blank"> dep </a>社区现在似乎慢慢(？)但肯定会集中在一个标准上。因为在我参与的一个项目中，我无论如何都需要它，所以我认为在“真正”应用它之前，在沙盒环境中获得一些实践知识是有意义的。</p><p id="bf6b" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">好了，让我们直接进入主题:首先，我们必须安装Go <code class="eh kf kg kh ki b">dep,</code>，这里假设安装了Go的最新版本(我用的是1.8):</p><pre class="kr ks kt ku fq kv ki kw kx aw ky dt"><span id="fdf5" class="kz la ik ki b fv lb lc l ld le">$ go get -u github.com/golang/dep/cmd/dep</span></pre><p id="ee07" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，我们需要一个我们想要提供的<a class="ae ih" href="https://hackernoon.com/tagged/program" rel="noopener ugc nofollow" target="_blank">程序</a>，所以这里有一个简单的<a class="ae ih" href="https://gist.github.com/mhausenblas/30e8dc5f7682888c10906cb0f8c471cb" rel="noopener ugc nofollow" target="_blank">例子</a>使用<a class="ae ih" href="https://github.com/kubernetes/client-go/" rel="noopener ugc nofollow" target="_blank"> Kubernetes Go客户端</a>创建一个集群外壳的原始版本(边注我使用<a class="ae ih" href="https://github.com/minishift/minishift" rel="noopener ugc nofollow" target="_blank"> Minishift </a>来设置和运行<a class="ae ih" href="https://hackernoon.com/tagged/kubernetes" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>):</p><figure class="kr ks kt ku fq hw"><div class="bz el l di"><div class="lf lg l"/></div></figure><p id="a58c" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">目标是出售第7到10行中导入的包。所以，为了做到这一点，我在<code class="eh kf kg kh ki b">main.go</code>文件所在的目录中执行了这些命令:</p><pre class="kr ks kt ku fq kv ki kw kx aw ky dt"><span id="44ef" class="kz la ik ki b fv lb lc l ld le">$ dep init<br/>$ dep ensure k8s.io/client-go@^2.0.0<br/>$ dep ensure github.com/chzyer/readline@1.4</span></pre><p id="87b7" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">注意，最后两行并不是严格要求的，因为<code class="eh kf kg kh ki b">dep</code>足够聪明，可以自己计算出需要的版本。在我的例子中，我需要将<code class="eh kf kg kh ki b">client-go</code>包固定在<code class="eh kf kg kh ki b">2.0.0</code>版本上，以确保它能与我正在使用的Kubernetes版本兼容。</p><p id="4635" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">完成该步骤后，目录布局如下所示:</p><pre class="kr ks kt ku fq kv ki kw kx aw ky dt"><span id="71be" class="kz la ik ki b fv lb lc l ld le">.<br/>├── Gopkg.lock<br/>├── Gopkg.toml<br/>├── main.go<br/>└── vendor<br/>    ├── cloud.google.com<br/>    ├── github.com<br/>    ├── golang.org<br/>    ├── google.golang.org<br/>    ├── gopkg.in<br/>    └── k8s.io</span></pre><p id="888f" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我处于<code class="eh kf kg kh ki b">go build</code>或<code class="eh kf kg kh ki b">go install</code>程序并执行它的位置。这里有一个重要的注意事项和潜在的陷阱:除非你在你的源代码中实际导入了一个特定的包，否则一个<code class="eh kf kg kh ki b">dep ensure</code>不会将这个版本下载到<code class="eh kf kg kh ki b">vendor/</code>子目录中。</p></div><div class="ab cl kj kk hc kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hn ho hp hq hr"><p id="902a" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">回到最初的问题:作为一个项目维护者，我现在需要做些什么来使这个vendored设置在repo中可供其他人使用？由于我找不到围绕这个话题的最佳实践，我在<a class="ae ih" href="https://invite.slack.golangbridge.org/" rel="noopener ugc nofollow" target="_blank"> Go Slack </a>社区的<code class="eh kf kg kh ki b">#vendor</code>频道上跳了起来，友好的人们(特别感谢<a class="ae ih" href="https://twitter.com/peterbourgon" rel="noopener ugc nofollow" target="_blank">彼得·波尔根</a>)提供了指导:</p><ol class=""><li id="b5bb" class="lh li ik jj b jk jl jo jp js lj jw lk ka ll ke lm ln lo lp dt translated">在您的回购中，您至少应该包括<code class="eh kf kg kh ki b">Gopkg.toml</code>和<code class="eh kf kg kh ki b">Gopkg.lock</code>。</li><li id="fff0" class="lh li ik jj b jk lq jo lr js ls jw lt ka lu ke lm ln lo lp dt translated">您可以包含<code class="eh kf kg kh ki b">vendor/</code>子目录，并且…</li><li id="9ec6" class="lh li ik jj b jk lq jo lr js ls jw lt ka lu ke lm ln lo lp dt translated">…如果包含<code class="eh kf kg kh ki b">vendor/</code>子目录:</li></ol><ul class=""><li id="cc02" class="lh li ik jj b jk jl jo jp js lj jw lk ka ll ke lv ln lo lp dt translated">你的回购变大:(</li><li id="22a1" class="lh li ik jj b jk lq jo lr js ls jw lt ka lu ke lv ln lo lp dt translated">拉取请求的差异可能会变得更加复杂:(</li><li id="03f6" class="lh li ik jj b jk lq jo lr js ls jw lt ka lu ke lv ln lo lp dt translated">保证可重现的构建，因为它将您从上游的变更中分离出来:)</li><li id="3b3e" class="lh li ik jj b jk lq jo lr js ls jw lt ka lu ke lv ln lo lp dt translated">它不需要你的回购用户执行额外的<code class="eh kf kg kh ki b">dep ensure</code>来构建程序:)</li></ul></div><div class="ab cl kj kk hc kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hn ho hp hq hr"><p id="b4e1" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">总结:虽然Go <code class="eh kf kg kh ki b">dep</code>仍处于早期阶段，缺乏一些关于最佳实践的文档(显然一个<a class="ae ih" href="https://github.com/carolynvs/dep/blob/c20dddcdc17872f956391b1eda6cac9364cea4dc/FAQ.md" rel="noopener ugc nofollow" target="_blank"> FAQ </a>即将推出)，但我发现它很容易使用，并且感觉我现在已经准备好使用它了。</p></div><div class="ab cl kj kk hc kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hn ho hp hq hr"><p id="2f7f" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">编辑:正如<a class="lw lx gr" href="https://medium.com/u/2cac56571879?source=post_page-----641d1f3006d7--------------------------------" rel="noopener" target="_blank"> Ahmet Alp Balkan </a>所指出的，您可以通过godoc.org为包生成可视化的依赖图，例如<a class="ae ih" href="https://godoc.org/github.com/mhausenblas/cinf?import-graph&amp;hide=1" rel="noopener ugc nofollow" target="_blank">https://godoc.org/github.com/mhausenblas/cinf?import-graph&amp;hide = 1</a></p><div class="kr ks kt ku fq ab cb"><figure class="ly hw lz ma mb mc md paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ly hw lz ma mb mc md paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ly hw lz ma mb mc md paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="me mf mg"><p id="f922" class="jh ji kq jj b jk jl jm jn jo jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd ke hn dt translated"><a class="ae ih" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ih" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ih" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae ih" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jh ji kq jj b jk jl jm jn jo jp jq jr mh jt ju jv mi jx jy jz mj kb kc kd ke hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ih" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ih" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kr ks kt ku fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mk"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="kr ks kt ku fq hw"><div class="bz el l di"><div class="ml lg l"/></div></figure></div></div>    
</body>
</html>