<html>
<head>
<title>ngrx/store reuse reducer logic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ngrx/存储重用缩减器逻辑</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/ngrx-store-reuse-reducer-logic-b6c0449e695d?source=collection_archive---------1-----------------------#2017-04-23">https://medium.com/hackernoon/ngrx-store-reuse-reducer-logic-b6c0449e695d?source=collection_archive---------1-----------------------#2017-04-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/ea1ea8090e7dc7a01fc622bea0f1651f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*ri6Qm_3PckXO68wldUAhgg.png"/></div></figure><p id="5f8c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">当您的应用程序增长时，您可能会发现您的存储的几个部分为不同类型的<a class="ae jw" href="https://hackernoon.com/tagged/data" rel="noopener ugc nofollow" target="_blank">数据</a>做着相同的工作，理想情况下，我们希望通过为每种数据类型重用相同的公共<a class="ae jw" href="https://hackernoon.com/tagged/logic" rel="noopener ugc nofollow" target="_blank">逻辑</a>来减少重复。还可能发生这样的情况，您希望拥有同一类型数据的多个“实例”。</p><p id="4f00" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">假设我们正在创建一个有两个页面的应用程序，每个页面显示一个用户列表。每个列表显示一组不同的用户，例如:管理员或编辑。每个列表都可以排序，我们可以选择一个用户。页面的缩减器可能看起来像这样:</p><p id="accd" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">首先是管理员减压器。</p><figure class="jx jy jz ka fq iv"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="b08d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">然后编辑缩减器:</p><figure class="jx jy jz ka fq iv"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="2ae4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">之后，我们可以使用<code class="eh kd ke kf kg b">combineReducers</code>来设置我们的状态</p><figure class="jx jy jz ka fq iv"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="b8b2" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">对于每个减速器，我们都做了一些事情:</p><ol class=""><li id="2b4c" class="kh ki hu ja b jb jc jf jg jj kj jn kk jr kl jv km kn ko kp dt translated">因为我们使用typescript，所以我们首先为我们的状态设置一个接口。</li><li id="59b4" class="kh ki hu ja b jb kq jf kr jj ks jn kt jr ku jv km kn ko kp dt translated">然后我们定义我们的初始状态</li><li id="dd5f" class="kh ki hu ja b jb kq jf kr jj ks jn kt jr ku jv km kn ko kp dt translated">之后，我们用它的动作类型来定义我们的缩减器</li></ol><p id="0e03" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">虽然每个单独的缩减器都没有问题，但这段代码并不枯燥。因为每个缩减器的结构完全相同，所以我们可以抽象代码，创建一个管理员和编辑状态都可以使用的缩减器。</p><h2 id="abc8" class="kv kw hu bd kx ky kz la lb lc ld le lf jj lg lh li jn lj lk ll jr lm ln lo lp dt translated">抽象您的reducer代码</h2><p id="eabf" class="pw-post-body-paragraph iy iz hu ja b jb lq jd je jf lr jh ji jj ls jl jm jn lt jp jq jr lu jt ju jv hn dt translated">我们可以通过在状态的键中使用<code class="eh kd ke kf kg b">user</code>，而不是<code class="eh kd ke kf kg b">editor</code>或<code class="eh kd ke kf kg b">administrator</code>，使我们的reducer更加抽象。我们的减速器可能看起来像这样:</p><figure class="jx jy jz ka fq iv"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="689e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">然后可以像这样设置我们的状态</p><figure class="jx jy jz ka fq iv"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="4ebc" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">然而，这种设置有一个问题。因为<code class="eh kd ke kf kg b">combineReducers</code>会调用每个具有相同动作的减速器。如果我们分派一个动作<code class="eh kd ke kf kg b">{"type": "sort"}</code>，它实际上会对管理员和编辑状态进行排序，而不仅仅是你想要排序的状态。为了实现期望的行为，我们需要某种方法来包装reducer逻辑，这样我们就可以确保只有我们关心的reducer被更新。这可以通过使用高阶减速器函数来实现。</p><h2 id="ae31" class="kv kw hu bd kx ky kz la lb lc ld le lf jj lg lh li jn lj lk ll jr lm ln lo lp dt translated">使用高阶减速器</h2><p id="c048" class="pw-post-body-paragraph iy iz hu ja b jb lq jd je jf lr jh ji jj ls jl jm jn lt jp jq jr lu jt ju jv hn dt translated">高阶reducer是一个函数，它将一个名称作为参数，并返回一个新的reducer函数作为结果。我们可以使用这个模式来创建一个reducer的新实例。这个高阶减速器可能看起来像这样:</p><figure class="jx jy jz ka fq iv"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="a7f9" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们现在可以在我们的<code class="eh kd ke kf kg b">combineReducers</code>函数中使用这个函数来生成reducer的多个实例:</p><figure class="jx jy jz ka fq iv"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="d639" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在给你的动作名称加上后缀，这样它们就和你的减速器中的新名称相对应了。</p><h1 id="aed6" class="lv kw hu bd kx lw lx ly lb lz ma mb lf mc md me li mf mg mh ll mi mj mk lo ml dt translated">结论</h1><p id="fd3e" class="pw-post-body-paragraph iy iz hu ja b jb lq jd je jf lr jh ji jj ls jl jm jn lt jp jq jr lu jt ju jv hn dt translated">使用高阶缩减器模式，我们能够调度只影响我们所关心的那部分状态的动作，并且我们能够以DRY方式创建我们的数据的多个实例。我们防止了减少器逻辑的重复，这导致了更易维护的代码库。</p></div><div class="ab cl mm mn hc mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hn ho hp hq hr"><p id="cd03" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">谢谢你的阅读。在我的下一篇文章中，我将写关于重用效果逻辑。这是我的第一篇帖子，有什么反馈吗？让我知道。</p><p id="23eb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><em class="mt">跟我上</em> <a class="ae jw" rel="noopener" href="/@luukgruijs">中<em class="mt"/></a>中<em class="mt">让我们连线上</em> <a class="ae jw" href="https://www.linkedin.com/in/luukgruijs/" rel="noopener ugc nofollow" target="_blank"> <em class="mt">领英</em> </a></p><div class="jx jy jz ka fq ab cb"><figure class="mu iv mv mw mx my mz paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mu iv mv mw mx my mz paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mu iv mv mw mx my mz paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="na nb nc"><p id="f922" class="iy iz mt ja b jb jc jd je jf jg jh ji nd jk jl jm ne jo jp jq nf js jt ju jv hn dt translated"><a class="ae jw" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客午间</a>是黑客们下午的开始。我们是<a class="ae jw" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家族的一员。我们现在<a class="ae jw" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受提交</a>并很高兴<a class="ae jw" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>的机会。</p><p id="708a" class="iy iz mt ja b jb jc jd je jf jg jh ji nd jk jl jm ne jo jp jq nf js jt ju jv hn dt translated">如果您喜欢这个故事，我们建议您阅读我们的<a class="ae jw" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jw" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实视为理所当然！</p></blockquote><figure class="jx jy jz ka fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="fe ff ng"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="jx jy jz ka fq iv"><div class="bz el l di"><div class="nl kc l"/></div></figure></div></div>    
</body>
</html>