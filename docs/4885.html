<html>
<head>
<title>Calculating Costs in Ethereum Contracts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊合同中的成本计算</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/ether-purchase-power-df40a38c5a2f?source=collection_archive---------0-----------------------#2017-06-28">https://medium.com/hackernoon/ether-purchase-power-df40a38c5a2f?source=collection_archive---------0-----------------------#2017-06-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="fb6b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> <em class="jp">气价PSA</em></strong><em class="jp">(2017–08–23):撰写本文时的气价中值为28 Gwei，目前仍在20 Gwei的范围内。这远远大于在</em><a class="ae jq" href="http://ethgasstation.info/" rel="noopener ugc nofollow" target="_blank"><em class="jp">eth asstation</em></a><em class="jp">上发现的典型平均值和安全低(分别为4和0.5 Gwei)。中位数如此之高，是因为许多钱包里都有糟糕的汽油价格违约。我</em> <strong class="it hv"> <em class="jp">强烈建议</em> </strong> <em class="jp">使用加油站的平均气价或更低的气价，以避免支付高额费用，并帮助降低气价的市场价格。</em></p><p id="c3a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> <em class="jp">更新</em></strong><em class="jp">(2017–09–6):我把操作码的Google电子表格移植到一个</em><a class="ae jq" href="https://github.com/djrtwo/evm-opcode-gas-costs" rel="noopener ugc nofollow" target="_blank"><em class="jp">github repo</em></a><em class="jp">。该回购将随着</em> <a class="ae jq" href="http://yellowpaper.io/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">黄皮书</em> </a> <em class="jp">的演进而维护和更新。</em></p><p id="b420" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当用户持有以太时，他们在存储什么？从某种意义上说，他们正在以太坊<a class="ae jq" href="https://hackernoon.com/tagged/network" rel="noopener ugc nofollow" target="_blank">网络</a>上存储执行计算的能力。这种计算是以分散的方式完成的:</p><blockquote class="jr js jt"><p id="2a0b" class="ir is jp it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">挖掘器执行与包含在块中的每个事务相关联的计算，从而产生更新的状态。一旦成功地挖掘了一个块，挖掘器就向网络广播该块。其他挖掘器和非挖掘节点中的每一个在接受该块为有效、将该块合并到它们的<a class="ae jq" href="https://hackernoon.com/tagged/blockchain" rel="noopener ugc nofollow" target="_blank">区块链</a>的副本中、并继续移动到下一个块之前，验证事务计算的有效性和由此产生的状态变化。</p></blockquote><p id="a771" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可能已经注意到网络上的每一点计算都有令人难以置信的冗余量。也就是说，每个节点验证每个事务的结果—阅读:<em class="jp">每个节点运行所有的计算</em>。</p><p id="3df1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经研究以太坊和其他区块链应用平台很长时间了，很少有人直截了当地这么说。一旦你进入事物的更技术性的一面，它就成为系统的一个明显的特征，但是对于不太熟悉的人来说，这就不那么明显了。这难道不比仅仅在服务器上运行计算要昂贵得多吗？是的，根据协议的性质，必须如此。以下可能是经济学或计算或两者的基本原理:</p><blockquote class="jr js jt"><p id="8c9f" class="ir is jp it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">运行代码的机器越多=花在运行代码上的钱越多</p></blockquote><p id="9693" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们必须记住，在以太坊上执行代码和更新状态与在简单的服务器上做同样的事情有很大的不同。以太坊中产生的状态变化具有与服务器不同的属性——即:不变性和公共可验证性。让我们先来看看网络上的实际计算成本，然后我们可以尝试决定它是否值得。</p><h1 id="de94" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">这要花多少钱？</h1><h2 id="d97e" class="kv jy hu bd jz kw kx ky kd kz la lb kh jc lc ld kl jg le lf kp jk lg lh kt li dt translated">气体</h2><p id="7a0d" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">EVM(以太坊虚拟机)中可用的每个低级操作称为一个操作码。这些操作包括ADD(将两个整数相加)、BALANCE(获取帐户余额)和CREATE(使用提供的代码创建新的契约)。这些操作码中的每一个都有一个与之相关的名为“气体”的数字。<em class="jp"> Gas </em>是一个抽象数字，表示操作的相对复杂程度。比如ADD用3 gas而MUL(两个整数相乘)用5 gas，所以MUL比ADD复杂。</p><p id="4462" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我在这里编译了EVM<a class="ae jq" href="https://docs.google.com/spreadsheets/d/1n6mRqkBz3iWcOlRem_mO09GtSKEKrAsfO7Frgx18pNU/edit?usp=sharing" rel="noopener ugc nofollow" target="_blank">中每个操作码所需的gas。这些信息摘自最新版本的</a><a class="ae jq" href="https://ethereum.github.io/yellowpaper/paper.pdf" rel="noopener ugc nofollow" target="_blank">以太坊黄皮书</a> (EIP-150修订版)——以太坊协议的正式规范。</p><p id="17eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">需要注意的是，所有交易都以21000气为基数。所以如果你只是转账，没有和合约互动，你的交易需要21000气。如果您正在与一个合同进行交互，您的事务需要21000 gas加上与运行该合同相关的任何gas。</p><h2 id="ee0a" class="kv jy hu bd jz kw kx ky kd kz la lb kh jc lc ld kl jg le lf kp jk lg lh kt li dt translated">天然气价格</h2><p id="1a80" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">虽然每次操作的天然气价格是固定的，但用户支付的每份天然气价格是动态的，由市场条件决定。气价是代表用户愿意为每种气体支付多少乙醚的值。当用户发送交易时，他们以Gwei/Gas (1 Gwei等于0.000000001 ETH)指定气价，他们支付的总费用等于<em class="jp"> gas_price * gas_used。矿工得到这笔费用，因此他们优先考虑天然气价格较高的交易。您愿意支付的汽油价格越高，您的交易处理速度就越快。</em></p><p id="b3fd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jq" href="http://ethgasstation.info/index.php" rel="noopener ugc nofollow" target="_blank"> ETH加油站</a>是了解当前天然气市场状况的绝佳资源。“推荐用户天然气价格”显示您可能支付的天然气价格范围和预期交易时间。</p><h1 id="0074" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">不，真的，要多少钱？</h1><p id="ddbd" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">以太坊中的运营成本是gas_price * gas_used，但是这在以太和美元中转化为什么呢？我已经编制了一份<a class="ae jq" href="https://docs.google.com/spreadsheets/d/1KeWKkn0BYhOt1p6lM6BDQAWLin-2JQmGpwswU3kPw9c/edit?usp=sharing" rel="noopener ugc nofollow" target="_blank">电子表格</a>，其中列出了当前天然气中值价格(28 Gwei)和当前美元/ETH汇率(295美元/ETH)下的一些示例操作和相关成本。每行显示一项任务，任务所需的汽油，以ETH和USD表示的成本，用1 ETH和1 USD可以执行的任务数量，每块可以执行的任务数量，以及执行这项任务需要的块数。</p><h2 id="e518" class="kv jy hu bd jz kw kx ky kd kz la lb kh jc lc ld kl jg le lf kp jk lg lh kt li dt translated">添加数字</h2><p id="b00c" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">以下是电子表格中的一个示例。这显示了两个整数相加或相减的相关成本。</p><figure class="lp lq lr ls fq lt fe ff paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="fe ff lo"><img src="../Images/8a96e3d57b08466d1d0cdf0aad6db033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3WWzT8MQIUCB9n-wuj8Cw.jpeg"/></div></div><figcaption class="ma mb fg fe ff mc md bd b be z ek">Cost of Adding Integers</figcaption></figure><p id="24a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以看到，将两个数字相加100万次需要花费0.09 ETH或26.55美元。与在本地计算机或云服务器上运行相比，这似乎相当高。让我们对AWS做一个快速的价格比较。</p><p id="d11e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我可以<a class="ae jq" href="https://gist.github.com/djrtwo/434a3b0e9eaf785cdd7dec70ec561ff3" rel="noopener ugc nofollow" target="_blank">用python </a>在0.04秒内把两个数字加在一起一百万次。亚马逊对其最便宜的EC2实例t2.nano收取0.0059美元/小时的费用。这需要0.000001639美元/秒或0.000000066美元的运营费用。与26.55美元相比，这大约贵了4亿倍(或者4千万美元，如果你愿意支付较低的天然气价格)。哇哦。</p><h2 id="cc7d" class="kv jy hu bd jz kw kx ky kd kz la lb kh jc lc ld kl jg le lf kp jk lg lh kt li dt translated">存储数据</h2><p id="56f7" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">我们可能感兴趣的另一个常见操作是存储数据，无论是存储单个值(如合同到期前的天数)还是更大的值(如短篇小说的内容)。</p><figure class="lp lq lr ls fq lt fe ff paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="fe ff me"><img src="../Images/bb475f437bd4eacdd28f375cc481f110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CpjOxAH0eZ1AlaqIEFOlqw.jpeg"/></div></div><figcaption class="ma mb fg fe ff mc md bd b be z ek">Cost of Storing Data</figcaption></figure><p id="c4a4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从上面的片段中我们可以看到，将数据存储到区块链是极其昂贵的，但这是有道理的！当您在区块链中存储数据时，您将数据存储到一个不可变的数据库中，该数据库跨越成千上万个节点进行复制。像把你最喜欢的电影上传到区块链这样的操作是而且应该是完全成本高昂的，以保持区块链的增长可控。存储一个256位的字需要20000单位的气体，比两个数相加要贵6000多倍，这一事实证明了这种直觉。</p><p id="4041" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">存储大量数据的另一个瓶颈是大约4700000气体/区块的当前区块气体限制。按照每个数据块的气体上限，将1 MB数据写入区块链需要132个以上的数据块，这是假设您可以管理每个数据块的所有气体，并且不需要其他操作！</p><h1 id="89fb" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">这是什么意思？</h1><p id="98bf" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">平心而论，把两个数字加在一起100万次有点做作。一个写得好的契约可能会将这种计算复杂性移出链外，更多地处理契约中的更新状态。将大量数据存储到区块链也不是一项普通的任务。根据任务的不同，用户可能会将数据的加密引用(哈希)存储在链上，而将其余数据存储在链外。</p><p id="ff3a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">也就是说，作为开发人员，我们需要了解这些成本，并相应地设计dApps。我们需要找到链上和链下复杂性之间的平衡，同时仍然利用区块链的分散能力。</p><p id="40e2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还需要明白，归根结底，我们是在拿苹果和橘子做比较。随着区块链成本的增加和效率的降低，我们获得了开放的、抗审查的代码执行和公开的、不可改变的数据的保证。我们以前从未在计算中有过这样的属性，我们也没有完全理解我们可能看到的财务和社会收益。</p><p id="9e02" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在接下来的一年里，我期待更多的采用，并希望在以太坊区块链推出一些期待已久的产品。只有当我们在区块链开展重大活动时，我们才能真正评估成本和收益。</p><div class="lp lq lr ls fq ab cb"><figure class="mf lt mg mh mi mj mk paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mf lt mg mh mi mj mk paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mf lt mg mh mi mj mk paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="jr js jt"><p id="f922" class="ir is jp it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated"><a class="ae jq" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jq" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jq" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jq" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is jp it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jq" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jq" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lp lq lr ls fq lt fe ff paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="fe ff ml"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="lp lq lr ls fq lt"><div class="bz el l di"><div class="mm mn l"/></div></figure></div></div>    
</body>
</html>