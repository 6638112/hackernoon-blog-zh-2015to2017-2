<html>
<head>
<title>Leveraging Google Cloud for building a serverless image tagging service — part 1 — Google Cloud Vision API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用Google Cloud构建无服务器的图像标签服务——第1部分——Google Cloud Vision API</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/leveraging-google-cloud-for-building-a-serverless-image-tagging-service-part-1-7ec8171ac075?source=collection_archive---------8-----------------------#2017-07-16">https://medium.com/hackernoon/leveraging-google-cloud-for-building-a-serverless-image-tagging-service-part-1-7ec8171ac075?source=collection_archive---------8-----------------------#2017-07-16</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="2528" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">场景是这样的。你在一家初创公司工作，该公司开发了一个平台，允许摄影师(专业和业余)上传并与其他摄影爱好者分享他们可爱的照片。</p><p id="fe51" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该平台现已上线2年多，非常成功。用户已经上传了超过500万张图片。</p><p id="a03e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你的产品负责人来找你要求一个杀手级的功能，允许用户搜索照片，甚至是那些还没有被标记或者没有收到任何描述的照片。</p><p id="2ad8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要求你想出一个既便宜又快捷的解决问题的办法。现在怎么办？</p><p id="c57a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">谷歌云拯救世界！</strong></p><p id="92e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这一系列文章中，我们将看到如何构建一个利用Android、Firebase和Google Cloud Vision API的解决方案，通过<strong class="it hv">无服务器结构</strong>简化云中的图像标记。</p><p id="c32d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在第一部分中，我们将重点关注配置一个启用了Google Cloud Vision API的Google Cloud项目。在接下来的部分中，我们将看到如何配置Firebase服务，以及如何创建一个基本的Android应用程序来上传照片。</p><p id="4f9d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们开始吧！</p><h1 id="21ef" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">谷歌云视觉API</h1><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div class="fe ff kn"><img src="../Images/dba7031efd15fcfc6387ba8f9cc7c43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*GBlnk0G0lcbPTZ3vCgVaDQ.png"/></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Google Cloud Vision API showcase</figcaption></figure><p id="e940" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">谷歌对这项服务的描述如下:</p><blockquote class="kz la lb"><p id="a9bb" class="ir is lc it b iu iv iw ix iy iz ja jb ld jd je jf le jh ji jj lf jl jm jn jo hn dt translated">谷歌云视觉API通过将<strong class="it hv">强大的机器学习模型</strong>封装在一个易于使用的REST API中，使开发者能够<strong class="it hv">理解图像的内容</strong>。它快速地将图像<strong class="it hv">分类成数千种类别(例如，“帆船”、“狮子”、“埃菲尔铁塔”)，<strong class="it hv">检测图像</strong>中的单个物体和人脸，并找到和读取图像中包含的印刷文字。您可以在您的图像目录上构建元数据，缓和攻击性内容，或者通过图像情感分析实现新的营销场景。<strong class="it hv">分析请求中上传的图像</strong>或在Google云存储上整合您的图像存储。</strong></p></blockquote><p id="bb97" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于我们的用例，我们将关注<strong class="it hv">图像分类</strong>。我们将使用它来标记我们的图像，以便我们的平台用户可以搜索它们。</p><p id="b2dd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了使用API，我们需要做的第一件事是创建一个Google Cloud项目。为此，请按照下列步骤操作:</p><ul class=""><li id="0480" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">访问<a class="ae lp" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>并使用你的谷歌账户登录；</li><li id="8c02" class="lg lh hu it b iu lq iy lr jc ls jg lt jk lu jo ll lm ln lo dt translated">单击控制台徽标右侧的菜单:</li></ul><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/3ac0b15fd1e5d0ca887bcd53a5ac4b70.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*vXO-DjBEzvGtIRPKma-ESg.png"/></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Project selection menu</figcaption></figure><ul class=""><li id="c5b6" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">在打开的对话框中，点击<strong class="it hv"> + </strong>按钮创建新项目:</li></ul><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff lw"><img src="../Images/e300ed64f99fc0cbfbac91a4fb1d3760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RrMya2HOa_9WqblevabI8g.png"/></div></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Project selection dialog</figcaption></figure><ul class=""><li id="3dc0" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">为您的新项目命名，然后等待它的创建。</li><li id="726a" class="lg lh hu it b iu lq iy lr jc ls jg lt jk lu jo ll lm ln lo dt translated">项目创建完成后，再次点击控制台图标右侧的菜单，选择新建的项目作为活动项目；</li></ul><p id="5f03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">酷！您刚刚创建了Google Cloud项目，该项目将用于管理本系列中使用的API。</p><p id="8ebe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">是时候为项目启用<strong class="it hv"> Google Cloud Vision API </strong>了。为此，请按照以下步骤操作:</p><ul class=""><li id="41bf" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">打开左上方菜单，选择<strong class="it hv"> API管理器</strong> &gt; <strong class="it hv">库</strong>:</li></ul><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/b44953224380cfddac92a55219c58043.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*w2Mmq5Tjb6cHl70uv9-hoA.png"/></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Opening API Manager Library</figcaption></figure><ul class=""><li id="1a22" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">接下来，搜索并选择Google Cloud Vision API:</li></ul><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/4892f58cb52541fc4337d85966e6c78c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*m5NieK2FI3uHevyxp9A5vw.png"/></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Searching for the Google Cloud Vision API</figcaption></figure><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff md"><img src="../Images/8118614b9ad9c0d79a0d4546d2c67673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XM82QHP4PdzjnwoQnUyMuA.png"/></div></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Google Cloud Vision API page (for this tutorial, we are going to use Server-to-server interaction)</figcaption></figure><ul class=""><li id="d8fe" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">点击<strong class="it hv"> ENABLE </strong>后，页面变为显示API的仪表板:</li></ul><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff me"><img src="../Images/57151cedb0cfcc6f017e5196881efd13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k6GESEsYXaco5vaxGY2cfg.png"/></div></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Google Cloud Vision API dashboard</figcaption></figure><p id="424e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用API的下一步也是最后一步是创建一个API密钥，用于认证我们对服务的调用。让我们完成它:</p><ul class=""><li id="76a9" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">再次点击左上方菜单，选择<strong class="it hv"> API管理器</strong> &gt; <strong class="it hv">凭证</strong>:</li></ul><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div class="fe ff mf"><img src="../Images/b535bcdcaec17fbdf1cb529ae2ea9854.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*RgXuR94Ggi_mCNLzMSaFHg.png"/></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Opening API Manager Credentials</figcaption></figure><ul class=""><li id="307e" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">点击<strong class="it hv">创建凭证</strong>，然后选择<strong class="it hv"> API key </strong>:</li></ul><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div class="fe ff mg"><img src="../Images/2eb35c94588b83ce25639c08a86afdad.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*nQoi5nC7A-j1Ol8DU97_4A.png"/></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Creating our API Key</figcaption></figure><ul class=""><li id="4f01" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">一个新的对话框显示您的密钥。您以后可以随时通过访问<strong class="it hv"> API管理器</strong> &gt; <strong class="it hv">凭证</strong>来访问和复制该密钥。</li></ul><h2 id="a398" class="mh jq hu bd jr mi mj mk jv ml mm mn jz jc mo mp kd jg mq mr kh jk ms mt kl mu dt translated">测试我们所做的</h2><p id="8e37" class="pw-post-body-paragraph ir is hu it b iu mv iw ix iy mw ja jb jc mx je jf jg my ji jj jk mz jm jn jo hn dt translated">考验我们宝贵工作的时间到了！为此，我们将对API执行一个HTTP请求。为此，我们将使用以下JSON模板:</p><figure class="ko kp kq kr fq ks"><div class="bz el l di"><div class="na nb l"/></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Our request payload template</figcaption></figure><p id="f299" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意，我们使用<strong class="it hv"> __IMAGE_URI__ </strong>作为<strong class="it hv"> imageUri </strong>字段的值。当我们调用API时，这个占位符将被替换为<strong class="it hv"> sed </strong>:</p><figure class="ko kp kq kr fq ks"><div class="bz el l di"><div class="na nb l"/></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Performing a POST request to the API</figcaption></figure><p id="5eb6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里发生了什么事？</p><ul class=""><li id="ca79" class="lg lh hu it b iu iv iy iz jc li jg lj jk lk jo ll lm ln lo dt translated">首先，我们使用<strong class="it hv"> sed </strong>将<strong class="it hv"> __IMAGE_URI__ </strong>替换为我们正在分析的图像的URL</li><li id="f910" class="lg lh hu it b iu lq iy lr jc ls jg lt jk lu jo ll lm ln lo dt translated">然后，我们将<strong class="it hv"> sed输出</strong>传送到我们的<strong class="it hv"> curl </strong>命令。这将把我们的JSON由sed更改为<a class="ae lp" href="https://vision.googleapis.com/v1/images:annotate?key=__API_KEY__" rel="noopener ugc nofollow" target="_blank">https://vision.googleapis.com/v1/images:annotate?key=__API_KEY__ </a>(确保使用您在这里生成的API密钥)。</li></ul><p id="d3ad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">结果如下:</p><figure class="ko kp kq kr fq ks"><div class="bz el l di"><div class="na nb l"/></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">curl command output</figcaption></figure><p id="a35c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">成功了！从结果中，我们可以看到API超过<strong class="it hv"> 97%确定它是一个马克杯</strong>，超过<strong class="it hv"> 94%确定它是橙色</strong>。下面是我们分析的图像。如您所见，API产生了相当好的结果:</p><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div class="fe ff nc"><img src="../Images/2938bb067542ad2a39f649140c7e69f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*_v5cSuV48fmCb_X3ulIgWg.jpeg"/></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Our not so beauty analyzed orange mug</figcaption></figure><p id="a3a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，如果您再次检查Google Cloud Vision API仪表板，您应该会看到它现在显示更新的数据:</p><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff nd"><img src="../Images/19dd46aa8b18833a87360ff7265eedf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZDQ226GUl_4b-vFHYNJ7RQ.png"/></div></div><figcaption class="kv kw fg fe ff kx ky bd b be z ek">Google Cloud Vision API dashboard now displays some data</figcaption></figure><h2 id="abc5" class="mh jq hu bd jr mi mj mk jv ml mm mn jz jc mo mp kd jg mq mr kh jk ms mt kl mu dt translated">结论</h2><p id="28b3" class="pw-post-body-paragraph ir is hu it b iu mv iw ix iy mw ja jb jc mx je jf jg my ji jj jk mz jm jn jo hn dt translated">在第一部分中，我们已经了解了Google Cloud Vision API是什么，创建Google Cloud项目并为其启用Vision API是多么容易，使用API是多么容易，当然，API的准确性令人印象深刻。</p><p id="ea38" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请继续关注下一部分，因为我们将看到如何配置Firebase并将其与API集成，以及如何创建一个基本的Android。</p><p id="5489" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">希望你喜欢它！</p><p id="f0b8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lc">感谢阅读！如果你觉得这有帮助或有趣，请❤它。另外，欢迎在下面的评论中分享你的想法。</em></p></div></div>    
</body>
</html>