<html>
<head>
<title>I wrote some Golang, and it felt great</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我写了一些歌，感觉很棒</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/i-wrote-some-golang-and-it-felt-great-3c3367a67db5?source=collection_archive---------0-----------------------#2017-05-05">https://medium.com/hackernoon/i-wrote-some-golang-and-it-felt-great-3c3367a67db5?source=collection_archive---------0-----------------------#2017-05-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b2c3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我作为Node.js &amp; React开发人员编写Golang的经历</p><p id="c7d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">免责声明:我写这篇文章是因为我刚开始学习Golang，所以任何关于Golang的评论都存在明显的知识空白。</em></p><p id="1663" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我一直在考虑让<a class="ae jq" href="https://hackernoon.com/tagged/learning" rel="noopener ugc nofollow" target="_blank">学习</a>围棋——我的主要堆栈是Node.js和React，我一直在寻找一种更高性能、专注于并发的语言来做一些改变，因为Node并不总是答案。这篇文章是一个小文档，记录了我最终是如何尝试这门语言的，以及为什么我真的喜欢它。</p><h1 id="f699" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">背景</h1><p id="7682" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">不久前，我有了一个想法，需要一个基于英语词典内容的经过处理的数据集合，用于一个附带项目，只是我不想要数据库，我想要一个可以存储在内存中的文件，因为成本原因，我不必托管它。它将是一个express应用程序的基础，我将用一个简单的React前端来显示它，所以我想编写脚本来在Node中构建数据文件；一部分是因为我对它很了解，一部分是因为它很适合JSON和松散嵌套的数据结构，还有一部分是因为它上手很快。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/96e2903c89a0ed8d5c5d81c93ac73ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*D6jhytK_JWk9GzLlvpKSnA.gif"/></div></figure><p id="3161" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在几个小时的npm安装、承诺包装和一些数字运算之后，我设置了我的脚本来运行，并在它运行时做了一些控制台日志记录来跟踪进度(提示:如果你想尽可能地从节点中挤出所有性能，就不要<code class="eh lc ld le lf b">console.log()</code>),希望它能在一夜之间完成。</p><p id="ccf6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">没有。</strong></p><p id="2766" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它到了字母<strong class="it hv"> P </strong>处，减速停下。但是为什么呢..？在我写这个剧本之前，我算错了一些事情。首先是文件大小；我的数据集是基于129，000个单词。每个单词都有一个嵌套对象，其中包含一组值和分数——所以我在内存中存储了129，000个深度嵌套的对象。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div class="fe ff lg"><img src="../Images/c3cf2f085de00a4cbffa8eab69b2e8b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*q6ckujt5Pb2AWLzPC187ng.gif"/></div></figure><p id="f11b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您知道V8编译器在默认情况下对32位系统的最大内存限制是512MB，而对64位系统只有1GB吗？您可以将其提升至约1.7GB，但仅此而已。所以我的巨大内存对象的内存快用完了。</p><p id="2c03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">狗屎。</strong>不理想。我的解决方案？</p><p id="9d20" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">小溪！如果我将数据传输到JSON文件，这样我就不用担心内存中的数据了，会怎么样？完美。所以我在几个小时内重构了我的代码，并让它流到我的文件中。内存使用下降，它嘎吱嘎吱地前进，所以我再次离开它一夜。当我醒来时，一切都结束了；太好了！不太好。我新创建的JSON文件是4.2GB。考虑到节点内存的限制，它不完全可用，实际上也不可能。不管用什么语言，我都不建议加载4.2GB的文件。</strong></p><p id="910d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">那我该怎么办？</strong>我需要这些数据被一个API访问和输出。如果我即时计算我需要的值会怎么样？我没有幻想这个副业项目会爆炸，需要处理大量的流量，所以我认为这很好。因此，我再次着手重构代码，并将其直接集成到我的API中。<strong class="it hv">问题三</strong>？速度。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/a15537fbb269f28e6b95bd727f78bdfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/1*6TYqMppsXPc0yo95nyisPA.gif"/></div></figure><p id="fd3d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Node.js中实时计算一个我需要的值大约需要<strong class="it hv">500毫秒</strong>，这是一个问题，因为我需要为我的最终产品的每个请求多次点击这个API。等待<strong class="it hv"> 5秒</strong>的结果根本不是一个选项(好吧，它是，但让我们假设人们会使用它，并需要它很快)。</p><p id="26dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为什么这么慢？请记住Node.js不是多线程的(尽管人们喜欢假装它是)，它的并发模型基于事件循环，这允许它执行非阻塞I/O操作。它通过将操作交给系统内核(通常是多线程的)来完成，系统内核可以在后台处理进程，直到它准备好将结果返回给节点。</p><p id="b329" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，我需要一些多线程的、高性能的、有趣的东西。我过去做过一些<strong class="it hv"> Java </strong>、<strong class="it hv"> C++ </strong>、<strong class="it hv"> C# </strong>和<strong class="it hv"> PHP </strong>，但我认为这是一个尝试不同事物的好机会——我考虑过使用<strong class="it hv"> Scala </strong>、<strong class="it hv"> Erlang </strong>或<strong class="it hv">elixin</strong>的功能方面，但我也想要结果，不想陷入我仅有的范式中</p><p id="9b6d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然我确实想学一门函数式语言，有什么建议吗？</p><p id="570d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，在得到一位同事的称赞后，我选择了Golang我做了一些在线参观(不耐烦),并花了一些时间来适应——再次定义类型(我还没有尝试过Flow)是我不习惯做的事情。不管怎样，在几个小时内，我就有了重新创建实时数据查找所需的基础知识。</p><h2 id="a978" class="li js hu bd jt lj lk ll jx lm ln lo kb jc lp lq kf jg lr ls kj jk lt lu kn lv dt translated">那我是怎么找到的呢？</h2><p id="221a" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">让我们从速度开始。我的库实时查找平均需要8ms来获取我需要的值。这是6250%的性能提升。可笑！</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div class="fe ff lw"><img src="../Images/e096d0f7af1cae4f92cb865f20ef1d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/1*i5oUg6diZaIzyG3Uh-DEQw.gif"/></div></figure><p id="8acf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我肯定能以这样的速度工作。</p><h1 id="80a8" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">我喜欢的其他运动</h1><h2 id="dd02" class="li js hu bd jt lj lk ll jx lm ln lo kb jc lp lq kf jg lr ls kj jk lt lu kn lv dt translated">标准程序库</h2><p id="5e81" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">Golang标准库非常详细，到目前为止已经包含了我创建2个项目所需的所有功能。文档很详细，包含示例，很容易遍历，除此之外，不需要<code class="eh lc ld le lf b">npm install <strong class="it hv">everything</strong></code>真的让人耳目一新。</p><h2 id="ba7e" class="li js hu bd jt lj lk ll jx lm ln lo kb jc lp lq kf jg lr ls kj jk lt lu kn lv dt translated">所有代码看起来都一样</h2><p id="a613" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">Go语言规范是<a class="ae jq" href="https://golang.org/ref/spec" rel="noopener ugc nofollow" target="_blank"> tiny </a>(认真对比一下<a class="ae jq" href="https://docs.oracle.com/javase/specs/jls/se8/html/index.html" rel="noopener ugc nofollow" target="_blank"> Java的</a>)。结果是，学习这种语言的能力只需要很少的时间(相对而言),就可以让你开始真正的编程。做每件事没有50种方法，通常只有1或2种，这意味着即使你是这门语言的新手，阅读别人的代码也不会被难住。</p><p id="5e9b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Go的依赖管理基于严格的文件结构，这也意味着一切都在你期望的地方，你不必在文件夹结构中寻找你要导入的东西，这是显而易见的。</p><p id="f7de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">G <a class="ae jq" href="https://golang.org/cmd/gofmt/" rel="noopener ugc nofollow" target="_blank"> ofmt </a>是另一颗宝石，它让编写风格相似的代码成为一场梦；一个内置的命令可以格式化你的代码(它甚至可以<a class="ae jq" href="https://golang.org/cmd/gofmt/#hdr-The_simplify_command" rel="noopener ugc nofollow" target="_blank">为你简化</a>)。</p><p id="de74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不再是❤.了</p><h2 id="7b7e" class="li js hu bd jt lj lk ll jx lm ln lo kb jc lp lq kf jg lr ls kj jk lt lu kn lv dt translated">并发性很容易推理</h2><p id="7f0b" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">Go使用goroutines和通道处理并发；生成并发函数的简单方法和分别接收它们的结果的方法。我不打算详细说明它们是如何工作的，我只想提一下我发现使用它们是多么容易——与几年前我纠结的Java工作线程相比，这简直是一个梦想。如果你有兴趣，可以参加官方的Golang之旅。</p><p id="7f49" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jq" href="https://www.golang-book.com/books/intro/10" rel="noopener ugc nofollow" target="_blank">点击这里</a>和<a class="ae jq" href="https://tour.golang.org/concurrency/1" rel="noopener ugc nofollow" target="_blank">这里</a>阅读更多关于Go的并发性</p><h2 id="e744" class="li js hu bd jt lj lk ll jx lm ln lo kb jc lp lq kf jg lr ls kj jk lt lu kn lv dt translated"><strong class="ak">构建/运行/打包很简单</strong></h2><ul class=""><li id="f483" class="lx ly hu it b iu kp iy kq jc lz jg ma jk mb jo mc md me mf dt translated"><code class="eh lc ld le lf b">go run myProgram.go</code></li><li id="9d92" class="lx ly hu it b iu mg iy mh jc mi jg mj jk mk jo mc md me mf dt translated"><code class="eh lc ld le lf b">go build myProgram.go</code></li></ul><p id="1e29" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">简单的内置命令，编译并运行您的主包，并将它们打包成一个二进制可执行文件，只需一个简单的命令就可以在任何地方部署。标志可以用来改变目标平台。</p><h2 id="940f" class="li js hu bd jt lj lk ll jx lm ln lo kb jc lp lq kf jg lr ls kj jk lt lu kn lv dt translated">我现在很享受使用我声明的东西</h2><p id="667f" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">围棋是编的。它也不允许你编译，除非你使用所有你声明的东西。这意味着你声明的每一个变量、包和函数都必须以某种方式使用，否则它会对你大喊大叫，直到你删除它们。一开始，我承认我讨厌这样——我是一名<a class="ae jq" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>开发人员，有时我只是写一些随后要删除的代码，以一种仓促的方式制作原型，调试正在发生的事情等等——你不能用Golang做到这一点，这让我思考我正在做的事情，并从一开始就让我的代码更整洁。</p><h1 id="a7fb" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">整理想法</h1><p id="d8ef" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">显然，Go并不总是每次都快6250%,它只是碰巧在我的用例中工作得非常好，因为需要并发的数字处理——然而，我喜欢这门语言的其他事情已经被融入其中，对我来说还没有发生偏差。到目前为止，我是一个大粉丝，所以我计划继续使用它作为我的附带项目<strong class="it hv">，如果适用的话</strong>。</p><p id="468f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我还没有提到它的其他优点——测试、基准测试、不可思议的内置HTTP服务器等等。我只想谈谈我的发现，并强调有时Node.js并不总是答案。</p><p id="031b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上手很快，很容易上手，运行的时候快得像他妈的一样但是有点严格，没关系。</p><p id="a8a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">至于文中提到的代码，如果大家有兴趣我会贴上来，但是使用我的lib的API还没有启动(我很忙好吗？)所以一直没有开源。</p><h2 id="c060" class="li js hu bd jt lj lk ll jx lm ln lo kb jc lp lq kf jg lr ls kj jk lt lu kn lv dt translated">想学围棋？</h2><ul class=""><li id="76a7" class="lx ly hu it b iu kp iy kq jc lz jg ma jk mb jo mc md me mf dt translated"><a class="ae jq" href="https://tour.golang.org/welcome/1" rel="noopener ugc nofollow" target="_blank">官方戈兰游</a></li><li id="8444" class="lx ly hu it b iu mg iy mh jc mi jg mj jk mk jo mc md me mf dt translated"><a class="ae jq" href="https://www.udemy.com/learn-how-to-code/learn/v4/overview" rel="noopener ugc nofollow" target="_blank">托德·麦克劳德的精彩Udemy </a></li><li id="1a14" class="lx ly hu it b iu mg iy mh jc mi jg mj jk mk jo mc md me mf dt translated"><a class="ae jq" href="https://www.golang-book.com/books/intro" rel="noopener ugc nofollow" target="_blank">戈兰书</a></li></ul><p id="d8db" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">喜欢我的漫谈吗？在我的<a class="ae jq" href="https://twitter.com/_ChrisGreg" rel="noopener ugc nofollow" target="_blank"><em class="jp">Twitter</em></a><em class="jp">上关注我，观看我的围棋旅程，或者在我的</em> <a class="ae jq" href="http://chrisgregori.co.uk/" rel="noopener ugc nofollow" target="_blank"> <em class="jp">个人网站</em> </a> <em class="jp">上关注我的业余项目。💻</em></p><div class="kv kw kx ky fq ab cb"><figure class="ml kz mm mn mo mp mq paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ml kz mm mn mo mp mq paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ml kz mm mn mo mp mq paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mr ms mt"><p id="f922" class="ir is jp it b iu iv iw ix iy iz ja jb mu jd je jf mv jh ji jj mw jl jm jn jo hn dt translated"><a class="ae jq" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jq" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jq" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jq" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is jp it b iu iv iw ix iy iz ja jb mu jd je jf mv jh ji jj mw jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jq" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jq" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="fe ff mx"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="nc nd l"/></div></figure></div></div>    
</body>
</html>