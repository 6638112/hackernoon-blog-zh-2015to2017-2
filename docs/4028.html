<html>
<head>
<title>Rates of change</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">变化率</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/this-is-part-8-of-an-n-part-series-detailing-how-i-make-my-animations-ca904f010a19?source=collection_archive---------13-----------------------#2017-05-07">https://medium.com/hackernoon/this-is-part-8-of-an-n-part-series-detailing-how-i-make-my-animations-ca904f010a19?source=collection_archive---------13-----------------------#2017-05-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="098c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是N部分系列的第8部分，详细介绍了我如何制作我的动画。</p><p id="47e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://hackernoon.com/change-your-scales-97e4ee37c4d4" rel="noopener ugc nofollow" target="_blank">上一张</a>T20】下一张</p><p id="9fb6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们不想用冗长缓慢的动画让观众厌烦，所以让我们加快一点速度。目前我们每帧画一个点，所以最简单的方法是每帧画多个点，方法是创建一个名为<code class="eh jq jr js jt b">deltaX</code>的变量，并将其设置为帧数的五倍:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="1146" class="kc kd hu jt b fv ke kf l kg kh">int deltaX = frameCount * 5;</span></pre><p id="5638" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后将<code class="eh jq jr js jt b">frameCount</code>的所有引用替换为<code class="eh jq jr js jt b">deltaX</code>，结果是:</p><figure class="ju jv jw jx fq ki"><div class="bz el l di"><div class="kj kk l"/></div></figure><p id="45ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就这样。下面是完整的代码:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="69f9" class="kc kd hu jt b fv ke kf l kg kh">import java.time.*;</span><span id="e6b4" class="kc kd hu jt b fv kl kf l kg kh">FloatDict _data = new FloatDict();<br/>LocalDate _startDate = LocalDate.of(1958, 3, 29);</span><span id="7619" class="kc kd hu jt b fv kl kf l kg kh">void setup()<br/>{<br/>  loadData();<br/>  size(500,500);<br/>  background(0);<br/>  stroke(255,255,0);<br/>}</span><span id="fafa" class="kc kd hu jt b fv kl kf l kg kh">float yScale = 20.0;</span><span id="d546" class="kc kd hu jt b fv kl kf l kg kh">void draw()<br/>{<br/>  background(0);<br/>  float xScale = 1.0;<br/>  <br/>  int deltaX = frameCount * 5;<br/>  <br/>  if(deltaX &gt; width)<br/>  {<br/>    xScale = float(width) / float(deltaX);<br/>  }</span><span id="a50c" class="kc kd hu jt b fv kl kf l kg kh">  for(int dataIndex = 1; dataIndex &lt;= deltaX; dataIndex++)<br/>  {<br/>    int daysFromStart = (dataIndex - 1) * 7;<br/>    LocalDate frameDate = _startDate.plusDays(daysFromStart);<br/>    <br/>    if(_data.hasKey(frameDate.toString()))<br/>    {<br/>      float co2 = _data.get(frameDate.toString());<br/>            <br/>      float x = dataIndex;<br/>      float y = (co2 - 313.04) ;<br/>      <br/>      if(y * yScale &gt; height) <br/>      {<br/>        yScale = float(height)/y;<br/>      }<br/>      <br/>      ellipse(x * xScale, height - (y * yScale), 1, 1);<br/>    }<br/>  }<br/>}</span><span id="36ae" class="kc kd hu jt b fv kl kf l kg kh">void loadData()<br/>{<br/>  String[] lines = loadStrings("weekly_in_situ_co2_mlo.csv");<br/>  <br/>  for (String line : lines) <br/>  {<br/>    if( line.startsWith("\"") ) continue;<br/>    <br/>    String[] values = split(line, ',');<br/>    String date = values[0];<br/>    float co2 = parseFloat(values[1]);<br/>    _data.set(date, co2);<br/>  }<br/>}</span></pre><p id="71ba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，我觉得开始时太快了，但结束时不够快。这意味着我们应该在动画过程中改变<a class="ae jp" href="https://hackernoon.com/tagged/rate" rel="noopener ugc nofollow" target="_blank">速率</a>。一种方法是使用<code class="eh jq jr js jt b">frameCount</code>来改变速率，但这很快变得复杂。</p><p id="50dd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种事情在动画中很常见，聪明的类型已经创建了简化这种事情的库。这些库被称为“宽松库”,我们将使用Benedikt Gro写的名为<code class="eh jq jr js jt b">Ani</code>的库。</p><p id="9c8b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要安装<code class="eh jq jr js jt b">Ani</code>,进入Processing的<code class="eh jq jr js jt b">Tools</code>菜单，在Libraries选项卡中选择<code class="eh jq jr js jt b">Add Tool...</code>,搜索<code class="eh jq jr js jt b">Ani</code>,然后点击install。</p><p id="1f21" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个库所做的是使用一个选择的算法在动画过程中改变一个特定变量的值。我们希望以稳定的方式将动画的速度从慢变快。为此，我们用一个变量替换上面代码中的常量值<code class="eh jq jr js jt b">5</code>。我调用这个变量<code class="eh jq jr js jt b">_change</code>，并将其初始值设置为<code class="eh jq jr js jt b">1.0</code>。</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="1953" class="kc kd hu jt b fv ke kf l kg kh">float _change = 1.0;</span><span id="1b29" class="kc kd hu jt b fv kl kf l kg kh">void draw()<br/>{<br/>  int deltaX = int(frameCount * _change);</span></pre><p id="fcb2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">显然，这本身并没有多大作用。</p><p id="c005" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们激活<code class="eh jq jr js jt b">Ani</code>。首先我们导入它:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="c03a" class="kc kd hu jt b fv ke kf l kg kh">import de.looksgood.ani.*;<br/>Ani _ani;</span></pre><p id="9eb9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">_ani</code>是包含<code class="eh jq jr js jt b">Ani</code>对象的变量。</p><p id="0d82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后我们在<code class="eh jq jr js jt b">setup()</code>中设置它:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="74da" class="kc kd hu jt b fv ke kf l kg kh">  Ani.init(this);<br/>  Ani.setDefaultTimeMode(Ani.FRAMES);<br/>  _ani = new Ani(this, 1032, "_change", 3.0, Ani.EXPO_IN);</span></pre><p id="94f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh jq jr js jt b">this</code>是对我们Keeling动画的引用，让<code class="eh jq jr js jt b">Ani</code>库知道在哪里找东西。默认情况下，时间模式是基于秒的，但我发现使用帧更准确，因为我们可以处理成千上万的数据点，每帧可能需要一段时间来渲染。</p><p id="bb84" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">于是<code class="eh jq jr js jt b">Ani</code>图书馆的肉和土豆就包含在这行字里:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="0270" class="kc kd hu jt b fv ke kf l kg kh">_ani = new Ani(this, 1032, "_change", 3.0, Ani.EXPO_IN);</span></pre><p id="ef5d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着超过1032帧修改<code class="eh jq jr js jt b">_change</code>变量中的值，以指数形式结束值3。记得我们定义了<code class="eh jq jr js jt b">_change</code>从上面的值<code class="eh jq jr js jt b">1.0</code>开始，所以这个值慢慢增加，直到1032帧后达到<code class="eh jq jr js jt b">3.0</code>。</p><p id="b29a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">完整的文档可在<a class="ae jp" href="http://benedikt-gross.de/libraries/Ani/" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="b727" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">运行这个程序，我们得到:</p><figure class="ju jv jw jx fq ki"><div class="bz el l di"><div class="kj kk l"/></div></figure><p id="5bb9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如你所看到的，它开始时很好，很慢，很容易，然后速度迅速增加。</p><p id="1197" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以下是完整的代码:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="6e56" class="kc kd hu jt b fv ke kf l kg kh">import java.time.*;<br/>import de.looksgood.ani.*;<br/>Ani _ani;</span><span id="403b" class="kc kd hu jt b fv kl kf l kg kh">FloatDict _data = new FloatDict();<br/>LocalDate _startDate = LocalDate.of(1958, 3, 29);</span><span id="db14" class="kc kd hu jt b fv kl kf l kg kh">void setup()<br/>{<br/>  loadData();<br/>  size(500,500);<br/>  background(0);<br/>  stroke(255,255,0);<br/>  frameRate(30);<br/>  <br/>  Ani.init(this);<br/>  Ani.setDefaultTimeMode(Ani.FRAMES);<br/>  _ani = new Ani(this, 1032, "_change", 3.0, Ani.EXPO_IN);<br/>}</span><span id="0ef4" class="kc kd hu jt b fv kl kf l kg kh">float yScale = 20.0;<br/>float _change = 1.0;</span><span id="c007" class="kc kd hu jt b fv kl kf l kg kh">void draw()<br/>{<br/>  int deltaX = int(frameCount * _change);<br/>   <br/>  background(0);<br/>  float xScale = 1.0;<br/>   <br/>  if(deltaX &gt; width)<br/>  {<br/>    xScale = float(width) / float(deltaX);<br/>  }<br/>  <br/>  for(int dataIndex = 1; dataIndex &lt;= deltaX; dataIndex++)<br/>  {<br/>    <br/>    int daysFromStart = (dataIndex - 1) * 7;<br/>    LocalDate frameDate = _startDate.plusDays(daysFromStart);<br/>       <br/>    if(_data.hasKey(frameDate.toString()))<br/>    {<br/>      float co2 = _data.get(frameDate.toString());<br/>            <br/>      float x = dataIndex;<br/>      float y = (co2 - 313.04) ;<br/>      <br/>      if(y * yScale &gt; height) <br/>      {<br/>        yScale = float(height)/y;<br/>      }<br/>      <br/>      ellipse(x * xScale, height - (y * yScale), 1, 1);<br/>    }<br/>  }<br/>}</span><span id="ac0d" class="kc kd hu jt b fv kl kf l kg kh">void loadData()<br/>{<br/>  String[] lines = loadStrings("weekly_in_situ_co2_mlo.csv");<br/>  <br/>  for (String line : lines) <br/>  {<br/>    if( line.startsWith("\"") ) continue;<br/>    <br/>    String[] values = split(line, ',');<br/>    String date = values[0];<br/>    float co2 = parseFloat(values[1]);<br/>    _data.set(date, co2);<br/>  }<br/>}</span></pre><p id="1fc4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下周我们将添加文字和一些润色！</p></div><div class="ab cl km kn hc ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hn ho hp hq hr"><p id="264f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我通过反复试验得出了1032。我肯定有计算的方法，但人生苦短。</p><blockquote class="kt ku kv"><p id="3c68" class="ir is kw it b iu iv iw ix iy iz ja jb kx jd je jf ky jh ji jj kz jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是这个家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is kw it b iu iv iw ix iy iz ja jb kx jd je jf ky jh ji jj kz jl jm jn jo hn dt translated">要了解更多信息，请<a class="ae jp" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">阅读我们的“关于”页面</a>、<a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上给我们点赞/发消息</a>，或者简单地说，<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is kw it b iu iv iw ix iy iz ja jb kx jd je jf ky jh ji jj kz jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ju jv jw jx fq ki"><div class="bz el l di"><div class="la kk l"/></div></figure></div></div>    
</body>
</html>