<html>
<head>
<title>Yet another MVP article — Part 5: Writing Test using a mixture of Dagger and Espresso</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">另一篇MVP文章——第5部分:混合使用匕首和浓缩咖啡的写作测试</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/yet-another-mvp-article-part-5-writing-test-using-a-mixture-of-dagger-and-espresso-15c638182706?source=collection_archive---------2-----------------------#2016-12-08">https://medium.com/hackernoon/yet-another-mvp-article-part-5-writing-test-using-a-mixture-of-dagger-and-espresso-15c638182706?source=collection_archive---------2-----------------------#2016-12-08</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0052" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">实现示例</em> <a class="ae jq" href="https://hackernoon.com/tagged/android" rel="noopener ugc nofollow" target="_blank"> <em class="jp">安卓</em> </a> <em class="jp">应用使用</em><strong class="it hv"><em class="jp">MVP</em></strong><em class="jp"/><strong class="it hv"><em class="jp">rx Java</em></strong><em class="jp"/><strong class="it hv"><em class="jp">匕首2</em></strong><em class="jp"/><strong class="it hv"><em class="jp">改装2</em></strong><em class="jp"/><strong class="it hv"><em class="jp">测试</em></strong></p><h1 id="4a10" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">本文前情提要…</h1><div class="kp kq fm fo kr ks"><a href="https://hackernoon.com/yet-another-mvp-article-part-4-rxjava-and-rxandroid-knows-how-to-response-cde42ccc4958" rel="noopener  ugc nofollow" target="_blank"><div class="kt ab ej"><div class="ku ab kv cl cj kw"><h2 class="bd hv fv z el kx eo ep ky er et ht dt translated">另一篇MVP文章——第4部分:RxJava和RxAndroid知道如何响应</h2><div class="kz l"><h3 class="bd b fv z el kx eo ep ky er et ek translated">使用MVP、RxJava、Dagger 2、Retrofit2、Test和所有全新的现代技术实现一个示例Android应用程序…</h3></div><div class="la l"><p class="bd b gc z el kx eo ep ky er et ek translated">hackernoon.com</p></div></div><div class="lb l"><div class="lc l ld le lf lb lg lh ks"/></div></div></a></div><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div class="fe ff li"><img src="../Images/e79f731a2265d5afd3da9e56e0576b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*IwLrFJJGBV_KfqrMJOPOtQ.gif"/></div></figure><p id="385e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设您已经学习了<a class="ae jq" rel="noopener" href="/@mohsenoid/yet-another-mvp-article-part-1-lets-get-to-know-the-project-d3fd553b3e21#.6y9ze7e55"> part1 </a>、<a class="ae jq" rel="noopener" href="/@mohsenoid/yet-another-mvp-article-part-2-how-dagger-helps-with-the-project-90d049a45e00#.62mdwkqwj"> part2 </a>、<a class="ae jq" rel="noopener" href="/@mohsenoid/yet-another-mvp-article-part-3-calling-apis-using-retrofit-23757f4eee05"> part3 </a>和<a class="ae jq" rel="noopener" href="/@mohsenoid/yet-another-mvp-article-part-4-rxjava-and-rxandroid-knows-how-to-response-cde42ccc4958#.mzdr2fow8"> part4 </a>，这意味着您了解了关于<a class="ae jq" href="https://github.com/mohsenoid/marvel" rel="noopener ugc nofollow" target="_blank">示例项目的</a>模块和结构的一切，也更加熟悉了<strong class="it hv"> Dagger </strong>在布线<strong class="it hv"> MVP </strong>层中的用法，并且知道了<strong class="it hv">改型</strong>用于连接到<a class="ae jq" href="https://hackernoon.com/tagged/network" rel="noopener ugc nofollow" target="_blank">网络</a><a class="ae jq" href="https://hackernoon.com/tagged/network" rel="noopener ugc nofollow" target="_blank"/></p><p id="a688" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们继续…</p></div><div class="ab cl lp lq hc lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h1 id="6b0a" class="jr js hu bd jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko dt translated">测试，测试，测试…为什么？</h1><p id="9cd5" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">当你在开发一个应用程序或任何软件项目时，通常产品负责人会带来新的想法和特性，使项目更加光彩夺目！所以你开始开发让每个人都开心的方式，也不要错过最后期限，但是天知道你是如何通过添加新的特性代码和改变其他模块来适应你的新代码，从而破坏了项目的其他部分。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div class="fe ff mg"><img src="../Images/70d9950c9c8065367841b0588a903cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/1*kRgJkvZMQMBnTNmg84eUkg.gif"/></div></figure><p id="9af4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你完成你的工作，运行应用程序，检查新功能是否工作正常，希望你没有弄坏任何东西。你发布一个版本给QA测试，然后尽快离开办公室！！！</p><p id="b8dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">长话短说…</p><h2 id="c3b7" class="mh js hu bd jt mi mj mk jx ml mm mn kb jc mo mp kf jg mq mr kj jk ms mt kn mu dt translated">对口！</h2><p id="cfe2" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">您已经花了足够的时间编写了一些测试来检查您的应用程序功能的所有部分，在将您的更改推入repo后，通过使用CI(持续集成)服务，您将获得测试通过或失败的完整报告。</p><h2 id="c607" class="mh js hu bd jt mi mj mk jx ml mm mn kb jc mo mp kf jg mq mr kj jk ms mt kn mu dt translated">加油，写作考试很难…</h2><p id="273d" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">我相信在2或3个版本发布后发现bug比在每次特性开发和代码更改后编写一些简单的测试要困难得多。</p></div><div class="ab cl lp lq hc lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h1 id="14e7" class="jr js hu bd jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko dt translated">让我们开始测试…</h1><p id="df43" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">按'<a class="ae jq" href="https://developer.android.com/studio/test/index.html" rel="noopener ugc nofollow" target="_blank"><em class="jp"/></a><em class="jp">':</em></p><blockquote class="mv mw mx"><p id="6545" class="ir is jp it b iu iv iw ix iy iz ja jb my jd je jf mz jh ji jj na jl jm jn jo hn dt translated">Android Studio旨在简化测试。只需几次点击，您就可以设置在本地JVM上运行的JUnit测试或在设备上运行的插装测试。当然，您也可以通过集成测试框架来扩展您的测试能力，例如在您的本地单元测试中测试Android API调用的<a class="ae jq" href="https://github.com/mockito/mockito" rel="noopener ugc nofollow" target="_blank"> Mockito </a>，以及在您的测试中练习用户交互的<a class="ae jq" href="https://developer.android.com/topic/libraries/testing-support-library/index.html#Espresso" rel="noopener ugc nofollow" target="_blank"> Espresso </a>或<a class="ae jq" href="https://developer.android.com/topic/libraries/testing-support-library/index.html#UIAutomator" rel="noopener ugc nofollow" target="_blank"> UI Automator </a>。您可以使用<a class="ae jq" href="https://developer.android.com/studio/test/espresso-test-recorder.html" rel="noopener ugc nofollow" target="_blank">浓缩咖啡测试记录器</a>自动生成浓缩咖啡测试。</p></blockquote><p id="b0e2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">…，所以IDE支持测试的一切，别太懒了！</p><p id="5295" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Android Studio支持两种不同类型的测试:</p><ul class=""><li id="f6ae" class="nb nc hu it b iu iv iy iz jc nd jg ne jk nf jo ng nh ni nj dt translated">JUnit测试:测试Java代码，不需要Android设备或SDK。</li><li id="7509" class="nb nc hu it b iu nk iy nl jc nm jg nn jk no jo ng nh ni nj dt translated">仪器测试:大部分时间使用Android设备测试应用程序功能(通常是UI反应)。</li></ul><p id="df03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">运行测试的要点是<strong class="it hv">断言</strong>每个临界点并检查它是否正确工作。有不同类型的断言，您将在这个示例项目中熟悉其中的一些。</p><p id="79bc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">回到示例项目，我们有两个不同的模块，<em class="jp">核心</em>和<em class="jp">应用</em>。核心模块是纯java的，所以每次测试都只使用JUnit测试:</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div class="fe ff np"><img src="../Images/57389d4a906ef14b43bdc54e9233619c.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*CjLsyDW_xNgcuXR0E8LMwg.png"/></div><figcaption class="nq nr fg fe ff ns nt bd b be z ek">core module test folder</figcaption></figure><p id="ec4e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不要忘记JUnit测试放在src的test文件夹中，在主文件夹的旁边。包装与主要源代码相同。</p><p id="fa49" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp"> app </em>模块包含Android和Java代码，所以我们需要JUnit和androidTests:</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div class="fe ff nu"><img src="../Images/d72122fa042b1f607f94ea826c53b8aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*EeI8nQdsu5RHa-Iuf8QnmA.png"/></div><figcaption class="nq nr fg fe ff ns nt bd b be z ek">app module test &amp; androidTest folders</figcaption></figure></div><div class="ab cl lp lq hc lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h1 id="eb53" class="jr js hu bd jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko dt translated">核心模块JUnit测试:</h1><p id="c850" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">我写了一个简单的JUnit test "<a class="ae jq" href="https://github.com/mohsenoid/marvel/blob/master/core-lib/src/test/java/com/mirhoseini/marvel/character/search/SearchInteractorTest.java" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">searchinactortest</strong></a>" which test "<a class="ae jq" href="https://github.com/mohsenoid/marvel/blob/master/core-lib/src/main/java/com/mirhoseini/marvel/character/search/SearchInteractor.java" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">SearchInteractor</strong></a>"类功能。让我们来看看:</p><figure class="lj lk ll lm fq ln"><div class="bz el l di"><div class="nv nw l"/></div></figure><p id="97d6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，请记住，通过将测试类保存在被测试类的同一个包中，您可以访问该类和包中的所有内容，而无需将它们公开，以便从其他包中访问。</p><p id="7eed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其次，在这个示例中，我们使用了mocking，这意味着从一些源代码部分创建一个模型，并以您想要的方式使用它们。在这个示例中，我们模拟了两个主要的类，我们不希望它们以正常的方式运行:</p><ul class=""><li id="3679" class="nb nc hu it b iu iv iy iz jc nd jg ne jk nf jo ng nh ni nj dt translated"><strong class="it hv"> MarvelApi </strong>:使用这行代码处理网络Api调用:</li></ul><pre class="lj lk ll lm fq nx ny nz oa aw ob dt"><span id="bcf1" class="mh js hu ny b fv oc od l oe of">api = mock(MarvelApi.class)</span></pre><ul class=""><li id="9aa6" class="nb nc hu it b iu iv iy iz jc nd jg ne jk nf jo ng nh ni nj dt translated"><strong class="it hv"> SchedulerProvider </strong>:为使用这行代码运行代码提供线程；</li></ul><pre class="lj lk ll lm fq nx ny nz oa aw ob dt"><span id="0a86" class="mh js hu ny b fv oc od l oe of">scheduler = mock(SchedulerProvider.class)</span></pre><p id="f1b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下一步是创建一个我们希望API返回的测试结果，这非常简单，这就是Mockito库的神奇之处:</p><pre class="lj lk ll lm fq nx ny nz oa aw ob dt"><span id="05be" class="mh js hu ny b fv oc od l oe of">when(api.getCharacters(any(String.class), any(String.class), any(String.class), any(Long.class))) .thenReturn(Observable.just(expectedResult));</span></pre><p id="9370" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">测试通常非常接近英语，所以我们可以这样理解:</p><blockquote class="mv mw mx"><p id="ed0c" class="ir is jp it b iu iv iw ix iy iz ja jb my jd je jf mz jh ji jj na jl jm jn jo hn dt translated">嘿jUnit，<strong class="it hv">当</strong>代码调用方法<strong class="it hv"> getCharacter </strong>并传递<strong class="it hv">任何东西</strong>作为任何参数时，<strong class="it hv">然后返回</strong>一个单独的<strong class="it hv"> RxJava </strong> <strong class="it hv">可观察的</strong>包含<strong class="it hv">预期结果</strong>。</p></blockquote><p id="15f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你在设置方法的开头提到@Before注释了吗？JUnit test会在任何带有@Test注释的方法之前运行这个方法，然后准备好测试所需的任何东西。</p></div><div class="ab cl lp lq hc lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h1 id="6231" class="jr js hu bd jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko dt translated">应用模块测试:</h1><p id="0a3b" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">由于<em class="jp"> app </em>模块内部持有<strong class="it hv"> MVP </strong>的<strong class="it hv">视图</strong>层，几乎每次测试都是关于UI功能的。</p><p id="6e71" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这个示例项目中，我使用了两个不同的UI功能测试库:</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="fe ff og"><img src="../Images/7cd3f41a46ab2d13e46ae9aa194c0f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*TJlzlxsPElAmSn1WgVYWkg.png"/></div></div></figure><h2 id="d09f" class="mh js hu bd jt mi mj mk jx ml mm mn kb jc mo mp kf jg mq mr kj jk ms mt kn mu dt translated"><a class="ae jq" href="http://robolectric.org" rel="noopener ugc nofollow" target="_blank">机器人电力</a>:</h2><blockquote class="mv mw mx"><p id="561b" class="ir is jp it b iu iv iw ix iy iz ja jb my jd je jf mz jh ji jj na jl jm jn jo hn dt translated"><a class="ae jq" href="http://robolectric.org/" rel="noopener ugc nofollow" target="_blank"> Robolectric </a>是一个单元测试框架，它定义了Android SDK jar，因此您可以测试驱动您的Android应用程序的开发。测试在几秒钟内就可以在工作站上的JVM中运行。</p></blockquote><p id="17f7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">简单地说，就是扔掉缓慢无用的模拟器！！我将自己运行测试并猜测UI的变化。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="fe ff og"><img src="../Images/4725fd870f00fe9dfdaca4bf9826afd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*CFSbcPHNXk049meqJhNklw.png"/></div></div></figure><h2 id="4073" class="mh js hu bd jt mi mj mk jx ml mm mn kb jc mo mp kf jg mq mr kj jk ms mt kn mu dt translated"><a class="ae jq" href="https://google.github.io/android-testing-support-library/docs/espresso/" rel="noopener ugc nofollow" target="_blank">浓缩咖啡</a>:</h2><blockquote class="mv mw mx"><p id="f367" class="ir is jp it b iu iv iw ix iy iz ja jb my jd je jf mz jh ji jj na jl jm jn jo hn dt translated">浓缩咖啡测试运行速度最快！当它在应用程序UI上操作和断言时，它可以让您将等待、同步、睡眠和轮询留在后面。</p></blockquote><p id="d3ba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它使用Android设备或模拟器来运行测试，并得到Google的支持。</p><p id="35c8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所有Android开发者都知道UI测试总是一个大麻烦，所以Google在上次I/O中引入了<a class="ae jq" href="https://developer.android.com/studio/test/espresso-test-recorder.html" rel="noopener ugc nofollow" target="_blank"> Espresso测试记录器</a>，这使得UI测试和断言变得非常容易。</p></div><div class="ab cl lp lq hc lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h1 id="cf1c" class="jr js hu bd jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko dt translated">使用Robolectric的UI测试示例？</h1><p id="ca34" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">看一看测试类代码:</p><figure class="lj lk ll lm fq ln"><div class="bz el l di"><div class="nv nw l"/></div></figure><h2 id="6df5" class="mh js hu bd jt mi mj mk jx ml mm mn kb jc mo mp kf jg mq mr kj jk ms mt kn mu dt translated">这是怎么回事？！</h2><ul class=""><li id="2a87" class="nb nc hu it b iu mb iy mc jc ol jg om jk on jo ng nh ni nj dt translated"><strong class="it hv"> @RunWith </strong>注释:告诉IDE哪个类将运行这个测试类</li><li id="76e4" class="nb nc hu it b iu nk iy nl jc nm jg nn jk no jo ng nh ni nj dt translated"><strong class="it hv"> @Config </strong>注释:是Robolectric库的一部分，配置测试环境。</li><li id="eb6f" class="nb nc hu it b iu nk iy nl jc nm jg nn jk no jo ng nh ni nj dt translated">阴影(shadows):帮助类插入Robolectric，并提供测试新功能，如Snackbar。</li></ul><p id="f364" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">之后，正如我之前在设置方法中提到的，我们准备测试需要的东西，然后是我认为非常容易理解的测试方法！</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div class="fe ff li"><img src="../Images/dc2a9817888e258546e857df4ac256fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*fGOLr9fKa4PX9zjs650Bsg.gif"/></div></figure><p id="55be" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不要忘记运行这个测试非常简单，不需要仿真器！它也位于测试文件夹中(jUnit测试位置！)这意味着它不是androidTest。</p></div><div class="ab cl lp lq hc lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h1 id="c119" class="jr js hu bd jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko dt translated">使用espresso的UI测试示例:</h1><p id="fe29" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">我相信一个完美的地方，你会得到你所有努力的结果，用MVP写你的代码，会出现在用espresso的UI测试中。</p><p id="4fd3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在为你的应用程序编写测试时，你不负责测试API调用结果，所以没有必要调用网络。使用Dagger的一些技巧，你将在任何地方注入被模仿的API模块！！！</p><h2 id="ced2" class="mh js hu bd jt mi mj mk jx ml mm mn kb jc mo mp kf jg mq mr kj jk ms mt kn mu dt translated">让我们再解释一下用匕首嘲讽:</h2><p id="f5af" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">首先看一下<em class="jp">app</em><strong class="it hv">build . gradle</strong>文件，找到这行代码:</p><pre class="lj lk ll lm fq nx ny nz oa aw ob dt"><span id="1b00" class="mh js hu ny b fv oc od l oe of">/* replaced with custom MockTestRunner */<br/>testInstrumentationRunner "com.mirhoseini.marvel.MarvelTestRunner"</span></pre><p id="d8ab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是类“<strong class="it hv"> AndroidJUnitRunner </strong>”，它已经被e自定义测试运行器所取代。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div class="fe ff oo"><img src="../Images/f115b838af91be74db487f0f826ea540.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/1*rJoQjuocN7i63CqRiG-Icg.gif"/></div></figure><h2 id="c5a0" class="mh js hu bd jt mi mj mk jx ml mm mn kb jc mo mp kf jg mq mr kj jk ms mt kn mu dt translated"><a class="ae jq" href="https://github.com/mohsenoid/marvel/blob/master/app/src/androidTest/java/com/mirhoseini/marvel/MarvelTestRunner.java" rel="noopener ugc nofollow" target="_blank"> MarvelTestRunner </a>里面有什么？</h2><figure class="lj lk ll lm fq ln"><div class="bz el l di"><div class="nv nw l"/></div></figure><p id="fcb9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个类的要点是用<a class="ae jq" href="https://github.com/mohsenoid/marvel/blob/master/app/src/androidTest/java/com/mirhoseini/marvel/MarvelTestApplication.java" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">MarvelTestApplication</strong></a>替换<a class="ae jq" href="https://github.com/mohsenoid/marvel/blob/master/app/src/main/java/com/mirhoseini/marvel/MarvelApplication.java" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">marvel application</strong></a>类:</p><figure class="lj lk ll lm fq ln"><div class="bz el l di"><div class="nv nw l"/></div></figure><p id="4bd4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个类扩展了<strong class="it hv"> MarvelApplicationImpl </strong>类，这意味着它包含内部的任何内容，但替换了<strong class="it hv"> createComponent </strong>方法，并使用常规方法的<strong class="it hv"> ApiTestModule </strong>。</p><p id="78e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这就是<strong class="it hv"> Dagger </strong>在任何需要的地方注入模拟API类的方式。</p><p id="488a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是<a class="ae jq" href="https://github.com/mohsenoid/marvel/blob/master/app/src/androidTest/java/com/mirhoseini/marvel/activity/MainActivityTest.java" rel="noopener ugc nofollow" target="_blank"> MainActivityTest </a> UI功能测试:</p><figure class="lj lk ll lm fq ln"><div class="bz el l di"><div class="nv nw l"/></div></figure></div><div class="ab cl lp lq hc lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h1 id="5268" class="jr js hu bd jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko dt translated">TL；博士:</h1><p id="7c0b" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">我们将我们的源代码分离到不同的MVP层中，使其易于阅读和维护。像<strong class="it hv">改进</strong>和<strong class="it hv"> RxJava </strong>这样的新库在这方面帮助了我们。我们试图写一个干净的代码，为了一个愉快的结局，当你想写一个测试而不考虑网络连接或API调用结果来测试UI或代码功能的另一部分时，所有这些努力都出现了。</p><p id="a5b8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在不久的将来，当你想添加一个新的功能时，你会从所有这些努力中受益，每个人都会很高兴。:)</p><h1 id="ca8e" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">那是一个包裹</h1><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div class="fe ff op"><img src="../Images/1be56e642ee80ee73dd97ee359cf9940.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/1*9gkLglUD9NZUuCLU1tcg8Q.gif"/></div></figure><p id="8326" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请从GitHub 克隆<a class="ae jq" href="https://github.com/mohsenoid/marvel" rel="noopener ugc nofollow" target="_blank">项目回购，如果你认为我们可以改进这个样本项目，请告诉我。</a></p><p id="52d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我期待着你的拉请求和意见。</p><p id="0b13" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你觉得这篇文章有用就分享吧，关注我更多文章<a class="oq or gr" href="https://medium.com/u/6a4ed0c4dd2c?source=post_page-----15c638182706--------------------------------" rel="noopener" target="_blank"> Mohsen Mirhoseini </a>。</p><div class="kp kq fm fo kr ks"><a href="http://mirhoseini.info" rel="noopener  ugc nofollow" target="_blank"><div class="kt ab ej"><div class="ku ab kv cl cj kw"><h2 class="bd hv fv z el kx eo ep ky er et ht dt translated">Mohsen Mirhoseini -高级Android开发人员</h2><div class="kz l"><h3 class="bd b fv z el kx eo ep ky er et ek translated">我是一名资深Android开发人员，在计算机软件工程领域有大约九年的经验。我有…</h3></div><div class="la l"><p class="bd b gc z el kx eo ep ky er et ek translated">mirhoseini.info</p></div></div></div></a></div><div class="lj lk ll lm fq ab cb"><figure class="os ln ot ou ov ow ox paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="os ln ot ou ov ow ox paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="os ln ot ou ov ow ox paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mv mw mx"><p id="f922" class="ir is jp it b iu iv iw ix iy iz ja jb my jd je jf mz jh ji jj na jl jm jn jo hn dt translated">黑客中午是黑客如何开始他们的下午。我们是这个家庭的一员。我们现在<a class="ae jq" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jq" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is jp it b iu iv iw ix iy iz ja jb my jd je jf mz jh ji jj na jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jq" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jq" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="fe ff oy"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="lj lk ll lm fq ln"><div class="bz el l di"><div class="oz nw l"/></div></figure></div></div>    
</body>
</html>