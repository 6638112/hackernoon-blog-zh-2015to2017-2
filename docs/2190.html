<html>
<head>
<title>Keeping Exceptions Exceptional — How we learned to filter meaningful exceptions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保持异常的异常性——我们如何学习过滤有意义的异常</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/keeping-exceptions-exceptional-how-we-learned-to-filter-meaningful-exceptions-4265e3d7d151?source=collection_archive---------12-----------------------#2017-01-11">https://medium.com/hackernoon/keeping-exceptions-exceptional-how-we-learned-to-filter-meaningful-exceptions-4265e3d7d151?source=collection_archive---------12-----------------------#2017-01-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/997e10d1e5a7ba8b52a2eadd502fe328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5wrxngwEZQGq-s-hFlTHVQ.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">“These are not the exceptions you’re looking for…”</figcaption></figure><p id="cce4" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">作为一家致力于客户成功的公司，我们必须尽快发现并解决问题，最好是在客户注意到之前<em class="ke">。编写完美的代码可能是不可能的，但是在我们的代码中捕捉异常以免影响客户是每个开发人员努力的目标。</em></p><p id="da86" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">安装异常跟踪器是尽早发现问题的第一步。然而，在报告每个错误的<em class="ke">和报告重要的异常之间有很大的区别。如果你曾经上过心理学入门课程，你可能听说过“<a class="ae kf" href="https://www.youtube.com/watch?v=vJG698U2Mvo" rel="noopener ugc nofollow" target="_blank">选择性注意力</a>和“<a class="ae kf" href="https://en.wikipedia.org/wiki/Inattentional_blindness" rel="noopener ugc nofollow" target="_blank">疏忽性失明</a>”，心理学家研究当几个刺激同时出现时，人类大脑如何选择专注于某些刺激。在Olark 这里，我们发现，如果没有一个经过微调的异常报告和处理过程，我们有时很难从噪音中挑出信号。</em></p><p id="a1d2" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">根据我们的实时错误跟踪器<a class="ae kf" href="https://sentry.io/welcome/" rel="noopener ugc nofollow" target="_blank"> Sentry </a>，我们每分钟记录<strong class="ji hv"> 91个事件。对于一家初创公司来说，很容易陷入推动其平台向前发展的忙乱中，并挥手赶走可能在后台堆积的长尾错误。面对如此多的刺激，我们发现自己把注意力转移到了别处。</strong></p><p id="d42b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">幸运的是，我们知道每分钟91个事件中的大多数不会直接影响我们的客户，但这仍然不够理想。作为开发人员，我们知道我们可以做得更好，并使我们的错误跟踪器成为我们调试过程中的一个有用工具，以及代码质量的一个体面标志。</p><p id="ce49" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们决定深入研究，看看我们能做些什么来将我们的注意力重新引回到有意义的异常上。</p><p id="3d72" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">以下是我们的发现:</p><figure class="kg kh ki kj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/076188ca23090fc77ace344f846a8b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kwrlzR_BfBPKpGHznfrTNw.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">See no exceptions, hear no exceptions, speak no exceptions…</figcaption></figure><h1 id="500b" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated"><strong class="ak">我们记录了太多错误</strong></h1><p id="54cf" class="pw-post-body-paragraph jg jh hu ji b jj li jl jm jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd hn dt translated"><a class="ae kf" href="https://docs.sentry.io/learn/quotas/#quotas-filtering" rel="noopener ugc nofollow" target="_blank">限速</a>是一件大事。当我们遇到停机时间，并且每个人都遇到相同的问题时，真的没有必要收到数百个报告相同异常的通知。但是，如果您记录了如此多的不相关异常，以至于经常受到速率限制，那么您就有可能意外地过滤掉唯一的异常。</p><p id="f5cb" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们决定，这个项目成功的主要衡量标准是降低我们的比率限制例外的百分比。我们观察了一些重量级选手:每月投掷数千次的例外。真的有什么问题吗？我们是否恰当地抛出了一个错误，如果是，为什么我们如此频繁地抛出它们？我们能不能用另一种方法，比如提前返回，来摆脱工作流程呢？</p><p id="289d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">最终我们决定我们<em class="ke">正在</em>适当地抛出错误。我们有几个例子，比如输入错误的电子邮件或信用卡信息，其中一个错误是有保证的，但一个例外不是。问题不在于我们<em class="ke">抛出</em>错误，问题在于我们<em class="ke">将这些错误作为异常进行报告</em>。通过减少我们报告的异常数量，我们为重要的异常提供了更多的上升空间。</p><h1 id="e86f" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated"><strong class="ak">普通异常</strong></h1><p id="b0e9" class="pw-post-body-paragraph jg jh hu ji b jj li jl jm jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd hn dt translated">幸运的是<a class="ae kf" href="https://docs.sentry.io/clients/" rel="noopener ugc nofollow" target="_blank"> Sentry客户端</a>给了我们一个默认忽略某些异常的配置设置。我们没有使用一般的“错误”并记录几乎所有的错误，而是开始对所有的错误进行子类化，只记录我们认为最想知道的错误(例如服务器错误)。</p><p id="c326" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们还发现了另一种清除一些无意义异常的潜在方法。默认情况下，Sentry安装了一个全局错误处理程序，它将捕获浏览器中的任何错误，包括与我们的网站无关的错误，例如浏览器扩展异常。Sentry允许选择忽略来自某些URL的异常，或者将一些URL列入白名单，以便专门监听。我们创建了一个名为Lumberjane的npm包，其中包含我们所有前端应用程序的忽略设置，这有助于减少噪音。</p><p id="948d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在成功地忽略了这些预期的错误，并把我们的注意力集中在真正的异常上之后，我们的统计数据开始迅速提高。很快，我们只在停机期间受到速率限制，当我们查看Sentry时，我们实际上发现了以前没有见过的新异常，这些异常揭示了我们已经在调查的问题。</p><h1 id="6cea" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated"><strong class="ak">缺少上下文</strong></h1><p id="294c" class="pw-post-body-paragraph jg jh hu ji b jj li jl jm jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd hn dt translated">调查几周前的异常可能会很棘手。我们通常每天多次部署代码。除非您非常熟悉某个特定的错误，否则如果您的部署已经超过几天了，那么就需要进行一些认真的挖掘，以找出哪个部署是bug的来源。幸运的是，这是一个简单的修复，因为<a class="ae kf" href="https://docs.sentry.io/api/releases/post-project-releases/" rel="noopener ugc nofollow" target="_blank"> Sentry的发布特性</a>会用git commit标记每个异常。</p><p id="bd2f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们也没有充分利用Sentry允许用额外的上下文标记异常的事实，例如用户id或电子邮件。通过确保我们附加这些种类的相关细节，可以更容易地看到有多少和什么类型的客户受到给定异常的影响，更好的是，如果我们注意到任何相关的情况，允许我们直接跟踪客户。</p><h1 id="7465" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated"><strong class="ak">有时异常的上下文不可读</strong></h1><p id="b6be" class="pw-post-body-paragraph jg jh hu ji b jj li jl jm jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd hn dt translated">即使我们知道有问题发生，我们的前端开发人员经常发现自己茫然地盯着缩小的代码。缩小代码有助于快速加载应用程序，但人眼几乎看不到。</p><p id="7503" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">此外，在我们的暂存环境中，我们的前端异常甚至更加神秘，因为Sentry无法访问我们受VPN保护的文件。我们所要做的就是在一个巨大的串联javascript文件中的某个地方发生了异常。</p><p id="10d3" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">幸运的是，Sentry允许我们<a class="ae kf" href="https://docs.sentry.io/clients/javascript/sourcemaps/" rel="noopener ugc nofollow" target="_blank">将源地图</a>直接上传到他们的服务器。通过这个过程，我们可以看到相关文件作为堆栈跟踪的一部分，就像我们编写代码时一样，没有经过混合，也没有从ES6或Coffeescript传输。</p><h1 id="2ed6" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated"><strong class="ak">我们还没有定义一个清晰的策略来区分低严重性异常的优先级</strong></h1><p id="6fa2" class="pw-post-body-paragraph jg jh hu ji b jj li jl jm jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd hn dt translated">最后但同样重要的是过程问题。虽然高严重性异常很容易证明从项目中花费时间来工作是合理的，但是作为一个团队，我们并不总是知道如何处理低严重性错误。虽然Olark作为一家公司对工程师在他们认为重要的事情上的工作给予了高度信任，但作为一名工程师，并不总是很容易知道在低严重性的错误上付出了多少努力。我发现对于艰难的决定，我倾向于推迟。我们可以在几个小时内解决掉的小bug只会呆在队列中，队列看起来越来越令人生畏。</p><p id="6c06" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们仍在测试哪种流程最适合我们团队和整个公司。我们正在尝试的一个想法是，除了日常工作之外，每周给每个开发人员分配一个bug进行调查。这是我们自己可能会做的量，但通过这种方式，这是一个正式的过程，也是对关注小土豆的许可和鼓励。</p><p id="cdc5" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">通过识别这些问题并研究处理这些问题的最佳实践，我们已经从每分钟91个事件减少到每分钟1–3个事件，从几乎总是被Sentry限制速率，到只有在实际停机时才被限制速率。我们肯定还可以做出改进，我们还在学习，但我们已经在创建支持工程师构建高质量代码的基础架构和流程方面取得了长足的进步，这有望为我们的客户带来更轻松、更流畅的体验。</p><p id="4e59" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">关于作者:</strong> <a class="ae kf" href="https://twitter.com/SarahsZingers" rel="noopener ugc nofollow" target="_blank">莎拉·辛格</a>是Olark的一名回调处理员。她住在纽约，喜欢科幻小说，喜欢在城市中长途跋涉，并志愿让纽约市的科技场景变得更棒。</p></div><div class="ab cl ln lo hc lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hn ho hp hq hr"><h2 id="4f1b" class="lu kl hu bd km lv lw lx kq ly lz ma ku jr mb mc ky jv md me lc jz mf mg lg mh dt translated">想看更多这样的文章？</h2><div class="mi mj fm fo mk ml"><a href="https://blog.olark.com/how-a-saas-company-evolves-its-front-end-tech-stack" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab ej"><div class="mn ab mo cl cj mp"><h2 class="bd hv fv z el mq eo ep mr er et ht dt translated">一家SaaS公司如何发展其前端技术堆栈</h2><div class="ms l"><h3 class="bd b fv z el mq eo ep mr er et ek translated">如果你在过去几年中做过任何类型的前端工程工作，你很可能会被…</h3></div><div class="mt l"><p class="bd b gc z el mq eo ep mr er et ek translated">blog.olark.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz ja ml"/></div></div></a></div><div class="mi mj fm fo mk ml"><a href="https://blog.olark.com/guarding-against-social-engineering-attacks" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab ej"><div class="mn ab mo cl cj mp"><h2 class="bd hv fv z el mq eo ep mr er et ht dt translated">有效使用Olark API:防范社会工程攻击</h2><div class="ms l"><h3 class="bd b fv z el mq eo ep mr er et ek translated">我们的朋友马修·哈里斯是sendwithus的创始人。他最近为Venturebeat写了一篇关于社交…</h3></div><div class="mt l"><p class="bd b gc z el mq eo ep mr er et ek translated">blog.olark.com</p></div></div><div class="mu l"><div class="na l mw mx my mu mz ja ml"/></div></div></a></div><div class="kg kh ki kj fq ab cb"><figure class="nb iv nc nd ne nf ng paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nb iv nc nd ne nf ng paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nb iv nc nd ne nf ng paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nh ni nj"><p id="f922" class="jg jh ke ji b jj jk jl jm jn jo jp jq nk js jt ju nl jw jx jy nm ka kb kc kd hn dt translated"><a class="ae kf" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kf" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kf" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kf" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jg jh ke ji b jj jk jl jm jn jo jp jq nk js jt ju nl jw jx jy nm ka kb kc kd hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kf" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kf" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kg kh ki kj fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nn"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>