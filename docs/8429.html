<html>
<head>
<title>What do I do in between re:Invent live streams? Build Lambda functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我该做些什么:发明实时流？构建Lambda函数</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/what-do-i-do-in-between-re-invent-live-streams-build-lambda-functions-5447c641d397?source=collection_archive---------17-----------------------#2017-12-01">https://medium.com/hackernoon/what-do-i-do-in-between-re-invent-live-streams-build-lambda-functions-5447c641d397?source=collection_archive---------17-----------------------#2017-12-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/40335b3b1cb4b76215beba9320bde326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lobOTyAHN1GMIAgYpRw2cQ.jpeg"/></div></div></figure><p id="1ccf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">今年我没能参加re:Invent，但我确实想在直播间隙做点好事，特别是围绕<a class="ae ka" href="https://hackernoon.com/tagged/serverless" rel="noopener ugc nofollow" target="_blank">无服务器</a>计算和<a class="ae ka" href="https://hackernoon.com/tagged/aws" rel="noopener ugc nofollow" target="_blank"> AWS </a> Lambda。</p><blockquote class="kb kc kd"><p id="0492" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">Lambda让您无需提供或管理服务器就能运行代码。您只需为您消耗的计算时间付费，当您的代码不运行时，则不收费。有了Lambda，你可以为几乎任何类型的应用程序或后端服务运行代码——所有这些都无需管理。只需上传你的代码，Lambda就会为你的代码提供高可用性的运行和扩展。</p></blockquote><p id="dd43" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">上面来自<a class="ae ka" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS </a>的片段很好地解释了Lambda的目标是什么！</p><p id="e4f1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了开发你的无服务器功能，你可以使用许多不同的应用程序框架，但是你知道Flogo是其中之一吗？使用Project Flogo，您可以通过Flogo对AWS Lambda的一流支持来拥抱无服务器计算。无限缩放Flogo的超轻功能，不使用时将其缩放回零。</p><p id="7e83" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在我的上一篇文章<a class="ae ka" href="https://hackernoon.com/deploying-flogo-apps-to-kubernetes-43a74742e323" rel="noopener ugc nofollow" target="_blank">中，我写了如何将这些超轻的Flogo应用部署到Kubernetes，以便在一个最强大的容器管理平台上管理您的微服务。在本文中，我想更进一步，将它们部署在一个功能即服务平台AWS Lambda上。</a></p><h1 id="3e16" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">先决条件</h1><p id="0beb" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">开始之前，我们需要考虑几个先决条件:</p><ul class=""><li id="ccec" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lq lr ls lt dt translated">你需要安装Docker</li><li id="c905" class="ll lm hu je b jf lu jj lv jn lw jr lx jv ly jz lq lr ls lt dt translated">如果你想图形化地创建你的微服务，你需要安装最新版本的Project Flogo Web UI(谁不想呢？):<code class="eh lz ma mb mc b">docker run -it -p 3303:3303 flogo/flogo-docker eula-accept</code></li><li id="e4dc" class="ll lm hu je b jf lu jj lv jn lw jr lx jv ly jz lq lr ls lt dt translated">您需要安装<a class="ae ka" href="https://github.com/TIBCOSoftware/flogo-cli#installation" rel="noopener ugc nofollow" target="_blank"> Flogo CLI </a></li><li id="d615" class="ll lm hu je b jf lu jj lv jn lw jr lx jv ly jz lq lr ls lt dt translated">你显然需要一个AWS账户:)</li></ul><h1 id="ca82" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">该应用程序</h1><p id="f711" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">在Project Flogo最新版本的Web UI中，有许多新东西(Lambda触发器就是其中之一)。但没有改变的是，我们将从创建新的微服务开始，并在其中创建新的流程。</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff md"><img src="../Images/b819c3557c9d47ff6a1c00f796a80025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DuQ1NQ865ANkFm2iWhEByA.png"/></div></div></figure><p id="c81b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在您点击流之后，您将会看到一个全新的外观和感觉来为您的流建模。流和触发器已经分离，因此流现在与函数的概念非常一致。作为开发人员，您可以专注于业务逻辑，而不用担心基础设施:)</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff md"><img src="../Images/1cd5a1245ac273125a8adb5fc9f54eae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RKBD39wNhOo2j-1udaudig.png"/></div></div></figure><p id="3a52" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以点击左边的'+'号来添加一个新的触发器'<em class="ke"> Start Flow作为Lambda </em>中的一个函数。这允许您的流作为Lambda中的函数运行。我们现在不需要任何流参数，但是我们确实想在日志中看到一些东西，所以让我们添加一个'<em class="ke">日志消息</em>活动</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff md"><img src="../Images/04d3f1ec001d3f6da74b8f0c341be4b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tbFricVy96tKVIWQdwFGDg.png"/></div></div></figure><h1 id="375d" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">为Lambda建造</h1><p id="1eb2" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">要为Lambda构建一个应用程序，您需要首先使用“导出应用程序”功能从Web UI导出流。从终端窗口执行</p><pre class="me mf mg mh fq mi mc mj mk aw ml dt"><span id="5951" class="mm kj hu mc b fv mn mo l mp mq">flogo create -f &lt;appname&gt;.json lambda<br/>cd lambda</span></pre><p id="b1de" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">上面的命令将创建一个名为'<em class="ke"> lambda </em>'的新文件夹，并获取运行您的流所需的所有依赖项。对于Lambda，我们希望构建一个应用程序，将配置嵌入到可执行文件中，并使用一个填充程序来指示构建过程使用Lambda触发器覆盖应用程序的入口点。<code class="eh lz ma mb mc b">-shim</code>的参数表示用作流程(函数)入口点的触发器ID。AWS Lambda触发器利用makefile启动构建过程，构建过程发生在docker容器中(因此docker是先决条件),因为在编写时，Go plugins(。所以文件)只能在Linux上构建。所以要构建execute:</p><pre class="me mf mg mh fq mi mc mj mk aw ml dt"><span id="af57" class="mm kj hu mc b fv mn mo l mp mq">flogo build -e -shim start_flow_as_a_function_in_lambda</span></pre><p id="81cd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">该命令将在本地提取docker映像“eawsy/AWS-Lambda-go-shim:latest ”,并构建部署到AWS Lambda所需的zip文件。该命令成功完成后，zip文件(handler.zip)将位于您的应用程序目录中(例如`/ path/to/app/lambda/src/lambda/handler . zip `)。</p><h1 id="8fdb" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">上传到AWS Lambda</h1><p id="c714" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">在Lambda控制台中，您可以创建一个新函数，重要的是运行时设置为'<em class="ke"> Python 2.7 </em>'(生成的shim包含一个Python可执行函数，该函数反过来触发流)。</p><figure class="me mf mg mh fq iv"><div class="bz el l di"><div class="mr ms l"/></div></figure><p id="d001" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ke">正如你可能已经在直播中看到的，AWS刚刚宣布支持Go，所以请继续关注原生触发器！</em></p><p id="1d32" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">点击创建按钮后，你会看到一个全新的Lambda函数。从“<em class="ke">代码输入类型</em>”下拉菜单中，您需要选择“<em class="ke">上传一个. zip文件</em>”，选择刚刚生成的ZIP，并将处理程序设置为“处理程序”。“处理”(没有它，你将无法触发你的心流)。您可以保留其他默认设置，并点击橙色的“<em class="ke">保存</em>按钮。要查看您的工作流，发送一个测试事件并检查CloudWatch日志</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/3ffe3644b04a7b450b6603c315fcc03b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hjBZHG4H4_b72pZvMs139w.png"/></div></div></figure><h1 id="9660" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">结论</h1><p id="58bd" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">这是一个运行在AWS Lambda上的非常简单的Flogo应用程序，但是您可以使用Project Flogo作为运行在Lambda上的微服务框架来做非常酷的事情！如果你想自己开始，只要按照上面的步骤，让我们知道你最终建立了什么。</p><figure class="me mf mg mh fq iv"><div class="bz el l di"><div class="mu ms l"/></div></figure></div></div>    
</body>
</html>