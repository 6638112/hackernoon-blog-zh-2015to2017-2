<html>
<head>
<title>Downloadable Fonts for Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android可下载字体</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/downloadable-fonts-for-android-2041235f91e6?source=collection_archive---------7-----------------------#2017-12-20">https://medium.com/hackernoon/downloadable-fonts-for-android-2041235f91e6?source=collection_archive---------7-----------------------#2017-12-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="ee1a" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated"><strong class="ak">使用支持库探索可下载字体&amp; Android Studio </strong></h2></div><p id="d815" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我最近很高兴地使用了新支持的<a class="ae kf" href="https://developer.android.com/guide/topics/ui/look-and-feel/downloadable-fonts.html" rel="noopener ugc nofollow" target="_blank">可下载字体</a>功能，这是在<a class="ae kf" href="https://hackernoon.com/tagged/android" rel="noopener ugc nofollow" target="_blank"> Android </a> Oreo中引入的，当时我将<a class="ae kf" href="https://winnie.com" rel="noopener ugc nofollow" target="_blank"> Winnie的</a>字体从Roboto改为Lato。</p><p id="64c6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">随着XML中的<a class="ae kf" href="https://developer.android.com/guide/topics/ui/look-and-feel/fonts-in-xml.html#using-support-lib" rel="noopener ugc nofollow" target="_blank">字体，支持库26引入了对可下载字体的支持，向后兼容到API 14。历史上，使用自定义字体通常需要使用第三方库，所以很高兴看到Android框架本身提供了更多支持。</a></p><div class="kg kh ki kj fq ab cb"><figure class="kk kl km kn ko kp kq paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><img src="../Images/736ba7ea70cda1c1a14e455b3d93642e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ZPci7LpsRzf-HzJXtoBooA.png"/></div></figure><figure class="kk kl km kn ko kp kq paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><img src="../Images/acad99cf782140318dd1758ef3ca389b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ewBTszW17F7Stib37FV9zA.png"/></div><figcaption class="kx ky fg fe ff kz la bd b be z ek lb di lc ld">Roboto to the left, Lato to the right.</figcaption></figure></div><h1 id="77bf" class="le lf hu bd lg lh li lj lk ll lm ln lo ja lp jb lq jd lr je ls jg lt jh lu lv dt translated"><strong class="ak">什么是可下载字体，为什么使用它？</strong></h1><p id="ac81" class="pw-post-body-paragraph jj jk hu jl b jm lw iv jo jp lx iy jr js ly ju jv jw lz jy jz ka ma kc kd ke hn dt translated">可下载字体允许应用程序从字体提供商应用程序请求字体，而不是将字体文件包含在apk中或自己下载。字体提供商应用程序检索字体并将其缓存在本地，以便其他应用程序可以请求和共享字体。多酷啊！</p><figure class="kg kh ki kj fq kl fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/a6581ee7fc73ecb8479d5c367f190a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*FFDZr9bcywHd_Jposd7fgQ.png"/></div><figcaption class="kx ky fg fe ff kz la bd b be z ek">Image credit: <a class="ae kf" href="https://developer.android.com/guide/topics/ui/look-and-feel/downloadable-fonts.html" rel="noopener ugc nofollow" target="_blank">https://developer.android.com/guide/topics/ui/look-and-feel/downloadable-fonts.html</a></figcaption></figure><p id="b6bd" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Google Play服务(在版本11以上的设备上)就是一个这样的字体提供者，我用它作为Lato的<a class="ae kf" href="https://fonts.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌字体</a>。如果您要使用Google Play服务中没有的自定义字体，目前还没有关于如何实现您自己的字体提供程序的文档，但是您可以使用XML字体，这仍然比以前有所改进！</p><p id="d7ec" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如上图所示，使用可下载字体的应用程序使用<a class="ae kf" href="https://developer.android.com/reference/android/provider/FontsContract.html" rel="noopener ugc nofollow" target="_blank">Font contract</a>API发出<a class="ae kf" href="https://developer.android.com/reference/android/support/v4/provider/FontRequest.html" rel="noopener ugc nofollow" target="_blank"> FontRequest </a>，该API从字体提供商处检索<a class="ae kf" href="https://hackernoon.com/tagged/typeface" rel="noopener ugc nofollow" target="_blank">字样</a>。如果字体缓存中已经存在字体，则字体提供商不需要下载字体。</p><p id="eb5c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果通过XML使用可下载的字体，开发人员不需要直接使用这些API，这将在下一节详细介绍。</p><p id="2aef" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">使用可下载字体的优势:</strong></p><ul class=""><li id="e1ab" class="mc md hu jl b jm jn jp jq js me jw mf ka mg ke mh mi mj mk dt translated">缩小APK大小——这会显著影响您的应用程序安装<a class="ae kf" rel="noopener" href="/googleplaydev/shrinking-apks-growing-installs-5d3fcba23ce2">！</a></li><li id="d887" class="mc md hu jl b jm ml jp mm js mn jw mo ka mp ke mh mi mj mk dt translated">由于应用程序可以共享来自同一提供商的字体，这导致宝贵的内存、磁盘空间和蜂窝数据的使用量减少。你能猜出现在你手机里有多少Roboto字体文件吗？🙀(是的，有些应用程序的apk中有这些内容)。</li></ul><h1 id="f269" class="le lf hu bd lg lh li lj lk ll lm ln lo ja lp jb lq jd lr je ls jg lt jh lu lv dt translated">太好了，我们开始吧！</h1><p id="3189" class="pw-post-body-paragraph jj jk hu jl b jm lw iv jo jp lx iy jr js ly ju jv jw lz jy jz ka ma kc kd ke hn dt translated">在你的应用中实现可下载字体有三种方式——使用Android Studio和Google Play服务，以编程方式或通过支持库<strong class="jl hv">。</strong>我使用Android Studio生成所需的文件，并使用支持库中的Fonts in XML特性来应用下载的字体。</p><p id="fc01" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我决定通过XML来实现，因为这样你就可以在你的应用清单文件中声明所需的字体，这允许框架提前<strong class="jl hv">下载它们</strong>。如果以编程方式进行，您只能在应用程序启动后请求字体，这可能会导致首次布局时间延迟。此外，通过XML做起来工作量更少！</p><p id="58de" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">1.如果你想使用Android Studio来生成所需的文件，那么你需要3.0+版本。将以下内容(版本26以上)添加到您的模块的build.gradle中:</p><pre class="kg kh ki kj fq mq mr ms mt aw mu dt"><span id="9c1c" class="mv lf hu mr b fv mw mx l my mz">implementation "com.android.support:support-compat:27.0.2"</span></pre><p id="9881" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">2.在应用程序中选择要应用字体的文本视图，然后单击图形布局中属性下的fontFamily属性。</p><figure class="kg kh ki kj fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff na"><img src="../Images/cfdef73dd9f621dc0d1e5e34f86e7cca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gp6vq5EhuRpCqDnSq4Fvew.png"/></div></div></figure><p id="21f4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">选择底部的“更多字体…”将打开下面的对话框。</p><figure class="kg kh ki kj fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff nb"><img src="../Images/87f939d44901b0e84a78b9bf4a92d378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oIGWr1Cuqzrfh9GLtmcUlw.png"/></div></div></figure><p id="0be7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">3.确保选择了“创建可下载字体”。这会导致下载三个文件— lato.xml、font_certs.xml和preloaded_fonts.xml。</p><p id="4f53" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv"> lato.xml <br/></strong></p><pre class="kg kh ki kj fq mq mr ms mt aw mu dt"><span id="1640" class="mv lf hu mr b fv mw mx l my mz">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;font-family xmlns:app="http://schemas.android.com/apk/res-auto"<br/>        app:fontProviderAuthority="com.google.android.gms.fonts"<br/>        app:fontProviderPackage="com.google.android.gms"<br/>        app:fontProviderQuery="Lato"<br/>        app:fontProviderCerts="@array/com_google_android_gms_fonts_certs"&gt;<br/>&lt;/font-family&gt;</span></pre><p id="cf71" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv"> font_certs.xml <br/> </strong>系统使用这些证书来验证字体提供者的身份，以避免从未知来源获取字体。如果使用上面的步骤，Android Studio应该已经在下面的font_certs.xml中为dev和prod自动生成了字符串证书。</p><pre class="kg kh ki kj fq mq mr ms mt aw mu dt"><span id="77a0" class="mv lf hu mr b fv mw mx l my mz">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;resources&gt;<br/>    &lt;array name="com_google_android_gms_fonts_certs"&gt;<br/>        &lt;item&gt;@array/com_google_android_gms_fonts_certs_dev&lt;/item&gt;<br/>        &lt;item&gt;@array/com_google_android_gms_fonts_certs_prod&lt;/item&gt;<br/>    &lt;/array&gt;<br/>    &lt;string-array name="com_google_android_gms_fonts_certs_dev"&gt;<br/>        &lt;item&gt;<br/>         &lt;!-- string cert --&gt;<br/>        &lt;/item&gt;<br/>    &lt;/string-array&gt;<br/>    &lt;string-array name="com_google_android_gms_fonts_certs_prod"&gt;<br/>        &lt;item&gt;<br/>         &lt;!-- string cert--&gt;   <br/>        &lt;/item&gt;<br/>    &lt;/string-array&gt;<br/>&lt;/resources&gt;</span></pre><p id="e53c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv"> preloaded-fonts.xml <br/></strong></p><pre class="kg kh ki kj fq mq mr ms mt aw mu dt"><span id="f4c7" class="mv lf hu mr b fv mw mx l my mz">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;resources&gt;<br/>    &lt;array name="preloaded_fonts" translatable="false"&gt;<br/>        &lt;item&gt;@font/lato&lt;/item&gt;<br/>        &lt;item&gt;@font/lato_bold&lt;/item&gt;<br/>    &lt;/array&gt;<br/>&lt;/resources&gt;</span></pre><p id="c1aa" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">4.确保将这一行添加到应用程序的清单文件中，Android Studio应该已经自动完成了:</p><pre class="kg kh ki kj fq mq mr ms mt aw mu dt"><span id="39fe" class="mv lf hu mr b fv mw mx l my mz">&lt;meta-data<br/>    android:name="preloaded_fonts"<br/>    android:resource="@array/preloaded_fonts"/&gt;</span></pre><p id="d3f6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv"> 5。太好了，现在您可以在XML中应用字体了！</strong></p><pre class="kg kh ki kj fq mq mr ms mt aw mu dt"><span id="3afd" class="mv lf hu mr b fv mw mx l my mz">&lt;style name="AppTheme" parent="Theme.AppCompat.Light.NoActionBar"&gt;<br/>    &lt;item name="colorPrimary"&gt;@color/colorPrimary&lt;/item&gt;<br/>    ....<br/>    <strong class="mr hv">&lt;item name="android:fontFamily"&gt;@font/lato&lt;/item&gt;</strong><br/>&lt;/style&gt;</span></pre><p id="c4b4" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我所要做的就是在应用程序的主题中设置<strong class="jl hv">字体系列，让整个应用程序的文本视图变为Lato，包括粗体或斜体部分。但是，如果您想要配置权重，可以按照相同的步骤使用Android Studio获得Lato Bold，并在lato_bold.xml中手动更改权重，然后可以在xml布局中应用该权重:</strong></p><pre class="kg kh ki kj fq mq mr ms mt aw mu dt"><span id="f91c" class="mv lf hu mr b fv mw mx l my mz">app:fontProviderQuery="name=Lato&amp;amp;weight=700" //can modify the weight here</span></pre><p id="2722" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">整件事感觉像魔术一样！但是…</p><h1 id="e4f8" class="le lf hu bd lg lh li lj lk ll lm ln lo ja lp jb lq jd lr je ls jg lt jh lu lv dt translated">逮到你了</h1><p id="4c38" class="pw-post-body-paragraph jj jk hu jl b jm lw iv jo jp lx iy jr js ly ju jv jw lz jy jz ka ma kc kd ke hn dt translated">当使用支持库26时，我注意到整个应用程序的工具栏仍然在Roboto中，导致了一个可怕的Roboto-Lato组合！即使在XML中显式设置工具栏的fontFamily也不起作用。这是因为工具栏<a class="ae kf" rel="noopener" href="/google-design/the-android-developers-guide-to-better-typography-97e11bb0e261">不像TextView那样实现fontFamily属性</a>。</p><p id="d88f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">将字体系列包含在XML样式中，并将其设置为工具栏的应用程序:titleTextAppearance成功了——工具栏标题现在是Lato！好消息是，这似乎是<a class="ae kf" href="https://issuetracker.google.com/issues/68308866" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hv">在支持库27 </strong> </a>中修复的，所以应该不需要这个变通办法。</p><p id="f2fc" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">还有几个地方没有应用Lato一个是我使用粗体样式动态创建文本视图，另一个是底部导航视图，我使用了第三方库。我最初认为这可以达到目的:</p><pre class="kg kh ki kj fq mq mr ms mt aw mu dt"><span id="cf2e" class="mv lf hu mr b fv mw mx l my mz">val typeface = ResourcesCompat.<em class="nc">getFont</em>(this, R.font.<em class="nc">lato</em>)</span><span id="16d6" class="mv lf hu mr b fv nd mx l my mz">//for the third-party bottom navigation view<br/>bottomNavigationView.setDefaultTypeface(typeface)</span><span id="2b0b" class="mv lf hu mr b fv nd mx l my mz">//for the bolded text view<br/>textView.setTypeface(textView.getTypeface(), Typeface.<em class="nc">BOLD</em>)</span></pre><p id="a80d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我使用了<a class="ae kf" href="https://developer.android.com/reference/android/support/v4/content/res/ResourcesCompat.html#getFont(android.content.Context, int)" rel="noopener ugc nofollow" target="_blank">resources compat . get font()</a>方法来加载字体并在两个视图上设置它，瞧，再也没有Roboto了！然而，在使用这种方法为底部导航设置字体时，我看到了一个<strong class="jl hv"> ResourcesNotFound异常</strong>。</p><p id="066b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">本质上，如果在调用该方法时字体还没有加载，或者用户没有所需版本的Google Play服务，就会抛出这个异常。如果无法通过XML设置样式，避免这种情况的最安全方法是以编程方式加载字体。<a class="ae kf" href="https://developer.android.com/guide/topics/ui/look-and-feel/downloadable-fonts.html#via-support-lib" rel="noopener ugc nofollow" target="_blank">这里的</a>是关于如何做的官方文档。</p><p id="3b2f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在27.0.2中还有<a class="ae kf" href="https://issuetracker.google.com/issues/69085400" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hv">这个崩溃</strong> </a> <strong class="jl hv"> </strong>与<strong class="jl hv"/>fontscontractcompt，它已经在支持库的未来版本中得到修复，在26.1.0中似乎不是问题</p><p id="5e74" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">值得注意的其他要求和限制:</p><ul class=""><li id="e114" class="mc md hu jl b jm jn jp jq js me jw mf ka mg ke mh mi mj mk dt translated">你的compileSDK至少应该是SDK 26，如果要用Android Studio生成字体文件，应该是<strong class="jl hv">3.0版+ </strong>。如果以编程方式或使用XML中的字体来应用可下载的字体，则必须至少使用Support Library 26。</li><li id="0834" class="mc md hu jl b jm ml jp mm js mn jw mo ka mp ke mh mi mj mk dt translated">使用Google Play服务<strong class="jl hv"> </strong>作为字体提供者可以在安装了<strong class="jl hv">版本11 </strong>及更高版本的设备上工作，否则它将使用默认的系统字体。</li><li id="140d" class="mc md hu jl b jm ml jp mm js mn jw mo ka mp ke mh mi mj mk dt translated">如前所述，如果您使用的是Google Play服务中没有的自定义字体，您可能无法使用可下载的字体。在这种情况下，你可能不得不<strong class="jl hv">编写你自己的自定义FontProvider </strong>，它还没有文档。</li></ul><p id="f462" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我(惊讶地)喜欢将我们的<a class="ae kf" href="https://winnie.com/android" rel="noopener ugc nofollow" target="_blank">应用</a>从Roboto转换到Lato，这要感谢XML字体&amp;可下载字体，希望你也喜欢这些功能！我很乐意在评论中或者在<a class="ae kf" href="https://twitter.com/anitas3791" rel="noopener ugc nofollow" target="_blank">推特</a>上听到你的声音，别忘了👏帖子:)。</p><figure class="kg kh ki kj fq kl"><div class="bz el l di"><div class="ne nf l"/></div></figure></div></div>    
</body>
</html>