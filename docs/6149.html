<html>
<head>
<title>Secrets, Secrets Boy They’re Fun 🙊</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">秘密，秘密男孩他们很有趣🙊</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/secrets-secrets-boy-theyre-fun-61a62ca575ed?source=collection_archive---------17-----------------------#2017-09-05">https://medium.com/hackernoon/secrets-secrets-boy-theyre-fun-61a62ca575ed?source=collection_archive---------17-----------------------#2017-09-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/acdf5305077dd1436037a540670a8dc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_kSuO2vSc3-e-iAxgT0nA.png"/></div></div></figure><blockquote class="jc"><p id="80c3" class="jd je hu bd jf jg jh ji jj jk jl jm ek translated">还记得你小时候吗？</p><p id="2825" class="jd je hu bd jf jg jn jo jp jq jr jm ek translated">你可能有一个疯狂的戒指，让你发送秘密信息给你的朋友。</p></blockquote><figure class="jt ju jv jw jx iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff js"><img src="../Images/529351f3d63612fc5756b6c942483f5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*oi218qLZNbfyrhUNNSH5Lw.gif"/></div></div></figure><p id="b044" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">你写给朋友的秘密信息并不是真正的秘密，但知道其他人不知道你在说什么是新奇和有趣的。</p><p id="e55c" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">这些环被称为解码器环，使用简单的凯撒密码替代。通过旋转字母表，赋予每个字母一个新的值，就可以得到秘密字符。你的信息在有30分钟空闲时间的人手里很容易被破解，让他们有能力阅读你所有的信息。</p><figure class="kw kx ky kz fq iv fe ff paragraph-image"><div class="fe ff kv"><img src="../Images/c1bad66c60c07af5adaea517f08bb578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*J7egROyuwsQS-lIqSNZJEA.png"/></div></figure><p id="94ce" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">这种怀旧的感觉促使我开发一个chrome扩展，对你的脸书信息进行端到端的加密。这不仅有趣，而且安全。</p><h1 id="c062" class="la lb hu bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">什么是端到端加密？</h1><p id="557f" class="pw-post-body-paragraph jy jz hu ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku jm hn dt translated">端到端加密意味着您的邮件在离开您的计算机之前是完全加密的。这使得当你的信息被发送到服务器时，人们不能窃取它们。这也意味着你使用的信息平台不能阅读你的信息。我喜欢认为任何时候离开你的电脑就像离开你的房子一样。你不会光着身子出去吧？给你的留言穿上衣服！</p><figure class="kw kx ky kz fq iv fe ff paragraph-image"><div class="fe ff md"><img src="../Images/0e8b2cf9e4209ef5ffe5946da30657d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZuQ43svXWjPvMHmBjdj4EA.jpeg"/></div></figure><p id="ad3a" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">加密你的信息会把它变成一串天书:</p><pre class="kw kx ky kz fq me mf mg mh aw mi dt"><span id="0b29" class="mj lb hu mf b fv mk ml l mm mn"><strong class="mf hv">Original Message:</strong><br/>This is a secret!</span><span id="c0a3" class="mj lb hu mf b fv mo ml l mm mn"><strong class="mf hv">Encrypted Message:</strong><br/>MyjDqDUIATABEiEFwoMPwqvChMKkV3gUL8KKYsKKcDXDq2zDhsOUcsKuw7/CvhYmw4wdGkzDmiDCk0QaIQXCvsOMOkARwoJrEWDDrFkCYwfCnx7DrS8zwoPDkcOwLxQCFMOuw6fCnsOSw6MBIlIzCiEFF8OhwoNQeQEkw74CwqbCiiDDjnoHwpYgTMKwwrtvwofCqA42w4/DqWI7QikNEAAYACIgwrMXwp0/w7DDusOHTMOXwp3Co0XDr8K1KcO5wpROwr7DhsKUU8ONwr4jw4wiwptSDzXDs1vDssKOwr42H8Kawo0=</span></pre><p id="6c82" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">太好了！我怀疑没人能看懂。</p><p id="02a4" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">然而…你的朋友需要能够读懂它😝</p><h1 id="90fe" class="la lb hu bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">不对称加密</h1><p id="abac" class="pw-post-body-paragraph jy jz hu ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku jm hn dt translated">如果你想让你的朋友能够打开你的信息，他们需要这把锁的钥匙。如果是我们的锁，我们可以把钥匙寄给他们！但是……我们不想只给他们钥匙，对吗？因为这样有人就能偷到钥匙并解开我们的信息😵那我们该怎么办？</p><p id="b3f8" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">我们可以通过使用“非对称加密”来解决这个问题。</p><p id="208a" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">这样想吧…当你想发送你的信息时，向<strong class="ka hv">他们</strong>要一把锁。他们应该是唯一有这把锁钥匙的人。现在你锁了发了，只有你朋友能打开，你不用交换任何钥匙。</p><p id="6865" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">使用非对称加密，您要处理成对的公钥和私钥。公钥可以被认为是打开的锁，可以自由地分发给你所有的朋友。私有密匙是真正的密匙，应该在一个安全的地方高度保密。</p><figure class="kw kx ky kz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mp"><img src="../Images/ed572a795c9749ad31193a6c5265b201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zwki4CjSzPdfuiZPxVzBWg.png"/></div></div></figure><h1 id="bba7" class="la lb hu bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">入侵脸书的消息api</h1><p id="58a3" class="pw-post-body-paragraph jy jz hu ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku jm hn dt translated">为了发送加密信息，我们需要知道如何发送普通信息。这是通过脸书传递信息所需的核心信息:</p><ol class=""><li id="a1e3" class="mq mr hu ka b kb kc kf kg kj ms kn mt kr mu jm mv mw mx my dt translated">您朋友的脸书用户ID ( <code class="eh mz na nb mf b">RECIPIENT_ID</code>)</li><li id="60da" class="mq mr hu ka b kb nc kf nd kj ne kn nf kr ng jm mv mw mx my dt translated">唯一的消息ID ( <code class="eh mz na nb mf b">MESSAGE_ID</code>)</li><li id="3796" class="mq mr hu ka b kb nc kf nd kj ne kn nf kr ng jm mv mw mx my dt translated">一枚<code class="eh mz na nb mf b">fb_dtsg</code>令牌(<code class="eh mz na nb mf b">TOKEN</code></li><li id="d0d8" class="mq mr hu ka b kb nc kf nd kj ne kn nf kr ng jm mv mw mx my dt translated">一块饼干作为你的凭证(<code class="eh mz na nb mf b">C_USER</code> + <code class="eh mz na nb mf b">XS</code>)</li></ol><p id="25dc" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">通过检查Facebook Messenger的网络活动，可以轻松获取收件人ID、<code class="eh mz na nb mf b">fb_dtsg</code>令牌和cookie。</p><figure class="kw kx ky kz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nh"><img src="../Images/9ff5333f4f15a32bda43459fadfff771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0IruKemKUwE1h5-INahddQ.png"/></div></div></figure><p id="a3c4" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated"><strong class="ka hv">注意:</strong>打开网络面板后你还要发消息。</p><p id="cb9f" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">另一方面，消息id必须是唯一的。如果消息id冲突，那么该消息将永远不会出现。</p><p id="371b" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">脸书是如何生成id的？</p><pre class="kw kx ky kz fq me mf mg mh aw mi dt"><span id="b57c" class="mj lb hu mf b fv mk ml l mm mn"><strong class="mf hv">message_id: </strong>6306169721153220898<br/><strong class="mf hv">timestamp: </strong>1503508024490</span></pre><p id="0f52" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">我发现message_id除以时间戳等于4，194，304。这恰好是2的幂或者确切地说是2的幂。脸书将时间戳向左移动22位，并用随机数填充空位。</p><figure class="kw kx ky kz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ni"><img src="../Images/d91e5c7a7686885413ca2bc7915a453b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pmVlHBq-Exhw_y5klGcnBg.png"/></div></div></figure><p id="93d8" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">下面是一个发送消息的cURL命令示例:</p><pre class="kw kx ky kz fq me mf mg mh aw mi dt"><span id="2a56" class="mj lb hu mf b fv mk ml l mm mn">curl '<a class="ae nj" href="https://www.messenger.com/messaging/send/'" rel="noopener ugc nofollow" target="_blank">https://www.messenger.com/messaging/send/'</a> \<br/>-H "cookie: \<br/>    c_user=<strong class="mf hv">C_USER</strong>; \<br/>    xs=<strong class="mf hv">XS</strong>;" \<br/>-d "action_type=0\<br/>&amp;   body=My message.\<br/>&amp;   has_attachment=false\<br/>&amp;   message_id=<strong class="mf hv">MESSAGE_ID</strong>\<br/>&amp;   offline_threading_id=<strong class="mf hv">MESSAGE_ID</strong>\<br/>&amp;   other_user_fbid=<strong class="mf hv">RECIPIENT_ID</strong>\<br/>&amp;   source=0\<br/>&amp;   timestamp=0\<br/>&amp;   fb_dtsg=<strong class="mf hv">TOKEN</strong>"</span></pre><p id="7dfc" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated"><strong class="ka hv">注意:</strong>一定要用自己的值替换<code class="eh mz na nb mf b">C_USER</code>、<code class="eh mz na nb mf b">XS</code>、<code class="eh mz na nb mf b">MESSAGE_ID</code>、<code class="eh mz na nb mf b">RECIPIENT_ID</code>、<code class="eh mz na nb mf b">TOKEN</code>。<em class="nk">(出于测试目的，在最后发送的</em> <code class="eh mz na nb mf b"><em class="nk">MESSAGE_ID</em></code> <em class="nk">上加1是安全的)</em></p><h1 id="5dea" class="la lb hu bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">Chrome扩展！</h1><p id="cb3f" class="pw-post-body-paragraph jy jz hu ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku jm hn dt translated">既然我们可以发送消息，我们需要一个实际的接口。Chrome扩展给了你巨大的力量。您可以完全控制任何网站。你可以重构html，操纵css，甚至注入脚本。如果用户在Facebook Messenger上，你可以窃取他们的cookies，并确定他们正在与哪个用户交谈。这正是我们所需要的。</p><figure class="kw kx ky kz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ni"><img src="../Images/78ede1f9173511cb9095913323b58b59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h_SicMs3OgrzhhlGcaO7oA.png"/></div></div></figure><p id="ce52" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">如果你有一些web编程的经验，构建一个扩展是很容易的。这就像建立一个网站，在网站之上。如果没有，不用担心，Google有一个非常全面的构建扩展的<a class="ae nj" href="https://developer.chrome.com/extensions/getstarted" rel="noopener ugc nofollow" target="_blank">演练</a>，以及一些有用的示例项目。</p><p id="9d14" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">由于我不想把它变成chrome扩展的教程，所以我会把这个项目的<a class="ae nj" href="https://github.com/bourdakos1/Phat-Emoji" rel="noopener ugc nofollow" target="_blank">源代码</a>留给你。(如果您需要更多帮助，请随时联系我)</p><p id="e6ee" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">要运行您的扩展，请按照下列步骤操作:</p><ol class=""><li id="2565" class="mq mr hu ka b kb kc kf kg kj ms kn mt kr mu jm mv mw mx my dt translated">在浏览器中访问<code class="eh mz na nb mf b">chrome://extensions</code></li><li id="2ad0" class="mq mr hu ka b kb nc kf nd kj ne kn nf kr ng jm mv mw mx my dt translated">确保右上角的<strong class="ka hv">开发者模式</strong>复选框被选中。</li><li id="6788" class="mq mr hu ka b kb nc kf nd kj ne kn nf kr ng jm mv mw mx my dt translated">点击<strong class="ka hv">加载解压后的扩展名</strong>弹出文件选择对话框。</li><li id="5076" class="mq mr hu ka b kb nc kf nd kj ne kn nf kr ng jm mv mw mx my dt translated">导航到您的扩展文件所在的目录，并选择它。</li></ol><h1 id="3a80" class="la lb hu bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">使用库和一些权衡</h1><p id="8a73" class="pw-post-body-paragraph jy jz hu ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku jm hn dt translated">如前所述，我们需要使用某种形式的非对称加密。在处理安全性问题时，使用经过实战检验的库是一个好主意。据我所知，<a class="ae nj" href="https://github.com/WhisperSystems/libsignal-protocol-javascript" rel="noopener ugc nofollow" target="_blank"> WhisperSystems的信号协议</a>是信息加密的首选。它为实现自由留下了很大的空间，因为Signal只是一个协议。这种自由让我们处理一些权衡。</p><h2 id="0066" class="mj lb hu bd lc nl nm nn lg no np nq lk kj nr ns lo kn nt nu ls kr nv nw lw nx dt translated">阅读你自己的信息</h2><p id="87b3" class="pw-post-body-paragraph jy jz hu ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku jm hn dt translated">为收件人加密邮件时，加密方式是只有对方的私钥才能解密您的邮件。即使是你也无法解密这条信息。</p><p id="0aa4" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">如果你想阅读自己的信息，有几种方法。一种方法是加密两次，一次给你，一次给收件人。这有点慢，因为我们必须将所有内容加密两次。也不太安全。推荐的方法是将解密的消息存储在客户端本地。</p><h2 id="c55d" class="mj lb hu bd lc nl nm nn lg no np nq lk kj nr ns lo kn nt nu ls kr nv nw lw nx dt translated">向前渐进</h2><p id="2e90" class="pw-post-body-paragraph jy jz hu ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku jm hn dt translated">该协议建议对您发送的每条消息使用唯一的公钥。这保持了旧消息的保密性。如果你的私钥泄露了，只有一条消息会被泄露，而不是整个对话。但是，这意味着您只能解密一次消息。</p><p id="905e" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">这就需要在服务器上存储一批<strong class="ka hv">密钥。如果用户用完了公钥，他们就不能接收消息。也就是说，如果有人离线，他们只有100把钥匙，我们只能给他们发100条消息，直到他们重新上线。</strong></p><p id="b019" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">一个可能的折中方案是每x小时生成一个新密钥。这样用户就可以一直发送消息，多次解密，我们一次只需要在服务器上存储一个密钥。</p><h1 id="a663" class="la lb hu bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">最后的想法</h1><p id="3eb7" class="pw-post-body-paragraph jy jz hu ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku jm hn dt translated">这个项目一直是一个疯狂的过山车，远远没有完成。如果你对项目背后的代码感兴趣，可以在这里抓取<a class="ae nj" href="https://github.com/bourdakos1/Phat-Emoji" rel="noopener ugc nofollow" target="_blank">，在这里</a>查看实际的扩展<a class="ae nj" href="https://chrome.google.com/webstore/detail/phat-emoji/ognoiiipkkmdmihiinbpdfjbfncekbhj" rel="noopener ugc nofollow" target="_blank">。玩得开心，有创意，继续黑客！</a></p></div><div class="ab cl ny nz hc oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="hn ho hp hq hr"><p id="97a0" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">感谢阅读！如果您有任何问题，请随时联系bourdakos1@gmail.com，通过<a class="ae nj" href="https://www.linkedin.com/in/nicholasbourdakos" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我，或者通过<a class="ae nj" rel="noopener" href="/@bourdakos1"> Medium </a>和<a class="ae nj" href="https://twitter.com/bourdakos1" rel="noopener ugc nofollow" target="_blank"> Twitter </a>关注我。</p><p id="f27b" class="pw-post-body-paragraph jy jz hu ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku jm hn dt translated">如果你觉得这篇文章很有帮助，请给我一些掌声👏并分享给朋友。</p></div></div>    
</body>
</html>