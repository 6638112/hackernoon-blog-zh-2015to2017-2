<html>
<head>
<title>Identifying users in Alexa skills</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Alexa技能中识别用户</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/identifying-users-in-alexa-skills-ff189d03ed1d?source=collection_archive---------4-----------------------#2017-01-16">https://medium.com/hackernoon/identifying-users-in-alexa-skills-ff189d03ed1d?source=collection_archive---------4-----------------------#2017-01-16</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="63d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从新年前夜开始，我就一直在开发一个定制的Alexa技能，作为我的“周末项目”。这是一个非常简单的应用程序，可以跟踪房子里的人的名单。</p><p id="279f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">目前，我有一个非常简单的名字列表<a class="ae jp" href="https://hackernoon.com/my-alexa-skill-with-storage-5adb1d097b88" rel="noopener ugc nofollow" target="_blank">存储在DynamoDB </a>中，但如果我要让这个应用程序对其他任何人可用，我需要为每个用户维护一个单独的列表。</p><h1 id="483e" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">这是哪个用户？</h1><p id="0a47" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">每次我的Lambda函数被调用时，它都会传递一些描述请求的<a class="ae jp" href="https://developer.amazon.com/public/solutions/alexa/alexa-skills-kit/docs/alexa-skills-kit-interface-reference" rel="noopener ugc nofollow" target="_blank">JSON</a>。这包括一个会话对象，其中包含三个有用的标识符</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/229a8487c929a26942406a36dc5773eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zhm5_C_Wuzeci-1KrJvZ2A.png"/></div></div><figcaption class="lf lg fg fe ff lh li bd b be z ek">Get the Application ID for your skill from the developer console</figcaption></figure><p id="bfcb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">应用ID </strong>标识发出请求的Alexa技能。Lambda函数应该检查它是否发送了它期望的应用程序ID，以确保它没有被某种意外的东西调用。您可以从Amazon开发人员控制台的技能信息中获得应用程序ID。</p><p id="495f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当你调用一个Alexa技能时，你开始一个会话，由…你猜对了，一个<strong class="it hv">会话ID </strong>标识。如果你愿意，你可以在Lambda函数的响应中包含会话属性形式的信息，当它在同一个会话中被再次调用时，你将得到相同的会话ID和包含在请求JSON中的属性。</p><p id="7e90" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后还有一个<strong class="it hv">用户ID </strong>。我将使用用户ID作为一个键来标识每个用户家中不同的人员列表。</p><h2 id="8e92" class="lj jr hu bd js lk ll lm jw ln lo lp ka jc lq lr ke jg ls lt ki jk lu lv km lw dt translated">一个新的DynamoDB表</h2><p id="3757" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">我将使用用户ID作为我的Dynamo表中的<a class="ae jp" href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithTables.html#WorkingWithTables.primary.key" rel="noopener ugc nofollow" target="_blank">分区键，使用房子里的人的名字作为排序键。</a></p><p id="9967" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">至少现在，它不会支持两个同名同姓的人住在同一个房子里，但我认为现在这样就可以了。最小可行的产品等等。</p><p id="817d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您不能修改现有Dynamo表的键，所以我创建了一个新表，名为“WhoIsInTheHouses”。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff lx"><img src="../Images/b0270be9ebad93e6b9aae9c4e9636174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FvOB64tlvT__TMNspdeXuw.png"/></div></div></figure><h2 id="0146" class="lj jr hu bd js lk ll lm jw ln lo lp ka jc lq lr ke jg ls lt ki jk lu lv km lw dt translated">读取和写入新表</h2><p id="b2cb" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">我需要在我的Lambda函数中引用这个新表。(如果你是第一次接触这个系列的文章——是的，亲爱的读者，我在Lambda代码中使用的是Python而不是Node.js。是允许的！)</p><pre class="ku kv kw kx fq ly lz ma mb aw mc dt"><span id="8f4d" class="lj jr hu lz b fv md me l mf mg">table = dynamodb.Table('WhoIsInTheHouses')</span></pre><p id="69cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的添加和删除名字的函数应该接受用户ID和名字。</p><pre class="ku kv kw kx fq ly lz ma mb aw mc dt"><span id="43e8" class="lj jr hu lz b fv md me l mf mg">def add_name(userID, name):<br/>    try:<br/>        response = table.put_item(<br/>           Item={<br/>                'UserID': userID,<br/>                'Name': name<br/>            }<br/>        ) <br/>    except ClientError as e:<br/>        print(e.response)<br/>        return e.response['Error']['Code']        <br/>        <br/>    return None</span><span id="7507" class="lj jr hu lz b fv mh me l mf mg">def delete_name(userID, name):<br/>    try:<br/>        response = table.delete_item(<br/>           Key={<br/>                'UserID': userID,<br/>                'Name': name<br/>            }<br/>        )    <br/>    except ClientError as e:<br/>        print(e.response)<br/>        return e.response['Error']['Code']</span><span id="fc3f" class="lj jr hu lz b fv mh me l mf mg">return None</span></pre><p id="19bf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们得到一个名字列表时，我们只想得到这个特定用户的名字。以前我通过扫描来获取整个表，但是现在我希望查询只选择具有匹配用户ID的项目。</p><pre class="ku kv kw kx fq ly lz ma mb aw mc dt"><span id="9a76" class="lj jr hu lz b fv md me l mf mg">response = table.query(<br/>        KeyConditionExpression=Key('UserID').eq(userID)<br/>    )</span></pre><h2 id="5950" class="lj jr hu bd js lk ll lm jw ln lo lp ka jc lq lr ke jg ls lt ki jk lu lv km lw dt translated">调用时获取用户ID</h2><p id="8b45" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">如前所述，每次调用Lambda函数时，用户ID都在传递的JSON中，所以很容易得到它。</p><pre class="ku kv kw kx fq ly lz ma mb aw mc dt"><span id="0a73" class="lj jr hu lz b fv md me l mf mg">userID = event['session']['user']['userId']</span></pre><p id="0eff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还有一些额外的简单的改变，我现在不会让你厌烦，把userID传递到任何需要它的地方。</p><h1 id="5633" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">多用户测试</h1><p id="d3e1" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">我可以简单地通过调用我的Alexa技能来检查代码是否正常工作，但这总是会传入我自己的用户ID。为了检查它在公开给其他人时是否工作，我可以使用Lambda函数的测试事件，创建一个用户ID来传入。以下是添加姓名的测试事件的有趣部分:</p><pre class="ku kv kw kx fq ly lz ma mb aw mc dt"><span id="25f3" class="lj jr hu lz b fv md me l mf mg">{<br/>  "session": {<br/>    ...<br/>    "user": {<br/>      "userId": "amzn1.ask.account.a-test-user-ID"<br/>    },<br/>    "application": {<br/>      "applicationId": "amzn1.ask.skill.26c...<br/>    }<br/>  },<br/>  "version": "1.0",<br/>  "request": {<br/>    "locale": "en-UK",<br/>    "timestamp": "2016-10-27T21:06:28Z",<br/>    "type": "IntentRequest",<br/>    "requestId": "amzn1.echo-api.request.[unique-value-here]",<br/>    "intent": {<br/>      "name": "ArrivedInTheHouse",<br/>      "slots": {<br/>        "Name": {<br/>          "name": "Name",<br/>          "value": "Gemma"<br/>        }<br/>      }<br/>    }<br/>  },<br/>  "context": {<br/>      ...<br/>  }<br/>}</span></pre><p id="3d58" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">检查DynamoDB表，我可以看到它已经成功地为带有测试用户ID的Gemma添加了一个条目。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff mi"><img src="../Images/dfc2758569d47138343776363c27e813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F7W_LZcwYsClKob8odMk5A.png"/></div></div></figure><p id="c8fe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我问Alexa谁在房子里，她会告诉我</p><blockquote class="mj"><p id="2d37" class="mk ml hu bd mm mn mo mp mq mr ms jo ek translated">莉兹和菲尔在房子里</p></blockquote><p id="4713" class="pw-post-body-paragraph ir is hu it b iu mt iw ix iy mu ja jb jc mv je jf jg mw ji jj jk mx jm jn jo hn dt translated">但是正确的说没有提到Gemma。因此，我们成功地为每个Alexa用户建立了单独的列表！</p></div><div class="ab cl my mz hc na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="hn ho hp hq hr"><p id="a8b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果其他人对开发Alexa自定义技能感兴趣，请点击那个可爱的绿色心形来帮助他们找到这个帖子！</p><p id="d03c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="nf">我正在认真考虑写一本关于编写Alexa应用程序的书。如果你认为这是个好主意，</em> <a class="ae jp" href="https://leanpub.com/adventureswithalexa" rel="noopener ugc nofollow" target="_blank"> <em class="nf">你的鼓励</em> </a> <em class="nf">将意味深长。</em></p><div class="ku kv kw kx fq ab cb"><figure class="ng ky nh ni nj nk nl paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ng ky nh ni nj nk nl paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ng ky nh ni nj nk nl paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nm nn no"><p id="f922" class="ir is nf it b iu iv iw ix iy iz ja jb np jd je jf nq jh ji jj nr jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿妹家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is nf it b iu iv iw ix iy iz ja jb np jd je jf nq jh ji jj nr jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff ns"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>