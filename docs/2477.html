<html>
<head>
<title>Development of Microservices - Problems and Solutions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微服务的发展——问题与解决方案</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/development-of-microservices-problems-and-solutions-b3ce8f1f7ff1?source=collection_archive---------7-----------------------#2017-01-30">https://medium.com/hackernoon/development-of-microservices-problems-and-solutions-b3ce8f1f7ff1?source=collection_archive---------7-----------------------#2017-01-30</a></blockquote><div><div class="eg hj hk hl hm hn"/><div class="ho hp hq hr hs"><div class=""/><p id="72fe" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">使用<a class="ae jq" href="https://hackernoon.com/tagged/microservices" rel="noopener ugc nofollow" target="_blank">微服务</a>构建应用在一些出版物中有很好的介绍。在这篇文章中，我试图涵盖一些没有得到太多关注的问题，并讨论每个问题的解决方案。尽早关注这些领域将有助于您提高生产率、质量和构建灵活的应用程序。我还将展示它可以节省25%或更多的成本。这些经验是通过在开源平台上工作和与少数客户合作而获得的。</p><p id="9134" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">如果您正在构建基于微服务的<a class="ae jq" href="https://hackernoon.com/tagged/application" rel="noopener ugc nofollow" target="_blank">应用</a>，您会将应用分成几个微服务，并使用各种技术堆栈。根据复杂程度，一个应用可能有5-500个微服务。您可能会混合使用Java、.Net，Python，NodeJS，GO等。基于技术的堆栈。<strong class="iu hw">一个经常被忽略的重要考虑</strong>，开发者如何在开发环境中使用这些服务进行测试。开发人员在个人机器上使用IDE时效率最高。这有助于他们更快地编写和调试代码。在个人机器上运行几个服务来进行调试和单元测试是不切实际的。另一个备受争议的问题是什么“应该和不应该”构成共享代码。人们倾向于不分享。<strong class="iu hw">第三个重要的考虑事项</strong>是创建可重用的服务，这些服务可以通过元数据或脚本获得略有不同的服务的个性。<strong class="iu hw">第四个问题</strong>对于服务器端开发者来说并不重要，但是对于UI开发者来说却很重要。它处理如何将一个大的用户界面分割成更小的部分，独立开发每个部分，并在运行时自动将它们组合在一起。</p><p id="f966" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">在接下来的部分中，我们将深入这四个方面的细节，并讨论如何解决它们。</p><h1 id="84ac" class="jr js hv bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">从开发者的机器上随意连接任何微服务</h1><p id="541b" class="pw-post-body-paragraph is it hv iu b iv kp ix iy iz kq jb jc jd kr jf jg jh ks jj jk jl kt jn jo jp ho dt translated">在运营环境中，您可能会将所有微服务运行在某个地方的私有或公共云上。但由于网络安全原因，开发人员无法接触到它们。即使开发人员可以创建一个到这些服务的安全隧道，这也是大量的工作，而且会分散日常开发的注意力。<strong class="iu hw">打破开发者的专注，他们不得不在开始滚动之前“吃青蛙”。</strong></p><p id="48cb" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">开发人员如何从自己的机器连接到云中的服务？您可能已经猜到了—“我们需要一个服务网关。如果你有的话，太好了！如果没有，那么也许有一天你会建立它，向外界公开你的服务。为什么不现在就做，让你自己的开发者成为API的消费者。这也有助于抽象、理解服务和标准化。拥有网关是不够的，但这是必需的第一步。</p><p id="4f95" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">在这种情况下，网关的目标是向开发人员提供接近部署的环境。要在开发人员的个人机器上创建一个真正的部署环境，您需要考虑的事情很少。为了开发和调试，开发人员在本地运行很少的服务(通常2-3个),并且喜欢连接到云中的rest。因此，这是一个混合了开发者机器和云中的服务的环境。它是通过改变服务端点的IP地址，拉几个代码库或容器来实现的。如果你把它形象化，你就在创造一个环境，一个对每个人来说都是集中可用的环境的微小变化。实现它的最佳方式是什么？</p><p id="1318" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">如果你设计一个轻量级和可配置的轻型网关，最好是通过UI，这是可以实现的。通过UI，开发者可以改变服务的IP地址。如果足够简单的话，开发者可以在本地机器上部署it来协调本地和云服务。下图显示了由此产生的结构。</p><figure class="kv kw kx ky fr kz ff fg paragraph-image"><div class="ff fg ku"><img src="../Images/d1cf3ea124d3400255e1ab055ae70b8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*k8QkbVWzC4NuC1bfGEL9Sg.png"/></div><figcaption class="lc ld fh ff fg le lf bd b be z el">Connecting Local and Remote Microservices using Gateway</figcaption></figure><p id="70bb" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">您会发现几个创造性地重用上述gateway设计的用例。让我们再举一个例子。如果您正在开发一个使用单点登录(SSO)的应用程序，您可以使用operational environment来获取访问令牌，并在本地机器和远程云上运行服务的混合环境中使用它。我打算稍后在一个独立的博客中讨论这个问题。</p><h1 id="d0d7" class="jr js hv bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">微服务之间的代码共享</h1><p id="55b6" class="pw-post-body-paragraph is it hv iu b iv kp ix iy iz kq jb jc jd kr jf jg jh ks jj jk jl kt jn jo jp ho dt translated">微服务架构的好处之一是一个服务的变化不会引起连锁反应。因此，我们的想法是让它们完全独立于彼此之间的代码变化。但这并不意味着你不应该共享代码。这可能意味着您需要对共享代码进行适当的版本管理。共享代码可以进化。但是使用它的服务可以决定是否迁移到新版本。事实上，这就是我们使用开源代码的方式。您将在您的微服务中使用几个开源库。没有理由你不能以同样的方式对待你自己的共享代码。</p><p id="b887" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">分享永远不会出错。假设您有10个可能使用“X”公共代码的服务。最糟糕的情况是，当你不共享时，所有代码都会多出10倍。你从分享“X”的版本1开始。“X”移到了版本2。只有3项服务会迁移到“X 2.0”。你仍然会有很多代码共享。您还可以拥有多层共享库。如果不需要，一些服务可能会绕过更高层。下图显示了代码共享和不共享情况下的代码分层。如果你适当地计划代码共享，它是一个大赢家。</p><figure class="kv kw kx ky fr kz ff fg paragraph-image"><div class="ff fg lg"><img src="../Images/ed9500cd7a0a520408604f97ca3d6cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*R8_Er1Xb59zUz2jHfhRYJg.png"/></div><figcaption class="lc ld fh ff fg le lf bd b be z el">Depiction of Code Sharing and Not Sharing Options</figcaption></figure><p id="ea63" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">您可以在以下领域寻找共享代码:</p><ol class=""><li id="3555" class="lh li hv iu b iv iw iz ja jd lj jh lk jl ll jp lm ln lo lp dt translated"><strong class="iu hw">实用程序函数— </strong>实用程序的几个例子是字符串处理函数、使用正则表达式的通用函数、通用域专用实用程序、通用数据结构、域专用但可重复用作模板的数据结构、数据验证代码、文件读写代码等。</li><li id="e04a" class="lh li hv iu b iv lq iz lr jd ls jh lt jl lu jp lm ln lo lp dt translated"><strong class="iu hw">数据库API </strong> —考虑将CRUD、查询、分页编写为通用库，这些库可以将模式作为输入。您可以在所有实体中标准化一些基本属性，如id、名称、友好名称、版本、状态标志等。使用模式文件，您可以定义属性的元属性，如唯一性、类型等。公共代码可以基于元数据实现逻辑。</li><li id="0240" class="lh li hv iu b iv lq iz lr jd ls jh lt jl lu jp lm ln lo lp dt translated"><strong class="iu hw">通用算法</strong> —接收输入、处理并返回输出的无状态函数或方法。这些算法可以跨服务共享。少数例子是排序、决策树、通用规则。</li><li id="6bb4" class="lh li hv iu b iv lq iz lr jd ls jh lt jl lu jp lm ln lo lp dt translated"><strong class="iu hw">日志</strong> —如果您想保留插入不同开源库的选项，可以使用通用日志包装器。</li><li id="bfef" class="lh li hv iu b iv lq iz lr jd ls jh lt jl lu jp lm ln lo lp dt translated"><strong class="iu hw">安全相关API </strong> —安全数据验证、检查权限等是常见安全功能的示例。</li><li id="3ff7" class="lh li hv iu b iv lq iz lr jd ls jh lt jl lu jp lm ln lo lp dt translated">经验法则——四处询问，“有没有我可以重用或贡献的代码？”这是开源模式，你不会出错。</li></ol><h1 id="4f4f" class="jr js hv bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">可配置和可编程的服务</h1><p id="2c9d" class="pw-post-body-paragraph is it hv iu b iv kp ix iy iz kq jb jc jd kr jf jg jh ks jj jk jl kt jn jo jp ho dt translated">在计算机软件中有很多机会，有些东西是另一些东西的变体。在微服务的情况下，您也可以找到一个共同点，并将其作为一个通用代码，可以称为“模板服务”。如果你遵循一个数据驱动的设计，那么它可以使用元数据和一些可插入的脚本变成一个特例。例如，假设您有一个名为<em class="lv">订单服务</em>的服务。它可能会保存数据库中的数据。有一个<em class="lv">发货服务</em>也在同一个数据库中保存数据。您可以提取出通用代码作为<em class="lv">持久性服务</em>，它将模式和可插入代码作为输入。另一个选择是部署为三个服务:I)订单服务，ii)客户服务和iii)持久性服务。如果你使用的是NoSQL数据库而不是RDBMS，那么数据驱动的持久服务设计会更容易。但是在每种情况下你都可以这样做。您可能会发现这种设计的其他好处。例如，在这种特殊情况下，它将应用程序逻辑与数据库逻辑分离开来；数据库专家可以独立于业务服务对其进行优化。这只是一个例子，在你的情况下可能不太可能。但是总的想法是，如果你能把基础设施比如代码从多个服务中抽出来放到模板服务中，那么就要认真考虑它。这并不明显。一旦你习惯了元数据和脚本编程模型，你将开始看到一些这样的机会。我打算在另一篇文章中更详细地讨论这个问题。</p><figure class="kv kw kx ky fr kz ff fg paragraph-image"><div class="ff fg lw"><img src="../Images/711d955f0289adc6737a1d81edefdeb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*oi0uT1Pj74j-gyPslyAcSg.png"/></div><figcaption class="lc ld fh ff fg le lf bd b be z el">Template Microservice — Programmable using Metadata and Plug-ins</figcaption></figure><h1 id="a86c" class="jr js hv bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">WEB层和将UI分解成更小的部分</h1><p id="2552" class="pw-post-body-paragraph is it hv iu b iv kp ix iy iz kq jb jc jd kr jf jg jh ks jj jk jl kt jn jo jp ho dt translated">谨慎的做法是开发纯HTML、JavaScript和CSS的多设备WEB UI，并且不使用任何服务器端库进行渲染。很有可能你已经在做了。在服务器端，它只需要用所需的JS，CSS提供一个准系统的HTML页面。UI使用安全层或网关连接到服务。在大型UI的情况下，你可以把它分成功能组件，让团队独立开发。让我们把每个功能组件称为<strong class="iu hw">【微应用】</strong>。您可以将每个微应用程序开发为一个HTML页面，同时避免在部署集成应用程序时重新加载。</p><p id="3409" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">让我们看看服务器为一个微应用程序提供的HTML页面。它将包含以下内容。</p></div><div class="ab cl lx ly hd lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ho hp hq hr hs"><p id="a956" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv"> &lt; html &gt; </em></p><p id="b30c" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv"> &lt;表头&gt; </em></p><p id="f988" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv">加载开源css </em></p><p id="4c62" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv">加载通用css(所有微应用通用)</em></p><p id="7037" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv">加载针对微应用的CSS</em></p><p id="b768" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv">&lt;/表头&gt; </em></p><p id="d898" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv">正文&lt;正文&gt;正文</em></p><p id="694e" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv">大部分是空的，使用模板渲染</em></p><p id="e9b0" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv">&lt;/正文&gt; </em></p><p id="0012" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv">加载开源JS </em></p><p id="5a52" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv">加载通用JS(所有微应用通用)</em></p><p id="be61" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv">加载针对微应用的JS</em></p><p id="3971" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated"><em class="lv">&lt;/html&gt;T1】</em></p></div><div class="ab cl lx ly hd lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ho hp hq hr hs"><p id="6490" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">你会注意到变化的部分是微应用特定的CSS、JS和相应的HTML模板。在集成环境中，以前的微应用程序代码可以卸载，新的微应用程序代码可以加载，无需刷新页面。微应用可以由URL来表示，该URL可以将其名称作为URL中的路径。使用适当的WEB服务器设计，您可以使用path在服务器端的准系统HTML页面中插入特定的CSS、JS。为了清晰和模块化，您可以在单独的目录中组织微应用特定的JS、CSS、HTML模板。这在UI端分解您的应用程序，与微服务在服务器端的方式非常相似。</p><figure class="kv kw kx ky fr kz ff fg paragraph-image"><div class="ff fg me"><img src="../Images/82653c4a62005a5ca4508c317fec5a99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*7EyCas3CxAnsRLO8wjJsUw.png"/></div><figcaption class="lc ld fh ff fg le lf bd b be z el">Decomposition of a Large UI as Micro-Applications</figcaption></figure><h1 id="4e8d" class="jr js hv bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">商业利益</h1><p id="78d3" class="pw-post-body-paragraph is it hv iu b iv kp ix iy iz kq jb jc jd kr jf jg jh ks jj jk jl kt jn jo jp ho dt translated">上述考虑带来了显著的商业利益。假设一个开发人员每周花4个小时努力连接服务。在一个有10名开发人员的6个月项目中，这将意味着4个人月，即大约7%。除此之外，沮丧的开发人员以较低的生产率和质量工作，它可以达到10%。如果你有一个在微服务间共享代码的可靠计划，这将带来额外的节省。编写数据驱动的、可编程的服务，并能够在一定程度上采用它们，将提供灵活性，并在短期和长期内节省时间和金钱。随着UI代码的体积增大，它很容易变成意大利面条。你可以通过把UI分解成更小的模块(或者传统WEB app意义上的微应用)来避免。假设其中每一项都有助于节省5%的成本。所有这些加起来占25%。你可以用它来建立高价值的功能，更好的UX或团队奖励。灵活和模块化的代码库也为创新打开了大门。</p><h1 id="7f93" class="jr js hv bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">未来职位</h1><p id="53dc" class="pw-post-body-paragraph is it hv iu b iv kp ix iy iz kq jb jc jd kr jf jg jh ks jj jk jl kt jn jo jp ho dt translated">我打算在单独的帖子中更详细地讨论以下主题。</p><p id="ffc6" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">1.轻量级网关设计</p><p id="ae98" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">2.数据导出、可编程模板服务</p><p id="7a38" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">3.作为微应用的UI分解</p><p id="56c0" class="pw-post-body-paragraph is it hv iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ho dt translated">4.开发安全的微服务</p><div class="kv kw kx ky fr ab cb"><figure class="mf kz mg mh mi mj mk paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mf kz mg mh mi mj mk paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mf kz mg mh mi mj mk paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ml mm mn"><p id="f922" class="is it lv iu b iv iw ix iy iz ja jb jc mo je jf jg mp ji jj jk mq jm jn jo jp ho dt translated"><a class="ae jq" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jq" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jq" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jq" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="is it lv iu b iv iw ix iy iz ja jb jc mo je jf jg mp ji jj jk mq jm jn jo jp ho dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jq" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jq" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kv kw kx ky fr kz ff fg paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="ff fg mr"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="kv kw kx ky fr kz"><div class="bz em l di"><div class="mw mx l"/></div></figure></div></div>    
</body>
</html>