<html>
<head>
<title>Very simple implementation multi thread in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js中非常简单的多线程实现</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/very-simple-implementation-multi-thread-in-node-js-6b02e60fa8b1?source=collection_archive---------10-----------------------#2017-11-03">https://medium.com/hackernoon/very-simple-implementation-multi-thread-in-node-js-6b02e60fa8b1?source=collection_archive---------10-----------------------#2017-11-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="2fbb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们开始用单线程杀死一个<a class="ae jp" href="https://hackernoon.com/tagged/processor" rel="noopener ugc nofollow" target="_blank">处理器</a></p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="1dfc" class="jz ka hu jv b fv kb kc l kd ke">//sync process<br/>function slowSquare(n){<br/> var i = 0;  <br/> while (++i &lt; n * n) {}<br/>}</span><span id="5676" class="jz ka hu jv b fv kf kc l kd ke">slowSquare(100000)<br/>slowSquare(100000)</span></pre><p id="ca6b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh kg kh ki jv b">$time node app.js<br/><strong class="it hv">28.04 secs</strong></code></p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="984b" class="jz ka hu jv b fv kb kc l kd ke">//async process<br/>function slowSquareAsync(){<br/> setTimeout(function(args) {<br/>  let i = 0;  <br/>  let n = 100000<br/>  while (++i &lt; n * n) {} <br/> }, 1) <br/>}</span><span id="25cb" class="jz ka hu jv b fv kf kc l kd ke">slowSquareAsync()<br/>slowSquareAsync()</span></pre><p id="1873" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh kg kh ki jv b">$time node app.js<br/>Waiting too long then I aborted (ctrl+c) after wait about 4mins</code></p><p id="3202" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为什么我的<a class="ae jp" href="https://hackernoon.com/tagged/laptop" rel="noopener ugc nofollow" target="_blank">笔记本电脑</a>会发热？:D</p><figure class="jq jr js jt fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kj"><img src="../Images/c8315390eb6594609dddd880cede9ece.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vosx95ckV9LhE2XexGwPfQ.png"/></div></div></figure><p id="c115" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">读了几篇文章后，我发现了这一点</p><figure class="jq jr js jt fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kj"><img src="../Images/83db4df2d339509f2068bbb9a7a683cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g4mUZ48clcRc2HfmPRewxA.png"/></div></div></figure><p id="921e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后我试着创建一个非常小的模块，我称之为Iyem.js，Iyem在巴哈萨语中的意思是女仆</p><p id="2c67" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将尝试相同的代码，但使用Iyem.js</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="1f67" class="jz ka hu jv b fv kb kc l kd ke">let iyem = require('iyem')</span><span id="4c9e" class="jz ka hu jv b fv kf kc l kd ke">let slowSquareThread = iyem.create(function(){  <br/> var i = 0; <br/> var n = 100000;<br/>    while (++i &lt; n * n) {}<br/>    $.finish(i);  <br/>})<br/>slowSquareThread.start()<br/>slowSquareThread.onFinish(function(result,err){<br/> console.log(result,err) <br/>})</span><span id="da0d" class="jz ka hu jv b fv kf kc l kd ke">function slowSquare(n){<br/> var i = 0;  <br/> while (++i &lt; n * n) {}<br/>}</span><span id="f3ea" class="jz ka hu jv b fv kf kc l kd ke">slowSquare(100000)</span></pre><p id="f79c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh kg kh ki jv b">$time node app.js<br/><strong class="it hv">13.2 secs</strong></code></p><p id="2078" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">哇，酷吧？，让我们尝试更复杂的多线程与线程间的通信(Pub Sub)</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="95e2" class="jz ka hu jv b fv kb kc l kd ke">let iyem = require('iyem')</span><span id="bc4d" class="jz ka hu jv b fv kf kc l kd ke">let importDataReportWorker = iyem.create(function(){  <br/>  const parse = require('parse-csv')<br/>  const fs = require('fs')<br/>  const reconcile = require('./Reconcile')<br/>  parse(fs.readFileSync("./200MB.csv", "utf-8"),function(err,report)<br/>  {<br/>    $.sub("GET_TRX_SETTELMENT_COLLECTION_DONE",function(dataTrx){<br/>      var result = reconcile(report,dataTrx)<br/>      $.finish(result)<br/>   })<br/>  })<br/>})</span><span id="cf35" class="jz ka hu jv b fv kf kc l kd ke">let getTrxCollection = iyem.create(function(){<br/> const db = require('./db')<br/> db.find({transaction_date:"2017-10-10"},function(err,collection){<br/>  if(err) $.error(err)<br/>  $.pub("GET_TRX_SETTELMENT_COLLECTION_DONE",collection)<br/>  $.finish()<br/> })<br/>})</span><span id="8a43" class="jz ka hu jv b fv kf kc l kd ke">getTrxCollection.start()<br/>importDataReportWorker.start().onFinish(function(err,result){<br/> console.log("DONE")<br/> console.log(result)<br/>})</span></pre><p id="658a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这只是实验性的，请给我你的反馈，不要忘记鼓掌或分享</p><div class="kr ks fm fo kt ku"><a href="https://www.npmjs.com/package/iyem" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab ej"><div class="kw ab kx cl cj ky"><h2 class="bd hv fv z el kz eo ep la er et ht dt translated">iyem</h2><div class="lb l"><h3 class="bd b fv z el kz eo ep la er et ek translated">管理多线程Js的简单方法</h3></div><div class="lc l"><p class="bd b gc z el kz eo ep la er et ek translated">www.npmjs.com</p></div></div><div class="ld l"><div class="le l lf lg lh ld li kp ku"/></div></div></a></div><div class="kr ks fm fo kt ku"><a href="https://github.com/lukluk/iyem" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab ej"><div class="kw ab kx cl cj ky"><h2 class="bd hv fv z el kz eo ep la er et ht dt translated">卢克卢克/艾耶姆</h2><div class="lb l"><h3 class="bd b fv z el kz eo ep la er et ek translated">多线程iyem - Nodejs</h3></div><div class="lc l"><p class="bd b gc z el kz eo ep la er et ek translated">github.com</p></div></div><div class="ld l"><div class="lj l lf lg lh ld li kp ku"/></div></div></a></div><h2 id="fe11" class="jz ka hu bd lk ll lm ln lo lp lq lr ls jc lt lu lv jg lw lx ly jk lz ma mb mc dt translated">如果你学到了什么，点击💚来帮助别人找到这篇文章。</h2><figure class="jq jr js jt fq kk"><div class="bz el l di"><div class="md me l"/></div></figure></div></div>    
</body>
</html>