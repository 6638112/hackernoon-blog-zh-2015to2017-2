<html>
<head>
<title>How to get a performance boost using WebAssembly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用WebAssembly提升性能</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-get-a-performance-boost-using-webassembly-8844ec6dd665?source=collection_archive---------2-----------------------#2017-01-12">https://medium.com/hackernoon/how-to-get-a-performance-boost-using-webassembly-8844ec6dd665?source=collection_archive---------2-----------------------#2017-01-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/fa05443bbab2fd2bf0131a5126710388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ZTmD0ujs7A2rUDDFaAf3pA.png"/></div></figure><p id="557f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">新的一年刚刚开始，随之而来的是新的决心要实现。学习如何使用WebAssembly并获得性能提升怎么样？</p><p id="180a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">本文是我们正在撰写关于性能的系列文章的继续，请查看“<a class="ae jw" rel="noopener" href="/developers-writing/how-to-get-a-performance-boost-using-node-js-native-addons-fd3a24719c85">如何使用Node.js原生插件获得性能提升”</a>和“<a class="ae jw" rel="noopener" href="/@devlucky/ruby-time-parsing-optimization-524622354201">通过Ruby time解析优化获得1300%的性能提升！</a>“✌️</p><p id="9f7f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">今天我想向您演示如何创建和使用WebAssembly模块，并在以后从浏览器中使用它们，就像它们是js模块一样。为了做到这一点，我将采用斐波那契算法，我<a class="ae jw" rel="noopener" href="/developers-writing/fibonacci-sequence-algorithm-in-javascript-b253dc7e320e">已经在这里讨论过了</a>，我将测试它作为普通javascript函数和WebAssembly模块运行时的性能。</p><h1 id="5afc" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">履行</h1><p id="303d" class="pw-post-body-paragraph iy iz hu ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hn dt translated">我们将讨论前一篇文章中已经讨论过的3种技术:</p><ul class=""><li id="2728" class="la lb hu ja b jb jc jf jg jj lc jn ld jr le jv lf lg lh li dt translated">环</li><li id="0a88" class="la lb hu ja b jb lj jf lk jj ll jn lm jr ln jv lf lg lh li dt translated">递归</li><li id="85b7" class="la lb hu ja b jb lj jf lk jj ll jn lm jr ln jv lf lg lh li dt translated">记忆化</li></ul><p id="b103" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">以下代码片段涵盖了Javascript和c语言中的这些实现。</p><blockquote class="lo lp lq"><p id="cddb" class="iy iz lr ja b jb jc jd je jf jg jh ji ls jk jl jm lt jo jp jq lu js jt ju jv hn dt translated">java描述语言</p></blockquote><figure class="lv lw lx ly fq iv"><div class="bz el l di"><div class="lz ma l"/></div></figure><blockquote class="lo lp lq"><p id="033a" class="iy iz lr ja b jb jc jd je jf jg jh ji ls jk jl jm lt jo jp jq lu js jt ju jv hn dt translated">C</p></blockquote><figure class="lv lw lx ly fq iv"><div class="bz el l di"><div class="lz ma l"/></div></figure><p id="7dc3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我不会解释这些函数是如何工作的，因为这篇文章不是关于这个的。如果你想了解更多，请查看<a class="ae jw" href="https://en.wikipedia.org/wiki/Fibonacci_number" rel="noopener ugc nofollow" target="_blank">这个</a>T8】或T10这个。</p><h1 id="1801" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">一点历史</h1><ul class=""><li id="aa59" class="la lb hu ja b jb kv jf kw jj mb jn mc jr md jv lf lg lh li dt translated"><strong class="ja hv"> WebAssembly </strong>诞生的前提是创建一个安全、可移植、快速加载和执行的适合web的格式。WebAssembly不是一种编程语言，它是一个既有文本规范又有二进制规范的<strong class="ja hv">编译目标</strong>。这意味着像C/C++、Rust、Swift等低级语言。可以用WebAssembly输出进行编译。它与javascript共享堆栈，这就是它不同于java小程序的原因。此外，它的设计是一个社区的努力，所有的浏览器供应商都在努力。</li><li id="24b2" class="la lb hu ja b jb lj jf lk jj ll jn lm jr ln jv lf lg lh li dt translated"><strong class="ja hv"> Emscripten </strong>是一个LLVM-to-JavaScript编译器。这意味着像C/C++这样的语言或者任何使用LLVM的语言都可以被编译成JavaScript。它提供了一组API来将你的代码移植到网络上，这个项目已经运行了很多年，通常用于将游戏移植到浏览器上。Emscripten实现了它的性能输出<strong class="ja hv"> asm.js </strong>，但是最近它成功地集成了一个WebAssembly编译目标。</li><li id="6cf9" class="la lb hu ja b jb lj jf lk jj ll jn lm jr ln jv lf lg lh li dt translated"><strong class="ja hv"> ASM.js </strong>是<strong class="ja hv"/>Javascript的一个底层优化子集，通过TypedArrays和类型注释进行线性内存访问。同样，它不是一种新的编程语言。任何没有asm.js支持的浏览器在运行asm.js时仍然可以工作，只是没有性能优势。</li></ul><p id="2f84" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">截至<strong class="ja hv">10–01–2017，</strong>目前的状态是在<a class="ae jw" href="https://www.chromestatus.com/features/5453022515691520" rel="noopener ugc nofollow" target="_blank"> Chrome Canary </a>和<a class="ae jw" href="https://hacks.mozilla.org/2016/03/a-webassembly-milestone/" rel="noopener ugc nofollow" target="_blank"> Firefox </a>中以一个特性标志工作，在<a class="ae jw" href="https://webkit.org/status/#specification-webassembly" rel="noopener ugc nofollow" target="_blank"> Safari </a>中正在开发。从V8侧，它只是默认<a class="ae jw" href="https://chromium.googlesource.com/v8/v8/+/34b63f050b1a247bb64ddc91c967501ce04e011f" rel="noopener ugc nofollow" target="_blank">被启用</a>🚀。</p><p id="5689" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这个来自<a class="ae jw" href="https://www.youtube.com/playlist?list=PLNYkxOF6rcIBTs2KPy1E6tIYaWoFcG3uj" rel="noopener ugc nofollow" target="_blank"> Chrome Dev Summit 2016 </a>的视频分享了V8中JavaScript和脚本工具的现状，并讨论了与WebAssembly的未来。</p><figure class="lv lw lx ly fq iv"><div class="bz el l di"><div class="me ma l"/></div></figure><h1 id="c493" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">构建+加载模块</h1><p id="8b54" class="pw-post-body-paragraph iy iz hu ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hn dt translated">让我们看看如何将我们的C程序转换成<a class="ae jw" href="http://webassembly.org/docs/semantics/" rel="noopener ugc nofollow" target="_blank"> wasm </a>。为此，我决定使用<a class="ae jw" href="https://github.com/kripken/emscripten/wiki/WebAssembly-Standalone" rel="noopener ugc nofollow" target="_blank">独立输出</a>，而不是返回。js和WebAssembly将只返回WebAssembly代码，而不包括系统库。</p><p id="8182" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">该方法基于Emscripten的<a class="ae jw" href="https://github.com/kripken/emscripten/wiki/Linking" rel="noopener ugc nofollow" target="_blank">侧模块</a>概念。侧模块在这里是有意义的，因为它是动态库的一种形式，并且不会自动链接到系统库中，它是一个自包含的编译输出。</p><p id="7735" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><code class="eh mf mg mh mi b">$ emcc fibonacci.c -Os -s WASM=1 -s SIDE_MODULE=1 -o fibonacci.wasm</code></p><p id="80eb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">一旦我们有了二进制文件，我们只需要在浏览器中加载它。为此，<a class="ae jw" href="https://github.com/WebAssembly/design/blob/master/JS.md" rel="noopener ugc nofollow" target="_blank"> WebAssembly js api </a>公开了一个顶层对象<strong class="ja hv"> WebAssembly </strong>，它包含了我们需要<a class="ae jw" href="https://github.com/WebAssembly/design/blob/master/JS.md#webassemblycompile" rel="noopener ugc nofollow" target="_blank">编译</a>和<a class="ae jw" href="https://github.com/WebAssembly/design/blob/master/JS.md#webassemblyinstance-constructor" rel="noopener ugc nofollow" target="_blank">实例化</a>模块的方法。下面是一个基于<a class="mj mk gr" href="https://medium.com/u/649eac8108d2?source=post_page-----8844ec6dd665--------------------------------" rel="noopener" target="_blank">Alon Zakai</a>T10】gist的简单方法，它作为通用加载器工作:</p><figure class="lv lw lx ly fq iv"><div class="bz el l di"><div class="lz ma l"/></div></figure><p id="f86e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这里很酷的一点是，一切都是异步发生的。首先，我们获取文件内容，并将其转换成一个<a class="ae jw" href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" rel="noopener ugc nofollow" target="_blank"> ArrayBuffer </a>，其中包含固定长度的原始二进制数据。你不能直接操作它，这就是为什么我们把它传递给<strong class="ja hv"><em class="lr">web assembly . compile</em></strong>，它返回一个<a class="ae jw" href="https://github.com/WebAssembly/design/blob/master/JS.md#webassemblymodule-constructor" rel="noopener ugc nofollow" target="_blank"> WebAssembly。最终可以用<strong class="ja hv"> <em class="lr"> WebAssembly实例化的模块</em></strong></a>。实例。</p><p id="74d9" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果你想更深入地了解这个主题，可以看看WebAssembly使用的<a class="ae jw" href="https://github.com/WebAssembly/design/blob/master/BinaryEncoding.md" rel="noopener ugc nofollow" target="_blank">二进制编码</a>格式。</p><h1 id="7761" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">标杆管理</h1><p id="0b87" class="pw-post-body-paragraph iy iz hu ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hn dt translated">现在是时候看看我们如何使用这个模块，并根据javascript实现测试它的性能了。我们将使用4 <strong class="ja hv"> 0 </strong>作为输入，以与我们在上一篇文章中所做的保持一致:</p><figure class="lv lw lx ly fq iv"><div class="bz el l di"><div class="lz ma l"/></div></figure><blockquote class="lo lp lq"><p id="95a2" class="iy iz lr ja b jb jc jd je jf jg jh ji ls jk jl jm lt jo jp jq lu js jt ju jv hn dt translated">结果(您可以点击查看现场演示<a class="ae jw" href="https://zzarcon.github.io/WebAssembly-demo/" rel="noopener ugc nofollow" target="_blank">)</a></p></blockquote><pre class="lv lw lx ly fq ml mi mm mn aw mo dt"><span id="6536" class="mp jy hu mi b fv mq mr l ms mt">JS loop x 8,605,838 ops/sec ±1.17% (55 runs sampled)<br/>JS recursive x 0.65 ops/sec ±1.09% (6 runs sampled)<br/>JS memoization x 407,714 ops/sec ±0.95% (59 runs sampled)<br/>Native loop x 11,166,298 ops/sec ±1.18% (54 runs sampled)<br/>Native recursive x 2.20 ops/sec ±1.58% (10 runs sampled)<br/>Native memoization x 30,886,062 ops/sec ±1.64% (56 runs sampled)</span><span id="7fe3" class="mp jy hu mi b fv mu mr l ms mt">Fastest: Native memoization<br/>Slowest: JS recursive</span></pre><p id="155f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">有趣的事实:</p><ul class=""><li id="2d6d" class="la lb hu ja b jb jc jf jg jj lc jn ld jr le jv lf lg lh li dt translated">最好的C实现比最好的JS实现快375%。</li><li id="7aa1" class="la lb hu ja b jb lj jf lk jj ll jn lm jr ln jv lf lg lh li dt translated">在C语言中最快的实现是内存化，而在JS中是循环。</li><li id="3f72" class="la lb hu ja b jb lj jf lk jj ll jn lm jr ln jv lf lg lh li dt translated">第二快的C实现仍然比JS更快。</li><li id="9f83" class="la lb hu ja b jb lj jf lk jj ll jn lm jr ln jv lf lg lh li dt translated">最慢的C实现比JS最慢的实现快338倍。</li></ul><h1 id="94c8" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">结论</h1><p id="a6e0" class="pw-post-body-paragraph iy iz hu ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hn dt translated">希望你们喜欢这篇关于WebAssembly的介绍，以及今天你们可以用它做什么。在下一篇文章中，我想介绍非独立模块，从C  JS和Link &amp; Dynamic Linking进行通信的不同技术。</p><p id="127f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">别忘了查看<a class="ae jw" href="http://webassembly.org/roadmap/" rel="noopener ugc nofollow" target="_blank"> WebAssembly路线图</a>和<a class="ae jw" href="https://github.com/kripken/emscripten/blob/master/ChangeLog.markdown" rel="noopener ugc nofollow" target="_blank"> Emscriptend Changelog </a>以了解最新更新以及<a class="ae jw" href="http://webassembly.org/getting-started/developers-guide/" rel="noopener ugc nofollow" target="_blank">入门教程</a>。</p><p id="6843" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">2017快乐🐣</p></div><div class="ab cl mv mw hc mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="hn ho hp hq hr"><figure class="lv lw lx ly fq iv fe ff paragraph-image"><a href="https://twitter.com/zzarcon"><div class="fe ff nc"><img src="../Images/6b953e9462d2c008f93f889bd9b13dad.png" data-original-src="https://miro.medium.com/v2/resize:fit:200/format:webp/1*IYSJU8WP3GmpPQGEUG-3dw.jpeg"/></div></a><figcaption class="nd ne fg fe ff nf ng bd b be z ek">You can follow me on Twitter or Github @zzarcon</figcaption></figure><div class="lv lw lx ly fq ab cb"><figure class="nh iv ni nj nk nl nm paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nh iv ni nj nk nl nm paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nh iv ni nj nk nl nm paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="lo lp lq"><p id="f922" class="iy iz lr ja b jb jc jd je jf jg jh ji ls jk jl jm lt jo jp jq lu js jt ju jv hn dt translated"><a class="ae jw" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jw" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jw" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jw" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="iy iz lr ja b jb jc jd je jf jg jh ji ls jk jl jm lt jo jp jq lu js jt ju jv hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jw" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jw" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lv lw lx ly fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="fe ff nn"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>