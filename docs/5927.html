<html>
<head>
<title>First impressions on Laravel API Resources</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对Laravel API资源的第一印象</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/first-impressions-on-laravel-api-resources-4869b73b7847?source=collection_archive---------3-----------------------#2017-08-24">https://medium.com/hackernoon/first-impressions-on-laravel-api-resources-4869b73b7847?source=collection_archive---------3-----------------------#2017-08-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/dae1995610e51cc0dc4746829888139a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*50EztkjiBhZAJo9fa9jKJw.png"/></div></figure><p id="c7e8" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">昨晚<a class="jw jx gr" href="https://medium.com/u/d694c31ce941?source=post_page-----4869b73b7847--------------------------------" rel="noopener" target="_blank"> Taylor Otwell </a>终于介绍了在Laravel 5.5上开发API时，可以取代<a class="ae jy" href="http://fractal.thephpleague.com/transformers/" rel="noopener ugc nofollow" target="_blank"> Fractal </a>的开端。这是我第一次尝试。</p><p id="679e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">有趣的事情从第4步开始。</p><h2 id="378b" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jj kl km kn jn ko kp kq jr kr ks kt ku dt translated">1-安装clean Laravel 5.5项目</h2><pre class="kv kw kx ky fq kz la lb lc aw ld dt"><span id="0a67" class="ka kb hu la b fv le lf l lg lh">composer create-project laravel/laravel responses dev-develop<br/>cd responses<br/>touch database/database.sqlite<br/>php artisan make:model Post -mfa<br/>php artisan make:resource UsersWithPostsResource<br/>php artisan make:resource PostsResource<br/>php artisan make:controller UsersController --resource</span></pre><p id="bb1c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">将您的<code class="eh li lj lk la b">.env</code>文件改为使用SQLite，并删除所有其他数据库变量。</p><pre class="kv kw kx ky fq kz la lb lc aw ld dt"><span id="8356" class="ka kb hu la b fv le lf l lg lh">DB_CONNECTION=sqlite</span></pre><h2 id="72ad" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jj kl km kn jn ko kp kq jr kr ks kt ku dt translated">2-准备数据库</h2><ul class=""><li id="6bb9" class="ll lm hu ja b jb ln jf lo jj lp jn lq jr lr jv ls lt lu lv dt translated">帖子迁移<code class="eh li lj lk la b">database/migrations/______create_posts_table.php</code></li></ul><pre class="kv kw kx ky fq kz la lb lc aw ld dt"><span id="f92e" class="ka kb hu la b fv le lf l lg lh">Schema::<em class="jz">create</em>('posts', <strong class="la hv">function </strong>(Blueprint $table) {<br/>    $table-&gt;increments('id');<br/>    $table-&gt;string('title');<br/>    $table-&gt;string('body');<br/>    $table-&gt;unsignedInteger('user_id');<br/>    $table-&gt;timestamps();<br/>});</span></pre><ul class=""><li id="971a" class="ll lm hu ja b jb jc jf jg jj lw jn lx jr ly jv ls lt lu lv dt translated">邮报工厂<code class="eh li lj lk la b">database/factories/PostFactory.php</code></li></ul><pre class="kv kw kx ky fq kz la lb lc aw ld dt"><span id="f36a" class="ka kb hu la b fv le lf l lg lh"><strong class="la hv">&lt;?php<br/><br/>use </strong>Faker\Generator <strong class="la hv">as </strong>Faker;<br/><br/>$factory-&gt;define(App\Post::<em class="jz">class</em>, <strong class="la hv">function </strong>(Faker $faker) {<br/>    <strong class="la hv">return </strong>[<br/>        'title' =&gt; $faker-&gt;sentence,<br/>        'body' =&gt; $faker-&gt;paragraph,<br/>        'user_id' =&gt; <strong class="la hv">function </strong>() {<br/>            <strong class="la hv">return </strong>factory(\App\User::<em class="jz">class</em>);<br/>        }<br/>    ];<br/>});</span></pre><ul class=""><li id="5e5a" class="ll lm hu ja b jb jc jf jg jj lw jn lx jr ly jv ls lt lu lv dt translated">用户有帖子关系<code class="eh li lj lk la b">app/User.php</code></li></ul><pre class="kv kw kx ky fq kz la lb lc aw ld dt"><span id="f9df" class="ka kb hu la b fv le lf l lg lh"><strong class="la hv">public function </strong>posts()<br/>{<br/>    <strong class="la hv">return </strong>$this-&gt;hasMany(Post::<em class="jz">class</em>);<br/>}</span></pre><ul class=""><li id="edb4" class="ll lm hu ja b jb jc jf jg jj lw jn lx jr ly jv ls lt lu lv dt translated">避免职位的大规模分配<code class="eh li lj lk la b">app/Post.php</code></li></ul><pre class="kv kw kx ky fq kz la lb lc aw ld dt"><span id="9a56" class="ka kb hu la b fv le lf l lg lh"><strong class="la hv">&lt;?php<br/><br/>namespace </strong>App;<br/><br/><strong class="la hv">use </strong>Illuminate\Database\Eloquent\Model;<br/><br/><strong class="la hv">class </strong>Post <strong class="la hv">extends </strong>Model<br/>{<br/>    <strong class="la hv">protected </strong>$guarded = [];<br/>}</span></pre><ul class=""><li id="883f" class="ll lm hu ja b jb jc jf jg jj lw jn lx jr ly jv ls lt lu lv dt translated">为数据库设定种子</li></ul><pre class="kv kw kx ky fq kz la lb lc aw ld dt"><span id="aaa7" class="ka kb hu la b fv le lf l lg lh">php artisan migrate:fresh<br/>php artisan tinker<br/>factory(App\Post::class)-&gt;times(2)-&gt;create();<br/>factory(App\Post::class)-&gt;times(2)-&gt;create(['user_id' =&gt; 1]);</span></pre><h2 id="e423" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jj kl km kn jn ko kp kq jr kr ks kt ku dt translated">3-设置路线</h2><pre class="kv kw kx ky fq kz la lb lc aw ld dt"><span id="9ade" class="ka kb hu la b fv le lf l lg lh">Route::<em class="jz">apiResource</em>('/users', 'UsersController');</span></pre><h2 id="9081" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jj kl km kn jn ko kp kq jr kr ks kt ku dt translated">4-将模型转化为资源</h2><pre class="kv kw kx ky fq kz la lb lc aw ld dt"><span id="d1f1" class="ka kb hu la b fv le lf l lg lh"><em class="jz">/**<br/> * Display a listing of the resource.<br/> *<br/> * </em><strong class="la hv"><em class="jz">@param </em></strong><em class="jz">User $user<br/> * </em><strong class="la hv"><em class="jz">@return </em></strong><em class="jz">\Illuminate\Http\Response<br/> */<br/></em><strong class="la hv">public function </strong>index(User $user)<br/>{<br/>    <strong class="la hv">return new </strong>UsersWithPostsResource($user-&gt;paginate());<br/>}</span></pre><h2 id="b999" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jj kl km kn jn ko kp kq jr kr ks kt ku dt translated">5-拥有帖子资源的用户</h2><pre class="kv kw kx ky fq kz la lb lc aw ld dt"><span id="b454" class="ka kb hu la b fv le lf l lg lh"><strong class="la hv">&lt;?php<br/><br/>namespace </strong>App\Http\Resources;<br/><br/><strong class="la hv">use </strong>Illuminate\Http\Resources\Json\Resource;<br/><br/><strong class="la hv">class </strong>UsersWithPostsResource <strong class="la hv">extends </strong>Resource<br/>{<br/>    <em class="jz">/**<br/>     * Transform the resource into an array.<br/>     *<br/>     * </em><strong class="la hv"><em class="jz">@param  </em></strong><em class="jz">\Illuminate\Http\Request<br/>     * </em><strong class="la hv"><em class="jz">@return </em></strong><em class="jz">array<br/>     */<br/>    </em><strong class="la hv">public function </strong>toArray($request)<br/>    {<br/>        // Eager load<br/>        $this-&gt;resource-&gt;load('posts');<br/><br/>        <strong class="la hv">return </strong>$this-&gt;resource-&gt;map(<strong class="la hv">function </strong>($item) {<br/>            <strong class="la hv">return </strong>[<br/>                'name' =&gt; $item-&gt;name,<br/>                'email' =&gt; $item-&gt;email,<br/>                'posts' =&gt; <strong class="la hv">new </strong>PostsResource($item-&gt;posts)<br/>            ];<br/>        });<br/>    }<br/>}</span></pre><h2 id="6482" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jj kl km kn jn ko kp kq jr kr ks kt ku dt translated">6员额资源</h2><pre class="kv kw kx ky fq kz la lb lc aw ld dt"><span id="d645" class="ka kb hu la b fv le lf l lg lh"><strong class="la hv">&lt;?php<br/><br/>namespace </strong>App\Http\Resources;<br/><br/><strong class="la hv">use </strong>Illuminate\Http\Resources\Json\Resource;<br/><br/><strong class="la hv">class </strong>PostsResource <strong class="la hv">extends </strong>Resource<br/>{<br/>    <em class="jz">/**<br/>     * Transform the resource into an array.<br/>     *<br/>     * </em><strong class="la hv"><em class="jz">@param  </em></strong><em class="jz">\Illuminate\Http\Request<br/>     * </em><strong class="la hv"><em class="jz">@return </em></strong><em class="jz">array<br/>     */<br/>    </em><strong class="la hv">public function </strong>toArray($request)<br/>    {<br/>        <strong class="la hv">return </strong>$this-&gt;resource-&gt;map(<strong class="la hv">function </strong>($item) {<br/>            <strong class="la hv">return </strong>[<br/>                'title' =&gt; $item-&gt;title<br/>            ];<br/>        });<br/>    }<br/>}</span></pre><h2 id="4dc4" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jj kl km kn jn ko kp kq jr kr ks kt ku dt translated">7-结论</h2><p id="aec5" class="pw-post-body-paragraph iy iz hu ja b jb ln jd je jf lo jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">与<strong class="ja hv">分形</strong>相比，第一个明显的区别是资源可以轻松直接地访问整个集合，而不是基于每个对象。这意味着当转换一组用户时，你可以很容易地加载每一个帖子，而不需要N+1个查询。</p><p id="287f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">嵌套转换也很容易，因为您可以根据需要生成一个新的资源类来转换您的数据。</p><p id="0646" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">一旦我开始挖掘更多的可能性，我会写一个更详细的帖子。</p><h1 id="cd77" class="mc kb hu bd kc md me mf kg mg mh mi kk mj mk ml kn mm mn mo kq mp mq mr kt ms dt translated">后续行动</h1><p id="5b6a" class="pw-post-body-paragraph iy iz hu ja b jb ln jd je jf lo jh ji jj lz jl jm jn ma jp jq jr mb jt ju jv hn dt translated">这是Laravel 5.5中关于API资源的第一篇文章。你可以在这里找到关于这个主题的第二篇文章:<a class="ae jy" rel="noopener" href="/@deleugpn/reusable-api-resource-with-nested-relationship-laravel-5-5-c654c7243869">https://medium . com/@ deleugpn/reusable-API-resource-with-nested-relationship-laravel-5-5-c654c 7243869</a></p></div></div>    
</body>
</html>