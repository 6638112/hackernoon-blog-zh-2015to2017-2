<html>
<head>
<title>“camelCase” &lt; = &gt; “snake_case” conversion with PostgreSQL and Knex.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用PostgreSQL和Knex.js进行" camelCase" &lt; = &gt; "snake_case "转换</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/camelcase-snake-case-conversion-with-postgresql-and-knex-js-956357872fe4?source=collection_archive---------1-----------------------#2017-05-21">https://medium.com/hackernoon/camelcase-snake-case-conversion-with-postgresql-and-knex-js-956357872fe4?source=collection_archive---------1-----------------------#2017-05-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/4f097f892d692f55491b2adafdd9471e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*2dNb7nWxQKJQZEz8P2tiYQ.jpeg"/></div></figure><p id="b77a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果您正在构建一个<a class="ae jw" href="https://github.com/kriasoft/nodejs-api-starter" rel="noopener ugc nofollow" target="_blank"> GraphQL数据API </a>，您很可能希望按照<a class="ae jw" href="http://facebook.github.io/graphql/" rel="noopener ugc nofollow" target="_blank"> GraphQL规范</a>的建议，为GraphQL模式中的所有字段使用<strong class="ja hv">小写字母</strong>名称。但是，很可能您的数据库使用了不同的约定。例如，在使用PostgreSQL的情况下，要使用的实际命名约定是<strong class="ja hv"> snake_case </strong>(请在下面的评论中询问原因)。让我们来看看这个问题的几个解决方案。</p><h1 id="fd0c" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">解决方案1</h1><p id="f29a" class="pw-post-body-paragraph iy iz hu ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hn dt translated">你可以为<a class="ae jw" href="https://hackernoon.com/tagged/node-js" rel="noopener ugc nofollow" target="_blank"> Node.js </a>使用ORM工具，比如Sequelize、Bookshelf、Objection.js或其他。它们中的大多数都能够将字段名转换成另一种格式。但是，那个解决方案听起来很无聊，我们就跳过它吧:)</p><h1 id="3d1b" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">解决方案2</h1><p id="efad" class="pw-post-body-paragraph iy iz hu ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hn dt translated">将<em class="la"> snake_case </em>字段转换为类型的<code class="eh lb lc ld le b">resolve()</code>方法中GraphQL级别的<em class="la"> camelCase </em>。这里有一个例子:</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="lj lk l"/></div></figure><p id="8cb4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这种方法相当罗嗦，但至少没有“魔法”，一切看起来清晰明了。不利的一面是，您最终将在数据访问代码中混合使用大小写。</p><h1 id="b200" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">解决方案3</h1><p id="b888" class="pw-post-body-paragraph iy iz hu ja b jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv hn dt translated">让我们看看如何使用<a class="ae jw" href="http://knexjs.org/" rel="noopener ugc nofollow" target="_blank"> Knex.js </a>自动处理这种转换，Knex.js是Node.js非常流行的通用数据库客户端。</p><p id="7062" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">通常，您将从创建导出Knex客户机的单例实例的<code class="eh lb lc ld le b">db.js</code>文件开始:</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="lj lk l"/></div><figcaption class="ll lm fg fe ff ln lo bd b be z ek"><a class="ae jw" href="https://gist.github.com/koistya/10a09698e823a66e48463d4016b47850" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/koistya/10a09698e823a66e48463d4016b47850</a></figcaption></figure><p id="b258" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">因此，您可以在您的数据模型中使用它，就像这样(<code class="eh lb lc ld le b">models/User.js</code>):</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="lj lk l"/></div><figcaption class="ll lm fg fe ff ln lo bd b be z ek"><a class="ae jw" href="https://gist.github.com/koistya/dd53966e233a8199f91ad3e185130bdd" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/koistya/dd53966e233a8199f91ad3e185130bdd</a></figcaption></figure><p id="68b0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">执行<code class="eh lb lc ld le b">User.find()</code>方法将生成以下SQL查询:</p><pre class="lf lg lh li fq lp le lq lr aw ls dt"><span id="0d77" class="lt jy hu le b fv lu lv l lw lx">SELECT "id", "email", "is_admin" FROM "users"</span></pre><p id="7ece" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">…并且，将解析为一个包含一组snake_case字段的对象数组(哎哟！).这很容易通过调整数据模型类中的字段(列)名称列表来解决(参见第3行):</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="lj lk l"/></div><figcaption class="ll lm fg fe ff ln lo bd b be z ek"><a class="ae jw" href="https://gist.github.com/koistya/72bb734a0ad617f692b259d72d8ad011" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/koistya/72bb734a0ad617f692b259d72d8ad011</a></figcaption></figure><p id="f51f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在由<code class="eh lb lc ld le b">.find()</code>方法生成的SQL查询将变成:</p><pre class="lf lg lh li fq lp le lq lr aw ls dt"><span id="316e" class="lt jy hu le b fv lu lv l lw lx">SELECT "id", "email", "is_admin" as "isAdmin" FROM "users"</span></pre><p id="e9b1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">执行该方法将返回一个形状完美的JavaScript对象数组。更有趣的是，如何确保可以使用带有<code class="eh lb lc ld le b">.where()</code>和<code class="eh lb lc ld le b">.update()</code>输入的camelCase属性？幸运的是，通过重写Knex的<code class="eh lb lc ld le b">wrapdIdentifier(value)</code>和<code class="eh lb lc ld le b">wrapsAsIdentifier(value)</code>方法也应该很容易调整:</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="lj lk l"/></div><figcaption class="ll lm fg fe ff ln lo bd b be z ek"><a class="ae jw" href="https://gist.github.com/koistya/28c9da83c0eeeb5be5795d583459c162" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/koistya/28c9da83c0eeeb5be5795d583459c162</a></figcaption></figure><p id="1b00" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">就是这样！现在可以做<code class="eh lb lc ld le b">User.find({ isAdmin: true })</code>、<code class="eh lb lc ld le b">User.update({ firstName: 'Bill' }).where({ id: 123 })</code>等事情了。</p><p id="9bb8" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">顺便说一下</strong>，如果你想玩GraphQL、PostgreSQL和Knex，最简单的开始方式是安装<a class="ae jw" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>，最新版本的<a class="ae jw" href="https://yarnpkg.com/" rel="noopener ugc nofollow" target="_blank"> Yarn </a>，然后运行<code class="eh lb lc ld le b"><strong class="ja hv">yarn create data-api</strong></code>——这将创建初始项目结构，包括所有的核心构建模块和开发工具。编码快乐！</p><div class="lf lg lh li fq ab cb"><figure class="ly iv lz ma mb mc md paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ly iv lz ma mb mc md paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ly iv lz ma mb mc md paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="me mf mg"><p id="f922" class="iy iz la ja b jb jc jd je jf jg jh ji mh jk jl jm mi jo jp jq mj js jt ju jv hn dt translated"><a class="ae jw" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客们下午的开始。我们是这个家庭的一员。我们现在<a class="ae jw" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jw" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="iy iz la ja b jb jc jd je jf jg jh ji mh jk jl jm mi jo jp jq mj js jt ju jv hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jw" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jw" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="fe ff mk"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="mp lk l"/></div></figure></div></div>    
</body>
</html>