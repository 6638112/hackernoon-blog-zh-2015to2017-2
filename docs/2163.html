<html>
<head>
<title>How to setup and deploy a Rails 5 app on AWS ElasticBeanstalk with PostgreSQL, Redis and more…</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用PostgreSQL、Redis等在AWS ElasticBeanstalk上设置和部署Rails 5应用程序…</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-setup-and-deploy-a-rails-5-app-on-aws-beanstalk-with-postgresql-redis-and-more-88a38355f1ea?source=collection_archive---------1-----------------------#2017-01-10">https://medium.com/hackernoon/how-to-setup-and-deploy-a-rails-5-app-on-aws-beanstalk-with-postgresql-redis-and-more-88a38355f1ea?source=collection_archive---------1-----------------------#2017-01-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/3a8500acb896dd0b3aa18e089c2d059d.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*6B-6_az43jpZIalwbsuoQw.png"/></div></figure><p id="cf92" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:本教程是我的书<a class="ae jw" href="https://BuildASaaSAppinRails.com" rel="noopener ugc nofollow" target="_blank">构建SaaS Ruby on Rails 5 </a>中部署章节的摘录。这本书将通过将应用程序部署到生产中来指导你从卑微的开始。如果你发现这种类型的内容有价值，你现在就可以获得一个免费的章节！</p><p id="6d5c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">此外，我的新项目<a class="ae jw" href="https://pullmanager.com" rel="noopener ugc nofollow" target="_blank">拉管理器</a>的测试版也差不多准备好了。如果你失去了对拉取请求的跟踪，让旧的请求留在身边，或者只是喜欢一个通过多个服务(Github、Gitlab和Bitbucket)聚集这些请求的仪表板，<a class="ae jw" href="https://pullmanager.com" rel="noopener ugc nofollow" target="_blank">查看一下</a>。</p></div><div class="ab cl jx jy hc jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hn ho hp hq hr"><p id="b72b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">即使对于经验丰富的Rails开发人员来说，部署一个Rails应用程序对新应用程序来说也是一项令人望而生畏的任务。虽然Capistrano一直是Rails应用部署的主要参与者，但随着负载平衡器和计算服务器越来越受欢迎，它似乎已经有点失宠了。</p><p id="291c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">谢天谢地，<a class="ae jw" href="https://aws.amazon.com/elasticbeanstalk/" rel="noopener ugc nofollow" target="_blank"> AWS(Amazon Web Services) </a>已经创建了一个工具，用于在他们的生态系统中部署和扩展Rails web应用程序。以下是他们登录页面的解释:</p><blockquote class="ke kf kg"><p id="3a11" class="iy iz kh ja b jb jc jd je jf jg jh ji ki jk jl jm kj jo jp jq kk js jt ju jv hn dt translated">AWS Elastic Beanstalk是一个易于使用的服务，用于部署和扩展用Java开发的web应用程序和服务。熟悉的服务器如Apache、Nginx、Passenger、<a class="ae jw" href="https://aws.amazon.com/windows/" rel="noopener ugc nofollow" target="_blank"> IIS </a>上的NET 、PHP、Node.js、Python、Ruby、Go、<a class="ae jw" href="https://aws.amazon.com/docker/" rel="noopener ugc nofollow" target="_blank"> Docker </a>。</p><p id="968c" class="iy iz kh ja b jb jc jd je jf jg jh ji ki jk jl jm kj jo jp jq kk js jt ju jv hn dt translated">您只需上传您的代码，Elastic Beanstalk就会自动处理部署，从容量供应、负载平衡、自动扩展到应用健康监控。同时，您保留了对驱动应用程序的AWS资源的完全控制，并且可以随时访问底层资源。</p><p id="2f9b" class="iy iz kh ja b jb jc jd je jf jg jh ji ki jk jl jm kj jo jp jq kk js jt ju jv hn dt translated">Elastic Beanstalk不收取额外费用——您只需为存储和运行应用程序所需的AWS资源付费。</p></blockquote><h1 id="69e0" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">入门指南</h1><p id="dcc8" class="pw-post-body-paragraph iy iz hu ja b jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv hn dt translated">如果你还没有AWS账户，去注册吧，你会得到一年的特定级别的免费服务(例如t1.micro服务器等)。本教程将关注MacOS，如果对windows表现出足够的兴趣，我可以扩展，尽管大多数基于rails的命令应该可以在任何平台上工作。</p><p id="1391" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">设置好用户后，获取AWS的CLI(通过brew):</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="d999" class="lx km hu lt b fv ly lz l ma mb">$ brew update<br/>$ brew install aws-elasticbeanstalk</span></pre><p id="362e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果还没有，现在创建rails应用程序</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="3b54" class="lx km hu lt b fv ly lz l ma mb">$ **rvm or rbenv optional setup here**<br/>$ gem install rails -v 5.0.1<br/>$ rails new rails5app<br/>$ cd rails5app<br/>$ git init &amp;&amp; git add -A &amp;&amp; git commit -m "Init Commit Message"</span></pre><p id="fa82" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">…现在我们将创建一个脚手架示例</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="93b0" class="lx km hu lt b fv ly lz l ma mb">$ rails g scaffold message subject body:text<br/>$ rails db:migrate<br/>$ git add .<br/>$ git commit -am "Add Messages"<br/>$ git push</span></pre><p id="91bf" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">好了，我们有了一个基本的Rails应用程序来继续部署Elastic BeanStalk。让我们初始化ElasticBeanstalk</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="1477" class="lx km hu lt b fv ly lz l ma mb">$ eb init</span><span id="0963" class="lx km hu lt b fv mc lz l ma mb">Select a default region<br/>1) us-east-1 : US East (N. Virginia)</span><span id="6659" class="lx km hu lt b fv mc lz l ma mb">Select an application to use<br/>1)[ Create new Application ]</span><span id="7be4" class="lx km hu lt b fv mc lz l ma mb">Enter Application Name<br/>(default is "rails5app"):<br/>Application rails5app has been created.</span><span id="0340" class="lx km hu lt b fv mc lz l ma mb">It appears you are using Ruby. Is this correct?<br/>(y/n): y</span><span id="c5f3" class="lx km hu lt b fv mc lz l ma mb">Select a platform version.<br/>1) Ruby 2.3 (Puma)</span><span id="b536" class="lx km hu lt b fv mc lz l ma mb">Do you want to set up SSH for your instances?<br/>(y/n): y</span><span id="a9e6" class="lx km hu lt b fv mc lz l ma mb">Select a keypair.<br/>1) [ Create new KeyPair ]<br/>(default is 1): 1</span></pre><p id="1c36" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这就建立了我们的环境，使用US East(如果你想使用AWS免费的SSL服务更好)，Ruby 2.3，并允许你在EC2启动并运行时通过键入“eb ssh”来访问它。</p><p id="c3eb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在我们将创建环境。这就是Elastic Beanstalk让您在应用程序的不同版本之间切换的基本方式。大多数人会用它来建立不同的rails环境进行部署(生产、暂存等)</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="ea17" class="lx km hu lt b fv ly lz l ma mb">$ git commit -am "Post EB init"<br/>$ eb create production</span></pre><p id="5d80" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">..然后等待。现在，Elastic Beanstalk正在为您、负载平衡器、安全组、EC2服务器等设置一切。说真的，你应该去喝杯咖啡。此外，我以前也有过eb-cli登录超时，断开连接，但仍然完成了环境创建。</p><p id="ecf4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">之后的快速状态检查将为您的应用程序获取环境信息和您的ElasticBeanstalk URL:</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="49ad" class="lx km hu lt b fv ly lz l ma mb">$ eb status<br/>Environment details for: production<br/> Application name: rails5app<br/> Region: us-east-1<br/> Deployed Version: app-5cbc-170110_150338<br/> Environment ID: e-krea6tdvjx<br/> Platform: 64bit Amazon Linux 2016.09 v2.3.0 running Ruby 2.3 (Puma)<br/> Tier: WebServer-Standard<br/> CNAME: production.a3rjg2n9mm.us-east-1.elasticbeanstalk.com<br/> Updated: 2017–01–10 22:10:57.815000+00:00<br/> Status: Ready<br/> Health: Green</span></pre><p id="38bb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">不过，现在去那里会给你带来错误。为了避免溃疡，这是因为没有Rails秘密设置。因此，下面是如何将ENV变量添加到Elastic Beanstalk实例中:</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="470f" class="lx km hu lt b fv ly lz l ma mb">$ eb setenv SECRET_KEY_BASE=$(rails secret)<br/>INFO: Environment update is starting.<br/>INFO: Updating environment production's configuration settings.<br/>INFO: Environment health has transitioned from Ok to Info. Configuration update in progress. 1 out of 1 instance completed (running for 51 seconds).<br/>INFO: Successfully deployed new configuration to environment.</span></pre><p id="c6ae" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">繁荣</p><p id="24d0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">从现在开始，将代码推送到您的实例只是一个“eb部署”的过程。</p><figure class="lo lp lq lr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff md"><img src="../Images/18141a54d0d3abfb7b5d4be4ae080a91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dEF3kF16SH_Jm37i4qvl7A.png"/></div></div><figcaption class="mi mj fg fe ff mk ml bd b be z ek">Your default rails chariot awaits</figcaption></figure><figure class="lo lp lq lr fq iv"><div class="bz el l di"><div class="mm mn l"/></div></figure><h1 id="70fa" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">剩下的好东西</h1><p id="8318" class="pw-post-body-paragraph iy iz hu ja b jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv hn dt translated">我敢打赌你会说，这很好，但这不是一个生产就绪的应用程序。你说得对，让我们开始使用postgresql、redis和sidekiq吧！首先，波斯格里斯。您需要将“pg”宝石添加到您的宝石文件中，并将以下内容添加到您的数据库中。yml:</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="1467" class="lx km hu lt b fv ly lz l ma mb">production:<br/>    &lt;&lt;: *default<br/>    adapter: postgresql<br/>    encoding: unicode<br/>    database: &lt;%= ENV['RDS_DB_NAME'] %&gt;<br/>    username: &lt;%= ENV['RDS_USERNAME'] %&gt;<br/>    password: &lt;%= ENV['RDS_PASSWORD'] %&gt;<br/>    host: &lt;%= ENV['RDS_HOSTNAME'] %&gt;<br/>    port: &lt;%= ENV['RDS_PORT'] %&gt;</span></pre><p id="777c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这是什么魔法？一旦有了RDS实例设置，AWS Elastic Beanstalk就会在ec2实例上抛出这些ENV变量。让我们这样做:</p><ul class=""><li id="a667" class="mo mp hu ja b jb jc jf jg jj mq jn mr jr ms jv mt mu mv mw dt translated">去https://console.aws.amazon.com/elasticbeanstalk/home?region = us-east-1 #/应用程序</li><li id="372f" class="mo mp hu ja b jb mx jf my jj mz jn na jr nb jv mt mu mv mw dt translated">单击您的应用程序的方框</li><li id="6cf1" class="mo mp hu ja b jb mx jf my jj mz jn na jr nb jv mt mu mv mw dt translated">单击“配置”，向下滚动到底部的“数据层”，然后单击“设置RDS实例”</li><li id="4fc4" class="mo mp hu ja b jb mx jf my jj mz jn na jr nb jv mt mu mv mw dt translated">根据您的喜好设置RDS(postgres、t2.micro(如果您想留在免费层，用户名等)</li><li id="43ee" class="mo mp hu ja b jb mx jf my jj mz jn na jr nb jv mt mu mv mw dt translated">等待AWS做它的事情。你现在可以再来一杯咖啡。</li></ul><blockquote class="ke kf kg"><p id="028a" class="iy iz kh ja b jb jc jd je jf jg jh ji ki jk jl jm kj jo jp jq kk js jt ju jv hn dt translated">注意:一些读者让我注意到，通过EBS接口添加RDS实例会将它与您的EBS环境的存在或破坏联系在一起。单独设置RDS并手动添加环境变量可能对某些人有更大的RDS保证。</p></blockquote><p id="bee7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在，针对您的数据库配置的另一个“eb deploy”应该可以通过postgresql启动并运行一切。</p><p id="8883" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在，让我们添加两个大多数应用程序都需要的配置文件。首先，将git添加到部署中。添加一个文件夹。ebextensions和一个文件ruby.config</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="e8f5" class="lx km hu lt b fv ly lz l ma mb">packages:<br/> yum:<br/>  git: []</span></pre><p id="43ce" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在，当你在你的应用中获得更多的宝石时，特别是那些内置所有本机扩展的，你可能会因为内存不足而部署失败。由于大多数应用程序都可以在空闲层上运行，并且只有在部署期间才会出现内存问题，因此我们将启用交换。在中添加文件0001_setup_swap.config。包含以下文本的ebextensions文件夹:</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="5c47" class="lx km hu lt b fv ly lz l ma mb">commands:<br/>  000_dd:<br/>    command: echo “noswap”#dd if=/dev/zero of=/swapfile bs=1M count=3072<br/>  001_mkswap:<br/>    command: echo “noswap”#mkswap /swapfile<br/>  002_swapon:<br/>    command: echo “noswap”#swapon /swapfile</span></pre><p id="2d89" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">太好了，我们快好了。几乎所有Rails应用程序的最后一部分都将是sidekiq(加上Redis……这意味着我们也可以将ActionCable绑定到Redis中)。让我们从在AWS中添加Redis开始:</p><ul class=""><li id="67bd" class="mo mp hu ja b jb jc jf jg jj mq jn mr jr ms jv mt mu mv mw dt translated">去https://console.aws.amazon.com/elasticache/home?region=us-east-1#redis :</li><li id="255e" class="mo mp hu ja b jb mx jf my jj mz jn na jr nb jv mt mu mv mw dt translated">单击create，并填写非常简单的表单(再次选择t2.micro作为自由层)。</li><li id="7818" class="mo mp hu ja b jb mx jf my jj mz jn na jr nb jv mt mu mv mw dt translated">点击保存，在你等待的时候去喝水…三杯咖啡太多了。</li><li id="4163" class="mo mp hu ja b jb mx jf my jj mz jn na jr nb jv mt mu mv mw dt translated">创建完成后，单击列表中的实例会将您带到一个页面，该页面的表中列出了一个端点(它应该看起来像your-name.iz6wli.0001.use1.cache.amazonaws.com)</li></ul><p id="72c7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">快好了！我们只需要为sidekiq、redis和elastic的部署添加几个配置文件！首先，我喜欢设置Sidekiq/Redis配置:</p><p id="1995" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在config/initializer/sidekiq . Rb中</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="85de" class="lx km hu lt b fv ly lz l ma mb">rails_root = Rails.root || File.dirname(__FILE__) + ‘/../..’<br/>rails_env = Rails.env || ‘development’<br/>redis_config = YAML.load_file(rails_root.to_s + ‘/config/redis.yml’)<br/>redis_config.merge! redis_config.fetch(Rails.env, {})<br/>redis_config.symbolize_keys!<br/>Sidekiq.configure_server do |config|<br/> config.redis = { url: “redis://#{redis_config[:host]}:#{redis_config[:port]}/12” }<br/>end<br/>Sidekiq.configure_client do |config|<br/> config.redis = { url: “redis://#{redis_config[:host]}:#{redis_config[:port]}/12” }<br/>end</span></pre><p id="529b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">…和config/redis.yml</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="9df2" class="lx km hu lt b fv ly lz l ma mb">development:<br/> host: ‘localhost’<br/> port: ‘6379’<br/>test:<br/> host: ‘localhost’<br/> port: ‘6379’<br/>production:<br/> host: ‘your-name.iz6wli.0001.use1.cache.amazonaws.com’<br/> port: ‘6379’</span></pre><p id="6634" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">*可选* config/cable.yml</p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="a673" class="lx km hu lt b fv ly lz l ma mb">development:<br/> adapter: async<br/> <br/>test:<br/> adapter: async<br/> <br/>production:<br/> adapter: redis<br/> url: redis://your-name.iz6wli.0001.use1.cache.amazonaws.com:6379</span></pre><p id="4097" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">…最后，对于弹性豆茎。ebextensions/0002 _ sidekiq . config(<a class="ae jw" href="https://gist.github.com/polysaturate/98dbca462e25604d6b18f38dc8380757" rel="noopener ugc nofollow" target="_blank">要诀</a></p><pre class="lo lp lq lr fq ls lt lu lv aw lw dt"><span id="ced0" class="lx km hu lt b fv ly lz l ma mb"># Sidekiq interaction and startup script<br/>commands:<br/>  create_post_dir:<br/>    command: "mkdir -p /opt/elasticbeanstalk/hooks/appdeploy/post"<br/>    ignoreErrors: true<br/>files:<br/>  "/opt/elasticbeanstalk/hooks/appdeploy/post/50_restart_sidekiq.sh":<br/>    mode: "000755"<br/>    owner: root<br/>    group: root<br/>    content: |<br/>      #!/usr/bin/env bash<br/>      . /opt/elasticbeanstalk/support/envvars</span><span id="6578" class="lx km hu lt b fv mc lz l ma mb">EB_APP_DEPLOY_DIR=$(/opt/elasticbeanstalk/bin/get-config container -k app_deploy_dir)<br/>      EB_APP_PID_DIR=$(/opt/elasticbeanstalk/bin/get-config container -k app_pid_dir)<br/>      EB_APP_USER=$(/opt/elasticbeanstalk/bin/get-config container -k app_user)<br/>      EB_SCRIPT_DIR=$(/opt/elasticbeanstalk/bin/get-config container -k script_dir)<br/>      EB_SUPPORT_DIR=$(/opt/elasticbeanstalk/bin/get-config container -k support_dir)</span><span id="ee62" class="lx km hu lt b fv mc lz l ma mb">. $EB_SUPPORT_DIR/envvars<br/>      . $EB_SCRIPT_DIR/use-app-ruby.sh</span><span id="7b62" class="lx km hu lt b fv mc lz l ma mb">SIDEKIQ_PID=$EB_APP_PID_DIR/sidekiq.pid<br/>      SIDEKIQ_CONFIG=$EB_APP_DEPLOY_DIR/config/sidekiq.yml<br/>      SIDEKIQ_LOG=$EB_APP_DEPLOY_DIR/log/sidekiq.log</span><span id="e060" class="lx km hu lt b fv mc lz l ma mb">cd $EB_APP_DEPLOY_DIR</span><span id="4b4d" class="lx km hu lt b fv mc lz l ma mb">if [ -f $SIDEKIQ_PID ]<br/>      then<br/>        su -s /bin/bash -c "kill -TERM `cat $SIDEKIQ_PID`" $EB_APP_USER<br/>        su -s /bin/bash -c "rm -rf $SIDEKIQ_PID" $EB_APP_USER<br/>      fi</span><span id="7339" class="lx km hu lt b fv mc lz l ma mb">. /opt/elasticbeanstalk/support/envvars.d/sysenv</span><span id="d856" class="lx km hu lt b fv mc lz l ma mb">sleep 10</span><span id="6ee3" class="lx km hu lt b fv mc lz l ma mb">su -s /bin/bash -c "bundle exec sidekiq \<br/>        -e $RACK_ENV \<br/>        -P $SIDEKIQ_PID \<br/>        -C $SIDEKIQ_CONFIG \<br/>        -L $SIDEKIQ_LOG \<br/>        -d" $EB_APP_USER</span><span id="5966" class="lx km hu lt b fv mc lz l ma mb">"/opt/elasticbeanstalk/hooks/appdeploy/pre/03_mute_sidekiq.sh":<br/>    mode: "000755"<br/>    owner: root<br/>    group: root<br/>    content: |<br/>      #!/usr/bin/env bash<br/>      . /opt/elasticbeanstalk/support/envvars</span><span id="e3da" class="lx km hu lt b fv mc lz l ma mb">EB_APP_USER=$(/opt/elasticbeanstalk/bin/get-config container -k app_user)<br/>      EB_SCRIPT_DIR=$(/opt/elasticbeanstalk/bin/get-config container -k script_dir)<br/>      EB_SUPPORT_DIR=$(/opt/elasticbeanstalk/bin/get-config container -k support_dir)</span><span id="edf4" class="lx km hu lt b fv mc lz l ma mb">. $EB_SUPPORT_DIR/envvars<br/>      . $EB_SCRIPT_DIR/use-app-ruby.sh</span><span id="9fdb" class="lx km hu lt b fv mc lz l ma mb">SIDEKIQ_PID=$EB_APP_PID_DIR/sidekiq.pid<br/>      if [ -f $SIDEKIQ_PID ]<br/>      then<br/>        su -s /bin/bash -c "kill -USR1 `cat $SIDEKIQ_PID`" $EB_APP_USER<br/>      fi</span></pre><p id="af23" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">再来一次“git commit”和“eb deploy ”,你就可以开始了。噢耶！</p><div class="lo lp lq lr fq ab cb"><figure class="nc iv nd ne nf ng nh paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nc iv nd ne nf ng nh paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nc iv nd ne nf ng nh paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ke kf kg"><p id="f922" class="iy iz kh ja b jb jc jd je jf jg jh ji ki jk jl jm kj jo jp jq kk js jt ju jv hn dt translated"><a class="ae jw" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jw" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jw" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jw" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="iy iz kh ja b jb jc jd je jf jg jh ji ki jk jl jm kj jo jp jq kk js jt ju jv hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jw" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jw" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lo lp lq lr fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="fe ff ni"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>