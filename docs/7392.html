<html>
<head>
<title>Setup AWS Lambda with Scheduled Events</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用预定事件设置AWS Lambda</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/setup-aws-lambda-with-scheduled-events-2840824ed1ad?source=collection_archive---------6-----------------------#2017-10-26">https://medium.com/hackernoon/setup-aws-lambda-with-scheduled-events-2840824ed1ad?source=collection_archive---------6-----------------------#2017-10-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/3b5cdb6c4fe87b21ecebc9e35c1188f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*yfyq07OFgpo544mzOg2Y1g.png"/></div></figure><p id="3cb9" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这篇文章是我的“<strong class="ja hv">无服务器</strong>系列文章的一部分。在这一部分中，我将向您展示如何设置一个<strong class="ja hv">λ</strong>函数来从<strong class="ja hv"> CloudWatch </strong>发送关于一个定义好的预定事件的邮件。</p><p id="ccc4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 1 —创建Lambda函数</strong></p><p id="56c4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">因此，从克隆项目开始:</p><p id="cedc" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">|git克隆<a class="ae jw" href="https://github.com/mlabouardy/schedule-mail-lambda.git" rel="noopener ugc nofollow" target="_blank">https://github.com/mlabouardy/schedule-mail-lambda.git</a></p><p id="ae51" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我在<strong class="ja hv"> NodeJS </strong>中实现了一个简单的Lambda函数，使用<a class="ae jw" href="https://www.mailgun.com/" rel="noopener ugc nofollow" target="_blank"> MailGun库</a>发送电子邮件</p><figure class="jx jy jz ka fq iv"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="480c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:你可以使用另一个服务，比如<strong class="ja hv"> AWS SES </strong>或者你自己的<strong class="ja hv"> SMTP服务器</strong></p><p id="2318" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">然后，创建一个zip文件:</p><figure class="jx jy jz ka fq iv fe ff paragraph-image"><div class="fe ff kd"><img src="../Images/f6d73af99ad46fce92786f71f060b012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/0*xm7FMZuMUaPJ_fFx."/></div></figure><p id="f9c1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">接下来，我们需要为我们的函数创建一个<strong class="ja hv">执行角色</strong>:</p><figure class="jx jy jz ka fq iv"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="e06e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">| AWS iam create-role-role-name lambda _ execution-assume-role-policy-document file://lambda _ role _ policy . JSON</p><figure class="jx jy jz ka fq iv fe ff paragraph-image"><div class="fe ff ke"><img src="../Images/4682d0125b306760bcecaa0c29dd6109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*HaAV2k5oD6uepPRC."/></div></figure><p id="f085" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">执行下面的<strong class="ja hv"> Lambda CLI </strong>命令，创建一个<strong class="ja hv"> Lambda函数</strong>。我们需要提供<strong class="ja hv"> zip </strong>文件，我们之前创建的<strong class="ja hv"> IAM角色ARN </strong>设置<strong class="ja hv"> MAILGUN_API_KEY </strong>和<strong class="ja hv"> MAILGUN_DOMAIN </strong>为参数。</p><p id="cd32" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">| AWS lambda create-function-region us-east-1-function-name mail-scheduler-zip-file file b://schedule-mail-lambda . zip-role arn:AWS:iam::3 xxxxxxx 3:role/lambda _ execution-handler index . send email-runtime nodejs 6.10-environment Variables = " { MAILGUN _ API _ KEY = KEY-6 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx 5，MAILGUN _ DOMAIN = sandboxcxxxxxxxxxxxxxxxxx . MAILGUN . org } "</p><p id="951e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:<em class="kf">–运行时</em>参数使用<strong class="ja hv">节点。JS 6.10 </strong>但是你也可以指定<strong class="ja hv">节点。JS 4.3 </strong></p><p id="458d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">创建后，<strong class="ja hv"> AWS Lambda </strong>返回函数配置信息，如下例所示:</p><figure class="jx jy jz ka fq iv fe ff paragraph-image"><div class="fe ff ke"><img src="../Images/ce513dead124b2484f294acd7ae39509.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*jrf3Nw_5leQQgpwM."/></div></figure><p id="172d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在，如果我们返回到<a class="ae jw" href="https://console.aws.amazon.com/lambda" rel="noopener ugc nofollow" target="_blank"> AWS Lambda仪表板</a>，我们应该会看到我们的函数已经成功创建:</p><figure class="jx jy jz ka fq iv fe ff paragraph-image"><div class="fe ff ke"><img src="../Images/c01ada34c9c4930cb7774f1e220fd433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*Z4E6Ebxf0aEnaI8E."/></div></figure><p id="b672" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 2 —配置云监控规则</strong></p><p id="378a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">创建一个每隔<strong class="ja hv"> 5分钟</strong>触发lambda函数的新规则:</p><figure class="jx jy jz ka fq iv fe ff paragraph-image"><div class="fe ff ke"><img src="../Images/56a4aa0a37d0392c78bf1b1d569e9a05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*Uq5a_kfBBacQaerc."/></div></figure><p id="893e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:您可以将该值指定为<em class="kf">比率</em>或<em class="kf"> cron </em>表达式格式。所有计划都使用UTC时区，计划的最小精度是一分钟</p><p id="0c7d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果您现在返回到<strong class="ja hv">λ功能控制台</strong>并导航到<strong class="ja hv">触发器</strong>选项卡，您应该会看到<strong class="ja hv"> CloudWatch </strong>已被添加:</p><figure class="jx jy jz ka fq iv fe ff paragraph-image"><div class="fe ff kd"><img src="../Images/afcbede2f20ea8e4f75be078f1c1b04e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/0*ZpN5o2dVwcdepaKU."/></div></figure><p id="66e1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">5分钟后，<strong class="ja hv"> CloudWatch </strong>将触发<strong class="ja hv"> Lambda功能</strong>，您应该会收到一封电子邮件通知:</p><figure class="jx jy jz ka fq iv fe ff paragraph-image"><div class="fe ff kg"><img src="../Images/4e2b55d21518184907e68f58a7af7efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/0*ySvU4tjTX1hTldLb."/></div></figure></div></div>    
</body>
</html>