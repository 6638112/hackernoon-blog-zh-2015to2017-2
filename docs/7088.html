<html>
<head>
<title>A Basic React + Redux introductory tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个基本的React + Redux入门教程</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-basic-react-redux-introductory-tutorial-adcc681eeb5e?source=collection_archive---------2-----------------------#2017-10-17">https://medium.com/hackernoon/a-basic-react-redux-introductory-tutorial-adcc681eeb5e?source=collection_archive---------2-----------------------#2017-10-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b72b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本教程中，我们将使用React和Redux创建一个联系人列表。我们将有一个联系人列表，一旦我们点击其中一个，将显示该联系人的详细信息。</p><p id="46bf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将为我们理解一个<em class="jp"> React+Redux </em>应用程序的关键和基本组件提供一个借口，这个例子是基于Stephen Grider在<a class="ae jq" href="https://www.udemy.com/react-redux/learn/v4/content" rel="noopener ugc nofollow" target="_blank"> Udemy </a>上的Modern React with Redux课程中的书籍例子。我确实鼓励任何人购买它。</p><p id="6834" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">代码也从他的<a class="ae jq" href="https://github.com/StephenGrider/ReduxSimpleStarter" rel="noopener ugc nofollow" target="_blank"> React Simple Starter </a>项目开始</p><p id="5e6f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注</strong>:喜欢语法着色吗？试试这里的<a class="ae jq" href="https://gist.github.com/miguelsaddress/da47c98fa5fbafee5eddc22434d82a39" rel="noopener ugc nofollow" target="_blank">要点</a>或者检查这里的<a class="ae jq" href="https://github.com/miguelsaddress/Contact-List-React-Redux" rel="noopener ugc nofollow" target="_blank">回购</a></p></div><div class="ab cl jr js hc jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hn ho hp hq hr"><p id="4d53" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们开始:</p><p id="105f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">React+Redux应用程序的<strong class="it hv">关键组件</strong>如下:</p><ol class=""><li id="2f46" class="jy jz hu it b iu iv iy iz jc ka jg kb jk kc jo kd ke kf kg dt translated">还原剂</li><li id="a3bb" class="jy jz hu it b iu kh iy ki jc kj jg kk jk kl jo kd ke kf kg dt translated">容器</li><li id="d691" class="jy jz hu it b iu kh iy ki jc kj jg kk jk kl jo kd ke kf kg dt translated">动作(和动作创建者)</li></ol><h1 id="a022" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">1.还原剂</h1><p id="9590" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">缩减器是一个返回应用程序状态的函数</p><p id="32a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设应用程序状态如下</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="811b" class="ly kn hu lu b fv lz ma l mb mc">state = {<!-- --> </span><span id="e069" class="ly kn hu lu b fv md ma l mb mc">    contacts: [{</span><span id="dba6" class="ly kn hu lu b fv md ma l mb mc">        "name": "Miguel",</span><span id="bcb4" class="ly kn hu lu b fv md ma l mb mc">        "phone": "123456789",</span><span id="a108" class="ly kn hu lu b fv md ma l mb mc">    },{</span><span id="3ac5" class="ly kn hu lu b fv md ma l mb mc">        "name": "Peter",</span><span id="9210" class="ly kn hu lu b fv md ma l mb mc">        "phone": "883292300348",</span><span id="7a84" class="ly kn hu lu b fv md ma l mb mc">    },{<!-- --> </span><span id="9428" class="ly kn hu lu b fv md ma l mb mc">        "name": "Jessica",</span><span id="7018" class="ly kn hu lu b fv md ma l mb mc">        "phone": "8743847638473",<!-- --> </span><span id="c244" class="ly kn hu lu b fv md ma l mb mc">    },{<!-- --> </span><span id="0c77" class="ly kn hu lu b fv md ma l mb mc">        "name": "Michael",<!-- --> </span><span id="69be" class="ly kn hu lu b fv md ma l mb mc">        "phone": "0988765553",</span><span id="e49c" class="ly kn hu lu b fv md ma l mb mc">   }],<!-- --> </span><span id="c993" class="ly kn hu lu b fv md ma l mb mc">   activeContact: {</span><span id="a467" class="ly kn hu lu b fv md ma l mb mc">       "name": "Miguel",</span><span id="4e31" class="ly kn hu lu b fv md ma l mb mc">       "phone": "123456789",</span><span id="bc31" class="ly kn hu lu b fv md ma l mb mc">   }</span><span id="1bae" class="ly kn hu lu b fv md ma l mb mc">}</span></pre><p id="6f55" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们需要<strong class="it hv">两个减速器</strong>，一个用于<em class="jp">触点</em>，另一个用于<em class="jp">有源触点</em></p><p id="09ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如，我们的联系人列表可以是应用程序中的一个状态，保存该列表的完全有效(但静态)的缩减器应该是:</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="24cb" class="ly kn hu lu b fv lz ma l mb mc">export default function () {</span><span id="868f" class="ly kn hu lu b fv md ma l mb mc">  return [{</span><span id="205c" class="ly kn hu lu b fv md ma l mb mc">    "name": "Miguel",</span><span id="d482" class="ly kn hu lu b fv md ma l mb mc">    "phone": "123456789",</span><span id="a48b" class="ly kn hu lu b fv md ma l mb mc">  },{</span><span id="3707" class="ly kn hu lu b fv md ma l mb mc">    "name": "Peter",</span><span id="6b2c" class="ly kn hu lu b fv md ma l mb mc">    "phone": "883292300348",</span><span id="34ba" class="ly kn hu lu b fv md ma l mb mc">  },{</span><span id="eb83" class="ly kn hu lu b fv md ma l mb mc">    "name": "Jessica",</span><span id="6396" class="ly kn hu lu b fv md ma l mb mc">    "phone": "8743847638473",</span><span id="f76b" class="ly kn hu lu b fv md ma l mb mc">  },{</span><span id="5a19" class="ly kn hu lu b fv md ma l mb mc">    "name": "Michael",</span><span id="938d" class="ly kn hu lu b fv md ma l mb mc">    "phone": "0988765553",</span><span id="693e" class="ly kn hu lu b fv md ma l mb mc">  }];</span><span id="a149" class="ly kn hu lu b fv md ma l mb mc">}</span></pre><p id="7296" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们必须有一个<em class="jp">“root Reducer”</em>，它是我们应用程序的所有reducer的组合(我们的应用程序状态/ <em class="jp"> Redux存储</em>)。为此，<em class="jp"> Redux </em>提供了<em class="jp">组合减压器</em>功能:</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="6b8f" class="ly kn hu lu b fv lz ma l mb mc">// reducers/index.js</span><span id="253a" class="ly kn hu lu b fv md ma l mb mc">import { combineReducers } from 'redux';</span><span id="1434" class="ly kn hu lu b fv md ma l mb mc">import ContactsReducer from './reducer_contacts'</span><span id="2758" class="ly kn hu lu b fv md ma l mb mc">import ActiveContactReducer from './reducer_active_contact'</span><span id="46eb" class="ly kn hu lu b fv md ma l mb mc">const rootReducer = combineReducers({</span><span id="7781" class="ly kn hu lu b fv md ma l mb mc">  contacts: ContactsReducer,</span><span id="e9ba" class="ly kn hu lu b fv md ma l mb mc">  activeContact: ActiveContactReducer</span><span id="2227" class="ly kn hu lu b fv md ma l mb mc">});</span><span id="b18b" class="ly kn hu lu b fv md ma l mb mc">export default rootReducer;</span></pre><p id="6c44" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们如何将该状态连接到一个<em class="jp">反应</em>组件中？我们需要ReactRedux包，它有助于我们连接React和Redux。怎么会？<strong class="it hv">容器</strong></p><h1 id="eddd" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">2.容器</h1><p id="9d16" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">容器包装了一个<em class="jp"> React </em>组件，并向他提供了我们需要传递给它的状态，作为组件内部的<em class="jp"> props </em>。</p><p id="13a4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">哪些组件应该是容器/智能组件，哪些应该是哑组件？<strong class="it hv">当一个组件需要从我们的<em class="jp"> Redux存储</em>中了解某个特定的状态时，那么它就需要成为一个容器。</strong></p><p id="af99" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要将一个组件与<em class="jp"> Redux Store </em>连接起来，我们需要从react-redux库中导入connect函数，并向其传递一些要描述的参数。</p><p id="80eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们假设在一个名为ContactList的组件中有一个联系人列表，我们需要将它连接到<em class="jp"> Redux Store </em>。</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="2a9b" class="ly kn hu lu b fv lz ma l mb mc">import React, {Component} from 'react'</span><span id="6598" class="ly kn hu lu b fv md ma l mb mc">import {connect} from 'react-redux'</span><span id="a1e0" class="ly kn hu lu b fv md ma l mb mc">import selectContact from '../actions/action_select_contact'</span><span id="c858" class="ly kn hu lu b fv md ma l mb mc">import {bindActionCreators} from 'redux'</span><span id="5d85" class="ly kn hu lu b fv md ma l mb mc">class ContactList extends Component {</span><span id="ba4e" class="ly kn hu lu b fv md ma l mb mc">  renderList() {</span><span id="e889" class="ly kn hu lu b fv md ma l mb mc">    return this.props.contacts.map((contact) =&gt; {</span><span id="ee21" class="ly kn hu lu b fv md ma l mb mc">      return (</span><span id="1e69" class="ly kn hu lu b fv md ma l mb mc">        &lt;li</span><span id="5d12" class="ly kn hu lu b fv md ma l mb mc">          key={contact.phone}</span><span id="0e2e" class="ly kn hu lu b fv md ma l mb mc">          onClick={() =&gt; this.props.selectContact(contact)}</span><span id="5c56" class="ly kn hu lu b fv md ma l mb mc">          className='list-group-item'&gt;{contact.name}&lt;/li&gt;</span><span id="3caa" class="ly kn hu lu b fv md ma l mb mc">      );</span><span id="8614" class="ly kn hu lu b fv md ma l mb mc">    });</span><span id="b9e3" class="ly kn hu lu b fv md ma l mb mc">  }</span><span id="82e6" class="ly kn hu lu b fv md ma l mb mc">  render() {</span><span id="6db0" class="ly kn hu lu b fv md ma l mb mc">    return (</span><span id="cc25" class="ly kn hu lu b fv md ma l mb mc">      &lt;ul className = 'list-group col-sm-4'&gt;</span><span id="7bc2" class="ly kn hu lu b fv md ma l mb mc">        {this.renderList()}</span><span id="83de" class="ly kn hu lu b fv md ma l mb mc">      &lt;/ul&gt;</span><span id="7859" class="ly kn hu lu b fv md ma l mb mc">    );</span><span id="c20e" class="ly kn hu lu b fv md ma l mb mc">  }</span><span id="d78b" class="ly kn hu lu b fv md ma l mb mc">}<br/> </span><span id="0fb7" class="ly kn hu lu b fv md ma l mb mc">function mapStateToProps(state) {</span><span id="8e88" class="ly kn hu lu b fv md ma l mb mc">  return {</span><span id="0df6" class="ly kn hu lu b fv md ma l mb mc">    contacts: state.contacts</span><span id="62bf" class="ly kn hu lu b fv md ma l mb mc">  };</span><span id="a50b" class="ly kn hu lu b fv md ma l mb mc">}</span><span id="dc76" class="ly kn hu lu b fv md ma l mb mc">export default connect(mapStateToProps[,...later...])(ContactList)</span></pre><p id="748d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意mapStateToProps函数将如何接收<em class="jp"> Redux Store </em>的<strong class="it hv">整体</strong>状态，我们必须从中选择对我们来说<strong class="it hv">感兴趣的部分，返回一个将被用作ContactList道具的对象。如果我们返回下面的对象</strong></p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="e1dd" class="ly kn hu lu b fv lz ma l mb mc">function mapStateToProps(state) {</span><span id="57c5" class="ly kn hu lu b fv md ma l mb mc">  return {</span><span id="36b0" class="ly kn hu lu b fv md ma l mb mc">    amazingContacts: state.contacts<!-- --> </span><span id="77e1" class="ly kn hu lu b fv md ma l mb mc">  }<br/>}</span></pre><p id="9bc3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦连接到联系人列表，就可以通过this.props.amazingContacts访问</p><h1 id="e3c6" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">3.行动</h1><p id="7943" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">如果你仔细考虑这个组件，你会意识到一些非常重要的事情:<strong class="it hv">我们只是在读取</strong>，但是我们没有办法修改组件的状态。为此，我们需要<strong class="it hv">动作创建者</strong>来生成动作。然后，这些动作将被传递给合并到我们的rootReducer中的所有Reducer，它们中的每一个都将根据请求的动作返回一个修改(或未修改)状态的新副本。我们的reducer现在看起来像这样(注意默认情况，因为我们总是必须返回一个状态</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="75e5" class="ly kn hu lu b fv lz ma l mb mc">// reducer_active_contact.js</span><span id="fcc8" class="ly kn hu lu b fv md ma l mb mc">export default function(state = null, action) {</span><span id="5170" class="ly kn hu lu b fv md ma l mb mc">  switch (action.type) {</span><span id="c644" class="ly kn hu lu b fv md ma l mb mc">    case 'CONTACT_SELECTED':</span><span id="4e82" class="ly kn hu lu b fv md ma l mb mc">      return action.payload</span><span id="4f6c" class="ly kn hu lu b fv md ma l mb mc">  }<!-- --> </span><span id="277f" class="ly kn hu lu b fv md ma l mb mc">  // i dont care about the action because it is not inside my</span><span id="b8e2" class="ly kn hu lu b fv md ma l mb mc">  // list of actions I am interested int (case statements inside the switch)</span><span id="338f" class="ly kn hu lu b fv md ma l mb mc">  return state</span><span id="96be" class="ly kn hu lu b fv md ma l mb mc">}</span></pre><p id="65ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还有工作要做，我们必须创建动作创建者，这是一个函数的<em class="jp">花哨的</em>名称，该函数返回一个包含两个元素的对象:<em class="jp">类型</em>和<em class="jp">有效负载</em>。在这两个元素中，唯一必需的元素(包括名称类型)是类型。</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="eca0" class="ly kn hu lu b fv lz ma l mb mc">// actions/action_select_contact.js</span><span id="a958" class="ly kn hu lu b fv md ma l mb mc">function selectContact(contact) {</span><span id="e47c" class="ly kn hu lu b fv md ma l mb mc">  return {</span><span id="b6b5" class="ly kn hu lu b fv md ma l mb mc">    type: 'CONTACT_SELECTED',</span><span id="28fb" class="ly kn hu lu b fv md ma l mb mc">    payload: contact</span><span id="393e" class="ly kn hu lu b fv md ma l mb mc">  }</span><span id="53af" class="ly kn hu lu b fv md ma l mb mc">}</span><span id="490c" class="ly kn hu lu b fv md ma l mb mc">export default selectContact;</span></pre><p id="2339" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们可以有一个创建动作的函数，但是这些动作必须流经<em class="jp"> Redux </em>。我们如何让动作流过<em class="jp">Redux reducer</em>？通过<strong class="it hv">连接</strong>功能！那是秘密函数的参数</p><p id="83e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">mapDispatchToProps:</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="6a90" class="ly kn hu lu b fv lz ma l mb mc">// ... some other imports...</span><span id="33f5" class="ly kn hu lu b fv md ma l mb mc">import selectContact from '../actions/action_select_contact'</span><span id="14d4" class="ly kn hu lu b fv md ma l mb mc">import {bindActionCreators} from 'redux'</span><span id="aa60" class="ly kn hu lu b fv md ma l mb mc">// The ContactList component goes here</span><span id="9afc" class="ly kn hu lu b fv md ma l mb mc">// mapStateToProps is here</span><span id="219c" class="ly kn hu lu b fv md ma l mb mc">function mapDispatchToProps(dispatch) {</span><span id="d634" class="ly kn hu lu b fv md ma l mb mc">  return bindActionCreators({selectContact: selectContact}, dispatch);</span><span id="fb0d" class="ly kn hu lu b fv md ma l mb mc">}</span><span id="92f3" class="ly kn hu lu b fv md ma l mb mc">export default connect(mapStateToProps, mapDispatchToProps)(ContactList)</span></pre><p id="3247" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个函数确保无论何时触发selectContact动作，它返回的任何内容都将流经所有的reducers。如果我们有更多的动作，它会为每个动作做同样的事情。请注意，名称可能与对象不同:</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="c893" class="ly kn hu lu b fv lz ma l mb mc">function mapDispatchToProps(dispatch) {</span><span id="af61" class="ly kn hu lu b fv md ma l mb mc">  return bindActionCreators({</span><span id="7558" class="ly kn hu lu b fv md ma l mb mc">    myAction1: action1,</span><span id="22b9" class="ly kn hu lu b fv md ma l mb mc">    myAction2: action2</span><span id="dd99" class="ly kn hu lu b fv md ma l mb mc">  }, dispatch);</span><span id="06cb" class="ly kn hu lu b fv md ma l mb mc">}</span></pre><p id="703b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，我们在ContactList组件中的props也将包含我们连接的动作(selectContact，myAction1，myAction2…)</p><p id="726f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">ContactList组件的结果如下所示:</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="2437" class="ly kn hu lu b fv lz ma l mb mc">import React, {Component} from 'react'</span><span id="c034" class="ly kn hu lu b fv md ma l mb mc">import {connect} from 'react-redux'</span><span id="2a36" class="ly kn hu lu b fv md ma l mb mc">import selectContact from '../actions/action_select_contact'</span><span id="ec93" class="ly kn hu lu b fv md ma l mb mc">import {bindActionCreators} from 'redux'</span><span id="a706" class="ly kn hu lu b fv md ma l mb mc">class ContactList extends Component {</span><span id="ac8a" class="ly kn hu lu b fv md ma l mb mc">  renderList() {</span><span id="d025" class="ly kn hu lu b fv md ma l mb mc">    return this.props.contacts.map((contact) =&gt; {</span><span id="f980" class="ly kn hu lu b fv md ma l mb mc">      return (</span><span id="6b26" class="ly kn hu lu b fv md ma l mb mc">        &lt;li</span><span id="320c" class="ly kn hu lu b fv md ma l mb mc">          key={contact.phone}</span><span id="245c" class="ly kn hu lu b fv md ma l mb mc">          onClick={() =&gt; this.props.selectContact(contact)}</span><span id="5ec6" class="ly kn hu lu b fv md ma l mb mc">          className='list-group-item'&gt;{contact.name}&lt;/li&gt;</span><span id="dfb5" class="ly kn hu lu b fv md ma l mb mc">      );</span><span id="7cc9" class="ly kn hu lu b fv md ma l mb mc">    });</span><span id="0939" class="ly kn hu lu b fv md ma l mb mc">  }</span><span id="fe70" class="ly kn hu lu b fv md ma l mb mc">  render() {<!-- --> </span><span id="5dcb" class="ly kn hu lu b fv md ma l mb mc">    return (</span><span id="1f16" class="ly kn hu lu b fv md ma l mb mc">      &lt;ul className = 'list-group col-sm-4'&gt;</span><span id="f655" class="ly kn hu lu b fv md ma l mb mc">        {this.renderList()}</span><span id="8a9b" class="ly kn hu lu b fv md ma l mb mc">      &lt;/ul&gt;</span><span id="d2fd" class="ly kn hu lu b fv md ma l mb mc">    );</span><span id="f817" class="ly kn hu lu b fv md ma l mb mc">  }</span><span id="a26d" class="ly kn hu lu b fv md ma l mb mc">}</span><span id="fe13" class="ly kn hu lu b fv md ma l mb mc">function mapStateToProps(state) {</span><span id="79c0" class="ly kn hu lu b fv md ma l mb mc">  return {</span><span id="e39e" class="ly kn hu lu b fv md ma l mb mc">    contacts: state.contacts</span><span id="db34" class="ly kn hu lu b fv md ma l mb mc">  };</span><span id="207a" class="ly kn hu lu b fv md ma l mb mc">}</span><span id="d253" class="ly kn hu lu b fv md ma l mb mc">function mapDispatchToProps(dispatch) {</span><span id="04f9" class="ly kn hu lu b fv md ma l mb mc">  return bindActionCreators({<br/>    selectContact: selectContact<br/>  }, dispatch);</span><span id="3e18" class="ly kn hu lu b fv md ma l mb mc">}</span><span id="5837" class="ly kn hu lu b fv md ma l mb mc">export default connect(mapStateToProps, mapDispatchToProps)(ContactList)</span></pre><p id="d272" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来的步骤是:</p><ol class=""><li id="ac91" class="jy jz hu it b iu iv iy iz jc ka jg kb jk kc jo kd ke kf kg dt translated">减压器内部(注意复数)根据收到的动作类型采取动作</li><li id="0b19" class="jy jz hu it b iu kh iy ki jc kj jg kk jk kl jo kd ke kf kg dt translated">更新状态(这将触发受影响组件的重新渲染)</li></ol><p id="3bbe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们的例子中，唯一关心所选联系人的reducer是ActiveContactReducer，我们还没有创建它，但是我们现在将要创建它。</p><p id="09a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">减速器接收两个参数:它们关心的状态片段(不是整个状态)和流经减速器的电流动作。记住，它们返回该状态的一个新的<strong class="it hv">副本</strong>，该副本根据接收到的动作进行修改。</p><p id="8173" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这种情况下，activeContact状态将被更新为action.payload中包含的Contact。无论函数返回什么，都将按原样分配给reducer正在处理的状态。缩减器必须总是返回一些东西:</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="4d63" class="ly kn hu lu b fv lz ma l mb mc">//reducer_active_contact</span><span id="efd0" class="ly kn hu lu b fv md ma l mb mc">export default function (state = null, action) {</span><span id="e92e" class="ly kn hu lu b fv md ma l mb mc">  switch (action.type) {</span><span id="5174" class="ly kn hu lu b fv md ma l mb mc">    case 'CONTACT_SELECTED':</span><span id="94b8" class="ly kn hu lu b fv md ma l mb mc">      return action.payload</span><span id="b3b5" class="ly kn hu lu b fv md ma l mb mc">  }</span><span id="7650" class="ly kn hu lu b fv md ma l mb mc">  return state;</span><span id="c530" class="ly kn hu lu b fv md ma l mb mc"> }</span></pre><p id="9bc4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，为了显示一个或另一个联系人，我们需要一个<contactdetail>容器(记住，它是一个容器，因为它关心<em class="jp"> Redux存储的一部分状态)。</em></contactdetail></p><p id="2878" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以，我们现在必须:</p><ol class=""><li id="4d28" class="jy jz hu it b iu iv iy iz jc ka jg kb jk kc jo kd ke kf kg dt translated">创建一个<contactdetail>组件</contactdetail></li><li id="c476" class="jy jz hu it b iu kh iy ki jc kj jg kk jk kl jo kd ke kf kg dt translated">将组件连接到<em class="jp"> Redux Store </em></li><li id="ce25" class="jy jz hu it b iu kh iy ki jc kj jg kk jk kl jo kd ke kf kg dt translated">将reducer添加到rootReducer</li></ol><p id="d413" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦完成，<contactdetail>组件将最后显示。</contactdetail></p><p id="ff90" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要将组件连接到<em class="jp"> Redux Store </em>，与之前相同:mapStateToProps函数作为参数与组件一起传递给connect函数，并导出容器。</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="d8de" class="ly kn hu lu b fv lz ma l mb mc">// inside containers/contact-detail.js</span><span id="3a84" class="ly kn hu lu b fv md ma l mb mc">import { connect } from 'react-redux'</span><span id="8476" class="ly kn hu lu b fv md ma l mb mc">// ... ContactDetail component here ...</span><span id="a642" class="ly kn hu lu b fv md ma l mb mc">function mapStateToProps(state) {</span><span id="f734" class="ly kn hu lu b fv md ma l mb mc">  return {</span><span id="fa7f" class="ly kn hu lu b fv md ma l mb mc">    contact: state.activeContact <br/>    //activeContact is defined in the rootReducer</span><span id="9e80" class="ly kn hu lu b fv md ma l mb mc">  }</span><span id="ea14" class="ly kn hu lu b fv md ma l mb mc">}</span><span id="8412" class="ly kn hu lu b fv md ma l mb mc">export default connect(.....)</span></pre><p id="b95e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">reducer以与ContactReducer相同的方式添加到rootReducer中</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="1d97" class="ly kn hu lu b fv lz ma l mb mc">import { combineReducers } from 'redux';</span><span id="c0ec" class="ly kn hu lu b fv md ma l mb mc">import ContactsReducer from './reducer_contacts'</span><span id="7670" class="ly kn hu lu b fv md ma l mb mc">import ActiveContactReducer from './reducer_active_contact'</span><span id="fb32" class="ly kn hu lu b fv md ma l mb mc">const rootReducer = combineReducers({</span><span id="d299" class="ly kn hu lu b fv md ma l mb mc">  contacts: ContactsReducer,</span><span id="e7fe" class="ly kn hu lu b fv md ma l mb mc">  activeContact: ActiveContactReducer</span><span id="003b" class="ly kn hu lu b fv md ma l mb mc">});</span><span id="b439" class="ly kn hu lu b fv md ma l mb mc">export default rootReducer;</span></pre><h1 id="644e" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">流程摘要</h1><p id="1de3" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">现在一切都连接好了，所以单击列表中的一个联系人应该会触发selectContact action creator，它将被传递给rootReducer中的每个reducer。ActiveContactReducer将通过改变它所控制的状态(<em class="jp"> activeContact </em>)来对该动作作出反应，将它设置为action.payload中的selectedContact，当这种情况发生时，&lt; ContactDetail &gt;将看到它的状态被修改，并将被重新呈现，为this.props.contact提供一个新值。</p><p id="8837" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><contactdetail>将如下所示:</contactdetail></p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="ef39" class="ly kn hu lu b fv lz ma l mb mc">import React, { Component } from 'react'</span><span id="a386" class="ly kn hu lu b fv md ma l mb mc">import { connect } from 'react-redux'</span><span id="8992" class="ly kn hu lu b fv md ma l mb mc">class ContactDetail extends Component {</span><span id="fb3a" class="ly kn hu lu b fv md ma l mb mc">  render() {</span><span id="9574" class="ly kn hu lu b fv md ma l mb mc">    if (!this.props.contact) {</span><span id="e33f" class="ly kn hu lu b fv md ma l mb mc">      return (</span><span id="634d" class="ly kn hu lu b fv md ma l mb mc">        &lt;div&gt;Select a contact from the list to see its details&lt;/div&gt;</span><span id="cc20" class="ly kn hu lu b fv md ma l mb mc">      );</span><span id="64ae" class="ly kn hu lu b fv md ma l mb mc">    }<!-- --> </span><span id="8bbd" class="ly kn hu lu b fv md ma l mb mc">    return (</span><span id="4bad" class="ly kn hu lu b fv md ma l mb mc">      &lt;div&gt;</span><span id="5137" class="ly kn hu lu b fv md ma l mb mc">        &lt;h3&gt;Contact Details for: {this.props.contact.name}&lt;/h3&gt;</span><span id="65b6" class="ly kn hu lu b fv md ma l mb mc">        &lt;div&gt;Phone: {this.props.contact.phone}&lt;/div&gt;</span><span id="8b28" class="ly kn hu lu b fv md ma l mb mc">      &lt;/div&gt;</span><span id="fed0" class="ly kn hu lu b fv md ma l mb mc">    );</span><span id="0c03" class="ly kn hu lu b fv md ma l mb mc">  }</span><span id="3e7b" class="ly kn hu lu b fv md ma l mb mc">}</span><span id="005d" class="ly kn hu lu b fv md ma l mb mc">function mapStateToProps(state) {</span><span id="7a90" class="ly kn hu lu b fv md ma l mb mc">  return {</span><span id="706f" class="ly kn hu lu b fv md ma l mb mc">    contact: state.activeContact</span><span id="9e09" class="ly kn hu lu b fv md ma l mb mc">  }</span><span id="3a2e" class="ly kn hu lu b fv md ma l mb mc">}</span><span id="3616" class="ly kn hu lu b fv md ma l mb mc">export default connect(mapStateToProps)(ContactDetail);</span></pre><h1 id="daf9" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">决赛成绩</h1><p id="b87f" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">最终的结果并不令人惊讶，但它是有效的，你可以在这张GIF图片中看到:</p><figure class="lp lq lr ls fq mf fe ff paragraph-image"><div class="fe ff me"><img src="../Images/9102721d7d068e074832281093ec831b.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*W663VYEYuG4c4FoeIVJQxQ.gif"/></div><figcaption class="mi mj fg fe ff mk ml bd b be z ek">The Contacts Application in action</figcaption></figure><h1 id="cada" class="km kn hu bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">所有的东西是如何连接在一起的？</h1><p id="ba61" class="pw-post-body-paragraph ir is hu it b iu lk iw ix iy ll ja jb jc lm je jf jg ln ji jj jk lo jm jn jo hn dt translated">好了，这一切就像魔术一样…我的应用程序最初是如何知道我的减速器在哪里和在哪里的？(请记住，状态是通过组合所有的归约器和组合归约器来定义的)</p><p id="07f0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是在我们的主文件中完成的，在这里我们使用<provider>组件定义应用程序，该组件接收存储，使它对它包装的组件可用。</provider></p><p id="47da" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了传递存储(记住，这是rootReducer ),我们将把它与applyMiddleware函数结合起来，该函数将保存我们的中间件(当我们需要它们时),并在到达应用程序之前通过它们传递<em class="jp">状态</em>。</p><pre class="lp lq lr ls fq lt lu lv lw aw lx dt"><span id="35bb" class="ly kn hu lu b fv lz ma l mb mc">import React from 'react';</span><span id="ef17" class="ly kn hu lu b fv md ma l mb mc">import ReactDOM from 'react-dom';</span><span id="1385" class="ly kn hu lu b fv md ma l mb mc">import { Provider } from 'react-redux';</span><span id="d90e" class="ly kn hu lu b fv md ma l mb mc">import { createStore, applyMiddleware } from 'redux';</span><span id="eabe" class="ly kn hu lu b fv md ma l mb mc">import App from './components/app';</span><span id="df85" class="ly kn hu lu b fv md ma l mb mc">import reducers from './reducers'; // this exports rootReducer!!!</span><span id="5e40" class="ly kn hu lu b fv md ma l mb mc">const createStoreWithMiddleware = applyMiddleware()(createStore);</span><span id="61f5" class="ly kn hu lu b fv md ma l mb mc">ReactDOM.render(</span><span id="f238" class="ly kn hu lu b fv md ma l mb mc">  &lt;Provider store={createStoreWithMiddleware(reducers)}&gt;</span><span id="3f09" class="ly kn hu lu b fv md ma l mb mc">   &lt;App /&gt;</span><span id="c60d" class="ly kn hu lu b fv md ma l mb mc">  &lt;/Provider&gt;</span><span id="dc20" class="ly kn hu lu b fv md ma l mb mc">, document.querySelector('.container'));</span></pre><p id="da09" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">❤如果你觉得这个有用，可以考虑给我买杯❤咖啡</p><p id="309f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jq" href="https://www.buymeacoffee.com/mamoreno" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/mamoreno</a></p></div></div>    
</body>
</html>