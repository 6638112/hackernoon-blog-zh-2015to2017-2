<html>
<head>
<title>5 Commands you must learn when building AWS Serverless applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建AWS无服务器应用程序时必须学习的5个命令</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/5-commands-you-must-learn-when-building-aws-serverless-applications-989a78506cd1?source=collection_archive---------17-----------------------#2017-11-27">https://medium.com/hackernoon/5-commands-you-must-learn-when-building-aws-serverless-applications-989a78506cd1?source=collection_archive---------17-----------------------#2017-11-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/e75aee38b6a76f32dfe9a1696ea6a23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1KFmC2I3-VEojUYqUjOfug.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo courtesy of <a class="ae jg" href="https://pixabay.com/en/users/MustangJoe-2162920/" rel="noopener ugc nofollow" target="_blank">MustangJoe</a> on Pixabay</figcaption></figure><p id="d1fd" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">本周是<a class="ae jg" href="https://reinvent.awsevents.com/" rel="noopener ugc nofollow" target="_blank">重塑</a>，最大的<a class="ae jg" href="https://hackernoon.com/tagged/tech" rel="noopener ugc nofollow" target="_blank">云计算技术</a>会议。我将在那里了解最新的创新和使用案例。我今年的主要兴趣是围绕一种流行的建筑基础设施风格，这种风格被称为“<a class="ae jg" href="https://hackernoon.com/tagged/serverless" rel="noopener ugc nofollow" target="_blank">无服务器</a>”。它简单、快速，而且比需要直接管理主机的传统基础架构更便宜。</p><p id="b477" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">随着我对这个新模型的使用越来越成熟，我已经学会了如何从命令行控制这些服务。AWS控制台对于开始使用可能是有用的，但对于日常基础设施管理来说不是一种有效的方式。在下面的博客中，我将分享我学到的五个最强大的命令，每个软件开发人员都应该知道。</p><h1 id="e9bc" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">1-检查用户或角色凭据</h1><p id="5fb0" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">与传统的基于网络的安全性相比，无服务器模式依赖于基于凭证的安全性。这意味着学习身份和访问管理(IAM)服务，以及如何检查针对不同实体的策略。这包括您将用于执行CLI的凭据。这是开始的最好地方。</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="18a9" class="lr kg hu ln b fv ls lt l lu lv"># check the current aws credentials used, similar to whoami<br/>aws iam get-user</span><span id="7688" class="lr kg hu ln b fv lw lt l lu lv"># check the user policies that are attached to the user name<br/>aws iam list-attached-user-policies — user-name myawsusername</span><span id="2ddc" class="lr kg hu ln b fv lw lt l lu lv"># check the group policies that are attached to the user name<br/>aws iam list-groups-for-user --user-name myawsusername</span><span id="ebb8" class="lr kg hu ln b fv lw lt l lu lv"># check for access keys granted to a user name<br/>aws iam list-access-keys --user-name myawsusername</span><span id="a129" class="lr kg hu ln b fv lw lt l lu lv"># check for roles within an account<br/>aws iam list-roles</span></pre><p id="23e0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在AWS中构建安全的应用程序只需要授权绝对需要的内容，仅此而已。根据最小特权原则，经常检查已经授予的权限是非常必要的。</p><h1 id="722e" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">2-执行Lambda函数</h1><p id="0373" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">让我们从基础开始。自动化测试用例对于构建健壮的应用程序至关重要。每个函数都可以从命令行调用，事件数据从本地文件传入。下面是这样做的步骤。</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="c85a" class="lr kg hu ln b fv ls lt l lu lv"># read request data into a local variable<br/>request=$(&lt;request.json)</span><span id="2e3e" class="lr kg hu ln b fv lw lt l lu lv"># invoke the function with the data, and write to local file<br/>aws lambda invoke --function-name myFunction --payload "$request" response.json</span><span id="d148" class="lr kg hu ln b fv lw lt l lu lv"># read response file into local variable then print to the console<br/>responseOutput=$(&lt;response.json)<br/>echo $responseOutput</span></pre><p id="1cdc" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">一旦你有了这个模式，自动化测试就被激活了。这为运行许多测试场景的验证奠定了基础。该脚本的几行附加代码可以在输出文件和预期结果之间进行比较。像所有的测试自动化一样，这需要前期投资。回报是巨大的，在构建健壮的应用程序时，这是必须的。</p><h1 id="b96a" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">3—在本地主机和S3之间移动文件</h1><p id="19a1" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">存储用于很多事情，包括媒体文件、二进制文件、测试数据等。简单存储服务(S3)非常耐用，并且成本非常低，因为定价只要求为消耗的内容付费。S3是基于数据块的存储(如连接到EC2主机的EBS卷)的绝佳替代方案。</p><p id="ffd1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了有效地使用S3，需要把它想象成一个弹性驱动器——只是一个从未安装到机器上的驱动器。管理该服务的命令是健壮的，并且模拟了您已经熟悉的大多数相同的Linux存储命令。</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="9d53" class="lr kg hu ln b fv ls lt l lu lv"># copy a local file to a s3 bucket and folder<br/>aws s3 cp foo.json s3://mybucket/myfolder</span><span id="adc6" class="lr kg hu ln b fv lw lt l lu lv"># retrieve a local file from a s3 bucket<br/>aws s3 cp s3://mybucket/myfolder foo.json</span><span id="3424" class="lr kg hu ln b fv lw lt l lu lv"># list all buckets within an account<br/>aws s3 ls</span><span id="5254" class="lr kg hu ln b fv lw lt l lu lv"># list all of the objects and folder within a bucket<br/>aws s3 ls s3://mybucket</span><span id="4e83" class="lr kg hu ln b fv lw lt l lu lv"># test removal (aka dry run) of an object from a s3 bucket<br/>aws s3 rm s3://mybucket/myfolder/foo.json --dryrun</span><span id="7234" class="lr kg hu ln b fv lw lt l lu lv"># remove an object from a S3 bucket<br/>aws s3 rm s3://mybucket/myfolder/foo.json</span></pre><p id="6ccc" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae jg" href="http://docs.aws.amazon.com/cli/latest/reference/index.html#cli-aws" rel="noopener ugc nofollow" target="_blank">这里的</a>是继续学习的官方参考指南，包括可以使用查询过滤对象的可选命令。</p><h1 id="aac9" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">4-更新现有的Lambda函数</h1><p id="d637" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">既然您可以从命令行执行Lambda函数，并且知道如何移动数据，接下来就是自动化部署管道。这可以通过创建一个构建包来完成，在S3进行(使用上面的#3)，然后将它部署到运行时环境中。下面是这样做所需的命令。</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="6cb2" class="lr kg hu ln b fv ls lt l lu lv"># first create a zip file containing all elements in the package<br/># note directory/ is what includes libraries in the zip<br/>zip -r myfunction.zip lambda.js directory/ package.json</span><span id="8b17" class="lr kg hu ln b fv lw lt l lu lv"># then copy the zip file to S3<br/>aws s3 cp myFunction.zip s3://mybucket/myfolder</span><span id="6ea0" class="lr kg hu ln b fv lw lt l lu lv"># finally deploy the package to the runtime environment<br/>aws lambda update-function-code --function-name myFunction --s3-bucket mybucket --s3-key myfunction.zip</span></pre><p id="d395" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">一旦您准备好了，添加一些自动化测试用例来验证部署是否成功。这是自动化部署管道的基础。</p><h1 id="9be4" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">5-创建新的Lambda函数</h1><p id="51bf" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">当服务是细粒度的时，基于功能的架构工作得最好。供应过程的自动化实现了创建新功能的一致性，因为该功能的许多属性是相同的(即，语言、执行角色)。</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="7872" class="lr kg hu ln b fv ls lt l lu lv"># first create a zip file containing all elements in the package<br/># note directory/ is what includes libraries in the zip<br/>zip -r myfunction.zip lambda.js directory/ package.json</span><span id="acda" class="lr kg hu ln b fv lw lt l lu lv"># create a new function based on the parameters and zip package<br/>aws lambda create-function --function-name newFunction --runtime nodejs6.10 --role arn:aws:iam::1234567890:role/lex_execution --handler lambda --zip-file "fileb://myfunction.zip"</span><span id="bda4" class="lr kg hu ln b fv lw lt l lu lv"># note: runtime options include nodejs6.10, java8, python2.7</span></pre><p id="7d09" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这个命令有<a class="ae jg" href="http://docs.aws.amazon.com/cli/latest/reference/lambda/create-function.html" rel="noopener ugc nofollow" target="_blank">许多不同的可选参数</a>，也有使用<a class="ae jg" href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-lambda.html" rel="noopener ugc nofollow" target="_blank">云形成模板</a>做同样工作的选项。学习这个命令可以使创建新函数变得像更新现有函数一样容易，甚至可能使现有函数过载。</p><h1 id="7aa0" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">结论</h1><p id="4c06" class="pw-post-body-paragraph jh ji hu jj b jk ld jm jn jo le jq jr js lf ju jv jw lg jy jz ka lh kc kd ke hn dt translated">使用这些命令简化了无服务器架构的管理，使您可以专注于编写代码，而不是管理基础架构！</p><figure class="li lj lk ll fq iv"><div class="bz el l di"><div class="lx ly l"/></div></figure></div></div>    
</body>
</html>