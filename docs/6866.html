<html>
<head>
<title>Building a Blockchain DApp using truffle, React, Next.js and MobX (part I)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用truffle、React、Next.js和MobX构建区块链DApp(第一部分)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/building-a-blockchain-dapp-using-truffle-react-next-js-and-mobx-part-i-c46d218f4bdf?source=collection_archive---------3-----------------------#2017-10-08">https://medium.com/hackernoon/building-a-blockchain-dapp-using-truffle-react-next-js-and-mobx-part-i-c46d218f4bdf?source=collection_archive---------3-----------------------#2017-10-08</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/7283514e488de66d28d7578a254e5643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1W2Zn1-V9eGdrfK4gYPvVA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Screenshot from the live app.</figcaption></figure><p id="9806" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这篇文章将带领React开发者在<a class="ae ke" href="https://hackernoon.com/tagged/blockchain" rel="noopener ugc nofollow" target="_blank">区块链</a>上构建你的第一个分布式应用。</p><p id="e994" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">似乎科技行业的每个人(几乎每个人)都在谈论<a class="ae ke" href="https://hackernoon.com/tagged/bitcoin" rel="noopener ugc nofollow" target="_blank">、比特币</a>、区块链和分布式应用。这引起了我的兴趣，所以我想使用这种技术构建一些有用的东西，以更好地了解这一领域的挑战和机遇。这篇文章是描述我构建第一个分布式以太坊区块链应用程序的经历的两篇文章中的第一篇。</p><p id="e43b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我将介绍构建智能合约所需的步骤，如何编译并将其部署到本地区块链网络，以及如何构建服务器端渲染React应用程序，以便与我们的合约进行交互。</p><p id="c287" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在进入代码之前，我建议大家在继续之前，先浏览一下松露网站上的<a class="ae ke" href="http://truffleframework.com/tutorials/ethereum-overview" rel="noopener ugc nofollow" target="_blank">以太坊概述</a>。</p><p id="52fc" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在这篇文章中，我将回顾:</p><ol class=""><li id="523c" class="kf kg hu ji b jj jk jn jo jr kh jv ki jz kj kd kk kl km kn dt translated">设置开发环境</li><li id="bc93" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd kk kl km kn dt translated">编写和测试智能合同</li><li id="9df5" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd kk kl km kn dt translated">编译和部署我们的智能合同</li></ol><h2 id="bff2" class="kt ku hu bd kv kw kx ky kz la lb lc ld jr le lf lg jv lh li lj jz lk ll lm ln dt translated"><a class="ae ke" href="https://tvdapp.herokuapp.com" rel="noopener ugc nofollow" target="_blank">我们的DApp </a> ( <em class="lo">分散应用)</em></h2><p id="0d15" class="pw-post-body-paragraph jg jh hu ji b jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz lt kb kc kd hn dt translated">由于秋季电视季刚刚在美国开始，我们希望使用区块链(以太坊)作为一种有效的方式来处理用户和他们喜爱的电视节目的映射。</p><p id="05fb" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">该应用程序显示了来自非官方API的烂番茄列表。分为三类:新鲜，新，流行。</p><p id="68a2" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">应用程序“书签”中的一个特殊部分显示了当前存储在区块链上的用户最喜爱的节目列表。</p><p id="2cc7" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">用户可以在他们的书签部分添加或删除节目。每次用户添加或删除节目时，都会调用智能合约功能，并将更改存储在区块链上。</p><p id="9fe4" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">前端应用程序是由<a class="ae ke" href="https://github.com/zeit/next.js/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>支持的服务器端渲染React应用程序，对于状态管理，我们将使用M <a class="ae ke" href="https://mobx.js.org/" rel="noopener ugc nofollow" target="_blank"> ob </a> X，样式和布局将来自令人敬畏的<a class="ae ke" href="http://tachyons.io/" rel="noopener ugc nofollow" target="_blank"> tachyons </a>项目，为了与区块链交互，我们将在solidity中编写一个智能联系人，用JavaScript为其编写测试，并使用<a class="ae ke" href="http://truffleframework.com/" rel="noopener ugc nofollow" target="_blank"> truffle </a>在本地部署它。</p><h2 id="f212" class="kt ku hu bd kv kw kx ky kz la lb lc ld jr le lf lg jv lh li lj jz lk ll lm ln dt translated">设置开发环境</h2><p id="5732" class="pw-post-body-paragraph jg jh hu ji b jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz lt kb kc kd hn dt translated">在开始之前，请确保您已经安装了node、git和nvm。</p><p id="9273" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">首先我们需要安装TestRpc和Truffle:</p><ul class=""><li id="dccc" class="kf kg hu ji b jj jk jn jo jr kh jv ki jz kj kd lu kl km kn dt translated"><code class="eh lv lw lx ly b">npm install -g ethereumjs-testrpc</code></li><li id="df92" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd lu kl km kn dt translated"><code class="eh lv lw lx ly b">npm install -g truffle</code></li></ul><p id="1ef8" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在克隆应用程序并安装依赖项:</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="828c" class="kt ku hu ly b fv mh mi l mj mk">//clone the repo<br/>git clone <a class="ae ke" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:liors/tvdapp.git</span><span id="332e" class="kt ku hu ly b fv ml mi l mj mk">// Navigate to within the directory<br/>cd tvdapp</span><span id="6c54" class="kt ku hu ly b fv ml mi l mj mk">//install dependencies<br/>yarn install</span></pre><h2 id="ba13" class="kt ku hu bd kv kw kx ky kz la lb lc ld jr le lf lg jv lh li lj jz lk ll lm ln dt translated">实施智能合同</h2><p id="b0df" class="pw-post-body-paragraph jg jh hu ji b jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz lt kb kc kd hn dt translated">我们的应用程序使用区块链来存储用户最喜欢的节目。为了做到这一点，我们需要实现一个智能契约，作为其后端逻辑和存储。</p><p id="d33f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在/contracts目录下，可以找到一个Bookmark.sol文件:</p><figure class="lz ma mb mc fq iv"><div class="bz el l di"><div class="mm mn l"/></div></figure><p id="a8fd" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">如果你是solidity的新手(像我一样)，他们的docs <a class="ae ke" href="http://solidity.readthedocs.io/en/develop/solidity-by-example.html" rel="noopener ugc nofollow" target="_blank">站点</a>有一个“solidity by example”部分，我觉得非常有用。</p><p id="b141" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">关于合同的一些事情。我们首先声明一个我们称之为书签的契约。该契约有两个公共API。</p><ol class=""><li id="f81c" class="kf kg hu ji b jj jk jn jo jr kh jv ki jz kj kd kk kl km kn dt translated">书签——除了表示节目的字符串。我选择存储一个将在我们应用程序UI中重用的JSON。作为另一种方法，可以将引用ID存储到某个外部存储器中。</li><li id="205c" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd kk kl km kn dt translated">get bookmarks——它将返回每个帐户的节目数组。</li></ol><h2 id="de49" class="kt ku hu bd kv kw kx ky kz la lb lc ld jr le lf lg jv lh li lj jz lk ll lm ln dt translated">测试智能合约</h2><p id="53ff" class="pw-post-body-paragraph jg jh hu ji b jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz lt kb kc kd hn dt translated">您可以用solidity或JavaScript编写智能合约的测试。</p><p id="c8ae" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">对于JavaScript测试，Truffle使用<a class="ae ke" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank"> Mocha </a>测试框架和<a class="ae ke" href="http://chaijs.com/" rel="noopener ugc nofollow" target="_blank"> Chai </a>进行断言。</p><p id="77c0" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在/tests目录下，您可以找到bookmark.js文件:</p><figure class="lz ma mb mc fq iv"><div class="bz el l di"><div class="mm mn l"/></div></figure><p id="abbe" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">为了运行测试，您首先必须有一个testrpc的本地实例。一旦您的EthereumJS TestRPC会话开始，您就可以执行测试:</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="45bc" class="kt ku hu ly b fv mh mi l mj mk">yarn test</span></pre><p id="1cd8" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">让我们来回顾一下我们想要涵盖的案例:</p><ol class=""><li id="699e" class="kf kg hu ji b jj jk jn jo jr kh jv ki jz kj kd kk kl km kn dt translated">一种情况是，客户请求为一个节目添加书签，在这种情况下，我们首先获取合同的实例，然后调用公共API“bookmark ”,该API将一个字符串作为第一个参数，并调用一个包含“from”属性的配置对象。然后，我们调用第二个getBookmarks公共API，结果我们得到一个承诺，该承诺在解析时应该包含我们传递给bookmark函数的show (string)。</li><li id="b048" class="kf kg hu ji b jj ko jn kp jr kq jv kr jz ks kd kk kl km kn dt translated">一个客户请求为一个节目列表添加书签的例子——与我们的第一个用例相同，但是现在我们想确保我们可以存储一个节目列表，因此我们将首先通过传递一个JSON对象数组为一些节目添加书签，并调用我们的get书签函数来验证我们的智能合同是否有效。</li></ol><h2 id="fd19" class="kt ku hu bd kv kw kx ky kz la lb lc ld jr le lf lg jv lh li lj jz lk ll lm ln dt translated">将我们的智能合同部署到本地区块链</h2><p id="89c9" class="pw-post-body-paragraph jg jh hu ji b jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz lt kb kc kd hn dt translated">我们刚刚实现并测试了我们的Bookmark Smart Contract，是时候编译它并将其迁移(部署)到我们的测试网络中了。</p><h2 id="d1c5" class="kt ku hu bd kv kw kx ky kz la lb lc ld jr le lf lg jv lh li lj jz lk ll lm ln dt translated">汇编</h2><p id="a8ef" class="pw-post-body-paragraph jg jh hu ji b jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz lt kb kc kd hn dt translated">坚固性是一种编译语言，这意味着我们需要将我们的坚固性编译成字节码，以便以太网虚拟机(EVM)执行。</p><ol class=""><li id="0db9" class="kf kg hu ji b jj jk jn jo jr kh jv ki jz kj kd kk kl km kn dt translated">启动一个新的终端窗口，并调用我们全局安装的testrpc模块:</li></ol><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="62eb" class="kt ku hu ly b fv mh mi l mj mk">testrpc</span></pre><p id="9a82" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这将启动一个本地的区块链以太网实例。</p><p id="cbda" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">2.现在，让我们编译我们实现的智能合同:</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="7fb6" class="kt ku hu ly b fv mh mi l mj mk">truffle compile</span></pre><p id="454a" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这将编译我们的。sol文件。您应该在build/contracts文件夹中看到作为JSON文件的编译输出。</p><h2 id="ead7" class="kt ku hu bd kv kw kx ky kz la lb lc ld jr le lf lg jv lh li lj jz lk ll lm ln dt translated">部署/迁移</h2><p id="06d6" class="pw-post-body-paragraph jg jh hu ji b jj lp jl jm jn lq jp jq jr lr jt ju jv ls jx jy jz lt kb kc kd hn dt translated">我使用了您运行块菌初始化时提供的默认迁移文件。您可以在/migrations/1 _ initial _ migration . js下找到它。</p><p id="90cc" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在/migration文件夹下，您还可以找到2_deploy_contracts.js。该文件需要我们的智能合同，即Bookmark.sol，并将其部署:</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="97c9" class="kt ku hu ly b fv mh mi l mj mk">const Bookmark = artifacts.require('./Bookmark.sol')</span><span id="3d97" class="kt ku hu ly b fv ml mi l mj mk">module.exports = deployer =&gt; deployer.deploy(Bookmark)</span></pre><p id="457c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">要执行此脚本，请运行:</p><pre class="lz ma mb mc fq md ly me mf aw mg dt"><span id="bac6" class="kt ku hu ly b fv mh mi l mj mk">truffle migrate</span></pre><p id="9995" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们刚刚将合同部署到本地Blockchain网络！</p><p id="1dc3" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在下一篇文章中，我们将浏览一下我们的React应用程序，看看我们如何使用Next.js、MobX和web3.js构建一个与我们刚刚实现的智能合同交互的用户界面。</p><p id="9685" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">该应用程序的完整代码可在<a class="ae ke" href="https://github.com/liors/tvdapp" rel="noopener ugc nofollow" target="_blank"> github </a>上找到。</p><p id="f741" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">该应用的实时版本已经部署在这里<a class="ae ke" href="https://tvdapp.herokuapp.com" rel="noopener ugc nofollow" target="_blank"/>——请确保你的浏览器能够运行dapp，我一直在使用<a class="ae ke" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank">元掩码</a> chrome扩展。</p><p id="0c1c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">谢谢你的阅读。希望这能有所帮助。</p><figure class="lz ma mb mc fq iv"><div class="bz el l di"><div class="mo mn l"/></div></figure></div></div>    
</body>
</html>