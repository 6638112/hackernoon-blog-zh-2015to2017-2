<html>
<head>
<title>Yet another MVP article — Part 4: RxJava and RxAndroid know how to response</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">另一篇MVP文章——第4部分:RxJava和RxAndroid知道如何响应</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/yet-another-mvp-article-part-4-rxjava-and-rxandroid-knows-how-to-response-cde42ccc4958?source=collection_archive---------1-----------------------#2016-12-04">https://medium.com/hackernoon/yet-another-mvp-article-part-4-rxjava-and-rxandroid-knows-how-to-response-cde42ccc4958?source=collection_archive---------1-----------------------#2016-12-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="612f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">使用</em> <strong class="it hv"> <em class="jp"> MVP </em> </strong> <em class="jp">，</em><strong class="it hv"><em class="jp">rx Java</em></strong><em class="jp">，</em><strong class="it hv"><em class="jp">Dagger 2</em></strong><em class="jp">，</em><strong class="it hv"><em class="jp">retro fit 2</em></strong><em class="jp">，</em><strong class="it hv"><em class="jp">Test</em></strong><em class="jp">，以及所有全新的现代方法和库</em></p><h1 id="8800" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">本文前情提要…</h1><div class="ko kp fm fo kq kr"><a href="https://hackernoon.com/yet-another-mvp-article-part-3-calling-apis-using-retrofit-23757f4eee05" rel="noopener  ugc nofollow" target="_blank"><div class="ks ab ej"><div class="kt ab ku cl cj kv"><h2 class="bd hv fv z el kw eo ep kx er et ht dt translated">另一篇MVP文章——第3部分:使用改型调用API</h2><div class="ky l"><h3 class="bd b fv z el kw eo ep kx er et ek translated">使用MVP、RxJava、Dagger 2、Retrofit2、Test和所有全新的现代技术实现一个示例Android应用程序…</h3></div><div class="kz l"><p class="bd b gc z el kw eo ep kx er et ek translated">hackernoon.com</p></div></div><div class="la l"><div class="lb l lc ld le la lf lg kr"/></div></div></a></div><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/a515d82a58411a8153f93f243e4dd3ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*2DQAV9z5tErNOSmStwL3OQ.gif"/></div></figure><p id="b67c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设您已经学习了本文的<a class="ae lo" rel="noopener" href="/@mohsenoid/yet-another-mvp-article-part-1-lets-get-to-know-the-project-d3fd553b3e21#.6y9ze7e55"> part1 </a>、<a class="ae lo" rel="noopener" href="/@mohsenoid/yet-another-mvp-article-part-2-how-dagger-helps-with-the-project-90d049a45e00#.62mdwkqwj"> part2 </a>和<a class="ae lo" rel="noopener" href="/@mohsenoid/yet-another-mvp-article-part-3-calling-apis-using-retrofit-23757f4eee05#.anv029kvw"> part3 </a>，这意味着您对<a class="ae lo" href="https://github.com/mohsenoid/marvel" rel="noopener ugc nofollow" target="_blank">示例项目的</a>模块和结构了如指掌，也更加熟悉<strong class="it hv"> Dagger </strong>在连接<strong class="it hv"> MVP </strong>层中的用法，并且知道<strong class="it hv">改型</strong>用于连接到<a class="ae lo" href="https://hackernoon.com/tagged/network" rel="noopener ugc nofollow" target="_blank">网络</a>API的用法。</p><p id="5889" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们继续…</p></div><div class="ab cl lp lq hc lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h1 id="b5c8" class="jq jr hu bd js jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn dt translated">RxJava是一场革命，真实还是虚构！</h1><p id="bada" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">在我作为软件开发人员的整个职业生涯中，我可以说RxJava是Java 8中继表达式之后最好的变化之一。通过遵循混合这两者的配方，你可以像一个<a class="ae lo" href="https://hackernoon.com/tagged/magician" rel="noopener ugc nofollow" target="_blank">魔术师</a>一样开发软件。</p><p id="52e2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">据<strong class="it hv"> RxJava </strong>官网<a class="ae lo" href="http://reactivex.io" rel="noopener ugc nofollow" target="_blank">react vex . io</a>介绍，是<em class="jp">“一个异步编程的API”</em>在Android开发中总是需要的。</p><p id="5cb0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">幸运的是，这个图书馆网站上的文档非常完美，你可以通过大量的图表找到你想知道的东西。</p></div><div class="ab cl lp lq hc lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h1 id="eedb" class="jq jr hu bd js jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn dt translated">…，所以让我们回到我们的示例项目:</h1><p id="a154" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">在这个项目中，RxJava主要用于从<strong class="it hv">模型</strong>层检索数据，而<strong class="it hv">表示</strong>层调用<strong class="it hv">视图</strong>层的方法来处理响应。</p><p id="e250" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">可观察对象</strong>由于调用API方法而被提供改造库，并被<strong class="it hv"> MVP </strong>的<strong class="it hv">表示层</strong>观察。</p><p id="13f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">RxJava的神奇之处在于它可以在不同的线程中被观察和订阅。因为我们总是将结果传递给Android UI线程(即<strong class="it hv"> MainThread) </strong>，所以我们需要一个从<em class="jp"> app </em>模块到<em class="jp"> core </em>模块中该线程的链接。</p><h1 id="cdf7" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">如何从Android到内核指定调度器！</h1><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff mg"><img src="../Images/15efe5950a342fc298578f4d2cdc83ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/1*czQEV1tNjhjP4LwA5G4TYw.gif"/></div></figure><p id="6e0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">RxJava中的<a class="ae lo" href="http://reactivex.io/documentation/scheduler.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">调度器</strong> </a>是Java中的线程。为了将API的响应传递给视图层，你必须将它推入Android主线程。</p><p id="5d40" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了说明这一点，我们使用<strong class="it hv"> RxJava </strong>的<strong class="it hv">观察</strong>方法。</p><p id="3b29" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">RxJava有一个名为<strong class="it hv"> RxAndroid </strong>的Android扩展，它提供了与RxJava一起使用的Android线程。为了使<em class="jp">内核</em>和<em class="jp"> app </em>模块之间的这种连接成为可能，<em class="jp"> app </em>模块从<a class="ae lo" href="https://github.com/mohsenoid/marvel/blob/master/app/src/main/java/com/mirhoseini/marvel/util/AppSchedulerProvider.java" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">AppSchedulerProvider</strong></a>类中的<em class="jp">内核</em>实现了<a class="ae lo" href="https://github.com/mohsenoid/marvel/blob/master/core-lib/src/main/java/com/mirhoseini/marvel/util/SchedulerProvider.java" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">scheduler provider</strong></a><em class="jp">接口</em>，该类实现了两种方法(mainThread/backgroundThread):</p><figure class="li lj lk ll fq lm"><div class="bz el l di"><div class="mh mi l"/></div></figure><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="fe ff mj"><img src="../Images/0ab1d80d1f1d8e4fb3e1296a073ccdde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x5f5WicAP1UFK_7IbN88RQ.jpeg"/></div></div><figcaption class="mo mp fg fe ff mq mr bd b be z ek">“Take care of the wrong abstraction”, — <a class="ae lo" href="https://www.novoda.com/blog/designing-something-solid/" rel="noopener ugc nofollow" target="_blank">Novoda</a></figcaption></figure><p id="9a8b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">，最后通过一些<strong class="it hv"> Dagger </strong>注入，我们可以将<strong class="it hv"> AppSchedulerProvider </strong>作为presenter类中的父类(<strong class="it hv"> SchedulerProvider) </strong>，这是<strong class="it hv"> MVP </strong>中<a class="ae lo" href="https://en.wikipedia.org/wiki/Liskov_substitution_principle" rel="noopener ugc nofollow" target="_blank"> Liskov替换</a>的另一个例子。</p></div><div class="ab cl lp lq hc lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h1 id="6a0a" class="jq jr hu bd js jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn dt translated">RxJava地图操作来求助…</h1><p id="320b" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">RxJava 有许多有用的操作符，但我认为<strong class="it hv"> MAP </strong>是使用最多的操作符。</p><p id="5f72" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">看看<a class="ae lo" href="https://github.com/mohsenoid/marvel/blob/master/core-lib/src/main/java/com/mirhoseini/marvel/character/search/SearchPresenterImpl.java" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">search present erimpl</strong></a>里面的这部分代码，做字符搜索:</p><figure class="li lj lk ll fq lm"><div class="bz el l di"><div class="mh mi l"/></div></figure><p id="1c06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">来自API的响应并不总是我们想要交给<strong class="it hv">视图</strong>层的，甚至可能需要一些<strong class="it hv">数据库</strong>缓存，因此，使用<a class="ae lo" href="http://reactivex.io/documentation/operators/map.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">映射</strong> </a>操作符我们可以在UI知道之前做一些手脚。</p><p id="ea78" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<a class="ae lo" href="https://github.com/mohsenoid/marvel/blob/master/core-lib/src/main/java/com/mirhoseini/marvel/character/search/SearchPresenterImpl.java" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">search presenterimpl</strong></a><strong class="it hv">:</strong>中有四个应用于API响应的映射操作符</p><ul class=""><li id="a14f" class="ms mt hu it b iu iv iy iz jc mu jg mv jk mw jo mx my mz na dt translated">第一个映射，检查API的响应代码是否正确，如果不正确，稍后将抛出一个异常。确保您使用了<em class="jp"> 'Exceptions.propagate' </em>方法，否则您必须使用try/catch语句立即处理异常！！</li><li id="04fc" class="ms mt hu it b iu nb iy nc jc nd jg ne jk nf jo mx my mz na dt translated">第二个地图，检查是否有任何搜索字符的结果，如果没有，稍后将抛出一个异常…</li><li id="01d1" class="ms mt hu it b iu nb iy nc jc nd jg ne jk nf jo mx my mz na dt translated">第三个映射使用Mapper类将响应模型映射到数据库模型。</li><li id="9ec7" class="ms mt hu it b iu nb iy nc jc nd jg ne jk nf jo mx my mz na dt translated">最后，最后一个映射，将响应插入到数据库中进行进一步的缓存。</li></ul><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff ng"><img src="../Images/bcf04a110511c484afd6df774d5c72ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*2ytEvXU5nbtaAMk80LVLuw.gif"/></div></figure><p id="02c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用<strong class="it hv"> RxJava </strong>，所有这些对API响应的操作都可以在一行代码中实现！</p><p id="280c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">…记住，所有的映射都发生在后台线程中，因为我们在<a class="ae lo" href="https://github.com/mohsenoid/marvel/blob/master/core-lib/src/main/java/com/mirhoseini/marvel/character/search/SearchInteractorImpl.java" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">类中使用了subscribe<em class="jp">来指定它，这就是它永远不会中断<strong class="it hv">主线程</strong>来导致任何延迟甚至<a class="ae lo" href="https://developer.android.com/training/articles/perf-anr.html" rel="noopener ugc nofollow" target="_blank"> ANRs </a>的原因。</em></strong></a></p><h2 id="d7ac" class="nh jr hu bd js ni nj nk jw nl nm nn ka jc no np ke jg nq nr ki jk ns nt km nu dt translated">还有哪里？</h2><p id="1895" class="pw-post-body-paragraph ir is hu it b iu mb iw ix iy mc ja jb jc md je jf jg me ji jj jk mf jm jn jo hn dt translated">RxJava在<a class="ae lo" href="https://github.com/mohsenoid/marvel/blob/master/app/src/main/java/com/mirhoseini/marvel/character/cache/adapter/CharactersRecyclerViewAdapter.java" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">适配器</strong> </a>中也在使用，用于通知列表点击中的项目，我觉得很好理解，大家可以看看。</p><h1 id="bf96" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">暂时就这样了…</h1><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff ng"><img src="../Images/779d029dc96d0218ee0044d44579f5d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*4QtxcYcEqQQx_U7KlOUfSg.gif"/></div></figure><p id="8326" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请从GitHub 中克隆<a class="ae lo" href="https://github.com/mohsenoid/marvel" rel="noopener ugc nofollow" target="_blank">项目回购，并更加熟悉它，因为在下一部分，我将解释更多关于使用我们所做的所有dagger东西编写测试的内容。</a></p><p id="52d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我期待您的评论，并帮助我对这篇文章进行更多的改进。</p><p id="9167" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你觉得这篇文章有用就分享吧，关注我更多文章<a class="nv nw gr" href="https://medium.com/u/6a4ed0c4dd2c?source=post_page-----cde42ccc4958--------------------------------" rel="noopener" target="_blank"> Mohsen Mirhoseini </a>。</p><blockquote class="nx ny nz"><p id="c8c5" class="ir is jp it b iu iv iw ix iy iz ja jb oa jd je jf ob jh ji jj oc jl jm jn jo hn dt translated">未完待续…</p></blockquote><div class="ko kp fm fo kq kr"><a href="https://hackernoon.com/yet-another-mvp-article-part-5-writing-test-using-a-mixture-of-dagger-and-espresso-15c638182706" rel="noopener  ugc nofollow" target="_blank"><div class="ks ab ej"><div class="kt ab ku cl cj kv"><h2 class="bd hv fv z el kw eo ep kx er et ht dt translated">另一篇MVP文章——第5部分:混合使用匕首和浓缩咖啡的写作测试</h2><div class="ky l"><h3 class="bd b fv z el kw eo ep kx er et ek translated">使用MVP、RxJava、Dagger 2、Retrofit2、Test和所有全新的现代技术实现一个示例Android应用程序…</h3></div><div class="kz l"><p class="bd b gc z el kw eo ep kx er et ek translated">hackernoon.com</p></div></div><div class="la l"><div class="od l lc ld le la lf lg kr"/></div></div></a></div><div class="li lj lk ll fq ab cb"><figure class="oe lm of og oh oi oj paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="oe lm of og oh oi oj paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="oe lm of og oh oi oj paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nx ny nz"><p id="f922" class="ir is jp it b iu iv iw ix iy iz ja jb oa jd je jf ob jh ji jj oc jl jm jn jo hn dt translated"><a class="ae lo" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae lo" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae lo" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae lo" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is jp it b iu iv iw ix iy iz ja jb oa jd je jf ob jh ji jj oc jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae lo" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae lo" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="fe ff ok"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="li lj lk ll fq lm"><div class="bz el l di"><div class="ol mi l"/></div></figure></div></div>    
</body>
</html>