<html>
<head>
<title>Line profiling Python — Odoo 9 as example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">线分析Python——以Odoo 9为例</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/line-profiling-python-odoo-9-as-example-864e9e3cdd7a?source=collection_archive---------1-----------------------#2016-09-17">https://medium.com/hackernoon/line-profiling-python-odoo-9-as-example-864e9e3cdd7a?source=collection_archive---------1-----------------------#2016-09-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/08b27a6dc71979737055b7abc646633d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2abRcgCWounAqTW0NVHIQ.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="3bf1" class="pw-subtitle-paragraph jc ie if bd b jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ek translated">链接猛犸象— Odoo/PostgreSQL — 1</h2></div><p id="0975" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">编码标准，干代码，<a class="ae kq" href="https://hackernoon.com/tagged/design" rel="noopener ugc nofollow" target="_blank">设计</a>模式，版本<a class="ae kq" href="https://hackernoon.com/tagged/management" rel="noopener ugc nofollow" target="_blank">管理</a> t，标准化工作流，微服务，自动部署，可扩展系统..</p><p id="2cda" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">黑客在创业中要实现的梦想。当你努力实现这些目标时，你会花很多时间去修复遗留下来的问题。具有无限系列快速修复、重复代码和数百万行代码的系统。</p><p id="6d04" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">用像odoo这样的电池供电的ERP系统开始业务是没问题的。它可以帮助您快速构建满足业务需求的应用程序。但随着时间的推移，你将更难扩展应用程序，因为大多数计算资源将被浪费在不需要的功能和支持这些“易于开发”的功能上。确保您正在开发优化的并行应用程序，并为现有数据制定了良好的迁移计划。如果你探索和破解openerp的基础/内部系统，你会看到很多优化步骤。</p><p id="b5b7" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">分析应用程序代码有助于您识别应用程序中的时间/空间问题。您将获得典型问题的答案，如每个函数/方法需要多长时间来执行？应用程序在内存消耗等方面有多好？在web应用程序世界中，长时间运行或高内存消耗的请求是对应用程序稳定性的威胁(即使在阻塞和非阻塞请求中)。如果您一直使用这些高负载终端，而不投入时间进行优化，并且确实进行了横向扩展，那么您最终会在云提供商的发票上花费很多。</p><p id="66c4" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">在python world中，有多种工具和库可用于分析。<a class="ae kq" href="https://docs.python.org/3/library/profile.html" rel="noopener ugc nofollow" target="_blank"> cProfile </a>、<a class="ae kq" href="http://valgrind.org/" rel="noopener ugc nofollow" target="_blank"> valgrind </a>免费提供。第三方网络监控服务，如<a class="ae kq" href="https://newrelic.com/" rel="noopener ugc nofollow" target="_blank"> NewRelic </a>、<a class="ae kq" href="https://www.appdynamics.com/" rel="noopener ugc nofollow" target="_blank"> App dynamics </a>、<a class="ae kq" href="https://www.dynatrace.com/" rel="noopener ugc nofollow" target="_blank"> Dynatrace </a>可支付一定费用。本文重点介绍用python <a class="ae kq" href="https://github.com/rkern/line_profiler" rel="noopener ugc nofollow" target="_blank">行分析器</a>分析odoo。尽管“线分析器”会增加代码的开销，并且您不能相信“线分析器”的准确计时，但是对于确定相对时间消耗而言,“线分析器”是一个不错的选择。</p><h2 id="540c" class="kr ks if bd kt ku kv kw kx ky kz la lb kd lc ld le kh lf lg lh kl li lj lk ll dt translated">我们在这里要做的事情</h2><ul class=""><li id="2243" class="lm ln if jw b jx lo ka lp kd lq kh lr kl ls kp lt lu lv lw dt translated">安装Ubuntu 16.04流浪机。</li><li id="cc88" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">设置Odoo 9/Postgres 9.5。</li><li id="d740" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">将50 k触点插入Odoo。</li><li id="7b27" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">用日志解析器分析odoo中的慢速请求。</li><li id="cd6c" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">设置线路剖面仪示例脚本。</li><li id="b61d" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">为odoo设置线路剖面仪。</li><li id="5a80" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">识别代码中的性能瓶颈。</li></ul></div><div class="ab cl mc md hc me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hn ho hp hq hr"><h2 id="44b5" class="kr ks if bd kt ku kv kw kx ky kz la lb kd lc ld le kh lf lg lh kl li lj lk ll dt translated">测试环境</h2><ul class=""><li id="294e" class="lm ln if jw b jx lo ka lp kd lq kh lr kl ls kp lt lu lv lw dt translated">Ubuntu 16.04(64位)，虚拟盒使用<a class="ae kq" href="https://gist.github.com/jasimmk/c2a10ce0526b82be4294805145a653d6" rel="noopener ugc nofollow" target="_blank">流浪汉</a></li><li id="1409" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">Python 2.7.9</li><li id="c98b" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated"><a class="ae kq" href="https://github.com/odoo/odoo/tree/9.0" rel="noopener ugc nofollow" target="_blank"> Odoo 9 </a> (v 9.0分支)</li><li id="cbc2" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated"><a class="ae kq" href="https://github.com/rkern/line_profiler" rel="noopener ugc nofollow" target="_blank">轮廓仪</a></li></ul><h2 id="6aad" class="kr ks if bd kt ku kv kw kx ky kz la lb kd lc ld le kh lf lg lh kl li lj lk ll dt translated">设置流浪者</h2><ul class=""><li id="6469" class="lm ln if jw b jx lo ka lp kd lq kh lr kl ls kp lt lu lv lw dt translated">在你的机器上安装<a class="ae kq" href="https://www.vagrantup.com/docs/installation/" rel="noopener ugc nofollow" target="_blank">浮动</a>。</li><li id="4c0c" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">将<a class="ae kq" href="https://gist.github.com/jasimmk/c2a10ce0526b82be4294805145a653d6" rel="noopener ugc nofollow" target="_blank">流浪文件</a>下载到文件夹</li><li id="9b98" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">运行`<em class="mj">流浪起来</em></li><li id="f0a5" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">运行`<em class="mj">流浪ssh` </em>，</li><li id="f6b3" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">运行`<em class="mj"> sudo su` </em>以root用户身份登录</li></ul><figure class="ml mm mn mo fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mk"><img src="../Images/61328eee24cbaa494152c0f791a4792b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5kTElJVsX-4JKYLynkRdfQ.png"/></div></div><figcaption class="mp mq fg fe ff mr ms bd b be z ek">Vagrant with virtualmachine. Running ubuntu 16.04</figcaption></figure><h2 id="3e12" class="kr ks if bd kt ku kv kw kx ky kz la lb kd lc ld le kh lf lg lh kl li lj lk ll dt translated">安装Odoo和PostgreSQL</h2><p id="8993" class="pw-post-body-paragraph ju jv if jw b jx lo jg jz ka lp jj kc kd mt kf kg kh mu kj kk kl mv kn ko kp hn dt translated">让我们看看如何为开发设置odoo 9。您可以使用下面的脚本来自动配置环境。运行脚本来设置odoo 9和PostgreSQL 9.5。如果您想为您的环境定制用户名、密码等，请下载脚本并编辑脚本中的配置，然后运行它。</p><p id="8fc4" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">该脚本为odoo安装PostgreSQL 9.5和依赖包。Python包安装在用户'<em class="mj"> odoo </em>'下的虚拟环境中。</p><pre class="ml mm mn mo fq mw mx my mz aw na dt"><span id="fcd8" class="kr ks if mx b fv nb nc l nd ne">root@odoo-dev:~# wget --quiet http://bit.ly/2cE6pfY -O install_odoo9.sh &amp;&amp; bash -u install_odoo9.sh</span></pre><figure class="ml mm mn mo fq hw"><div class="bz el l di"><div class="nf ng l"/></div><figcaption class="mp mq fg fe ff mr ms bd b be z ek">Odoo 9 and PostgreSQL 9.5 auto installation on Vagrant machine</figcaption></figure><h2 id="688d" class="kr ks if bd kt ku kv kw kx ky kz la lb kd lc ld le kh lf lg lh kl li lj lk ll dt translated">应用程序的初始设置</h2><p id="d7a4" class="pw-post-body-paragraph ju jv if jw b jx lo jg jz ka lp jj kc kd mt kf kg kh mu kj kk kl mv kn ko kp hn dt translated">让我们设置初始odoo数据库并加载一些演示数据。使用以下配置进行初始数据库安装</p><pre class="ml mm mn mo fq mw mx my mz aw na dt"><span id="91d5" class="kr ks if mx b fv nb nc l nd ne">Odoo admin password: odoo_admin<br/>Odoo database: odoo_test<br/>Odoo username: test123@mailinator.com<br/>Odoo password: 123456</span></pre><p id="c4d4" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">默认安装时安装在odoo应用程序下</p><ul class=""><li id="cc83" class="lm ln if jw b jx jy ka kb kd nh kh ni kl nj kp lt lu lv lw dt translated">项目</li><li id="513a" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">销售管理</li><li id="5c59" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">货品计价</li></ul><p id="17d6" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">请看<a class="ae kq" href="https://gist.github.com/jasimmk/f7587fa901596f6215c1d1a588c1df4d" rel="noopener ugc nofollow" target="_blank">脚本</a>来填充身边的`<em class="mj"> 5万`</em>联系人到odoo。脚本基于Odoo API。(<em class="mj">它非常慢，没有使用任何多处理技术来加快它的速度。在后台运行时，大约需要2个小时才能填充完毕</em>。</p><p id="50f6" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated"><a class="ae kq" href="https://gist.github.com/jasimmk/f7587fa901596f6215c1d1a588c1df4d" rel="noopener ugc nofollow" target="_blank">下载Odoo联系人插入脚本</a></p><figure class="ml mm mn mo fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nk"><img src="../Images/0af1455093aa47f59ea54bd8e235965c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DJ39-YTHnMm0UDnz0fIDjg.png"/></div></div><figcaption class="mp mq fg fe ff mr ms bd b be z ek"><em class="nl">Inserting 50 thousand contacts to Odoo</em></figcaption></figure><h2 id="6af0" class="kr ks if bd kt ku kv kw kx ky kz la lb kd lc ld le kh lf lg lh kl li lj lk ll dt translated">运行Odoo 9进行记录</h2><p id="2e64" class="pw-post-body-paragraph ju jv if jw b jx lo jg jz ka lp jj kc kd mt kf kg kh mu kj kk kl mv kn ko kp hn dt translated">让我们记录一些来自odoo的请求和响应时间。</p><ul class=""><li id="b207" class="lm ln if jw b jx jy ka kb kd nh kh ni kl nj kp lt lu lv lw dt translated">停止现有的odoo服务</li><li id="8e0e" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">登录到odoo用户</li><li id="abb4" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">激活奥多虚拟</li><li id="adbd" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">从命令行以单工作模式(默认)运行odoo。</li><li id="22d6" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">将请求和响应记录到标准输出和一个文件(`<em class="mj">/opt/odoo/logs/odoo-server-request . log</em>`)</li></ul><pre class="ml mm mn mo fq mw mx my mz aw na dt"><span id="ec6f" class="kr ks if mx b fv nb nc l nd ne">root@odoo-dev:~# systemctl stop odoo-server<br/>root@odoo-dev:~# su odoo<br/>(venv) odoo@odoo-dev:~$ which python<br/>/opt/odoo/venv/bin/python<br/>(venv) odoo@odoo-dev:~$ python src/odoo.py --config /etc/odoo-server.conf --log-handler openerp.http.rpc.request:DEBUG --logfile /dev/stdout|tee /opt/odoo/logs/odoo-server-request.log</span></pre><p id="6d9b" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">请浏览odoo的典型操作，以在日志中生成一些随机响应和定时。</p><figure class="ml mm mn mo fq hw"><div class="bz el l di"><div class="nf ng l"/></div></figure><blockquote class="nm nn no"><p id="fe50" class="ju jv mj jw b jx jy jg jz ka kb jj kc np ke kf kg nq ki kj kk nr km kn ko kp hn dt translated">在odoo的工作模式下，服务器将使用同步和非线程模式运行wsgi标准。如果我们有4个工作线程，每个请求需要1秒钟来生成输出，那么我们系统的并发性将是每秒4个请求。</p></blockquote><p id="5db6" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">让我们找出需要很长时间的请求。作为一项基本措施，检查生成响应的时间是否超过500毫秒。我们可以使用这三种方法中的任何一种。</p><ul class=""><li id="235e" class="lm ln if jw b jx jy ka kb kd nh kh ni kl nj kp lt lu lv lw dt translated">Chrome webtools/Firebug，并从那里监控响应时间。</li><li id="cb97" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">如果odoo app前面有nginx代理，可以在nginx日志中启用<a class="ae kq" href="https://lincolnloop.com/blog/tracking-application-response-time-nginx/" rel="noopener ugc nofollow" target="_blank">请求/响应定时，在这里</a>指定，记录请求/响应定时。</li><li id="71cb" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">在odoo中启用“<em class="mj"> —日志处理程序openerp . http . RPC . request:DEBUG</em>”,并解析请求/响应时间的日志文件(我们将在这里使用这个方法)</li></ul><h2 id="892b" class="kr ks if bd kt ku kv kw kx ky kz la lb kd lc ld le kh lf lg lh kl li lj lk ll dt translated">我们将选择优化哪个端点/url？</h2><ol class=""><li id="e917" class="lm ln if jw b jx lo ka lp kd lq kh lr kl ls kp ns lu lv lw dt translated"><strong class="jw ig">简单排名</strong>:生成每个url的请求数*平均响应时间的表格，选择数值最高的一个</li><li id="dee8" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp ns lu lv lw dt translated"><strong class="jw ig"> Apdex规则</strong>:<a class="ae kq" href="https://en.wikipedia.org/wiki/Apdex" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Apdex</a></li></ol><figure class="ml mm mn mo fq hw fe ff paragraph-image"><div class="fe ff nt"><img src="../Images/1f146b3284e09b243ad629b2d68a2352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*yIYWrQWnkXfFcYzyMSMNTA.jpeg"/></div></figure><p id="d037" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">根据前面的命令，我们将请求和响应时间记录到stdout和“<em class="mj">/opt/odoo/logs/odoo-server-request . log</em>”中。</p><p id="65c2" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">让我们使用odoo对数线解析器。为了生成日志文件，我们需要传递日志处理程序参数</p><pre class="ml mm mn mo fq mw mx my mz aw na dt"><span id="3562" class="kr ks if mx b fv nb nc l nd ne">--log-handler openerp.http.rpc.request:DEBUG </span></pre><p id="ce05" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">跑odoo的时候。该处理程序将把请求和响应时间添加到日志文件中。请查看解析器的附加文件。</p><p id="d5b4" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated"><a class="ae kq" href="https://gist.github.com/jasimmk/c74cbad826c3f06ea08981d7aad46238" rel="noopener ugc nofollow" target="_blank">下载解析器脚本</a></p><p id="e454" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">您可以运行以下命令来生成日志慢速响应odoo请求。</p><pre class="ml mm mn mo fq mw mx my mz aw na dt"><span id="733f" class="kr ks if mx b fv nb nc l nd ne">root@odoo-dev:~# wget --quiet <a class="ae kq" href="http://bit.ly/2ceKpfa" rel="noopener ugc nofollow" target="_blank">http://bit.ly/2ceKpfa</a> -O odoo_request_log_parser.py &amp;&amp; python odoo_request_log_parser.py -l '/opt/odoo/logs/odoo*.log'</span></pre><figure class="ml mm mn mo fq hw"><div class="bz el l di"><div class="nf ng l"/></div></figure><h2 id="bf9d" class="kr ks if bd kt ku kv kw kx ky kz la lb kd lc ld le kh lf lg lh kl li lj lk ll dt translated">分析响应时间</h2><p id="6d17" class="pw-post-body-paragraph ju jv if jw b jx lo jg jz ka lp jj kc kd mt kf kg kh mu kj kk kl mv kn ko kp hn dt translated">我玩了`<em class="mj">无限`</em>清单的`<em class="mj">10万</em>联系人好多次。odoo中的无限制列表是一个危险的特性，如果一个表的记录数量非常多，那么“All”列表将会是web工作者的一个大阻塞操作。处理这些记录也会消耗大量内存。</p><figure class="ml mm mn mo fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nu"><img src="../Images/811b66b72b9f15481cd8801022187721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QW22mkkDjFRxVJC3xf_vvA.png"/></div></div><figcaption class="mp mq fg fe ff mr ms bd b be z ek">Odoo request/response apdex score analysis</figcaption></figure><p id="a242" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">让我们从log parser中检查这里列出的函数。`<em class="mj">轮询</em>`用于长时间轮询，在生产ERP中，我们可以用` gevent `异步端口对其进行配置。所以这对我们来说不是什么大问题。`<em class="mj">search _ read:RES . partner</em>`的apdex得分为<strong class="jw ig"> 0.240 </strong>，平均执行时间为<strong class="jw ig"> 14秒</strong>。OMG！！。这是完全不能接受的。`<em class="mj"> get_session_info </em>`的apdex得分为<strong class="jw ig"> 0.5 </strong>，生成需要<strong class="jw ig"> 520 ms </strong>。</p><p id="d966" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">我们可以对这些函数进行线分析，以确定瓶颈。</p><h2 id="ed11" class="kr ks if bd kt ku kv kw kx ky kz la lb kd lc ld le kh lf lg lh kl li lj lk ll dt translated">线路剖面仪</h2><p id="b1e9" class="pw-post-body-paragraph ju jv if jw b jx lo jg jz ka lp jj kc kd mt kf kg kh mu kj kk kl mv kn ko kp hn dt translated">Cpython作为解释型语言，在逐行分析代码方面具有优势。我们可以确定每条线路之间的时差以及该线路被呼叫的次数。缩小性能瓶颈允许我们直接优化代码。虽然cpython有多种分析器，但是<a class="ae kq" href="https://github.com/rkern/line_profiler" rel="noopener ugc nofollow" target="_blank"> line profiler </a>使用起来很简单，可以将我们引导到可聚焦的区域。</p><h2 id="8bd8" class="kr ks if bd kt ku kv kw kx ky kz la lb kd lc ld le kh lf lg lh kl li lj lk ll dt translated">安装线路轮廓仪</h2><p id="4999" class="pw-post-body-paragraph ju jv if jw b jx lo jg jz ka lp jj kc kd mt kf kg kh mu kj kk kl mv kn ko kp hn dt translated">激活虚拟环境。安装</p><pre class="ml mm mn mo fq mw mx my mz aw na dt"><span id="fe96" class="kr ks if mx b fv nb nc l nd ne">(venv) odoo@odoo-dev:~$ pip install cython<br/>(venv) odoo@odoo-dev:~$ pip install line_profiler</span></pre><p id="a8a6" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">看看我们如何在日志解析器脚本中逐行检查消耗。</p><p id="d257" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">编辑该文件，并将decorator ` <em class="mj"> @profile </em>`添加到主函数generate_fn_table中。并使用-lv选项运行命令。</p><pre class="ml mm mn mo fq mw mx my mz aw na dt"><span id="78b9" class="kr ks if mx b fv nb nc l nd ne">(venv) odoo@odoo-dev:~$ kernprof -lv -o /tmp/lp.prof odoo_log_parser.py -l '/opt/odoo/logs/*.log'</span></pre><blockquote class="nm nn no"><p id="41ac" class="ju jv mj jw b jx jy jg jz ka kb jj kc np ke kf kg nq ki kj kk nr km kn ko kp hn dt translated"><strong class="jw ig"> PS </strong>:我们将忽略/tmp/lp.prof文件中的概要文件输出，详细模式`-v `确保我们在使用CTRL + C(发送SIGINT信号)终止应用程序时得到概要文件报告。</p></blockquote><figure class="ml mm mn mo fq hw"><div class="bz el l di"><div class="nf ng l"/></div></figure><h1 id="fbee" class="nv ks if bd kt nw nx ny kx nz oa ob lb jl oc jm le jo od jp lh jr oe js lk of dt translated">为Odoo设置线条轮廓</h1><p id="06ed" class="pw-post-body-paragraph ju jv if jw b jx lo jg jz ka lp jj kc kd mt kf kg kh mu kj kk kl mv kn ko kp hn dt translated">要在Odoo中启用分析</p><ul class=""><li id="ef91" class="lm ln if jw b jx jy ka kb kd nh kh ni kl nj kp lt lu lv lw dt translated">禁用工作模式并启用线程模式(默认情况下是线程模式，除非您在命令行中放置number ` <em class="mj"> — workers </em>选项，或者在` odoo-server.conf `文件中放置`<em class="mj"> workers = X` </em>)</li><li id="9fa5" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">激活虚拟环境并运行odoo应用程序。确保你在虚拟环境中。</li></ul><p id="1321" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">我们确定了要调试的端点方法。其具有较低的apdex分数。让我们先来看看这个方法。</p><ul class=""><li id="4da7" class="lm ln if jw b jx jy ka kb kd nh kh ni kl nj kp lt lu lv lw dt translated">search_read: res.partner无</li></ul><blockquote class="nm nn no"><p id="3b04" class="ju jv mj jw b jx jy jg jz ka kb jj kc np ke kf kg nq ki kj kk nr km kn ko kp hn dt translated">确保您已经创建了自己的git分析分支。因为这涉及到在某些地方编辑代码部分。</p></blockquote><pre class="ml mm mn mo fq mw mx my mz aw na dt"><span id="fa89" class="kr ks if mx b fv nb nc l nd ne">(venv) odoo@odoo-dev:~$ kernprof -lv -o /tmp/odoo.lprof ~/src/odoo.py --config /etc/odoo-server.conf  --logfile /dev/stdout</span></pre><ul class=""><li id="a2ca" class="lm ln if jw b jx jy ka kb kd nh kh ni kl nj kp lt lu lv lw dt translated">确保您正在使用'<em class="mj"> kernprof </em>'运行`<em class="mj"> odoo.py </em>`脚本。它将`<em class="mj"> profile </em>方法注入到scope。</li><li id="6075" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">将`<em class="mj"> @profile </em>`作为装饰符放在您需要分析的函数之前。</li><li id="715c" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">有时一些方法是用元类来修饰的。对于`<em class="mj"> @profile </em> ` decorator来说，排序很重要。有时我们需要挖掘方法调用并覆盖函数，如`<em class="mj"> fn = profile(fn) </em></li></ul><p id="c112" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated">在Odoo web界面中多次执行慢速加载操作。按CTRL +C终止应用程序。您将获得个人资料报告。</p><ul class=""><li id="7dba" class="lm ln if jw b jx jy ka kb kd nh kh ni kl nj kp lt lu lv lw dt translated">如果您点击名称错误:名称“配置文件”未定义。这可能是因为多个问题。</li><li id="d7a9" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">确保您正在运行带有kernprof的odoo.py脚本，该脚本将配置文件注入builtin。</li><li id="cb79" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">您可能已经在您的虚拟env中安装了future包。在这种情况下，您需要按照该拉取请求中指定的<a class="ae kq" href="https://github.com/rkern/line_profiler/pull/25" rel="noopener ugc nofollow" target="_blank">从主分支安装“<em class="mj"> line_profiler </em></a></li><li id="5699" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">服务器可能正在多处理模式下运行，或者您可能在werkzeug中启用了`<em class="mj"> allow_reload </em>'选项。由于剖析器将代码注入丢失给了具有多重处理的内置程序</li></ul><figure class="ml mm mn mo fq hw"><div class="bz el l di"><div class="nf ng l"/></div></figure><h2 id="1c99" class="kr ks if bd kt ku kv kw kx ky kz la lb kd lc ld le kh lf lg lh kl li lj lk ll dt translated">分析后修复代码</h2><p id="36c9" class="pw-post-body-paragraph ju jv if jw b jx lo jg jz ka lp jj kc kd mt kf kg kh mu kj kk kl mv kn ko kp hn dt translated">剖析给我们带来了代码瓶颈。我们需要使用不同的方法来加速代码的执行。我们可以使用的一些技术有</p><ul class=""><li id="bdb4" class="lm ln if jw b jx jy ka kb kd nh kh ni kl nj kp lt lu lv lw dt translated">循环优化</li><li id="40dd" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">直接查询代替ORM</li><li id="0c65" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">为表列添加索引</li><li id="4878" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">应用不同的算法</li><li id="4ae5" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">移除不需要的代码执行</li></ul><h1 id="2dbf" class="nv ks if bd kt nw nx ny kx nz oa ob lb jl oc jm le jo od jp lh jr oe js lk of dt translated">摘要</h1><ul class=""><li id="eed1" class="lm ln if jw b jx lo ka lp kd lq kh lr kl ls kp lt lu lv lw dt translated">使用像Odoo这样的现有ERP系统来开始你的业务是有好处的</li><li id="b092" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">随着时间的推移，考虑采用微服务方法的独立解决方案。有效利用计算资源，轻松将负载分配到多个节点。</li><li id="2509" class="lm ln if jw b jx lx ka ly kd lz kh ma kl mb kp lt lu lv lw dt translated">行分析有助于您识别性能瓶颈。</li></ul><p id="c85e" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated"><strong class="jw ig"> <em class="mj">复习学分:</em> </strong></p><ul class=""><li id="92a0" class="lm ln if jw b jx jy ka kb kd nh kh ni kl nj kp lt lu lv lw dt translated"><a class="og oh gr" href="https://medium.com/u/4705f10a1b4f?source=post_page-----864e9e3cdd7a--------------------------------" rel="noopener" target="_blank">吉内什·纳拉亚南</a></li></ul><p id="aea5" class="pw-post-body-paragraph ju jv if jw b jx jy jg jz ka kb jj kc kd ke kf kg kh ki kj kk kl km kn ko kp hn dt translated"><strong class="jw ig"> <em class="mj">封面图片:</em> </strong></p><ul class=""><li id="02ce" class="lm ln if jw b jx jy ka kb kd nh kh ni kl nj kp lt lu lv lw dt translated"><a class="ae kq" href="https://en.wikipedia.org/wiki/History_of_the_steam_engine" rel="noopener ugc nofollow" target="_blank"><em class="mj">https://en.wikipedia.org/wiki/History_of_the_steam_engine</em></a></li></ul><div class="ml mm mn mo fq ab cb"><figure class="oi hw oj ok ol om on paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="oi hw oj ok ol om on paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="oi hw oj ok ol om on paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nm nn no"><p id="f922" class="ju jv mj jw b jx jy jg jz ka kb jj kc np ke kf kg nq ki kj kk nr km kn ko kp hn dt translated"><a class="ae kq" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿妹家庭的一员。我们现在<a class="ae kq" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kq" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>的机会。</p><p id="708a" class="ju jv mj jw b jx jy jg jz ka kb jj kc np ke kf kg nq ki kj kk nr km kn ko kp hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kq" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kq" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ml mm mn mo fq hw fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff oo"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure><figure class="ml mm mn mo fq hw"><div class="bz el l di"><div class="op ng l"/></div></figure></div></div>    
</body>
</html>