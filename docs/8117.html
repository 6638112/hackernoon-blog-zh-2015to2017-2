<html>
<head>
<title>Snapshot testing React Components with Jest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快照测试用Jest反应组件</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/snapshot-testing-react-components-with-jest-744a1e980366?source=collection_archive---------1-----------------------#2017-11-20">https://medium.com/hackernoon/snapshot-testing-react-components-with-jest-744a1e980366?source=collection_archive---------1-----------------------#2017-11-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="3f54" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我的<a class="ae jp" href="https://hackernoon.com/implementing-basic-component-tests-using-jest-and-enzyme-d1d8788d627a" rel="noopener ugc nofollow" target="_blank">上一篇关于使用Jest和酶来测试React组件的文章</a>之后，我想更深入地了解Jest本身能做什么。通过使用内置的功能，很容易跟踪你的组件和他们渲染什么，或者如果他们渲染。所以让我们开始快照测试吧！</p><h1 id="02e0" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">什么是快照测试？</h1><p id="3168" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">快照测试顾名思义。Jest获取它正在测试的组件，呈现它，然后获取该组件的快照。当你继续你的项目时，每次你运行你的测试套件，Jest将会重复这个过程，并且将旧的快照和新的快照进行比较。如果快照不匹配，则会在终端中显示一条错误消息，并突出显示不匹配的部分。</p><p id="a2f8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">快照测试虽然非常有用，但不被认为是TDD。快照测试需要一个已经编写好的组件，这样它就可以给它拍照了。快照测试还依赖于组件已经正确呈现的事实。TDD要求您为最初失败的组件编写测试，当您对组件进行编码时，它会通过测试。因此，虽然快照测试不是TDD，但它仍然是跟踪组件并确保它们不会意外更改的有用工具。</p><h1 id="70a5" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">设置快照测试</h1><p id="3e0c" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">因此，要开始测试，我们需要在测试文件的顶部导入一些东西，并下载一个包。我们将使用React测试渲染器包提供的渲染器。要安装它，只需运行以下代码，</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="f3f0" class="lc jr hu ky b fv ld le l lf lg">npm install react-test-renderer</span></pre><p id="331e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">安装之后，我们需要用React和我们正在测试的组件将它导入到我们的文件中。现在我们已经导入了所有这些，我们可以开始编写快照测试了。</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="86fd" class="lc jr hu ky b fv ld le l lf lg">// app/src/components/__tests__/Login-test.js</span><span id="202a" class="lc jr hu ky b fv lh le l lf lg">import React from 'react';<br/>import renderer from 'react-test-renderer';<br/>import Login from '../Login';</span></pre><p id="7acb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将使用我在上一篇文章中使用的登录组件。我的组件看起来像这样</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="c82f" class="lc jr hu ky b fv ld le l lf lg">// app/src/components/Login.js</span><span id="c789" class="lc jr hu ky b fv lh le l lf lg">import React from 'react'</span><span id="8665" class="lc jr hu ky b fv lh le l lf lg">class Login extends React.Component {</span><span id="cbe8" class="lc jr hu ky b fv lh le l lf lg">constructor() {<br/>  super()<br/>  this.state = {<br/>   username: '',<br/>   password: ''<br/>  }<br/> }</span><span id="b97f" class="lc jr hu ky b fv lh le l lf lg">handleInputChange = (event) =&gt; {<br/>  this.setState({<br/>   [event.target.name]: event.target.value<br/>  })<br/> }</span><span id="3a0a" class="lc jr hu ky b fv lh le l lf lg">render() {<br/>  return (<br/>   &lt;form className='login'&gt;<br/>    &lt;label&gt;Username&lt;/label&gt;<br/>    &lt;input id='email' onChange={this.handleInputChange} name='email' type='text' /&gt;<br/>    &lt;label&gt;Password&lt;/label&gt;<br/>    &lt;input id='password' onChange={this.handleInputChange} name='password' type='password' /&gt;<br/>    &lt;button&gt;Submit&lt;/button&gt;<br/>   &lt;/form&gt;<br/>  )<br/> }<br/>}</span><span id="61c3" class="lc jr hu ky b fv lh le l lf lg">export default Login</span></pre><p id="17aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的测试文件看起来已经是这样了，</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="7eef" class="lc jr hu ky b fv ld le l lf lg">// app/src/components/__tests__/Login-test.js</span><span id="da08" class="lc jr hu ky b fv lh le l lf lg">import React from 'react';<br/>import { shallow, mount, render } from 'enzyme';<br/>import Login from '../Login'<br/>import renderer from 'react-test-renderer';</span><span id="6c5b" class="lc jr hu ky b fv lh le l lf lg">describe('Login Component', () =&gt; {</span><span id="7527" class="lc jr hu ky b fv lh le l lf lg">  it('should render without throwing an error', () =&gt; {<br/>    expect(shallow(&lt;Login /&gt;).exists(&lt;form className='login'&gt;&lt;/form&gt;)).toBe(true)<br/>   })</span><span id="9051" class="lc jr hu ky b fv lh le l lf lg">  it('renders a email input', () =&gt; {<br/>    expect(shallow(&lt;Login /&gt;).find('#email').length).toEqual(1)<br/>   })</span><span id="dcfc" class="lc jr hu ky b fv lh le l lf lg">  it('renders a password input', () =&gt; {<br/>    expect(shallow(&lt;Login /&gt;).find('#password').length).toEqual(1)<br/>   })<br/> <br/>   describe('Email input', () =&gt; {<br/>  <br/>    it('should respond to change event and change the state of the Login Component', () =&gt; {<br/>     const wrapper = shallow(&lt;Login /&gt;)<br/>     wrapper.find('#email').simulate('change', {target: {name: 'email', value: '<a class="ae jp" href="mailto:blah@gmail.com" rel="noopener ugc nofollow" target="_blank">blah@gmail.com</a>'}})<br/>     expect(wrapper.state('email')).toEqual('<a class="ae jp" href="mailto:blah@gmail.com" rel="noopener ugc nofollow" target="_blank">blah@gmail.com</a>')<br/>    })<br/>   })<br/> <br/>   describe('Password input', () =&gt; {<br/>  <br/>    it('should respond to change event and change the state of the Login Component', () =&gt; {<br/>     const wrapper = shallow(&lt;Login /&gt;)<br/>     wrapper.find('#password').simulate('change', {target: {name: 'password', value: 'cats'}})<br/>     expect(wrapper.state('password')).toEqual('cats')<br/>    })<br/>   })<br/>})</span></pre><p id="6539" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些测试并不重要，但我想提供它们，因为它们稍后会出现在终端中。因此，如果你在这里查看Jest <a class="ae jp" href="https://facebook.github.io/jest/docs/en/snapshot-testing.html" rel="noopener ugc nofollow" target="_blank">的文档，你可以看到如何创建快照的样本代码。我们所做的是调用renderer对象上的create函数，并将组件作为参数传入。我将添加到测试文件中的新代码是这样的，</a></p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="262f" class="lc jr hu ky b fv ld le l lf lg">// app/src/components/__tests__/Login-test.js</span><span id="0334" class="lc jr hu ky b fv lh le l lf lg">it('renders correctly', () =&gt; {<br/>  const tree = renderer.create(<br/>    &lt;Login /&gt;<br/>  ).toJSON();<br/>  expect(tree).toMatchSnapshot();<br/>});</span></pre><p id="9d73" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">运行时，渲染器会渲染组件。然后在下一行中，我们检查我们渲染的组件是否与之前的快照匹配。当我们运行npm测试时，Jest会在__tests__文件夹中创建一个名为_ _ snapshots _ _的新文件夹，并在该文件夹中为每个快照测试创建一个文件。因为我的测试文件被命名为Login-test.js，所以自动创建的快照是Login-test.js.snap。</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="5ca7" class="lc jr hu ky b fv ld le l lf lg">// app/src/components/__tests__/__snapshots__/Login-test.js.snap<br/>// Jest Snapshot v1, <a class="ae jp" href="https://goo.gl/fbAQLP" rel="noopener ugc nofollow" target="_blank">https://goo.gl/fbAQLP</a></span><span id="0c32" class="lc jr hu ky b fv lh le l lf lg">exports[`renders correctly 1`] = `<br/>&lt;form<br/>  className="login"<br/>&gt;<br/>  &lt;label&gt;<br/>    Username<br/>  &lt;/label&gt;<br/>  &lt;input<br/>    id="email"<br/>    name="email"<br/>    onChange={[Function]}<br/>    type="text"<br/>  /&gt;<br/>  &lt;label&gt;<br/>    Password<br/>  &lt;/label&gt;<br/>  &lt;input<br/>    id="password"<br/>    name="password"<br/>    onChange={[Function]}<br/>    type="password"<br/>  /&gt;<br/>  &lt;button&gt;<br/>    Submit<br/>  &lt;/button&gt;<br/>&lt;/form&gt;<br/>`;</span></pre><p id="b9e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这只是我们的组件在呈现时的外观的一个表示。终端将显示此消息，表明我们创建了一个新快照。它看起来像这样，</p><figure class="kt ku kv kw fq lj fe ff paragraph-image"><div class="fe ff li"><img src="../Images/6e955ad9028f41bf4d7d7c74d3aa5d81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*6qpzHWzPrq80yf2HZzsE_A.png"/></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek">Snapshot is created</figcaption></figure><p id="9e54" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设我们不小心删除了提交按钮。当我更改组件并保存文件时，我在控制台中得到一个错误，让我知道组件看起来不正确。它用绿色突出显示了我缺少的代码，如果我要添加一些以前没有的代码，它会用红色突出显示。</p><figure class="kt ku kv kw fq lj fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff lq"><img src="../Images/a674d77b04645e521928f2dc2fb48121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J-YpRGFia86zkhB0Weoeew.png"/></div></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek">Our component is missing the button shown in green</figcaption></figure><p id="a21b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">查看错误消息Jest给了我们一点帮助。它告诉我们检查我们的代码更改，如果我们的组件是我们想要它呈现的，我们可以键入u来更新快照。当我输入u时，测试再次运行，我得到一个通过的快照测试。</p><figure class="kt ku kv kw fq lj fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/27bfce68d8c70cbedf5a64679917e6e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*D3tXg4diMHY68WOt4ksnRg.png"/></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek">Snapshot is updated</figcaption></figure><p id="f97d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但这是不对的，因为我需要那个按钮来提交我的表单。当我将它添加回去时，您可以看到按钮现在显示为红色，这意味着它是添加到组件中的代码。</p><figure class="kt ku kv kw fq lj fe ff paragraph-image"><div class="fe ff lw"><img src="../Images/e29955924657493d8de170d5fa326764.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*eC0xSURR14m9H_jCaTRWZQ.png"/></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek">Our snapshot does not contain the button so it shows up in red</figcaption></figure><p id="68d1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我再更新一次，我们就可以按照我想要的方式恢复组件，并且所有测试都通过了。</p><figure class="kt ku kv kw fq lj fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/b15fa089a624e5fe76e86c2bf060a2cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*w1ETORCLUHzkGvEnuO-lHA.png"/></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek">Everything is back to normal and our snapshot is correct once again.</figcaption></figure><h1 id="7162" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">摘要</h1><p id="0863" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">如你所见，快照测试是一个非常强大的工具，可以跟踪组件的任何变化。如果有意外的变化，Jest会提醒你。然后，您只需键入u来更新您的快照，或者检查您的代码并修复问题区域。随着应用程序代码库的增长，这可能是监控所有组件和捕捉bug的最佳方式。就像我前面提到的，这并不能取代测试或TDD，但是可以补充它，并且是监控代码的有用工具。因为这很容易做到，所以没有理由不实现快照测试！</p><h1 id="5926" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">来源:</h1><div class="ly lz fm fo ma mb"><a href="https://facebook.github.io/jest/docs/en/snapshot-testing.html" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab ej"><div class="md ab me cl cj mf"><h2 class="bd hv fv z el mg eo ep mh er et ht dt translated">快照测试笑话</h2><div class="mi l"><h3 class="bd b fv z el mg eo ep mh er et ek translated">当你想确保你的用户界面不会发生意外变化时，快照测试是一个非常有用的工具。典型的…</h3></div><div class="mj l"><p class="bd b gc z el mg eo ep mh er et ek translated">facebook.github.io</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp lk mb"/></div></div></a></div></div></div>    
</body>
</html>