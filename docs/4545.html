<html>
<head>
<title>How to Build an Angular JS Ecommerce App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建Angular JS电子商务应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-an-ecommerce-app-using-angular-js-f73cadb2ace2?source=collection_archive---------2-----------------------#2017-06-07">https://medium.com/hackernoon/how-to-build-an-ecommerce-app-using-angular-js-f73cadb2ace2?source=collection_archive---------2-----------------------#2017-06-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/05eed3445c39de694b902d130ae1be54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*E9D3WG2RwpoKIX7e.png"/></div></div></figure><p id="fe11" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这篇文章最初出现在宇宙JS博客上。</p><p id="889d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本教程中，我将向你展示如何使用Angular JS和Cosmic JS创建一个电子商务应用程序。为了理解如何使用Restful API，本教程将展示如何向Cosmic JS API发出简单的AJAX请求，以便在我们的Cosmic JS Bucket中检索、更新和删除电子商务产品和数据。在本教程结束时，我们将有一个功能齐全的电子商务网站，可以部署开始接受通过Stripe购买。让我们开始吧。</p><h1 id="a266" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">TL；速度三角形定位法(dead reckoning)</h1><p id="d3cf" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><a class="ae ka" href="https://cosmicjs.com/apps/ecommerce-app" rel="noopener ugc nofollow" target="_blank">看看这个演示。</a> <br/> <a class="ae ka" href="https://github.com/cosmicjs/ecommerce-app" rel="noopener ugc nofollow" target="_blank">下载GitHub回购。</a> <br/> <a class="ae ka" href="https://cosmicjs.com/login" rel="noopener ugc nofollow" target="_blank">安装app，分分钟部署。</a>(转到你的桶&gt;应用程序)</p><h1 id="27b7" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">入门指南</h1><p id="db9e" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">首先，让我们创建一个新目录来构建我们的项目，并创建一个package.json文件。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="2689" class="ln kc hu lj b fv lo lp l lq lr">mkdir ecommerce-app</span><span id="4f82" class="ln kc hu lj b fv ls lp l lq lr">ecommerce-app$ touch package.json</span></pre><p id="d7be" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在您的package.json中，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="06bd" class="ln kc hu lj b fv lo lp l lq lr">//ecommerce-app/package.json<br/>{<br/>  "name": "ecommerce-app",<br/>  "version": "1.0.0",<br/>  "main": "app-server.js",<br/>  "engines": {<br/>    "node": "4.1.2",<br/>    "npm": "3.5.2"<br/>  },<br/>  "description": "",<br/>  "dependencies": {<br/>    "bower": "^1.7.7",<br/>    "express": "^4.13.3",<br/>    "gulp": "^3.9.1",<br/>    "buffer-to-vinyl": "^1.1.0",<br/>    "gulp-autoprefixer": "^3.1.0",<br/>    "gulp-concat": "^2.6.0",<br/>    "gulp-concat-css": "^2.2.0",<br/>    "gulp-minify-css": "^1.2.4",<br/>    "gulp-ng-config": "^1.4.0",<br/>    "gulp-env": "^0.4.0",<br/>    "gulp-webserver": "^0.9.1",<br/>    "http-server": "^0.9.0",<br/>    "wiredep": "^3.0.0",<br/>    "gulp-npm-script-sync": "^1.1.0"<br/>  },<br/>  "scripts": {<br/>    "postinstall": "bower install &amp;&amp; gulp config &amp;&amp; gulp js",<br/>    "start": "npm run production",<br/>    "production": "node app-server.js",<br/>    "gulp": "gulp"<br/>  },<br/>  "author": "",<br/>  "license": "ISC",<br/>  "devDependencies": {<br/>    "gulp-npm-script-sync": "^1.1.0",<br/>    "gulp-remote-src": "^0.4.2"<br/>  }<br/>}</span></pre><p id="4eac" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">其次，我们来做一个bower.json文件。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="01ca" class="ln kc hu lj b fv lo lp l lq lr">ecommerce-app$ touch bower.json</span></pre><p id="cefb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在您的bower.json中，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="1dde" class="ln kc hu lj b fv lo lp l lq lr">//ecommerce-app/bower.json<br/>{<br/>  "name": "ecommerce-app",<br/>  "description": "Ecommerce App",<br/>  "version": "0.0.0",<br/>  "homepage": "https://github.com/kutsaniuk/ecommerce-app",<br/>  "license": "MIT",<br/>  "private": true,<br/>  "dependencies": {<br/>    "angular": "~1.4.x",<br/>    "angular-mocks": "~1.4.x",<br/>    "angular-bootstrap": "~1.1.x",<br/>    "angular-cookies": "~1.4.x",<br/>    "angular-route": "~1.4.x",<br/>    "angular-ui-router": "0.2.x",<br/>    "angular-resource": "1.4.x",<br/>    "angular-animate": "~1.4.x",<br/>    "ng-dialog": "0.6.1",<br/>    "bootstrap": "3.3.x",<br/>    "cr-acl": "",<br/>    "angular-chosen-localytics": "*",<br/>    "bootstrap-chosen": "*",<br/>    "ng-flow": "^2.7.4",<br/>    "angular-mask": "*",<br/>    "checklist-model": "0.9.0",<br/>    "angular-ui-notification": "^0.2.0",<br/>    "angular-ui-calendar": "^1.0.2",<br/>    "angular-ui-switch": "^0.1.1",<br/>    "ng-scrollbars": "^0.0.11",<br/>    "jquery.scrollbar": "*",<br/>    "angular-nvd3": "*",<br/>    "infinity-angular-chosen": "^0.2.0",<br/>    "angular-flash-alert": "^2.4.0",<br/>    "components-font-awesome": "^4.7.0",<br/>    "textAngular": "^1.5.16",<br/>    "angular-loading-bar": "^0.9.0",<br/>    "angular-environment": "^1.0.8",<br/>    "angular-sticky": "angular-sticky-plugin#^0.3.0"<br/>  },<br/>  "resolutions": {<br/>    "angular": "~1.4.x"<br/>  },<br/>  "devDependencies": {<br/>    "cr-acl": "^0.5.0"<br/>  }<br/>}</span></pre><p id="f311" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">配置应用服务器:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="a239" class="ln kc hu lj b fv lo lp l lq lr">ecommerce-app$ touch app-server.js</span><span id="901f" class="ln kc hu lj b fv ls lp l lq lr">//events-app/app-server.js<br/>var express = require('express');<br/>var app = express();<br/>app.set('port', process.env.PORT || 3000)<br/>app.use(express.static(__dirname))<br/>var http = require('http').Server(app)<br/>app.get('/', (req, res) =&gt; {<br/>  res.sendFile(__dirname + '/index.html');<br/>})<br/>http.listen(app.get('port'), () =&gt; {<br/>  console.log('Ecommerce App listening on ' + app.get('port'))<br/>})</span></pre><h1 id="bd13" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">我们正在安装什么，为什么</h1><ol class=""><li id="f878" class="lt lu hu je b jf kz jj la jn lv jr lw jv lx jz ly lz ma mb dt translated">我们将使用AngularJS框架来构建单页面应用程序</li><li id="5cb5" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们正在为创建多视图安装angular-ui-router。</li><li id="8c0e" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们将使用gulp把所有的js和css文件构建成一个文件。</li></ol><h1 id="5ff3" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">构建我们的应用</h1><p id="29be" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">现在我们将构建我们的文件结构，这样我们就可以组织我们的angular模块和js文件。我们的电子商务应用程序目录应该是这样的:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="f5f9" class="ln kc hu lj b fv lo lp l lq lr">ecommerce-app<br/>|----app<br/>|       |----auth<br/>|                 |----auth.ctrl.js<br/>|                 |----auth.service.js<br/>|       |----config<br/>|                 |----config.js<br/>|       |----watch<br/>|                 |----profile<br/>|                           |----watch.profile.ctrl.js<br/>|                           |----watch.profile.mdl.js<br/>|                 |----watch.ctrl.js<br/>|                 |----watch.mdl.js<br/>|                 |----watch.service.js<br/>|       |----admin<br/>|                 |----orders<br/>|                           |----preview<br/>|                                   |----admin.orders.preview.mdl.js<br/>|                           |----admin.orders.ctrl.js<br/>|                           |----admin.orders.mdl.js<br/>|                           |----admin.orders.service.js<br/>|                 |----watches<br/>|                           |----add<br/>|                                   |----admin.watches.add.ctrl.js<br/>|                                   |----admin.watches.add.mdl.js<br/>|                           |----edit<br/>|                                   |----admin.watches.edit.ctrl.js<br/>|                                   |----admin.watches.edit.mdl.js<br/>|                           |----admin.watches.mdl.js<br/>|                 |----admin.ctrl.js<br/>|                 |----admin.mdl.js<br/>|       |----cart<br/>|                 |----checkout<br/>|                           |----cart.checkout.mdl.js<br/>|                 |----cart.ctrl.js<br/>|                 |----cart.mdl.js<br/>|                 |----cart.service.js<br/>|       |----user<br/>|                 |----user.service.js<br/>|       |----main.mdl.js<br/>|----dist<br/>|       |----css<br/>|       |----img<br/>|       |----js<br/>|----css<br/>|----views<br/>|----gulpfile.js<br/>|----app-server.js<br/>|----bower.json<br/>|----package.json</span></pre><p id="64b6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们将建立我们的index.html。将以下代码复制并粘贴到您的index.html文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="04e1" class="ln kc hu lj b fv lo lp l lq lr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en" ng-app="main"&gt;<br/>&lt;head&gt;<br/>    &lt;meta charset="utf-8"&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>    &lt;meta name="description" content=""&gt;<br/>    &lt;meta name="author" content=""&gt;</span><span id="f7b2" class="ln kc hu lj b fv ls lp l lq lr">    &lt;title&gt;Ecommerce App&lt;/title&gt;</span><span id="2dc0" class="ln kc hu lj b fv ls lp l lq lr">    &lt;!-- bower:css --&gt;<br/>    &lt;!-- endbower --&gt;</span><span id="47dd" class="ln kc hu lj b fv ls lp l lq lr">    &lt;!-- Bootstrap Core CSS --&gt;<br/>    &lt;link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"&gt;</span><span id="05f6" class="ln kc hu lj b fv ls lp l lq lr">    &lt;!-- Custom CSS --&gt;</span><span id="828f" class="ln kc hu lj b fv ls lp l lq lr">    &lt;link href="dist/css/main.min.css" rel="stylesheet"&gt;<br/></span><span id="ae22" class="ln kc hu lj b fv ls lp l lq lr">    <br/>    <br/>    &lt;!--[if lt IE 9]&gt;<br/>    &lt;script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"&gt;&lt;/script&gt;<br/>    &lt;script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"&gt;&lt;/script&gt;<br/>    &lt;![endif]--&gt;</span><span id="7878" class="ln kc hu lj b fv ls lp l lq lr">&lt;/head&gt;<br/>&lt;body&gt;</span><span id="1301" class="ln kc hu lj b fv ls lp l lq lr">&lt;div ui-view&gt;&lt;/div&gt;</span><span id="dbc8" class="ln kc hu lj b fv ls lp l lq lr">&lt;!-- bower:js --&gt;<br/>&lt;!-- endbower --&gt;</span><span id="54b6" class="ln kc hu lj b fv ls lp l lq lr">&lt;script src="dist/js/main.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="5fbe" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，我们将把我们的“根”视图作为目标，稍后放置我们的角度模块。位于我们的dist目录中的<a class="ae ka" href="https://cosmicjs.com/blog/main.js" rel="noopener ugc nofollow" target="_blank"> main.js </a>文件是我们的<a class="ae ka" href="https://cosmicjs.com/blog/gulpfile.js" rel="noopener ugc nofollow" target="_blank"> gulpfile.js </a>文件在捆绑了我们所有的angular模块之后将会产生的文件，现在，设置我们的<a class="ae ka" href="https://cosmicjs.com/blog/gulpfile.js" rel="noopener ugc nofollow" target="_blank"> gulpfile.js </a>文件来捆绑我们所有的js文件，并将该捆绑文件导出到我们的dist目录中。将以下代码复制到您的<a class="ae ka" href="https://cosmicjs.com/blog/gulpfile.js" rel="noopener ugc nofollow" target="_blank"> gulpfile.js </a>文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="f20f" class="ln kc hu lj b fv lo lp l lq lr">//ecommerce-app/gulpfile.js<br/>'use strict';</span><span id="a2e2" class="ln kc hu lj b fv ls lp l lq lr">var gulp = require('gulp'),<br/>    webserver = require('gulp-webserver'),<br/>    minifyCSS = require('gulp-minify-css'),<br/>    concat = require('gulp-concat'),<br/>    wiredep = require('wiredep').stream,<br/>    gulpNgConfig = require('gulp-ng-config'),<br/>    autoprefixer = require('gulp-autoprefixer'),<br/>    b2v = require('buffer-to-vinyl'),<br/>    sync = require('gulp-npm-script-sync');</span><span id="bc33" class="ln kc hu lj b fv ls lp l lq lr">sync(gulp);</span><span id="da43" class="ln kc hu lj b fv ls lp l lq lr">gulp.task('css', function () {<br/>  return gulp.src('css/**/*.css')<br/>    .pipe(minifyCSS())<br/>    .pipe(concat('main.min.css'))<br/>    .pipe(autoprefixer())<br/>    .pipe(gulp.dest('dist/css'));<br/>});</span><span id="c7a6" class="ln kc hu lj b fv ls lp l lq lr">gulp.task('js', function() {<br/>    return gulp.src('app/**/**/*.js')<br/>        .pipe(concat('main.js'))<br/>        .pipe(gulp.dest('dist/js/'));<br/>});</span><span id="51fc" class="ln kc hu lj b fv ls lp l lq lr">gulp.task('config', function () {<br/>    const json = JSON.stringify({<br/>        BUCKET_SLUG: process.env.COSMIC_BUCKET,<br/>        MEDIA_URL: 'https://api.cosmicjs.com/v1/' + process.env.COSMIC_BUCKET + '/media',<br/>        URL: 'https://api.cosmicjs.com/v1/',<br/>        READ_KEY: process.env.COSMIC_READ_KEY || '',<br/>        WRITE_KEY: process.env.COSMIC_WRITE_KEY || ''<br/>    });<br/>    return b2v.stream(new Buffer(json), 'config.js')<br/>        .pipe(gulpNgConfig('config'))<br/>        .pipe(gulp.dest('app/config'));<br/>});</span><span id="fd6e" class="ln kc hu lj b fv ls lp l lq lr">gulp.task('default', function () {<br/>  gulp.watch('css/**/*.css', ['css']);<br/>  gulp.watch('app/**/**/*.js', ['js']);<br/>  gulp.watch('bower.json', ['bower']);<br/>});</span><span id="9124" class="ln kc hu lj b fv ls lp l lq lr">gulp.task('bower', function () {<br/>  gulp.src('index.html')<br/>    .pipe(wiredep({<br/>      directory: 'bower_components'<br/>    }))<br/>    .pipe(gulp.dest(''));<br/>});</span></pre><p id="a57c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">之后，我们可以创建主模块。将以下代码复制并粘贴到您的index.html文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="cd25" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="1c38" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main', [<br/>            'ui.router',<br/>            'ui.bootstrap',<br/>            'ngMask',<br/>            'ngCookies',<br/>            'ngRoute',<br/>            'ngDialog',<br/>            'cr.acl',<br/>            'ui-notification',<br/>            'ngFlash',<br/>            'textAngular',<br/>            'flow',<br/>            'angular-loading-bar',<br/>            'hl.sticky',</span><span id="807d" class="ln kc hu lj b fv ls lp l lq lr">            'watch',<br/>            'cart',<br/>            'admin',</span><span id="ef42" class="ln kc hu lj b fv ls lp l lq lr">            'config'<br/>        ])<br/>        .config(config)<br/>        .run(run);</span><span id="c0d2" class="ln kc hu lj b fv ls lp l lq lr">    config.$inject = ['$stateProvider', '$urlRouterProvider', 'cfpLoadingBarProvider', 'NotificationProvider'];<br/>    function config($stateProvider, $urlRouterProvider, cfpLoadingBarProvider, NotificationProvider) {<br/>        cfpLoadingBarProvider.includeSpinner = false;</span><span id="4fa2" class="ln kc hu lj b fv ls lp l lq lr">        NotificationProvider.setOptions({<br/>            startTop: 25,<br/>            startRight: 25,<br/>            verticalSpacing: 20,<br/>            horizontalSpacing: 20,<br/>            positionX: 'right',<br/>            positionY: 'bottom'<br/>        });</span><span id="12e1" class="ln kc hu lj b fv ls lp l lq lr">        $urlRouterProvider.otherwise(function ($injector) {<br/>            var $state = $injector.get("$state");<br/>            var $location = $injector.get("$location");<br/>            var crAcl = $injector.get("crAcl");</span><span id="799b" class="ln kc hu lj b fv ls lp l lq lr">            var state = "";</span><span id="9749" class="ln kc hu lj b fv ls lp l lq lr">            switch (crAcl.getRole()) {<br/>                case 'ROLE_ADMIN':<br/>                    state = 'admin.watches';<br/>                    break;<br/>                default : state = 'main.watch';<br/>            }</span><span id="ac57" class="ln kc hu lj b fv ls lp l lq lr">            if (state) $state.go(state);<br/>            else $location.path('/');<br/>        });</span><span id="03fd" class="ln kc hu lj b fv ls lp l lq lr">        $stateProvider<br/>            .state('main', {<br/>                url: '/',<br/>                abstract: true,<br/>                templateUrl: '../views/main.html',<br/>                controller: 'CartCtrl as cart',<br/>                data: {<br/>                    is_granted: ['ROLE_GUEST']<br/>                }<br/>            })<br/>            .state('blog', {<br/>                url: '/blog',<br/>                templateUrl: '../blog.html'<br/>            })<br/>            .state('auth', {<br/>                url: '/login',<br/>                templateUrl: '../views/auth/login.html',<br/>                controller: 'AuthCtrl as auth',<br/>                onEnter: ['AuthService', 'crAcl', function(AuthService, crAcl) {<br/>                    AuthService.clearCredentials();<br/>                    crAcl.setRole();<br/>                }],<br/>                data: {<br/>                    is_granted: ['ROLE_GUEST']<br/>                }<br/>            });<br/>    }</span><span id="57f5" class="ln kc hu lj b fv ls lp l lq lr">    run.$inject = ['$rootScope', '$cookieStore', '$state', 'crAcl'];<br/>    function run($rootScope, $cookieStore, $state, crAcl) {<br/>        // keep user logged in after page refresh<br/>        $rootScope.globals = $cookieStore.get('globals') || {};</span><span id="99ac" class="ln kc hu lj b fv ls lp l lq lr">        crAcl<br/>            .setInheritanceRoles({<br/>                'ROLE_ADMIN': ['ROLE_ADMIN', 'ROLE_GUEST'],<br/>                'ROLE_GUEST': ['ROLE_GUEST']<br/>            });</span><span id="955c" class="ln kc hu lj b fv ls lp l lq lr">        crAcl<br/>            .setRedirect('main.watch');</span><span id="06e4" class="ln kc hu lj b fv ls lp l lq lr">        if ($rootScope.globals.currentUser) {<br/>            crAcl.setRole($rootScope.globals.currentUser.metadata.role);<br/>            // $state.go('admin.watches');<br/>        }<br/>        else {<br/>            crAcl.setRole();<br/>        }</span><span id="eb26" class="ln kc hu lj b fv ls lp l lq lr">    }</span><span id="b9d5" class="ln kc hu lj b fv ls lp l lq lr">})();</span></pre><p id="c586" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们将设置我们的授权控制器。将以下代码复制并粘贴到您的<a class="ae ka" href="https://cosmicjs.com/blog/auth.ctrl.js" rel="noopener ugc nofollow" target="_blank"> auth.ctrl.js </a>文件中:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="2095" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="4d6c" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .controller('AuthCtrl', AuthCtrl);</span><span id="e985" class="ln kc hu lj b fv ls lp l lq lr">    function AuthCtrl(crAcl, $state, AuthService, Flash, $log) {<br/>        var vm = this;</span><span id="5ad4" class="ln kc hu lj b fv ls lp l lq lr">        vm.login = login;</span><span id="9cef" class="ln kc hu lj b fv ls lp l lq lr">        vm.showRegisterForm = false;</span><span id="f2db" class="ln kc hu lj b fv ls lp l lq lr">        vm.loginForm = null;</span><span id="e3dd" class="ln kc hu lj b fv ls lp l lq lr">        vm.credentials = {};<br/>        vm.user = {};</span><span id="84e6" class="ln kc hu lj b fv ls lp l lq lr">        function login(credentials) {<br/>            function success(response) {<br/>                function success(response) {<br/>                    if (response.data.status !== 'empty') {<br/>                        var currentUser = response.data.objects[0];</span><span id="019c" class="ln kc hu lj b fv ls lp l lq lr">                        crAcl.setRole(currentUser.metadata.role);<br/>                        AuthService.setCredentials(currentUser);<br/>                        $state.go('admin.watches');<br/>                    }<br/>                    else<br/>                        Flash.create('danger', 'Incorrect username or password');<br/>                }</span><span id="9ec7" class="ln kc hu lj b fv ls lp l lq lr">                function failed(response) {<br/>                    $log.error(response);<br/>                }</span><span id="fe8d" class="ln kc hu lj b fv ls lp l lq lr">                if (response.data.status !== 'empty')<br/>                    AuthService<br/>                        .checkPassword(credentials)<br/>                        .then(success, failed);<br/>                else<br/>                    Flash.create('danger', 'Incorrect username or password');</span><span id="36cf" class="ln kc hu lj b fv ls lp l lq lr">                $log.info(response);<br/>            }</span><span id="10ff" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="55c1" class="ln kc hu lj b fv ls lp l lq lr">            if (vm.loginForm.$valid)<br/>                AuthService<br/>                    .checkUsername(credentials)<br/>                    .then(success, failed);<br/>        }</span><span id="00fe" class="ln kc hu lj b fv ls lp l lq lr">    }<br/>})();</span></pre><p id="c672" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建授权服务，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="cf09" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="b415" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .service('AuthService', function ($http,<br/>                                          $cookieStore,<br/>                                          $q,<br/>                                          $rootScope,<br/>                                          URL, BUCKET_SLUG, READ_KEY, WRITE_KEY) {<br/>            var authService = this;<br/>            $http.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';</span><span id="b3ef" class="ln kc hu lj b fv ls lp l lq lr">            authService.checkUsername = function (credentials) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object-type/users/search', {<br/>                    params: {<br/>                        metafield_key: 'email',<br/>                        metafield_value_has: credentials.email,<br/>                        limit: 1,<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            authService.checkPassword = function (credentials) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object-type/users/search', {<br/>                    ignoreLoadingBar: true,<br/>                    params: {<br/>                        metafield_key: 'password',<br/>                        metafield_value: credentials.password,<br/>                        limit: 1,<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            authService.setCredentials = function (user) {<br/>                $rootScope.globals = {<br/>                    currentUser: user<br/>                };</span><span id="fb4c" class="ln kc hu lj b fv ls lp l lq lr">                $cookieStore.put('globals', $rootScope.globals);<br/>            };<br/>            authService.clearCredentials = function () {<br/>                var deferred = $q.defer();<br/>                $cookieStore.remove('globals');</span><span id="beec" class="ln kc hu lj b fv ls lp l lq lr">                if (!$cookieStore.get('globals')) {<br/>                    $rootScope.globals = {};<br/>                    deferred.resolve('Credentials clear success');<br/>                } else {<br/>                    deferred.reject('Can\'t clear credentials');<br/>                }</span><span id="aeb7" class="ln kc hu lj b fv ls lp l lq lr">                return deferred.promise;<br/>            };<br/>        });<br/>})();</span></pre><h1 id="0dd1" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">这是怎么回事</h1><ol class=""><li id="6db4" class="lt lu hu je b jf kz jj la jn lv jr lw jv lx jz ly lz ma mb dt translated">我们使用ui路由器来配置路由。</li><li id="5036" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们为对我们的Cosmic JS API的异步调用创建了Auth Service。</li><li id="cb93" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们创建了身份验证控制器来检查凭证。</li></ol><p id="034e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为获取和更新用户创建用户服务，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="6310" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="66f6" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .service('UserService', function ($http,<br/>                                          $cookieStore,<br/>                                          $q,<br/>                                          $rootScope,<br/>                                          URL, BUCKET_SLUG, READ_KEY, WRITE_KEY) {<br/>            $http.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';</span><span id="a174" class="ln kc hu lj b fv ls lp l lq lr">            this.getCurrentUser = function (ignoreLoadingBar) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object/' + $rootScope.globals.currentUser.slug, {<br/>                    ignoreLoadingBar: ignoreLoadingBar,<br/>                    params: {<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.getUser = function (slug, ignoreLoadingBar) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object/' + slug, {<br/>                    ignoreLoadingBar: ignoreLoadingBar,<br/>                    params: {<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.updateUser = function (user) {<br/>                user.write_key = WRITE_KEY;</span><span id="9628" class="ln kc hu lj b fv ls lp l lq lr">                return $http.put(URL + BUCKET_SLUG + '/edit-object', user, {<br/>                    ignoreLoadingBar: false<br/>                });<br/>            };</span><span id="0859" class="ln kc hu lj b fv ls lp l lq lr">        });<br/>})();</span></pre><p id="f1ad" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为从Cosmic JS API获取、更新、添加和删除观察器创建观察器服务，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="1538" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="e351" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .service('WatchService', function ($http,<br/>                                          $cookieStore,<br/>                                          $q,<br/>                                          $rootScope,<br/>                                          URL, BUCKET_SLUG, READ_KEY, WRITE_KEY, MEDIA_URL) {</span><span id="c35f" class="ln kc hu lj b fv ls lp l lq lr">            $http.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';</span><span id="c21f" class="ln kc hu lj b fv ls lp l lq lr">            this.watch = {<br/>                title: null,<br/>                type_slug: 'watches',<br/>                content: null,<br/>                metafields: [<br/>                    {<br/>                        key: "category",<br/>                        title: "Category",<br/>                        type: "text",<br/>                        value: null<br/>                    },<br/>                    {<br/>                        key: "brand",<br/>                        title: "Brand",<br/>                        type: "text",<br/>                        value: null<br/>                    },<br/>                    {<br/>                        key: "case_size",<br/>                        title: "Case Size",<br/>                        type: "text",<br/>                        value: null<br/>                    },<br/>                    {<br/>                        key: "case_thickness",<br/>                        title: "Case Thickness",<br/>                        type: "text",<br/>                        value: null<br/>                    },<br/>                    {<br/>                        key: "strap_width",<br/>                        title: "Strap Width",<br/>                        type: "text",<br/>                        value: null<br/>                    },<br/>                    {<br/>                        key: "movement",<br/>                        title: "Movement",<br/>                        type: "text",<br/>                        value: null<br/>                    },<br/>                    {<br/>                        key: "glass",<br/>                        title: "Glass",<br/>                        type: "text",<br/>                        value: null<br/>                    },<br/>                    {<br/>                        key: "water_resistance",<br/>                        title: "Water Resistance",<br/>                        type: "text",<br/>                        value: null<br/>                    },<br/>                    {<br/>                        key: "color",<br/>                        title: "Color",<br/>                        type: "text",<br/>                        value: null<br/>                    },<br/>                    {<br/>                        key: "strap_material",<br/>                        title: "Strap Material",<br/>                        type: "text",<br/>                        value: null<br/>                    },<br/>                    {<br/>                        key: "price",<br/>                        title: "Price",<br/>                        type: "text",<br/>                        value: null<br/>                    },<br/>                    {<br/>                        key: "images",<br/>                        title: "Images",<br/>                        type: "parent",<br/>                        value: "",<br/>                        children: [<br/>                            {<br/>                                key: "image_1",<br/>                                title: "Image_1",<br/>                                type: "file"<br/>                            },<br/>                            {<br/>                                key: "image_2",<br/>                                title: "Image_2",<br/>                                type: "file"<br/>                            },<br/>                            {<br/>                                key: "image_3",<br/>                                title: "Image_3",<br/>                                type: "file"<br/>                            }<br/>                        ]<br/>                    }<br/>                ]<br/>            };</span><span id="b38f" class="ln kc hu lj b fv ls lp l lq lr">            this.getWatches = function (params) {<br/>                if (!angular.equals({}, params))<br/>                    return $http.get(URL + BUCKET_SLUG + '/object-type/watches/search', {<br/>                        params: {<br/>                            metafield_key: params.key,<br/>                            metafield_value_has: params.value,<br/>                            limit: 100,<br/>                            read_key: READ_KEY<br/>                        }<br/>                    });<br/>                else<br/>                    return $http.get(URL + BUCKET_SLUG + '/object-type/watches', {<br/>                        params: {<br/>                            limit: 100,<br/>                            read_key: READ_KEY<br/>                        }<br/>                    });<br/>            };<br/>            this.getWatchesParams = function () {<br/>                return $http.get(URL + BUCKET_SLUG + '/object-type/watches', {<br/>                    params: {<br/>                        limit: 100,<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.getWatchBySlug = function (slug) {<br/>                return $http.get(URL + BUCKET_SLUG + '/object/' + slug, {<br/>                    params: {<br/>                        read_key: READ_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.updateWatch = function (event) {<br/>                event.write_key = WRITE_KEY;</span><span id="b64b" class="ln kc hu lj b fv ls lp l lq lr">                return $http.put(URL + BUCKET_SLUG + '/edit-object', event);<br/>            };<br/>            this.removeWatch = function (slug) {<br/>                return $http.delete(URL + BUCKET_SLUG + '/' + slug, {<br/>                    ignoreLoadingBar: true,<br/>                    headers:{<br/>                        'Content-Type': 'application/json'<br/>                    },<br/>                    data: {<br/>                        write_key: WRITE_KEY<br/>                    }<br/>                });<br/>            };<br/>            this.createWatch = function (watch) {<br/>                watch.write_key = WRITE_KEY;</span><span id="4fa1" class="ln kc hu lj b fv ls lp l lq lr">                return $http.post(URL + BUCKET_SLUG + '/add-object', watch);<br/>            };<br/>            this.upload = function (file) {<br/>                var fd = new FormData();</span><span id="670e" class="ln kc hu lj b fv ls lp l lq lr">                fd.append('media', file);<br/>                fd.append('write_key', WRITE_KEY);</span><span id="839d" class="ln kc hu lj b fv ls lp l lq lr">                var defer = $q.defer();</span><span id="3698" class="ln kc hu lj b fv ls lp l lq lr">                var xhttp = new XMLHttpRequest();</span><span id="39e3" class="ln kc hu lj b fv ls lp l lq lr">                xhttp.upload.addEventListener("progress",function (e) {<br/>                    defer.notify(parseInt(e.loaded * 100 / e.total));<br/>                });<br/>                xhttp.upload.addEventListener("error",function (e) {<br/>                    defer.reject(e);<br/>                });</span><span id="e397" class="ln kc hu lj b fv ls lp l lq lr">                xhttp.onreadystatechange = function() {<br/>                    if (xhttp.readyState === 4) {<br/>                        defer.resolve(JSON.parse(xhttp.response)); //Outputs a DOMString by default<br/>                    }<br/>                };</span><span id="f134" class="ln kc hu lj b fv ls lp l lq lr">                xhttp.open("post", MEDIA_URL, true);</span><span id="72fd" class="ln kc hu lj b fv ls lp l lq lr">                xhttp.send(fd);</span><span id="11b3" class="ln kc hu lj b fv ls lp l lq lr">                return defer.promise;<br/>            }<br/>        });<br/>})();</span></pre><p id="74e9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为获取所有事件创建监视控制器，并删除、复制和粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="47b2" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="ed25" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .controller('WatchCtrl', WatchCtrl);</span><span id="0ec1" class="ln kc hu lj b fv ls lp l lq lr">    function WatchCtrl($stateParams, WatchService, Notification, $log, MEDIA_URL, $state) {<br/>        var vm = this;</span><span id="f30e" class="ln kc hu lj b fv ls lp l lq lr">        vm.getWatches = getWatches;<br/>        vm.removeWatch = removeWatch;</span><span id="282a" class="ln kc hu lj b fv ls lp l lq lr">        vm.params = $stateParams;</span><span id="466e" class="ln kc hu lj b fv ls lp l lq lr">        vm.categories = [];<br/>        vm.brands = [];<br/>        vm.case_sizes = [];<br/>        vm.colors = [];</span><span id="6c2f" class="ln kc hu lj b fv ls lp l lq lr">        vm.watches = [];</span><span id="920a" class="ln kc hu lj b fv ls lp l lq lr">        function getWatches() {<br/>            function success(response) {<br/>                $log.info(response);</span><span id="5520" class="ln kc hu lj b fv ls lp l lq lr">                vm.watches = response.data.objects;</span><span id="5b47" class="ln kc hu lj b fv ls lp l lq lr">            }</span><span id="8803" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="112a" class="ln kc hu lj b fv ls lp l lq lr">            function params(response) {<br/>                response.data.objects.forEach(function (item) {<br/>                    if (vm.categories.indexOf(item.metadata.category) === -1)<br/>                        vm.categories.push(item.metadata.category);<br/>                    if (vm.brands.indexOf(item.metadata.brand) === -1)<br/>                        vm.brands.push(item.metadata.brand);<br/>                    if (vm.case_sizes.indexOf(item.metadata.case_size) === -1)<br/>                        vm.case_sizes.push(item.metadata.case_size);<br/>                    if (vm.colors.indexOf(item.metadata.color) === -1)<br/>                        vm.colors.push(item.metadata.color)<br/>                });<br/>            }</span><span id="12a5" class="ln kc hu lj b fv ls lp l lq lr">            WatchService<br/>                .getWatches($stateParams)<br/>                .then(success, failed);</span><span id="6db5" class="ln kc hu lj b fv ls lp l lq lr">            WatchService<br/>                .getWatchesParams()<br/>                .then(params);<br/>        }</span><span id="a9f2" class="ln kc hu lj b fv ls lp l lq lr">        function removeWatch(slug) {<br/>            function success(response) {<br/>                $log.info(response);<br/>                getWatches();<br/>                Notification.success('Removed!');<br/>            }</span><span id="52d1" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="aaa6" class="ln kc hu lj b fv ls lp l lq lr">            WatchService<br/>                .removeWatch(slug)<br/>                .then(success, failed);</span><span id="8a2c" class="ln kc hu lj b fv ls lp l lq lr">        }</span><span id="0e99" class="ln kc hu lj b fv ls lp l lq lr">    }<br/>})();</span></pre><p id="6789" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建观察模块，复制并粘贴下面的代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="ec6e" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="2812" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('watch', [<br/>            'watch.profile'<br/>        ])<br/>        .config(config);</span><span id="db63" class="ln kc hu lj b fv ls lp l lq lr">    config.$inject = ['$stateProvider', '$urlRouterProvider'];<br/>    function config($stateProvider, $urlRouterProvider) {</span><span id="3dc3" class="ln kc hu lj b fv ls lp l lq lr">        $stateProvider<br/>            .state('main.watch', {<br/>                url: '?key&amp;value',<br/>                templateUrl: '../views/watch/watch.list.html',<br/>                controller: 'WatchCtrl as vm'<br/>            });<br/>    }<br/>})();</span></pre><h1 id="87c2" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">这是怎么回事</h1><ol class=""><li id="c080" class="lt lu hu je b jf kz jj la jn lv jr lw jv lx jz ly lz ma mb dt translated">我们为对我们的Cosmic JS API的异步调用创建了Watch服务。我们可以创建、更新、删除和获取手表。</li><li id="fe97" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们创建了用于获取和移除所有手表的手表控制器。</li><li id="c087" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们创建了观察模块。</li></ol><p id="34c5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建观察配置文件控制器以获取观察信息，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d29a" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="0eff" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .controller('WatchProfileCtrl', WatchProfileCtrl);</span><span id="a11c" class="ln kc hu lj b fv ls lp l lq lr">    function WatchProfileCtrl(UserService, $stateParams, WatchService, Notification, $log, MEDIA_URL, $state) {<br/>        var vm = this;</span><span id="dca6" class="ln kc hu lj b fv ls lp l lq lr">        vm.getWatch = getWatch;</span><span id="e811" class="ln kc hu lj b fv ls lp l lq lr">        function getWatch() {<br/>            function success(response) {<br/>                $log.info(response);<br/>                vm.watch = response.data.object;<br/>            }</span><span id="395d" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="844f" class="ln kc hu lj b fv ls lp l lq lr">            WatchService<br/>                .getWatchBySlug($stateParams.slug)<br/>                .then(success, failed);<br/>        }</span><span id="458a" class="ln kc hu lj b fv ls lp l lq lr">    }<br/>})();</span></pre><p id="7709" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建观察配置文件模块，复制并粘贴下面的代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="3382" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="938e" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('watch.profile', [])<br/>        .config(config);</span><span id="ccdd" class="ln kc hu lj b fv ls lp l lq lr">    config.$inject = ['$stateProvider', '$urlRouterProvider'];<br/>    function config($stateProvider, $urlRouterProvider) {</span><span id="1a64" class="ln kc hu lj b fv ls lp l lq lr">        $stateProvider<br/>            .state('main.watch.profile', {<br/>                url: 'watches/:slug',<br/>                views: {<br/>                    '@main': {<br/>                        templateUrl: '../views/watch/watch.profile.html',<br/>                        controller: 'WatchProfileCtrl as vm'<br/>                    }<br/>                }<br/>            });<br/>    }</span><span id="ce97" class="ln kc hu lj b fv ls lp l lq lr">})();</span></pre><p id="e8bf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建购物车控制器，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="38aa" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="0bae" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .controller('CartCtrl', CartCtrl);</span><span id="5fa1" class="ln kc hu lj b fv ls lp l lq lr">    function CartCtrl(CartService, WatchService, Notification, $log, MEDIA_URL, $state) {<br/>        var vm = this;</span><span id="ad98" class="ln kc hu lj b fv ls lp l lq lr">        vm.addToCart = addToCart;<br/>        vm.getCart = getCart;<br/>        vm.hasInCart = hasInCart;<br/>        vm.removeFromCart = removeFromCart;<br/>        vm.completeOrder = completeOrder;</span><span id="7da7" class="ln kc hu lj b fv ls lp l lq lr">        vm.cart = {};<br/>        vm.cart.order = {};<br/>        vm.watches = [];<br/>        vm.totalPrice = 0;<br/>        vm.orderForm = null;</span><span id="417b" class="ln kc hu lj b fv ls lp l lq lr">        function addToCart(item) {<br/>            function success(response) {<br/>                Notification.success(response);<br/>                getCart();</span><span id="eb52" class="ln kc hu lj b fv ls lp l lq lr">            }</span><span id="50f2" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                Notification.error(response);<br/>            }</span><span id="e895" class="ln kc hu lj b fv ls lp l lq lr">            CartService<br/>                .addToCart(item)<br/>                .then(success, failed);</span><span id="5bb0" class="ln kc hu lj b fv ls lp l lq lr">        }</span><span id="c502" class="ln kc hu lj b fv ls lp l lq lr">        function completeOrder(order) {<br/>            order.watches = vm.watches;</span><span id="a4b4" class="ln kc hu lj b fv ls lp l lq lr">            function success(response) {<br/>                Notification.success('Success');</span><span id="789d" class="ln kc hu lj b fv ls lp l lq lr">            }</span><span id="30cf" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                Notification.error(response.data.message);<br/>            }</span><span id="6304" class="ln kc hu lj b fv ls lp l lq lr">            if (vm.orderForm)<br/>                CartService<br/>                    .completeOrder(order)<br/>                    .then(success, failed);<br/>        }</span><span id="520b" class="ln kc hu lj b fv ls lp l lq lr">        function removeFromCart(_id) {<br/>            function success(response) {<br/>                Notification.success(response);<br/>                getCart();<br/>            }</span><span id="3143" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                Notification.error(response);<br/>            }</span><span id="adf9" class="ln kc hu lj b fv ls lp l lq lr">            CartService<br/>                .removeFromCart(_id)<br/>                .then(success, failed);</span><span id="c950" class="ln kc hu lj b fv ls lp l lq lr">        }</span><span id="3b0b" class="ln kc hu lj b fv ls lp l lq lr">        function hasInCart(_id) {<br/>            return CartService.hasInCart(_id);<br/>        }</span><span id="f5b5" class="ln kc hu lj b fv ls lp l lq lr">        function getCart() {<br/>            function success(response) {<br/>                vm.cart = response;<br/>                getWatches();</span><span id="f19d" class="ln kc hu lj b fv ls lp l lq lr">                $log.info(response);<br/>            }</span><span id="b792" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="04f6" class="ln kc hu lj b fv ls lp l lq lr">            CartService<br/>                .getCart()<br/>                .then(success, failed);</span><span id="60c8" class="ln kc hu lj b fv ls lp l lq lr">        }</span><span id="5d96" class="ln kc hu lj b fv ls lp l lq lr">        function getWatches() {<br/>            function success(response) {<br/>                $log.info(response);</span><span id="13a8" class="ln kc hu lj b fv ls lp l lq lr">                vm.watches = [];<br/>                vm.totalPrice = 0;</span><span id="f3ba" class="ln kc hu lj b fv ls lp l lq lr">                for (var _id in vm.cart)<br/>                    response.data.objects.forEach(function (item) {<br/>                        if (item._id === _id) {<br/>                            vm.watches.push(item);<br/>                            vm.totalPrice += item.metadata.price;<br/>                        }<br/>                    });</span><span id="281b" class="ln kc hu lj b fv ls lp l lq lr">            }</span><span id="4833" class="ln kc hu lj b fv ls lp l lq lr">            function failed(response) {<br/>                $log.error(response);<br/>            }</span><span id="6d38" class="ln kc hu lj b fv ls lp l lq lr">            WatchService<br/>                .getWatches({})<br/>                .then(success, failed);</span><span id="bc85" class="ln kc hu lj b fv ls lp l lq lr">        }<br/>    }<br/>})();</span></pre><p id="4166" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建购物车服务，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="8979" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="a329" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('main')<br/>        .service('CartService', function ($http,<br/>                                          $cookieStore,<br/>                                          $q,<br/>                                          $rootScope,<br/>                                          URL, BUCKET_SLUG, READ_KEY, WRITE_KEY) {<br/>            var that = this;<br/>            $http.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';</span><span id="fe7c" class="ln kc hu lj b fv ls lp l lq lr">            that.addToCart = function (item) {<br/>                var deferred = $q.defer();</span><span id="5222" class="ln kc hu lj b fv ls lp l lq lr">                var cart = $cookieStore.get('cart');<br/>                cart = cart ? cart : {};</span><span id="861f" class="ln kc hu lj b fv ls lp l lq lr">                if (!(item._id in cart)) {<br/>                    cart[item._id] = item._id;</span><span id="1b77" class="ln kc hu lj b fv ls lp l lq lr">                    $cookieStore.put('cart', cart);</span><span id="53bb" class="ln kc hu lj b fv ls lp l lq lr">                    deferred.resolve('Added to cart');<br/>                } else {<br/>                    deferred.reject('Error: Can\'t added to cart');<br/>                }</span><span id="04b3" class="ln kc hu lj b fv ls lp l lq lr">                return deferred.promise;<br/>            };</span><span id="3083" class="ln kc hu lj b fv ls lp l lq lr">            that.getCart = function () {<br/>                var deferred = $q.defer();<br/>                var cart = $cookieStore.get('cart');</span><span id="c933" class="ln kc hu lj b fv ls lp l lq lr">                if (cart) {<br/>                    deferred.resolve(cart);<br/>                } else {<br/>                    deferred.reject('Error: Can\'t get cart');<br/>                }</span><span id="94ba" class="ln kc hu lj b fv ls lp l lq lr">                return deferred.promise;<br/>            };</span><span id="37df" class="ln kc hu lj b fv ls lp l lq lr">            that.removeFromCart = function (_id) {<br/>                var deferred = $q.defer();</span><span id="e790" class="ln kc hu lj b fv ls lp l lq lr">                var cart = $cookieStore.get('cart');<br/>                cart = cart ? cart : {};</span><span id="461e" class="ln kc hu lj b fv ls lp l lq lr">                if (_id in cart) {<br/>                    delete cart[_id];</span><span id="a31f" class="ln kc hu lj b fv ls lp l lq lr">                    $cookieStore.put('cart', cart);</span><span id="486c" class="ln kc hu lj b fv ls lp l lq lr">                    deferred.resolve('Removed from cart');<br/>                } else {<br/>                    deferred.reject('Error: Can\'t remove from cart');<br/>                }</span><span id="8db3" class="ln kc hu lj b fv ls lp l lq lr">                return deferred.promise;<br/>            };</span><span id="c7b0" class="ln kc hu lj b fv ls lp l lq lr">            that.hasInCart = function (_id) {<br/>                var cart = $cookieStore.get('cart');<br/>                cart = cart ? cart : {};</span><span id="7bb7" class="ln kc hu lj b fv ls lp l lq lr">                return _id in cart;<br/>            };</span><span id="746b" class="ln kc hu lj b fv ls lp l lq lr">            that.completeOrder = function (order) {<br/>                var watches = [];</span><span id="ee13" class="ln kc hu lj b fv ls lp l lq lr">                order.watches.forEach(function (item) {<br/>                    watches.push(item._id);<br/>                });</span><span id="842c" class="ln kc hu lj b fv ls lp l lq lr">                return $http.post(URL + BUCKET_SLUG + '/add-object/', {<br/>                    write_key: WRITE_KEY,<br/>                    title: order.firstName + ' ' + order.lastName,<br/>                    type_slug: "orders",<br/>                    metafields: [<br/>                        {<br/>                            key: "first_name",<br/>                            type: "text",<br/>                            value: order.firstName</span><span id="689a" class="ln kc hu lj b fv ls lp l lq lr">                        },<br/>                        {<br/>                            key: "last_name",<br/>                            type: "text",<br/>                            value: order.lastName</span><span id="fafb" class="ln kc hu lj b fv ls lp l lq lr">                        },<br/>                        {<br/>                            key: "address",<br/>                            type: "text",<br/>                            value: order.address</span><span id="650d" class="ln kc hu lj b fv ls lp l lq lr">                        },<br/>                        {<br/>                            key: "city",<br/>                            type: "text",<br/>                            value: order.city</span><span id="32cc" class="ln kc hu lj b fv ls lp l lq lr">                        },<br/>                        {<br/>                            key: "phone",<br/>                            type: "text",<br/>                            value: order.phone</span><span id="0559" class="ln kc hu lj b fv ls lp l lq lr">                        },<br/>                        {<br/>                            key: "postal_code",<br/>                            type: "text",<br/>                            value: order.postalCode</span><span id="8136" class="ln kc hu lj b fv ls lp l lq lr">                        },<br/>                        {<br/>                            key: "email",<br/>                            type: "text",<br/>                            value: order.email<br/>                        },<br/>                        {<br/>                            key: "watches",<br/>                            type: "objects",<br/>                            object_type: "watches",<br/>                            value: watches.join()<br/>                        }<br/>                    ]<br/>                });<br/>            };<br/>        });<br/>})();</span></pre><p id="cad2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建购物车模块，复制并粘贴以下代码:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="95c9" class="ln kc hu lj b fv lo lp l lq lr">(function () {<br/>    'use strict';</span><span id="678d" class="ln kc hu lj b fv ls lp l lq lr">    angular<br/>        .module('cart', [<br/>            'cart.checkout'<br/>        ])<br/>        .config(config);</span><span id="4cb5" class="ln kc hu lj b fv ls lp l lq lr">    config.$inject = ['$stateProvider', '$urlRouterProvider'];<br/>    function config($stateProvider, $urlRouterProvider) {</span><span id="b0db" class="ln kc hu lj b fv ls lp l lq lr">        $stateProvider<br/>            .state('main.cart', {<br/>                url: 'cart',<br/>                templateUrl: '../views/cart/cart.html'<br/>            });<br/>    }<br/>})();</span></pre><h1 id="b79c" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">这是怎么回事</h1><ol class=""><li id="dac4" class="lt lu hu je b jf kz jj la jn lv jr lw jv lx jz ly lz ma mb dt translated">我们可以看到关于手表的信息。</li><li id="26e9" class="lt lu hu je b jf mc jj md jn me jr mf jv mg jz ly lz ma mb dt translated">我们可以在购物车中添加手表。</li></ol><h1 id="a9f0" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">后续步骤</h1><p id="bfd7" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><a class="ae ka" href="https://cosmicjs.com/apps/ecommerce-app" rel="noopener ugc nofollow" target="_blank">从宇宙JS </a>几分钟部署这个应用。部署之后，您可以通过转到Bucket&gt;Deploy Web App&gt;Set Environment Variables来将条带键设置为环境变量。开始添加产品并向用户收取商品费用！我希望你和我一样喜欢这个教程，如果你有任何问题<a class="ae ka" href="https://twitter.com/cosmic_js" rel="noopener ugc nofollow" target="_blank">在Twitter上联系我们</a>和<a class="ae ka" href="https://cosmicjs.com/community" rel="noopener ugc nofollow" target="_blank">加入我们的Slack社区</a>。</p><div class="le lf lg lh fq ab cb"><figure class="mh iv mi mj mk ml mm paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mh iv mi mj mk ml mm paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mh iv mi mj mk ml mm paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mn mo mp"><p id="f922" class="jc jd mq je b jf jg jh ji jj jk jl jm mr jo jp jq ms js jt ju mt jw jx jy jz hn dt translated"><a class="ae ka" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ka" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ka" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ka" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd mq je b jf jg jh ji jj jk jl jm mr jo jp jq ms js jt ju mt jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ka" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ka" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="le lf lg lh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mu"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>