<html>
<head>
<title>The spectacles of a web server log file</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">web服务器日志文件的奇观</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-spectacles-of-a-web-server-log-file-90c995e9e986?source=collection_archive---------5-----------------------#2017-02-14">https://medium.com/hackernoon/the-spectacles-of-a-web-server-log-file-90c995e9e986?source=collection_archive---------5-----------------------#2017-02-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/2a205e82c82933ebcc5c89a4ab58ee0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l1xmxsxQtBKEv_vUhaSHHQ.jpeg"/></div></div></figure><div class=""/><p id="512f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ka">使用</em><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="je ig"><em class="ka">netdata</em></strong></a><em class="ka">实时监控您的web服务器性能和健康状况。</em> <a class="ae kb" href="https://london.my-netdata.io/default.html#menu_web_log_nginx_netdata" rel="noopener ugc nofollow" target="_blank"> <em class="ka">查看现场演示</em> </a> <em class="ka">。</em></p><p id="b119" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Web服务器日志文件存在了20多年。</p><p id="0cbe" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">自从NCSA httpd为网络提供动力以来，来自所有厂商的所有类型的所有网络服务器都会产生日志文件，实时保存对网站和API的所有访问。</p><p id="05c5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然而，在线网络分析(如谷歌分析)出现后，所有这些网络服务器日志文件大多只是填充我们的磁盘，每晚轮换，没有任何用途。</p><p id="6547" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> <em class="ka">这就要变了！</em> </strong></p><p id="fb7f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我将向您展示如何轻松地将这个“无用”的日志文件变成一个强大的性能和健康监控工具，能够实时检测最常见的web服务器问题，包括:</p><ul class=""><li id="0ef1" class="kc kd if je b jf jg jj jk jn ke jr kf jv kg jz kh ki kj kk dt translated"><strong class="je ig">太多重定向<br/> </strong>(即哎呀！这不应该将客户端重定向到自身！)</li><li id="64da" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz kh ki kj kk dt translated"><strong class="je ig">太多错误请求<br/> </strong>(即哎呀！<em class="ka">有几个文件没有上传！</em>)</li><li id="31d3" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz kh ki kj kk dt translated"><strong class="je ig">太多内部服务器错误<br/> </strong>(即哎呀！<em class="ka">这个版本崩溃太多！</em>)</li><li id="87e7" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz kh ki kj kk dt translated"><strong class="je ig">无理过多的要求<br/> </strong>(即哎呀！我们受到攻击了！)</li><li id="6569" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz kh ki kj kk dt translated"><strong class="je ig">无理地少提要求<br/> </strong>(即哎呀！<em class="ka">给网络佬打电话！</em>)</li><li id="8c91" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz kh ki kj kk dt translated"><strong class="je ig">反应异常缓慢<br/> </strong>(即哎呀！<em class="ka">数据库又慢了！</em>)</li><li id="f730" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz kh ki kj kk dt translated"><strong class="je ig">成功回复<br/> </strong>(即哎呀！<em class="ka">上帝帮帮我们吧！</em>)</li></ul></div><div class="ab cl kq kr hc ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hn ho hp hq hr"><h1 id="6d70" class="kx ky if bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">安装<a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank">网络数据</a></h1><p id="910d" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">如果您还没有，现在可能是安装<a class="ae kb" href="https://github.com/firehol/netdata/wiki/Installation" rel="noopener ugc nofollow" target="_blank">netdata</a>的好时机。</p><p id="6ee8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>是一个针对<a class="ae kb" href="https://hackernoon.com/tagged/linux" rel="noopener ugc nofollow" target="_blank"> Linux </a>、FreeBSD和MacOS的性能和健康监控系统。<a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>是<strong class="je ig">实时</strong>，这意味着它所做的一切都是每秒<strong class="je ig">秒</strong>的，因此所有呈现的信息都是交互式的，并且仅滞后一秒。</p><p id="96a5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你把它安装在一个运行网络服务器的系统上，它会检测到它并自动显示一系列图表，这些图表包含从网络服务器API获得的信息，就像这些(<em class="ka">这些不是来自网络服务器日志文件</em>):</p><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ma"><img src="../Images/ff1738136cd7bc9b60e35ee2c5742548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JITOYj1mChP30F9k.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="bd mj"><em class="mk">netdata</em></strong></a><em class="mk"> charts based on metrics collected by querying the </em><code class="eh ml mm mn mo b"><em class="mk">nginx</em></code><em class="mk"> API<br/>(i.e. </em><code class="eh ml mm mn mo b"><em class="mk">/stab_status</em></code><em class="mk">).</em></figcaption></figure><blockquote class="mp mq mr"><p id="4726" class="jc jd ka je b jf jg jh ji jj jk jl jm ms jo jp jq mt js jt ju mu jw jx jy jz hn dt translated"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="je ig"><em class="if">netdata</em></strong></a><strong class="je ig"><em class="if">，</em> </strong> <em class="if">在本文写作时，支持</em> <code class="eh ml mm mn mo b"><em class="if">apache</em></code> <em class="if">，</em> <code class="eh ml mm mn mo b"><em class="if">nginx</em></code> <em class="if">，</em> <code class="eh ml mm mn mo b"><em class="if">lighttpd</em></code> <em class="if">，</em> <code class="eh ml mm mn mo b"><em class="if">tomcat</em></code> <em class="if">。为了从web服务器API获得实时信息，web服务器需要公开它。关于配置你的网络服务器的指导，检查</em> <code class="eh ml mm mn mo b"><a class="ae kb" href="https://github.com/firehol/netdata/tree/master/conf.d/python.d" rel="noopener ugc nofollow" target="_blank"><em class="if">/etc/netdata/python.d/</em></a></code> <em class="if">。每个web服务器都有一个文件。</em></p></blockquote></div><div class="ab cl kq kr hc ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hn ho hp hq hr"><h1 id="430a" class="kx ky if bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">跟踪圆木！</h1><p id="1131" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>有一个强大的<code class="eh ml mm mn mo b">web_log</code>插件，能够增量解析任意数量的web服务器日志文件。这个插件是由<a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>自动启动的，并且是预先配置好的，用于查找流行发行版上的web服务器日志文件。</p><p id="96ec" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它的配置在<code class="eh ml mm mn mo b"><a class="ae kb" href="https://github.com/firehol/netdata/blob/master/conf.d/python.d/web_log.conf" rel="noopener ugc nofollow" target="_blank">/etc/netdata/python.d/web_log.conf</a></code>处，看起来像这样:</p><figure class="mb mc md me fq hw"><div class="bz el l di"><div class="mv mw l"/></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ak"><em class="mk">netdata</em></strong></a> web_log plugin configuration for a web server log file.</figcaption></figure><p id="e462" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以为每个web服务器日志文件添加一个这样的部分。</p><blockquote class="mp mq mr"><p id="1035" class="jc jd ka je b jf jg jh ji jj jk jl jm ms jo jp jq mt js jt ju mu jw jx jy jz hn dt translated"><strong class="je ig"> <em class="if">重要</em> </strong> <em class="if"> <br/>牢记</em><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="je ig"><em class="if">net data</em></strong></a><em class="if">运行方式为用户</em> <code class="eh ml mm mn mo b"><em class="if">netdata</em></code> <em class="if">。因此，请确保用户</em> <code class="eh ml mm mn mo b"><em class="if">netdata</em></code> <em class="if">有权访问web服务器日志目录，并且可以读取日志文件。</em></p></blockquote></div><div class="ab cl kq kr hc ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hn ho hp hq hr"><h1 id="caad" class="kx ky if bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">绘制日志！</h1><p id="4b54" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">一旦您配置了所有日志文件并且重新启动了<a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="je ig">netdata</strong></a><strong class="je ig">，您将在<a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>仪表板上看到一个部分，包含以下图表。</strong></p><h2 id="dc47" class="mx ky if bd kz my mz na ld nb nc nd lh jn ne nf ll jr ng nh lp jv ni nj lt nk dt translated">按状态列出的响应</h2><p id="7f3f" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">在此图表中，我们试图为所有回答提供一个有意义的状态。所以:</p><ul class=""><li id="7b89" class="kc kd if je b jf jg jj jk jn ke jr kf jv kg jz kh ki kj kk dt translated"><code class="eh ml mm mn mo b">success</code>统计所有有效响应(即<code class="eh ml mm mn mo b">1xx</code>信息，<code class="eh ml mm mn mo b">2xx</code>成功，<code class="eh ml mm mn mo b">304</code>未修改)。</li><li id="c736" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz kh ki kj kk dt translated"><code class="eh ml mm mn mo b">error</code>是<code class="eh ml mm mn mo b">5xx</code>内部服务器错误。这些都是非常不好的，它们意味着你的网站或者API面临困难。</li><li id="6de8" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz kh ki kj kk dt translated"><code class="eh ml mm mn mo b">redirect</code>为<code class="eh ml mm mn mo b">3xx</code>响应，除了<code class="eh ml mm mn mo b">304</code>。所有的<code class="eh ml mm mn mo b">3xx</code>都是重定向，但是<code class="eh ml mm mn mo b">304</code>意味着“未修改”——它告诉浏览器他们已经拥有的内容仍然有效，可以照原样使用。因此，我们决定将其视为一个成功的回应。</li><li id="a91f" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz kh ki kj kk dt translated"><code class="eh ml mm mn mo b">bad</code>是无法满足的错误请求。</li><li id="c5d4" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz kh ki kj kk dt translated"><code class="eh ml mm mn mo b">other</code>所有其他非标准类型的响应。</li></ul><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nl"><img src="../Images/b017dbc28a9c469660abd6549e71a1ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vun9dRBZsIUGJKN1.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="bd mj"><em class="mk">netdata</em></strong></a><strong class="bd mj"><em class="mk"> </em></strong>real-time chart of web server responses by status, obtained from its log file</figcaption></figure><h2 id="6990" class="mx ky if bd kz my mz na ld nb nc nd lh jn ne nf ll jr ng nh lp jv ni nj lt nk dt translated">按类型排列的响应</h2><p id="94db" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">然后，我们按照代码系列对所有响应进行分组，而不解释它们的含义。</p><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nm"><img src="../Images/39e2efc007aaaf0a3bc600532361e59a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Sx6gA1dTO2o_W--y.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="bd mj"><em class="mk">netdata</em></strong></a><strong class="bd mj"><em class="mk"> </em></strong>real-time chart of web server responses by type, obtained from its log file</figcaption></figure><h2 id="d29e" class="mx ky if bd kz my mz na ld nb nc nd lh jn ne nf ll jr ng nh lp jv ni nj lt nk dt translated">按代码的响应</h2><p id="1e57" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">这里我们显示了每个响应代码的请求数。</p><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nn"><img src="../Images/873d0f9c6f92affe0e0a45590e40772c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SCHeWT9QYFkk1zSp.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="bd mj"><em class="mk">netdata</em></strong></a><strong class="bd mj"><em class="mk"> </em></strong>real-time chart of web server responses by code, obtained from its log file</figcaption></figure><blockquote class="mp mq mr"><p id="1010" class="jc jd ka je b jf jg jh ji jj jk jl jm ms jo jp jq mt js jt ju mu jw jx jy jz hn dt translated"><strong class="je ig"> <em class="if">重要</em> </strong> <em class="if"> <br/>如果您的应用程序正在使用数百个非标准响应代码，您的浏览器在查看此图表时可能会变慢，因此我们添加了一个配置</em> <a class="ae kb" href="https://github.com/firehol/netdata/blob/419cd0a237275e5eeef3f92dcded84e735ee6c58/conf.d/python.d/web_log.conf#L63" rel="noopener ugc nofollow" target="_blank"> <em class="if">选项来禁用此图表</em> </a> <em class="if">。</em></p></blockquote><h2 id="0f9b" class="mx ky if bd kz my mz na ld nb nc nd lh jn ne nf ll jr ng nh lp jv ni nj lt nk dt translated">带宽</h2><p id="fbb7" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">这是web服务器接收和发送流量的一个很好的视图。</p><p id="fd04" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于这个图表，重要的是要知道，每个请求和响应使用的带宽是在写入日志时计算的。由于<a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>每秒都会刷新这个图表，如果请求或响应太大，可能会出现不切实际的峰值。原因很简单:一个响应可能需要1分钟才能完成，但是在该分钟内用于特定响应的所有带宽将在日志行被写入的第二秒被计算在内。</p><p id="20cf" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正如图表上的图例所示，您可以使用FireQoS在web服务器端口和IPs上设置QoS，以准确测量web服务器正在使用的带宽。实际上，<a class="ae kb" href="https://github.com/firehol/netdata/wiki/You-should-install-QoS-on-all-your-servers" rel="noopener ugc nofollow" target="_blank">在您的服务器上安装QoS可能还有更多原因</a> …</p><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff no"><img src="../Images/05f37c5ed0e9d4a249859a3d218543b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6bB01Ht6qQx4iunF.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="bd mj"><em class="mk">netdata</em></strong></a><strong class="bd mj"><em class="mk"> </em></strong>real-time chart of web server bandwidth, obtained from its log file</figcaption></figure><blockquote class="mp mq mr"><p id="ffcc" class="jc jd ka je b jf jg jh ji jj jk jl jm ms jo jp jq mt js jt ju mu jw jx jy jz hn dt translated"><strong class="je ig"> <em class="if">重要<br/> </em> </strong> <em class="if">大多数web服务器默认不记录请求大小。<br/>因此，</em> <a class="ae kb" href="https://github.com/firehol/netdata/blob/419cd0a237275e5eeef3f92dcded84e735ee6c58/conf.d/python.d/web_log.conf#L76-L89" rel="noopener ugc nofollow" target="_blank"> <em class="if">除非您已经将web服务器配置为记录请求的大小</em> </a> <em class="if">，否则</em> <code class="eh ml mm mn mo b"><em class="if">received</em></code> <em class="if">维度将始终为零。</em></p></blockquote><h2 id="469f" class="mx ky if bd kz my mz na ld nb nc nd lh jn ne nf ll jr ng nh lp jv ni nj lt nk dt translated">计时</h2><p id="c30c" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>还将呈现web服务器响应请求所需的<code class="eh ml mm mn mo b">minimum</code>、<code class="eh ml mm mn mo b">average</code>和<code class="eh ml mm mn mo b">maximum</code>时间。</p><p id="9450" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请记住，大多数web服务器的计时都是从收到完整的请求开始，一直到发出最后一个字节的响应。因此，它们包括响应的网络延迟，但不包括请求的网络延迟。</p><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nl"><img src="../Images/f3bc59e3297309dd06d8e394bc4aa69d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RxGzzVt83vSfjkfL.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="bd mj"><em class="mk">netdata</em></strong></a><strong class="bd mj"><em class="mk"> </em></strong>real-time chart of web server response timings, obtained from its log file</figcaption></figure><blockquote class="mp mq mr"><p id="c864" class="jc jd ka je b jf jg jh ji jj jk jl jm ms jo jp jq mt js jt ju mu jw jx jy jz hn dt translated"><strong class="je ig"> <em class="if">重要<br/> </em> </strong> <em class="if">大多数web服务器默认不记录定时信息。<br/>因此，</em> <a class="ae kb" href="https://github.com/firehol/netdata/blob/419cd0a237275e5eeef3f92dcded84e735ee6c58/conf.d/python.d/web_log.conf#L76-L89" rel="noopener ugc nofollow" target="_blank"> <em class="if">除非您已经将web服务器配置为也记录计时</em> </a> <em class="if">，否则此图表将不存在。</em></p></blockquote><h2 id="c98b" class="mx ky if bd kz my mz na ld nb nc nd lh jn ne nf ll jr ng nh lp jv ni nj lt nk dt translated">URL模式</h2><p id="a421" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">这是一个非常有趣的图表。它完全由您配置。</p><p id="553f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>可以将日志文件中找到的URL映射到类别中。您可以通过在<code class="eh ml mm mn mo b">web_log.conf</code>中提供名称和正则表达式来定义这些类别。</p><p id="ed66" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以，这个配置(对于我的API URLs):</p><figure class="mb mc md me fq hw"><div class="bz el l di"><div class="mv mw l"/></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ak"><em class="mk">netdata</em></strong></a> web_log plugin configuration for a web server log file.</figcaption></figure><p id="7e96" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">生成以下图表。<code class="eh ml mm mn mo b">categories</code>部分按照给定的顺序匹配。所以，注意你给你的模式的顺序。</p><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff np"><img src="../Images/7482e282441ce2e157502cd1ac20049f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2Vt3Sfe4YjHExclU.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="bd mj"><em class="mk">netdata</em></strong></a><strong class="bd mj"><em class="mk"> </em></strong>real-time chart of web server URL patterns, obtained from its log file</figcaption></figure><h2 id="5432" class="mx ky if bd kz my mz na ld nb nc nd lh jn ne nf ll jr ng nh lp jv ni nj lt nk dt translated">HTTP方法</h2><p id="82ac" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">此图表按使用的HTTP方法对请求进行了细分。</p><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nl"><img src="../Images/66f30edeabccf670c561fc23b4806866.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KVrN9rqJ0X3ezG8g.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="bd mj"><em class="mk">netdata</em></strong></a><strong class="bd mj"><em class="mk"> </em></strong>real-time chart of web server HTTP request methods, obtained from its log file</figcaption></figure><h2 id="e14c" class="mx ky if bd kz my mz na ld nb nc nd lh jn ne nf ll jr ng nh lp jv ni nj lt nk dt translated">IP版本</h2><p id="b432" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">这个提供了客户端使用的每个IP版本的请求(<code class="eh ml mm mn mo b">IPv4</code>、<code class="eh ml mm mn mo b">IPv6</code>)。</p><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nl"><img src="../Images/b169af8232cdebecc57b7425928ed746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hq19bUFzWJJ9y4Et.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="bd mj"><em class="mk">netdata</em></strong></a><strong class="bd mj"><em class="mk"> </em></strong>real-time chart of web server clients IP version, obtained from its log file</figcaption></figure><h2 id="654b" class="mx ky if bd kz my mz na ld nb nc nd lh jn ne nf ll jr ng nh lp jv ni nj lt nk dt translated">独特的客户</h2><p id="c5c8" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">最后的图表是关于访问你的网络服务器的独特的IP。</p><p id="459a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这一项计算每个数据收集迭代的唯一IP数(即<strong class="je ig">每秒的唯一客户端数</strong>)。</p><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nq"><img src="../Images/abdcac3bf2ce17f2fa648d6ef03fdff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pOtALAMQG4HpySva.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="bd mj"><em class="mk">netdata</em></strong></a><strong class="bd mj"><em class="mk"> </em></strong>real-time chart of web server unique clients, obtained from its log file</figcaption></figure><p id="08be" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">而这一个，算唯一的IPs，自从上次<a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>重启之后。</p><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nr"><img src="../Images/b1fa4c085bb23f76770a5d350309d2c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-VTESnJUzXmDlROa.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"><strong class="bd mj"><em class="mk">netdata</em></strong></a><strong class="bd mj"><em class="mk"> </em></strong>real-time chart of web server unique client, obtained from its log file</figcaption></figure><blockquote class="mp mq mr"><p id="5ecf" class="jc jd ka je b jf jg jh ji jj jk jl jm ms jo jp jq mt js jt ju mu jw jx jy jz hn dt translated"><strong class="je ig"> <em class="if">重要信息</em> </strong> <em class="if"> <br/>提供此信息</em> <code class="eh ml mm mn mo b"><em class="if">web_log</em></code> <em class="if">插件在内存中保存web服务器看到的所有IP。虽然这不需要太多内存，但如果您的web服务器有几百万个唯一的客户端IP，我们建议使用</em> <a class="ae kb" href="https://github.com/firehol/netdata/blob/419cd0a237275e5eeef3f92dcded84e735ee6c58/conf.d/python.d/web_log.conf#L64" rel="noopener ugc nofollow" target="_blank"> <em class="if">禁用此图表</em> </a> <em class="if">。</em></p></blockquote></div><div class="ab cl kq kr hc ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hn ho hp hq hr"><h1 id="d506" class="kx ky if bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">注意日志！</h1><p id="2e97" class="pw-post-body-paragraph jc jd if je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>的神奇之处在于，每秒钟都会收集到所有的指标，所有的指标都可以用来或者关联起来提供<strong class="je ig">实时告警</strong>。</p><p id="26ac" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">开箱后，<a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>自动将<a class="ae kb" href="https://github.com/firehol/netdata/blob/master/conf.d/health.d/web_log.conf" rel="noopener ugc nofollow" target="_blank">以下报警</a>附加到所有<code class="eh ml mm mn mo b">web_log</code>图表(即单独附加到每个日志文件):</p><ol class=""><li id="d7e0" class="kc kd if je b jf jg jj jk jn ke jr kf jv kg jz ns ki kj kk dt translated"><code class="eh ml mm mn mo b">1m_redirects<br/></code>在最后一分钟内，HTTP重定向(3xx，304除外)占所有请求的比率。<br/> <em class="ka">检测站点或web API是否遭受过多或循环重定向</em>(即<strong class="je ig">哎呀！</strong> <em class="ka">这不应该将客户端重定向到自身</em>。<br/>最低要求:120次/分钟<br/>警告:&gt; 20% <br/>临界:&gt; 30%</li><li id="8389" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz ns ki kj kk dt translated"><code class="eh ml mm mn mo b">1m_bad_requests<br/></code>在最后一分钟内，HTTP错误请求(4xx)占所有请求的比率。<br/> <em class="ka">检测站点或web API是否收到太多错误请求，包括</em> <code class="eh ml mm mn mo b"><em class="ka">404</em></code> <em class="ka">、未找到</em>(即<strong class="je ig">哎呀！</strong> <em class="ka">少数文件未上传</em>)。<br/>最低要求:120次/分钟<br/>警告:&gt; 30% <br/>紧急:&gt; 50%</li><li id="c431" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz ns ki kj kk dt translated"><code class="eh ml mm mn mo b">1m_internal_errors<br/></code>在最后一分钟内，HTTP内部服务器错误(5xx)占所有请求的比率。<br/> <em class="ka">检测站点是否面临服务请求</em>的困难(即<strong class="je ig">哎呀！</strong> <em class="ka">这个发布崩溃太多</em>)。<br/>最低要求:120次/分钟<br/>警告:&gt; 2% <br/>危急:&gt; 5%</li><li id="3653" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz ns ki kj kk dt translated"><code class="eh ml mm mn mo b">5m_requests_ratio<br/></code>与前5分钟相比，前5分钟成功的web请求的百分比。<br/> <em class="ka">检测站点或web API是否突然收到太多或太少的请求</em>(即太多= <strong class="je ig">哎呀！</strong> <em class="ka">我们受到攻击，</em>还是太少= <strong class="je ig">哎呀！</strong> <em class="ka">叫网络佬</em> ) <br/>最低要求:120/5min <br/>警告:&gt;双倍，或&lt;一半<br/>临界:&gt; 4x，或&lt; 1/4x</li><li id="3be2" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz ns ki kj kk dt translated"><code class="eh ml mm mn mo b">web_slow<br/></code>与过去10分钟的平均响应时间相比，过去1分钟内响应请求的平均时间。<br/> <em class="ka">检测站点或web API是否突然变慢</em>(即<strong class="je ig">哎呀！</strong> <em class="ka">数据库又慢了</em>)。最低要求:120/分钟<br/>警告:&gt; 2x <br/>紧急:&gt; 4x</li><li id="5952" class="kc kd if je b jf kl jj km jn kn jr ko jv kp jz ns ki kj kk dt translated"><code class="eh ml mm mn mo b">1m_successful<br/></code>在最后一分钟内，成功的HTTP响应(1xx，2xx，304)与所有请求的比率。<br/> <em class="ka">检测站点或web API是否在限制范围内运行</em>(即<strong class="je ig">哎呀！</strong> <em class="ka">上帝帮帮我们吧！</em>)。<br/>最低要求:120次/分钟<br/>警告:&lt; 85% <br/>危急:&lt; 75%</li></ol><p id="a011" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ml mm mn mo b">minimum requests</code>说明待评估警报所需的最小请求数。我们发现，当网站收到的请求超过这个比率时，这些警报相当准确(即没有误报)。</p><p id="cad8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae kb" href="https://my-netdata.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> netdata </strong> </a>报警为<a class="ae kb" href="https://github.com/firehol/netdata/tree/master/conf.d/health.d" rel="noopener ugc nofollow" target="_blank">用户可配置</a>。因此，即使是<code class="eh ml mm mn mo b"><a class="ae kb" href="https://github.com/firehol/netdata/blob/master/conf.d/health.d/web_log.conf" rel="noopener ugc nofollow" target="_blank">web_log</a></code> <a class="ae kb" href="https://github.com/firehol/netdata/blob/master/conf.d/health.d/web_log.conf" rel="noopener ugc nofollow" target="_blank">闹钟也能适应你的需求</a>。</p><p id="9d17" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">享受实时性能和运行状况监控！</p><div class="mb mc md me fq ab cb"><figure class="nt hw nu nv nw nx ny paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nt hw nu nv nw nx ny paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nt hw nu nv nw nx ny paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mp mq mr"><p id="f922" class="jc jd ka je b jf jg jh ji jj jk jl jm ms jo jp jq mt js jt ju mu jw jx jy jz hn dt translated"><a class="ae kb" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是这个家庭的一员。我们现在<a class="ae kb" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kb" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd ka je b jf jg jh ji jj jk jl jm ms jo jp jq mt js jt ju mu jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kb" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kb" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="mb mc md me fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nz"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="mb mc md me fq hw"><div class="bz el l di"><div class="oa mw l"/></div></figure></div></div>    
</body>
</html>