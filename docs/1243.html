<html>
<head>
<title>Feature Switches, Inheritance and Agile with Scala &amp; JMX on the JVM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JVM上Scala和JMX的特性切换、继承和敏捷</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/feature-switches-inheritance-and-agile-with-scala-jmx-on-the-jvm-140b4bf94d9f?source=collection_archive---------2-----------------------#2016-09-30">https://medium.com/hackernoon/feature-switches-inheritance-and-agile-with-scala-jmx-on-the-jvm-140b4bf94d9f?source=collection_archive---------2-----------------------#2016-09-30</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0531" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://www.scalawilliam.com/1609/feature-switches-agile-scala-jmx/" rel="noopener ugc nofollow" target="_blank"><em class="jq">https://www . Scala willian . com/1609/feature-switches-agile-Scala-JMX/</em></a></p><p id="19c6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还记得上一次生产中的一项关键服务工作不正常，而您恢复了您的更改，或者为新配置重新启动了服务吗？我也不知道。</p><p id="a590" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我最近的一份合同中，在产品部署前10天，我开始开发一个实际上需要2-3个月的功能。管理层没有考虑到任务的复杂性，但是不用担心:我们有敏捷和<a class="ae jp" href="https://www.playframework.com/" rel="noopener ugc nofollow" target="_blank"> Play </a> <a class="ae jp" href="http://scala-lang.org/" rel="noopener ugc nofollow" target="_blank"> Scala </a>供我们使用。</p><p id="e2a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你知道你会错过，就不会设定最后期限，所有的风险都消失了，只剩下确定性。</p><p id="b6c9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我同意项目经理实现最简单、最笨、最安全的东西，这样至少我们不会错过最后期限。进入master需要一天时间。</p><p id="6aac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将是我们的基本界面:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="jw jx l"/></div></figure><p id="6112" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Scala 中有一个非常愚蠢的实现，叫做‘static feature’</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="jw jx l"/></div></figure><p id="af1a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在知道了管理层将会要求对最终的可交付产品进行不断的更新，我同意产品负责人的观点，实现一些简单的至少部分满足需求的东西会更有意义，但是会花费更少的时间。这花了2周时间，我们能够非常轻松地将其部署到生产环境中。如果出现任何问题，我们将能够切换回我们之前同意的东西(即‘static feature’)。</p><p id="b539" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">欢迎使用“高级功能”，它比“静态功能”复杂10倍，经过测试，当它无法满足要求时，可以退回到“静态功能”。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="jw jx l"/></div></figure><p id="4b74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，让我们说，而不是失败和后退，“高级功能”返回不正确的输出？因为输入的XML非常松散，所以不能保证所有的东西都像预期的那样工作，而且没有一个东西可以很容易地进行单元测试。</p><p id="7825" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，我们如何切换回来？还原Git代码？重新部署配置更改？加油！我们可以随意使用JVM。它有一个叫做<a class="ae jp" href="https://hackernoon.com/tagged/jmx" rel="noopener ugc nofollow" target="_blank">JMX</a>(“<a class="ae jp" href="http://openjdk.java.net/groups/jmx/" rel="noopener ugc nofollow" target="_blank">Java管理扩展</a>”)的东西，为你提供了一种在运行时管理应用的方法。您可以进行度量、重新绑定端口、更改配置选项、更改日志详细程度、运行诊断，等等。所以你应该这么做:</p><p id="d6f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，您编写一个通用接口，即“管理Bean”:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="jw jx l"/></div></figure><p id="4d14" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后编写一个实现，将该组件注册到JMX注册表，并允许远程调用其方法:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="jw jx l"/></div></figure><p id="fbba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，当您的应用程序运行时，您打开<a class="ae jp" href="http://www.oracle.com/technetwork/java/javaseproducts/mission-control/java-mission-control-1998576.html" rel="noopener ugc nofollow" target="_blank">Java Mission Control</a>(UNIX shell中的jmc)，连接到应用程序，然后您可以立即更改值(它会在按下Return时调用setFeatureLevel方法):</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff jy"><img src="../Images/4381260e8c130eb392529aebca1f9518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gXqhtsEU8DAl5QcDz9cdDQ.png"/></div></div></figure><p id="3d4d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当然，在生产中，你可能希望有一些更容易使用的东西，在这种情况下，我使用了<a class="ae jp" href="https://docs.oracle.com/javase/8/docs/technotes/guides/scripting/nashorn/shell.html" rel="noopener ugc nofollow" target="_blank"> Java 8的JavaScript解释器jjs </a>来连接到一个远程运行的进程，并通过一个Shell脚本来更改配置值。</p><p id="f8d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，企业已经确定，他们将得到一个给出预期行为的更小版本，而不是被不正确的行为所困扰。</p><p id="da6a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最终实现，“ComplexFeature”:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="jw jx l"/></div></figure><p id="7a80" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是迄今为止最复杂的一次，该企业希望像A-B那样将该功能推广到多个生产环境中。在第一个环境上运行几个星期，然后在第二个环境上运行，然后在第三个环境上运行，最后我们完成第四个环境。如果出现任何问题，我们会求助于较低版本，并在运行时更改级别。简单方便。</p><p id="10cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种方法是成功的。Ops很喜欢。阿宝很喜欢。</p><ol class=""><li id="38bd" class="kf kg hu it b iu iv iy iz jc kh jg ki jk kj jo kk kl km kn dt translated">如果特征C开始产生不正确的结果，它将退回到b。</li><li id="0ecf" class="kf kg hu it b iu ko iy kp jc kq jg kr jk ks jo kk kl km kn dt translated">如果特征B开始产生不正确的结果，它将退回到a。</li><li id="0c4f" class="kf kg hu it b iu ko iy kp jc kq jg kr jk ks jo kk kl km kn dt translated">Ops能够在运行时在这些级别之间切换。</li><li id="c6d5" class="kf kg hu it b iu ko iy kp jc kq jg kr jk ks jo kk kl km kn dt translated">Ops能够将相同的代码部署到不同的生产环境中，并A/B测试这些更改。</li><li id="f4c6" class="kf kg hu it b iu ko iy kp jc kq jg kr jk ks jo kk kl km kn dt translated">Ops和Test能够将相同的代码部署到生产、试运行和测试环境中，并验证每个功能的行为。</li><li id="b59e" class="kf kg hu it b iu ko iy kp jc kq jg kr jk ks jo kk kl km kn dt translated">Ops能够监控DataDog的行为和回退率。</li></ol><p id="1a29" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">现在有总比没有好。</strong></p><p id="b35a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但现在的一切都比现在的东西好，所以选择Scala &amp; JDK 8，它拥有一切。</p><p id="cf59" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在LinkedIn 和Twitter<a class="ae jp" href="https://twitter.com/ScalaWilliam" rel="noopener ugc nofollow" target="_blank">上与我</a><a class="ae jp" href="https://www.linkedin.com/in/scalawilliam" rel="noopener ugc nofollow" target="_blank">联系。</a></p><p id="8402" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt">—</p><p id="ab5b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">更新，2016年11月4日</strong>:一位读者提了一个很好的问题:</p><blockquote class="kt ku kv"><p id="f9bd" class="ir is jq it b iu iv iw ix iy iz ja jb kw jd je jf kx jh ji jj ky jl jm jn jo hn dt translated">那么，与数据库交换相比，有哪些优点和缺点呢？</p></blockquote><p id="30e5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的回答是:</p><blockquote class="kt ku kv"><p id="f27f" class="ir is jq it b iu iv iw ix iy iz ja jb kw jd je jf kx jh ji jj ky jl jm jn jo hn dt translated">与数据库交换机相比，没有缺点，只有优点。因为您的服务是远程的，所以您需要解决的是如何执行这个触发器。</p><p id="3c62" class="ir is jq it b iu iv iw ix iy iz ja jb kw jd je jf kx jh ji jj ky jl jm jn jo hn dt translated">1.通过SSH隧道实现Java任务控制。您需要指定额外的Java属性来实现这一点。<br/> 2。从服务器本身进行调用的自定义脚本。这是我在文章中采用的方法。工具的构建需要一点时间。<br/> 3。在服务器上启动类似Hawtio的东西:【http://hawt.io/】T2这是一个非常好的简单方法，但是你需要确保对它的访问控制。需要神灯:【https://jolokia.org/】<br/>4<a class="ae jp" href="https://jolokia.org/" rel="noopener ugc nofollow" target="_blank">。通过REST使用</a><a class="ae jp" href="https://jolokia.org/" rel="noopener ugc nofollow" target="_blank">https://jolokia.org/</a>和你自己的管理面板。在这里你想抽象出低层次的细节。</p><p id="67ef" class="ir is jq it b iu iv iw ix iy iz ja jb kw jd je jf kx jh ji jj ky jl jm jn jo hn dt translated">如果您的开发人员可以访问生产机器并知道他们在做什么(小团队，很少的应用程序)，请选择#1。如果您的开发人员和开发人员保持密切沟通，但开发人员没有生产权限，请选择#2。<br/>如果机器上运行更多应用程序，甚至可能是同一应用程序的多个实例，请选择#3。<br/>如果您向拥有自己运营团队的客户交付产品，并且需要对您的产品进行特别可靠的控制，请选择#4。我认为这将需要一篇进一步的文章。<br/>数据库不应该真正用于配置或管理。但是当然不是所有的平台都支持管理设施。</p></blockquote><div class="jr js jt ju fq ab cb"><figure class="kz jv la lb lc ld le paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="kz jv la lb lc ld le paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="kz jv la lb lc ld le paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="kt ku kv"><p id="f922" class="ir is jq it b iu iv iw ix iy iz ja jb kw jd je jf kx jh ji jj ky jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿妹家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>的机会。</p><p id="708a" class="ir is jq it b iu iv iw ix iy iz ja jb kw jd je jf kx jh ji jj ky jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jr js jt ju fq jv fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff lf"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lg jx l"/></div></figure></div></div>    
</body>
</html>