<html>
<head>
<title>Youtube to MP3 using S3, Lambda &amp; Elastic Transcoder</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用S3、拉姆达和弹性转码器将Youtube转换为MP3</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/youtube-to-mp3-using-s3-lambda-elastic-transcoder-df2c5903dea8?source=collection_archive---------9-----------------------#2017-10-21">https://medium.com/hackernoon/youtube-to-mp3-using-s3-lambda-elastic-transcoder-df2c5903dea8?source=collection_archive---------9-----------------------#2017-10-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/3a45db545d92acc43ed47c831198bda6.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*QouD2Gm74jIG4mRMXlk5cQ.png"/></div></figure><p id="cf83" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在本教程中，我将向你展示如何使用<strong class="ja hv"> AWS Elastic Transcode </strong> r将一个<strong class="ja hv"> Youtube </strong>视频转换成mp3文件。我们该如何做呢？</p><p id="53d5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们将创建一个<strong class="ja hv"> Lambda函数</strong>来消费<strong class="ja hv"> S3 </strong>发布的事件。对于上传到桶中的任何视频，<strong class="ja hv"> S3 </strong>将通过传递事件信息来调用我们的<strong class="ja hv"> Lambda </strong>函数。<strong class="ja hv"> AWS Lambda </strong>执行该功能。当该函数执行时，它读取<strong class="ja hv"> S3 </strong>事件数据，将一些事件信息记录到<strong class="ja hv"> Amazon CloudWatch </strong>。然后，开始转码作业。</p><p id="68a1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们开始，通过创建一个<strong class="ja hv"> S3桶</strong>来存储<em class="jw">输入</em>文件(视频)和<em class="jw">输出</em>文件(音频) :</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/6a3604a037b52aa275eaa6bc0b628b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*VL3Ou-wXx8LDo6Vw."/></div></figure><p id="a0bd" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">接下来，让我们定义一个<strong class="ja hv">代码转换器管道</strong>。流水线本质上定义了一个队列，用于将来的转码作业。要创建一个管道，我们需要指定输入桶(视频将在那里)。</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/84c7d17d8499614fd6fa346055134603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*q2WtMBpHjzq_LrZ6."/></div></figure><p id="81e8" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:记下<strong class="ja hv">管道ID </strong>，我们稍后会用到</p><p id="3936" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">创建好管道后，进入<a class="ae kc" href="https://console.aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS管理控制台</a>，导航到<strong class="ja hv"> Lambda </strong>服务&amp;点击<strong class="ja hv">创建Lambda函数</strong>，添加<strong class="ja hv"> S3 </strong>作为<strong class="ja hv"> Lambda </strong>函数的事件源:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/d900c35ad200051c4086854b73dde071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*WcbFn2qRAoLMiz_S."/></div></figure><p id="438a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我使用了下面的<a class="ae kc" href="https://github.com/mlabouardy/lambda-examples" rel="noopener ugc nofollow" target="_blank">节点。JS代码</a>:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kd ke l"/></div></figure><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/fca51da7eb2dbf5005bc77be86668597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*jcUce0TuMlm0zMrr."/></div></figure><p id="5c0b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">该脚本执行以下操作:</p><ul class=""><li id="e0b2" class="kf kg hu ja b jb jc jf jg jj kh jn ki jr kj jv kk kl km kn dt translated">从事件对象中提取上传文件的文件名</li><li id="4515" class="kf kg hu ja b jb ko jf kp jj kq jn kr jr ks jv kk kl km kn dt translated">创建一个<strong class="ja hv">代码转换器jo </strong> b并指定所需的输出</li><li id="7295" class="kf kg hu ja b jb ko jf kp jj kq jn kr jr ks jv kk kl km kn dt translated">启动作业</li></ul><p id="255b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:你可能注意到在上面的函数中使用了预置(<strong class="ja hv">1351620000001–300040</strong>)。它描述了如何编码给定的文件(在这个例子中是mp3)。可用预设的完整列表可在<a class="ae kc" href="http://docs.aws.amazon.com/elastictranscoder/latest/developerguide/system-presets.html" rel="noopener ugc nofollow" target="_blank"> AWS文档</a>中找到。</p><p id="a34b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">最后，将<strong class="ja hv">管道id </strong>设置为<strong class="ja hv">环境变量</strong>，并选择一个<strong class="ja hv"> IAM </strong>角色有权限访问<strong class="ja hv">弹性转码器</strong>:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/46e7fad762fdb8d1a01073eb138eb37d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*MG6bhbgitBxD98O-."/></div></figure><p id="2977" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">创建后，将视频文件上传到<em class="jw">输入</em>桶:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/2a287cb1824b4b91c4736f78c4f4aacf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*cZVPgEV5jWVbcGYA."/></div></figure><blockquote class="kt ku kv"><p id="bd91" class="iy iz jw ja b jb jc jd je jf jg jh ji kw jk jl jm kx jo jp jq ky js jt ju jv hn dt translated">AWS S3 CP way _ down _ we _ go . 3gp S3://slow coder-videos/inputs/</p></blockquote><p id="30e6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果一切顺利，您应该在您的<em class="jw">输出</em>桶中看到该文件:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/1578c92f2c42bd292a94eb96c9563e7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*szBAWxeFwuIHfB7J."/></div></figure><p id="53f7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> S3 </strong>将触发我们的<strong class="ja hv">λ</strong>功能。然后它将执行我们的功能。并将<strong class="ja hv"> S3 </strong>对象名记录到<strong class="ja hv"> CloudWatch日志</strong>:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/67614ec0730c0f56ff7a24e73aa33314.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*k59eZgKAilbLeLe9."/></div></figure><p id="9d4f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">几秒钟后(或几分钟，取决于视频的大小)，您应该会看到一个新的<strong class="ja hv"> MP3 </strong>文件已经由<strong class="ja hv">弹性转码器作业</strong>在<em class="jw">输出</em>目录中的<strong class="ja hv"> S3桶</strong>中生成:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/4e2b0c950f16805c81a5a36ee555a00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*bcXGrg-PlT-LVsVM."/></div></figure></div></div>    
</body>
</html>