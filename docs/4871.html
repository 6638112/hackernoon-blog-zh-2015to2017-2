<html>
<head>
<title>How to Build a Real Estate Website Using Ember.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Ember.js搭建一个房产网站</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-a-real-estate-website-using-ember-js-ef4ed7ae3806?source=collection_archive---------11-----------------------#2017-06-27">https://medium.com/hackernoon/how-to-build-a-real-estate-website-using-ember-js-ef4ed7ae3806?source=collection_archive---------11-----------------------#2017-06-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/7701f317276c69a43f589d84532913c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9zfyLUO-CNEAHmwW.jpg"/></div></div></figure><p id="50b6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">今天的互联网很复杂。战争是从React状态管理开始的，新语言的编写只是为了让Angular愉快地工作，而不是从所有对Node的憎恨开始。</p><p id="3cd6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在围绕新技术的狂热中，简单被遗忘了。像<a class="ae ka" href="https://cosmicjs.com" rel="noopener ugc nofollow" target="_blank"> Cosmic JS </a>这样的服务挑战了这一点。因此，本着反其道而行之的精神，我们将构建一个易于使用的时尚的房地产列表应用程序(带有社交风格)。</p><h1 id="fa95" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">TL；速度三角形定位法(dead reckoning)</h1><p id="657b" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><a class="ae ka" href="https://cosmicjs.com/apps/real-estate-website" rel="noopener ugc nofollow" target="_blank">查看演示</a> <br/> <a class="ae ka" href="https://github.com/cosmicjs/ember-real-estate-website" rel="noopener ugc nofollow" target="_blank">查看GitHub上的完整代码库</a></p><h1 id="b308" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">入门指南</h1><p id="c508" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们将使用Cosmic JS来管理我们所有的内容和部署网站。我们将在Ember.js中构建前端。</p><p id="42e1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们用Ember是因为它固执己见。我们的应用不会对任何现代设备上的性能问题敏感，所以我们可以利用符合我们设计理念的高层次抽象。</p><h1 id="1ef7" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">设置应用程序</h1><p id="fc85" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">假设您已经安装了Node，打开终端并运行每个步骤中的命令。</p><p id="5e7b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">0.设置快速服务器</p><ul class=""><li id="bfb6" class="le lf hu je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">创建一个新目录CosmicRealEstate作为项目的根目录。</li><li id="ddbb" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">在CosmicRealEstate中，将目录设为app(用于存储路由器)和public(用于存储<a class="ae ka" href="https://cosmicjs.com/blog/Ember.js" rel="noopener ugc nofollow" target="_blank"> Ember.js </a>版本)。</li><li id="78d1" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">在CosmicRealEstate下创建文件<a class="ae ka" href="https://cosmicjs.com/blog/server.js" rel="noopener ugc nofollow" target="_blank"> server.js </a>，内容如下:</li></ul><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="23ec" class="mb kc hu lx b fv mc md l me mf">var express = require('express');<br/>var app = express();<br/>var port = process.env.PORT || 3000;</span><span id="60f9" class="mb kc hu lx b fv mg md l me mf">app.use(express.static(__dirname + '/public'));</span><span id="fb99" class="mb kc hu lx b fv mg md l me mf">require('./app/routes')(app);</span><span id="847e" class="mb kc hu lx b fv mg md l me mf">app.listen(port);</span><span id="9f72" class="mb kc hu lx b fv mg md l me mf">exports = module.exports = app;</span></pre><ul class=""><li id="d833" class="le lf hu je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">在app目录中创建<a class="ae ka" href="https://cosmicjs.com/blog/routes.js" rel="noopener ugc nofollow" target="_blank"> routes.js </a>并添加以下代码:</li></ul><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="aa2c" class="mb kc hu lx b fv mc md l me mf">module.exports = function(app) {<br/>       app.get('*', function(req, res) {<br/>           res.sendfile('./public/index.html'); // load our public/index.html file<br/>       });<br/>};</span></pre><ul class=""><li id="9423" class="le lf hu je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">在终端的CosmicRealEstate中，运行:</li></ul><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="5dd4" class="mb kc hu lx b fv mc md l me mf">npm init<br/>npm install express --save</span></pre><p id="2659" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你知道有一个简单的快速应用程序设置，这将让我们在宇宙部署应用程序。稍后，我们将把Ember应用程序构建到公共目录中。在CosmicRealEstate中运行以下命令:</p><p id="fd15" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.安装Ember的命令行界面</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="f1cc" class="mb kc hu lx b fv mc md l me mf">npm install -g ember-cli<br/>npm install -g phantomjs</span></pre><p id="d5cc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">(Ember使用Phantonjs进行测试)</p><p id="d356" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.生成Ember项目结构</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="3e33" class="mb kc hu lx b fv mc md l me mf">ember new cosmic-real-estate &amp;&amp; cd cosmic-real-estate</span></pre><p id="2182" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.安装引导程序</p><p id="890d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从comsic-real-estate目录中，安装Ember Bootstrap插件以自动将Bootstrap包含在您的构建路径中</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="6870" class="mb kc hu lx b fv mc md l me mf">ember install ember-bootstrap</span></pre><p id="1da3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">5.启动您的开发服务器</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="1389" class="mb kc hu lx b fv mc md l me mf">ember serve</span></pre><p id="8cf9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">打开你的浏览器，你会在localhost:4200看到Ember欢迎页面。</p><h1 id="d7ba" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">建立你的物品路线</h1><p id="a849" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">现在您已经有了应用程序的样板代码，让我们开始构建一个页面来显示我们的Cosmic JS bucket中的所有列表。</p><p id="0ab0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">0.去掉欢迎代码</p><p id="2c8a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们感谢Ember的热情欢迎，但我们需要去工作了。继续从您的应用程序的主手柄模板中删除以下代码。</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="d66b" class="mb kc hu lx b fv mc md l me mf">{{!-- app/templates/application.hbs --}}</span><span id="7b5b" class="mb kc hu lx b fv mg md l me mf">{{!-- The following component displays Ember's default welcome message. --}}<br/>{{welcome-page}}<br/>{{!-- Feel free to remove this! --}}</span></pre><p id="0a75" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在剩余的{{outlet}}(这是您的路线将呈现的位置)周围添加一个容器。您的应用程序模板现在将如下所示:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="1c6f" class="mb kc hu lx b fv mc md l me mf">{{!-- app/templates/application.hbs --}}</span><span id="32fc" class="mb kc hu lx b fv mg md l me mf">&lt;div class="container" style="margin-top:20px"&gt;<br/>    {{outlet}}<br/>&lt;/div&gt;</span></pre><p id="718e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.生成列表路线，并给你的模板一个欢迎垫</p><p id="182a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在cosmic-real-estate目录中，运行:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="b438" class="mb kc hu lx b fv mc md l me mf">ember g route listings</span></pre><p id="ca1f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，在新创建的列表模板中，添加以下HTML:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="0ccf" class="mb kc hu lx b fv mc md l me mf">&lt;div class="jumbotron" style="margin-top: 20px"&gt;<br/>  &lt;h1&gt;Welcome to Cosmic Real Estate!&lt;/h1&gt;<br/>  &lt;p&gt;<br/>    Check out our awesome real estate listings -<br/>    stored and managed with Cosmic JS and<br/>    rendered right in your browser.<br/>  &lt;/p&gt;<br/>&lt;/div&gt;</span></pre><p id="a1de" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你去localhost:4200/listings，你会看到我们的列表页面的开始。</p><p id="c702" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.生成一个索引路径，使您的列表显示在根URL上</p><p id="c3be" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们希望将根域转发到我们的列表页面，所以首先运行:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="7335" class="mb kc hu lx b fv mc md l me mf">ember g route index</span></pre><p id="fab7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，打开索引的路由处理程序，并将以下代码添加到路由的导出中:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="c97f" class="mb kc hu lx b fv mc md l me mf">// app/routes/index.js</span><span id="032b" class="mb kc hu lx b fv mg md l me mf">export default Ember.Route.extend({<br/>  beforeModel() {<br/>    this.replaceWith('listings');<br/>  }<br/>});</span></pre><p id="ac0f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Ember在渲染路线时使用一系列生命周期挂钩进行验证。调用beforeModel()利用这些钩子中的第一个来告诉路由处理器立即将我们带到清单路由。访问localhost:4200将把我们带到localhost:4200/listings。</p><h1 id="8bae" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">从Cosmic JS中检索数据</h1><p id="194d" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们希望向用户展示我们存储在Cosmic JS中的列表。为此，我们将使用Ember的内置数据存储Ember Data从Cosmic JS中检索列表，并存储在相应的模型中。</p><p id="3b2d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">0.从现在开始设置你的桶，我们假设你已经创建了一个宇宙JS桶。(本指南的水桶鼻涕虫将是宇宙-房地产。)稍后您将在您的ENV变量中设置。在cosmic-real-estate桶中是具有以下结构的“列表”类型的对象:</p><h2 id="5b40" class="mb kc hu bd kd mh mi mj kh mk ml mm kl jn mn mo kp jr mp mq kt jv mr ms kx mt dt translated">列表:</h2><p id="b9bc" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">宇宙JS元域<br/>类型<br/>价格<br/>文本输入<br/>地址<br/>文本输入<br/>个人资料图片<br/>图片<br/>风格<br/>单选<br/>街坊<br/>文本输入<br/>床位<br/>文本输入<br/>浴场<br/>文本输入<br/>平方英尺<br/>文本输入<br/>邮政编码<br/>文本输入</p><p id="78a7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正如本指南开头所强调的，Ember是约定胜于配置。Ember Data处理所有你不想做的讨厌的AJAX和缓存工作。我们所要做的就是告诉Ember在哪里寻找我们的数据，如何解释它，以及它如何适合我们的模型。</p><p id="7bf5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.创建列表模型</p><p id="a6b5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">与任何其他web应用程序框架一样，Ember中的模型只是充当后端数据的容器。我们将使用一个列表模型来匹配我们的Cosmic JS桶中的列表对象。运行:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="37ee" class="mb kc hu lx b fv mc md l me mf">ember g model Listing</span></pre><p id="3f7a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在新创建的清单文件中，添加以下代码:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="9a7b" class="mb kc hu lx b fv mc md l me mf">// app/models/listing.js</span><span id="282c" class="mb kc hu lx b fv mg md l me mf">export default DS.Model.extend({<br/>  title: DS.attr(),<br/>  price: DS.attr(),<br/>  address: DS.attr(),<br/>  profileImage: DS.attr(),<br/>  style: DS.attr(),<br/>  neighborhood: DS.attr(),<br/>  beds: DS.attr(),<br/>  baths: DS.attr(),<br/>  squareFeet: DS.attr(),<br/>  zipCode: DS.attr()<br/>});</span></pre><p id="1c1f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们现在已经指定了一个列表将具有哪些属性，也就是说，当从我们的桶中抓取数据时要查找哪些属性。</p><p id="46a8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.创建列表适配器和序列化程序</p><p id="dfc1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Cosmic JS运行在一个直观的REST API上，所以我们将利用Ember Data内置的REST适配器和JSON序列化器。我们只需要做一些细微的调整来适应宇宙API规范。要生成列表适配器，请运行:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="df58" class="mb kc hu lx b fv mc md l me mf">ember g adapter listing</span></pre><p id="4170" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要生成序列化程序，请执行以下操作:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="8fed" class="mb kc hu lx b fv mc md l me mf">ember g serializer listing</span></pre><p id="8080" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Ember现在将自动使用清单序列化程序和adaptaer来处理清单模型。</p><p id="6608" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.调整列表适配器</p><p id="91a4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">默认情况下，Ember的REST适配器指向的端点与我们从桶中获取数据所需的端点略有不同。因此，将下面的代码添加到清单适配器中，确保您换出了DS。JSONAPIAdapter for DS。重新适配:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="0935" class="mb kc hu lx b fv mc md l me mf">// app/adapters/listing.js</span><span id="8dad" class="mb kc hu lx b fv mg md l me mf">export default DS.RESTAdapter.extend({<br/>  host: 'https://api.cosmicjs.com/v1/cosmic-real-estate',<br/>  urlForFindAll(modelName, snapshot) {<br/>    let path = this.pathForType(modelName);<br/>    return this.buildURL() + '/object-type/' + path;<br/>  },<br/>  urlForQueryRecord(slug) {<br/>    return this.buildURL() + '/object/' + slug;<br/>  }<br/>});</span></pre><p id="5b96" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这样做的效果是，每次我们在数据存储中查询清单时，我们告诉Ember从响应中获取清单，这些响应位于<a class="ae ka" href="https://api.cosmicjs.com/v1/cosmic-real-esate/object-type/listing" rel="noopener ugc nofollow" target="_blank">https://API . cosmicjs . com/v1/cosmic-real-esate/object-type/listing</a>或<a class="ae ka" href="https://api.cosmicjs.com/v1/cosmic-real-esate/object/listing-slug," rel="noopener ugc nofollow" target="_blank">https://API . cosmicjs . com/v1/cosmic-real-esate \ object \ listing-slug，</a>，这取决于我们是检索单个清单还是多个清单。</p><p id="c4a2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.调整列表序列化程序</p><p id="5dca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Cosmic JS给我们的数据格式与Ember的REST Serializer所期望的略有不同。例如，宇宙返回这个</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="7f42" class="mb kc hu lx b fv mc md l me mf">{<br/>  "objects": [<br/>    {<br/>      "_id": "59403aefacfbc8d252000563",<br/>      "slug": "example-condo",<br/>      "title": "Example Condo",<br/>      "content": "",<br/>      "bucket": "593f696bacfbc8d2520000df",<br/>      "type_slug": "listings",<br/>      "created_at": "2017-06-13T19:20:15.485Z",<br/>      "created_by": "593f691ea768e28650000334",<br/>      "created": "2017-06-13T19:20:15.485Z",<br/>      "status": "published",<br/>      "metadata": {<br/>        "price": 545000,<br/>        "address": "2100 High Avenue",<br/>        "profile": {<br/>          "url": "https://cosmicjs.com/uploads/4ff36ce0-506d-11e7-9f7d-dbfbf1c66da0-ex-condo.jpeg",<br/>          "imgix_url": "https://cosmicjs.imgix.net/4ff36ce0-506d-11e7-9f7d-dbfbf1c66da0-ex-condo.jpeg"<br/>        },<br/>        "style": "Condo",<br/>        "location": "Uptown"<br/>      }, <br/>      // etc...</span></pre><p id="48c7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Ember期望:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="d2dd" class="mb kc hu lx b fv mc md l me mf">{<br/>    "listings": [<br/>        {<br/>            "id": 1,<br/>            "title": "example-condo",<br/>            "price": 54000,<br/>            // etc...</span></pre><p id="7fc8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里的两个主要差异是对象与我们的模型名不匹配，并且我们需要的大多数主要属性都存储在元数据中。要解决这个问题，请将以下代码添加到清单序列化程序中，确保交换DS。DS.RESTSerializer的JSONAPISerializer。</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="638b" class="mb kc hu lx b fv mc md l me mf">// app/serializers/listing.js</span><span id="8340" class="mb kc hu lx b fv mg md l me mf">import DS from 'ember-data';</span><span id="f092" class="mb kc hu lx b fv mg md l me mf">function buildNormalizeListing(source) {<br/>  return {<br/>    id: source._id,<br/>    slug: source.slug,<br/>    content: source.content,<br/>    title: source.title,<br/>    price: source.metadata.price,<br/>    address: source.metadata.address,<br/>    profileImage: source.metadata.profile.url,<br/>    style: source.metadata.style,<br/>    neighborhood: source.metadata.neighborhood,<br/>    beds: source.metadata.beds,<br/>    baths: source.metadata.baths,<br/>    squareFeet: source.metadata.square_feet,<br/>    zipCode: source.metadata.zip_code</span><span id="1eae" class="mb kc hu lx b fv mg md l me mf">  }<br/>}</span><span id="f9c0" class="mb kc hu lx b fv mg md l me mf">export default DS.RESTSerializer.extend({<br/>  normalizeResponse(store, primaryModelClass, payload, id, requestType) {<br/>    if (payload.objects) {<br/>      let normalizedListings = payload.objects.map(function(listing) {<br/>        return buildNormalizeListing(listing)<br/>      });<br/>      payload = {<br/>        listings: normalizedListings<br/>      };<br/>    } else {<br/>      let normalizedListing = buildNormalizeListing(payload.object);<br/>      payload = {<br/>        listing: normalizedListing<br/>      }<br/>    }<br/>    return this._super(store, primaryModelClass, payload, id, requestType);</span><span id="c6be" class="mb kc hu lx b fv mg md l me mf">  }<br/>});</span></pre><p id="4520" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于由Cosmic JS返回的objects数组中的每个列表，我们创建一个新对象，只包含我们想要的属性，并将这些属性映射到一个新数组。然后，我们创建一个新的散列，用Ember正在寻找的列表键来指向我们的有效负载引用。通过调用_super将它们打包在一起，我们的应用程序就可以和Cosmic JS做生意了。(检索单个列表的过程类似，所以我们将其抽象为buildNormalizedListing())</p><h1 id="8d3b" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">显示列表</h1><p id="f1bb" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们希望我们的用户能够查看单个列表，以获得关于它们的更详细的信息。为此，我们需要利用Ember的嵌套路由。</p><p id="b12e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.在列表下生成索引路径</p><p id="bd17" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">列表/索引路径将取代我们原来的列表路径。运行:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="96ca" class="mb kc hu lx b fv mc md l me mf">ember g route listings/index</span></pre><p id="fdb3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.移动列表模板代码和路线代码</p><p id="bd3b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将以下代码片段从app/templates/listings.hbs移动到app/templates/listings/index . HBS</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="8261" class="mb kc hu lx b fv mc md l me mf">{{!-- app/templates/listings.hbs --}}</span><span id="5c53" class="mb kc hu lx b fv mg md l me mf">&lt;div class="row"&gt;<br/>  {{#each model as |currentListing|}}<br/>    &lt;div class="col-sm-4" &gt;<br/>       {{real-estate-listing listing=currentListing}}<br/>    &lt;/div&gt;<br/>  {{/each}}<br/>&lt;/div&gt;</span></pre><p id="6b1c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在列表模板中删除最后一点的地方，添加{{outlet}}。也就是说，<a class="ae ka" href="https://cosmicjs.com/blog/listings.hbs" rel="noopener ugc nofollow" target="_blank"> listings.hbs </a>现在看起来是这样的:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="42b6" class="mb kc hu lx b fv mc md l me mf">{{!-- app/templates/listings.hbs --}}</span><span id="551a" class="mb kc hu lx b fv mg md l me mf">&lt;div class="container"&gt;<br/>  &lt;div class="row"&gt;<br/>    &lt;div class="col-md-12"&gt;<br/>      &lt;div class="jumbotron" style="margin-top: 20px"&gt;<br/>        &lt;h1&gt;Welcome to Cosmic Real Estate!&lt;/h1&gt;<br/>        &lt;p&gt;<br/>          Check out our awesome real estate listings -<br/>          stored and managed with Cosmic JS and<br/>          rendered right in your browser.<br/>        &lt;/p&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/div&gt;</span><span id="e804" class="mb kc hu lx b fv mg md l me mf">&lt;div class="container"&gt;<br/>  {{outlet}}<br/>&lt;/div&gt;</span></pre><p id="f45e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">{{outlet}}帮助器只是指定子路由在模板中的呈现位置。</p><p id="3e7b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，通过将以下代码片段从app/routes/listings.js移动到app/routes/listings/index.js，使呈现所有列表成为特定于索引路由的行为。</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="bcb3" class="mb kc hu lx b fv mc md l me mf">model() {<br/>    return this.get('store').findAll('listing');<br/>  }</span></pre><p id="380d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.为个别物品建立刊登路线</p><p id="f72f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，运行:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="6001" class="mb kc hu lx b fv mc md l me mf">ember g route listings/listing</span></pre><p id="3dc7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当我们打开一个单独的列表时，我们希望它在url中得到反映，所以将下面的代码添加到路由器中，以在URL的末尾显示列表id。</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="8f6b" class="mb kc hu lx b fv mc md l me mf">// app/router.js</span><span id="97a5" class="mb kc hu lx b fv mg md l me mf">Router.map(function() {<br/>  this.route('listings', function() {<br/>    this.route('listing', { path: '/:listing_id'});<br/>  });<br/>});</span></pre><p id="6228" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.准备列表模板以显示数据</p><p id="98ea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在我们让用户签出清单之前，我们需要给他们一些可以看的东西。将以下HTML添加到列出的子路由中:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="ce79" class="mb kc hu lx b fv mc md l me mf">&lt;div class="row"&gt;<br/>  &lt;div class="col-sm-12"&gt;<br/>    &lt;ul class="nav nav-pills"&gt;<br/>      &lt;li role="presentation"&gt;&lt;a href="#description"&gt;Description&lt;/a&gt;&lt;/li&gt;<br/>      &lt;li role="presentation"&gt;&lt;a href="#stats"&gt;Stats&lt;/a&gt;&lt;/li&gt;<br/>      &lt;li role="presentation"&gt;{{#link-to 'listings'}}Return to Listings{{/link-to}}&lt;/li&gt;<br/>    &lt;/ul&gt;<br/>  &lt;/div&gt;<br/>  &lt;div class="col-sm-9"&gt;<br/>    &lt;div class="page-header"&gt;<br/>      &lt;h1&gt;<br/>        {{model.title}}<br/>      &lt;/h1&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>  &lt;div class="col-sm-3"&gt;<br/>      &lt;h1&gt;<br/>        &lt;span class="text-success"&gt;{{format-price model.price}}&lt;/span&gt;<br/>      &lt;/h1&gt;</span><span id="826c" class="mb kc hu lx b fv mg md l me mf">  &lt;/div&gt;<br/>&lt;/div&gt;<br/>&lt;div class="row"&gt;<br/>  &lt;div class="col-md-6"&gt;<br/>    &lt;img src={{model.profileImage}} class="img-responsive" /&gt;<br/>  &lt;/div&gt;<br/>  &lt;div class="col-md-6"&gt;<br/>      &lt;ul class="list-group"&gt;<br/>      &lt;li class="list-group-item"&gt;&lt;strong&gt;Address:&lt;/strong&gt;&lt;span class="pull-right"&gt;{{model.address}}&lt;/span&gt;&lt;/li&gt;<br/>      &lt;li class="list-group-item"&gt;&lt;strong&gt;Style:&lt;/strong&gt;&lt;span class="pull-right"&gt;{{model.style}}&lt;/span&gt;&lt;/li&gt;<br/>      &lt;li class="list-group-item"&gt;&lt;strong&gt;Neighborhood:&lt;/strong&gt;&lt;span class="pull-right"&gt;{{model.neighborhood}}&lt;/span&gt;&lt;/li&gt;<br/>      &lt;li class="list-group-item"&gt;&lt;strong&gt;Beds:&lt;/strong&gt;&lt;span class="pull-right"&gt;{{model.beds}}&lt;/span&gt;&lt;/li&gt;<br/>      &lt;li class="list-group-item"&gt;&lt;strong&gt;Baths:&lt;/strong&gt;&lt;span class="pull-right"&gt;{{model.baths}}&lt;/span&gt;&lt;/li&gt;<br/>      &lt;li class="list-group-item"&gt;&lt;strong&gt;Square Feet:&lt;/strong&gt;&lt;span class="pull-right"&gt;{{model.squareFeet}}&lt;/span&gt;&lt;/li&gt;<br/>      &lt;/ul&gt;<br/>  &lt;/div&gt;<br/></span><span id="c3ef" class="mb kc hu lx b fv mg md l me mf">  &lt;div class="col-sm-6"&gt;<br/>    &lt;h3 id="description"&gt;Description&lt;/h3&gt;<br/>    &lt;span class="text-muted"&gt;{{{model.content}}}&lt;/span&gt;<br/>  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="452f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请注意我们正在使用的三个新的手柄特性:在{{{model.content}}}中使用三重括号强制手柄不要在内容字段中对HTML进行转义。菜单中的{ { # link-to } }帮助器会自动为我们生成一个正确的链接，链接到我们指定的路线。我们将在下一步中使用它来实际动态链接到清单。*我们接下来将制作的{{format-price}}助手。</p><p id="575a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">5.生成一个助手来格式化价格</p><p id="7a10" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在Ember中，我们可以选择生成自定义助手。我们这样做是为了以货币形式显示列表的价格。运行:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="3fb2" class="mb kc hu lx b fv mc md l me mf">ember g helper filter-price</span></pre><p id="a504" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，在新格式的价格帮助器中，添加以下代码:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="d41d" class="mb kc hu lx b fv mc md l me mf">// app/helpers/format-price.js</span><span id="c162" class="mb kc hu lx b fv mg md l me mf">export function formatPrice(value) {<br/>  return '$' + value.toLocaleString();<br/>}</span></pre><p id="6075" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">6.链接到列表</p><p id="ff51" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们需要从列表的slug中动态生成一个到列表的特定页面的链接。我们可以使用上一步中使用的{{#link-to}}}助手轻松地完成这项工作。</p><p id="338b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在房地产列表组件中，将{{listing.title}}包装在{{#link-to}}中，如下所示:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="5e00" class="mb kc hu lx b fv mc md l me mf">{{!-- app/templates/components/real-estate-listing.hbs --}</span><span id="42cb" class="mb kc hu lx b fv mg md l me mf">{{#link-to 'listings.listing' listing}}{{listing.title}}{{/link-to}}</span></pre><p id="022a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将模型作为第二个参数传递，Ember自动负责匹配路线。然而，你可能会注意到，我们的链接现在指向一些无意义的字符串，Ember将这些字符串用作列表的唯一ID。作为一个简单的解决方案，进入您的列表序列化程序，添加以下代码行来告诉Ember使用列表slug作为它的主键:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="7502" class="mb kc hu lx b fv mc md l me mf">// app/serializers/listing.js</span><span id="d747" class="mb kc hu lx b fv mg md l me mf">export default DS.RESTSerializer.extend({<br/>  primaryKey: 'slug',<br/>  normalizeResponse(store, primaryModelClass,<br/>  // etc...</span></pre><p id="ca4a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们现在有了单独的路线列表和链接，正如我们所期望的那样。</p><h1 id="79f7" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">让它社交化</h1><p id="8fc5" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">在这一点上，我们有自己的一个功能正常的房地产上市应用程序。但是，我们不会以一些无聊的东西结束，我们会增加一点趣味。我们希望我们的用户能够(在这种情况下匿名)对我们的清单投票。宇宙JS将帮助我们管理这一点。</p><p id="314e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.更新Cosmic JS bucket中的列表对象、模型和序列化程序，将缺省值为0的元字段upvotes添加到列表对象中。相应地更新列表模型:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="5ba0" class="mb kc hu lx b fv mc md l me mf">// app/models/listing.js</span><span id="1ca1" class="mb kc hu lx b fv mg md l me mf">//etc...<br/>  zipCode: DS.attr(),<br/>  content: DS.attr(),<br/>  upvotes: DS.attr()<br/>});</span></pre><ul class=""><li id="4cc2" class="le lf hu je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">更新列表序列化程序中的buildNormalizedListing()</li></ul><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="2301" class="mb kc hu lx b fv mc md l me mf">// app/serializers/listing.js</span><span id="26c9" class="mb kc hu lx b fv mg md l me mf">function buildNormalizeListing(source) {<br/>  return {<br/>    //etc...<br/>    zipCode: source.metadata.zip_code,<br/>    upvotes: source.metadata.upvotes<br/>  }<br/>}</span></pre><p id="7971" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.更新房地产列表组件</p><p id="3ea8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">添加了一个向上投票按钮、一个向下投票按钮和一个投票计数器后，您的房地产列表模板将如下所示:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="ce54" class="mb kc hu lx b fv mc md l me mf">{{!-- app/templates/components/real-estate-listing.hbs --}}</span><span id="0c3d" class="mb kc hu lx b fv mg md l me mf">&lt;div class="panel panel-default"&gt;<br/>  &lt;div class="panel-heading"&gt;<br/>    &lt;h4&gt;<br/>      {{#link-to 'listings.listing' listing}}{{listing.title}}{{/link-to}}<br/>      &lt;span class="pull-right"&gt;<br/>        {{upvotes}}<br/>      &lt;/span&gt;<br/>    &lt;/h4&gt;<br/>  &lt;/div&gt;<br/>  &lt;div class="panel-body"&gt;<br/>    &lt;p&gt;<br/>      &lt;img src="{{listing.profileImage}}" class="img-thumbnail" style="background-color: #fff;height:auto"/&gt;</span><span id="1f10" class="mb kc hu lx b fv mg md l me mf">    &lt;/p&gt;<br/>    &lt;p&gt;<br/>      &lt;strong&gt;Address:&lt;/strong&gt; {{listing.address}}<br/>    &lt;/p&gt;<br/>    &lt;p&gt;<br/>      &lt;strong&gt;Style:&lt;/strong&gt; {{listing.style}}<br/>    &lt;/p&gt;<br/>    &lt;p&gt;<br/>      &lt;strong&gt;Neighborhood:&lt;/strong&gt; {{listing.neighborhood}}<br/>    &lt;/p&gt;<br/>  &lt;/div&gt;<br/>  &lt;div class="panel-footer"&gt;<br/>    &lt;p class="pull-left"&gt;<br/>      &lt;button {{action "vote" "down"}} class="btn btn-default"&gt;&lt;span class="glyphicon glyphicon-thumbs-down"&gt;&lt;/span&gt;&lt;/button&gt;<br/>      &lt;button {{action "vote" "up"}} class="btn btn-default"&gt;&lt;span class="glyphicon glyphicon-thumbs-up"&gt;&lt;/span&gt;&lt;/button&gt;<br/>    &lt;/p&gt;<br/>    &lt;p class="text-right"&gt;<br/>       &lt;h4&gt;{{format-price listing.price}}&lt;/h4&gt;<br/>    &lt;/p&gt;<br/>  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="8549" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">值得注意的是，我们添加了一个拇指向上和拇指向下按钮，利用Ember的动作助手来处理点击。我们通过“vote”来指定要调用的动作，通过“up”或“down”来指示投票的方向。为了让按钮工作，我们需要在房地产列表控制器中实现vote()动作。</p><p id="4a3d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.实施投票操作</p><p id="b7de" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了处理投票操作，我们首先来看一下房地产列表组件的控制器。</p><p id="608a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这个过程中，我们的第一步是让控制器访问列表的slug和upvotes。我们通过计算属性来实现这一点，如下所示:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="b23c" class="mb kc hu lx b fv mc md l me mf">// app/components/real-estate-listing.js</span><span id="60d0" class="mb kc hu lx b fv mg md l me mf">export default Ember.Component.extend({<br/>  slug: Ember.computed('slug', function() {<br/>    return this.get('listing.id');<br/>  }), //etc...</span></pre><p id="f76b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">注意，我们使用<a class="ae ka" href="https://cosmicjs.com/blog/listing.id" rel="noopener ugc nofollow" target="_blank"> listing.id </a>来检索slug，因为我们已经将slug定义为模型的主键。</p><p id="9112" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">其次，我们添加属性store: Ember.inject.service()来访问组件中的数据存储。</p><p id="d5ca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，我们在操作散列中定义了vote()操作:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="3fb0" class="mb kc hu lx b fv mc md l me mf">// app/componenets/real-estate-listing.js</span><span id="630f" class="mb kc hu lx b fv mg md l me mf">actions: {<br/>    vote(direction) {<br/>      let upvotes = this.get('upvotes');<br/>      direction === 'up' ?<br/>        upvotes++ :<br/>        upvotes--;<br/>      this.set('upvotes', upvotes);<br/>      let slug = this.get('slug');<br/>      let store = this.get('store');<br/>      updateVote(upvotes,slug,store);<br/>    }<br/>}</span></pre><p id="0904" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">(updateVote()在导出之上实现)</p><p id="d3c1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">综上所述，您的房地产列表组件将如下所示:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="65da" class="mb kc hu lx b fv mc md l me mf">import Ember from 'ember';</span><span id="97f1" class="mb kc hu lx b fv mg md l me mf">function updateVote(upvotes,listing_slug,store) {<br/>  store.findRecord('listing', listing_slug).then(function(listing) {<br/>    listing.set('upvotes',upvotes);<br/>    listing.save();<br/>  })<br/>}</span><span id="a15f" class="mb kc hu lx b fv mg md l me mf">export default Ember.Component.extend({<br/>  store: Ember.inject.service(),<br/>  upvotes: Ember.computed('upvotes', function() {<br/>    return this.get('listing.upvotes');<br/>  }),<br/>  slug: Ember.computed('slug', function() {<br/>    return this.get('listing.id');<br/>  }),<br/>  actions: {<br/>    vote(direction) {<br/>      let upvotes = this.get('upvotes');<br/>      direction === 'up' ?<br/>        upvotes++ :<br/>        upvotes--;<br/>      this.set('upvotes', upvotes);<br/>      let slug = this.get('slug');<br/>      let store = this.get('store');<br/>      updateVote(upvotes,slug,store);<br/>    }<br/>  }<br/>});</span></pre><p id="0a4b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">按钮现在增加/减少投票计数，但是如果你刷新页面，你会注意到变化没有持续。如果你检查一下控制台，你就会知道为什么。</p><p id="6cf2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们需要修改我们的老朋友适配器和序列化器来处理我们的更新请求。</p><p id="4ec5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.(再次)调整序列化程序</p><p id="42bb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">复制以下代码以覆盖serialize()方法:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="d8c9" class="mb kc hu lx b fv mc md l me mf">// app/serializers/listing.js</span><span id="ef3d" class="mb kc hu lx b fv mg md l me mf">export default DS.RESTSerializer.extend({<br/>  primaryKey: 'slug',<br/>  normalizeResponse(store, primaryModelClass, payload, id, requestType) {<br/>    // etc...<br/>  },<br/>  serialize(snapshot, options) {<br/>    var json = this._super(...arguments);<br/>    let payload = {<br/>      "slug": snapshot.id,<br/>      "metafields": [<br/>        {<br/>            "required": true,<br/>            "value": json.price,<br/>            "key": "price",<br/>            "title": "Price",<br/>            "type": "text",<br/>            "children": null<br/>        },<br/>        {<br/>            "required": true,<br/>            "value": json.address,<br/>            "key": "address",<br/>            "title": "Address",<br/>            "type": "text",<br/>            "children": null<br/>        },<br/>        {<br/>            "value": json.profileImage.split('/').slice(-1)[0],<br/>            "key": "profile",<br/>            "title": "Profile",<br/>            "type": "file",<br/>            "children": null,<br/>            "url": json.profileImage,<br/>            "imgix_url": "https://cosmicjs.imgix.net/" + json.profileImage.split('/').slice(-1)[0];<br/>        },<br/>        {<br/>            "required": true,<br/>            "options": [<br/>                {<br/>                    "value": "House"<br/>                },<br/>                {<br/>                    "value": "Apartment"<br/>                },<br/>                {<br/>                    "value": "Condo"<br/>                }<br/>            ],<br/>            "value": json.style,<br/>            "key": "style",<br/>            "title": "Style",<br/>            "type": "radio-buttons",<br/>            "children": null<br/>        },<br/>        {<br/>            "value": json.beds,<br/>            "key": "beds",<br/>            "title": "Beds",<br/>            "type": "text",<br/>            "children": null<br/>        },<br/>        {<br/>            "value": json.baths,<br/>            "key": "baths",<br/>            "title": "Baths",<br/>            "type": "text",<br/>            "children": null<br/>        },<br/>        {<br/>            "value": json.squareFeet,<br/>            "key": "square_feet",<br/>            "title": "Square Feet",<br/>            "type": "text",<br/>            "children": null<br/>        },<br/>        {<br/>            "required": true,<br/>            "value": json.neighborhood,<br/>            "key": "neighborhood",<br/>            "title": "Neighborhood",<br/>            "type": "text",<br/>            "children": null<br/>        },<br/>        {<br/>            "required": true,<br/>            "value": json.zipcode,<br/>            "key": "zipcode",<br/>            "title": "zipcode",<br/>            "type": "text",<br/>            "children": null<br/>        },<br/>        {<br/>            "value": json.upvotes,<br/>            "key": "upvotes",<br/>            "title": "Upvotes",<br/>            "type": "text",<br/>            "children": null<br/>        }<br/>    ]<br/>    }<br/>    return payload;<br/>  }<br/>});</span></pre><p id="7418" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">5.再次调整适配器</p><p id="d9b3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在适配器的导出中，我们需要覆盖urlForUpdateRecord()和UpdateRecord()。一旦我们这样做了，我们就有:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="d988" class="mb kc hu lx b fv mc md l me mf">// app/adapters/listing.js</span><span id="a168" class="mb kc hu lx b fv mg md l me mf">import DS from 'ember-data';</span><span id="70bb" class="mb kc hu lx b fv mg md l me mf">export default DS.RESTAdapter.extend({<br/>  host: 'https://api.cosmicjs.com/v1/cosmic-real-estate',<br/>  urlForFindAll(modelName, snapshot) {<br/>    let path = this.pathForType(modelName);<br/>    return this.buildURL() + '/object-type/' + path;<br/>  },<br/>  urlForFindRecord(slug) {<br/>    return this.buildURL() + '/object/' + slug;<br/>  },<br/>  urlForUpdateRecord() {<br/>    return this.buildURL() + '/edit-object';<br/>  },<br/>  updateRecord: function(store, type, snapshot) {<br/>    var data = {};<br/>    var serializer = store.serializerFor(type.modelName);</span><span id="70de" class="mb kc hu lx b fv mg md l me mf">    serializer.serializeIntoHash(data, type, snapshot);<br/>    data = data.listing;<br/>    var id = snapshot.id;<br/>    var url = this.buildURL(type.modelName, id, snapshot, 'updateRecord');</span><span id="85c3" class="mb kc hu lx b fv mg md l me mf">    return this.ajax(url, "PUT", { data: data });<br/>  }<br/>});</span></pre><h1 id="32a4" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">让一切看起来都很好</h1><p id="30d2" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">随着我们的投票功能的加入，我们将添加一些功能，以便在完成之前将应用程序整合在一起。</p><p id="fc73" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.对投票进行筛选</p><p id="f488" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正如我们对价格所做的一样，我们将制作一个过滤器来使投票看起来漂亮。运行:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="6dac" class="mb kc hu lx b fv mc md l me mf">ember g helper format-upvotes</span></pre><p id="5629" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，在新创建的Format Upvotes过滤器中，添加以下内容(替换默认参数):</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="6605" class="mb kc hu lx b fv mc md l me mf">// app/helpers/format-upvotes.js</span><span id="e003" class="mb kc hu lx b fv mg md l me mf">export function formatUpvotes(upvote) {<br/>  if (upvote &gt; 0) {<br/>    return '&lt;span class="text-success"&gt;' + upvote + '&lt;/span&gt;';<br/>  } else if (upvote &lt; 0) {<br/>    return '&lt;span class="text-danger"&gt;' + upvote + '&lt;/span&gt;';<br/>  } else {<br/>    return '&lt;span class="text-muted"&gt;' + upvote + '&lt;/span&gt;';<br/>  }<br/>}</span></pre><p id="2205" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">若要使其正常工作，请将房地产列表模板中的{{upvotes}}替换为{{{format-upvotes upvotes}}}。(记住，三重括号告诉车把不要对返回值进行转义。)</p><p id="6717" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.将向上投票计数添加到单个列表中</p><p id="5ce5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在个人列表模板中，其中{{model.title}}是，添加:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="ec9f" class="mb kc hu lx b fv mc md l me mf">{{!-- app/templates/listings/listing.hbs --}}</span><span id="1cf4" class="mb kc hu lx b fv mg md l me mf">&lt;div class="page-header"&gt;<br/>  &lt;h1&gt;<br/>    {{model.title}} &lt;small&gt;Upvotes: {{{format-upvotes model.upvotes}}}&lt;/small&gt;<br/>  &lt;/h1&gt;<br/>&lt;/div&gt;</span></pre><h1 id="7175" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">部署应用程序</h1><p id="63d3" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">0.拼凑一个端点来提供Express中的密钥</p><p id="7f7b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">假设您正在使用Cosmic JS来部署您的应用程序，您将通过Node的process.env自动访问bucket的slug、read key和write key。然而，由于我们已经完全隔离了我们的前端，并且仅使用Express来服务它，因此使这些env变量可访问并不是最简单的任务。</p><p id="675d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将通过Express服务器上的一个端点为他们提供服务。我们将在清单适配器中用一个简单的AJAX调用来检索它们，因为我们在其他地方不需要它们。(请注意，我们不会安全地这样做，但是添加身份验证不会有太多工作。)</p><p id="a4df" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在从CosmicRealEstate开始，我们将使用路由器来服务一个JSON对象，该对象包含我们在/api的键。</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="cf91" class="mb kc hu lx b fv mc md l me mf">// CosmicRealEstate/app/routes.js</span><span id="7097" class="mb kc hu lx b fv mg md l me mf">module.exports = function(app) {<br/>    app.get('/api', function(req,res){<br/>      return res.json({<br/>        bucket: process.env.COSMIC_BUCKET,<br/>        writeKey: process.env.COSMIC_WRITE_KEY,<br/>        readKey: process.env.COSMIC_READ_KEY<br/>      });<br/>    });<br/>    app.get('*', function(req, res) {<br/>      var path = require('path');<br/>      res.sendFile(path.join(__dirname, '../public', 'index.html')); // load our public/index.html file<br/>    });</span><span id="f3c8" class="mb kc hu lx b fv mg md l me mf">};</span></pre><p id="1544" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">(确保/api路由在通配符路由之前，以覆盖它)。</p><p id="4b47" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，回到我们的Ember应用程序来处理列表适配器，我们需要做三件事:1。导入ember以使我们能够访问jQuery 2。导入配置文件，以便我们可以检查构建环境3。对我们刚刚设置的Express端点进行Ajax调用</p><p id="dcf7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦我们完成了这一步，清单适配器在导出之前将是这样的(不会改变)。</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="6974" class="mb kc hu lx b fv mc md l me mf">import DS from 'ember-data';<br/>import config from '../config/environment';<br/>import Ember from 'ember';</span><span id="adc0" class="mb kc hu lx b fv mg md l me mf">var cosmic;<br/>if (config.environment === "production") {<br/>  Ember.$.ajax('/api', {<br/>    data: {format: 'json'},<br/>    async: false,<br/>    success: function(data) {<br/>      cosmic = {<br/>        bucket: data.bucket,<br/>        writeKey: data.writeKey,<br/>        readKey: data.readKey<br/>      }<br/>    }<br/>  });<br/>} else {<br/>  //config.environment === "development"<br/>  cosmic = {<br/>    bucket: 'cosmic-real-estate',<br/>    writeKey: null,<br/>    readKey: null<br/>  }<br/>}</span></pre><p id="b48b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">(这里选择使用async: false是为了保持简单，尽管这不是最佳实践。这个想法是，在提供密钥之前，应用程序不能做任何事情——没有伤害，就没有犯规。)</p><p id="0451" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.构建前端</p><p id="e979" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的Ember应用程序现已准备就绪，密钥也已准备就绪，我们将通过构建它来开始部署过程。在cosmic-real-estate的终端中，运行:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="03f7" class="mb kc hu lx b fv mc md l me mf">ember build --environment=production --output-path=../public/</span></pre><p id="e6a1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们指定了我们的构建环境，并使用父节点应用程序的公共目录作为构建路径。</p><p id="c84d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.测试节点应用程序</p><p id="9fc3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">导航到CosmicRealEstate并运行:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="08dc" class="mb kc hu lx b fv mc md l me mf">node server.js</span></pre><p id="dc26" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你应该在localhost:3000上看到你的应用程序</p><h1 id="62ff" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="fdb1" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">使用Cosmic JS、Express.js和Ember.js，您刚刚为自己构建了一个模块化的应用程序，您可以向您选择的任何方向扩展。</p><p id="cc44" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你坚持我们的设计理念，将应用程序部署到Cosmic JS，你现在可以从一个地方完全管理你的网站及其内容。如果你认为任何不是API first的东西都比周一更糟糕，不能忍受对数据库的担心，并试图尽可能快地以最少的担心交付你的内容，你会发现Cosmic JS是你的快乐之地。</p><blockquote class="mu mv mw"><p id="8320" class="jc jd mx je b jf jg jh ji jj jk jl jm my jo jp jq mz js jt ju na jw jx jy jz hn dt translated">这篇文章最初出现在宇宙JS博客上。</p></blockquote><div class="ls lt lu lv fq ab cb"><figure class="nb iv nc nd ne nf ng paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nb iv nc nd ne nf ng paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nb iv nc nd ne nf ng paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mu mv mw"><p id="f922" class="jc jd mx je b jf jg jh ji jj jk jl jm my jo jp jq mz js jt ju na jw jx jy jz hn dt translated"><a class="ae ka" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ka" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ka" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ka" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd mx je b jf jg jh ji jj jk jl jm my jo jp jq mz js jt ju na jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ka" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ka" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ls lt lu lv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nh"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>