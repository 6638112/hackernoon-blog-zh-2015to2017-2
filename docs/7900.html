<html>
<head>
<title>Adding web.config to React projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向React项目添加web.config</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/adding-web-config-to-react-projects-3eb762dbe01f?source=collection_archive---------3-----------------------#2017-11-12">https://medium.com/hackernoon/adding-web-config-to-react-projects-3eb762dbe01f?source=collection_archive---------3-----------------------#2017-11-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/0260f306d4e7e98804bb3a9318a408ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*au2tBLI1ILf86z2hSUKLQQ.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Adding a web.config to deploy a react app to IIS</figcaption></figure><div class=""/><p id="9270" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">你有一个react项目，你想把它部署在一个运行IIS或任何其他IIS支持的网站的Azure应用服务上。您的react应用程序使用react-router，并且在您的项目中有一些客户端URL。</p><p id="6664" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">一切都很好，直到你想点击刷新按钮，这时你得到一个HTTP 404。这很正常，因为在服务器上这些urls页面并不存在，它们只存在于客户端。当点击“刷新”时，浏览器会向服务器请求该页面，服务器会尝试定位该页面，因为那里什么也没有，所以会返回404响应。你开始阅读这个问题，你发现了关于<a class="ae ke" href="https://www.iis.net/downloads/microsoft/url-rewrite" rel="noopener ugc nofollow" target="_blank"> URL重写</a>和导入<a class="ae ke" href="https://docs.microsoft.com/en-us/iis/extensions/url-rewrite-module/creating-rewrite-rules-for-the-url-rewrite-module" rel="noopener ugc nofollow" target="_blank"> URL重写规则</a>的方法。</p><p id="521f" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">一步一步地，你会发现一个带有这种重写规则的web.config文件应该被部署到Azure App服务中。我将向您展示如何将web.config文件添加到react项目中的两种方法，以及您的文件如何成为app bundle的一部分。</p><p id="b698" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这里有一个带有重写规则的<a class="ae ke" href="https://gist.githubusercontent.com/lcostea/f17663ebf041b103d98989b6b52d8353/raw/6744846d241c9b785df9054fecbcfc4f2e5dda80/web.config" rel="noopener ugc nofollow" target="_blank"> web.config </a>文件的例子，你可以在你的项目中使用它。</p><h1 id="4f7d" class="kf kg ij bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">第一种方式:web.config是src的一部分</h1><p id="ab3c" class="pw-post-body-paragraph jg jh ij ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">这是一个简单的解决方案，它包括将web.config文件与源文件并排添加，并设法使其成为捆绑包的一部分。它只适用于webpack，如果你用react-scripts构建，你可以直接走第二条路。</p><ol class=""><li id="e805" class="li lj ij ji b jj jk jn jo jr lk jv ll jz lm kd ln lo lp lq dt translated">在src中添加web.config。这是一个简单的步骤，只需将web.config复制到src文件夹中。</li><li id="7bba" class="li lj ij ji b jj lr jn ls jr lt jv lu jz lv kd ln lo lp lq dt translated">现在，为了成为捆绑包的一部分，无论您是否使用webpack进行构建，都要在index.js中添加这样一行代码:</li></ol><blockquote class="lw lx ly"><p id="5f82" class="jg jh lz ji b jj jk jl jm jn jo jp jq ma js jt ju mb jw jx jy mc ka kb kc kd hn dt translated">进口”。/web . config "；</p></blockquote><p id="0b41" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这将标记该文件正在被使用的事实。</p><p id="6440" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">3.对于webpack，我们需要告诉它如何处理web.config文件，因为如果此时运行，您将会得到类似的错误:</p><blockquote class="lw lx ly"><p id="e952" class="jg jh lz ji b jj jk jl jm jn jo jp jq ma js jt ju mb jw jx jy mc ka kb kc kd hn dt translated">模块分析失败:…src\web.config意外标记(1:0)</p></blockquote><p id="8582" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">所以在你的webpack.config.*里。js在模块的rules部分添加下面一行，这将告诉<a class="ae ke" href="https://github.com/webpack-contrib/file-loader" rel="noopener ugc nofollow" target="_blank"> webpack文件加载器</a>在输出中web.config应该被视为一个文件:</p><blockquote class="lw lx ly"><p id="29e1" class="jg jh lz ji b jj jk jl jm jn jo jp jq ma js jt ju mb jw jx jy mc ka kb kc kd hn dt translated">{测试:/\。(config)$/，loader: 'file-loader？name=[name]。[ext]'}</p></blockquote><h1 id="d3e9" class="kf kg ij bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">第二种方式:额外的构建步骤</h1><p id="3ea3" class="pw-post-body-paragraph jg jh ij ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">使用react-scripts时，您没有任何配置文件，因此我们无法使用文件加载器执行第三步。相反，这里我们将添加一个额外的构建步骤，这允许我们在代码、配置和部署之间进行更好的分离。第二种方法对webpack和react-scripts都有效。</p><ol class=""><li id="55e7" class="li lj ij ji b jj jk jn jo jr lk jv ll jz lm kd ln lo lp lq dt translated">在项目根目录(不是src的一部分)中创建一个名为iisConfig的文件夹。在里面放入web.config文件和一个新文件，该文件将包含实际副本的代码。我们可以把这个新文件叫做copyIISConfig.js，这里有一个要点。要点已经为react-scripts做好了，但是下面的第三步将告诉你如何为webpack修改它。</li><li id="1e2e" class="li lj ij ji b jj lr jn ls jr lt jv lu jz lv kd ln lo lp lq dt translated">在脚本部分内的package.json文件中，添加postbuild事件的附加构建步骤:</li></ol><blockquote class="lw lx ly"><p id="91c1" class="jg jh lz ji b jj jk jl jm jn jo jp jq ma js jt ju mb jw jx jy mc ka kb kc kd hn dt translated">" post build ":" node IIS config/copyiisconfig . js "，</p></blockquote><p id="c980" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">3.这也可以用于webpack，只需修改copyIISConfig.js文件中的webConfigPath变量，就可以将它复制到dist文件夹，而不是build文件夹。</p><p id="c002" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在只需执行<em class="lz"> npm run build </em>，在输出文件夹(build或dist)中，您将拥有web.config文件。这使得这个包可以部署到IIS网站上。</p></div></div>    
</body>
</html>