<html>
<head>
<title>They reverse engineered 16k apps; here’s what we’d fix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">他们对16k应用程序进行逆向工程；这是我们要解决的问题</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/they-reverse-engineered-16k-apps-heres-what-we-d-fix-67e9eeceefb5?source=collection_archive---------9-----------------------#2017-02-03">https://medium.com/hackernoon/they-reverse-engineered-16k-apps-heres-what-we-d-fix-67e9eeceefb5?source=collection_archive---------9-----------------------#2017-02-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="6337" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">保护移动API密钥和机密的建议</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff jj"><img src="../Images/5f21e274c8006fbe29f5c7523102d0eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y4WJT-ZAqwjLGjABej7CPQ.jpeg"/></div></figure><p id="e11e" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">在“<a class="ae kn" href="https://hackernoon.com/we-reverse-engineered-16k-apps-heres-what-we-found-51bdf3b456bb#.q62corpmp" rel="noopener ugc nofollow" target="_blank">我们对16k应用程序进行逆向工程，这是我们发现的</a>”中，Fallible使用他们的<a class="ae kn" href="https://android.fallible.co/" rel="noopener ugc nofollow" target="_blank">在线逆向工程工具</a>来探测Android应用程序，寻找秘密。他们测试了超过16000个应用程序，发现其中大约2500个包含API密钥和/或秘密。如果他们的工具可以找到他们，那么那些想利用你的应用的人也可以。</p><p id="a4db" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">让我们假设你正在开发一个Android或iOS移动应用程序。您的后端应用服务器通过RESTful API很好地公开了信息。为了验证您的移动应用程序，每个API调用都会传递一个API密钥。这个简单格式化为<id> : <secret>的密钥，使后端服务器能够轻松识别你的应用并验证共享的秘密。您的移动应用程序还直接调用一些第三方API，每个API都使用类似的关键策略。</secret></id></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff ko"><img src="../Images/1376f11abd53fa89c0e810782f877a1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/0*L4kOtQwbSZe3O7Rh."/></div></figure><p id="541c" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">我们将假设您使用TLS和<a class="ae kn" href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning" rel="noopener ugc nofollow" target="_blank">证书锁定</a>来试图防止您的API调用被观察到，但是您的API密钥都作为常量XXX_API_KEY存储在您的移动应用程序包中。如果你的任何API键可以在你的应用程序中被观察或发现，你就暴露了。</p><p id="11e9" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">以下是一些建议:</p><h1 id="3ca3" class="kp kq hu bd kr ks kt ku kv kw kx ky kz ja la jb lb jd lc je ld jg le jh lf lg dt translated">1.尽量减少应用中的#秘密</h1><p id="84fd" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">我们真的需要你存储在应用程序中的所有秘密吗？数量惊人的密钥是用于第三方API的，我们认为我们可能会使用，但从来没有使用过。清除你应用程序中的所有秘密。</p><p id="39c7" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">对于我们实际使用的第三方API密钥，考虑为所有这些服务设置代理服务器。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff ko"><img src="../Images/b75327180603b85e8789a750159b2e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/0*sYb_9DcXoWVYYU7g."/></div></figure><p id="72f5" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">不要直接调用第三方API，而是通过代理间接调用，使用您的主要应用API密钥作为身份验证。使用此方案，您可以从手机应用程序中删除所有第三方API密钥；它们隐藏在您的代理服务之后会更加安全。此外，如果您出于任何原因需要更改第三方API密钥，您可以这样做，而无需更新您的移动应用的安装基础。</p><p id="4d6e" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">我们刚刚将我们的关键需求减少到一个API密钥。如果该应用密钥被泄露，恶意参与者仍然可以通过代理使用第三方API。在代理上，您可以添加一些额外的保护，例如，只允许某些API调用序列，以尝试限制损害。如果您的应用程序密钥被泄露，您将需要更改它并推出移动应用程序更新，但至少您不需要更改第三方API密钥。</p><h1 id="f44e" class="kp kq hu bd kr ks kt ku kv kw kx ky kz ja la jb lb jd lc je ld jg le jh lf lg dt translated">2.混淆剩余的秘密</h1><p id="92e9" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">目前，快速搜索应用程序中的字符串将很容易找到剩余的APP_API_KEY。使用<a class="ae kn" href="http://stackoverflow.com/questions/14570989/best-practice-for-storing-private-api-keys-in-android" rel="noopener ugc nofollow" target="_blank">代码混淆器</a>使定位和提取秘密常数变得更加困难。进一步考虑<a class="ae kn" href="https://www.approov.io/blog/simple-app-authentication.html" rel="noopener ugc nofollow" target="_blank">以某种计算简单的方式编码API密匙</a>并在你的应用程序中分割和分发编码的秘密。只在需要的时候重组和解码内存中的秘密。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff ko"><img src="../Images/2a3a39d0d7addc34403ef8fef4e3ea71.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/0*XLiQQDV2K-z6f5_G."/></div></figure><p id="1176" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">您的密钥最终可能会被泄露，但要尽可能使其难以逆向工程。与代理API密钥不同，如果此应用程序密钥被盗，您将不得不升级整个安装基础来替换它。</p><h1 id="28bc" class="kp kq hu bd kr ks kt ku kv kw kx ky kz ja la jb lb jd lc je ld jg le jh lf lg dt translated">3.发送令牌，而不是密钥</h1><p id="5db0" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">即使我们使用TLS，攻击者仍然可以找到方法来观察我们的API调用。不要每次调用都发送完整的<id> : <secret>，让我们使用<secret>来加密或签名所有或部分API通信。</secret></secret></id></p><p id="6988" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">一个简单的方法是让移动应用程序使用<secret>对一个<a class="ae kn" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank"> JSON Web令牌(JWT) </a>进行编码，该令牌带有一个包含我们的&lt; id &gt;和一个短过期时间的有效载荷。</secret></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff ko"><img src="../Images/7924a8ffc246210d37bc62270c04c811.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/0*hXue3X6eiMuqjsYf."/></div></figure><p id="2121" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">对于每个API调用，都会发送一个令牌来代替API密钥；API秘密不会暴露。使用相同的<secret>，后端服务器可以验证令牌的编码和生命周期。每当前一个令牌过期时，移动应用程序都会生成一个新令牌。</secret></p><p id="d27d" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">如果令牌被盗，它可以用来调用您的API和代理，但它只会在该令牌的生命周期内成功，因此要保持较短的到期时间。</p><p id="2667" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">当然，如果模糊的秘密被泄露，攻击者可以生成有效的令牌，您仍然需要升级您的安装基础来修复它。</p><p id="85fc" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">您可以通过不同的方式使用<secret>来获得其他好处。例如，<a class="ae kn" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/RESTAuthentication.html" rel="noopener ugc nofollow" target="_blank">亚马逊S3 REST API签名和授权方案</a>使用&lt;秘密&gt;来提供额外的保护，防止消息篡改。</secret></p><h1 id="93bb" class="kp kq hu bd kr ks kt ku kv kw kx ky kz ja la jb lb jd lc je ld jg le jh lf lg dt translated">4.从应用程序中移除剩余的机密</h1><p id="78eb" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">我们可以从应用程序中移除最后剩余的API密钥吗？我们可以将令牌生成委托给设备外的服务，类似于我们如何将第三方API调用委托给代理服务。然而，要做到这一点，我们的服务必须能够识别我们真实的、未经篡改的应用程序，同时拒绝所有其他应用程序。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff ko"><img src="../Images/0929fd8d570602b96018e0428bb829e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/0*IlJggvxDzuK-0_Gr."/></div></figure><p id="2db6" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">我们的应用程序认证服务将使用我们的移动应用程序的独特特征来证明应用程序的完整性和真实性。该服务的动态认证挑战将比模糊的静态秘密方法更有弹性。如果满意，认证服务返回一个有效的、有时间限制的API令牌。</p><p id="f54b" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">现在，不仅您的API秘密不会被API调用暴露，而且您的应用程序的API密钥也不再暴露在您的移动应用程序中的任何地方。由于所有的API密匙都在服务器后得到保护，任何API密匙都可以更新，而不需要任何更新或失去对您的移动应用程序的服务。</p><h1 id="92cb" class="kp kq hu bd kr ks kt ku kv kw kx ky kz ja la jb lb jd lc je ld jg le jh lf lg dt translated">后续步骤</h1><p id="97d0" class="pw-post-body-paragraph jr js hu jt b ju lh iv jw jx li iy jz ka lj kc kd ke lk kg kh ki ll kk kl km hn dt translated">一定要通过Fallible的<a class="ae kn" href="https://android.fallible.co/" rel="noopener ugc nofollow" target="_blank">在线工具</a>运行你的应用；他们为开发者社区提供了很好的服务。不过，注意，即使您通过了测试，也不意味着您的API是完全安全的，但是您已经在路上了。</p><p id="96e2" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">请注意，所有这些技术都可以安全地与<a class="ae kn" href="https://oauth.net/" rel="noopener ugc nofollow" target="_blank"> OAuth </a>用户认证方法相结合。关于API密钥和安全性的更多细节，请尝试<a class="ae kn" href="https://hackernoon.com/mobile-api-security-techniques-682a5da4fe10#.bby4c2bwn" rel="noopener ugc nofollow" target="_blank">移动API安全技术</a>。</p><p id="90b6" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">我认为从您的移动应用程序中删除最后一个API密钥是对您的API安全性的一个重大提升，但是，完全公开，我在一个提供可靠的移动应用程序认证服务的团队中工作。如果你有兴趣，可以在<a class="ae kn" href="https://approov.io" rel="noopener ugc nofollow" target="_blank">approv . io</a>了解更多；我喜欢你的反馈。</p><p id="87aa" class="pw-post-body-paragraph jr js hu jt b ju jv iv jw jx jy iy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">感谢阅读！如果你能推荐这篇文章(点击❤按钮)，让其他人也能找到，我将不胜感激。</p><div class="jk jl jm jn fq ab cb"><figure class="lm jo ln lo lp lq lr paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lm jo ln lo lp lq lr paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lm jo ln lo lp lq lr paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ls lt lu"><p id="f922" class="jr js lv jt b ju jv iv jw jx jy iy jz lw kb kc kd lx kf kg kh ly kj kk kl km hn dt translated"><a class="ae kn" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kn" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kn" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kn" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jr js lv jt b ju jv iv jw jx jy iy jz lw kb kc kd lx kf kg kh ly kj kk kl km hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kn" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kn" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="fe ff lz"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>