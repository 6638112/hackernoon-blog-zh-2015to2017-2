<html>
<head>
<title>Save time by transforming images in the command line</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过在命令行中转换图像来节省时间</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/save-time-by-transforming-images-in-the-command-line-c63c83e53b17?source=collection_archive---------2-----------------------#2017-02-25">https://medium.com/hackernoon/save-time-by-transforming-images-in-the-command-line-c63c83e53b17?source=collection_archive---------2-----------------------#2017-02-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="6bab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">经过几个月的编程，这个月我退一步做常规的HTML/CSS编码。起初，这真的很令人愉快，但很快出现了第一个问题:导出的图像通常不会以正确的形式出现。有时它应该是JPG的PNG，有时图像有不必要的空白或者颜色不对。一种解决方案是启动一个图像GUI编辑器，更改图像并保存它。但是这也有一些缺点。显然你必须花些时间四处点击。也许通过一些练习，你会学到一些快速做事的关键技巧。但是打开图像并保存它的简单过程还是花费了太多的时间。并且一次对多个图像进行改变是有问题的。如果你能用几句话解释这个任务，那么在命令行中也很容易做到。</p><h1 id="3119" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">两个最基本的命令</h1><p id="f765" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">有几个命令行命令可以帮助您完成大多数基本操作。这些当然是针对BASH，而不是Windows CLI。(这通常意味着你需要在Windows上安装MacOS、Linux或Ubuntu)。实现图像处理的库主要是<a class="ae ks" href="https://www.imagemagick.org/" rel="noopener ugc nofollow" target="_blank"> ImageMagick </a>。您很可能已经安装了它，但是在某些Linux发行版上，您可能需要自己安装它:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="43ab" class="lc jq hu ky b fv ld le l lf lg">sudo apt-get install imagemagick</span></pre><p id="f314" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有时候也需要安装在MacOS上。使用Brew很容易做到这一点:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="9322" class="lc jq hu ky b fv ld le l lf lg">brew update &amp;&amp; brew install imagemagick</span></pre><p id="7f9b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">ImageMagick为您提供了两个强大的命令:<a class="ae ks" href="https://www.imagemagick.org/script/convert.php" rel="noopener ugc nofollow" target="_blank">转换</a>和<a class="ae ks" href="http://www.imagemagick.org/script/mogrify.php" rel="noopener ugc nofollow" target="_blank"> mogrify </a>。Mogrify通常采用与convert相同的参数，但是允许您处理多个图像，并使用<strong class="it hv">在适当的位置替换它们</strong>。因此，提前备份这些映像是一个好习惯。例如，这会将当前文件夹中所有图像的大小调整为256 * 256。</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="7917" class="lc jq hu ky b fv ld le l lf lg">mogrify -resize 256x256 *.jpg</span></pre><p id="4fbc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用convert，您可以指定单个源和输出文件名。这将转换图像从巴布亚新几内亚到JPG。</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="c19a" class="lc jq hu ky b fv ld le l lf lg">convert myimage.png myimage.jpg</span></pre><p id="1fa3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对应的货币单位是:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="fb69" class="lc jq hu ky b fv ld le l lf lg">mogrify -format jpg *.png</span></pre><h1 id="9787" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">调整大小和纵横比</h1><p id="b545" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">对于很多人来说，调整大小是最常见的图像变换。</p><p id="bbb6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">convert和mogrify都有可用的<em class="lh"> -resize (-r) </em>参数。它可以接受几种格式的值:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="930c" class="lc jq hu ky b fv ld le l lf lg">mogrify -resize 50% *.jpg # resize to 50%<br/>mogrify -resize 1024x768 *.jpg # resize, keep original aspect ratio<br/>mogrify -r 1024x768! *.jpg # resize, enforce exact dimensions<br/>mogrify -r 1024 # resize to width of 1024<br/>mogrify -r x768 *.jpg # resize to height of 1024<br/>convert source.jpg -r 1024x768 output.jpg</span></pre><p id="e95f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">调整大小的另一个解决方案可以是仅在MacOS上可用的<a class="ae ks" href="https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/sips.1.html" rel="noopener ugc nofollow" target="_blank"> <em class="lh"> sips </em> </a>命令。与mogrify相同，它就地替换图像。</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="a39a" class="lc jq hu ky b fv ld le l lf lg">sips --resampleWidth 1024 *.jpg<br/>sips --resampleHeight 768 *.jpg<br/>sips -z 768 1024 *.jpg # -z takes height as a first argument</span></pre><p id="d0fa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">sip也可以旋转和翻转，但通常不如ImageMagick灵活。它的主要优点是默认安装在MacOS上。</p><h1 id="b213" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">借助重力进行裁剪</h1><p id="142c" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated"><em class="lh">用mogrify和convert裁剪</em>与resize非常相似。默认用法可能不完全直观。</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="cb79" class="lc jq hu ky b fv ld le l lf lg">convert source.jpg -crop 100x100 output.jpg</span></pre><p id="ba5b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果源图像是1000x1000，就不会输出一张图像，而是十张。这可能是有用的，但在现实世界中，你经常需要的只是一个从中心裁剪下来的图像。这就是——<em class="lh">引力</em>发挥作用的地方:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="b779" class="lc jq hu ky b fv ld le l lf lg">convert source.jpg -crop 100x100+0+0 -gravity center output.jpg</span></pre><p id="5768" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">+0+0意味着y=0，x=0，因此我们将从中心(图像的实际中心)获得最近的图块。</p><p id="72db" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你只是需要从图像中去除一些边框，使用<em class="lh"> -shave </em>会更有用。</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="8770" class="lc jq hu ky b fv ld le l lf lg">convert source.jpg -shave 10x10 output.jpg #shave 10px from sides</span></pre><h1 id="4550" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">修剪空白</h1><p id="3b33" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">编码时，带有空白的图像几乎没有用。这样的图像更难定位和响应。然而，当使用GUI编辑器时，很容易保存带有额外的未被注意到的空白的图像。</p><p id="9cc4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">删除空白非常简单</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="95a6" class="lc jq hu ky b fv ld le l lf lg">mogrify -trim *.{jpg,png}</span></pre><p id="d3a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Trim使用起来很安全，但是在使用之前做一个备份是一个很好的习惯。有些图像可能无法正确裁剪，因为可能会有极少量的“像素残留”。可以添加<em class="lh"> -fuzz </em>使修剪更加严格。</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="b956" class="lc jq hu ky b fv ld le l lf lg">mogrify -trim -fuzz 40% *.{jpg,png}</span></pre><h1 id="8cf8" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">替换颜色和透明度</h1><p id="f0e9" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">你需要不同颜色的标志吗？还是需要透明背景？这两种改变都很容易做到:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="56f7" class="lc jq hu ky b fv ld le l lf lg">convert white.png -fill '#000' -opaque '#fff' black.png</span></pre><p id="ba1b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">-此处可以添加模糊，以增加颜色替换的容差</p><p id="829e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你有一个白色背景的jpg，并需要使它透明，你可以简单地做:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="28de" class="lc jq hu ky b fv ld le l lf lg">convert source.jpg -transparent white output.png</span></pre><h1 id="56d7" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">创建收藏夹图标</h1><p id="39d1" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">如果源图像至少为256x256，您可以快速转换为包含所有必要标准图像版本的ico:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="78be" class="lc jq hu ky b fv ld le l lf lg">convert source.png -define icon:auto-resize favicon.ico</span></pre><h1 id="38d3" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">使用自定义shell脚本完成更多工作</h1><p id="154e" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">准备一些shell脚本来自动化常见的图像转换可能会有所帮助。这些可以是更高级的操作或在多个图像上进行的操作序列。</p><p id="d3f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我所说的shell脚本主要是放在~/中的函数。bashrc文件(或~/。Mac上的bash_profile ),因此它们总是可用的。</p><p id="6f4f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我经常用它们来收集图片，主要是图库。当我创建一个画廊时，当我收到一个图片集时，我大部分时间都是这样做的</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="043f" class="lc jq hu ky b fv ld le l lf lg">mv_seqnum(){<br/>  a=1<br/>  for i in $@; do<br/>    new=$(printf "%04d.jpg" "$a")<br/>    mv -- "$i" "$new"<br/>    let a=a+1<br/>  done<br/>}</span><span id="6cdd" class="lc jq hu ky b fv li le l lf lg"># This can be used as</span><span id="2a44" class="lc jq hu ky b fv li le l lf lg">$ cd some-image-folder<br/>$ mv_seqnum</span></pre><p id="f2d6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将把图像重命名为序列号。这使得在各种模板语言和脚本中使用它们变得很容易。下一步是为缩略图和srcset创建多种图像尺寸。</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="f008" class="lc jq hu ky b fv ld le l lf lg">img_size_folder(){<br/>  mkdir $1<br/>  cp *.jpg $1<br/>  cd $1<br/>  mogrify -r $2 *.jpg<br/>  cd ..<br/>}</span><span id="bbb4" class="lc jq hu ky b fv li le l lf lg"># This can be used as</span><span id="ac5d" class="lc jq hu ky b fv li le l lf lg">$ cd some-image-folder<br/>$ img_size_folder thumbnail 150</span></pre><p id="650a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将创建一个缩略图文件夹，将图像复制到其中，并将它们的宽度调整为150像素。</p><p id="6ad1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，我们可以创建一个脚本，该脚本将获取一组图像，并为它们创建多种大小的版本:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="2069" class="lc jq hu ky b fv ld le l lf lg">create_image_sizes(){<br/>  mv_seqnum<br/>  img_size_folder big 1620<br/>  img_size_folder full 1920<br/>  img_size_folder medium 1024<br/>  img_size_folder small 450<br/>}</span><span id="cbc8" class="lc jq hu ky b fv li le l lf lg">$ cd some-image-folder<br/>$ create_image_sizes</span></pre><p id="fe37" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将创建大、全、中、小文件夹，并在其中添加1620像素、1920像素、1024像素和450像素宽的图像。</p><h1 id="bc02" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">压缩</h1><p id="0ce5" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">Imagemagick还提供了几种优化图像以缩小尺寸的方法。您可以使用选项<em class="lh">-质量</em>(范围从0到100)。你也可以通过<em class="lh">-滤镜</em>选项应用许多滤镜。您可以选择渐进式JPEG渲染、额外锐化和其他功能。</p><p id="7cb5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这篇优秀的<a class="ae ks" href="https://www.smashingmagazine.com/2015/06/efficient-image-resizing-with-imagemagick/" rel="noopener ugc nofollow" target="_blank">粉碎杂志文章</a>中很好地描述了先进的压缩技术，尤其是<a class="ae ks" href="https://www.smashingmagazine.com/2015/06/efficient-image-resizing-with-imagemagick/#bash-shell" rel="noopener ugc nofollow" target="_blank"> smartresize函数</a>可以非常方便。</p><p id="177b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在MacOS上，还可以<a class="ae ks" href="https://github.com/JamieMason/ImageOptim-CLI" rel="noopener ugc nofollow" target="_blank"> ImageOptim-CLI </a>，它可以<a class="ae ks" href="http://jamiemason.github.io/ImageOptim-CLI/" rel="noopener ugc nofollow" target="_blank">提供高达80%的尺寸缩减</a>。</p><h1 id="585a" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">结论</h1><p id="dd0d" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">到目前为止，这些命令对我很有用，我不需要打开GUI。和往常一样，通过使用CLI，您不仅节省了时间，而且还学到了一些方法，以后您可以使用这些方法在定制构建脚本和集成中实现自动化。学习曲线是值得的。</p><p id="52be" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt">— — — — —</p><p id="bc5f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lh">我是一名自由职业者，目前正在寻找未来几个月的工作。我专门用Ember.js和性能优化构建单页面应用程序。随时联系我，电话:</em><a class="ae ks" href="mailto:malindacz@gmail.com" rel="noopener ugc nofollow" target="_blank"><em class="lh">malindacz@gmail.com</em></a><em class="lh">或</em><a class="ae ks" href="https://twitter.com/martinmalindacz" rel="noopener ugc nofollow" target="_blank">【twitter.com/@martinmalinda.cz】T21</a></p><blockquote class="lj lk ll"><p id="82d3" class="ir is lh it b iu iv iw ix iy iz ja jb lm jd je jf ln jh ji jj lo jl jm jn jo hn dt translated"><a class="ae ks" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿美族家庭的一员。我们现在<a class="ae ks" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ks" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is lh it b iu iv iw ix iy iz ja jb lm jd je jf ln jh ji jj lo jl jm jn jo hn dt translated">要了解更多信息，<a class="ae ks" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a>、<a class="ae ks" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上给我们点赞/发消息</a>，或者简单地说，<a class="ae ks" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is lh it b iu iv iw ix iy iz ja jb lm jd je jf ln jh ji jj lo jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ks" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ks" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote></div></div>    
</body>
</html>