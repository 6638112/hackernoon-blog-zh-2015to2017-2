<html>
<head>
<title>Simulating a Decentralized Lightning Network with 10 Million Users</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模拟拥有1000万用户的分散式闪电网络</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/simulating-a-decentralized-lightning-network-with-10-million-users-9a8b5930fa7a?source=collection_archive---------2-----------------------#2017-07-03">https://medium.com/hackernoon/simulating-a-decentralized-lightning-network-with-10-million-users-9a8b5930fa7a?source=collection_archive---------2-----------------------#2017-07-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="7221" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Jonald Fyookball最近的一篇帖子声称给出了数学证明，闪电网络(LN)不可能很大，而且仍然是分散的。鉴于<a class="ae jp" rel="noopener" href="/@murchandamus/i-have-just-read-jonald-fyookballs-article-https-medium-com-jonaldfyookball-mathematical-fd112d13737a"> Murch的回应</a>，Jorge Stolfi教授发布了以下<a class="ae jp" href="https://www.reddit.com/r/btc/comments/6jxem4/responding_to_murchs_responding_to_jonald" rel="noopener ugc nofollow" target="_blank">挑战</a>:</p><blockquote class="jq jr js"><p id="d4db" class="ir is jt it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">有一个非常简单的方法来关闭像乔纳森和我这样的批评。只需为1000万用户提供一个具有拓扑结构和数量的假设场景——有多少客户、商家和枢纽，每对用户类别有多少渠道和每个用户的支付(每天或每月),以及每个用户向其渠道承诺多少<a class="ae jp" href="https://hackernoon.com/tagged/bitcoin" rel="noopener ugc nofollow" target="_blank">比特币</a>等。任何怀疑LN可行性的人都可以用这些数据进行模拟，然后自己得出结论。有人愿意接受这个挑战吗？</p></blockquote><p id="1e94" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我决定接受这个挑战。为了强调LN可以去中心化，假设的拥有1000万用户的<a class="ae jp" href="https://hackernoon.com/tagged/network" rel="noopener ugc nofollow" target="_blank">网络</a>以所有用户都相同的方式来描述:所有用户都有相同数量的渠道，最初由相同数量的比特币资助。“客户”、“商家”或“枢纽”之间没有区别。特别是，每个用户有14个开放频道，最初用0.01比特币资助。图表的结构描述如下。</p><p id="bb93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我还编写了ocaml代码来为这样一个拥有1000万用户的闪电网络提供一个基本的模拟。有11种不同的费用政策平均分配给用户。在模拟的每一步，随机选择两个用户，其中一个试图向另一个付款。付款可能是“大的”(0.001到0.009 btc之间，几美元)，“中等大小的”(0.00001到0.001 btc之间，大约2美元或更少)，也可能是“微的”(小于0.00001 btc，大约2美分或更少)。该代码搜索一条便宜的路线，如果找到一条，就尝试付费。模拟器假设路由中的节点有0.1%的机会变得不合作，在这种情况下，请求避开该节点的新路由(最多5次重试)。下面我们报告对400，000次支付尝试运行模拟的结果。</p><h1 id="4b16" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated"><strong class="ak">拥有1000万用户的网络拓扑</strong></h1><p id="6214" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">第一个挑战是想象一个有1000万个节点(用户)和足够多的边(通道)的图，这样每个节点都可以从其他节点到达，具有足够的冗余，没有中心化。我们还有一个限制，即每个渠道都必须有一定数量的比特币。</p><p id="d0bc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们认为节点集是从0到9，999，999的自然数。</p><p id="1ae8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">边的第一种可能性是使用从0到9，999，999(需要24位)的数的二进制表示，并且每当两个位序列相差恰好1位时包括一条边(汉明图)。所有节点都可以通过最多24跳，平均12跳的(许多)路径到达。然而，将会有大约2亿个频道。如果两个用户都用0.01个比特币资助每个通道，那么400万个比特币将被锁定在LN支付通道中。虽然这在技术上是可能的，但似乎太不现实了。</p><p id="af92" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">基于汉明图给出的思想，我们可以考虑节点的10进制表示。首先考虑网络中只有10个节点的可能性。在这种情况下，我们可以在模10相差1的节点之间包含一条边。</p><figure class="lb lc ld le fq lf fe ff paragraph-image"><div class="fe ff la"><img src="../Images/2010e49db06f9dc32e5adce89b7dd393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*g_eRqNtr0iwQcFqVEc3ClQ.png"/></div><figcaption class="li lj fg fe ff lk ll bd b be z ek">A trivial network with 10 users</figcaption></figure><p id="4fe3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个“网络”是连接的，但冗余很少。每个节点都有两条边，并且从所有其他节点都可以通过两种方式到达。从一个节点到另一个节点的最短路径最多有5跳。</p><p id="5b80" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来考虑网络中有100个节点。在这种情况下<br/>,我们可以包括模100相差1或模100相差10的节点之间的边。</p><figure class="lb lc ld le fq lf fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lm"><img src="../Images/4554d0e733e9be46b98e9ce78d7e3750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R3VoaZISEQw-IPnPRx4Yfg.png"/></div></div><figcaption class="li lj fg fe ff lk ll bd b be z ek">A connected network with 100 nodes and many paths</figcaption></figure><p id="db5e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里每个节点正好有4个连接，从一个节点到另一个节点有许多路径，提供了大量冗余。每个节点可在10跳内到达，平均5跳。</p><p id="af37" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">跳到具有1000万个节点的情况，每当节点相差10的幂的<em class="jt"> n </em>(对于<em class="jt"> n </em> =0，…，6)模1000万时，我们包括一条边。每个节点将正好有14条边，对应于LN中的每个用户有14个开放信道。由于每个信道涉及2个用户，因此网络中总共有7000万个开放信道。假设每个用户用0.01个比特币资助每个通道，要求用户在LN个通道中锁定0.14个比特币。对于1000万用户，这需要140万个比特币参与LN。这仍然有些异想天开，但比上面的汉明图所要求的400万更现实。(对于更现实的场景，用户数量可能应该限制在最多100万。)每个节点都可以通过最多35跳的路径从其他节点到达，平均17.5跳。</p><h1 id="ab70" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated"><strong class="ak">模拟40万次支付尝试</strong></h1><p id="7382" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">这里我们描述了模拟400，000次尝试支付后的网络状态。这些付款在随机用户之间具有随机值，分布在大额付款(0.001至0.009 btc)、中型付款(0.00001至0.001 btc)和小额付款(少于0.00001 btc)之间，大约三分之一的付款属于这三类。</p><p id="b4ac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在400，000次尝试支付后，大约一半的用户(5，049，576)参与了支付途径，10%的渠道(7，091，810)用于支付途径。</p><p id="da81" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在某些情况下，路由请求超时(时间限制为1秒)，导致路由失败。这种情况发生在4，500起案件中(在400，000次尝试付款中仅占1%多一点)。更仔细地看，小额支付更容易出现路由失败。这大概是因为小额支付在接受路线方面更具限制性，以避免费用过高。请求路由时的最高费用总是0.00001 btc (10位)或被转移价值的5%，以较高者为准。</p><p id="8b4b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以下是三种支付方式的具体数字:</p><p id="aebb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尝试了133，865次“大额”支付(介于0.001和0.009之间)。只有8个失败了。成功支付的中间跳数为18，中间总费用(整个路线)为3位(0.000003 btc)或转账金额的0.06%。</p><p id="4463" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尝试了132，734次中等规模的支付，其中1031次(0.8%)失败。对于成功的支付，跳数的中间值是18，总费用的中间值是2比特(0.000002 btc)或转移价值的0.5%。</p><p id="7108" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尝试了133，401次小额支付，其中3461次(2.6%)失败。对于成功的支付，跳数的中间值是19，总费用的中间值是2比特(0.000002 btc)或转移价值的32%。</p><p id="742e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Fyookball在他的<a class="ae jp" rel="noopener" href="/@jonaldfyookball/mathematical-proof-that-the-lightning-network-cannot-be-a-decentralized-bitcoin-scaling-solution-1b8147650800">第一篇文章</a>中指出的一个可能的问题是，通道将变得不平衡，这样它们在路由期间只能在一个方向上使用。在模拟中，信道确实开始变得不平衡。在用于路由的700万个渠道中，近400，000笔成功支付中的294，508笔(4%)在渠道的一端具有90%或更多的价值。这似乎还不是一个问题，因为这仍然只占7000万个可用频道总数的0.4%，但随着模拟器的长时间运行，这可能会成为一个问题。如果这是一个问题，人们会认为它会增加大额支付的失败，因为它会比小额支付更多地限制大额支付的可能路径。然而，不平衡信道也可能不会造成问题，因为有大量的替代路由(包括，如默奇<a class="ae jp" rel="noopener" href="/@murchandamus/i-have-just-read-jonald-fyookballs-article-https-medium-com-jonaldfyookball-mathematical-fd112d13737a">指出的</a>，在另一个方向专门使用不平衡信道的路由)。</p><h1 id="0d25" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated"><strong class="ak">模拟器如何改进</strong></h1><p id="5ec8" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated"><a class="ae jp" href="https://github.com/dianerey/lnsim" rel="noopener ugc nofollow" target="_blank">模拟器</a>相对较慢，运行时间越长，需要的内存越多。这400，000笔付款的模拟花费了几个小时，在达到500，000笔付款之前，该流程就终止了。该代码可用于那些拥有更强大硬件的人想要更长时间运行模拟器的情况。</p><p id="2d84" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">除了效率问题之外，模拟还可以在许多方面进行改进，使其更加真实。例如，模拟可以扩展到模拟通道的打开和关闭。此外，假设频道的数量和频道的资金随用户而变化会更现实。</p><h1 id="4def" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated"><strong class="ak">结论</strong></h1><p id="de5f" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">我们给出了一个拥有1000万用户的闪电网络的结构，它没有集中的集线器。事实上，每个用户都拥有与所有其他用户完全相同的连接和资金。虽然这不是闪电网络在现实世界中的预期发展，但它确实表明了拥有这样一个网络在技术上是可能的。此外，我们给出了代码来模拟在网络中进行支付。一次相对较短的运行(尝试400，000次支付)显示，支付成功率为99%，小额支付的失败频率高于大额支付。</p><div class="lb lc ld le fq ab cb"><figure class="lr lf ls lt lu lv lw paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lr lf ls lt lu lv lw paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lr lf ls lt lu lv lw paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="jq jr js"><p id="f922" class="ir is jt it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is jt it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lb lc ld le fq lf fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lx"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="lb lc ld le fq lf"><div class="bz el l di"><div class="ly lz l"/></div></figure></div></div>    
</body>
</html>