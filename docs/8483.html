<html>
<head>
<title>Azure Container Instances vs. AWS Fargate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure容器实例与AWS Fargate</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/azure-container-instances-vs-aws-fargate-3216607f63f4?source=collection_archive---------6-----------------------#2017-12-04">https://medium.com/hackernoon/azure-container-instances-vs-aws-fargate-3216607f63f4?source=collection_archive---------6-----------------------#2017-12-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/c209c2db1ce5554bedf8128444f50a6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sHwjEadMpmPaw_bHcURM6g.jpeg"/></div></div></figure><div class=""/><p id="a64f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">上周，在他们的re:Invent 2017盛会上，AWS宣布了他们的新集装箱服务<a class="ae ka" href="https://aws.amazon.com/fargate/" rel="noopener ugc nofollow" target="_blank"> Fargate </a>。Fargate是AWS的无集群/无服务器的容器运行方式。Fargate的声明还包括AWS管理的Kubernetes集群，称为AWS EKS，只能在2018年通过注册获得。</p><p id="ae1b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在极少数情况下，AWS似乎正在追赶微软的Azure。Azure在过去的几个月里已经有了<a class="ae ka" href="https://azure.microsoft.com/en-us/services/container-instances/" rel="noopener ugc nofollow" target="_blank">Azure Container Instances</a>(ACI ),并且已经推出了托管的Kubernetes(和DC/OS)作为Azure Container Services…ehm…服务的一部分。</p><p id="f8e8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Fargate是全新的，目前只在us-east-1地区可用，但将其与Azure Container实例进行比较仍然很有趣，因为它们似乎都面向相同的受众，并提供相同的价值。但是外表可能具有欺骗性，因为事实证明它们是完全不同的动物！震惊，恐怖！</p><h1 id="a623" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">入门指南</h1><p id="494d" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">让我们先来看看从zero——这里zero表示您有一个拥有适当权限的AWS和/或Azure帐户——到一个在两个服务上向互联网公开简单网页的运行容器有多容易。</p><h2 id="13e7" class="le kc if bd kd lf lg lh kh li lj lk kl jn ll lm kp jr ln lo kt jv lp lq kx lr dt translated">Azure容器实例启动并运行</h2><p id="81f2" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">ACI没有真正的可视化设置向导或GUI。幸运的是，Azure CLI非常好，让容器运行起来非常简单:两个bash一行程序。</p><ul class=""><li id="e8ee" class="ls lt if je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">创建资源组</li><li id="05a2" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">创建容器实例</li></ul><figure class="mg mh mi mj fq hw"><div class="bz el l di"><div class="mk ml l"/></div></figure><p id="1b39" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这之后，一个快速的<code class="eh mm mn mo mp b">az container show</code>通知我我的服务在地址<code class="eh mm mn mo mp b">52.191.116.216:3000.</code>上可用，是的，它实际上也工作了:</p><figure class="mg mh mi mj fq hw fe ff paragraph-image"><div class="fe ff mq"><img src="../Images/f9ba6ab7ab7d944cad8ef84fdccd3b58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*q3VrvfE1bZ8Mo-swJFB6vA.png"/></div><figcaption class="mr ms fg fe ff mt mu bd b be z ek">simple service running on Azure Container Instances</figcaption></figure><h2 id="4958" class="le kc if bd kd lf lg lh kh li lj lk kl jn ll lm kp jr ln lo kt jv lp lq kx lr dt translated">Fargate启动并运行</h2><p id="e6c9" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">让我们从一个小问题开始:根据AWS，Fargate“允许你运行容器，而不必管理服务器或集群”。然而，运行Fargate容器的第一步是…创建一个集群！好吧，它非常快，你不必管理它，但仍然。</p><p id="976f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">不过一般来说，在Fargate上设置第一个运行的容器要比ACI复杂得多。使用AWS GUI，您可以完成以下步骤，其中每一步都有大量的选项、下拉列表和输入字段。</p><ul class=""><li id="1aa3" class="ls lt if je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">创建一个集群</li><li id="4489" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">创建任务定义</li><li id="ad50" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">创建容器定义</li><li id="b0bb" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">在集群中创建服务:选择Fargate类型</li><li id="8021" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">选择VPC、子网、安全组等:确保选择“自动分配公共IP”</li><li id="9482" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">选择四个负载平衡选项之一:无、应用程序、经典或网络负载平衡器。</li><li id="bcf6" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">选择自动缩放，可以跳过</li></ul><p id="566e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">很明显，Fargate已经完全嵌入到当前的Amazon弹性容器(ECS)服务中。与EC2版本相比，您实际上需要选择它作为“启动类型”。</p><figure class="mg mh mi mj fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mv"><img src="../Images/6424e62eb119a8e6ee0db23b9b6061f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJocBjYS4zDy1-RpRNAU9w.png"/></div></div><figcaption class="mr ms fg fe ff mt mu bd b be z ek">ECS Fargate launch type</figcaption></figure><p id="a571" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这意味着Fargate附带了所有配置和设置灵活性/bagage。这不是问题<em class="mw"> an sich </em>但至少对我来说，AWS ECS的设置和配置总是很麻烦。</p><p id="db54" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完成这个设置过程后，仪表板通知我们容器正在运行。但是我们能在哪里到达它？这让我困惑了一段时间:UI中什么也没有，在AWS CLI中使用适用的<code class="eh mm mn mo mp b">describe</code>调用时，结果JSON中什么也没有。原来你必须导航到服务中任务的ENI(弹性网络接口)。这会将您带到标准的EC2控制台，其中列出了公共IPv4地址！</p><p id="51f0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最初的尝试没有得到回应。通过将端口3000添加到连接到ENI的安全组，解决了这个问题。</p><figure class="mg mh mi mj fq hw fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/3a19ee0f0f0dde4094b292ae8cca87b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*3la3AdNy4uAy3jZjZLGMqw.png"/></div><figcaption class="mr ms fg fe ff mt mu bd b be z ek">simple service running on AWS Fargate</figcaption></figure><p id="83fd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">注意:这个完整的设置可以使用AWS CLI来完成，参见<a class="ae ka" href="http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_AWSCLI_Fargate.html" rel="noopener ugc nofollow" target="_blank"> AWS自己写在这里的</a>。</p><h1 id="eb51" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">在使用中</h1><p id="7190" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">现在容器已经启动并运行了，我们可以用它们做什么呢？</p><h2 id="9903" class="le kc if bd kd lf lg lh kh li lj lk kl jn ll lm kp jr ln lo kt jv lp lq kx lr dt translated">Azure容器实例</h2><p id="8d2c" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">ACI实际上没有GUI，只有一个只读屏幕显示正在运行的容器，出于某种原因称为“容器组”。这意味着您将使用Azure CLI与ACI进行交互，幸运的是，这并不意味着您可以使用ACI容器做什么:</p><pre class="mg mh mi mj fq my mp mz na aw nb dt"><span id="ade6" class="le kc if mp b fv nc nd l ne nf">az container [-h] {show,logs,list,delete,create}</span></pre><p id="2ec8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">无停止、无暂停、无扩展、无度量、无更新、无卷/磁盘装载，什么都没有。你可以跟踪日志，仅此而已。这是不可改变的基础设施带来了它的逻辑结论！事实上，即使在这种MVP形式的服务中，也没有可伸缩性，因为启动同一个容器的多个负载平衡版本是一个很大的缺陷。</p><p id="0268" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因此，ACI看起来就像是通常集成得很好的Azure景观中的一个孤岛，我打赌微软正在努力集成他们的负载平衡解决方案和卷安装之类的东西。</p><p id="4102" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mw">更新9–12–2017:</em>在评论中，ACI PM Sean跳了进来，提到卷挂载确实存在:<a class="ae ka" href="https://docs.microsoft.com/en-us/azure/container-instances/container-instances-mounting-azure-files-volume" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/container-instances/container-instances-instances-mounting-azure-files-volume</a>然而，这些CLI参数并没有在我使用的CLI版本中列出。</p><h2 id="4e90" class="le kc if bd kd lf lg lh kh li lj lk kl jn ll lm kp jr ln lo kt jv lp lq kx lr dt translated">法尔盖特</h2><p id="f843" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">如前所述，设置比ACI复杂得多。但是，在经历了所有这些困难之后，您确实拥有了一个非常灵活且得到良好支持的容器平台，它具有基本上所有的ECS功能:</p><ul class=""><li id="1651" class="ls lt if je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">停止、开始、缩放、自动缩放、调度等。</li><li id="7585" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">负载平衡</li><li id="af85" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">安全组、IAM、角色等。</li><li id="d8e7" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">VPC、子网、ENI、公共IP、卷等。</li><li id="b56d" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">集成的CPU和内存使用指标。</li></ul><p id="beba" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">到目前为止，您可能已经注意到，Fargate并不是一个真正独立的AWS服务，尽管AWS确实是这样描述它的:Fargate是ECS的一个不同的容器运行时。在您的日常使用中，您使用ECS而不是Fargate。</p><h1 id="c764" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">表演</h1><p id="4dbe" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">大警告:这充其量只是一个轶事般的“性能测试”。这实际上主要是一个网络吞吐量测试…不过，我很好奇这两种服务在简单性能上是否有明显的巨大差异。</p><p id="bf4d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我的测试服务是一个节点。JS哈比神应用服务一个简单的页面。用1000个请求和10次运行并发5次运行Apache Bench基准测试，得到了以下结果:</p><pre class="mg mh mi mj fq my mp mz na aw nb dt"><span id="85bf" class="le kc if mp b fv nc nd l ne nf"><strong class="mp ig">                                   ACI      Fargate<br/></strong>Requests per second (#/sec):     43.34      45.54<br/>Time per request (ms):         118.083     109.797<br/>99% (ms):                          371      276</span></pre><p id="95b0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">结果非常非常接近。但是值得注意的是，Fargate/ECS的峰值行为似乎较少，例如，99%通常较低。</p><h1 id="87f8" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">定价</h1><p id="2832" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">这两种服务使用非常相似的定价模型，其中主要成本是以下因素的函数:</p><p id="0ca8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">持续时间*容器*内存* CPU </strong></p><p id="616b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ACI为每个创建的集装箱增加了0.0025美元的“创建请求”成本。这有点混淆了基于资源的按使用付费模式，但对大多数人来说可能不是大问题。Fargate集装箱的充电时间至少为1分钟。</p><p id="60a8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是一个例子:您在一个月(30天)内每天创建一次具有1个核心、2 GB配置的5个容器实例。每个实例的持续时间为10分钟(600秒)。Fargate不提供1个vCPU / 1GB的组合。1个vCPU容器的最低容量为2GB。</p><p id="2baf" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">以美元/月计算的费用如下:<br/> <strong class="je ig"> Azure容器实例:</strong>$ 3.75<br/><strong class="je ig">AWS Fargate</strong>:1.90美元</p><p id="bb3d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以在我为这篇文章准备的Google表单中看到上面例子的计算。请随意使用它来为您自己的用例进行价格比较。</p><div class="ht hu fm fo hv ng"><a href="https://docs.google.com/spreadsheets/d/1bsqd5DilkARPjLRhzMU_4xfNm3sQIfHs1FnDobNpLvU/edit?usp=sharing" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab ej"><div class="ni ab nj cl cj nk"><h2 class="bd ig fv z el nl eo ep nm er et ie dt translated">Azure容器实例和AWS Fargate成本比较</h2><div class="nn l"><h3 class="bd b fv z el nl eo ep nm er et ek translated">Sheet1示例您在一个月(30天)内每天创建一次具有1个核心、2 GB配置的5个容器实例…</h3></div><div class="no l"><p class="bd b gc z el nl eo ep nm er et ek translated">docs.google.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu ib ng"/></div></div></a></div><p id="375f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">注意</strong>:该计算仅考虑给定服务的定价，并将Azure内核视为与AWS vCPU相同。此外，AWS会提示您添加其他付费服务，如负载平衡器，以“完成该包”。</p><h1 id="5b18" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="73cb" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">深入比较一下，我认为这两种服务非常相似。他们不是。在目前的版本中，这两种产品都有非常不同的用例。</p><p id="fe72" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Azure容器实例几乎就像Requestbin或JsFiddle一样。一个快速简单的沙箱，用于运行具有类似Heroku行为的容器:一个bash命令，你的容器就在线了。实际上我很喜欢这样:我从来没有以如此快的方式向互联网发布过容器。可能比使用Ngrok等服务的本地Docker实例还要快。我可以想象自己在原型制作过程中，在与客户远程合作时，或者当我需要在聚会或会议上展示快速演示时使用它。</p><p id="4a7a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正如AWS所描述的，Fargate是ECS和后来的EKS的一项技术。这意味着它位于DC/OS和Kubernetes空间中，并具有该特性集。如前所述，你不会每天都使用 Fargate。它在后台负责管理您的ECS群集。</p><p id="7a47" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> Azure容器实例摘要</strong></p><ul class=""><li id="ad4a" class="ls lt if je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">Azure生态系统中看似独立的解决方案。</li><li id="b241" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">10秒，不存在的设置。</li><li id="1c29" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">比如容器的超轻版Heroku或者JsFiddle。</li></ul><p id="6bcc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> AWS Fargate摘要</strong></p><ul class=""><li id="e4e3" class="ls lt if je b jf jg jj jk jn lu jr lv jv lw jz lx ly lz ma dt translated">几乎在任何地方都集成到现有的AWS和ECS生态系统中。</li><li id="f756" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">开始时令人困惑和麻烦。</li><li id="101e" class="ls lt if je b jf mb jj mc jn md jr me jv mf jz lx ly lz ma dt translated">将完全支持大型的真实世界部署。</li></ul></div><div class="ab cl nv nw hc nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="hn ho hp hq hr"><p id="73e0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mw"> Tim是</em><a class="ae ka" href="https://vamp.io," rel="noopener ugc nofollow" target="_blank"><em class="mw">https://vamp . io</em></a><em class="mw">的产品倡导者，这是一款为现代云平台发布的智能&amp;无压力应用。</em></p></div></div>    
</body>
</html>