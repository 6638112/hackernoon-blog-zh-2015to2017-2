<html>
<head>
<title>Racist Security with Clojure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Clojure的种族主义安全</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/racist-security-with-clojure-377c8362bbc7?source=collection_archive---------4-----------------------#2016-10-22">https://medium.com/hackernoon/racist-security-with-clojure-377c8362bbc7?source=collection_archive---------4-----------------------#2016-10-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b1a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你们中的许多人可能是基于标题的前半部分来到这里的，也许标题有点误导。抱歉，我可能引发了假警报，但这是一个技术职位！“为什么是种族主义者？”你问，多读点《真相》。</p><p id="1af8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Swym，我们有许多相互关联的系统。其中一些是公共的，一些是内部的，还有一些既有公共用途又有内部用途。对于公共接口点，带有角色授权策略的用户身份验证是首选解决方案。对于内部接口，访问被隐含地限制到网络的虚拟子网，依赖于网络防火墙策略。</p><p id="e69d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于公共内部接口，我们将API分为公共认证+授权、内部认证组。对于公开认证+授权，重用了角色授权策略的用户认证。公共组还包括无身份验证策略的匿名访问。我们使用了chummy auth库——friend(【https://github.com/cemerick/friend】)对超级用户访问做了一些调整。</p><p id="7769" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于内部认证组，有许多不同的策略可用。一些策略涉及共享访问令牌并验证它们。但这意味着令牌需要定期过期，进而需要令牌交换/刷新机制。我们可以为调用者系统创建一个用户。但它不是真正的用户，因为它可能会与公共认证+授权组混淆。感觉好像没有什么是直接简单的。或者我们可以直接说去你们的，把系统分成两部分——公共的和内部的。这就是我们的设计原则发挥作用的地方。在Swym，作为一个成长中的创业公司，资源远比黄金珍贵。换句话说，只有当我们真的，真的确信某样东西值得的时候，我们才会建造它。以下是我们对自己的约束:</p><ol class=""><li id="ebe3" class="jr js hu it b iu iv iy iz jc jt jg ju jk jv jo jw jx jy jz dt translated">只有一个节点/节点组应用于部署、监控等。</li><li id="e6b3" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">应该只运行一个API网关/服务器，即一个处理频繁的公共调用和不太频繁的内部调用的服务器进程</li><li id="9316" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated">内部身份验证不应干扰公共身份验证，因此网络防火墙策略将不起作用</li></ol><p id="48cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在所有这些都摆在我们面前之后，解决方案变得非常清晰。不错的IP白名单！(拜托，这听起来绝对是种族歧视，我使用这个标题是完全合理的:)我们开始搜索一个<a class="ae jq" href="https://hackernoon.com/tagged/clojure" rel="noopener ugc nofollow" target="_blank"> Clojure </a>库，因为它觉得我们遇到了一个相当普遍的需求，肯定有人在我们之前解决了这个问题。但是，没有，找不到。(如果有，请务必分享！)</p><p id="28d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们最终在Clojure的ring web框架上构建了一个小型轻量级中间件，以轻松地将IP白名单策略包装在API组周围。这是代码:</p><figure class="kf kg kh ki fq kj"><div class="bz el l di"><div class="kk kl l"/></div></figure><p id="60d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">目前，中间件支持允许的IP地址的CSV和“开发”环境的直通。它是作为一个gist托管的，还不认为是一个clojar库容器。它可以很容易地在一个API组中使用，例如为ring定义的defroutes。</p><p id="1891" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请随意使用代码。请评论你对IP白名单的喜爱(或厌恶)。</p></div><div class="ab cl km kn hc ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hn ho hp hq hr"><p id="edf6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在标题。为什么是种族歧视？很明显，不是吗？允许加入白名单。黑名单被禁。即使颜色颠倒了，听起来还是有点种族歧视，不是吗？:P</p><figure class="kf kg kh ki fq kj fe ff paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="fe ff kt"><img src="../Images/3aa6d93e73f11eff0bf664df9fc6b091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p4d9RsDh-fpAhnHpgQiAJQ.png"/></div></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">Colors! (Ref: <a class="ae jq" href="https://www.w3.org/TR/SVG/types.html#ColorKeywords" rel="noopener ugc nofollow" target="_blank">https://www.w3.org/TR/SVG/types.html#ColorKeywords</a>)</figcaption></figure><p id="2464" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从所有这些颜色中，随便挑两种。想象一下，如果我们有木瓜酱和西红柿。听起来没那么种族歧视，对吧？随便说说。(不幸的是，Peachpuff和Papayawhiff看起来非常相似)</p><p id="425c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">页（page的缩写）s:其他有争议但不那么尖锐的标题创意——彩色<a class="ae jq" href="https://hackernoon.com/tagged/security" rel="noopener ugc nofollow" target="_blank">安全</a>，黑白安全。</p><div class="kf kg kh ki fq ab cb"><figure class="le kj lf lg lh li lj paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="le kj lf lg lh li lj paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="le kj lf lg lh li lj paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="lk ll lm"><p id="f922" class="ir is jp it b iu iv iw ix iy iz ja jb ln jd je jf lo jh ji jj lp jl jm jn jo hn dt translated"><a class="ae jq" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jq" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jq" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jq" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is jp it b iu iv iw ix iy iz ja jb ln jd je jf lo jh ji jj lp jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jq" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jq" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kf kg kh ki fq kj fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff lq"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure><figure class="kf kg kh ki fq kj"><div class="bz el l di"><div class="lr kl l"/></div></figure></div></div>    
</body>
</html>