<html>
<head>
<title>NPM as a build tool for a Python Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NPM作为Python项目的构建工具</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-i-used-npm-to-setup-a-python-project-dac33f0c7997?source=collection_archive---------12-----------------------#2017-12-26">https://medium.com/hackernoon/how-i-used-npm-to-setup-a-python-project-dac33f0c7997?source=collection_archive---------12-----------------------#2017-12-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="15ac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">听起来很疯狂，不是吗？</p><p id="26d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不要误解我。Python是一种强大的语言。我喜欢python。但我总觉得python少了点什么。<em class="jq">就像你从未约会过的漂亮女孩</em>。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff jr"><img src="../Images/0897733cc2c3f311a063cc3e36f34753.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/0*AE1NGN53Lppish6D.gif"/></div></figure><p id="1c9e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我看来，</p><blockquote class="jz"><p id="73ef" class="ka kb hu bd kc kd ke kf kg kh ki jo ek translated">与使用NodeJs和npm的项目相比，为一个中型到大型的Python项目设置工作环境真的非常非常困难！！！</p></blockquote></div><div class="ab cl kj kk hc kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hn ho hp hq hr"><p id="e6f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们通过几种方法来使用npm来帮助python解决这个问题。</p><h1 id="59df" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">1.执行脚本</h1><p id="5eeb" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">每个NodeJs项目都有一个<code class="eh lt lu lv lw b"><strong class="it hv">package.json</strong></code>文件。您可以在一个文件中定义从版本到依赖项到脚本再到自定义配置的所有内容。运行脚本非常简单，</p><pre class="js jt ju jv fq lx lw ly lz aw ma dt"><span id="2ac3" class="mb kr hu lw b fv mc md l me mf">npm run &lt;script-name&gt;</span></pre><p id="b7cb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将跳过npm的细节。你可以在scotch.io文章中读到更多关于npm的力量。</p><blockquote class="mg mh mi"><p id="9161" class="ir is jq it b iu iv iw ix iy iz ja jb mj jd je jf mk jh ji jj ml jl jm jn jo hn dt translated">这与Python相比如何？</p></blockquote><p id="5d65" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">python中设置项目的一个标准选项是setuptools包。基本的元数据配置，如名称、版本和作者都是无关紧要的。它还提供了许多复杂的选项，如<code class="eh lt lu lv lw b">cmdclass</code>和<code class="eh lt lu lv lw b">scripts</code>。但是即使是一个简单的动作，比如删除一些自动生成的文件，也是非常困难的。</p><p id="a34e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">比方说，在运行测试套件之后，您需要删除<code class="eh lt lu lv lw b">coverage/</code>目录中的所有文件。在python中，如果您想自动化这项任务，您需要做几件事情。</p><ol class=""><li id="fa63" class="mm mn hu it b iu iv iy iz jc mo jg mp jk mq jo mr ms mt mu dt translated">在<code class="eh lt lu lv lw b">setup.py</code>(使用<code class="eh lt lu lv lw b">setuptools</code>的地方)的<code class="eh lt lu lv lw b">cmdclass</code>下增加一个条目</li><li id="74b1" class="mm mn hu it b iu mv iy mw jc mx jg my jk mz jo mr ms mt mu dt translated">编写一个新的Python类来扩展<code class="eh lt lu lv lw b">distutils.command</code>基类</li><li id="c69f" class="mm mn hu it b iu mv iy mw jc mx jg my jk mz jo mr ms mt mu dt translated">编写一个python代码，该代码将使用<code class="eh lt lu lv lw b">subprocess.Popen</code>来执行所需的命令。</li></ol><p id="9b11" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">与在<code class="eh lt lu lv lw b">package.json</code>文件中添加一行条目<code class="eh lt lu lv lw b">"clean_cov": "rm -rf coverage/*"</code>相比，这是一项繁重的工作。这里的另一个好处是，您可以将npm命令链接起来以耦合任务。</p><pre class="js jt ju jv fq lx lw ly lz aw ma dt"><span id="1b4e" class="mb kr hu lw b fv mc md l me mf">"clean_cov": "rm -rf coverage/*",<br/>"test": "<!-- -->python setup.py test<!-- -->",<br/>"test_and_clean": "npm run test &amp;&amp; npm run clean_cov"</span></pre><p id="8ae8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您还可以添加<code class="eh lt lu lv lw b">pre</code>和<code class="eh lt lu lv lw b">post</code>脚本来定义流程。这样，上面的代码可以写成:</p><pre class="js jt ju jv fq lx lw ly lz aw ma dt"><span id="9ac9" class="mb kr hu lw b fv mc md l me mf">"test": "<!-- -->python setup.py test<!-- -->",<br/>"posttest": "rm -rf coverage/*",</span></pre><p id="df7f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另一方面，我对将一些构建命令集成到项目的源代码中感到不舒服。</p><h1 id="8840" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">2.配置git挂钩</h1><p id="179d" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">我个人认为预提交和预推送git挂钩是git存储库的重要元素。这些无名英雄避免了对存储库的意外提交，这有助于用干净的提交维护干净的存储库。</p><p id="6836" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我正在做的项目中，我们计划有对应于以下检查的钩子。</p><ol class=""><li id="0e6a" class="mm mn hu it b iu iv iy iz jc mo jg mp jk mq jo mr ms mt mu dt translated">运行pylint检查并评估目标文件的pylint分数</li><li id="f863" class="mm mn hu it b iu mv iy mw jc mx jg my jk mz jo mr ms mt mu dt translated">运行pytest并确保所有测试都通过</li><li id="e821" class="mm mn hu it b iu mv iy mw jc mx jg my jk mz jo mr ms mt mu dt translated">避免提交来控制和开发分支</li><li id="8970" class="mm mn hu it b iu mv iy mw jc mx jg my jk mz jo mr ms mt mu dt translated">确保没有被禁止的词语</li><li id="90ef" class="mm mn hu it b iu mv iy mw jc mx jg my jk mz jo mr ms mt mu dt translated">创建一个源代码发行版，并确保没有构建错误</li></ol><p id="7e16" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那只是其中的5个，还有更多支票。显然，手动运行这些检查是不可取的。所以我需要配置钩子。</p><p id="a506" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我找到了几个pip包，包括<a class="ae jp" href="https://github.com/sebdah/git-pylint-commit-hook" rel="noopener ugc nofollow" target="_blank"> git-pylint-hook </a>、<a class="ae jp" href="https://pypi.python.org/pypi/git-pre-push-hook" rel="noopener ugc nofollow" target="_blank"> git-pre-push-hook </a>和<a class="ae jp" href="http://pre-commit.com/#python" rel="noopener ugc nofollow" target="_blank"> pre-commit </a>，它们似乎都做了我想要的事情。但是我能找到的库都没有合适的文档。定制插件就像一场噩梦。</p><blockquote class="jz"><p id="7928" class="ka kb hu bd kc kd ke kf kg kh ki jo ek translated">我甚至觉得手动编写几个shell脚本比找到合适的python插件更容易。</p></blockquote></div><div class="ab cl kj kk hc kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hn ho hp hq hr"><p id="95bd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt na translated">现在让我们看看如何在有一个<code class="eh lt lu lv lw b">package.json</code>文件的情况下实现这一点。</p><p id="9de4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我为这个作业找到了这些<a class="ae jp" href="https://www.npmjs.com/package/pre-commit" rel="noopener ugc nofollow" target="_blank">预提交</a>和<a class="ae jp" href="https://www.npmjs.com/package/pre-push" rel="noopener ugc nofollow" target="_blank">预推送</a>库。因为我在包中已经有了运行上述检查的定制脚本，所以我所要做的就是安装库并将相关条目添加到<code class="eh lt lu lv lw b">package.json</code>文件中。例如，我有如下配置的预推挂钩，</p><pre class="js jt ju jv fq lx lw ly lz aw ma dt"><span id="2294" class="mb kr hu lw b fv mc md l me mf">"pre-push": [<br/>    "git-branch",<br/>    "forbidden-words",<br/>    "pylint",<br/>    "test",<br/>    "build"<br/>]</span></pre><p id="f5c1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这很简单，对吧？？？。我还应该在这里强调一下，<code class="eh lt lu lv lw b">pre</code>和<code class="eh lt lu lv lw b">post</code>脚本也可以在这里工作。然而，对于我们的项目，我们更喜欢显式地指定检查。</p><p id="7f94" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在配置这些钩子时，我发现了一个有趣的库，那就是lint-staged库。我建议你也看一看。</p><h1 id="b360" class="kq kr hu bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">3.观看模式</h1><p id="f260" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">为了解释我为什么需要这个特性，我应该首先提到我正在使用intelliJ PyCharm作为编写python代码的IDE。pycharm中缺少的一个特性是IDE中关于pylint问题的实时反馈，我希望在不久的将来能看到这个特性。比如<a class="ae jp" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> eslint </a> &amp; <a class="ae jp" href="https://github.com/facebook/flow" rel="noopener ugc nofollow" target="_blank"> flow </a>与Webstorm无缝集成。</p><p id="d03a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在他们将该特性添加到pycharm之前，我的最佳选择是将pylint配置为外部插件，并在更新python文件之前手动运行它。</p><p id="317e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，随着我的救世主<code class="eh lt lu lv lw b">package.json</code>的出现，这变得容易多了。<a class="ae jp" href="https://www.npmjs.com/package/npm-watch" rel="noopener ugc nofollow" target="_blank"> npm-watch </a>库(和其他类似的库)为我们提供了观察给定目录中特定文件类型的变化，然后执行npm脚本的选项。</p><p id="db60" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如，每当一个<code class="eh lt lu lv lw b">.py</code>改变时，我们可以有一个如下的条目来运行pylint。</p><pre class="js jt ju jv fq lx lw ly lz aw ma dt"><span id="f7e6" class="mb kr hu lw b fv mc md l me mf">"watch": {<br/>  "pylint": {<br/>    "patterns": [<br/>      "app/**/*",<br/>      "utils/**/*"<br/>    ],<br/>    "extensions": "py",<br/>    "quiet": <strong class="lw hv">true<br/>  </strong>}<br/>}</span></pre></div><div class="ab cl kj kk hc kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hn ho hp hq hr"><h1 id="4378" class="kq kr hu bd ks kt nj kv kw kx nk kz la lb nl ld le lf nm lh li lj nn ll lm ln dt translated">最后的想法</h1><p id="222f" class="pw-post-body-paragraph ir is hu it b iu lo iw ix iy lp ja jb jc lq je jf jg lr ji jj jk ls jm jn jo hn dt translated">虽然我真的很喜欢在python项目回购中拥有一个<code class="eh lt lu lv lw b">package.json</code>文件，但我对这种方法的反馈褒贬不一。一些开发人员认为这种方法不是pythonic式的。</p><p id="6951" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我个人并没有发现它不是<strong class="it hv">python化</strong>的问题，因为我相信工程师应该是<a class="ae jp" href="https://hackernoon.com/tagged/technology" rel="noopener ugc nofollow" target="_blank">技术</a>不可知论者，并且所有这些语言仅仅是完成一些工作的工具。尽管如此，为了尊重所有团队成员的需求，我在没有使用npm的情况下配置了本报告中提到的所有基本内容。我的下一篇文章可能会以那次经历为基础。</p><h2 id="98d1" class="mb kr hu bd ks no np nq kw nr ns nt la jc nu nv le jg nw nx li jk ny nz lm oa dt translated">你觉得这种方法怎么样？</h2><h2 id="763b" class="mb kr hu bd ks no np nq kw nr ns nt la jc nu nv le jg nw nx li jk ny nz lm oa dt translated">你有别的pythonic替代品吗？</h2><h2 id="12c7" class="mb kr hu bd ks no np nq kw nr ns nt la jc nu nv le jg nw nx li jk ny nz lm oa dt translated">请随意给我和所有其他读者一个评论！！！</h2><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ob oc l"/></div></figure></div></div>    
</body>
</html>