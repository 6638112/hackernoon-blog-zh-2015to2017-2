<html>
<head>
<title>sWrapping up APIs with PromiseKit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用PromiseKit包装API</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/wrapping-up-apis-with-promisekit-d1302f446ad6?source=collection_archive---------18-----------------------#2017-11-13">https://medium.com/hackernoon/wrapping-up-apis-with-promisekit-d1302f446ad6?source=collection_archive---------18-----------------------#2017-11-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="8c4f" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">实际上，我只是想和你分享一些代码片段</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/c9d91c86a6441ea86b41de03973e8e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rwJBXtKMQFcv73_hgIvsCg.jpeg"/></div></div></figure><p id="575e" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">对承诺感到陌生，如何在iOS开发中使用它们？那么请随意阅读我之前写的关于这个主题的简短介绍:<a class="ae kr" href="https://hackernoon.com/promise-pattern-on-swift-with-promisekit-620efad7a5bd" rel="noopener ugc nofollow" target="_blank">https://hacker noon . com/promise-pattern-on-swift-with-promise kit-620 efad 7 a5 BD</a></p><p id="7985" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">承诺很有趣，我发誓！</p></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><p id="a777" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">在我的上一篇文章中，我展示了一些例子，告诉你如何将异步呼叫金字塔转化为更有组织的承诺链，如下所示:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="kz la l"/></div></figure><p id="2904" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">更重要的是，在不改变原始API实现的情况下将它们打包，最终得到如下结果:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="kz la l"/></div></figure><p id="a5a3" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">上面的<a class="ae kr" href="https://hackernoon.com/tagged/implementation" rel="noopener ugc nofollow" target="_blank">实现</a>是通过创建一个可重用的包装器<a class="ae kr" href="https://hackernoon.com/tagged/function" rel="noopener ugc nofollow" target="_blank">函数</a>来实现的，它提供了处理异步回调时所需的闭包:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="kz la l"/></div></figure><p id="c840" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">包装器函数<em class="lb">保存了对完成块的引用，您可以将完成块赋予您的异步调用，然后返回给您一个</em><strong class="jx hv"><em class="lb">Promise</em></strong><em class="lb">对象，您可以改为监听</em>。下面是我们的自定义包装器的更详细的实现:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="kz la l"/></div></figure><p id="37bb" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">考虑到这一点，我们来看看在我们的代码中还能怎么整理~</p><h2 id="a99d" class="lc ld hu bd le lf lg lh li lj lk ll lm ke ln lo lp ki lq lr ls km lt lu lv lw dt translated"><strong class="ak">让第三方参与你的流程</strong></h2><p id="63a9" class="pw-post-body-paragraph jv jw hu jx b jy lx iv ka kb ly iy kd ke lz kg kh ki ma kk kl km mb ko kp kq hn dt translated">社交媒体登录在应用程序设计中很常见，甚至是我们大多数应用程序的主要用户需求。正因为如此，脸书SDK的<em class="lb"> LoginManager </em>和<em class="lb"> GraphAPI </em>是我们非常熟悉的两个<em class="lb"> </em>库，它们经常是我们架构的一部分。</p><p id="da36" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">第三方SDK之所以简洁，有几个原因:</p><ol class=""><li id="53e2" class="mc md hu jx b jy jz kb kc ke me ki mf km mg kq mh mi mj mk dt translated">当你不需要重新发明轮子的时候，节省你和你的团队很多时间。</li><li id="59b7" class="mc md hu jx b jy ml kb mm ke mn ki mo km mp kq mh mi mj mk dt translated">可靠的第三方意味着他们能够很好地维护和测试他们的代码。</li><li id="a1c6" class="mc md hu jx b jy ml kb mm ke mn ki mo km mp kq mh mi mj mk dt translated">成千上万人使用的公共图书馆意味着问题更容易被发现和解决。</li></ol><p id="508e" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">当然，它们也有一些缺点，尤其是:</p><ol class=""><li id="047c" class="mc md hu jx b jy jz kb kc ke me ki mf km mg kq mh mi mj mk dt translated">SDK通常很大。这么多东西你往往不需要看。</li><li id="ea54" class="mc md hu jx b jy ml kb mm ke mn ki mo km mp kq mh mi mj mk dt translated">他们的设计也经常与你的团队不同。做好抽象的准备。</li></ol><p id="2974" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">脸书SDK也不例外。在这个非常特殊的案例中，我们将研究如何将脸书API调用集成到我们的承诺链中。</p><h2 id="a6c7" class="lc ld hu bd le lf lg lh li lj lk ll lm ke ln lo lp ki lq lr ls km lt lu lv lw dt translated">API示例:FB LoginManager</h2><p id="97b5" class="pw-post-body-paragraph jv jw hu jx b jy lx iv ka kb ly iy kd ke lz kg kh ki ma kk kl km mb ko kp kq hn dt translated">让脸书成为应用程序社交平台的是LoginManager。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="kz la l"/></div></figure><p id="cfc4" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">但是它有自己的异步回调可能会给你的数据流带来一些问题，特别是当你已经通过承诺设计好的时候。让我们看看它的“完成”回调，看看我们如何为它设计一个包装器。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="kz la l"/></div></figure><p id="3486" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">这里我们想要的是能够替换完成闭包'<strong class="jx hv"> ((LoginResult) - &gt; Void)？= nil' </strong>,其中一个来自我们的包装函数。</p><p id="e00f" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">首先，让我们声明我们的新包装器，它采用一个参数类型与登录完成相同的完成块:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="kz la l"/></div></figure><p id="6c5e" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">接下来，让我们通过使用完成块参数来触发Promise的fulfil()和reject()来准备Promise对象。现在，让我们继续返回结果承诺，当然是使用LoginResult的成功对象类型。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="kz la l"/></div></figure><p id="bd33" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">当这些都很好地完成后，您应该能够像这样链接您的脸书登录调用:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="kz la l"/></div><figcaption class="mq mr fg fe ff ms mt bd b be z ek">Voila, no need to reimplement anything. Just wrap them up :D</figcaption></figure><h2 id="06af" class="lc ld hu bd le lf lg lh li lj lk ll lm ke ln lo lp ki lq lr ls km lt lu lv lw dt translated">下一步是什么？</h2><p id="7e21" class="pw-post-body-paragraph jv jw hu jx b jy lx iv ka kb ly iy kd ke lz kg kh ki ma kk kl km mb ko kp kq hn dt translated">构建了这么多Restful应用程序后，我和我的团队已经习惯了一有机会就用PromiseKit组织和链接异步调用。</p><p id="1b97" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">根据我们在这里学到的知识，我鼓励你也仔细检查你的代码库，找出那些讨厌的异步调用金字塔，并找到一个清理它们的好方法。</p><p id="98a1" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">祝你好运！</p></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><h1 id="4d0e" class="mu ld hu bd le mv mw mx li my mz na lm ja nb jb lp jd nc je ls jg nd jh lv ne dt translated">你大老远跑来了！</h1><blockquote class="nf"><p id="804e" class="ng nh hu bd ni nj nk nl nm nn no kq ek translated">我希望当你打开这篇文章的时候，你已经得到了你想要的东西。如果是这样，如果你能把这个推荐给你的朋友^^，我将非常感激</p></blockquote><p id="d77f" class="pw-post-body-paragraph jv jw hu jx b jy np iv ka kb nq iy kd ke nr kg kh ki ns kk kl km nt ko kp kq hn dt translated">如果您还有任何问题/反馈，请随时留言<a class="ae kr" href="https://twitter.com/raymundcat" rel="noopener ugc nofollow" target="_blank"/>！</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="nu la l"/></div></figure></div></div>    
</body>
</html>