<html>
<head>
<title>Encoding the Python Source Code File</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编码Python源代码文件</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/encoding-the-python-source-code-file-445722836813?source=collection_archive---------4-----------------------#2017-09-02">https://medium.com/hackernoon/encoding-the-python-source-code-file-445722836813?source=collection_archive---------4-----------------------#2017-09-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="7d35" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">GitHub上大约有<a class="ae jp" href="https://github.com/search?l=Python&amp;q=coding&amp;type=Code&amp;utf8=%E2%9C%93" rel="noopener ugc nofollow" target="_blank">1500万行</a>Python代码，以一种形式的变体开始:<code class="eh jq jr js jt b"># -*- coding:&lt;some encoding&gt; -*-</code>。对于任何学习Python的人来说，这似乎是另一个单行的“注释”。当我开始用Python编程时，我确实是这样看的。然而，我很快意识到，这里面有一些神秘和深奥的东西。这是某种被所有代码库的Python开发者使用的<strong class="it hv"> <em class="ju">特殊注释</em> </strong>。在本文中，我将尝试分解这行代码背后的概念。</p><h1 id="c419" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">我们的工具包</h1><p id="def9" class="pw-post-body-paragraph ir is hu it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hn dt translated"><strong class="it hv"> ASCII: </strong>一个字符集，使用32到127之间的数字来表示内存中每一个好的旧的无重音英文字母。字母“A”由65代表，而32代表一个“空格”。</p><p id="4c5c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Unicode:  Unicode是一个勇敢的努力，它创造了一个单一的字符集，包括了地球上所有合理的书写系统，也包括一些像克林贡语一样的虚构系统。在Unicode中，一个字母映射到一个叫做<em class="ju">代码点</em>的东西，这仍然只是一个理论概念。</p><p id="5e44" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> UTF-8: </strong>这是一种处理字符存储问题的编码。在UTF-8中，从0到127的每个代码点都存储在单个字节中<em class="ju">。只有128及以上的代码点使用2，3，事实上，多达6个字节存储。这有一个很好的副作用，即英语文本在UTF-8中看起来和在ASCII中完全一样。</em></p><blockquote class="ky"><p id="df48" class="kz la hu bd lb lc ld le lf lg lh jo ek translated"><strong class="ak">在不知道字符串使用什么编码的情况下拥有它是没有意义的</strong>。—乔尔·斯波尔斯基</p></blockquote><p id="2d77" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated"><strong class="it hv">TL；DR——如果你有一个字符串，在内存或文件中，你必须知道它是什么编码，否则你不能正确地解释它或显示给用户。</strong></p><h1 id="0d59" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">源代码文件编码</h1><p id="e7e6" class="pw-post-body-paragraph ir is hu it b iu kt iw ix iy ku ja jb jc kv je jf jg kw ji jj jk kx jm jn jo hn dt translated">每当您需要在定义文字时输入任何非ASCII字符，即不能通过ASCII码<br/>表示的字符(例如，带重音的英文字母、希腊符号)，Python解释器不知道使用何种编码来表示该字符。因此，定义编码增强了源代码中Unicode字面量的解释，并使得在Unicode感知编辑器中直接使用例如UTF-8来编写Unicode字面量成为可能。这就是我们的<strong class="it hv"> <em class="ju">特别评论</em> </strong>进入画面的地方！</p><blockquote class="ln lo lp"><p id="5e6c" class="ir is ju it b iu iv iw ix iy iz ja jb lq jd je jf lr jh ji jj ls jl jm jn jo hn dt translated">如果Python脚本的第一行或第二行中的一个注释与正则表达式<code class="eh jq jr js jt b"><em class="hu">coding[=:]\s*([-\w.]+)</em></code>匹配，这个注释将被处理为一个<strong class="it hv">编码声明</strong>；这个表达式的第一组命名源代码文件的编码。编码声明必须单独占一行。如果是第二行，第一行也必须是注释专用行。</p></blockquote><p id="4f3d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，只要正则表达式匹配，编码语句的所有变体都有效。参考<a class="ae jp" href="https://www.python.org/dev/peps/pep-0263/" rel="noopener ugc nofollow" target="_blank"> PEP 263 </a>获取示例。</p><p id="6c89" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注意</strong>:从Python 3.0开始，如果没有找到编码声明，默认编码是UTF-8。</p><h1 id="1e5e" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">说够了，给我看看代码</h1><figure class="lt lu lv lw fq lx"><div class="bz el l di"><div class="ly lz l"/></div></figure><p id="6a93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将使用上述文件中代码的一些变体来理解文件中编码的重要性。所以，我建议你复制并保存这个Python文件。进行下面描述的实验，并尝试推理你的观察。</p><ol class=""><li id="b71a" class="ma mb hu it b iu iv iy iz jc mc jg md jk me jo mf mg mh mi dt translated"><strong class="it hv">实验01: </strong>使用Python2解释器运行这个文件。</li><li id="95a1" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated"><strong class="it hv">实验02: </strong>使用Python3解释器运行这个文件。</li><li id="c5dd" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated"><strong class="it hv">实验03: </strong>去掉L01(读第1行)。使用Python2解释器运行更新的文件。</li><li id="d9d9" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated"><strong class="it hv">实验04: </strong>去掉L01(读第1行)。使用Python3解释器运行更新的文件。</li></ol><h2 id="df9c" class="mo jw hu bd jx mp mq mr kb ms mt mu kf jc mv mw kj jg mx my kn jk mz na kr nb dt translated">观察</h2><ol class=""><li id="0ae8" class="ma mb hu it b iu kt iy ku jc nc jg nd jk ne jo mf mg mh mi dt translated"><strong class="it hv">实验01:</strong>unicode字符串“表示”中非ASCII字符的<em class="ju">码位</em>。</li><li id="9fd9" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated"><strong class="it hv">实验02: </strong> <a class="ae jp" href="https://stackoverflow.com/a/26125214/4927751" rel="noopener ugc nofollow" target="_blank">原因</a>为<strong class="it hv"> </strong> <code class="eh jq jr js jt b">AttributeError<br/></code> <strong class="it hv">加成:</strong>用<code class="eh jq jr js jt b">encode</code>代替<code class="eh jq jr js jt b">decode</code>修改L03并执行文件。</li><li id="a130" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated"><strong class="it hv">实验03: </strong>似乎很有道理，不是吗？</li><li id="3d9e" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated"><strong class="it hv">实验04: </strong>不是所有的观察结果都和实验02的一样吗？</li></ol><p id="ffb5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你在理解这些观察时仍然有困难，或者我可能跳过了一些重要的观察，请在评论中告诉我。</p><h1 id="81b2" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">吸取的教训</h1><ul class=""><li id="e05a" class="ma mb hu it b iu kt iy ku jc nc jg nd jk ne jo nf mg mh mi dt translated">如果您打算使用UTF-8编码只编写Python3特定的代码，就不需要使用这一行。</li><li id="0e24" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo nf mg mh mi dt translated">在所有其他情况下，建议在Python文件的顶部提及编码。这有两个好处:<br/> 1。在你的代码中显式。Python2和Python3之间的兼容性</li></ul><h1 id="3474" class="jv jw hu bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">参考</h1><ol class=""><li id="b78f" class="ma mb hu it b iu kt iy ku jc nc jg nd jk ne jo mf mg mh mi dt translated"><a class="ae jp" href="https://www.python.org/dev/peps/pep-0263/" rel="noopener ugc nofollow" target="_blank">人教版263 </a></li><li id="d29e" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated"><a class="ae jp" href="https://www.python.org/dev/peps/pep-3120/" rel="noopener ugc nofollow" target="_blank"> PEP 3120 </a></li><li id="7102" class="ma mb hu it b iu mj iy mk jc ml jg mm jk mn jo mf mg mh mi dt translated"><a class="ae jp" href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/" rel="noopener ugc nofollow" target="_blank">绝对最低限度每个软件开发人员绝对、绝对必须了解Unicode和字符集(没有借口！)</a></li></ol></div></div>    
</body>
</html>