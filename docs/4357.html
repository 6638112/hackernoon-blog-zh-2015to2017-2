<html>
<head>
<title>Create directive for showing error message in form with Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建在带角度的表单中显示错误消息的指令</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/create-reuseable-validation-directive-in-angualr-2-dcb0b0df2ce8?source=collection_archive---------0-----------------------#2017-05-27">https://medium.com/hackernoon/create-reuseable-validation-directive-in-angualr-2-dcb0b0df2ce8?source=collection_archive---------0-----------------------#2017-05-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/c3c37f9c19734131c814986337382850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oJXbimEmVYcS4AM8WLQpFg.jpeg"/></div></div></figure><p id="f09a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">表单和验证是网站的基础。Angular提供了一种简单方法来处理表单中的验证，但是我们仍然可以用指令来简化更多的验证工作。</p><p id="e420" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这篇文章中，我将向你展示如何轻松地显示没有*ngIf和长表达式的验证错误消息。</p><p id="7104" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我假设你已经熟悉了Angular，如果你不知道的话，我建议你读一下这些主题。</p><ul class=""><li id="349a" class="ka kb hu je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated"><a class="ae kj" href="https://angular.io/docs/ts/latest/guide/structural-directives.html" rel="noopener ugc nofollow" target="_blank">结构指令</a></li><li id="67db" class="ka kb hu je b jf kk jj kl jn km jr kn jv ko jz kf kg kh ki dt translated"><a class="ae kj" href="https://toddmotto.com/angular-2-forms-reactive" rel="noopener ugc nofollow" target="_blank">反应形式</a></li></ul><h2 id="4a17" class="kp kq hu bd kr ks kt ku kv kw kx ky kz jn la lb lc jr ld le lf jv lg lh li lj dt translated"><strong class="ak">验证中的问题。</strong></h2><p id="b3d6" class="pw-post-body-paragraph jc jd hu je b jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv lo jx jy jz hn dt translated">向用户显示消息会使我们的代码看起来很难看。例如</p><p id="26a5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="lp">在添加验证消息之前</em></p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="lu lv l"/></div></figure><p id="0ad7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="lp">添加验证信息后</em></p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="lu lv l"/></div></figure><p id="0366" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">呃。现在太乱了。😵</p><p id="976f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以我试图用指令魔法来消除重复的代码。这是我的成就。</p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="lu lv l"/></div></figure><p id="6940" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">看起来干净多了。😻</p><p id="e170" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是通过两条指令实现的。<strong class="je hv">无效消息</strong>和<strong class="je hv">无效类型。</strong></p><h1 id="443e" class="lw kq hu bd kr lx ly lz kv ma mb mc kz md me mf lc mg mh mi lf mj mk ml li mm dt translated"><strong class="ak">无效消息指令</strong></h1><p id="c71e" class="pw-post-body-paragraph jc jd hu je b jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv lo jx jy jz hn dt translated"><strong class="je hv"> invalidmessage </strong>指令通过名称接收表单控件，并根据表单控件的错误设置托管元素的可见性。</p><p id="a951" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是<strong class="je hv"> invalidmessage </strong>指令的代码。</p><p id="6ad3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">别担心，我很快会解释代码。</p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="lu lv l"/></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek"><strong class="ak">invalidmessage </strong>directive</figcaption></figure><p id="5903" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，我从最近的父注入器(在上面的例子中是<code class="eh mr ms mt mu b">myForm</code>)注入<code class="eh mr ms mt mu b">ControlContainer</code>来获取<code class="eh mr ms mt mu b">Formgroup</code>实例。</p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="lu lv l"/></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">get FormGroup with getter(excerpt from <strong class="ak">invalidmessage </strong>directive)</figcaption></figure><p id="d03c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们可以很容易地通过名字来控制(例如，<code class="eh mr ms mt mu b">this.form.get('yourcontrolname')</code>)。😎</p><p id="11fb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">FormControl实例可以获取值、错误等。实际上这只是你在反应形态中使用的形态控制。例如，<code class="eh mr ms mt mu b">this.myform.get('name');</code></p><p id="2dc5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我创建了<code class="eh mr ms mt mu b">setVisible()</code>方法，用于在控件有效时设置托管元素visble，在无效时隐藏。</p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="lu lv l"/></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">set visble based on control error (excerpt from <strong class="ak">invalidmessage </strong>directive)</figcaption></figure><p id="f3fb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一开始显示错误信息是很糟糕的(很多用户体验网站都这么说)，所以如果它只是在用户与控件交互或点击提交按钮时显示，会让用户不那么生气。我用上面的<code class="eh mr ms mt mu b">this.control.dirty</code>和<code class="eh mr ms mt mu b">this.hasSubmitted</code>来检查。</p><p id="8cea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">setVisible()</code>当控件的值被更改并且用户单击提交按钮时，将调用方法。</p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="lu lv l"/></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">setVisible will be caledd when controlValue$ emit (excerpt from <strong class="ak">invalidmessage </strong>directive)</figcaption></figure><p id="5bc8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="lp">通知</em> <code class="eh mr ms mt mu b"><em class="lp">Observable.of</em></code> <em class="lp">，它会立即发出，所以</em> <code class="eh mr ms mt mu b"><em class="lp">setVisible()</em></code> <em class="lp">会在初始时被调用。</em></p><p id="a3c4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">提交表单时发出的<code class="eh mr ms mt mu b">formSubmit$</code>是可观察的。它会将<code class="eh mr ms mt mu b">hasSubmitted</code>设置为<code class="eh mr ms mt mu b">true</code>。</p><p id="9fc6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> invalidmessage </strong>为<strong class="je hv"> invalidType </strong>指令提供<code class="eh mr ms mt mu b">match</code>方法，以调用检查是否匹配控件的错误类型。</p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="lu lv l"/></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">match take argument which it’s error type and check if control has that error or not(excerpt from <strong class="ak">invalidmessage </strong>directive)</figcaption></figure><p id="4e70" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">this.control.errors</code>是属性名为错误类型的对象。比如说，表单控件需要电子邮件验证，而用户破坏了它。<em class="lp">form control</em>T5】对象会这样。</p><pre class="lq lr ls lt fq mv mu mw mx aw my dt"><span id="9902" class="kp kq hu mu b fv mz na l nb nc">{<br/>   required:true,<br/>   email:true<br/>}</span></pre><p id="ed9e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您将在下一节看到如何使用它。</p><h1 id="931a" class="lw kq hu bd kr lx ly lz kv ma mb mc kz md me mf lc mg mh mi lf mj mk ml li mm dt translated">无效的类型指令</h1><p id="2cbf" class="pw-post-body-paragraph jc jd hu je b jf lk jh ji jj ll jl jm jn lm jp jq jr ln jt ju jv lo jx jy jz hn dt translated">该指令用于根据<strong class="je hv"> invalidmessage指令中定义的控件的错误类型设置主机元素的可见性。</strong></p><p id="0248" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在上面的例子中，你可能注意到了<code class="eh mr ms mt mu b"><strong class="je hv">*invalidmessage</strong></code> <strong class="je hv"> </strong>。有星号前缀。它叫做<a class="ae kj" href="https://angular.io/docs/ts/latest/guide/structural-directives.html" rel="noopener ugc nofollow" target="_blank">结构指令。</a>简而言之，Stuctural指令将在主机元素周围创建<code class="eh mr ms mt mu b">ng-template</code>,使得主机元素直到你用<code class="eh mr ms mt mu b">ViewContainerRef</code>显式渲染后才会被渲染</p><p id="05ae" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让代码自己解释</p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="lu lv l"/></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek"><strong class="ak">invalidType </strong>directive set visible error message based on control error</figcaption></figure><p id="1ffc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">该指令被注入了3个依赖项——<strong class="je hv">InvalidmessageDirective</strong>、<strong class="je hv"> TemplateRef </strong>和<strong class="je hv"> ViewContainerRef </strong>。</p><p id="bb02" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> TemplateRef </strong>和<strong class="je hv"> ViewContainerRef </strong>用于创建和移除主机元素(这是错误消息)。</p><p id="7191" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">的角度注入实例InvalidmessageDirective </strong>离父注入器最近。</p><pre class="lq lr ls lt fq mv mu mw mx aw my dt"><span id="7917" class="kp kq hu mu b fv mz na l nb nc">&lt;div invalidmessage="name"&gt;<br/>        &lt;p *invalidType="'required'"&gt;Please provide name&lt;/p&gt;</span><span id="e81f" class="kp kq hu mu b fv nd na l nb nc">&lt;/div&gt;</span></pre><p id="2b8e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> InvalidTypeDirective </strong>在<code class="eh mr ms mt mu b">&lt;p&gt;</code>上，通过在invalidTypeDirective 中注入<strong class="je hv"> InvalidmessageDirective，可以得到<strong class="je hv">invalid message directive(</strong>在<code class="eh mr ms mt mu b">&lt;div&gt;</code>上)的实例。</strong></p><p id="8f1a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以<strong class="je hv"> invalidType </strong>指令可以使用<strong class="je hv"> invalidmessage指令</strong>实例<strong class="je hv">的属性和方法。</strong></p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="lu lv l"/></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">setVisible() for set visible of host element based on invaludmessage’s match medthod (excerpt from <strong class="ak">invalidType </strong>directive)</figcaption></figure><p id="3bb6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> invalidmessage的match </strong>方法通过参数获取错误类型(用<code class="eh mr ms mt mu b">type</code>属性定义)并检查错误对象是否具有指定的错误类型。</p><p id="05ca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果<strong class="je hv"> invalidmessage的匹配</strong>返回true，<em class="lp">视图容器</em>将从<code class="eh mr ms mt mu b">TemplateRef</code>创建视图(它是<code class="eh mr ms mt mu b">ng-template</code>围绕的托管元素)，并且<em class="lp">视图容器</em>将在它为false时清除。通俗地说，<strong class="je hv"> invalidType </strong>指令根据<strong class="je hv"> invalidmessage的match </strong>方法的返回值显示和移除主机元素。</p><p id="9d2e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="lp">需要通过检查</em> <code class="eh mr ms mt mu b"><em class="lp">hasView</em></code> <em class="lp">属性来检查视图容器是否还没有创建，这样就不会重复创建。</em></p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="lu lv l"/></div><figcaption class="mn mo fg fe ff mp mq bd b be z ek">setVisible() is called when invalidmessage’s controlValue$ emit (excerpt from <strong class="ak">invalidType </strong>directive)</figcaption></figure><p id="11af" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mr ms mt mu b">setVisible()</code> <em class="lp"> </em>在<strong class="je hv"> invalidmessage的controlValue$ </strong>发出时调用(控件值改变，用户点击提交按钮)。</p><p id="42a8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">仅此而已。这两条指令可以简化我们的表单验证。它也许并不完美，但它可以给你一个想法。</p><p id="4e0a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您有任何问题或建议，请在下面评论。</p><p id="8649" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是扑通一声</p><div class="ne nf fm fo ng nh"><a href="https://plnkr.co/edit/JIwB1WeftdEfa0G2vRze" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab ej"><div class="nj ab nk cl cj nl"><h2 class="bd hv fv z el nm eo ep nn er et ht dt translated">扑通一声</h2><div class="no l"><h3 class="bd b fv z el nm eo ep nn er et ek translated">Plunker是一个在线社区，用于创建、协作和分享您的web开发想法。</h3></div><div class="np l"><p class="bd b gc z el nm eo ep nn er et ek translated">plnkr.co</p></div></div></div></a></div><p id="103d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="lp">如果你喜欢这个帖子，请留下一个喜欢的</em> ❤️ <em class="lp">并关注我在</em> <a class="ae kj" rel="noopener" href="/@Elec_crafter"> <em class="lp">中</em> </a> <em class="lp">或</em> <a class="ae kj" href="https://twitter.com/Elec_crafter" rel="noopener ugc nofollow" target="_blank"> <em class="lp">推特</em> </a> <em class="lp">上阅读更多关于Angular、Javascript等内容。</em></p><div class="lq lr ls lt fq ab cb"><figure class="nq iv nr ns nt nu nv paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nq iv nr ns nt nu nv paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nq iv nr ns nt nu nv paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nw nx ny"><p id="f922" class="jc jd lp je b jf jg jh ji jj jk jl jm nz jo jp jq oa js jt ju ob jw jx jy jz hn dt translated"><a class="ae kj" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kj" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kj" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kj" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd lp je b jf jg jh ji jj jk jl jm nz jo jp jq oa js jt ju ob jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kj" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kj" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff oc"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>