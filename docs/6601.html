<html>
<head>
<title>Hiding API fields dynamically — Laravel 5.5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">动态隐藏API字段— Laravel 5.5</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/hiding-api-fields-dynamically-laravel-5-5-82744f1dd15a?source=collection_archive---------10-----------------------#2017-09-26">https://medium.com/hackernoon/hiding-api-fields-dynamically-laravel-5-5-82744f1dd15a?source=collection_archive---------10-----------------------#2017-09-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/3a8ae1a0eb3544cf8c78537c40e17ff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5qJzCXwT-aVhf0aZff3pQ.png"/></div></div></figure><p id="0daa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我最近在Laravel Brasil社区上看到一个<a class="ae ka" href="https://github.com/laravelbrasil/forum/issues/140" rel="noopener ugc nofollow" target="_blank">问题</a>，这个问题比看起来有趣多了。假设您有一个具有以下实现的<code class="eh kb kc kd ke b">UsersResource</code>:</p><figure class="kf kg kh ki fq iv"><div class="bz el l di"><div class="kj kk l"/></div></figure><p id="3475" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">出于某种原因，您可能希望在另一个端点上重用该资源类，但是隐藏email字段。这篇文章是如何实现这一目标的方法。</p><p id="1b10" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您不知道什么是API资源，可以查看我以前关于这个主题的文章。</p><ul class=""><li id="ac71" class="kl km hu je b jf jg jj jk jn kn jr ko jv kp jz kq kr ks kt dt translated"><a class="ae ka" href="https://hackernoon.com/first-impressions-on-laravel-api-resources-4869b73b7847" rel="noopener ugc nofollow" target="_blank">对API资源的第一印象</a></li><li id="cca6" class="kl km hu je b jf ku jj kv jn kw jr kx jv ky jz kq kr ks kt dt translated"><a class="ae ka" href="https://hackernoon.com/reusable-api-resource-with-nested-relationship-laravel-5-5-c654c7243869" rel="noopener ugc nofollow" target="_blank">具有嵌套关系的API资源</a></li></ul><h2 id="8f63" class="kz la hu bd lb lc ld le lf lg lh li lj jn lk ll lm jr ln lo lp jv lq lr ls lt dt translated">1-设置项目</h2><p id="dd8b" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">有趣的事情从第三节开始。 </p><pre class="kf kg kh ki fq ma ke mb mc aw md dt"><span id="f079" class="kz la hu ke b fv me mf l mg mh">composer create-project --prefer-dist laravel/laravel api-fields<br/>cd api-fields<br/>touch database/database.sqlite</span></pre><p id="1ee8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">编辑您的<code class="eh kb kc kd ke b">.env</code>文件以删除数据库设置并使用SQLite</p><pre class="kf kg kh ki fq ma ke mb mc aw md dt"><span id="3ef6" class="kz la hu ke b fv me mf l mg mh">DB_CONNECTION=sqlite</span></pre><p id="b8ad" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">继续设置项目</p><pre class="kf kg kh ki fq ma ke mb mc aw md dt"><span id="3c76" class="kz la hu ke b fv me mf l mg mh">php artisan migrate<br/>php artisan make:resource UsersResource<br/>php artisan make:resource --collection UsersResourceCollection <br/>php artisan make:controller UsersController<br/>php artisan tinker<br/>factory(App\User::class)-&gt;times(20)-&gt;create();<br/>quit</span></pre><h2 id="2000" class="kz la hu bd lb lc ld le lf lg lh li lj jn lk ll lm jr ln lo lp jv lq lr ls lt dt translated">2-路线</h2><p id="43c8" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">确保在<code class="eh kb kc kd ke b">api.php</code>文件中创建一条路线。</p><pre class="kf kg kh ki fq ma ke mb mc aw md dt"><span id="91ef" class="kz la hu ke b fv me mf l mg mh">Route::<em class="lz">apiResource</em>('/users', 'UsersController');</span></pre><h2 id="b80f" class="kz la hu bd lb lc ld le lf lg lh li lj jn lk ll lm jr ln lo lp jv lq lr ls lt dt translated">3-控制器</h2><p id="ba96" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">控制器代表期望的目标。在这个例子中，我们假设在清单中我们只想要所有用户的名字，而在显示中我们只想要隐藏电子邮件地址。</p><figure class="kf kg kh ki fq iv"><div class="bz el l di"><div class="kj kk l"/></div></figure><p id="d9c2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了实现这一点，我们需要我们的<code class="eh kb kc kd ke b">UsersResourceCollection</code>和<code class="eh kb kc kd ke b">UsersResource</code>都知道如何处理<code class="eh kb kc kd ke b">hide</code>呼叫。</p><h2 id="2d18" class="kz la hu bd lb lc ld le lf lg lh li lj jn lk ll lm jr ln lo lp jv lq lr ls lt dt translated">4-用户资源类</h2><p id="143b" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">先说<code class="eh kb kc kd ke b">show</code>法。<code class="eh kb kc kd ke b">UsersResource::make</code>将返回一个<code class="eh kb kc kd ke b">UsersResource</code>的对象。因此，我们应该公开一个方法<code class="eh kb kc kd ke b">hide</code>,该方法存储需要从响应中删除的键。</p><figure class="kf kg kh ki fq iv"><div class="bz el l di"><div class="kj kk l"/></div></figure><p id="85e8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">搞定了。此时，我们应该能够在没有<code class="eh kb kc kd ke b">id</code>字段的情况下访问<code class="eh kb kc kd ke b">http://api.dev/api/users/1</code>和阿瑟响应。</p><pre class="kf kg kh ki fq ma ke mb mc aw md dt"><span id="ff00" class="kz la hu ke b fv me mf l mg mh">{<br/> "data": {<br/>  "name": "Mr. Frederik Morar",<br/>  "email": "<a class="ae ka" href="mailto:darryl.wilkinson@example.org" rel="noopener ugc nofollow" target="_blank">darryl.wilkinson@example.org</a>"<br/> }<br/>}</span></pre><h2 id="b3bb" class="kz la hu bd lb lc ld le lf lg lh li lj jn lk ll lm jr ln lo lp jv lq lr ls lt dt translated">UsersResourceCollection类</h2><p id="0ed6" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">对于使用<code class="eh kb kc kd ke b">index</code>方法的项目集合，我们需要执行一些更改:</p><ul class=""><li id="11c8" class="kl km hu je b jf jg jj jk jn kn jr ko jv kp jz kq kr ks kt dt translated">(1)确保<code class="eh kb kc kd ke b">UsersResource::collection</code>返回<code class="eh kb kc kd ke b">UsersResourceCollection</code>的实例</li><li id="c6a5" class="kl km hu je b jf ku jj kv jn kw jr kx jv ky jz kq kr ks kt dt translated">(2)在<code class="eh kb kc kd ke b">UsersResourceCollection</code>上暴露<code class="eh kb kc kd ke b">hide</code>方法</li><li id="d18a" class="kl km hu je b jf ku jj kv jn kw jr kx jv ky jz kq kr ks kt dt translated">(3)将隐藏字段传递到<code class="eh kb kc kd ke b">UsersResource</code></li></ul><p id="bc3a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于(1)，我们只需要覆盖<code class="eh kb kc kd ke b">UsersResource</code>上的<code class="eh kb kc kd ke b">collection</code>方法</p><figure class="kf kg kh ki fq iv"><div class="bz el l di"><div class="kj kk l"/></div></figure><p id="40c6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于(2)和(3)，我们需要改变<code class="eh kb kc kd ke b">UsersResourceCollection</code>文件。让我们公开<code class="eh kb kc kd ke b">hide</code>方法并用隐藏字段处理集合。</p><figure class="kf kg kh ki fq iv"><div class="bz el l di"><div class="kj kk l"/></div></figure><p id="89bf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">就是这样！现在，如果我们调用<code class="eh kb kc kd ke b">http://api.dev/api/users</code>，我们可以看到一个没有像指定的<code class="eh kb kc kd ke b">UsersController</code>那样的<code class="eh kb kc kd ke b">id</code>和<code class="eh kb kc kd ke b">email</code>字段的响应。</p><pre class="kf kg kh ki fq ma ke mb mc aw md dt"><span id="f11a" class="kz la hu ke b fv me mf l mg mh">{<br/> "data": [{<br/>  "name": "Mr. Frederik Morar"<br/> }, {<br/>  "name": "Angel Daniel"<br/> }, {<br/>  "name": "Brianne Mueller"<br/> }],<br/> "links": {<br/>  "first": "<a class="ae ka" href="http://lab.php71/api-fields-2/public/api/users?page=1" rel="noopener ugc nofollow" target="_blank">http://lab.php71/api-fields-2/public/api/users?page=1</a>",<br/>  "last": "<a class="ae ka" href="http://lab.php71/api-fields-2/public/api/users?page=7" rel="noopener ugc nofollow" target="_blank">http://lab.php71/api-fields-2/public/api/users?page=7</a>",<br/>  "prev": null,<br/>  "next": "<a class="ae ka" href="http://lab.php71/api-fields-2/public/api/users?page=2" rel="noopener ugc nofollow" target="_blank">http://lab.php71/api-fields-2/public/api/users?page=2</a>"<br/> },<br/> "meta": {<br/>  "current_page": 1,<br/>  "from": 1,<br/>  "last_page": 7,<br/>  "path": "<a class="ae ka" href="http://lab.php71/api-fields-2/public/api/users" rel="noopener ugc nofollow" target="_blank">http://api-fields.lab.php71/api/users</a>",<br/>  "per_page": 3,<br/>  "to": 3,<br/>  "total": 20<br/> }<br/>}</span></pre><h2 id="c694" class="kz la hu bd lb lc ld le lf lg lh li lj jn lk ll lm jr ln lo lp jv lq lr ls lt dt translated">6-结论</h2><p id="d64a" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">目标是通过允许隐藏另一个端点可能暴露的一些字段，使<code class="eh kb kc kd ke b">Resource</code>类稍微灵活一些。这种实现的一个实际例子是不包含<code class="eh kb kc kd ke b">avatar</code>属性的<code class="eh kb kc kd ke b">/users</code>端点，但是当通过<code class="eh kb kc kd ke b">/users/99</code>请求特定用户时，我们可能希望在响应中包含<code class="eh kb kc kd ke b">avatar</code>。</p><p id="430a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我不建议过多地重用API资源，因为这很容易增加本应简单的层的复杂性。也就是说，考虑到实现的简单性，隐藏列表请求和特定记录之间的某些特定字段看起来确实是一个合理的请求。</p><h2 id="69f6" class="kz la hu bd lb lc ld le lf lg lh li lj jn lk ll lm jr ln lo lp jv lq lr ls lt dt translated">7-接下来是什么</h2><p id="f051" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">在下一篇文章中，我将尝试将<code class="eh kb kc kd ke b">hide</code>方法提取到一个特征中，并使它在所有API资源中可重用。请在Medium上关注我，敬请关注！</p></div></div>    
</body>
</html>