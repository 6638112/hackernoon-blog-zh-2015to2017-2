<html>
<head>
<title>SSH tunnels multiplexing and bastions oh my!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">宋承宪隧道复用和堡垒哦，我的天！</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/ssh-tunnels-multiplexing-and-bastions-oh-my-2e6c8dfc4491?source=collection_archive---------4-----------------------#2017-08-05">https://medium.com/hackernoon/ssh-tunnels-multiplexing-and-bastions-oh-my-2e6c8dfc4491?source=collection_archive---------4-----------------------#2017-08-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/8f3fda0d6065f846f39675ae3e661875.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*3gZgpoEqAIlAO8MV-1XL-Q.png"/></div></figure><p id="3966" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我整天都在用ssh。但通常是相当标准的登录、共享密钥和进入我的tmux会话。其他时候，它使用保存的命令打开一个隧道，并做一些端口转发。今天和前几天，我已经开始填充一些零碎的东西来真正配置ssh。我想更多地使用ansible来使我的生活更轻松，这当然会在很大程度上利用ssh来完成工作。</p><p id="b39b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> SSH配置—隧道！<br/> </strong>我把这个很长的命令字符串粘贴到一个shell中。这是一个麻烦，但我把它连接到阿尔弗雷德，所以这不是什么大不了的事。我有一种感觉，在不久的将来，我连接到alfred的许多命令也将成为可翻译的剧本或任务。然而，这是以后的话题。让我们在这里使用我的ssh隧道命令</p><blockquote class="jw jx jy"><p id="27ac" class="iy iz jz ja b jb jc jd je jf jg jh ji ka jk jl jm kb jo jp jq kc js jt ju jv hn dt translated"><em class="hu">ssh-L 9906:10 . 0 . 0 . 1:3306-L 9907:10 . 0 . 0 . 1:3307-L 9909:10 . 0 . 0 . 4:3309</em><a class="ae kd" href="mailto:coolio@database.example.com" rel="noopener ugc nofollow" target="_blank">T6】coolio@database.example.com</a><em class="hu">-p 4444</em></p></blockquote><p id="d9c4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">然后，通过配置，它被截短为<em class="jz"> ssh隧道接口</em>，或者更进一步，只为带有-N的端口连接它，并以-f <em class="jz"> ssh -f -N隧道接口</em>作为背景</p><blockquote class="jw jx jy"><p id="ddca" class="iy iz jz ja b jb jc jd je jf jg jh ji ka jk jl jm kb jo jp jq kc js jt ju jv hn dt translated">-N不要执行远程命令。这对于转发端口非常有用。<br/> -f请求ssh在命令执行之前进入后台。</p></blockquote><p id="46e5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">那么ssh配置如下所示</p><blockquote class="jw jx jy"><p id="2673" class="iy iz jz ja b jb jc jd je jf jg jh ji ka jk jl jm kb jo jp jq kc js jt ju jv hn dt translated">主机隧道接口<br/>主机名database.example.com<br/>端口4444 <br/>标识文件~/。ssh/coolio . example . key<br/>local forward 9906 10 . 0 . 0 . 1:3306<br/>local forward 9907 10 . 0 . 0 . 1:3307<br/>local forward 9909 10 . 0 . 0 . 4:3309<br/>用户库里奥</p></blockquote><div class="ke kf fm fo kg kh"><a href="http://nerderati.com/2011/03/17/simplify-your-life-with-an-ssh-config-file/" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab ej"><div class="kj ab kk cl cj kl"><h2 class="bd hv fv z el km eo ep kn er et ht dt translated">使用SSH配置文件简化您的生活</h2><div class="ko l"><h3 class="bd b fv z el km eo ep kn er et ek translated">如果你和我一样，你可能会登录和退出半打远程服务器(或者这些天，本地虚拟…</h3></div><div class="kp l"><p class="bd b gc z el km eo ep kn er et ek translated">nerderati.com</p></div></div></div></a></div><p id="7be6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">复用</strong> <br/>多一个不如多一个。接下来，我想加快我的ssh会话，因为越快越好。确保ssh复用不会存活太久。10分钟和持续多路复用之间有很大区别。这个连接也将被用作堡垒主机，因此使用多路传输是一个很好的例子。这是通过controlMaster和controlPersist参数完成的。现在ssh配置看起来有点长了。</p><blockquote class="jw jx jy"><p id="6b07" class="iy iz jz ja b jb jc jd je jf jg jh ji ka jk jl jm kb jo jp jq kc js jt ju jv hn dt translated">主机隧道接口<br/>主机名database.example.com<br/>端口4444 <br/>标识文件~/。ssh/coolio . example . key<br/>control master auto<br/>control persist 10m<br/>local forward 9906 10 . 0 . 0 . 1:3306<br/>local forward 9907 10 . 0 . 0 . 1:3307<br/>local forward 9909 10 . 0 . 0 . 4:3309<br/>用户库里奥</p></blockquote><div class="ke kf fm fo kg kh"><a href="http://blog.scottlowe.org/2015/12/11/using-ssh-multiplexing/" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab ej"><div class="kj ab kk cl cj kl"><h2 class="bd hv fv z el km eo ep kn er et ht dt translated">使用SSH多路复用— Scott的博客—专门从事虚拟化的IT专家的博客…</h2><div class="ko l"><h3 class="bd b fv z el km eo ep kn er et ek translated">在这篇文章中，我将讨论如何配置和使用SSH多路复用。这是安全的另一个方面…</h3></div><div class="kp l"><p class="bd b gc z el km eo ep kn er et ek translated">blog.scottlowe.org</p></div></div><div class="kq l"><div class="kr l ks kt ku kq kv iw kh"/></div></div></a></div><p id="fbbc" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">堡垒</strong> <br/>名词:设防。壁垒或防御工事的突出部分。<br/>我使用这台主机进行两种不同的访问。第一个是带有tmux和活动会话的pivot box，这让我的生活变得有点懒散，因为我不需要每次登录时都启动所有的连接。然而，另一种不同的方法是像使用堡垒服务器一样使用它，在本地假脱机这些连接，然后通过主机建立隧道。不同任务的不同用例。无论哪种方式，它都允许所有ssh连接通过这个端口，因此我在防火墙上打开的端口较少。开放的端口越少越好。棘手的部分是在配置中重用bastion条目，然后将正确的键链接到正确的位置。很像面向对象编程，但是从配置的角度来看。<br/>我的配置现在变成了这样。</p><blockquote class="jw jx jy"><p id="83e6" class="iy iz jz ja b jb jc jd je jf jg jh ji ka jk jl jm kb jo jp jq kc js jt ju jv hn dt translated">主机堡垒<br/>身份文件~/。ssh/id_rsa</p><p id="2bef" class="iy iz jz ja b jb jc jd je jf jg jh ji ka jk jl jm kb jo jp jq kc js jt ju jv hn dt translated">主机内部测试<br/>标识文件~/。ssh/internal _ key<br/>proxy命令ssh User 1 @ bastion-p 3322-W 10 . 0 . 0 . 1:22<br/>用户user2</p></blockquote><p id="d80a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我可以通过bastion主机连接到内部主机，就像这样<em class="jz"> ssh内部测试</em> <br/>我们将重用bastion节中的ssh密钥，然后bastion节将使用内部密钥和user2连接到内部测试。我知道这可能看起来有点混乱，但只要仔细想想，它会有意义的，我保证。</p><p id="2dfa" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">结束。<br/> </strong>就是这样！这是我周六早上通过一些ssh的旅程。感谢以前写过这方面文章的人们，我试着引用了我读过的所有关于这方面的文章</p><p id="a87c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">链接链接</p><div class="ke kf fm fo kg kh"><a href="http://nerderati.com/2011/03/17/simplify-your-life-with-an-ssh-config-file/" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab ej"><div class="kj ab kk cl cj kl"><h2 class="bd hv fv z el km eo ep kn er et ht dt translated">使用SSH配置文件简化您的生活</h2><div class="ko l"><h3 class="bd b fv z el km eo ep kn er et ek translated">如果你和我一样，你可能会登录和退出半打远程服务器(或者这些天，本地虚拟…</h3></div><div class="kp l"><p class="bd b gc z el km eo ep kn er et ek translated">nerderati.com</p></div></div></div></a></div><div class="ke kf fm fo kg kh"><a href="http://blog.scottlowe.org/2015/12/11/using-ssh-multiplexing/" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab ej"><div class="kj ab kk cl cj kl"><h2 class="bd hv fv z el km eo ep kn er et ht dt translated">使用SSH多路复用— Scott的博客—专门从事虚拟化的IT专家的博客…</h2><div class="ko l"><h3 class="bd b fv z el km eo ep kn er et ek translated">在这篇文章中，我将讨论如何配置和使用SSH多路复用。这是安全的另一个方面…</h3></div><div class="kp l"><p class="bd b gc z el km eo ep kn er et ek translated">blog.scottlowe.org</p></div></div><div class="kq l"><div class="kr l ks kt ku kq kv iw kh"/></div></div></a></div><div class="ke kf fm fo kg kh"><a href="https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Multiplexing" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab ej"><div class="kj ab kk cl cj kl"><h2 class="bd hv fv z el km eo ep kn er et ht dt translated">OpenSSH/Cookbook/Multiplexing—Wikibooks，开放世界的开放书籍</h2><div class="ko l"><h3 class="bd b fv z el km eo ep kn er et ek translated">SSH多路复用的一个优点是消除了创建新TCP连接的开销。总的来说…</h3></div><div class="kp l"><p class="bd b gc z el km eo ep kn er et ek translated">en.wikibooks.org</p></div></div></div></a></div><p id="c5ac" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><a class="ae kd" href="http://blog.scottlowe.org/2015/11/21/using-ssh-bastion-host/" rel="noopener ugc nofollow" target="_blank">http://blog.scottlowe.org/2015/11/21/using-ssh-bastion-host</a></p><div class="ke kf fm fo kg kh"><a href="https://man.openbsd.org/ssh" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab ej"><div class="kj ab kk cl cj kl"><h2 class="bd hv fv z el km eo ep kn er et ht dt translated">ssh(1) — OpenBSD手册页</h2><div class="ko l"><h3 class="bd b fv z el km eo ep kn er et ek translated">编辑描述</h3></div><div class="kp l"><p class="bd b gc z el km eo ep kn er et ek translated">man.openbsd.org</p></div></div></div></a></div><div class="ke kf fm fo kg kh"><a href="https://www.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab ej"><div class="kj ab kk cl cj kl"><h2 class="bd hv fv z el km eo ep kn er et ht dt translated">ssh(1)</h2><div class="ko l"><h3 class="bd b fv z el km eo ep kn er et ek translated">SSH(1) FreeBSD通用命令手册SSH(1)名称ssh — OpenSSH SSH客户端(远程登录程序)简介ssh …</h3></div><div class="kp l"><p class="bd b gc z el km eo ep kn er et ek translated">www.freebsd.org</p></div></div></div></a></div></div></div>    
</body>
</html>