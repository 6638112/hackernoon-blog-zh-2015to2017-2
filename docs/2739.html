<html>
<head>
<title>Diving into Android Things</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一头扎进安卓系统</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/diving-into-android-things-d46bf3d6fb92?source=collection_archive---------10-----------------------#2017-02-15">https://medium.com/hackernoon/diving-into-android-things-d46bf3d6fb92?source=collection_archive---------10-----------------------#2017-02-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="c224" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从十几岁开始，我就一直在摆弄电子产品。我上学，毕业时获得了计算机工程学位，重点是硬件(嵌入式系统、ASIC设计等)。我不知何故跌倒了...毕业后就进入了软件行业，一晃9年过去了，我现在是<a class="ae jp" href="http://radiopublic.com" rel="noopener ugc nofollow" target="_blank">无线电台</a>的一名<a class="ae jp" href="https://hackernoon.com/tagged/android" rel="noopener ugc nofollow" target="_blank"> Android </a>开发人员。当<a class="ae jp" href="https://hackernoon.com/tagged/google" rel="noopener ugc nofollow" target="_blank">谷歌</a>在2016年末宣布他们的物联网平台<a class="ae jp" href="https://developer.android.com/things/index.html" rel="noopener ugc nofollow" target="_blank"> Android Things </a>时，我兴奋不已，因为这给了我一个理由来打破我的旧试验板、电阻器、led和电源调节器。这也给了我一个买树莓派的理由。有了Android Things，我终于能够在一个更嵌入式(坦白说，更有趣)的平台上利用我在Android开发方面的专业知识。</p><p id="636f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我不打算在这里讨论太多的Android基础知识，因为很多优秀的开发者已经在这方面做得很好了:</p><ul class=""><li id="028d" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated"><a class="ae jp" href="https://riggaroo.co.za/android-things-hardware-basics/" rel="noopener ugc nofollow" target="_blank">安卓硬件基础知识</a>安卓GDE，丽贝卡·弗兰克斯</li><li id="1f5e" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated"><a class="ae jp" href="https://blog.mindorks.com/android-things-tutorials-getting-started-8464c11009ff#.29vvi2x82" rel="noopener ugc nofollow" target="_blank"> Android事物教程:入门</a>Android开发者Amit Shekhar</li><li id="eecb" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">安卓事物:电子101 由安卓工程师乔·伯奇负责</li></ul><p id="2820" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将分享一个我在2月10日星期五开始，2月13日星期一完成原型制作的项目。当探索新事物时，找到它的实际应用对我来说很重要。我拥有一栋建于90年代初的房子。从2017年开始，它可以使用一些自制的技术。我和我家其他成员有一个表面问题，那就是在车库里停车(正确并对齐)。要么我们把车停得离墙很近，不能绕过车的两边，要么我们不确定车是否会被车库门卡住。</p><h1 id="0e47" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">你好坎特帕克莱特</h1><p id="e9ca" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">我的第一个Android Things项目是建立一个辅助停车设备，它使用几个传感器来辅助司机在车库中正确停车。想想你进入洗车场时看到的信号。正常情况下，有两到三盏灯。当你第一次进入时，灯是绿色的，它指示你继续向前行驶。当你开得足够远时，红灯会提醒你停下来。我想把这个放在我的车库里。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/3c22809fe7bdd608aa2ff532f04ae3ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*8o3XfRDdd5bxyaW0.png"/></div><figcaption class="lp lq fg fe ff lr ls bd b be z ek">Image from Signal Tech</figcaption></figure><p id="3dc3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一步是原型化CantParkRight。</p><h1 id="f5f6" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">制作硬件原型</h1><p id="6833" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">类似Raspberry Pi的设备提供的一个巨大优势是能够快速、廉价地构建像我正在构建的这种辅助设备的原型。事实上，我可以正式利用Android APIs(以及谷歌API)是一个很大的优势。</p><p id="6ecd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我用于原型的材料包括:</p><ul class=""><li id="fbe2" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">树莓Pi模型3运行Android的东西预览1</li><li id="bc87" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">HC-SR04超声波接近传感器</li><li id="4e06" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">2个电阻，10KΩ和20KΩ</li><li id="c6d7" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">3个发光二极管(红色、黄色、绿色)</li><li id="dcde" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">一块试验板</li><li id="3759" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">跳线的分类</li></ul><p id="beda" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经有了大部分的补给。前段时间买了一个树莓Pi，最近从<a class="ae jp" href="https://www.amazon.com/HC-SR04-Ultrasonic-Distance-MEGA2560-ElecRight/dp/B01MA4O5G5/ref=sr_1_cc_1?s=aps&amp;ie=UTF8&amp;qid=1487174915&amp;sr=1-1-catcorr&amp;keywords=hc-sr04" rel="noopener ugc nofollow" target="_blank">亚马逊</a>买了一包5个HC-SR04超声波传感器。经过一番研究后，我选定了HC-SR04。HC-SR04的工作原理是，向TRIGGER引脚发送一个10 S(微秒)信号。在接下来的几毫秒内，HC-SR04会发出8个40KHz的声波，最终会反弹回来。如果一个物体在范围内，信号将反弹回来，并被传感器的接收器部分检测到。然后，HC-SR04向echo引脚连接的任何器件发送一个可变长度的ECHO。该脉冲的长度由信号返回传感器之前传播的距离决定。HC-SR04的射程约为400厘米(约13英尺)。完美。注:点击查看HC-SR04 <a class="ae jp" href="http://www.micropik.com/PDF/HCSR04.pdf" rel="noopener ugc nofollow" target="_blank">上的数据表。</a></p><p id="5a9d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">经过大量实验后，以下是我的电路在试验板上的布局。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff lt"><img src="../Images/aa723330ba492d0d2dff469f549cb702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*eBN5UensAp3rZujFrPS9AA.png"/></div><figcaption class="lp lq fg fe ff lr ls bd b be z ek">CantParkRight hardware schematic</figcaption></figure><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff lu"><img src="../Images/18411e0c21c7375a56aa3a2b43860e66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U_qdncFNNtxLAhPJNHqFzQ.jpeg"/></div></div><figcaption class="lp lq fg fe ff lr ls bd b be z ek">CantParkRight IRL, messy</figcaption></figure><p id="c414" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一些硬件问题:</p><ul class=""><li id="b1b8" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">传感器之间的精度差异很大，尤其是“山寨”传感器。在5个传感器中，一些传感器对物体运动更敏感，而另一些则变化较小。</li><li id="290e" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">发送到ECHO引脚的信号为5V。Raspberry Pi上的GPIO端口额定电压为3.3V。发送高电压可能会损坏它，因此我使用电阻将电压降至3.3V。</li></ul><h1 id="bb73" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">制作软件原型</h1><p id="f617" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">这个项目最好的部分是在Android Studio中编写软件，通过ADB(通过WiFi)部署它，并在我的眼前看到结果。我的实现基于:</p><ul class=""><li id="e0fb" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated"><a class="ae jp" href="https://hackernoon.com/android-things-basics-measure-distance-with-ultrasonic-sensor-3196fe5d7d7c#.fphbtwuy7" rel="noopener ugc nofollow" target="_blank">安卓事物基础:用超声波传感器测量距离</a>丹尼尔·达洛斯</li></ul><p id="58bc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本文中，Daniel使用while循环、回调和线程构建了几个实现，有些是同步的，有些是异步的。我决定以此为基础，但是使用RxJava来实现传感器数据的异步处理。我在自己开发的大多数Android应用程序中都使用过RxJava。它提供了快速方便的方法来构建、重用和排列逻辑片段，这些片段利用了从一端到另一端的数据流，基本上非常适合CantParkRight。</p><p id="689e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">声明:我不是RxJava专家。可能有更有效的方法来完成我使用RxJava所做的事情。</p><figure class="li lj lk ll fq lm"><div class="bz el l di"><div class="lz ma l"/></div></figure><p id="96de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关键是我如何启动触发器并等待回音。我的第一个实现使用了RxJava Observable，它本质上封装了一些While循环(查看我的存储库，然后转到第一次提交)。</p><p id="d85f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该过程是:</p><ul class=""><li id="639c" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">向触发器发送10秒信号</li><li id="e32a" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">开始一个while循环，一直执行到ECHO变高，记录开始时间</li><li id="c7f6" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">开始一个while循环，迭代直到回声变低，记录结束时间并计算用于计算距离的脉冲宽度</li></ul><p id="5314" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它有时会工作，但通常由于我仍在研究的原因，传感器会停止响应(即触发后回声从未变高)。当我使用GpioCallback时，情况得到了改善。GpioCallback允许你监听边沿触发(信号变高，信号变低，等等。)异步。我将GpioCallback的实现与RxJava Observable(更确切地说是发射器)结合起来。据我所知，发射器相对于使用普通可观察对象(使用Observable.create)的优势在于，它迫使您指定背压策略，这在读取从传感器推送的值时非常重要。CantParkRight使用缓冲背压模式。使用RxJava允许我启动距离检测过程，只需订阅正确的可观察值。当我在onDestroy(…)中取消订阅时，使用发射器还允许我用正确的代码取消注册我的GpioCallback。这可以防止将来的内存泄漏。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/ed85acde50e4c5f39aec1b66f56a8815.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/1*2V59LKGpbQL0LESZPTFMaA.gif"/></div><figcaption class="lp lq fg fe ff lr ls bd b be z ek">CantParkRight prototype in action</figcaption></figure><figure class="li lj lk ll fq lm"><div class="bz el l di"><div class="mc ma l"/></div></figure><h1 id="2205" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">下一步是什么</h1><p id="f386" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">对于CantParkRight，我正在努力打造一个可以轻松安装在车库里的实际设备。随着原型的完成，我开始努力去实现它。</p><p id="ab31" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">同时，你可以在GitHub 上查看<a class="ae jp" href="https://github.com/emuneee/cant-park-right" rel="noopener ugc nofollow" target="_blank"> CantParkRight的源代码。请务必在</a><a class="ae jp" href="http://twitter.com/emuneee" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或(咳嗽)<a class="ae jp" href="http://google.com/+EvanHalley" rel="noopener ugc nofollow" target="_blank"> Google+ </a>上关注我，了解CantParkRight的最新动态。我打算在接下来的几个月里在这里发布完成的项目，但是观看资源库是跟上进度的好方法。</p></div><div class="ab cl md me hc mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="hn ho hp hq hr"><p id="642b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="mk">原载于2017年2月15日</em><a class="ae jp" href="http://emuneee.com/blog/2017/02/15/diving-into-android-things/" rel="noopener ugc nofollow" target="_blank"><em class="mk">【emuneee.com】</em></a><em class="mk">。</em></p><div class="li lj lk ll fq ab cb"><figure class="ml lm mm mn mo mp mq paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ml lm mm mn mo mp mq paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ml lm mm mn mo mp mq paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mr ms mt"><p id="f922" class="ir is mk it b iu iv iw ix iy iz ja jb mu jd je jf mv jh ji jj mw jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is mk it b iu iv iw ix iy iz ja jb mu jd je jf mv jh ji jj mw jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff mx"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="li lj lk ll fq lm"><div class="bz el l di"><div class="my ma l"/></div></figure></div></div>    
</body>
</html>