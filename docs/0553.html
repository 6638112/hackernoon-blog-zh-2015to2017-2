<html>
<head>
<title>Speed Up Gradle Build In Android Studio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加速Android Studio中的Gradle构建</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/speed-up-gradle-build-in-android-studio-80a5f74ac9ed?source=collection_archive---------0-----------------------#2016-01-31">https://medium.com/hackernoon/speed-up-gradle-build-in-android-studio-80a5f74ac9ed?source=collection_archive---------0-----------------------#2016-01-31</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="c690" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有没有过这样的感觉:你在Android Studio中等待构建完成已经等了几分钟了？我也是。这是一个相当恼人的。</p><p id="bb14" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">幸运的是，有一些方法可以改善这种情况。Android使用<a class="ae jp" href="https://hackernoon.com/tagged/gradle" rel="noopener ugc nofollow" target="_blank"> Gradle </a>进行构建。最新版本是2.10，与之前的版本相比有巨大的性能提升(详见<a class="ae jp" href="https://docs.gradle.org/current/release-notes" rel="noopener ugc nofollow" target="_blank">发布说明</a>)。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/688e2da3686e0e9333370361a907a471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gImAplWne6yxtDytygjiYw.png"/></div></div></figure><h2 id="53dd" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">步骤1:更新Gradle版本</h2><p id="5d1c" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">更简单的方法是转到:<strong class="it hv">打开模块设置(您的项目)&gt;项目结构</strong></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lc"><img src="../Images/3d15f6936809a7c0caec93878e803512.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*Q1lDlH8CrHI_3FGdtZagpA.png"/></div></div></figure><p id="03b3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<strong class="it hv"> Gradle版本</strong>中输入2.10</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff ld"><img src="../Images/37fc1cf3c8d48e89d5b75000cbf29a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*SiGdDNBdLaDzezsAGM937A.png"/></div><figcaption class="le lf fg fe ff lg lh bd b be z ek">Changing the Gradle version in <strong class="bd li">Project Structure</strong> dialog</figcaption></figure><p id="9925" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从<a class="ae jp" href="https://services.gradle.org/distributions/gradle-2.10-all.zip" rel="noopener ugc nofollow" target="_blank">https://services . Gradle . org/distributions/Gradle-2.10-all . zip</a>下载Gradle Release distributive</p><p id="20eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并将其复制到Gradle文件夹:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/16934897a22f1791dc55e1d7ce012505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*8EB2RY8PGkNyT1L0XtKsyQ.png"/></div></figure><p id="afa1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后一步是在<strong class="it hv">设置&gt;等级</strong>中添加您的描述</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lk"><img src="../Images/733184332b0731be59fe963c5030fd92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYnnm5FrSKdHTdNmJMj9fg.png"/></div></div></figure><p id="e574" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不要忘记点击<strong class="it hv">应用</strong>保存更改<strong class="it hv">。</strong></p><h2 id="3ef7" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">步骤2:为项目启用离线模式、Gradle守护进程和并行构建</h2><p id="f23a" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">离线模式告诉Gradle忽略更新到最新的检查。Gradle每次都要求依赖关系，有了这个选项，它就可以使用机器上已经存在的依赖关系。</p><ol class=""><li id="2a2a" class="ll lm hu it b iu iv iy iz jc ln jg lo jk lp jo lq lr ls lt dt translated">从android studio <em class="lu">设置</em>进入<em class="lu"> Gradle </em>，点击<em class="lu">离线工作</em>框。</li></ol><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lv"><img src="../Images/db205b788b819ba31db026a81ceba249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pz69HEeD38Maldd-Q3RbsA.png"/></div></div></figure><p id="9b99" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.从android studio <em class="lu">设置</em>进入<em class="lu">编译器</em>，在命令行框中添加“—离线”，点击<em class="lu">并行编译独立模块</em>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff lw"><img src="../Images/1fb05d877b7e5c6293f262c40af27646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DLulMxChHQ5-TmvtflI5og.png"/></div></div><figcaption class="le lf fg fe ff lg lh bd b be z ek">Gradle options: Compiling in parallel and Offline mode</figcaption></figure><p id="d54b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下一步是为您的项目启用Gradle守护进程和并行构建。并行构建将导致您的具有多个模块的项目(Gradle中的多项目构建)并行构建，这应该会使大型或模块化项目构建得更快。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/af601c598510622f56c83e8b2a41dbc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*8HHt9vSu4TgT6VfTV9DvTg.png"/></div></figure><p id="683e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些设置可以通过修改Gradle scripts 目录(即<em class="lu"> ~/)中名为<em class="lu"> gradle.properties的文件来启用。gradle/gradle.properties </em>)。这些选项中的一些(例如并行编译模块)可以从Android Studio中获得，并且在默认情况下也是启用的，但是将它们放在<em class="lu"> gradle.properties </em>文件中将在从终端构建时启用它们，并且<strong class="it hv">确保您的同事将使用相同的设置</strong>。但是如果你在一个团队中工作，有时你不能承诺这些事情。</em></p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="7aad" class="kc kd hu lz b fv md me l mf mg"># When configured, Gradle will run in incubating parallel mode.<br/># This option should only be used with decoupled projects. More details, visit<br/><strong class="lz hv">org.gradle.parallel=true</strong></span><span id="6d19" class="kc kd hu lz b fv mh me l mf mg"># When set to true the Gradle daemon is used to run the build. For local developer builds this is our favorite property.<br/># The developer environment is optimized for speed and feedback so we nearly always run Gradle jobs with the daemon.<br/><strong class="lz hv">org.gradle.daemon=true</strong></span></pre><p id="d9d6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用守护程序将使你的构建启动更快，因为它不必每次都启动整个Gradle应用程序。Gradle守护进程在默认情况下是不启用的，但是建议总是为开发人员的机器启用它(但是为持续集成服务器禁用它)。关于这种模式的常见问题可以在这里找到<a class="ae jp" href="https://docs.gradle.org/current/userguide/gradle_daemon.html" rel="noopener ugc nofollow" target="_blank">https://docs . gradle . org/current/user guide/gradle _ daemon . html</a>。</p><p id="66f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于某些项目,“并行生成”设置可能不安全。要求是你的所有模块必须是<strong class="it hv">解耦的</strong>，否则你的构建可能会失败(详见<a class="ae jp" href="http://gradle.org/docs/current/userguide/multi_project_builds.html#sec:decoupled_projects" rel="noopener ugc nofollow" target="_blank">http://gradle . org/docs/current/user guide/multi _ project _ builds . html # sec:decoupled _ projects</a>)。</p><h2 id="b6e9" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">步骤3:启用增量设计并调整<em class="mi">内存设置</em></h2><p id="fbea" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">您可以通过打开增量德兴来加快构件的速度。在模块的构建文件中:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff mj"><img src="../Images/954c5da33d49ca0f98ca849b533de41f.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*U8x9cbiZ9lRI87FWRRjDZw.png"/></div></figure><p id="81da" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将此选项添加到您的<em class="lu"> android </em>模块:</p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="8484" class="kc kd hu lz b fv md me l mf mg">dexOptions {<br/>    incremental true<br/>}</span></pre><p id="305c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在dexOptions块中，您还可以指定dex进程堆大小，例如:</p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="cd8f" class="kc kd hu lz b fv md me l mf mg">dexOptions {<br/>    incremental true<br/>    javaMaxHeapSize "12g"<br/>}</span></pre><p id="89e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其中“12g”是12GB的内存。关于这一点的更多信息可以在这里找到<a class="ae jp" href="http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.DexOptions.html#com.android.build.gradle.internal.dsl.DexOptions:javaMaxHeapSize" rel="noopener ugc nofollow" target="_blank">google.github.io/android-gradle-dsl/current/</a></p><p id="d99d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您还可以在设置文件中配置Gradle参数，例如，如果您有一个大型项目，可以增加最大堆大小:</p><pre class="jr js jt ju fq ly lz ma mb aw mc dt"><span id="8ae3" class="kc kd hu lz b fv md me l mf mg"><em class="lu"># Specifies the JVM arguments used for the daemon process.<br/># The setting is particularly useful for tweaking memory settings.<br/># Default value: -Xmx10248m -XX:MaxPermSize=256m<br/></em><strong class="lz hv"><em class="lu">org.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</em></strong></span></pre><p id="aac6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所有参数列表见此:<a class="ae jp" href="https://docs.gradle.org/current/userguide/userguide_single.html#sec:gradle_configuration_properties" rel="noopener ugc nofollow" target="_blank">https://docs . gradle . org/current/user guide/user guide _ single . html # sec:gradle _ configuration _ properties</a>详情。</p><h2 id="28d4" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">第4步:禁用防病毒</h2><p id="4da5" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">考虑从防病毒扫描中排除项目和缓存文件。这显然是与安全性的权衡。但是如果你经常在分支之间切换，那么在允许gradle进程使用它之前，antivirus会重新扫描文件，这会减慢构建时间(特别是Android Studio sync项目与gradle文件和索引任务)。在启用和不启用防病毒的情况下测量构建时间和处理CPU，以查看是否相关。</p></div><div class="ab cl mk ml hc mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hn ho hp hq hr"><p id="204d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我希望这有所帮助。如果您有任何问题或其他提高构建性能的技巧，请留下您的评论。</p><p id="dc56" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">谢谢大家！</p><div class="jr js jt ju fq ab cb"><figure class="mr jv ms mt mu mv mw paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mr jv ms mt mu mv mw paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mr jv ms mt mu mv mw paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mx my mz"><p id="f922" class="ir is lu it b iu iv iw ix iy iz ja jb na jd je jf nb jh ji jj nc jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is lu it b iu iv iw ix iy iz ja jb na jd je jf nb jh ji jj nc jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jr js jt ju fq jv fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff nd"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ne nf l"/></div></figure></div></div>    
</body>
</html>