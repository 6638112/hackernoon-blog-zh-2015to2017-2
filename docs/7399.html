<html>
<head>
<title>How can we apply the principles of chaos engineering to AWS Lambda?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将混沌工程的原理应用于AWS Lambda？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-can-we-apply-the-principles-of-chaos-engineering-to-aws-lambda-80f87e3237e2?source=collection_archive---------13-----------------------#2017-10-26">https://medium.com/hackernoon/how-can-we-apply-the-principles-of-chaos-engineering-to-aws-lambda-80f87e3237e2?source=collection_archive---------13-----------------------#2017-10-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/668bce7f2163f589cdd06e417db5701a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56lZO-ri61SY-ndXv5PePA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">All the way back in 2011, Simon Wardley had identified Chaos Engines as a practice that will be employed by the next generation of tech companies, along with continuous deployment, being data-driven, and organised around small, autonomous teams (think microservices &amp; inverse-conway’s law).</figcaption></figure><p id="a964" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这是一个多部分系列的第一部分，探讨了如何将混沌工程的原理应用于围绕Lambda函数构建的无服务器架构。</p><ul class=""><li id="f9f8" class="ke kf hu ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">第一部分:我们如何将混沌工程的原理应用于Lambda？</li><li id="ecc3" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">第2部分:<a class="ae ks" href="https://hackernoon.com/chaos-engineering-and-aws-lambda-latency-injection-ddeb4ff8d983" rel="noopener ugc nofollow" target="_blank">为API应用延迟注入</a></li><li id="8501" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">第3部分:处理延迟峰值和超时(将于2017年11月21日发布)</li><li id="bb4d" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">第4部分:为Lambda函数应用故障注入(来了？)</li></ul></div><div class="ab cl kt ku hc kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hn ho hp hq hr"><p id="56c1" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">毫无疑问，网飞推广了混沌工程的<em class="la">原理</em>。通过开源他们的一些工具——特别是<a class="ae ks" href="https://github.com/Netflix/SimianArmy" rel="noopener ugc nofollow" target="_blank">猿猴军</a>——他们也帮助其他人建立了对他们系统承受生产中动荡环境能力的信心。</p><p id="6a68" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">最近似乎对混沌工程又有了新的兴趣。正如Russ Miles在最近的<a class="ae ks" rel="noopener" href="/russmiles/chaos-engineering-why-the-label-matters-35ddbb974fa5">帖子</a>中指出的那样，也许许多公司终于明白了混沌工程不是关于“伤害生产”，而是通过<strong class="ji hv"> <em class="la">受控</em> </strong>实验来建立对系统弹性的更好理解和信心。</p><p id="29a0" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这一趋势得益于网飞发布的有价值的(且可免费获得的)信息，如<a class="ae ks" href="http://oreil.ly/2tZU1Sn" rel="noopener ugc nofollow" target="_blank">混沌工程</a>电子书和<a class="ae ks" href="http://principlesofchaos.org/" rel="noopener ugc nofollow" target="_blank">principlesofchaos.org</a>。</p><figure class="lc ld le lf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lb"><img src="../Images/a14dd7f6bf2ecea64aecc5723698e11f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JlnapsrFEDH771EYRel0VA.png"/></div></div></figure><p id="bede" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">由<em class="la"> Shoreditch Ops </em>开发的<a class="ae ks" href="https://github.com/shoreditch-ops/chaos-lambda" rel="noopener ugc nofollow" target="_blank"> chaos-lambda </a>等工具(开发<a class="ae ks" href="https://artillery.io/" rel="noopener ugc nofollow" target="_blank">火炮</a>负载测试工具的人)试图复制网飞的<a class="ae ks" href="https://github.com/Netflix/SimianArmy/wiki/Chaos-Monkey" rel="noopener ugc nofollow" target="_blank"> Chaos Monkey </a>，但是从lambda函数内部执行，而不是从EC2实例内部执行——从而为您带来Lambda提供的成本节约和便利。</p><p id="7264" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">然而，我想问一个不同的问题:<strong class="ji hv">如何将混沌工程的原理和一些当前的实践应用到由Lambda函数组成的无服务器架构中？</strong></p><p id="0700" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">当您的系统运行在EC2实例上时，自然地，您通过为最可能的故障模式——服务器崩溃(由于硬件和软件问题)进行设计来建立弹性。因此，一个验证系统弹性的受控实验将通过终止EC2实例，然后终止AZs，然后终止整个区域来人为地重现故障场景。</p><p id="a8aa" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">然而，AWS Lambda是一个更高层次的抽象，其故障模式与其EC2对应物不同。随着平台为您开箱即用地处理这些故障模式，专注于<em class="la">“如果我们丢失这些EC2实例怎么办”</em>的假设不再适用。</p><p id="80ae" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们需要问不同的问题，以便了解我们的无服务器架构中的弱点。</p><h1 id="f1aa" class="lg lh hu bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md dt translated">更多固有的混乱，而不是更少</h1><blockquote class="me mf mg"><p id="ad7c" class="jg jh la ji b jj jk jl jm jn jo jp jq mh js jt ju mi jw jx jy mj ka kb kc kd hn dt translated">"<strong class="ji hv">我们需要在系统范围的异常行为出现之前发现弱点</strong>。系统弱点可能表现为:当服务不可用时，不适当的回退设置；由于超时调整不当而重试风暴；下游依赖关系接收过多流量时的中断；单点故障崩溃时的级联故障；等等。我们必须主动解决最重要的弱点，以免它们影响我们的客户生产。<strong class="ji hv">我们需要一种方法来管理这些系统固有的混乱</strong>，利用不断增加的灵活性和速度，并且<strong class="ji hv">对我们的生产部署充满信心，尽管它们代表着复杂性。</strong>”</p><p id="f5c8" class="jg jh la ji b jj jk jl jm jn jo jp jq mh js jt ju mi jw jx jy mj ka kb kc kd hn dt translated">— <a class="ae ks" href="http://principlesofchaos.org/" rel="noopener ugc nofollow" target="_blank">混沌工程原理</a></p></blockquote><p id="2a67" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在<a class="ae ks" href="https://hackernoon.com/yubls-road-to-serverless-part-1-overview-ca348370acde" rel="noopener ugc nofollow" target="_blank">建造并运行了一个非平凡的无服务器架构</a>之后，我对这个新世界中等待你的危险有了一些了解。</p><p id="1d33" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">如果有什么不同的话，在这些围绕Lambda函数构建的系统中有更多固有的混乱和复杂性。</p><ul class=""><li id="09c4" class="ke kf hu ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">模块化(部署单元)从“服务”转移到“功能”，而且还有更多</li><li id="2e57" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">围绕边界进行强化更加困难，因为您需要围绕每个功能进行强化，而不是封装一组相关功能的服务</li><li id="0c8b" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">有更多的中介服务(如Kinesis、SNS、API Gateway等)，每种服务都有自己的故障模式</li><li id="bbae" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">总体上有更多的配置(超时、IAM权限等。)，因此错误配置的机会更多</li></ul><p id="1af3" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">此外，由于我们放弃了对基础设施的更多控制，这意味着我们现在面临更多未知的故障模式**，而且当停机发生时，我们往往无能为力***。</p></div><div class="ab cl kt ku hc kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hn ho hp hq hr"><p id="0f17" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><em class="la"> *为了更好的可扩展性、可用性、成本效率和更多的便利性，我认为这是一个公平的交易</em> <strong class="ji hv"> <em class="la">大多数情况下</em> </strong> <em class="la">。</em></p><p id="9aca" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><em class="la"> **平台为您做的一切——调度容器、扩展、轮询Kinesis、重试失败的调用等。—有自己的失效模式。这些对我们来说通常不明显，因为它们是通常没有文档记录的实现细节，并且容易在没有通知的情况下改变。</em></p><p id="7bab" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><em class="la"> ***例如，如果中断发生并阻止Lambda函数处理Kinesis事件，那么除了等待AWS修复问题，我们没有其他有意义的选择。由于碎片上的当前位置被抽象掉了，我们无法使用，我们甚至不能用运行在EC2上的KCL处理器来替换Lambda函数。</em></p></div><div class="ab cl kt ku hc kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hn ho hp hq hr"><h1 id="6062" class="lg lh hu bd li lj mk ll lm ln ml lp lq lr mm lt lu lv mn lx ly lz mo mb mc md dt translated">将混沌应用于AWS Lambda</h1><p id="ac8c" class="pw-post-body-paragraph jg jh hu ji b jj mp jl jm jn mq jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd hn dt translated">一个好的锻炼制度会不断地将你推向极限，但实际上永远不会让你超过极限而造成伤害。如果有一项运动明显超出了你目前的能力，那么你肯定不会尝试，因为唯一可能的结果是让你自己受伤！</p><p id="909b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">在为您的无服务器架构设计受控实验时，应该应用相同的常识</strong>。为了“了解”实验告诉我们的系统弹性，我们还需要决定监控哪些指标——最好使用客户端指标，因为最重要的指标是用户体验的服务质量。</p><p id="82fe" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们知道有很多失效模式，并且可以针对这些模式进行设计，我们可以进行简单的实验来验证我们的设计。例如，由于无服务器架构(几乎总是)也是微服务架构，其许多固有的故障模式仍然适用:</p><ul class=""><li id="ffb3" class="ke kf hu ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">超时调整不当，尤其是对于中间服务，这可能导致边缘服务也超时</li></ul><figure class="lc ld le lf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mu"><img src="../Images/2b63318c97a17b5f56bbbd45b5e85cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OFKVj5FywcNs-CpsXFPi0w.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Intermediate services should have more strict timeout settings compared to services at the edge.</figcaption></figure><ul class=""><li id="2bd8" class="ke kf hu ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">缺少错误处理，这使得下游服务的异常能够逃脱</li></ul><figure class="lc ld le lf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mv"><img src="../Images/2357c2bb9aa8efe91712c22bb55aac64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DSKdK5TqOy8FZ4F9xUmK8g.png"/></div></div></figure><ul class=""><li id="5aa4" class="ke kf hu ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">当下游服务不可用或经历中断时，缺少回退</li></ul><figure class="lc ld le lf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mw"><img src="../Images/a415f5872ac36971163aecad28a434ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ZK4_SQEk3X1g4PowOOCIg.png"/></div></div></figure><p id="f68c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在接下来的几篇文章中，我们将探讨如何将延迟和故障注入的实践应用到Lambda函数中，以便模拟这些故障模式并验证我们的设计。</p><h1 id="7f3b" class="lg lh hu bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md dt translated">进一步阅读:</h1><ul class=""><li id="c049" class="ke kf hu ji b jj mp jn mq jr mx jv my jz mz kd kj kk kl km dt translated"><a class="ae ks" rel="noopener" href="/netflix-techblog/chap-chaos-automation-platform-53e6d528371f">章节:混沌自动化平台</a></li><li id="da7b" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae ks" rel="noopener" href="/netflix-techblog/deploying-the-netflix-api-79b6176cc3f0">部署网飞API </a></li><li id="3a5a" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae ks" rel="noopener" href="/netflix-techblog/the-netflix-simian-army-16e57fbab116">网飞猿猴军</a></li><li id="e97b" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae ks" href="https://opensource.com/article/17/8/testing-production" rel="noopener ugc nofollow" target="_blank">生产中的测试:是的，你可以(也应该)</a></li><li id="1370" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae ks" href="http://theburningmonk.com/2015/04/design-for-latency-issues/" rel="noopener ugc nofollow" target="_blank">延迟问题设计</a></li><li id="c30d" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae ks" href="https://erlangcentral.org/blog/presentations/1000-actors-one-chaos-monkey-and-everything-ok/" rel="noopener ugc nofollow" target="_blank"> 1000个演员，一只混沌猴…一切都好</a></li><li id="58ea" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">【电子书】<a class="ae ks" href="http://www.oreilly.com/webops-perf/free/chaos-engineering.csp" rel="noopener ugc nofollow" target="_blank">混沌工程</a></li><li id="e7e5" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">【书】<a class="ae ks" href="http://amzn.to/1pedVvt" rel="noopener ugc nofollow" target="_blank">发布吧！</a></li><li id="7002" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae ks" href="http://amzn.to/1CB0I6D" rel="noopener ugc nofollow" target="_blank">【书】滑向失败</a></li><li id="233f" class="ke kf hu ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><a class="ae ks" href="http://principlesofchaos.org/" rel="noopener ugc nofollow" target="_blank">principlesofchaos.org</a></li></ul></div><div class="ab cl kt ku hc kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hn ho hp hq hr"><figure class="lc ld le lf fq iv fe ff paragraph-image"><div class="ab fr cl na"><img src="../Images/8b4e4721bb1973db389b5b533d727ad1.png" data-original-src="https://miro.medium.com/v2/format:webp/0*b_1R345KzKSaI8sg.png"/></div></figure><p id="f870" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">嗨，我叫<strong class="ji hv">崔琰</strong>。我是一个<a class="ae ks" href="https://aws.amazon.com/developer/community/heroes/yan-cui/" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hv"> AWS无服务器英雄</strong> </a>和<a class="ae ks" href="https://bit.ly/production-ready-serverless" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hv">量产无服务器</strong> </a>的作者。我已经在AWS中运行了近10年的大规模生产工作负载，我是一名架构师或首席工程师，涉足从银行、电子商务、体育流媒体到移动游戏等多个行业。我目前是一名专注于AWS和无服务器的独立顾问。</p><p id="c37e" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">你可以通过<a class="ae ks" href="mailto:theburningmonk.com" rel="noopener ugc nofollow" target="_blank">邮箱</a>、<a class="ae ks" href="https://twitter.com/theburningmonk" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae ks" href="https://www.linkedin.com/in/theburningmonk/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。</p></div><div class="ab cl kt ku hc kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hn ho hp hq hr"><p id="404d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">查看我的新课程，<a class="ae ks" href="https://theburningmonk.thinkific.com/courses/complete-guide-to-aws-step-functions" rel="noopener ugc nofollow" target="_blank"><strong class="ji hv">AWS步骤功能完整指南</strong> </a>。</p><p id="a329" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在本课程中，我们将介绍有效使用AWS Step Functions服务所需了解的一切。包括基本概念、HTTP和事件触发器、活动、设计模式和最佳实践。</p><p id="cd40" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">点击获取您的副本<a class="ae ks" href="https://theburningmonk.thinkific.com/courses/complete-guide-to-aws-step-functions" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl kt ku hc kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hn ho hp hq hr"><figure class="lc ld le lf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nb"><img src="../Images/2faf40b47320300fed81b3e09483ffb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZYcHhOOzUf5VB-Ri.png"/></div></div></figure><p id="ee8c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">来了解AWS Lambda: CI/CD的操作性<strong class="ji hv">最佳实践</strong>，本地测试&amp;调试功能、日志记录、监控、分布式跟踪、canary部署、配置管理、认证&amp;授权、VPC、安全性、错误处理等等。</p><p id="8bb5" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">您还可以通过代码<strong class="ji hv"> ytcui </strong>获得票面价格的<strong class="ji hv"> 40% </strong>。</p><p id="2e68" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">点击获取您的副本<a class="ae ks" href="https://bit.ly/production-ready-serverless" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>