<html>
<head>
<title>Spark Packages, from Xml to Json</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spark包，从Xml到Json</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/spark-packages-from-xml-to-json-ab6b5bb1f988?source=collection_archive---------5-----------------------#2016-12-06">https://medium.com/hackernoon/spark-packages-from-xml-to-json-ab6b5bb1f988?source=collection_archive---------5-----------------------#2016-12-06</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><h1 id="a16f" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">Spark包，从Xml到Json</h1><p id="ad92" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">Apache Spark社区在扩展Spark方面付出了大量努力，因此我们都可以受益于它为我们带来的计算能力。</p><p id="5f41" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">最近，我们对将XML数据集转换成更容易查询的数据很感兴趣。我们的主要兴趣依赖于在我们每天获得的数十亿次交易的基础上进行数据探索的能力。</p><p id="772b" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">XML是一种众所周知的格式，但有时使用起来会很复杂。例如，在Apache Hive中，我们可以定义XML的模式结构，然后使用对我们很重要的SQL查询它们。</p><p id="ff6c" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">然而，我们很难跟上XML结构的变化，所以前面的选项已经被放弃了。</p><p id="e8b7" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">我们正在使用Spark流功能将这些事务引入我们的集群，我们正在考虑在Spark中进行必要的转换。然而，同样的问题仍然存在，每次XML结构改变时，我们都要改变Spark应用程序。</p><p id="18b9" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">一定有别的办法！</p><p id="e90b" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">社区中有一个Apache Spark包，我们可以用它来解决这些问题。</p><p id="50b0" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">让我们加载Spark Shell并查看一个示例:</p><figure class="ks kt ku kv fq kw"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="3b1c" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">在这里，我们只是将xml包添加到我们的spark环境中。这当然可以在编写Spark应用程序并将其打包成Jar文件时添加。</p><p id="3602" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">使用这个包，我们可以将任何XML文件读入数据帧。当加载DataFrame时，我们可以指定数据的模式，但这是我们最关心的问题，所以我们让Spark来推断。数据帧模式的推断是一个非常强大的技巧，因为我们不再需要知道模式，所以它可以随时改变。</p><p id="900f" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">让我们看看如何将XML文件加载到数据框中:</p><figure class="ks kt ku kv fq kw"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="9948" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">打印DataFrame模式可以让我们了解推理系统做了什么。</p><figure class="ks kt ku kv fq kw"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="575d" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">此时，我们可以使用Spark SQL使用任何SQL工具来查询我们的XML。请阅读此贴(<a class="ae kz" rel="noopener" href="/@anicolaspp/apache-spark-as-a-distributed-sql-engine-4373e254e0f9#.w77z4ml3r"> <strong class="jr hv"> <em class="la"> Apache Spark作为分布式SQL引擎</em> </strong> </a>)了解更多Spark SQL。</p><p id="8691" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">更进一步，我们可能会使用读取JSON格式的工具。如果你有类似Apache Drill，from <a class="ae kz" href="https://www.mapr.com/" rel="noopener ugc nofollow" target="_blank"> <em class="la"> MapR </em> </a> <em class="la">的东西，拥有JSON数据集特别有用。</em></p><p id="34e9" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">正如我们所料，有了Spark，我们可以进行任何类型的转换，但是没有必要编写一个花哨的JSON编码器，因为Spark已经支持这些特性。</p><p id="bb6d" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">让我们将DataFrame转换成JSON并保存到我们的文件系统中。</p><figure class="ks kt ku kv fq kw"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="e6f3" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">当将<em class="la"> toJSON </em>函数应用于DataFrame时，我们得到一个<strong class="jr hv"><em class="la">【RDD】【字符串】</em> </strong>，用JSON表示我们的数据。然后我们将RDD的<strong class="jr hv"><em class="la"/></strong>保存为一个纯文本文件。</p><p id="be4e" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">现在，我们可以使用Drill来读取和查询我们的新数据集，当然，如果我们需要做一些更复杂的操作/转换，我们可以随时回到Spark。</p><h2 id="c8e0" class="lb is hu bd it lc ld le ix lf lg lh jb ka li lj jf ke lk ll jj ki lm ln jn lo dt translated">结论</h2><p id="9c86" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">在Spark中，将我们的数据集从XML转换成JSON是一项简单的任务，但是JSON相对于XML的优势是巨大的。现在，我们可以放心，XML模式更改根本不会影响我们，我们已经消除了为每次XML更改而更改应用程序的负担，我们还可以使用强大的工具以无模式方式查询我们的JSON数据集，如Apache Drill，同时我们的客户可以使用SQL报告我们的数据。</p><p id="5a7b" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated"><em class="la">感谢社区正在开发的令人惊叹的工具。</em></p><blockquote class="lp lq lr"><p id="ee8c" class="jp jq la jr b js kn ju jv jw ko jy jz ls kp kc kd lt kq kg kh lu kr kk kl km hn dt translated"><a class="ae kz" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是AMI家庭的一员。我们现在<a class="ae kz" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kz" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="jp jq la jr b js kn ju jv jw ko jy jz ls kp kc kd lt kq kg kh lu kr kk kl km hn dt translated">要了解更多信息，请<a class="ae kz" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">阅读我们的“关于”页面</a>、<a class="ae kz" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">喜欢/在脸书给我们发消息</a>，或者简单地说，<a class="ae kz" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="jp jq la jr b js kn ju jv jw ko jy jz ls kp kc kd lt kq kg kh lu kr kk kl km hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kz" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kz" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote></div></div>    
</body>
</html>