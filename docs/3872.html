<html>
<head>
<title>How to Write a Sophisticated SPA: TodoMVC using C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用C#写一个复杂的SPA: TodoMVC</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-write-a-sophisticated-spa-todomvc-using-c-df81ea50f4e0?source=collection_archive---------6-----------------------#2017-04-28">https://medium.com/hackernoon/how-to-write-a-sophisticated-spa-todomvc-using-c-df81ea50f4e0?source=collection_archive---------6-----------------------#2017-04-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="2572" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你一直在寻找使用C#开发单页面应用程序，否则将需要使用与Angular或React等框架配对的<a class="ae jp" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>。请继续阅读…</p><p id="02fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本文中，我们将利用Bridge.Net<a class="ae jp" href="http://bridge.net/" rel="noopener ugc nofollow" target="_blank"/>(一个C# JavaScript trans piler)和SharpBindings(一个通过DOM创建HTML元素的DSL)来让<a class="ae jp" href="https://github.com/muigai-mwaura/sharpbinding-todomvc" rel="noopener ugc nofollow" target="_blank">用纯C #代码实现众所周知的<a class="ae jp" href="https://github.com/tastejs/todomvc/blob/master/app-spec.md#functionality" rel="noopener ugc nofollow" target="_blank"> TodoMVC </a>应用程序</a>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/a2a36b650b48946e0999f6bf913fdee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*E9qEkViZ9psEDiJ-o4PpnQ.gif"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek"><a class="ae jp" href="https://cdn.rawgit.com/muigai-mwaura/sharpbinding-todomvc/2b71415e/TodoMVC/Bridge/www/demo.html" rel="noopener ugc nofollow" target="_blank"><strong class="bd kc">[Live Demo]</strong></a></figcaption></figure><p id="8478" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这个过程中，我们将展示如何利用你所知道和喜爱的C#特性，如泛型、LINQ、lambdas等。来构建复杂的水疗功能。</p><h2 id="484f" class="kd ke hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">入门指南</h2><p id="5567" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">我们将从翻译html中如下定义的标题部分开始，</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="7617" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用SharpBindings转换到C#中，如下所示:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="9191" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如您所看到的，在静态内容方面，<a class="ae jp" href="https://hackernoon.com/tagged/html" rel="noopener ugc nofollow" target="_blank"> HTML </a>标签和属性与C#代码之间存在一一对应的关系。然而，应用程序的动态行为要求:</p><blockquote class="lf lg lh"><p id="1257" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">在应用程序顶部的输入中输入新的待办事项…按Enter键创建待办事项，将其添加到待办事项列表中，并清除输入。一定要。trim()输入，然后在创建新的todo之前检查它是否为空。</p></blockquote><p id="2a8c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了实现这一点，我们需要按照下面的完整代码清单支持函数、事件处理程序和数据绑定:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="d23d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面提到的todo类是一个标准的C#类，它有两个属性，一个是对Todo的描述，另一个是“IsCompleted”标志，指示它是否完成。此外，它支持标准的INotifyPropertyChanged接口。</p><p id="4387" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">ObservableCollection是一个保存元素列表的类，每当元素:</p><ol class=""><li id="e5be" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">它在列表中的位置改变了吗</li><li id="9574" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">被添加到列表中</li><li id="ad86" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">从列表中删除</li></ol><p id="3bfd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">应注意以下非显而易见的要点:</p><ol class=""><li id="78b6" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">我们将input元素的“value”属性绑定到一个函数，因为编辑todo的描述会随着用户交互和编程事件的变化而变化，并且需要相应地重新评估。</li><li id="030e" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">我们引入了一个绑定到编辑todo的“watch”属性。每当编辑todo发生变化时，我们都会重新评估输入元素的数据绑定，并且只更改DOM中需要更新的方面。</li></ol><p id="687f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以上两者的结合确保了输入在这行代码运行后被清除</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="5822" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来是页脚部分，在html中定义如下:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="0080" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用SharpBindings转换为C#的过程如下:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="d38a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">HTML标记和属性与C#代码之间仍然有很大的相似之处，但是这次的动态行为比header部分更加广泛。根据规范:</p><blockquote class="lf lg lh"><p id="7bfa" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">"当没有待办事项时，应该隐藏…#页脚。"</p><p id="1bbb" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">" Display…以复数形式显示活动待办事项的数量。确保数字被一个<strong>标签所包围。还要确保项目词的复数形式正确:0个项目，1个项目，2个项目。示例:还剩2项。”</strong></p><p id="62c3" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">“清除已完成的按钮…单击时删除已完成的待办事项。当没有完成的待办事项时，应该隐藏。</p><p id="94b9" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">“需要路由…应实现以下路由:#/(全部—默认)、#/活动和#/已完成…当路由更改时，应在模型级别筛选待办事项列表，并应切换筛选器链接上的选定类。当项目在过滤状态下更新时，它应该相应地更新。例如，如果过滤器处于活动状态，且该项目已被选中，则应将其隐藏。请确保在重新加载时保持活动筛选器。</p></blockquote><p id="5b77" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些要求按照下面列出的完整代码实现:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="ec09" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面的FooterSection函数有四个参数:</p><ol class=""><li id="b260" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">todos的ObservableCollection(与标头部分相同)</li><li id="e0d4" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">一个返回活动待办事项数量的函数</li><li id="8fb6" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">规范中描述的过滤器(所有、激活和完成)</li><li id="f87b" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">一个名为“urlTrigger”的可观察对象，它将在url更改时发出更改通知</li></ol><p id="fc76" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">应注意以下不明显的一点:</p><p id="428f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1)不是像在HTML模板中那样写出每个过滤器URL:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="0b9d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将过滤器指定为项目的集合，每个项目都将使用提供的模板进行呈现:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="d9ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，我们有主要部分，在html中定义如下:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="c1f2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用SharpBindings转换为C#的过程如下:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="a0e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，我们需要按照规范实现以下动态行为:</p><blockquote class="lf lg lh"><p id="b306" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">"当没有待办事项时，#main…应该隐藏。"</p><p id="9bc7" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">“将所有待办事项标记为完成…复选框将所有待办事项切换到与自身相同的状态。请确保在单击“清除已完成”按钮后清除选中状态。选中/取消选中单个待办事项时，也应更新“全部标记为完成”复选框。当所有的todos都被检查时，它也应该被检查。”</p></blockquote><p id="ce4e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些要求按照下面列出的完整代码实现:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="8eb9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面的MainSection函数有三个参数:</p><ol class=""><li id="f1c8" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">todos的ObservableCollection(与标头部分相同)</li><li id="e510" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">一个返回活动待办事项数量的函数</li><li id="397f" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">一个模板函数，接受一个todo项并返回一个呈现的HTML元素，如下所述。</li></ol><p id="4b13" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">待办事项模板在html中定义如下:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="834e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用SharpBindings转换为C#的过程如下:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="603a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，我们需要按照规范实现以下动态行为:</p><blockquote class="lf lg lh"><p id="77c6" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">“项目</p><p id="2519" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">待办事项有三种可能的交互:</p><p id="255d" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">单击复选框，通过更新其完成值并切换其父级<li>上的类completed，将todo标记为完成</li></p><p id="56aa" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">双击<label>激活编辑模式。编辑类在其<li/></label></p><p id="ae69" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">将鼠标悬停在待办事项上会显示移除按钮(。销毁)</p><p id="6d31" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">编辑</p><p id="febf" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">当编辑模式被激活时，它将隐藏其他控件，并显示一个包含todo标题的输入，该标题应该是焦点(。focus())。编辑应该保存在模糊和回车上，并且应该删除编辑类。一定要。trim()输入，然后检查它是否为空。如果它是空的，todo应该被销毁。如果在编辑过程中按下了escape键，那么编辑状态应该保持不变，任何修改都将被放弃。"</p></blockquote><p id="4974" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这相当复杂，需要大量代码来实现，如下所示:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="f244" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面的TodoTemplate函数有三个参数:</p><ol class=""><li id="7f61" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">从待办事项列表中删除待办事项的操作</li><li id="5e78" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">一个名为“urlTrigger”(与页脚相同)的可观察对象</li><li id="ec5b" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">一个当前过滤器，将跟踪用户选择的过滤器，如页脚所述。currentFilter将根据筛选条件确定要显示哪些待办事项。</li></ol><p id="1f51" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">应该注意下面不明显的一点</p><ul class=""><li id="ab47" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo ma ls lt lu dt translated">每个呈现的todo项目的类别(隐藏、已完成、编辑或以上都不是)，取决于<br/> a)项目的状态(活动或已完成)<br/> b)所选过滤器<br/> c)是否处于编辑模式<br/>因此，我们需要合并来自如下三个源的改变通知信号:</li></ul><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><ul class=""><li id="5fcc" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo ma ls lt lu dt translated">编辑模式的启动如下:<br/> a)用户双击待办事项的标签/描述<br/> b)标签通过将“isEditMode”设置为真来响应<br/> c)这触发编辑文本框的显示</li></ul><p id="e4d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了将所有这些结合在一起，我们有一个“主”函数(应用程序的入口点)，定义如下:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ld le l"/></div></figure><p id="6b18" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在你有了它，一个通过Bridge.NET和SharpBindings将TodoMVC规范翻译成C#的相当简洁的字面翻译。</p><p id="c8bc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意事项:</p><ol class=""><li id="e2cd" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">还不支持持久性的实现，因为将C#类序列化为JSON似乎是Bridge.NET正在进行的一项工作。将实现它，并在JSON序列化支持可用时尽快更新文章。</li><li id="e1f9" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">项目源代码可以从Github <a class="ae jp" href="https://github.com/muigai-mwaura/sharpbinding-todomvc" rel="noopener ugc nofollow" target="_blank">这里获得。</a></li><li id="27ba" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">TodoMVC的<a class="ae jp" href="https://github.com/ThoughtWorksInc/todo/blob/master/js/src/main/scala/com/thoughtworks/todo/Main.scala" rel="noopener ugc nofollow" target="_blank"> Scala实现</a>从中获得了灵感。</li></ol><blockquote class="lf lg lh"><p id="68b9" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">要了解更多信息，请<a class="ae jp" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">阅读我们的“关于”页面</a>、<a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上点赞/给我们发消息</a>，或者简单地说，<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is li it b iu iv iw ix iy iz ja jb lj jd je jf lk jh ji jj ll jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="mb le l"/></div></figure></div></div>    
</body>
</html>