<html>
<head>
<title>Deploy Angular Universal w/ Firebase 🚀🔥</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">部署带火焰基座的角形通用🚀🔥</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/deploy-angular-universal-w-firebase-ad70ea2413a1?source=collection_archive---------5-----------------------#2017-08-28">https://medium.com/hackernoon/deploy-angular-universal-w-firebase-ad70ea2413a1?source=collection_archive---------5-----------------------#2017-08-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/aa43a87d945be5de2898810f26b2232d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AyVeOIKqYMkpeZRxNOxRjg.png"/></div></div></figure><p id="a581" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">免责声明:这篇博客文章将一步一步地讲述如何使用<a class="ae ka" href="https://hackernoon.com/tagged/firebase" rel="noopener ugc nofollow" target="_blank"> Firebase </a>主机部署一个通用的<a class="ae ka" href="https://hackernoon.com/tagged/angular" rel="noopener ugc nofollow" target="_blank"> Angular </a>应用程序。对于任何关于角度通用和服务器端渲染的解释，这里有一些有用的资源:</p><ul class=""><li id="90b9" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated"><a class="ae ka" href="https://github.com/angular/universal" rel="noopener ugc nofollow" target="_blank">角度通用</a></li><li id="139c" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated"><a class="ae ka" href="https://medium.freecodecamp.org/what-exactly-is-client-side-rendering-and-hows-it-different-from-server-side-rendering-bd5c786b340d" rel="noopener ugc nofollow" target="_blank">服务器端渲染</a></li></ul><p id="f21b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你想继续下去，你可以在这里找到源代码。</p><h1 id="81af" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">要求</h1><ul class=""><li id="260e" class="kb kc hu je b jf ln jj lo jn lp jr lq jv lr jz kg kh ki kj dt translated"><a class="ae ka" href="https://github.com/nodejs/node" rel="noopener ugc nofollow" target="_blank"> node.js </a>(本教程我用的是v8.3.0)</li></ul><h1 id="5986" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">第一部分:构建angular应用程序(浏览器和服务器版本)🔨</h1><h2 id="75b2" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">1.安装全局依赖项</h2><p id="3302" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">我们将在命令行中使用<code class="eh mj mk ml mm b">@angular/cli</code>和<code class="eh mj mk ml mm b">firebase-tools</code>来构建和部署您的应用程序。</p><ul class=""><li id="e31e" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated"><a class="ae ka" href="https://github.com/angular/angular-cli" rel="noopener ugc nofollow" target="_blank"> @angular/cli ≥ v1.3.0 </a></li><li id="472a" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated"><a class="ae ka" href="https://github.com/firebase/firebase-tools" rel="noopener ugc nofollow" target="_blank">firebase-tools 3 . 9 . 2版</a></li></ul><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="3e71" class="ls kq hu mm b fv mv mw l mx my"><strong class="mm hv">$ npm install --global @angular/cli firebase-tools</strong></span></pre><h2 id="c32f" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">2.创建新的角度项目</h2><p id="fd97" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">使用<code class="eh mj mk ml mm b">@angular/cli</code>，我们将创建一个新的<code class="eh mj mk ml mm b">angular</code>应用程序。既然这样，我就把它命名为<code class="eh mj mk ml mm b">angular-universal-firebase</code>。</p><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="063a" class="ls kq hu mm b fv mv mw l mx my"><strong class="mm hv">$ ng new angular-universal-firebase<br/>$ cd angular-universal-firebase</strong></span></pre><h2 id="0b78" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">3.安装<code class="eh mj mk ml mm b">@angular/platform-server</code></h2><p id="6936" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">为了构建和呈现您的<code class="eh mj mk ml mm b">universal</code>应用程序，我们需要安装<code class="eh mj mk ml mm b">@angular/platform-server</code>。</p><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="6044" class="ls kq hu mm b fv mv mw l mx my"><strong class="mm hv">$ npm install --save @angular/platform-server</strong></span></pre><h2 id="59f2" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">4.一种<strong class="ak"> dd </strong> S <code class="eh mj mk ml mm b">erver Side Rendering </code>配置</h2><p id="25f5" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">我们基本上是复制默认的<code class="eh mj mk ml mm b">app</code>配置，并针对服务器端渲染(SSR)配置对其进行修改。对于SSR配置，我们不需要添加<code class="eh mj mk ml mm b">polyfill</code>(因为代码将在<code class="eh mj mk ml mm b">node</code>服务器而不是浏览器中运行)和<code class="eh mj mk ml mm b">styles</code>(因为这将在我们通过<code class="eh mj mk ml mm b">@angular/platform-server</code>构建服务器HTML时引用主<code class="eh mj mk ml mm b">index.html</code>时添加)。<strong class="je hv">还要注意</strong>，我们添加了<code class="eh mj mk ml mm b">"platform": "server"</code>，这是<code class="eh mj mk ml mm b">@angular/cli#v1.3.0</code>中引入的一个特性。这将允许我们使用<code class="eh mj mk ml mm b">@angular/cli</code>构建您的应用程序的SSR版本。</p><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="ae4d" class="ls kq hu mm b fv mv mw l mx my">// .angular-cli.json<br/>{<br/>    ...<br/>    apps: [<br/>        { /* default config */ },<br/>        <strong class="mm hv">{<br/>            "name": "ssr",<br/>            "root": "src",<br/>            "outDir": "functions/dist-ssr",<br/>            "assets": ["assets", "favicon.ico"],<br/>            "index": "index.html",<br/>            "main": "main-ssr.ts",<br/>            "test": "test.ts",<br/>            "tsconfig": "tsconfig.app-ssr.json",<br/>            "prefix": "app",<br/>            "scripts": [],<br/>            "environmentSource": "environments/environment.ts",<br/>            "environments": {<br/>                "dev": "environments/environment.ts",<br/>                "prod": "environments/environment.prod.ts"<br/>            },<br/>            "platform": "server"<br/>        }   </strong> <br/>    ],<br/>    ...<br/>}</span></pre><h2 id="487d" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">5.为应用服务器版本创建必要的文件</h2><ul class=""><li id="3e16" class="kb kc hu je b jf ln jj lo jn lp jr lq jv lr jz kg kh ki kj dt translated"><code class="eh mj mk ml mm b">src/app/app.server.module.ts</code> <br/>为app的<code class="eh mj mk ml mm b">server</code>版本创建新模块。</li></ul><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="c099" class="ls kq hu mm b fv mv mw l mx my">// src/app/app.server.module.ts</span><span id="2efb" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">import { NgModule } from '@angular/core';<br/>import { ServerModule } from '@angular/platform-server';<br/>import { AppModule } from './app.module';<br/>import { AppComponent } from './app.component';</strong></span><span id="d05b" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">@NgModule({<br/>    imports: [<br/>        ServerModule,<br/>        AppModule<br/>    ],<br/>    bootstrap: [AppComponent]<br/>})</strong></span><span id="8a94" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">export class AppServerModule { }</strong></span></pre><ul class=""><li id="bd22" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated"><code class="eh mj mk ml mm b">src/main-ssr.ts<br/></code>为<code class="eh mj mk ml mm b">server</code>模块创建入口点。这是我们在<code class="eh mj mk ml mm b">.angular-cli.json</code>中应用的服务器版本中引用的<code class="eh mj mk ml mm b">main</code>文件。</li></ul><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="76e6" class="ls kq hu mm b fv mv mw l mx my">// src/main-ssr.ts</span><span id="fcc4" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">export { AppServerModule } from './app/app.server.module';</strong></span></pre><ul class=""><li id="87ba" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated"><code class="eh mj mk ml mm b">src/tsconfig.app-ssr.json</code> <br/>为服务器版本创建<code class="eh mj mk ml mm b">tsconfig</code>。类似于浏览器版本，除了<code class="eh mj mk ml mm b">angularCompilerOptions.entryModule</code>将引用我们刚刚创建的服务器版本的入口模块。这在<code class="eh mj mk ml mm b">.angular-cli.json</code>配置中也被称为<code class="eh mj mk ml mm b">tsconfig</code>。</li></ul><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="1acc" class="ls kq hu mm b fv mv mw l mx my">// src/tsconfig.app-ssr.json</span><span id="8a48" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">{<br/>    "extends": "../tsconfig.json",<br/>    "compilerOptions": {<br/>        "outDir": "../out-tsc/app",<br/>        "baseUrl": "./",<br/>        "module": "commonjs",<br/>        "types": []<br/>    },<br/>    "exclude": [<br/>        "test.ts",<br/>        "**/*.spec.ts"<br/>    ],<br/>    "angularCompilerOptions": {<br/>        "entryModule": "app/app.server.module#AppServerModule"<br/>    }<br/>}</strong></span></pre><h2 id="0394" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">6.在应用程序的浏览器模块中包含服务器转换</h2><p id="58a6" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">由于我们是在浏览器版本之前将您的应用的服务器版本发送到浏览器，所以当在应用的浏览器模块的<code class="eh mj mk ml mm b">imports</code>中添加<code class="eh mj mk ml mm b">BrowserModule</code>时，我们需要添加调用<code class="eh mj mk ml mm b">.withServerTransition()</code>。</p><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="bf6a" class="ls kq hu mm b fv mv mw l mx my">// src/app/app.module.ts</span><span id="4bbd" class="ls kq hu mm b fv mz mw l mx my">import { BrowserModule } from '@angular/platform-browser';<br/>import { NgModule } from '@angular/core';<br/>import { AppComponent } from './app.component';</span><span id="23c8" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">const APP_ID = 'angular-universal-firebase';</strong></span><span id="2f2b" class="ls kq hu mm b fv mz mw l mx my">@NgModule({<br/>    declarations: [<br/>        AppComponent<br/>    ],<br/>    imports: [<br/>        <strong class="mm hv">BrowserModule.withServerTransition({ appId: APP_ID })</strong><br/>    ],<br/>    providers: [],<br/>    bootstrap: [AppComponent]<br/>})</span><span id="d10f" class="ls kq hu mm b fv mz mw l mx my">export class AppModule { }</span></pre><p id="730c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们已经准备好构建应用程序的服务器和浏览器版本了！</p><h2 id="2928" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">7.构建应用程序的浏览器和服务器版本</h2><p id="10a0" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">使用<code class="eh mj mk ml mm b">@angular/cli</code>，我们将构建应用程序的两个版本。<br/><code class="eh mj mk ml mm b">ng build -prod</code>:将使用<code class="eh mj mk ml mm b">prod</code>配置构建浏览器版本(即缩小的html/js/css、aot等)。)<br/><code class="eh mj mk ml mm b">ng build -aot -app ssr</code>:将构建服务器版本。它将生成一个<code class="eh mj mk ml mm b">ngFactory</code>文件，我们可以用它来渲染<code class="eh mj mk ml mm b">node</code>中的应用程序。</p><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="6580" class="ls kq hu mm b fv mv mw l mx my"><strong class="mm hv">$ ng build -prod<br/>$ ng build -aot -app ssr</strong></span></pre><p id="ebe1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当两个构建都完成时，现在你应该在你的<code class="eh mj mk ml mm b">root</code>目录中有一个<code class="eh mj mk ml mm b">dist</code>文件夹，在你的<code class="eh mj mk ml mm b">functions</code>目录中有一个<code class="eh mj mk ml mm b">dist-ssr</code>。万岁！🎉</p></div><div class="ab cl na nb hc nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="hn ho hp hq hr"><h1 id="efa4" class="kp kq hu bd kr ks nh ku kv kw ni ky kz la nj lc ld le nk lg lh li nl lk ll lm dt translated">第二部分:使用Firebase部署🚀</h1><p id="d92d" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">[1] <em class="nm">在继续之前，您应该已经创建了一个firebase项目</em> <a class="ae ka" href="https://console.firebase.google.com" rel="noopener ugc nofollow" target="_blank"> <em class="nm">这里是</em> </a> <em class="nm">。我为这个案例命名我的</em> <code class="eh mj mk ml mm b"><em class="nm">angular-universal-firebase</em></code> <em class="nm">。</em></p><h2 id="0a6d" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">1.在命令行中登录到`<code class="eh mj mk ml mm b">firebase</code>'</h2><p id="ddd0" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">在命令行中使用您在[1]中创建firebase项目时使用的google帐户登录firebase。</p><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="6ecc" class="ls kq hu mm b fv mv mw l mx my"><strong class="mm hv">$ firebase login</strong></span></pre><h2 id="7be1" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">2.在“angular”项目中初始化Firebase</h2><p id="1d5a" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">通过命令行初始化firebase配置:</p><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="6914" class="ls kq hu mm b fv mv mw l mx my"><strong class="mm hv">$ firebase init</strong></span></pre><ul class=""><li id="586b" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">选择<code class="eh mj mk ml mm b">Functions</code>和<code class="eh mj mk ml mm b">Hosting</code>进行功能设置</li></ul><figure class="mn mo mp mq fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nn"><img src="../Images/c7e998915265ed1833c7e47fd3f47c86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GbJ4R-GhuHh4UDNtrSiDaA.png"/></div></div><figcaption class="no np fg fe ff nq nr bd b be z ek">Firebase setup configuration</figcaption></figure><ul class=""><li id="334b" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">选择您在[1]中创建的firebase项目。(我的情况是<code class="eh mj mk ml mm b">angular-universal-firebase</code>。</li></ul><figure class="mn mo mp mq fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ns"><img src="../Images/23a0f36eee16a1da0452b9a210805647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EwE87izZt7lyKihzJHrmVg.png"/></div></div></figure><ul class=""><li id="2446" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">接受此阶段的所有默认值；我们将在后面的步骤中配置其余部分。</li></ul><h2 id="8940" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">3.将包依赖项添加到“函数”</h2><p id="687b" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">因为我们通过<code class="eh mj mk ml mm b">firebase-functions</code>使用节点服务器，所以我们需要在<code class="eh mj mk ml mm b">functions/package.json</code>中包含<code class="eh mj mk ml mm b">angular</code>依赖项来呈现应用程序的服务器版本。</p><p id="d5a3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="nm">先不说:目前，我不知道有什么方法可以减轻这种依赖声明的重复，因为据我所知，你不能在任何</em> <code class="eh mj mk ml mm b"><em class="nm">firebase-functions</em></code> <em class="nm"> javascript文件中访问</em> <code class="eh mj mk ml mm b"><em class="nm">functions</em></code> <em class="nm">目录之外的文件。但是如果你知道一个方法，请让我知道！</em></p><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="bc22" class="ls kq hu mm b fv mv mw l mx my">// functions/package.json<br/>{<br/>    "name": "functions",<br/>    "description": "Cloud Functions for Firebase",<br/>    "dependencies": {<br/>        <strong class="mm hv">"@angular/animations": "^4.3.5",<br/>        "@angular/common": "^4.3.5",<br/>        "@angular/compiler": "^4.3.5",<br/>        "@angular/core": "^4.3.5",<br/>        "@angular/forms": "^4.3.5",<br/>        "@angular/http": "^4.3.5",<br/>        "@angular/platform-browser": "^4.3.5",<br/>        "@angular/platform-server": "^4.3.5",<br/>        "express": "^4.15.4",</strong><br/>        "firebase-admin": "~4.2.1",<br/>        "firebase-functions": "^0.5.7",<br/>        <strong class="mm hv">"rxjs": "^5.4.3",<br/>        "zone.js": "^0.8.16"</strong><br/>    },<br/>    "private": true<br/>}</span></pre><h2 id="572d" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">4.在`<code class="eh mj mk ml mm b">functions</code>'目录下安装包</h2><p id="c548" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">安装da依赖项！</p><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="0f3c" class="ls kq hu mm b fv mv mw l mx my"># in project root<br/><strong class="mm hv">$ npm --prefix functions install</strong></span><span id="d0c5" class="ls kq hu mm b fv mz mw l mx my">or </span><span id="401f" class="ls kq hu mm b fv mz mw l mx my"># in `functions` directory<br/><strong class="mm hv">$ npm install</strong></span></pre><h2 id="3b88" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">5.将`<code class="eh mj mk ml mm b">dist</code>文件夹复制到`<code class="eh mj mk ml mm b">functions/dist</code>`中</h2><p id="da3f" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">由于您不能在<code class="eh mj mk ml mm b">firebase-functions</code>中访问<code class="eh mj mk ml mm b">functions</code>目录之外的文件，我们必须将<code class="eh mj mk ml mm b">dist</code>目录复制到<code class="eh mj mk ml mm b">functions</code>目录中，这样我们才能在<code class="eh mj mk ml mm b">firebase-functions</code>中访问它。</p><figure class="mn mo mp mq fq iv fe ff paragraph-image"><div class="fe ff nt"><img src="../Images/0f4d8ac2e9b85643a42ab30b940e5cbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*lYbueS_mQvcti6p3isjiMg.png"/></div><figcaption class="no np fg fe ff nq nr bd b be z ek">dist should now exist in root folder AND functions folder</figcaption></figure><h2 id="5816" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">6.创建Firebase函数以服务于应用程序</h2><p id="316f" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">我们将使用<code class="eh mj mk ml mm b">functions.https.onRequest</code> Firebase函数类型从express服务器发送响应。该文件中有许多内容，但最值得注意的是:</p><ul class=""><li id="0f49" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">导入从<strong class="je hv">第一部分生成的<code class="eh mj mk ml mm b">AppServerModuleNgFactory</code>:步骤7——服务器版本</strong>。</li><li id="8ceb" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">创建一个<code class="eh mj mk ml mm b">index</code>变量，该变量获取我们从<strong class="je hv">第一部分生成的<code class="eh mj mk ml mm b">index.html</code>文件:步骤7 —浏览器版本。</strong></li><li id="a889" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">使用<code class="eh mj mk ml mm b">renderModuleFactory</code>生成一个<code class="eh mj mk ml mm b">html</code>文件，我们用<code class="eh mj mk ml mm b">url</code>和<code class="eh mj mk ml mm b">document</code>参数作为响应发送该文件。<br/><code class="eh mj mk ml mm b">url</code>参数决定了app要渲染的路线。指定这一点允许<code class="eh mj mk ml mm b">renderModuleFactory</code>构建该路线的<code class="eh mj mk ml mm b">html</code>。<br/><code class="eh mj mk ml mm b">document</code>是要呈现的页面的完整文档HTML。在这种情况下，它将是应用程序的浏览器版本<code class="eh mj mk ml mm b">index.html</code>。</li></ul><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="e736" class="ls kq hu mm b fv mv mw l mx my">// functions/index.js</span><span id="756b" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">require('zone.js/dist/zone-node');</strong></span><span id="035c" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">const functions = require('firebase-functions');<br/>const express = require('express');<br/>const path = require('path');<br/>const { enableProdMode } = require('@angular/core');<br/>const { renderModuleFactory } = require('@angular/platform-server');</strong></span><span id="ebcd" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">const { AppServerModuleNgFactory } = require('./dist-ssr/main.bundle');</strong></span><span id="34f4" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">enableProdMode();</strong></span><span id="5cec" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">const index = require('fs')<br/>    .readFileSync(path.resolve(__dirname, './dist/index.html'), 'utf8')<br/>    .toString();</strong></span><span id="74dc" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">let app = express();</strong></span><span id="01a1" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">app.get('**', function(<em class="nm">req</em>, <em class="nm">res</em>) {<br/>    renderModuleFactory(AppServerModuleNgFactory, {<br/>        url: req.path,<br/>        document: index<br/>    }).then(<em class="nm">html</em> =&gt; res.status(200).send(html));<br/>});</strong></span><span id="5916" class="ls kq hu mm b fv mz mw l mx my"><strong class="mm hv">exports.ssr = functions.https.onRequest(app);</strong></span></pre><h2 id="9ef1" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">7.配置Firebase托管</h2><p id="f28a" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">现在我们已经构建了呈现页面的函数，我们需要更改firebase主机配置来使用这个函数。我们还需要更改<code class="eh mj mk ml mm b">public</code>目录，以便使用<code class="eh mj mk ml mm b">dist</code>目录来访问您的资产。</p><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="8774" class="ls kq hu mm b fv mv mw l mx my">// firebase.json<br/>{</span><span id="605f" class="ls kq hu mm b fv mz mw l mx my">    "hosting": {<br/>        <strong class="mm hv">"public": "dist",<br/>        "rewrites": [{<br/>            "source": "**",<br/>            "function": "ssr"<br/>        }]</strong><br/>    }<br/>}</span></pre><h2 id="1b00" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">8.从根目录中删除`<code class="eh mj mk ml mm b">dist/index.html</code>'</h2><ul class=""><li id="825d" class="kb kc hu je b jf ln jj lo jn lp jr lq jv lr jz kg kh ki kj dt translated">这是因为Firebase不会服务于<code class="eh mj mk ml mm b">html</code>文件，而是运行<code class="eh mj mk ml mm b">ssr</code>函数。<strong class="je hv">注</strong>:从<code class="eh mj mk ml mm b">root</code>目录中删除<code class="eh mj mk ml mm b">dist/index.html</code>。<strong class="je hv">不删除</strong> <code class="eh mj mk ml mm b">functions/dist/index.html</code>。</li></ul><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="e9e5" class="ls kq hu mm b fv mv mw l mx my"><strong class="mm hv">$ rm dist/index.html</strong></span></pre><h2 id="a75f" class="ls kq hu bd kr lt lu lv kv lw lx ly kz jn lz ma ld jr mb mc lh jv md me ll mf dt translated">9.部署到火力基地🚀 🔥</h2><p id="be1d" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">如果一切顺利，您应该能够将您的应用程序部署到Firebase:</p><pre class="mn mo mp mq fq mr mm ms mt aw mu dt"><span id="9b02" class="ls kq hu mm b fv mv mw l mx my"><strong class="mm hv">$ firebase deploy</strong></span></pre></div><div class="ab cl na nb hc nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="hn ho hp hq hr"><h1 id="c04e" class="kp kq hu bd kr ks nh ku kv kw ni ky kz la nj lc ld le nk lg lh li nl lk ll lm dt translated">就是这样！👍</h1><p id="0b6d" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn mg jp jq jr mh jt ju jv mi jx jy jz hn dt translated">你可以在这里查看源代码<a class="ae ka" href="https://github.com/aaronte/angular-universal-firebase" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="681d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我希望这篇教程在某些方面有所帮助！如果你有任何反馈或问题，我很乐意听到！</p><p id="9fff" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">其他有用的资源<br/></strong><a class="ae ka" rel="noopener" href="/@feloy/creating-an-angular-universal-app-with-the-angular-cli-5ef26c9fd9a5">使用Angular CLI创建Angular Universal app</a><br/><a class="ae ka" rel="noopener" href="/@cdeniz/angular-universal-on-firebase-dynamic-hosting-4fdd034af3db">Angular Universal with Firebase Dynamic Hosting</a>(只有一个路径处理)</p><figure class="mn mo mp mq fq iv"><div class="bz el l di"><div class="nu nv l"/></div></figure></div></div>    
</body>
</html>