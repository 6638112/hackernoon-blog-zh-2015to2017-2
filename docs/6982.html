<html>
<head>
<title>Your Personal DDNS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的个人DDNS</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/your-personal-ddns-4ef7bbb189de?source=collection_archive---------6-----------------------#2017-10-12">https://medium.com/hackernoon/your-personal-ddns-4ef7bbb189de?source=collection_archive---------6-----------------------#2017-10-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/525c5dd6019d41adca08d467058b8945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kUgeTWVZdFxYC3UvaA_xuw.png"/></div></div></figure><div class=""/><p id="ba1a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">根据维基百科，DDNS是:</p><blockquote class="ka kb kc"><p id="96eb" class="jc jd kd je b jf jg jh ji jj jk jl jm ke jo jp jq kf js jt ju kg jw jx jy jz hn dt translated"><em class="if">动态DNS(</em><a class="ae kh" href="https://hackernoon.com/tagged/ddns" rel="noopener ugc nofollow" target="_blank"><em class="if">【DDNS】</em></a><em class="if">或DynDNS)是一种自动更新域名系统(DNS)中的名称服务器的方法，通常是实时地，利用其配置的主机名、地址或其他信息的活动DDNS配置。—维基百科(</em> <a class="ae kh" href="https://en.wikipedia.org/wiki/Dynamic_DNS" rel="noopener ugc nofollow" target="_blank"> <em class="if">来源</em> </a> <em class="if"> ) </em></p></blockquote><p id="da3b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">DDNS服务最常见的用途是当您的IP地址动态变化时，访问您家中或办公室的计算机。你可能听说过像<a class="ae kh" href="https://dyn.com/dns/" rel="noopener ugc nofollow" target="_blank">动态域名</a>或<a class="ae kh" href="https://www.noip.com/" rel="noopener ugc nofollow" target="_blank">无IP </a>这样的服务。你创建帐户，在你的机器上安装客户端，他们给你一个域来访问你的计算机。这些服务最常见的缺点如下:</p><ul class=""><li id="7a15" class="ki kj if je b jf jg jj jk jn kk jr kl jv km jz kn ko kp kq dt translated">这些服务不是免费的(或在有限的时间内)</li><li id="3f7d" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">您绑定到一个DNS提供商</li><li id="b0b3" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">自定义域是一个额外的功能</li></ul><p id="ad35" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我希望在DDNS服务中看到哪些附加功能:</p><ul class=""><li id="a6ec" class="ki kj if je b jf jg jj jk jn kk jr kl jv km jz kn ko kp kq dt translated">指定的DNS记录应在IP更改时更新。不仅是A，还有TXT记录等等</li><li id="a246" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">当IP更改时，我希望得到通知</li><li id="e3e5" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">应该是免费的</li></ul><p id="6e10" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最终，我没有找到具备这种功能的服务，于是<a class="ae kh" href="https://github.com/skibish/ddns" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig">个人DDNS客户端</strong> </a>就这样诞生了。</p><p id="e42e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">决定在<a class="ae kh" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Golang </a>中编写客户端。</p><p id="c63f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于DNS提供商，我选择了数字海洋网络。为什么？</p><ul class=""><li id="209a" class="ki kj if je b jf jg jj jk jn kk jr kl jv km jz kn ko kp kq dt translated">我用数字海洋做宠物项目</li><li id="9b7d" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">他们的网络堆栈是免费的</li><li id="a836" class="ki kj if je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">数字海洋为他们的内部服务提供了惊人的API</li></ul><p id="87d5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">DigitalOcean DNS成为客户端的后端。为了让一切工作，你需要有一个数字海洋帐户，并设置一个你想使用的域名。你可以按照这个教程来设置你的域名。但是我们会继续。</p><h1 id="4420" class="kw kx if bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">如何设置DDNS客户端？</h1><p id="90fc" class="pw-post-body-paragraph jc jd if je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">这个例子将使用Ubuntu Linux。您可以将同样的方法应用于您喜欢的任何发行版。</p><h1 id="54c8" class="kw kx if bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">客户端安装</h1><p id="61d4" class="pw-post-body-paragraph jc jd if je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">首先要做的是，您应该使用以下命令下载客户端:</p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="b8cc" class="mi kx if me b fv mj mk l ml mm">&gt; curl -L https://github.com/skibish/ddns/releases/download/2.1.3/ddns-`uname -s`-`uname -m` &gt; /usr/local/bin/ddns</span><span id="b17d" class="mi kx if me b fv mn mk l ml mm">&gt; chmod +x /usr/local/bin/ddns</span></pre><p id="c8e4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在<code class="eh mo mp mq me b">ddns</code>二进制将在<code class="eh mo mp mq me b">/usr/local/bin/ddns</code>可用。要检查它是否已安装，请在终端中运行<code class="eh mo mp mq me b">ddns -h</code>。如果您将看到以下输出:</p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="0197" class="mi kx if me b fv mj mk l ml mm">Usage of ddns:<br/>  -check-period duration<br/>    	Check if IP has been changed period (default 5m0s)<br/>  -conf-file string<br/>    	Location of the configuration file (default "$HOME/.ddns.yml")<br/>  -req-timeout duration<br/>    	Request timeout to external resources (default 10s)</span></pre><p id="86c5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你已经准备好前进了。</p><h1 id="f647" class="kw kx if bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">配置文件设置</h1><p id="150b" class="pw-post-body-paragraph jc jd if je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">要通过DigitalOcean使用客户端，您需要获得OAuth令牌。如何生成，<a class="ae kh" href="https://www.digitalocean.com/community/tutorials/how-to-use-the-digitalocean-api-v2" rel="noopener ugc nofollow" target="_blank">看这里</a>。</p><p id="89a5" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">客户端需要一个配置文件，其中描述了更新DNS记录的规则。</p><p id="66a0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在您的主目录中创建一个名为<code class="eh mo mp mq me b">.ddns.yml</code>的文件。最简单的设置如下:</p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="cbdf" class="mi kx if me b fv mj mk l ml mm">token: "TOKEN"              # DigitalOcean token<br/>domain: "example.com"       # Domain to update<br/>records:                    # Records of the domain to update<br/>  - type: "A"               # Record type<br/>    name: "@"               # Record name</span></pre><p id="4c9a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这种情况下，域名<strong class="je ig">example.com</strong>中名为<strong class="je ig"> @ </strong>的记录<strong class="je ig">将被更新为您的IP。如果要更新多条记录，请添加它们。</strong></p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="85c3" class="mi kx if me b fv mj mk l ml mm">token: "TOKEN"<br/>domain: "example.com"<br/>records:<br/>  - type: "A"<br/>    name: "@"<br/>  - type: "A"<br/>    name: "www"<br/>  - type: "TXT"<br/>    name: "info"</span></pre><p id="659f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，如果您将启动客户端，一切都应该工作。</p><p id="aee3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">恭喜你！你有你自己的DDNS。</p><h1 id="6dd6" class="kw kx if bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">把DDNS放在背景中</h1><p id="34cc" class="pw-post-body-paragraph jc jd if je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">但是如何让它在后台工作呢？一个好的解决方案是在您的linux机器上注册一个新的服务。</p><p id="1cf8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建一个文件<code class="eh mo mp mq me b">/etc/systemd/system/ddns.service</code>(你想在<code class="eh mo mp mq me b">sudo</code>用户下创建这个文件)。将下面指定的配置粘贴到其中:</p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="58a6" class="mi kx if me b fv mj mk l ml mm">[Unit]<br/>Description=DDNS client with DigitalOcean as backend<br/>After=network.target<br/><br/>[Service]<br/>ExecStart=/usr/local/bin/ddns<br/>User=&lt;YOUR USERNAME&gt;<br/>Type=simple<br/>Restart=always<br/><br/>[Install]<br/>WantedBy=default.target</span></pre><p id="1f66" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在此配置中，将<code class="eh mo mp mq me b">&lt;YOUR USERNAME&gt;</code>更改为您的用户名。保存文件。</p><p id="2ec2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当您处于<code class="eh mo mp mq me b">sudo</code>用户状态时，启用并启动该服务。</p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="3cec" class="mi kx if me b fv mj mk l ml mm">$ systemctl enable ddns<br/>$ systemctl start ddns</span></pre><p id="798b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">酷，现在你有一个服务，将在计算机启动后启动。</p><h1 id="4e0a" class="kw kx if bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">高级配置</h1><p id="7206" class="pw-post-body-paragraph jc jd if je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">一开始，我说过，通过电子邮件获得通知是一个优势。如何设置通知？</p><p id="f5a7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">目前支持的通知只有SMTP。如果还有更多，你可以在项目的<a class="ae kh" href="https://github.com/skibish/ddns/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> README.md </a>中找到。</p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="6eb0" class="mi kx if me b fv mj mk l ml mm">token: "TOKEN"<br/>domain: "example.com"<br/>records:<br/>  - type: "A"<br/>    name: "@"<br/>notify:<br/>  smtp:<br/>    user: "foo@example.com"<br/>    password: "1234"<br/>    host: "smtp.example.com"<br/>    port: "465"<br/>    to: "foobar@gmail.com"<br/>    subject: "My DDNS sending me a message"<br/>    secure: true # Optional flag. Set it, if you will send emails with SSL</span></pre><p id="7347" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过这种配置，您现在可以发送电子邮件了。</p><p id="c4c2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但是你的邮件很可能会出现在垃圾邮件文件夹中。如何解决这个问题？我们可以为该域名创建SPF 记录，并为电子邮件提供商将您的IP标记为安全。</p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="2bae" class="mi kx if me b fv mj mk l ml mm">token: "TOKEN"<br/>domain: "example.com"<br/>records:<br/>  - type: "A"<br/>    name: "@"<br/>  - type: "TXT"<br/>    name: "@"<br/>    data: "v=spf1 ip4:{{.IP}} include:_spf.example.com ~all"<br/>notify:<br/>  smtp:<br/>    user: "foo@example.com"<br/>    password: "1234"<br/>    host: "smtp.example.com"<br/>    port: "465"<br/>    to: "foobar@gmail.com"<br/>    subject: "My DDNS sending me a message"<br/>    secure: true</span></pre><p id="ea34" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一条新的<strong class="je ig"> TXT </strong>记录被添加了一个<strong class="je ig">数据</strong>字段。该字段是可选的。但是当它被设置后，你可以使用<a class="ae kh" href="https://hackernoon.com/tagged/golang" rel="noopener ugc nofollow" target="_blank">Golang</a><a class="ae kh" href="https://golang.org/pkg/text/template/" rel="noopener ugc nofollow" target="_blank">text/template</a>引擎的全部潜力。在这种情况下，当IP将被更新时，这个TXT记录也将被更新。</p><p id="ba32" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用这个SPF记录的例子，考虑您需要再添加两个IP，但是它们是静态值。怎么办？对于这种情况，您有<strong class="je ig">参数</strong>。</p><pre class="lz ma mb mc fq md me mf mg aw mh dt"><span id="f8a2" class="mi kx if me b fv mj mk l ml mm">token: "TOKEN"<br/>domain: "example.com"<br/>records:<br/>  - type: "A"<br/>    name: "@"<br/>  - type: "TXT"<br/>    name: "@"<br/>    data: "v=spf1 ip4:{{.IP}} ip4:{{.ipOne}} ip4:{{.ipTwo}} include:_spf.example.com ~all"<br/>params:<br/>  ipOne: "10.10.10.10"<br/>  ipTwo: "20.20.20.20"<br/>notify:<br/>  smtp:<br/>    user: "foo@example.com"<br/>    password: "1234"<br/>    host: "smtp.example.com"<br/>    port: "465"<br/>    to: "foobar@gmail.com"<br/>    subject: "My DDNS sending me a message"<br/>    secure: true</span></pre><p id="bced" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正如你所看到的，设置是灵活的，你可以使用这个工具更新你的DNS中的很多东西。</p><h1 id="215e" class="kw kx if bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">下一步是什么</h1><p id="7545" class="pw-post-body-paragraph jc jd if je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">下一步是添加选择DNS提供商的功能，因为有人可能正在使用<a class="ae kh" href="https://www.cloudflare.com/dns/" rel="noopener ugc nofollow" target="_blank"> Cloudflare </a>。但这是下一个版本的一个步骤，我很乐意接受贡献:)</p><p id="30b8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae kh" href="https://github.com/skibish/ddns" rel="noopener ugc nofollow" target="_blank">个人DDNS已经开放，可以在GitHub上使用</a>。</p><figure class="lz ma mb mc fq hw"><div class="bz el l di"><div class="mr ms l"/></div></figure></div></div>    
</body>
</html>