<html>
<head>
<title>Building a simple offline-capable Notepad app using ServiceWorker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ServiceWorker构建一个简单的支持离线的记事本应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/building-a-simple-offline-capable-notepad-app-using-serviceworker-97b9b50767a5?source=collection_archive---------7-----------------------#2016-11-15">https://medium.com/hackernoon/building-a-simple-offline-capable-notepad-app-using-serviceworker-97b9b50767a5?source=collection_archive---------7-----------------------#2016-11-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="9ae3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">今天，我们将构建一个渐进式<a class="ae jp" href="https://hackernoon.com/tagged/notepad" rel="noopener ugc nofollow" target="_blank">记事本</a>应用程序，它可以很好地在离线模式下使用，在所有可用的设备上响应，并在设备上本地保存内容。所以，这个记事本的核心功能是让它离线工作。为了满足这个需求，我们将使用<a class="ae jp" href="https://developers.google.com/web/fundamentals/getting-started/primers/service-workers" rel="noopener ugc nofollow" target="_blank"> ServiceWorkers </a>，我将在下面介绍它。</p><h1 id="a1a4" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">向前</h1><h1 id="c5eb" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">什么是服务人员？</h1><p id="2de8" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">服务人员是一个在后台运行的脚本，独立于你的网页。它响应事件，包括从其服务的页面发出的网络请求。服务人员的寿命故意设计得很短。当它得到一个事件时就被唤醒，并且只在需要处理它的时候运行。</p><p id="0595" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">ServiceWorkers提供的首要特性是让webapp能够离线工作。除此之外，ServiceWorkers还包括类似<a class="ae jp" href="https://developers.google.com/web/updates/2015/03/push-notifications-on-the-open-web" rel="noopener ugc nofollow" target="_blank">推送通知</a>和<a class="ae jp" href="https://developers.google.com/web/updates/2015/12/background-sync" rel="noopener ugc nofollow" target="_blank">后台同步</a>的功能。未来，服务人员将支持定期同步或地理围栏等其他功能。本教程中讨论的核心特性是拦截和处理<a class="ae jp" href="https://hackernoon.com/tagged/network" rel="noopener ugc nofollow" target="_blank">网络</a>请求的能力，包括以编程方式管理响应缓存。</p><h1 id="c7cc" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">现在，我们来谈谈什么是渐进式Web App？</h1><p id="992c" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated"><em class="kt">渐进式web应用程序使用现代Web功能来提供类似应用程序的用户体验。它们从浏览器标签中的页面演变成身临其境的顶级应用，时刻保持着网络的低摩擦。</em></p><ul class=""><li id="8cbb" class="ku kv hu it b iu iv iy iz jc kw jg kx jk ky jo kz la lb lc dt translated">这意味着一个进步的web应用应该是响应性的、独立于连接的、类似应用的、新鲜的、可安装的等等。因此，要使我们的记事本成为一个进步的网络应用，我们需要包括所有上述功能。让我们开始吧。</li></ul><h1 id="3f36" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">构建记事本</h1><p id="febd" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">让我们首先在您最喜欢的本地web服务器上创建一个名为Notepad的文件夹(在我的例子中，我使用了<a class="ae jp" href="https://www.apachefriends.org/index.html" rel="noopener ugc nofollow" target="_blank"> XAMPP </a>),并将以下文件添加到其中:</p><ul class=""><li id="0686" class="ku kv hu it b iu iv iy iz jc kw jg kx jk ky jo kz la lb lc dt translated"><code class="eh ld le lf lg b">index.html</code></li><li id="a51e" class="ku kv hu it b iu lh iy li jc lj jg lk jk ll jo kz la lb lc dt translated"><code class="eh ld le lf lg b">sw.js</code> -我们将在这里编写ServiceWorker逻辑</li><li id="6baf" class="ku kv hu it b iu lh iy li jc lj jg lk jk ll jo kz la lb lc dt translated">清单让你的网络应用在用户的主屏幕上有一个更像本地人的外观。它允许应用程序以全屏模式启动(没有地址栏)，提供对屏幕方向的控制，并且在Android上的Chrome的最新版本中，支持为地址栏定义<a class="ae jp" href="https://developers.google.com/web/updates/2015/10/splashscreen?hl=en" rel="noopener ugc nofollow" target="_blank">闪屏</a>和<a class="ae jp" href="https://developers.google.com/web/updates/2014/11/Support-for-theme-color-in-Chrome-39-for-Android?hl=en" rel="noopener ugc nofollow" target="_blank">主题颜色</a>。它还用于根据前面提到的闪屏和主屏幕图标的大小和密度来定义一组图标。</li></ul><p id="adb0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，我们要做的第一件事是当我们的应用程序第一次访问浏览器时注册一个<code class="eh ld le lf lg b">ServiceWorker</code>。为此，在根目录下创建一个名为<code class="eh ld le lf lg b">js</code>的文件夹，并将文件<code class="eh ld le lf lg b">app.js</code>添加到其中，并在该文件中添加以下代码。</p><figure class="lm ln lo lp fq lq"><div class="bz el l di"><div class="lr ls l"/></div></figure><p id="977c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以上代码将尝试检查当前浏览器是否支持<code class="eh ld le lf lg b">ServiceWorker</code>，如果支持，它将注册一个。注意，我们已经在register函数中传递了一个名为<code class="eh ld le lf lg b">sw.js</code>的文件，这个文件我们还没有创建。</p><p id="a627" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在根目录下创建一个名为<code class="eh ld le lf lg b">sw.js</code>的文件，并在其中添加以下内容。</p><figure class="lm ln lo lp fq lq"><div class="bz el l di"><div class="lr ls l"/></div></figure><p id="e6c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意，如果您想要在服务工作器中导入任何外部脚本，您可以使用importScripts()来完成。在本例中，我们将使用<a class="ae jp" href="https://github.com/coonsta/cache-polyfill" rel="noopener ugc nofollow" target="_blank"> cache-polyfill </a>，因为对缓存的支持是有限的。</p><p id="b01e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，我们需要缓存第一次注册<code class="eh ld le lf lg b">ServiceWorker</code>时想要缓存的所有文件。为了做到这一点，我们将在<code class="eh ld le lf lg b">var CACHE_VERSION = 'app-v10';</code>行后添加以下内容:</p><pre class="lm ln lo lp fq lt lg lu lv aw lw dt"><span id="0254" class="lx jr hu lg b fv ly lz l ma mb">var CACHE_FILES = [<br/>    '/',<br/>    'index.html',<br/>    'js/app.js',<br/>    'css/style.css',<br/>    'favicon.ico',<br/>    'manifest.json'<br/>];</span></pre><p id="a761" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所有这些文件都将被缓存以供脱机使用。这里你可以看到我们用我们想要的缓存名(在我们的例子中是<code class="eh ld le lf lg b">CACHE_VERSION </code>)调用<code class="eh ld le lf lg b">caches.open()</code>，之后我们调用cache.addAll()并传入我们的文件数组，即<code class="eh ld le lf lg b">CACHE_FILES</code>。</p><p id="9a2e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我们将把以下内容添加到文件<code class="eh ld le lf lg b">manifest.json</code>中。</p><figure class="lm ln lo lp fq lq"><div class="bz el l di"><div class="lr ls l"/></div></figure><p id="6498" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以在这里看到，我们在<code class="eh ld le lf lg b">short_name</code>中提供了我们的应用程序名称，应用程序的默认方向是<code class="eh ld le lf lg b">standalone</code>，我们还提供了我们应用程序的不同大小的图标，您可以从<a class="ae jp" href="https://github.com/amitmerchant1990/notepad/tree/master/img" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="150a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们转到<code class="eh ld le lf lg b">index.html</code>并添加以下内容:</p><figure class="lm ln lo lp fq lq"><div class="bz el l di"><div class="lr ls l"/></div></figure><p id="e976" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，正如你在这里看到的，我们已经取得了一个文本区，并给了它<code class="eh ld le lf lg b">id</code> = <code class="eh ld le lf lg b">note</code>，我们将使用它来跟踪文本区的<code class="eh ld le lf lg b">onKeyUp</code>事件。为此，我们将使用<a class="ae jp" href="https://jquery.com/" rel="noopener ugc nofollow" target="_blank"> jQuery </a>。我们还要注意，为了让应用程序在所有设备上都响应，我们使用了<a class="ae jp" href="http://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank"> Bootstrap </a>。我已经在<code class="eh ld le lf lg b">index.html</code>中包含了所有必要的文件。你可以从<a class="ae jp" href="https://github.com/amitmerchant1990/notepad/tree/master/js" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae jp" href="https://github.com/amitmerchant1990/notepad/tree/master/css" rel="noopener ugc nofollow" target="_blank">这里</a>得到所有需要的文件，并将它们添加到相关的文件夹中。我还包含了文件<a class="ae jp" href="https://github.com/amitmerchant1990/notepad/blob/master/css/style.css" rel="noopener ugc nofollow" target="_blank"> style.css </a>，该文件将对页面进行一些必要的修改，使其具有响应性。</p><p id="ff62" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，再次移动到文件<code class="eh ld le lf lg b">js/app.js</code>并添加以下内容:</p><figure class="lm ln lo lp fq lq"><div class="bz el l di"><div class="lr ls l"/></div></figure><p id="1fac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如你所看到的，我们有textarea的事件，这样它将在用户输入时获取文本，并将其保存到“本地存储”</p><pre class="lm ln lo lp fq lt lg lu lv aw lw dt"><span id="e326" class="lx jr hu lg b fv ly lz l ma mb">if(localStorage.getItem("note") &amp;&amp; localStorage.getItem("note")!=''){<br/>    var noteItem = localStorage.getItem("note")<br/>    $('#note').val(noteItem);<br/>  }</span></pre><p id="fdc2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以上代码将检查<code class="eh ld le lf lg b">localStorage</code>中是否有任何内容，如果有，将在用户下次访问网站时用可用内容填充<code class="eh ld le lf lg b">textarea</code>。</p><p id="42fa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，再次移动到<code class="eh ld le lf lg b">sw.js</code>文件，并将所有剩余文件添加到<code class="eh ld le lf lg b">CACHE_FILES</code>中。</p><pre class="lm ln lo lp fq lt lg lu lv aw lw dt"><span id="5474" class="lx jr hu lg b fv ly lz l ma mb">var CACHE_FILES = [<br/>    '/',<br/>    'index.html',<br/>    'js/app.js',<br/>    'js/jquery.min.js',<br/>    'js/bootstrap.min.js',<br/>    'css/bootstrap.min.css',<br/>    'css/style.css',<br/>    'manifest.json',<br/>    'img/icon-48.png',<br/>    'img/icon-96.png',<br/>    'img/icon-144.png',<br/>    'img/icon-196.png'<br/>];</span></pre><p id="37aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">把上面所有的零碎东西放在正确的地方，我们的记事本应用程序现在可以离线使用了。前往<a class="ae jp" href="http://localhost/" rel="noopener ugc nofollow" target="_blank"> http://localhost </a>或相关的本地web服务器URL，并检查最终的应用程序。</p><p id="815e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以查看整个<a class="ae jp" href="https://github.com/amitmerchant1990/notepad" rel="noopener ugc nofollow" target="_blank">代码库</a>或者查看<a class="ae jp" href="https://www.amitmerchant.com/notepad/" rel="noopener ugc nofollow" target="_blank">演示</a>。</p><p id="84ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者你可以在这里看到它的动作<a class="ae jp" href="https://twitter.com/amit_merchant/status/756876111959601152" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="0c06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">发现任何错别字或想要贡献？通过分叉和发送您的修复和建议来帮助我们改进我们的文档。<a class="ae jp" href="https://github.com/amitmerchant1990/amitmerchant1990.github.io/blob/master/_posts/2016-11-15-Building-Simple-Offline-Notepad-Using-Service-Worker.md" rel="noopener ugc nofollow" target="_blank">改进本页！</a></p><p id="39df" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kt">感谢阅读！</em></p><blockquote class="mc md me"><p id="bd9e" class="ir is kt it b iu iv iw ix iy iz ja jb mf jd je jf mg jh ji jj mh jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿妹家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is kt it b iu iv iw ix iy iz ja jb mf jd je jf mg jh ji jj mh jl jm jn jo hn dt translated">要了解更多信息，请阅读我们的“关于”页面、<a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书</a>上给我们点赞/发消息，或者简单地发送<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is kt it b iu iv iw ix iy iz ja jb mf jd je jf mg jh ji jj mh jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lm ln lo lp fq lq"><div class="bz el l di"><div class="mi ls l"/></div></figure></div></div>    
</body>
</html>