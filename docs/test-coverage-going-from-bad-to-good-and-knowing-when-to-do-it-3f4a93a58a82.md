# 测试覆盖率:从差到好，并且知道什么时候做

> 原文：<https://medium.com/hackernoon/test-coverage-going-from-bad-to-good-and-knowing-when-to-do-it-3f4a93a58a82>

![](img/337d9b1c5024c9ed81227e92c182659a.png)

拥有具有良好测试覆盖率的产品代码对开发团队非常有益。

广泛的覆盖可以捕获进入代码库的 bug 和意外行为，每个人晚上都可以睡得更好，但是当一个代码库没有太多覆盖(或者根本没有覆盖)时，引入它可能真的很难。

我们将讨论您何时应该引入或增加测试覆盖率，并深入探讨它对您和您的团队有益的方式。

# 遗留代码库的覆盖率？

作为一个对测试深信不疑的人，我会齐心协力地为我参与的每个项目增加覆盖率。然而实际上，有时候测试并没有那么有益。

例如，当处理遗留代码库(很少更新的内部 API)时，增加覆盖范围会降低回报。

如果您的遗留代码库在生产中工作可靠，几乎没有回归，那么追溯性地添加测试可能只是为了验证已经在生产中验证的内容。

通常，应用程序的遗留部分充当依赖关系，所以我建议您将精力集中在利用旧代码测试新 API 上。

# 仍然不确定保险的好处？

以下是增加测试覆盖率的一些好处:

*   确保您的代码按预期工作
*   更加自信地部署代码
*   降低凌晨 1 点打电话的可能性

## 确保您的代码按预期工作

添加测试鼓励你概念化你想要你的程序如何运行，并考虑到边缘情况。

## 更加自信地部署代码

您的覆盖范围越大，您就越有信心新特性不会引入回归。如果部署引入了一个 bug，测试可以作为追踪 bug 和消灭它的文档。

## 降低凌晨 1 点打电话的可能性

传呼机任务并不好玩。说真的。

对给你打电话的人来说也不好玩。

增加覆盖率将有助于防止那些习惯在半夜把你吵醒的 bug。
未来你会感激的。

> 好吧，我被说服了！我如何开始添加保险？

一旦你的团队开始增加测试覆盖率，我建议首先为新的特性工作编写测试。
通过这种方式，代码库的新变化被覆盖，良好的习惯将开始在团队成员中形成(反过来，新员工也是)。

您的下一个优先事项应该是增加现有代码(非遗留)的覆盖率，但是这必须非常小心地完成。

通常有两种方法:

*   放弃现有的实现，一次一个独立的模块，并测试其代码的重建
*   添加测试来验证现有代码。

## 报废和试驾

优点:

*   废弃和测试驱动可能会带来更好的设计和代码清晰度。
*   这些测试将作为你的队友和未来自己的一种文档形式。

缺点:

*   丢弃现有代码可能会导致您错过在实现中不清楚的特定业务案例。

## 向预先存在的代码添加覆盖率

优点:

*   通常比报废和试驾更快
*   覆盖现有的 API 可以使重构更容易

缺点:

*   可能只是为了验证糟糕的设计。

# 副作用

测试当然有一个学习曲线，所以你的团队可能会提前花时间弄清楚如何最好地测试新的和旧的代码。

这可能会导致冲刺速度的降低，并可能在故事评估中需要更多的复杂性点。

也就是说，向新功能添加测试将减少 bug，从而降低以后必须消除 bug 的成本，并且向现有代码添加覆盖范围将偿还技术债务，如果不偿还，这些债务可能会造成严重后果。

# 摘要

总而言之，增加测试覆盖率将会改进设计，增加团队的信心和凝聚力，并减少与回归相关的压力。

*原贴于* [*跨步博客*](https://www.stridenyc.com/blog/test-coverage-going-from-bad-to-good-and-knowing-when-to-do-it) *。* [*迈克尔努内斯*](https://www.stridenyc.com/blog/author/michael-nunez) 撰写