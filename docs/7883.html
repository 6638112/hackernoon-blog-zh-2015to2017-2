<html>
<head>
<title>Build RESTful API in Go and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go和MongoDB中构建RESTful API</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-restful-api-in-go-and-mongodb-5e7f2ec4be94?source=collection_archive---------1-----------------------#2017-11-11">https://medium.com/hackernoon/build-restful-api-in-go-and-mongodb-5e7f2ec4be94?source=collection_archive---------1-----------------------#2017-11-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/77431335b9ab091ff5849b1409650f72.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*WpUuwCQZWhVzP3X0Gibaqw.png"/></div></figure><p id="408f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在本教程中，我将说明如何在<strong class="ja hv"> Go </strong>和<strong class="ja hv"> MongoDB </strong>中构建自己的<strong class="ja hv"> RESTful API </strong>。这个演示中使用的所有代码都可以在我的<a class="ae jw" href="https://github.com/mlabouardy/movies-restapi" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。</p><p id="954b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 1 — API规范</strong></p><p id="a92f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">REST API服务将公开端点来管理电影商店。我们的端点将允许的操作有:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/48863c8c649c796c3e20c6754e859f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/0*HU6ti25J9Y_hJQjl."/></div></figure><p id="31c1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 2 —获取依赖关系</strong></p><p id="395c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在开始之前，我们需要获得设置API所需的包:</p><blockquote class="kc kd ke"><p id="27f7" class="iy iz kf ja b jb jc jd je jf jg jh ji kg jk jl jm kh jo jp jq ki js jt ju jv hn dt translated">去找github.com/BurntSushi/toml·gopkg.in/mgo.v2·github.com/gorilla/mux</p></blockquote><ul class=""><li id="ee15" class="kj kk hu ja b jb jc jf jg jj kl jn km jr kn jv ko kp kq kr dt translated"><a class="ae jw" href="https://github.com/BurntSushi/toml" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv"> toml </strong> </a>:解析配置文件(<strong class="ja hv"> MongoDB </strong>服务器&amp;凭证)</li><li id="1c1d" class="kj kk hu ja b jb ks jf kt jj ku jn kv jr kw jv ko kp kq kr dt translated"><a class="ae jw" href="https://github.com/gorilla/mux" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv"> mux </strong> </a>:请求路由器和调度器，用于将传入的请求匹配到各自的处理程序</li><li id="4720" class="kj kk hu ja b jb ks jf kt jj ku jn kv jr kw jv ko kp kq kr dt translated"><a class="ae jw" href="https://github.com/go-mgo/mgo" rel="noopener ugc nofollow" target="_blank"><strong class="ja hv">MgO</strong></a>:<strong class="ja hv">MongoDB</strong>驱动</li></ul><p id="da72" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 3 — API结构</strong></p><p id="4b6f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">安装完依赖项后，我们创建一个名为“<strong class="ja hv"> app.go </strong>”的文件，内容如下:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="f7cd" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">上面的代码为每个端点创建一个控制器，然后在端口<strong class="ja hv"> 3000 </strong>上公开一个<strong class="ja hv">HTTP</strong>T36】服务器。</p><p id="1d59" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:我们使用<strong class="ja hv">获取</strong>、<strong class="ja hv">发布</strong>、<strong class="ja hv">放置</strong>、<strong class="ja hv">删除</strong>。我们还定义了可以传入的参数</p><p id="daaa" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">要在本地运行服务器，请键入以下命令:</p><blockquote class="kc kd ke"><p id="45f0" class="iy iz kf ja b jb jc jd je jf jg jh ji kg jk jl jm kh jo jp jq ki js jt ju jv hn dt translated">去运行app.go</p></blockquote><p id="4848" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果你将浏览器指向<a class="ae jw" href="http://localhost:3000/movies" rel="noopener ugc nofollow" target="_blank"><strong class="ja hv">http://localhost:3000/movies</strong></a>，你应该会看到:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff kz"><img src="../Images/9af8a6cae1c9d8c7a872783271e0fa38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/0*qm349VkFrJOIOhA2."/></div></figure><p id="95bf" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 4 —型号</strong></p><p id="d5c1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在我们有了一个最小的应用程序，是时候创建一个基本的<strong class="ja hv">电影</strong>模型了。在<strong class="ja hv"> Go </strong>中，我们使用<strong class="ja hv"> struct </strong>关键字创建一个模型:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="b926" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">接下来，我们将创建<strong class="ja hv">数据访问对象</strong>来管理数据库操作。</p><p id="f71b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 5 —数据访问对象</strong></p><p id="cd07" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 5.1 —建立连接</strong></p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="ec6e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">顾名思义，<strong class="ja hv"> connect() </strong>方法建立到<strong class="ja hv"> MongoDB数据库的连接。</strong></p><p id="8843" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 5.2 —数据库查询</strong></p><p id="08e3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">实现相对简单，只包括使用<strong class="ja hv">数据库发布权限方法。</strong>c(集合)对象并返回结果。这些方法可以按如下方式实现:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="5f49" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 6 —设置API端点</strong></p><p id="407d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 6.1 —制作电影</strong></p><p id="7423" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">更新<strong class="ja hv"> CreateMovieEndpoint </strong>方法，如下所示:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="e1b8" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">它将请求体解码成一个<strong class="ja hv">电影</strong>对象，赋予它一个<strong class="ja hv"> ID </strong>，并使用<strong class="ja hv">DAO</strong>T16】Insert方法在数据库中创建一个<strong class="ja hv">电影</strong>。</p><p id="6fcd" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们来测试一下:</p><p id="6d32" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">同<a class="ae jw" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv">邮差</strong> </a>:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="fe ff la"><img src="../Images/f0f00400f28e716347e01047e1e80cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2jQa17u6vC0tvJbm."/></div></div></figure><p id="1ef3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">用<strong class="ja hv">卷曲</strong></p><blockquote class="kc kd ke"><p id="3c4f" class="iy iz kf ja b jb jc jd je jf jg jh ji kg jk jl jm kh jo jp jq ki js jt ju jv hn dt translated">curl-sSX POST-d ' { " name ":" Dunkirk "，" cover _ image ":"<a class="ae jw" href="https://image.tmdb.org/t/p/w640/cUqEgoP6kj8ykfNjJx3Tl5zHCcN.jpg" rel="noopener ugc nofollow" target="_blank">https://image . tmdb . org/t/p/w640/cuqegop 6 kj 8 ykfnjjx 3tl 5 zh ccn . jpg</a>，"描述":"二战电影" } '<a class="ae jw" href="http://localhost:3000/movies" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/movies</a>| jq ' . "</p></blockquote><p id="9204" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 6.2 —电影列表</strong></p><p id="d72d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">下面的代码不言自明:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="7c42" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">它使用<strong class="ja hv"> DAO </strong>的<strong class="ja hv"> FindAll </strong>方法从数据库中获取电影列表。</p><p id="dc77" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们来测试一下:</p><p id="f1ed" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">同<a class="ae jw" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv">邮递员</strong> </a>:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="fe ff lf"><img src="../Images/6b316e46b96e6d7ee8e2ca37134a2b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kO9iTOKL0kKa3L-l."/></div></div></figure><p id="7295" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">带<strong class="ja hv">卷曲</strong>:</p><blockquote class="kc kd ke"><p id="8e09" class="iy iz kf ja b jb jc jd je jf jg jh ji kg jk jl jm kh jo jp jq ki js jt ju jv hn dt translated">' curl-sSX GET<a class="ae jw" href="http://localhost:3000/movies" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/movies</a>| jq ' . '</p></blockquote><p id="f7f6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 6.3 —查找电影</strong></p><p id="378c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们将使用<strong class="ja hv"> mux </strong>库来获取用户通过请求传入的参数:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="b4f7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们来测试一下:</p><p id="6e99" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">同<a class="ae jw" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv">邮递员</strong> </a>:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="fe ff lg"><img src="../Images/d103a861e468407ad982afcbacaa598c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LILL9i7HPAdhhkGe."/></div></div></figure><p id="64e4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">带<strong class="ja hv">卷曲</strong>:</p><blockquote class="kc kd ke"><p id="3b7c" class="iy iz kf ja b jb jc jd je jf jg jh ji kg jk jl jm kh jo jp jq ki js jt ju jv hn dt translated">' curl-sSX GET<a class="ae jw" href="http://localhost:3000/movies/599570faf0429b4494cfa5d4" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/movies/599570 faf 0429 b 4494 CFA 5d 4</a>| jq ' . '</p></blockquote><p id="8343" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 6.4 —更新现有电影</strong></p><p id="e27d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">更新<strong class="ja hv"> UpdateMovieEndPoint </strong>方法，如下所示:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="96ca" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们来测试一下:</p><p id="c82e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">同<a class="ae jw" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv">邮递员</strong> </a>:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="fe ff lh"><img src="../Images/07d173f09d77c2f7a9ad726a3cff4e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XU-Q4mnOOJam76Yu."/></div></div></figure><p id="9023" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">带<strong class="ja hv">卷曲</strong>:</p><blockquote class="kc kd ke"><p id="4da2" class="iy iz kf ja b jb jc jd je jf jg jh ji kg jk jl jm kh jo jp jq ki js jt ju jv hn dt translated">' curl -sSX PUT -d '{"name":"dunkirk "，" cover _ image ":"<a class="ae jw" href="https://image.tmdb.org/t/p/w640/cUqEgoP6kj8ykfNjJx3Tl5zHCcN.jpg" rel="noopener ugc nofollow" target="_blank">https://image . tmdb . org/t/p/w640/cuqegop 6 kj 8 ykfnjjx 3tl 5 zh ccn . jpg</a>，" description ":"二战电影" } '<a class="ae jw" href="http://localhost:3000/movies" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/movies</a>| jq ' . '</p></blockquote><p id="5d2c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 6.5 —删除现有电影</strong></p><p id="61db" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">更新<strong class="ja hv"> DeleteMovieEndPoint </strong>方法，如下所示:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kx ky l"/></div></figure><p id="7944" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们来测试一下:</p><p id="e3f4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">同<a class="ae jw" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv">邮递员</strong> </a>:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="fe ff li"><img src="../Images/b33801ee9f868bdddcd4e223325d413e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*utDTGRWvGBTMkx71."/></div></div></figure><p id="9a76" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">带<strong class="ja hv">卷曲</strong>:</p><blockquote class="kc kd ke"><p id="b746" class="iy iz kf ja b jb jc jd je jf jg jh ji kg jk jl jm kh jo jp jq ki js jt ju jv hn dt translated">' curl-sSX DELETE-d ' { " name ":" Dunkirk "，" cover _ image ":"<a class="ae jw" href="https://image.tmdb.org/t/p/w640/cUqEgoP6kj8ykfNjJx3Tl5zHCcN.jpg" rel="noopener ugc nofollow" target="_blank">https://image . tmdb . org/t/p/w640/cuqegop 6 kj 8 ykfnjjx 3tl 5 zh ccn . jpg</a>，" description ":"二战电影" } '<a class="ae jw" href="http://localhost:3000/movies" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/movies</a>| jq ' . '</p></blockquote><p id="a90d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">更进一步吗？在我接下来的文章中，我将向你展示如何:</p><ul class=""><li id="e35d" class="kj kk hu ja b jb jc jf jg jj kl jn km jr kn jv ko kp kq kr dt translated">在<strong class="ja hv"> Go </strong>中为每个端点编写<strong class="ja hv">单元测试</strong></li><li id="47a4" class="kj kk hu ja b jb ks jf kt jj ku jn kv jr kw jv ko kp kq kr dt translated">在<strong class="ja hv"> Angular 4 </strong>中构建一个UI</li><li id="9918" class="kj kk hu ja b jb ks jf kt jj ku jn kv jr kw jv ko kp kq kr dt translated">用<strong class="ja hv"> CircleCI </strong>设置一个<strong class="ja hv"> CI/CD </strong></li><li id="b424" class="kj kk hu ja b jb ks jf kt jj ku jn kv jr kw jv ko kp kq kr dt translated">在<strong class="ja hv"> AWS </strong>上部署堆栈等等…</li></ul><p id="0d27" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">敬请关注！</p></div></div>    
</body>
</html>