<html>
<head>
<title>Redux Logging in Production</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">生产中的冗余日志记录</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/redux-logging-in-production-d489d614de78?source=collection_archive---------3-----------------------#2017-06-02">https://medium.com/hackernoon/redux-logging-in-production-d489d614de78?source=collection_archive---------3-----------------------#2017-06-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/f0900b188029ab125e1715e0ac112642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TMvybHHWRGUicsH7LtET9A.png"/></div></div></figure><p id="b5bf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">理解网络应用中的问题很难。在神秘的JavaScript错误、用户报告的bug和QA中发现的问题之间，有一个持续的斗争来超越影响用户的问题。这些只是显而易见的问题——大多数bug实际上从未被报告过，因为有糟糕体验的用户只是离开或默默忍受。</p><p id="885a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了解决这个问题，开发人员越来越多地采用前端日志工具，因为像Redux这样的现代状态管理库会留下丰富的审计线索。记录生产中的操作和状态使得理解错误和用户报告的问题变得容易。</p><p id="fa68" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本文中，我将向您展示如何使用LogRocket设置Redux日志记录。然后，我将讨论使Redux应用程序更容易调试的技术。</p><h1 id="b177" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">LogRocket:网络应用的DVR</h1><figure class="kz la lb lc fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ky"><img src="../Images/b47f54e433b8f39f62f5fffc5232dd8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_rMyo6NbrAsP-XtvBaXFg.png"/></div></div></figure><p id="3a63" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">LogRocket 是一个前端日志工具，可以让你回放问题，就像它们发生在你自己的浏览器中一样。LogRocket不需要猜测错误发生的原因，也不需要向用户询问截图和日志转储，而是让您重放会话以快速了解哪里出错了。它可以与任何应用程序完美配合，不管是什么框架，并且有插件可以记录来自Redux、Vuex和@ngrx/store的额外上下文。</p><p id="3d58" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">除了记录Redux操作和状态，LogRocket还记录控制台日志、JavaScript错误、堆栈跟踪、带有头+正文的网络请求/响应、浏览器元数据和自定义日志。它还使用DOM来记录页面上的HTML和CSS，甚至为最复杂的单页面应用程序重新创建像素级完美视频。</p><h1 id="c820" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">设置LogRocket</h1><p id="77e0" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">设置LogRocket很容易，只需要在应用程序中添加几行代码:</p><ol class=""><li id="fb7f" class="lj lk hu je b jf jg jj jk jn ll jr lm jv ln jz lo lp lq lr dt translated">用NPM安装:<code class="eh ls lt lu lv b">npm i --save logrocket</code>。</li><li id="4603" class="lj lk hu je b jf lw jj lx jn ly jr lz jv ma jz lo lp lq lr dt translated">在<a class="ae ld" href="https://app.logrocket.com" rel="noopener ugc nofollow" target="_blank">https://app.logrocket.com</a>创建一个免费账户，并记下你的申请id。</li><li id="769c" class="lj lk hu je b jf lw jj lx jn ly jr lz jv ma jz lo lp lq lr dt translated">在应用程序中初始化LogRocket:</li></ol><pre class="kz la lb lc fq mb lv mc md aw me dt"><span id="6958" class="mf kb hu lv b fv mg mh l mi mj">import LogRocket from 'logrocket';</span><span id="11a2" class="mf kb hu lv b fv mk mh l mi mj">// Initialize LogRocket with your app ID<br/>LogRocket.init(&lt;your_application_id&gt;);</span></pre><p id="bd9b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.添加Redux中间件。</p><pre class="kz la lb lc fq mb lv mc md aw me dt"><span id="62d9" class="mf kb hu lv b fv mg mh l mi mj">import { applyMiddleware, createStore } from 'redux';</span><span id="e16d" class="mf kb hu lv b fv mk mh l mi mj">const store = createStore(<br/>  reducer, // your app reducer<br/>  applyMiddleware(middlewares, LogRocket.reduxMiddleware()),<br/>);</span></pre><p id="a7ee" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是基本设置——这是您开始使用LogRocket所需要的全部内容！</p><p id="20be" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">LogRocket也有用于替代Flux实现的插件，比如<strong class="je hv"> ngrx </strong>和<strong class="je hv"> vuex </strong>，你可以在这里阅读关于<a class="ae ld" href="https://docs.logrocket.com" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><h1 id="1339" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">重放用户会话</h1><figure class="kz la lb lc fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ml"><img src="../Images/eb6d2be2c3b9856adf247768e7eb7b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wMR7GLnb4tFr_BGtHWDdng.png"/></div></div></figure><p id="7b03" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在LogRocket中重放会话就像在自己的浏览器中看到它发生一样。您可以使用完整的操作负载以及前一个和下一个状态来检查Redux操作。</p><figure class="kz la lb lc fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mm"><img src="../Images/7078d13bbed3fec69e86cf8518ffa0d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*04LiMHudqAfQRjJAgFSHsA.png"/></div></div></figure><p id="7c6d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">LogRocket捕获网络请求和响应，并允许您深入研究特定的请求，查看头部和主体。瀑布图显示了计时，可以很容易地看出哪些请求很慢，或者是否发生了潜在的争用情况。</p><figure class="kz la lb lc fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/7940f4fd36b19166730cee5ac220e823.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DyC3ZdR8nBmLwfs-0_D3GA.png"/></div></div></figure><p id="2430" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有时候，仅靠Redux日志不足以理解一个bug，尤其是在处理用户报告的问题时。LogRocket的视频回放可以让你准确地看到用户在你的应用中看到了什么。</p><p id="c3b8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">由于这个视频实际上是DOM的重建(而不是真实的视频)，你可以检查HTML/CSS以了解视觉错误，或者以两倍的速度播放以快速了解用户在处理支持问题时在应用中做了什么。</p></div><div class="ab cl mo mp hc mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hn ho hp hq hr"><h1 id="a8b8" class="ka kb hu bd kc kd mv kf kg kh mw kj kk kl mx kn ko kp my kr ks kt mz kv kw kx dt translated">将Redux日志集成到您的工作流中</h1><p id="3ed4" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">能够重放用户会话和查看Redux日志在整个开发工作流程中很有帮助。</p><h2 id="7091" class="mf kb hu bd kc na nb nc kg nd ne nf kk jn ng nh ko jr ni nj ks jv nk nl kw nm dt translated"><strong class="ak">修复bug</strong></h2><figure class="kz la lb lc fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nn"><img src="../Images/947b2d079f03ec939ab81fc5de0c0830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6fTDtvXA96V622yi9LtxoQ.png"/></div></div></figure><p id="077a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">LogRocket集成了错误报告工具，如Sentry和Bugsnag，让您看到每个bug的Redux日志和视频。这不仅有助于修复错误，也有助于理解错误的影响，因为有些JavaScript错误是完全无害的。通过观看错误发生时的视频，您可以很容易地判断它是否实际影响了用户，或者可以忽略。</p><h2 id="9917" class="mf kb hu bd kc na nb nc kg nd ne nf kk jn ng nh ko jr ni nj ks jv nk nl kw nm dt translated"><strong class="ak">支持</strong></h2><p id="9f17" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">很多时候，用户会报告问题，但不会给出足够的上下文来弄清楚到底发生了什么。</p><p id="c31d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你正在使用像<a class="ae ld" href="https://intercom.com" rel="noopener ugc nofollow" target="_blank">对讲机</a>这样的聊天支持工具，你可以直接集成LogRocket，这样每当用户开始聊天时，它就会添加一个带有录音URL的注释。</p><figure class="kz la lb lc fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff no"><img src="../Images/391d8cc477671cde0142b11da7110df0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mUcIXjRe7JA_rOJ1YICiKg.png"/></div></div></figure><p id="7fa5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您正在集成一个更通用的分析工具，您可以使用如下跟踪API添加记录URL:</p><pre class="kz la lb lc fq mb lv mc md aw me dt"><span id="f06d" class="mf kb hu lv b fv mg mh l mi mj">LogRocket.getSessionURL(function (sessionURL) {<br/>  analytics.track('LogRocket recording', sessionURL);<br/>})</span></pre></div><div class="ab cl mo mp hc mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hn ho hp hq hr"><h1 id="92c5" class="ka kb hu bd kc kd mv kf kg kh mw kj kk kl mx kn ko kp my kr ks kt mz kv kw kx dt translated">充分利用生产冗余测井</h1><p id="8597" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">生产日志在所有Redux应用程序中都非常有用，但是通过在设计应用程序时考虑日志，可以确保日志在调试问题时发挥最大作用。</p><h2 id="65bd" class="mf kb hu bd kc na nb nc kg nd ne nf kk jn ng nh ko jr ni nj ks jv nk nl kw nm dt translated"><strong class="ak">尽量保持Redux中的大部分状态</strong></h2><p id="32bb" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">我不想在这里讨论本地状态和Redux状态，但是当决定一个给定的状态是否应该在Redux中时，问问你自己在调试问题时看到那个状态是否有帮助。如果答案是肯定的，考虑将该状态放在Redux中，这样它将与崩溃报告和用户问题一起被记录。</p><h2 id="62bd" class="mf kb hu bd kc na nb nc kg nd ne nf kk jn ng nh ko jr ni nj ks jv nk nl kw nm dt translated"><strong class="ak">使用利用Redux的数据提取库</strong></h2><p id="4ff6" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">像GraphQL的<strong class="je hv"> apollo-client </strong>和REST的<strong class="je hv"> redux-query </strong>这样的库都有助于通过redux从网络获取数据。它们使用Redux作为持久层，这意味着在调试问题时，您可以检查您的Redux日志，以查看这些客户端获取了什么数据。</p><p id="43b4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您喜欢更简单的方法，您可以通过在查询和从网络接收数据时简单地分派显式操作来构建自己的数据获取“框架”。</p><h2 id="d418" class="mf kb hu bd kc na nb nc kg nd ne nf kk jn ng nh ko jr ni nj ks jv nk nl kw nm dt translated"><strong class="ak">使用Redux处理不确定性来源</strong></h2><p id="64eb" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">当从websockets、local storage、IndexedDB甚至Date()等API访问数据时，考虑调度Redux操作的结果，以便将来可以轻松地调试这些操作。例如，当监听websocket时，在每个消息上分派一个Redux动作——这样就可以在Redux日志中看到数据。</p><h2 id="5a29" class="mf kb hu bd kc na nb nc kg nd ne nf kk jn ng nh ko jr ni nj ks jv nk nl kw nm dt translated"><strong class="ak">利用其他控制台API</strong></h2><p id="9b20" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">像<code class="eh ls lt lu lv b">console.time()</code>、<code class="eh ls lt lu lv b">console.count()</code>和<code class="eh ls lt lu lv b">console.group()</code>这样的控制台方法可以让你将丰富的数据添加到日志中，比如React组件渲染计数、事务计时和组件生命周期日志。如果你有兴趣了解更多，我在这里写了一篇关于这个<a class="ae ld" href="https://blog.logrocket.com/leveraging-the-console-api-in-react-apps-44df6d1ebeb2" rel="noopener ugc nofollow" target="_blank">的帖子。</a></p><h2 id="8142" class="mf kb hu bd kc na nb nc kg nd ne nf kk jn ng nh ko jr ni nj ks jv nk nl kw nm dt translated"><strong class="ak">构建源地图并上传到LogRocket </strong></h2><p id="b8a6" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">LogRocket支持你可以通过一个<a class="ae ld" href="https://github.com/LogRocket/logrocket-cli" rel="noopener ugc nofollow" target="_blank"> cli </a>上传的源地图。通过这样做，您可以看到JavaScript错误、Redux操作、控制台日志和网络请求的符号化堆栈跟踪，这让您可以看到代码中特定操作的触发位置。</p><h1 id="f322" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">结论</h1><p id="55e0" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">React和Redux经常被称赞为构建可维护的应用程序的工具——其中一个重要的组成部分是可调试性。在生产环境中记录Redux数据提供了这种洞察力，因为通过检查Redux状态、网络请求和DOM可以很容易地调试bug和其他用户报告的问题。</p><p id="7f06" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用LogRocket进行Redux日志记录可以大大简化修复bug和支持用户的工作。您可以在此了解更多信息:</p><div class="nq nr fm fo ns nt"><a href="https://logrocket.com" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab ej"><div class="nv ab nw cl cj nx"><h2 class="bd hv fv z el ny eo ep nz er et ht dt translated">JavaScript应用程序的日志记录和会话重放</h2><div class="oa l"><h3 class="bd b fv z el ny eo ep nz er et ek translated">LogRocket帮助您了解影响用户的问题，以便您可以重新开始构建优秀的软件。</h3></div><div class="ob l"><p class="bd b gc z el ny eo ep nz er et ek translated">logrocket.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ja nt"/></div></div></a></div><blockquote class="oi oj ok"><p id="34e0" class="jc jd np je b jf jg jh ji jj jk jl jm ol jo jp jq om js jt ju on jw jx jy jz hn dt translated">我喜欢写关于React、Redux和其他开发工具的文章。如果你有任何想法或评论，请在这里留下，或在twitter @b_edelstein上与我聊天。感谢阅读！</p></blockquote><div class="kz la lb lc fq ab cb"><figure class="oo iv op oq or os ot paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="oo iv op oq or os ot paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="oo iv op oq or os ot paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="oi oj ok"><p id="f922" class="jc jd np je b jf jg jh ji jj jk jl jm ol jo jp jq om js jt ju on jw jx jy jz hn dt translated"><a class="ae ld" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是这个大家庭的一员。我们现在<a class="ae ld" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">正在接受投稿</a>，并乐意<a class="ae ld" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd np je b jf jg jh ji jj jk jl jm ol jo jp jq om js jt ju on jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ld" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ld" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kz la lb lc fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ou"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>