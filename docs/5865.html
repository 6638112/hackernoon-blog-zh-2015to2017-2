<html>
<head>
<title>A crash course on testing with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js测试速成班</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-crash-course-on-testing-with-node-js-6c7428d3da02?source=collection_archive---------0-----------------------#2017-08-21">https://medium.com/hackernoon/a-crash-course-on-testing-with-node-js-6c7428d3da02?source=collection_archive---------0-----------------------#2017-08-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/4ef4014b83a1823263157d95e925154c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xb953KRkHolnT1uPk6kM8Q.jpeg"/></div></div></figure><div class=""/><p id="3f63" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">JavaScript是一种美丽的语言。你一定认为我疯了。也许你疯了才会同意我。但是我为什么要说这样的话呢？作为一种语言，JavaScript不提供任何支持。如果你给它一点点机会，它就会咬你的头，如果不处理，它会有奇怪的错误信息。所以你告诉我，它为什么美丽？</p><p id="697d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为它创造了优秀的、负责任的、聪明的开发人员。通过担心被最小的错误弄得头破血流，你适应并克服了。获得的技能与编程的共同点较少，更多的是与程序员的精神状态有关。因为你已经习惯了没有一种无形的力量引导你通过代码。相反，你依靠你自己，和你自己的技能。因此，我说了一些和上面一样疯狂的话。</p><p id="b12e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">那么，为什么这会造就优秀的程序员呢？一个好的程序员是有责任心的，细致的，可靠的。像这样的程序员确保他们的代码工作。不管是哪个环境，还是哪个机器。这些技术大师总是用测试来覆盖代码，以确保他们的工作是有效的。他们受到我最大的尊敬。我愿意相信他们也有你。</p><h1 id="0bea" class="ka kb if bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">一步步来。</h1><p id="97f4" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">为了奠定基本测试用例的基础，让我们创建一个简单的函数。</p><figure class="ld le lf lg fq hw"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="9fd1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">调用这个函数我们可以看到结果是6。因为我们知道基本的数学，这是完全合理的。但是如果函数真的很复杂呢？</p><p id="9a44" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们确保编写一个测试用例，以确保该功能无论如何都是有效的。</p><figure class="ld le lf lg fq hw"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="7646" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">看到这个了吗？我们定义要添加的值，并创建它们的总和。然后我们调用<code class="eh lj lk ll lm b">addTwoNumbers()</code>把它赋给另一个变量。完成这些后，我们准备测试等式。我们在期待什么？嗯，<code class="eh lj lk ll lm b">sum1</code>应该等于<code class="eh lj lk ll lm b">sum2</code>，如果我们创建的函数按预期工作的话。运行这段代码，您应该会看到命令行中记录了以下内容:</p><pre class="ld le lf lg fq ln lm lo lp aw lq dt"><span id="1c0e" class="lr kb if lm b fv ls lt l lu lv">addTwoNumbers() should return the sum of its two parameters.<br/>Expect 6 to equal 6.<br/>Passed.</span></pre><p id="6ef3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">祝贺你，你已经编写了你的第一个单元测试！单元测试的行为在于为小代码单元编写测试。因此得名。这意味着您将编写单独的测试用例来验证函数、方法和对象的行为。就像我们上面做的一样。</p><p id="9113" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果我们故意在代码中添加一个bug会怎么样？检查单元测试是否会正常失败。将<code class="eh lj lk ll lm b">addTwoNumbers()</code>功能改为:</p><pre class="ld le lf lg fq ln lm lo lp aw lq dt"><span id="6167" class="lr kb if lm b fv ls lt l lu lv">function addTwoNumbers(x, y) {<br/>  return x + x; // deliberate bug!<br/>}</span></pre><p id="fd1d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">再次运行单元测试，您会看到它失败了。</p><pre class="ld le lf lg fq ln lm lo lp aw lq dt"><span id="d72d" class="lr kb if lm b fv ls lt l lu lv">addTwoNumbers() should return the sum of its two parameters.<br/>Expect 6 to equal 10.<br/>Failed.</span></pre><h1 id="5db4" class="ka kb if bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">一点理论。</h1><p id="6aff" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">单元测试由三部分组成。</p><ol class=""><li id="8935" class="lw lx if je b jf jg jj jk jn ly jr lz jv ma jz mb mc md me dt translated">安排</li><li id="2f56" class="lw lx if je b jf mf jj mg jn mh jr mi jv mj jz mb mc md me dt translated">行动</li><li id="f725" class="lw lx if je b jf mf jj mg jn mh jr mi jv mj jz mb mc md me dt translated">维护</li></ol><p id="bfaa" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">仅从它们的名字就很容易理解它们代表什么。让我们在查看一些代码的同时对其进行分解。</p><figure class="ld le lf lg fq hw"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="5aba" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在第一部分，我们<strong class="je ig">安排</strong>所有必要的先决条件和投入。你可以看到我们定义了要添加的变量，以及这些变量的和。第二步是<strong class="je ig">对被测试的函数、对象或方法进行</strong>操作。最后，我们<strong class="je ig">断言</strong>预期的结果已经出现。</p><p id="4870" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可能会觉得断言这个词有点咄咄逼人。作为一个非英语母语的人，当我第一次听到这个词的时候，我当然知道。不用担心，它只意味着<em class="mk">来认领。你在断言一个真理，意思是你声称某事是真实的。就这么简单。</em></p><blockquote class="ml"><p id="c144" class="mm mn if bd mo mp mq mr ms mt mu jz ek translated"><em class="mv">断言</em>是一个对程序员错误进行基本的健全性检查的工具。</p><p id="db82" class="mm mn if bd mo mp mq mr ms mt mu jz ek translated">— Marijn Haverbeke，<a class="ae mw" href="http://eloquentjavascript.net/08_error.html#h_Sb9V3BEus1" rel="noopener ugc nofollow" target="_blank">雄辩的JavaScript </a></p></blockquote><p id="1522" class="pw-post-body-paragraph jc jd if je b jf mx jh ji jj my jl jm jn mz jp jq jr na jt ju jv nb jx jy jz hn dt translated">想写自己的论断？你当然知道。看看这个。</p><figure class="ld le lf lg fq hw"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="e34f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在第1行，我们实例化了一个名为<code class="eh lj lk ll lm b">assert</code>的新对象，并立即添加了一个名为<code class="eh lj lk ll lm b">equal</code>的方法。如果传递的两个参数不相等，该函数将抛出一个错误。就是这样，这就是整个方法的全部逻辑。现在，在第27行，我们在try catch块中包装了<strong class="je ig"> assert </strong>阶段，并调用了<code class="eh lj lk ll lm b">assert.equal()</code>方法。只有当值不相等时，才会引发错误并在catch块中被捕获。否则，执行线程将继续执行，并将<code class="eh lj lk ll lm b">'Passed.'</code>记录到控制台。去试试吧！</p><h1 id="fa7b" class="ka kb if bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">我们认真点怎么样？</h1><p id="4578" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">上面的例子显示了测试的基本原理。还指出了在编程领域取得成功所需的心态。是时候拿出大枪了。您很少会在生产环境中使用上面的代码。然而，这对理解未来是至关重要的。</p><p id="1b0a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以使用各种工具为生产中的Node.js应用程序编写测试。内置的断言库就是一个例子。是的，Node确实内置了断言。只改1号线。</p><figure class="ld le lf lg fq hw"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="9cb2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过为内置节点模块更改我们的自定义assert对象，我们的代码工作起来完全一样。Node中的默认断言非常强大，您可以在这里花更长的时间查看它们。</p><p id="2dcf" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然而，像<a class="ae mw" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank">摩卡</a>和<a class="ae mw" href="http://chaijs.com/" rel="noopener ugc nofollow" target="_blank">柴</a>这样的工具是测试Node.js应用程序的主要工具。</p><blockquote class="nc nd ne"><p id="d455" class="jc jd mk je b jf jg jh ji jj jk jl jm nf jo jp jq ng js jt ju nh jw jx jy jz hn dt translated"><strong class="je ig"> Mocha </strong>是一个功能丰富的JavaScript测试框架，运行在<a class="ae mw" href="http://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>和浏览器中，让异步测试<em class="if">变得简单</em>和<em class="if">有趣</em>。Mocha测试连续运行，允许灵活和准确的报告，同时将未捕获的异常映射到正确的测试用例。<br/>—mochajs.org</p><p id="aaa6" class="jc jd mk je b jf jg jh ji jj jk jl jm nf jo jp jq ng js jt ju nh jw jx jy jz hn dt translated"><strong class="je ig"> Chai </strong>是一个用于<a class="ae mw" href="http://nodejs.org/" rel="noopener ugc nofollow" target="_blank">节点</a>和浏览器的BDD / TDD断言库，可以愉快地与任何javascript测试框架配对。<br/>—chaijs.com</p></blockquote><p id="4218" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们来看看这个。首先，您需要通过将一个新的节点项目挂接到npm来初始化它。</p><p id="8a1a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在您选择的目录中打开一个终端窗口，并运行:</p><pre class="ld le lf lg fq ln lm lo lp aw lq dt"><span id="edf6" class="lr kb if lm b fv ls lt l lu lv">npm init</span></pre><p id="d6f1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请按照所有提示随意输入。完成后，您需要安装所需的模块。</p><pre class="ld le lf lg fq ln lm lo lp aw lq dt"><span id="b693" class="lr kb if lm b fv ls lt l lu lv">npm install --save-dev mocha chai</span></pre><p id="ccb9" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，您可以打开您选择的代码编辑器，开始添加文件，如下所示:</p><pre class="ld le lf lg fq ln lm lo lp aw lq dt"><span id="f192" class="lr kb if lm b fv ls lt l lu lv">&gt; test<br/>  - test.js<br/>- addTwoNumbers.js</span></pre><p id="6eba" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一个<em class="mk">测试</em>目录下有一个<em class="mk"> test.js </em>文件，另一个名为<em class="mk"> addTwoNumbers.js </em>的文件在该目录的根目录下。继续将<code class="eh lj lk ll lm b">addTwoNumbers</code>函数粘贴到<em class="mk"> addTwoNumbers.js </em>文件中，如下所示:</p><figure class="ld le lf lg fq hw"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="7a18" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">不要忘记导出它，以便以后需要它。现在我们可以开始有趣的部分了。打开<em class="mk"> test.js </em>，开始为我们的测试打基础。</p><figure class="ld le lf lg fq hw"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="309e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在文件的开头我们需要同时要求<em class="mk"> Chai </em>和<em class="mk"> addTwoNumbers </em>。看我们要求<em class="mk">柴</em>的方式，只抓<strong class="je ig">指望</strong>。Chai 提供了三种创建断言的接口。都是有效的。你选择哪一个只是偏好。我觉得<code class="eh lj lk ll lm b">expect</code>很适合我。不要被测试语法搞糊涂了。它是用来模拟自然的人类语言模式的。<code class="eh lj lk ll lm b">describe</code>模块创建了一个测试环境。<code class="eh lj lk ll lm b">it</code>模块定义了需要通过的测试用例。大声读出来听起来不错。形容<code class="eh lj lk ll lm b">addTwoNumbers()</code>，应该加上两个数字。很有道理！现在你能明白为什么除了确保代码工作之外，测试也很重要了吗？测试本身就是文档。写一个测试将解释代码做什么。从事代码基础工作的其他开发人员很快就会理解它。</p><p id="eb15" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">剩下的就是做测试了。在你的<em class="mk">包. json </em>的脚本部分添加<code class="eh lj lk ll lm b">"test": "mocha"</code>，你就可以开始了！</p><blockquote class="nc nd ne"><p id="bd9e" class="jc jd mk je b jf jg jh ji jj jk jl jm nf jo jp jq ng js jt ju nh jw jx jy jz hn dt translated"><strong class="je ig">提示</strong>，你的<strong class="je ig"> package.json </strong>应该是这样的:</p></blockquote><figure class="ld le lf lg fq hw"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="0734" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">跳回你的终端窗口并运行<code class="eh lj lk ll lm b">npm test</code>。你会看到一个很棒的界面，上面有一些绿色的文字，说明有一个测试通过了！</p><figure class="ld le lf lg fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ni"><img src="../Images/9773b33b57d81620873669d545ad0346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K4ELiBlIVfiFYMMMKE1b2w.png"/></div></div></figure><h1 id="ab2a" class="ka kb if bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">接受这一切。</h1><p id="3540" class="pw-post-body-paragraph jc jd if je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">您现在已经体验了用测试覆盖代码的自然过程。所有的例子都展示了单元测试，这已经足够了。当你熟悉这些概念时，理解集成和端到端测试就像在公园散步一样容易。但这是另一篇文章的主题。</p><p id="fd6e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我强烈建议您继续使用这些测试工具。尝试将它们包含到您现有的开发过程中。你会看到代码质量和心理健康的整体改善。相信我，拥有一个完全绿色的测试套件对放松神经有奇效。</p><p id="e3f8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你想看看我们上面写的所有代码，<a class="ae mw" href="https://github.com/adnanrahic/a-crash-course-on-testing-with-nodejs" rel="noopener ugc nofollow" target="_blank">这里是库</a>。或者如果你想看我最新的文章，请到这里来。</p><div class="ht hu fm fo hv nj"><a href="https://medium.com/@adnanrahic/latest" rel="noopener follow" target="_blank"><div class="nk ab ej"><div class="nl ab nm cl cj nn"><h2 class="bd ig fv z el no eo ep np er et ie dt translated">阿德南·拉希奇写的最新故事</h2><div class="nq l"><h3 class="bd b fv z el no eo ep np er et ek translated">阅读Adnan Rahi在Medium上写的最新故事。软件工程师@bookvar_co .编码教育家@ACADEMY387…</h3></div><div class="nr l"><p class="bd b gc z el no eo ep np er et ek translated">medium.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx ib nj"/></div></div></a></div></div><div class="ab cl ny nz hc oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="hn ho hp hq hr"><p id="a5cd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mk">希望你们喜欢读这篇文章，就像我喜欢写这篇文章一样。</em> <br/> <em class="mk">你觉得这个教程会对某人有帮助吗？不要犹豫分享。如果你喜欢它，点击下面的</em> <strong class="je ig"> <em class="mk">拍手</em> </strong> <em class="mk">，这样其他人会在媒体上看到它。</em></p><figure class="ld le lf lg fq hw"><div class="bz el l di"><div class="of li l"/></div></figure></div></div>    
</body>
</html>