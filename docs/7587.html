<html>
<head>
<title>Cleanup old Docker images from Nexus Repository</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Nexus存储库中清除旧的Docker图像</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/cleanup-old-docker-images-from-nexus-repository-617b1004dad8?source=collection_archive---------12-----------------------#2017-11-01">https://medium.com/hackernoon/cleanup-old-docker-images-from-nexus-repository-617b1004dad8?source=collection_archive---------12-----------------------#2017-11-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/a6686c3f0783c33b92ae0c239358c781.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/0*vbrR9ORsluYIJ_gH."/></div></figure><p id="30b4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们中的许多人都在使用<strong class="ja hv"> Nexus </strong>作为发布<strong class="ja hv"> Docker图片</strong>的仓库。通常，在<strong class="ja hv"> SCM </strong>在<strong class="ja hv"> CI </strong>中自动改变之后，我们构建标记有<strong class="ja hv">提交散列</strong>(或者理想情况下使用<a class="ae jw" href="http://semver.org/" rel="noopener ugc nofollow" target="_blank"> semver </a>)的图像，并将它们推送到注册表。因此，有许多“不需要的”&amp;“旧的”映像，在我们的例子中，它们占用了大量的磁盘空间。</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff jx"><img src="../Images/c7574f0d497e7c7dcd3a2c7c993530e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VVA6yAIU6BE_tbU8."/></div></div></figure><p id="c2a4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我看了看Nexus的图形界面，显然没有什么可以同时删除几个Docker图片。或者甚至是清理旧的托管Docker图像并且还清理不再被任何托管图像使用的层的计划任务。</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff kg"><img src="../Images/abb1854a4e8eebe31e79849a1607f7cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/0*SMhq6OI4jp_LA7Z1."/></div></figure><p id="604f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">所以我想出了一个简单的bash脚本，它使用<strong class="ja hv"> Docker注册表API </strong>清除<strong class="ja hv"> Docker </strong>图像，保留最后的<strong class="ja hv"> X图像</strong>并删除所有其他图像。但是，有更好的解决办法吗？是啊！我建了一个<a class="ae jw" href="https://github.com/mlabouardy/nexus-cli" rel="noopener ugc nofollow" target="_blank"> Nexus CLI </a></p><p id="8737" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">要安装<a class="ae jw" href="https://github.com/mlabouardy/nexus-cli" rel="noopener ugc nofollow" target="_blank"> Nexus CLI </a>，请找到适合您系统的软件包并下载。对于linux:</p><blockquote class="kh ki kj"><p id="fc03" class="iy iz kk ja b jb jc jd je jf jg jh ji kl jk jl jm km jo jp jq kn js jt ju jv hn dt translated">wget<a class="ae jw" href="https://s3.eu-west-2.amazonaws.com/nexus-cli/1.0.0-beta/linux/nexus-cli" rel="noopener ugc nofollow" target="_blank">https://S3 . eu-west-2 . Amazon AWS . com/nexus-CLI/1 . 0 . 0-beta/Linux/nexus-CLI</a></p></blockquote><p id="f2e5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">下载<strong class="ja hv"> Nexus CLI </strong>后。向二进制文件添加执行权限:</p><blockquote class="kh ki kj"><p id="8921" class="iy iz kk ja b jb jc jd je jf jg jh ji kl jk jl jm km jo jp jq kn js jt ju jv hn dt translated">chmod +x nexus-cli</p></blockquote><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff ko"><img src="../Images/c3e5c08a328c5649c3c50fdbc046e770.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7o-w7DIIUGBgnbxe."/></div></div></figure><p id="9192" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注:对于<strong class="ja hv">窗口</strong>，确保<strong class="ja hv"> nexus-cli </strong>二进制文件在<strong class="ja hv">路径</strong>上可用。<a class="ae jw" href="https://stackoverflow.com/questions/1618280/where-can-i-set-path-to-make-exe-on-windows" rel="noopener ugc nofollow" target="_blank">本页</a>包含在<strong class="ja hv">窗口</strong>上设置<strong class="ja hv">路径</strong>的说明。</p><p id="e4bb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">安装后，通过打开新的终端会话并检查<strong class="ja hv"> nexus-cli </strong>是否可用来验证安装是否有效:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff kp"><img src="../Images/876f68c47d3aa0918e2e1c409b30cc0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/0*w1HhM8KplcJ_vAee."/></div></figure><p id="b9bd" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">完成后，配置<strong class="ja hv"> Nexus </strong>凭证:</p><blockquote class="kh ki kj"><p id="8506" class="iy iz kk ja b jb jc jd je jf jg jh ji kl jk jl jm km jo jp jq kn js jt ju jv hn dt translated">nexus-cli配置</p></blockquote><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff kq"><img src="../Images/4fb4590f8fd77373d473c19d86ec7d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/0*s2DTFpVyyN2vSmFP."/></div></figure><p id="6744" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">通过<em class="kk"> nexus-cli配置，</em>Nexus CLI将提示您输入四条信息。<strong class="ja hv">用户名</strong>和<strong class="ja hv">密码</strong>是你的账户凭证。<strong class="ja hv"> Nexus主机名</strong> &amp; <strong class="ja hv"> Docker库</strong>名称。</p><p id="13dc" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">应该就是这样了。在cmd提示符下尝试以下命令，如果您有任何图像，您应该会看到它们被列出</p><blockquote class="kh ki kj"><p id="d621" class="iy iz kk ja b jb jc jd je jf jg jh ji kl jk jl jm km jo jp jq kn js jt ju jv hn dt translated">nexus-cli映像ls</p></blockquote><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff kr"><img src="../Images/91c4818047ba61e67f84f879396ea8c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/0*FeHy9q2ptb4KGSBL."/></div></figure><p id="03ee" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">显示图像标签:</p><blockquote class="kh ki kj"><p id="f243" class="iy iz kk ja b jb jc jd je jf jg jh ji kl jk jl jm km jo jp jq kn js jt ju jv hn dt translated">nexus-cli图像标记-名称图像名称</p></blockquote><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff ks"><img src="../Images/03c52fc68b9df3cf1677af4090db78fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ELAFsCYqaE6ZnxRl."/></div></div></figure><p id="ade5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">图像描述:</p><blockquote class="kh ki kj"><p id="09e1" class="iy iz kk ja b jb jc jd je jf jg jh ji kl jk jl jm km jo jp jq kn js jt ju jv hn dt translated">nexus-cli图像信息名称图像名称标签标签</p></blockquote><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kt"><img src="../Images/5669aa5235a272c135581ff7d8be5830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l3ozIcaxTWExasjU."/></div></div></figure><p id="c94c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">要删除特定图像:</p><blockquote class="kh ki kj"><p id="813f" class="iy iz kk ja b jb jc jd je jf jg jh ji kl jk jl jm km jo jp jq kn js jt ju jv hn dt translated">nexus-CLI IMAGE delete-NAME IMAGE _ NAME-TAG标记</p></blockquote><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kt"><img src="../Images/c7543a8568e08e6cace395719fcb47a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mrhZ8T1hvxUFfSBS."/></div></div></figure><p id="232f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">要仅保留最后的X图像并删除所有其他图像:</p><blockquote class="kh ki kj"><p id="c999" class="iy iz kk ja b jb jc jd je jf jg jh ji kl jk jl jm km jo jp jq kn js jt ju jv hn dt translated">nexus-cli映像删除-名称映像名称-保留X</p></blockquote><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff ku"><img src="../Images/764a1cebc818fcb272baca394c63e787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jeun0JQ1R77UKGT3."/></div></div></figure><p id="fd96" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">就是这样！让我们回到<strong class="ja hv"> Nexus仪表盘</strong>:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kv"><img src="../Images/b73714abeb605b536d357e21ac5403a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6h9g4CN17_QMSzCz."/></div></div></figure><p id="6079" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">你可以看到，Nexus只保留了最后4张图片，删除了其他的。</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff kw"><img src="../Images/6c8aa9e8bfe78ca9247d6477efb4c8cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/0*JflL1pCqP6p3SFFk."/></div></figure><p id="9a9e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">CLI仍处于早期阶段，因此欢迎您对<a class="ae jw" href="https://github.com/mlabouardy/nexus-cli" rel="noopener ugc nofollow" target="_blank"> Github </a>中的项目做出贡献。</p></div></div>    
</body>
</html>