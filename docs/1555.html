<html>
<head>
<title>JavaScript: Do you like games? (part 4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript:你喜欢游戏吗？(第四部分)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/javascript-do-you-like-games-part-4-9d6e8adb5626?source=collection_archive---------7-----------------------#2016-11-14">https://medium.com/hackernoon/javascript-do-you-like-games-part-4-9d6e8adb5626?source=collection_archive---------7-----------------------#2016-11-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="794c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关于这个话题:<a class="ae jp" href="https://blog.hellojs.org/javascript-do-you-like-games-part-1-c1320c2c52ec" rel="noopener ugc nofollow" target="_blank">第1部分</a> | <a class="ae jp" href="https://blog.hellojs.org/javascript-do-you-like-games-part-2-9d4141ca2493" rel="noopener ugc nofollow" target="_blank">第2部分</a> | <a class="ae jp" href="https://blog.hellojs.org/javascript-do-you-like-games-part-3-6225ec264902" rel="noopener ugc nofollow" target="_blank">第3部分</a> |第4部分| <a class="ae jp" rel="noopener" href="/@radu.bogdan.gaspar/javascript-do-you-like-games-part-5-a79bb69ad9e1">第5部分</a> | <a class="ae jp" rel="noopener" href="/@radu.bogdan.gaspar/javascript-do-you-like-games-part-6-7bff0b8ce05e">第6部分</a></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/e0ca8667cb4037a29bca5fc0730ddfe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VUJsiIjFDp0UxHCI5uchlA.png"/></div></div></figure><p id="1e42" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将继续使用<strong class="it hv">显示对象</strong>，它扩展了<strong class="it hv">场景</strong>。您可以在本系列的第1部分中回顾这个模式，但是我们将对事物的命名方式进行一些修改。</p><p id="770d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它的工作非常简单；它将需要在一个<em class="kc">子</em>数组中呈现的对象分组，并且它将公开允许我们向这个数组添加和移除元素的方法。它实际上在功能上非常类似于<strong class="it hv">画布</strong>。</p><p id="42ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们希望在我们的<strong class="it hv">场景</strong>中呈现的所有东西都是<strong class="it hv">显示对象</strong>。想象一个游戏，我们有一艘宇宙飞船。每当飞船移动，它的推进器就会被点燃。<strong class="it hv">显示物体</strong>可以容纳飞船和推进器，因为它们属于一起。</p><p id="32af" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">像这样分开物体意味着我们也可以单独测试碰撞，因为与推进器碰撞的东西不应该记录在船上。</p><p id="dce7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以使用这种逻辑更进一步，增加收集能量的能力，为船只增加更多的火力，并使这些增强可以被敌人的火力摧毁，等等。</p><p id="c5f2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们只关心分组逻辑:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="kd ke l"/></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">engine/ui/DisplayObject.js</figcaption></figure><p id="36b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">雪碧床单:它们是什么，能提供什么？</p><p id="bfb3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一个游戏通常需要大量的图形资源。在2D游戏中，这些图像通常被称为<em class="kc">精灵</em>。每个图像都有宽度、高度和颜色深度。像素由4个通道定义:</p><ul class=""><li id="84c6" class="kj kk hu it b iu iv iy iz jc kl jg km jk kn jo ko kp kq kr dt translated">3个颜色通道(红色、绿色、蓝色)和</li><li id="48e5" class="kj kk hu it b iu ks iy kt jc ku jg kv jk kw jo ko kp kq kr dt translated">1个阿尔法通道。</li></ul><p id="dd2d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每个通道都有一个从0到255的值。可以用8位存储最大值255(二进制255 = 11111111)；4个通道*每个通道8位= 32位。每个像素总共有4个字节。64x64图像所需的内存为64*64*4 = 16.3千字节。</p><p id="3825" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这不是很多，但管理多个角色、项目和动画会影响内存和隐含的性能。最好的方法是将所有图形资产存储在一个sprite表中。下面是愤怒的小鸟游戏中的部分精灵表示例:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff kx"><img src="../Images/379d39b577df4ac7343dfc58eace976d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5KZmOpJt0jqywQcNSgJxKg.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">© <strong class="bd ky">Rovio Entertainment — </strong>Angry Birds Sprite Sheet (868 x 898 px)</figcaption></figure><p id="27a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它有各种各样的猪，他们受到的伤害阶段，以及一些鸟。有一些工具可以帮助你创建sprite工作表，比如<a class="ae jp" href="https://www.codeandweb.com/texturepacker" rel="noopener ugc nofollow" target="_blank"> TexturePacker </a>，但是你也可以创建自己的实用程序来相对容易地完成这项工作。</p><p id="426f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以创建具有固定宽度和高度单元格的sprite表，或者您可以通过裁剪透明部分使每个sprite占用尽可能少的空间来优化它们。</p><p id="7a9f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的引擎将有一个<strong class="it hv"> SpriteSheet </strong>类，它将实现一个<strong class="it hv"> <em class="kc"> getTile() </em> </strong>方法来返回基于其位置的特定图块。我们目前的工作思路是，工作表中的所有图块都具有相同的宽度和高度(因此，如果一个图像是64x32px，则它们都是)。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="kd ke l"/></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">engin/ui/SpriteSheet.js</figcaption></figure><p id="c897" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它需要两个参数:加载的图像和图块大小。加载的图像将由我们的<strong class="it hv"> AssetsLoader </strong>实用程序类提供，我们在本系列的<a class="ae jp" href="https://blog.hellojs.org/javascript-do-you-like-games-part-2-9d4141ca2493" rel="noopener ugc nofollow" target="_blank">第2部分</a>中已经介绍过。</p><p id="c008" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于我们的sprite表对于每个图块都有固定的宽度和高度，所以我们可以遍历整个图像并存储每个sprite的坐标。</p><p id="3c21" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">动画精灵没有什么不同，看看街头霸王游戏中的Ryu精灵表:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff kz"><img src="../Images/f6dd0702ebda092f15bb403bcb8ac78d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZOgPse6ygxnAhZLYOren9A.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">Ryu Sprite Sheet (702 x 130 px)</figcaption></figure><p id="9e12" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这和电影胶片是一个概念。你有很多帧的静态图像，你以很高的帧速率遍历它们。这给人以运动的错觉。</p><p id="25a9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那么一个<strong class="it hv">动画的prite </strong>类会是什么样子呢？它应该有几样东西:</p><ul class=""><li id="b9c7" class="kj kk hu it b iu iv iy iz jc kl jg km jk kn jo ko kp kq kr dt translated">x和y位置</li><li id="aec1" class="kj kk hu it b iu ks iy kt jc ku jg kv jk kw jo ko kp kq kr dt translated">它正在处理的精灵表</li><li id="51fc" class="kj kk hu it b iu ks iy kt jc ku jg kv jk kw jo ko kp kq kr dt translated">动画的开始和结束帧</li><li id="bf50" class="kj kk hu it b iu ks iy kt jc ku jg kv jk kw jo ko kp kq kr dt translated">动画是否应该永远循环(默认为真)—在以后，我们也可以允许这是一个数字(如循环3次)</li><li id="1d43" class="kj kk hu it b iu ks iy kt jc ku jg kv jk kw jo ko kp kq kr dt translated">如果循环为假，它应该在最后一帧停止</li><li id="e999" class="kj kk hu it b iu ks iy kt jc ku jg kv jk kw jo ko kp kq kr dt translated">动画帧速率(除非我们想要每秒60次切换这些帧)</li><li id="618c" class="kj kk hu it b iu ks iy kt jc ku jg kv jk kw jo ko kp kq kr dt translated">在上面的图像中，Ryu有9帧，但我们正在处理一个基于0的索引，所以帧从左到右从0到8计数；这将是我们班的默认方法</li></ul><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="kd ke l"/></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">engine/ui/AnimatedSprite.js</figcaption></figure><p id="a9f2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这就是所谓的blitting。帧速率控制由<strong class="it hv"> <em class="kc"> update() </em> </strong>方法中的日期实例管理。我们检查经过的时间是否大于周期…如果是，我们简单地将帧索引增加1；无论是<strong class="it hv"> <em class="kc"> update() </em> </strong>还是<strong class="it hv"> <em class="kc"> render() </em> </strong>方法仍然是每秒调用~60次，这并不影响我们。</p><p id="6f2e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们把所有东西放在一起:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="kd ke l"/></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">sprites/index.js</figcaption></figure><p id="5caf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是Ryu以10 fps的速度循环播放动画的工作演示:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="la ke l"/></div></figure><p id="0925" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">源代码:</p><div class="lb lc fm fo ld le"><a href="https://github.com/raduGaspar/game-physx/tree/f23ba9e81de0e448a11d9f1501f8935250e43bc0" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab ej"><div class="lg ab lh cl cj li"><h2 class="bd hv fv z el lj eo ep lk er et ht dt translated">红景天/游戏-physx</h2><div class="ll l"><h3 class="bd b fv z el lj eo ep lk er et ek translated">一个用于JavaScript游戏制作的小工具</h3></div><div class="lm l"><p class="bd b gc z el lj eo ep lk er et ek translated">github.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls ka le"/></div></div></a></div><p id="493d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在下一篇文章中，我们将尝试用我们目前拥有的<a class="ae jp" href="https://hackernoon.com/tagged/engine" rel="noopener ugc nofollow" target="_blank">引擎</a>创建一个简单的游戏，比如小行星或者<a class="ae jp" href="https://hackernoon.com/tagged/space" rel="noopener ugc nofollow" target="_blank">太空</a>入侵者。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lt ke l"/></div></figure></div></div>    
</body>
</html>