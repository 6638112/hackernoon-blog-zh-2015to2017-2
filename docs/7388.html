<html>
<head>
<title>Create a Serverless REST API with Node.JS, AWS Lambda, DynamoDB &amp; API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node创建一个无服务器REST API。JS、AWS Lambda、DynamoDB和API网关</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/create-a-serverless-rest-api-with-node-js-aws-lambda-dynamodb-api-gateway-f08e7111fd16?source=collection_archive---------2-----------------------#2017-10-26">https://medium.com/hackernoon/create-a-serverless-rest-api-with-node-js-aws-lambda-dynamodb-api-gateway-f08e7111fd16?source=collection_archive---------2-----------------------#2017-10-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/ff4ae104663c8eb1a2f51772d58d85de.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*sKRv88XHuEuZMz7GqUV1zw.png"/></div></figure><p id="cbe8" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在这篇文章中，我将向你展示如何在<strong class="ja hv">节点中构建一个<strong class="ja hv"> RESTful API </strong>。JS </strong>遵循<strong class="ja hv">无服务器</strong>的方法，使用<strong class="ja hv"> AWS Lambda </strong>，<strong class="ja hv"> API网关</strong> &amp; <strong class="ja hv"> DynamoDB </strong>。</p><blockquote class="jw jx jy"><p id="7e59" class="iy iz jz ja b jb jc jd je jf jg jh ji ka jk jl jm kb jo jp jq kc js jt ju jv hn dt translated">无服务器计算是一种云计算执行模型，其中云提供商动态管理机器资源的分配</p></blockquote><p id="f7c2" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">所有代码都在我的<a class="ae kd" href="https://github.com/mlabouardy/movies-dynamodb-lambda" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv"> Github </strong> </a>上</p><p id="b081" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 1 — API规范</strong></p><p id="526d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">REST API服务将公开端点来管理电影商店。我们的端点将允许的操作有:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff ke"><img src="../Images/de35e6b110d48a44671b8b81de472741.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/0*DiX1PbQNQK_h6Vg2."/></div></figure><p id="84bd" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 2 — DynamoDB表</strong></p><p id="de09" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">进入<a class="ae kd" href="https://console.aws.amazon.com/dynamodb/home" rel="noopener ugc nofollow" target="_blank"> DynamoDB控制台</a>，点击<strong class="ja hv">创建表格</strong>按钮，填写表格名称并设置主键:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/786dad1ff875f470b904adc6d8c5061b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*6cJWk0atyFjtpdba."/></div></figure><p id="7d87" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 3 —写一个新的电影Lambda函数</strong></p><p id="74f4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">代码是不言自明的，我使用了<em class="jz"> put </em>方法来插入一个新的电影项目，并使用<a class="ae kd" href="https://www.npmjs.com/package/uuid" rel="noopener ugc nofollow" target="_blank"> <em class="jz"> uuid </em> </a>库来为电影项目生成一个随机的唯一id:</p><figure class="kf kg kh ki fq iv"><div class="bz el l di"><div class="kk kl l"/></div></figure><p id="b509" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">转到<a class="ae kd" href="https://console.aws.amazon.com/lambda" rel="noopener ugc nofollow" target="_blank"> Lambda仪表板</a>并创建一个新功能，如下所示:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/8c5a7c2cc55c1e3b0785531b3128aa9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*JDvWRrQ1Xc8cNMKn."/></div></figure><p id="8c95" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">添加<strong class="ja hv"> DynamoDB </strong>表名作为<strong class="ja hv">环境变量</strong>，并将<strong class="ja hv">处理程序</strong>名更新为上面代码中的函数名:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/48492db2140809d5946d220bc1133ed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*RuRZ8MXuhvlIDm1x."/></div></figure><p id="6070" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:你应该使用一个有权限的<strong class="ja hv"> IAM角色</strong>来访问<strong class="ja hv">DynamoDB</strong>&amp;<strong class="ja hv">Lambda</strong>。</p><p id="9d43" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">创建完成后，您可以点击“<strong class="ja hv">测试</strong>”并发送如下JSON:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/faa334693a78354207a3cea6e4866ede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*N5PyXQHjf1gKrVEm."/></div></figure><p id="96e9" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">该项目已成功插入<strong class="ja hv"> DynamoDB </strong>:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/a42bedff06d615aeff2fb5b4d526bc68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*EiyJCnMqbJ-pRSc9."/></div></figure><p id="3971" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 4 —列出所有电影Lambda函数</strong></p><p id="7a95" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">代码是不言自明的，我使用<em class="jz">扫描</em>方法从表中获取所有项目:</p><figure class="kf kg kh ki fq iv"><div class="bz el l di"><div class="kk kl l"/></div></figure><p id="09a3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如下填写功能配置:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/6c66fb70a4e3d745c7da0b0577755a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*ZE1Ddyr-Ofw42eEC."/></div></figure><p id="8a8e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">类似于write函数，我们需要添加<strong class="ja hv"> DynamoDB </strong>表名作为<strong class="ja hv">环境变量</strong>:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/f6f309f8471bdd2c3e434be6ab67d741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*GQBexJb693wYBiOS."/></div></figure><p id="60ca" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">创建完成后，您可以通过点击“<strong class="ja hv">测试</strong>”按钮来测试该功能:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/ec2e56a121e3dbf098abcbc02a341eca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*XpD1LK4hb9ZBWuJe."/></div></figure><p id="c5e4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">恭喜你！</p><p id="1ca4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们已经成功地创建了我们的<strong class="ja hv"> Lambda函数</strong>:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/e41d6cd5e9355b4ffc14aed88e9706e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*SYJJgq3qSlfy9V7s."/></div></figure><p id="28ba" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 5 —设置API网关</strong></p><p id="d6f0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">转到<a class="ae kd" href="https://console.aws.amazon.com/apigateway" rel="noopener ugc nofollow" target="_blank"> API网关控制台</a>并创建一个新的API。</p><p id="15df" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 5.1 —获取/电影</strong></p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/21ecf401eec4108e51cc109528d9fcd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*ABX_PgUsGVF8GSIP."/></div></figure><p id="d666" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 5.2 —海报/电影</strong></p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/e58777180560cbdcada93b60f83cab48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*FBgoVrcKjWufxF4D."/></div></figure><p id="84ba" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">完成后，部署API:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/2a4c613b2b2ee0e43032cfa106948283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*D47hp_exFUZ1QUBS."/></div></figure><p id="b4eb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">复制下<strong class="ja hv"> API调用URL </strong>:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/99fbd6ecb101f500f381a66f89402999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*_G77TbAiNbNcucvy."/></div></figure><p id="8541" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 6 —测试</strong></p><p id="c47d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们来测试一下:</p><p id="38b1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 6.1 —制作电影</strong></p><p id="0e97" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">与<strong class="ja hv">邮递员:</strong></p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/51af4d805a0ee0b16777f6d9aba5f667.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*yTyDqwXK0zLDgN0n."/></div></figure><p id="b3bd" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">带<strong class="ja hv">卷曲</strong>:</p><p id="3aa7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">| curl-sSX POST-d ' { " name ":" Gladiator " } '<a class="ae kd" href="https://3z0neyn1nf.execute-api.us-east-1.amazonaws.com/prod/movies" rel="noopener ugc nofollow" target="_blank">https://3z 0 neyn 1 nf . execute-API . us-east-1 . Amazon AWS . com/prod/movies</a></p><p id="3a82" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 6.2 —列出电影</strong></p><p id="b0de" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">同<strong class="ja hv">邮递员</strong>:</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/bb8dd560b05ca3483fb84e6631a8cf8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*Qfijxq2J-4wo3LND."/></div></figure><p id="9234" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">带<strong class="ja hv">卷曲</strong>:</p><p id="8dc4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">| curl-sSX GET<a class="ae kd" href="https://3z0neyn1nf.execute-api.us-east-1.amazonaws.com/prod/movies" rel="noopener ugc nofollow" target="_blank">https://3z 0 neyn 1 nf . execute-API . us-east 1.amazonaws.com/prod/movies</a></p><p id="954b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果我们检查我们的<strong class="ja hv"> DynamoDB表</strong></p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/3976f149e23c45691e70518f6e8081a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*AviIOLn9b4oJ5nV3."/></div></figure></div></div>    
</body>
</html>