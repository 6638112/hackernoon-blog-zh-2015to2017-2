<html>
<head>
<title>Deploy Django app with Nginx, Gunicorn, PostgreSQL &amp; Supervisor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nginx、Gunicorn、PostgreSQL和Supervisor部署Django应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/deploy-django-app-with-nginx-gunicorn-postgresql-supervisor-9c6d556a25ac?source=collection_archive---------1-----------------------#2017-08-28">https://medium.com/hackernoon/deploy-django-app-with-nginx-gunicorn-postgresql-supervisor-9c6d556a25ac?source=collection_archive---------1-----------------------#2017-08-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/9ae35ce5f1b07433a51815da2d79e289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LcNGsTm9VVZSdcC7_WKTmg.jpeg"/></div></div></figure><p id="18e7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Django是目前最流行的基于Python的web框架。Django是强大的，健壮的，充满能力的，被一个支持的社区所包围。Django基于模型、视图和模板，类似于其他MVC框架。</p><p id="fa88" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦您使用以下命令开始一个新项目，Django将为您提供一个现成的开发服务器:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="dfc3" class="kj kk hu kf b fv kl km l kn ko">$ django-admin startproject my_project<br/>$ python ./manage.py runserver 8000</span></pre><p id="824d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过终端中的两行代码，您可以在本地机器上拥有一个工作的开发服务器，这样您就可以开始编码了。对于Django来说，一个棘手的部分是部署项目，以便它可以在全球不同的设备上使用。作为技术企业家，我们不仅需要开发具有后端和前端的应用程序，还需要将它们部署到生产环境中，这种环境必须是模块化的、可维护的，当然也是安全的。</p><figure class="ka kb kc kd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kp"><img src="../Images/42e88625c9af6ff931d27113cae2880a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*n8lp6cXR9Tuh8wvx.png"/></div></div></figure><p id="88c7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Django应用程序的部署需要不同的机制，下面将列出这些机制。在我们开始之前，我们需要对我们将在本文中使用的工具进行调整:</p><ol class=""><li id="01bc" class="kq kr hu je b jf jg jj jk jn ks jr kt jv ku jz kv kw kx ky dt translated">Python版本2.7.6</li><li id="0ae3" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">Django版本1.11</li><li id="a473" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">在<a class="ae le" href="https://m.do.co/c/f441a74808c9" rel="noopener ugc nofollow" target="_blank">数字海洋云提供商</a>上托管的Linux Ubuntu服务器</li><li id="e627" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated"><a class="ae le" href="https://codingstartups.com/moved-windows-linux-lessons-learned/" rel="noopener ugc nofollow" target="_blank"> Linux Ubuntu本地机</a></li><li id="0f2e" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">包含代码库的Git存储库</li></ol><p id="daa5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我假设你已经在用1，2，4，5了。关于Linux服务器，我们将在部署教程的第一步中一起创建它。请注意，这篇文章讨论了在单个Ubuntu服务器上的部署。这种配置非常适合小型项目，但是为了扩展您的资源以支持更大的流量，您应该考虑使用负载平衡器、浮动IP地址、冗余等<a class="ae le" href="https://codingstartups.com/scaling-saas-product-infrastructure-high-availability/" rel="noopener ugc nofollow" target="_blank">高可用性服务器基础设施</a>。</p><p id="e7a6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在提供网络应用方面，Linux比Windows更受欢迎。此外，Python和Django在Linux上配合得很好，而在Windows上<a class="ae le" href="https://codingstartups.com/moved-windows-linux-lessons-learned/" rel="noopener ugc nofollow" target="_blank">就不那么好了。</a></p><p id="e869" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">选择DigitalOcean作为云提供商有很多原因，特别是对于将部署在单个droplet(digital ocean术语中的虚拟服务器)上的小项目。DigitalOcean是软件项目和初创公司的一个很好的解决方案，它们从小规模起步，逐步扩大规模。阅读更多关于<a class="ae le" href="https://codingstartups.com/choose-cloud-computing-technology-startup/" rel="noopener ugc nofollow" target="_blank">我对数字海洋和亚马逊网络服务</a>在早期启动软件项目方面的比较。</p><p id="05aa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在开始部署过程之前，我强烈建议您遵循一些设置Django项目的最佳实践。最佳实践包括使用虚拟环境、导出requirements.txt文件以及配置settings.py文件以用于多种环境。</p><figure class="ka kb kc kd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lf"><img src="../Images/e9c7b95d4a95f87d47f900b21ec6db24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IlUacLHcF3fURL0c.png"/></div></div></figure><p id="3b72" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这篇文章将涵盖Django项目在全新的Linux Ubuntu服务器上从头到尾的部署过程。除了DigitalOcean之外，您可以自由选择您最喜欢的云提供商进行部署。</p><p id="271f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如前所述，Django的内置开发服务器很弱，不是为规模化而建的。您可以用它来开发您自己的Django项目，或者与您的同事分享，但仅此而已。为了在生产环境中为您的应用提供服务，我们需要使用几个组件，这些组件将相互通信并创造奇迹。托管web应用程序通常需要协调三个角色:</p><ol class=""><li id="4a07" class="kq kr hu je b jf jg jj jk jn ks jr kt jv ku jz kv kw kx ky dt translated">网络服务器</li><li id="efe2" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">门</li><li id="466f" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">应用</li></ol><h1 id="124c" class="lg kk hu bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">网络服务器</h1><p id="730f" class="pw-post-body-paragraph jc jd hu je b jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz hn dt translated">web服务器从客户端(浏览器)接收HTTP请求，通常负责负载平衡、将请求代理给其他进程、提供静态文件、缓存等。web服务器通常解释请求并将其发送给网关。常见的web服务器和Apache和Nginx。在本教程中，我们将使用Nginx(这也是我最喜欢的)。</p><h1 id="0a9d" class="lg kk hu bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">网关</h1><p id="558a" class="pw-post-body-paragraph jc jd hu je b jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz hn dt translated">网关翻译从web服务器收到的请求，以便应用程序能够处理它。网关通常还负责日志记录和报告。我们将使用Gunicorn作为本教程的网关。</p><h1 id="2da1" class="lg kk hu bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">应用程序</h1><p id="e8e1" class="pw-post-body-paragraph jc jd hu je b jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz hn dt translated">您可能已经猜到，这个应用程序指的是您的Django应用程序。应用程序接受解释后的请求，使用您作为开发人员实现的逻辑对其进行处理，并返回响应。</p></div><div class="ab cl mi mj hc mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="hn ho hp hq hr"><p id="4b5b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">假设您已经有了一个可以部署的Django项目，我们将按照以下步骤来部署您的项目:</p><ol class=""><li id="6a9d" class="kq kr hu je b jf jg jj jk jn ks jr kt jv ku jz kv kw kx ky dt translated">创造新的数字海洋微滴</li><li id="9628" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">安装先决条件:pip、虚拟环境和git</li><li id="7d58" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">从Git中提取Django应用程序</li><li id="8c22" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">设置PostgreSQL</li><li id="6732" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">使用Supervisor配置Gunicorn</li><li id="5c90" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">配置Nginx监听请求</li><li id="3527" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">保护您部署的应用程序:设置防火墙</li></ol><h1 id="3a05" class="lg kk hu bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">创建一个液滴</h1><p id="1d84" class="pw-post-body-paragraph jc jd hu je b jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz hn dt translated"><a class="ae le" href="https://m.do.co/c/f441a74808c9" rel="noopener ugc nofollow" target="_blank"> DigitalOcean </a>中的一个水滴，指的是一个虚拟的Linux服务器，拥有CPU、RAM和磁盘空间。本教程的第一步是创建一个新的droplet并通过SSH连接到它。假设您的本地机器运行的是Ubuntu，我们将创建一个新的SSH密钥对，以便在创建droplet后轻松安全地连接到它。使用SSH密钥(而不是密码)的连接更加简单和安全。如果您已经有一个SSH密钥对，那么您可以跳过创建过程。在本地计算机上，在终端中输入:</p><p id="bb33" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ ssh-keygen -t rsa</code></p><p id="2495" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您应该会得到另外两个问题，在哪里找到密钥(缺省值就可以了)以及是否要设置密码(不是必需的)。</p><p id="51fe" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，密钥对位于:</p><p id="0675" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">/home/user/.ssh/</code></p><p id="7e1e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">其中<code class="eh mp mq mr kf b">id_rsa.pub</code>是你的公钥，<code class="eh mp mq mr kf b">id_rsa</code>是你的私钥。为了使用密钥对连接到远程服务器，公钥应该位于远程服务器上，私钥应该位于您的本地计算机上。</p><p id="44b0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请注意，公钥可以位于您希望连接的每个远程服务器上。但是，私钥必须只保存在您的本地计算机上！共享私钥将使其他用户能够连接到您的服务器。</p><p id="a101" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在与<a class="ae le" href="https://m.do.co/c/f441a74808c9" rel="noopener ugc nofollow" target="_blank"> DigitalOcean </a>注册后，打开<a class="ae le" href="https://cloud.digitalocean.com/settings/security" rel="noopener ugc nofollow" target="_blank"> SSH页面</a>并点击Add SSH Key按钮。在您的终端中复制新创建的公钥:</p><p id="667b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ cat /home/user/.ssh/id_rsa.pub</code></p><p id="ff42" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">输入您生成的新公钥，并随意命名。</p><figure class="ka kb kc kd fq iv fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/38906e64d3201619da7b7fb3edde6220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/0*R-IvMamYNLWq5GTp.png"/></div></figure><p id="8f34" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，一旦密钥储存在您的帐户中，您就可以将它分配给您创建的每个droplet。droplet将包含密钥，因此您可以从本地机器连接到它，而默认情况下密码验证将被禁用，这是强烈建议的。</p><p id="b191" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们准备创建我们的水滴。点击数字海洋仪表盘顶部的“创建Droplet”。</p><figure class="ka kb kc kd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/d91a15769e2973ba5bd5232cd02429a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DCxFBqRMDRJbpJi0.png"/></div></div></figure><p id="0027" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">选择Ubuntu 16.04 64位作为您的图像，液滴大小为512MB RAM或1GB，任何对您有意义的区域。</p><figure class="ka kb kc kd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mu"><img src="../Images/e3359e16cf5eca32192ea049bbb46b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kNb3bIOchb3ygCJH.png"/></div></div></figure><figure class="ka kb kc kd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mv"><img src="../Images/2685f391625675a13edcc43a9be21c6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cnLDQNS1XkEGR91u.png"/></div></div></figure><figure class="ka kb kc kd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mw"><img src="../Images/572b565608c9a77c5e87374888d81e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ofKv3DuW7FG3b2OC.png"/></div></div></figure><p id="007c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以选择专用网络功能(这对于本教程并不重要)。确保选择您刚刚添加到帐户的SSH密钥。给你的新droplet命名，然后点击“创建”。</p><figure class="ka kb kc kd fq iv fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/1bcf68a6dae0b8e3f7f0f6229175ed77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/0*yHID_eppLMyG_wtM.png"/></div></figure><figure class="ka kb kc kd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff my"><img src="../Images/af3b53610f3823adc7332b11d536f6bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qPa4ywcjCJDAEdbC.png"/></div></div></figure><figure class="ka kb kc kd fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mz"><img src="../Images/ef5edcf95f6a1d638c41bd176439813b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ggvWy_oPbBs6RJNq.png"/></div></div></figure><p id="dd10" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦创建了新的droplet，您应该能够使用您创建的SSH密钥轻松地连接到它。为此，请从仪表板内的droplet页面复制您的droplet的IP地址，转到您的本地终端并键入:</p><p id="7bf8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ ssh root@IP_ADDRESS_COPIED</code></p><p id="3e8e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保用<code class="eh mp mq mr kf b">IP_ADDRESS_COPIED</code>替换您的droplet的IP地址。你现在应该已经连接上了。</p><p id="322e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">给高级用户的提示:如果您想要配置更简单的连接方式，请通过编辑文件为您的droplet添加一个替身:</p><p id="091b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ nano /home/user/.ssh/config</code></p><p id="4a76" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">并补充道:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="0330" class="kj kk hu kf b fv kl km l kn ko">Host remote-server-name<br/>    Hostname DROPLET_IP_ADDRESS<br/>    User root</span></pre><p id="a9df" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保用您选择的名称替换<code class="eh mp mq mr kf b">remote-server-name</code>，用服务器的IP地址替换<code class="eh mp mq mr kf b">DROPLET_IP_ADDRESS</code>。</p><p id="d085" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">点击<code class="eh mp mq mr kf b">Ctrl+O</code>保存文件，然后用<code class="eh mp mq mr kf b">Ctrl+X</code>关闭。现在，为了连接到您的droplet，您只需键入:</p><p id="8239" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ ssh remote-server-name</code></p><p id="0d2d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">就这么简单。</p><h1 id="6b23" class="lg kk hu bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">安装先决条件</h1><p id="d470" class="pw-post-body-paragraph jc jd hu je b jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz hn dt translated">一旦连接到您的droplet，我们将安装一些软件，以便开始我们的部署过程。首先更新您的存储库并安装pip和virtualenv。</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="d3c2" class="kj kk hu kf b fv kl km l kn ko">$ sudo apt-get update<!-- --> <!-- -->$ sudo apt-get install python-pip python-dev build-essential libpq-dev postgresql postgresql-contrib nginx git virtualenv virtualenvwrapper<br/>$ export LC_ALL="en_US.UTF-8"<br/>$ pip install --upgrade pip<br/>$ pip install --upgrade virtualenv</span></pre><p id="3fbd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">希望您在本地机器上使用虚拟环境。如果你不知道，我强烈推荐你阅读我的<a class="ae le" href="https://codingstartups.com/3-best-practices-better-setting-django-project/" rel="noopener ugc nofollow" target="_blank">关于建立Django项目的最佳实践的帖子</a>，以便理解为什么使用虚拟环境是你的Django开发过程的重要部分。</p><p id="c23e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们开始配置虚拟环境。用以下内容创建新文件夹:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="4275" class="kj kk hu kf b fv kl km l kn ko">$ mkdir ~/.virtualenvs<br/>$ export WORKON_HOME=~/.virtualenvs</span></pre><p id="e00a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过运行以下命令，配置虚拟环境包装器以便于访问:</p><p id="2c57" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ nano ~/.bashrc</code></p><p id="46b2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">并将这一行添加到文件的末尾:</p><p id="abea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">. /usr/local/bin/virtualenvwrapper.sh</code></p><p id="75b5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">提示:在nano编辑器中，使用<code class="eh mp mq mr kf b">Ctrl+V</code>快速向下滚动，使用<code class="eh mp mq mr kf b">Ctrl+Y</code>快速向上滚动。</p><p id="3ba3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">点击<code class="eh mp mq mr kf b">Ctrl+O</code>保存文件，点击<code class="eh mp mq mr kf b">Ctrl+X</code>关闭文件。在您的终端中键入:</p><p id="86d6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ . .bashrc</code></p><p id="c665" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，您应该能够为Django项目创建新的虚拟环境了:</p><p id="ab11" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ mkvirtualenv virtual-env-name</code></p><p id="b6c5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从虚拟环境中安装:</p><p id="2867" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">(virtual-env-name) $ pip install django gunicorn psycopg2</code></p><p id="7a6c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">提示:使用虚拟环境的有用命令:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="1ddf" class="kj kk hu kf b fv kl km l kn ko">$ workon virtual-env-name # activate the virtual environment<br/>$ deactivate              # deactivate the virtual environment</span></pre><p id="5bef" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从Git提取应用程序</p><p id="d104" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先创建一个持有Django应用程序的新用户:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="8d71" class="kj kk hu kf b fv kl km l kn ko">$ adduser django<br/>$ cd /home/django<br/>$ git clone REPOSITORY_URL</span></pre><p id="bbbd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">假设您的代码库已经位于Git存储库中，只需输入您的密码，您的存储库就会被克隆到您的远程服务器中。您可能需要添加执行<code class="eh mp mq mr kf b">manage.py</code>的权限，方法是导航到您的项目文件夹(您刚刚克隆的文件夹)并键入:</p><p id="acab" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ chmod 755 ./manage.py</code></p><p id="d35c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了进一步简化虚拟环境，请通过键入以下命令将项目主文件夹的路径复制到虚拟环境设置中:</p><p id="363c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ pwd &gt; /root/.virtualenvs/virtual-env-name/.project</code></p><p id="74c4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保用虚拟环境的真实名称替换<code class="eh mp mq mr kf b">virtual-env-name</code>。现在，一旦您使用<code class="eh mp mq mr kf b">workon</code>命令激活您的虚拟环境，您将被自动导航到您项目的主路径。</p><p id="49a1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了正确设置环境变量，请键入:</p><p id="f40b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ nano /root/.virtualenvs/virtual-env-name/bin/postactivate # replace virtual-env-name with the real name</code></p><p id="e5cf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">并将这一行添加到文件中:</p><p id="b6ef" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">export DJANGO_SETTINGS_MODULE=app.settings</code></p><p id="91f8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保将<code class="eh mp mq mr kf b">app.settings</code>替换为Django应用程序中设置模块的位置。保存并关闭文件。</p><p id="d7cd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">假设您已经按照<a class="ae le" href="https://codingstartups.com/3-best-practices-better-setting-django-project/" rel="noopener ugc nofollow" target="_blank"> Django最佳实践帖子</a>中的描述设置了<code class="eh mp mq mr kf b">requirements.txt file</code>，现在您可以通过导航到<code class="eh mp mq mr kf b">requirements.txt</code>文件的路径并从您的虚拟环境中运行来一次安装您的所有需求:</p><p id="1261" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">(virtual-env-name) $ pip install -r requirements.txt</code></p><p id="04ee" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">设置PostgreSQL</p><p id="f0d8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">假设您已经按照<a class="ae le" href="https://codingstartups.com/3-best-practices-better-setting-django-project/" rel="noopener ugc nofollow" target="_blank"> Django最佳实践帖子</a>中的描述设置了您的设置模块，那么您现在应该已经将开发和生产设置文件分开了。您的<code class="eh mp mq mr kf b">production.py</code>设置文件也应该包含PostgreSQL连接设置。如果没有，请在文件中添加:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="cc94" class="kj kk hu kf b fv kl km l kn ko">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.postgresql',<br/>        'NAME': 'app_db',<br/>        'USER': 'app_user',<br/>        'PASSWORD': 'password',<br/>        'HOST': 'localhost',<br/>        'PORT': '5432',<br/>    }<br/>}</span></pre><p id="f4c0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我强烈建议在您的本地机器上更新和推送文件，并使用我们克隆的存储库从远程服务器上提取它。</p><p id="16a0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们开始创建生产数据库。在终端内，键入:</p><p id="423e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ sudo -u postgres psql</code></p><p id="0b42" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在您应该在PostgreSQL终端内部了。使用以下内容创建您的数据库和用户:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="ac93" class="kj kk hu kf b fv kl km l kn ko">&gt; CREATE DATABASE app_db;<!-- --> <br/>&gt; CREATE USER app_user WITH PASSWORD 'password';<!-- --> <br/>&gt; ALTER ROLE app_user SET client_encoding TO 'utf8';<!-- --> <br/>&gt; ALTER ROLE app_user SET default_transaction_isolation TO 'read committed';<!-- --> <br/>&gt; ALTER ROLE app_user SET timezone TO 'UTC';<!-- --> <br/>&gt; ALTER USER app_user CREATEDB;<!-- --> <br/>&gt; GRANT ALL PRIVILEGES ON DATABASE app_db TO app_user;</span></pre><p id="4993" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保您的详细信息与上述<code class="eh mp mq mr kf b">production.py</code>设置文件数据库配置相匹配。通过键入<code class="eh mp mq mr kf b">\q</code>退出PostgreSQL shell。</p><p id="5def" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，您应该准备好在新数据库上运行migrations命令了。假设您的所有迁移文件夹都在<code class="eh mp mq mr kf b">.gitignore</code>文件中，这意味着它们没有被推送到存储库中，那么您的迁移文件夹应该是空的。因此，您可以通过使用以下命令导航到主项目路径来设置DB:</p><p id="c9f1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">(virtual-env-name) $ cdproject</code></p><p id="882d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后运行:</p><p id="c289" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">【T2<br/><code class="eh mp mq mr kf b">(virtual-env-name) $ python ./manage.py makemigrations</code><br/><code class="eh mp mq mr kf b">(virtual-env-name) $ python ./manage.py migrate</code></p><p id="66ac" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">不要忘记通过键入以下命令为自己创建一个超级用户:</p><p id="e984" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">(virtual-env-name) $ python ./manage.py createsuperuser</code></p><h1 id="360f" class="lg kk hu bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">使用Supervisor配置Gunicorn</h1><p id="e4dc" class="pw-post-body-paragraph jc jd hu je b jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz hn dt translated">现在，一旦应用程序设置正确，就该配置网关向Django应用程序发送请求了。我们将使用Gunicorn作为我们的网关，这是常用的。</p><p id="8bcb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，通过键入以下命令导航到项目的主路径:</p><p id="6fff" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">(virtual-env-name) $ cdproject</code></p><p id="6f1e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，我们将通过键入以下命令来测试gunicorn:</p><p id="843a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">(virtual-env-name) $ gunicorn --bind 0.0.0.0:8000 app.wsgi:application</code></p><p id="a15e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保将<code class="eh mp mq mr kf b">app</code>替换为您的应用名称。一旦gunicorn运行您的应用程序，您应该能够访问<code class="eh mp mq mr kf b">http://IP_ADDRESS:8000</code>并看到您的应用程序在运行。</p><p id="56cf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当你完成测试后，点击<code class="eh mp mq mr kf b">Ctrl+C</code>停止gunicorn运行。</p><p id="5f4c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在是时候从服务中操作gunicorn了，以确保它持续运行。与其建立一个<code class="eh mp mq mr kf b">systemd</code>服务，我们不如用一种更健壮的方式来管理。顾名思义，Supervisor是监视和控制流程的一个很好的工具。它帮助您更好地理解您的流程是如何运行的。</p><p id="bf03" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要安装supervisor，请在虚拟环境外部键入:</p><p id="2b74" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ sudo apt-get install supervisor</code></p><p id="e155" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦supervisor运行，路径中包含的每个<code class="eh mp mq mr kf b">.conf</code>文件:</p><p id="4cea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">/etc/supervisor/conf.d</code></p><p id="ecec" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">表示受监控的进程。让我们添加一个新的<code class="eh mp mq mr kf b">.conf</code>文件来监控gunicorn:</p><p id="5f0c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ nano /etc/supervisor/conf.d/gunicorn.conf</code></p><p id="5024" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">并添加到文件中:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="8ab6" class="kj kk hu kf b fv kl km l kn ko">[program:gunicorn]<!-- --> <br/>directory=/home/django/app-django/app<!-- --> <!-- -->command=/root/.virtualenvs/virtual-env-name/bin/gunicorn --workers 3 --bind unix:/home/django/app-django/app/app.sock app.wsgi:application<!-- --> <br/>autostart=true<!-- --> <br/>autorestart=true<!-- --> <br/>stderr_logfile=/var/log/gunicorn/gunicorn.out.log<!-- --> <!-- -->stdout_logfile=/var/log/gunicorn/gunicorn.err.log<!-- --> <br/>user=root<!-- --> <br/>group=www-data<!-- --> <br/>environment=LANG=en_US.UTF-8,LC_ALL=en_US.UTF-8</span><span id="9592" class="kj kk hu kf b fv na km l kn ko">[group:guni]<!-- --> <br/>programs:gunicorn</span></pre><p id="c034" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保所有引用都已正确配置。保存并关闭文件。</p><p id="3a3d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，让我们通过运行以下命令来更新supervisor，以监视我们刚刚创建的gunicorn进程:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="13f8" class="kj kk hu kf b fv kl km l kn ko">$ supervisorctl reread<!-- --> <!-- -->$ supervisorctl update</span></pre><p id="7ffd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了验证流程的完整性，请使用以下命令:</p><p id="3b9b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ supervisorctl status</code></p><p id="6ecd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">到目前为止，gunicorn作为一个内部进程运行，而不是一个可以被机器外部的用户访问的进程。为了开始向gunicorn和Django应用程序发送流量，我们将把Nginx设置为web服务器。</p><h1 id="3269" class="lg kk hu bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">配置Nginx</h1><p id="28f3" class="pw-post-body-paragraph jc jd hu je b jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz hn dt translated">Nginx是最流行的网络服务器之一。Nginx和Gunicorn之间的集成是无缝的。在本节中，我们将设置Nginx向Gunicorn发送流量。为此，我们将创建一个新的配置文件(确保用您自己的应用名称替换<code class="eh mp mq mr kf b">app</code>):</p><p id="1285" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ nano /etc/nginx/site-available/app</code></p><p id="6d2c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后通过添加以下内容来编辑该文件:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="da3e" class="kj kk hu kf b fv kl km l kn ko">server {<br/> <!-- -->  listen 80;<!-- --> <br/>    server_name SERVER_DOMAIN_OR_IP;<!-- --> <br/>    location = /favicon.ico { access_log off; log_not_found off; }<!-- --> <br/>    location /static/ {<!-- --> <br/>        root /home/django/app-django/app;<!-- --> <br/>    }<!-- --> <br/>    location / {<!-- --> <br/>        include proxy_params;<!-- --> <br/>        proxy_pass http://unix:/home/django/app-django/app/app.sock;<!-- --> <br/>    }<!-- --> <br/>}</span></pre><p id="7c2e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此配置会将请求代理到服务器中的适当路由。确保根据Gunicorn和您的应用配置正确设置所有参考。</p><p id="7b00" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">启动与以下对象的链接:</p><p id="4be0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ ln -s /etc/nginx/sites-available/app /etc/nginx/sites-enabled</code></p><p id="748d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过运行以下命令检查Nginx配置:</p><p id="272d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ nginx -t</code></p><p id="1164" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">假设一切正常，通过运行以下命令重新启动Nginx:</p><p id="ba1f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ systemctl restart nginx</code></p><p id="bbc8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">到目前为止，您应该只需在浏览器中键入您的IP地址就可以访问您的服务器，因为Nginx监听端口80，这是浏览器使用的默认端口。</p><h1 id="ca9d" class="lg kk hu bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">安全性</h1><p id="a199" class="pw-post-body-paragraph jc jd hu je b jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz hn dt translated">干得好！现在您应该已经部署了Django应用程序！现在是时候保护应用程序了，以确保它很难被破解。为了做到这一点，我们将使用<code class="eh mp mq mr kf b">ufw</code>内置的Linux防火墙。</p><p id="8ff1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ufw通过配置规则来工作。规则告诉防火墙应该接受或拒绝哪种流量。此时，我们希望接受两种流量，或者说，我们希望打开两个端口:</p><ol class=""><li id="4bbb" class="kq kr hu je b jf jg jj jk jn ks jr kt jv ku jz kv kw kx ky dt translated">端口80，用于侦听通过浏览器传入的流量</li><li id="56ae" class="kq kr hu je b jf kz jj la jn lb jr lc jv ld jz kv kw kx ky dt translated">端口22能够通过SSH连接到服务器。</li></ol><p id="eca2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过键入以下命令打开端口:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="60c2" class="kj kk hu kf b fv kl km l kn ko">$ ufw allow 80<!-- --> <br/>$ ufw allow 22</span></pre><p id="c103" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后通过键入以下命令启用<code class="eh mp mq mr kf b">ufw</code>:</p><p id="1086" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mp mq mr kf b">$ ufw enable</code></p><p id="5f7b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">提示:</strong>在关闭终端之前，请确定您能够通过SSH从另一个终端连接到，这样您就不会因为防火墙的错误配置而被锁定在droplet之外。</p><h1 id="5dd3" class="lg kk hu bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">下一步做什么？</h1><p id="248d" class="pw-post-body-paragraph jc jd hu je b jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz hn dt translated">这篇文章是在一台服务器上部署Django应用程序的终极指南。如果你正在开发一个应用程序来服务更大的流量，我建议你考虑高度可扩展的服务器架构。你可以从我关于如何设计高可用性服务器架构的帖子开始。</p></div><div class="ab cl mi mj hc mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="hn ho hp hq hr"><figure class="ka kb kc kd fq iv"><div class="bz el l di"><div class="nb nc l"/></div></figure><p id="dbe5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">任何带有额外提示或新观点的评论都将受到高度赞赏！</p><p id="ac31" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">更多关于具有企业家精神的程序员的真知灼见，请访问<a class="ae le" href="https://codingstartups.com/" rel="noopener ugc nofollow" target="_blank">https://codingstartups.com</a>/</p><p id="af6f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最初发表于<a class="ae le" href="https://codingstartups.com/deploy-django-nginx-gunicorn-postgresql-supervisor/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div></div>    
</body>
</html>