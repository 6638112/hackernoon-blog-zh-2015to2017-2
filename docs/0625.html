<html>
<head>
<title>Rant: The Shell &amp; Terminal</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">咆哮:外壳和终端</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/rant-the-shell-terminal-4f45bb29dac8?source=collection_archive---------0-----------------------#2016-02-16">https://medium.com/hackernoon/rant-the-shell-terminal-4f45bb29dac8?source=collection_archive---------0-----------------------#2016-02-16</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="8741" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">声明:这是一个咆哮，但我的意思是这是一个有用的咆哮。这篇文章的重点是疯狂地对待事物，提供解决方案并探索它们。但是，我不会完全探究所提供的解决方案，因此它们可能显得不完整。我的意图不是过多地纠缠于它们的细节，而是刺激你的思维，试图动摇一些愚蠢的现状。</p><p id="3ab2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">哦，它也没有看起来那么长。它有一些图片和一个可选的附录。会很有趣的，我保证！</p><h1 id="adbc" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">标准流</h1><p id="0f52" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">想想你曾经写过的一个程序。因为您是一个真正的Unixer，所以您接受从stdin输出到stdout的输入。有一个美丽的简单，这是进一步加强了管道。管道真的很美。不开玩笑。它们是一个令人惊奇的概念，从概念上讲它们是有意义的。不是很多东西都有这个。</p><p id="2299" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那么让我们来看一个我们都知道并且喜爱的程序，curl:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="54ab" class="lb jq hu kx b fv lc ld l le lf">% curl -vvv <a class="ae lg" href="http://api.icndb.com/jokes/random" rel="noopener ugc nofollow" target="_blank">http://api.icndb.com/jokes/random</a> | jq '.value.joke'<br/>"Two wrongs don't make a right. Unless you're Chuck Norris. Then two wrongs make a roundhouse kick to the face."</span></pre><p id="0a59" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">curl会热情地回复它所连接的IP、请求和响应头，甚至进度条！最后，输出被传递给jq，在那里它可以尽情地为我们带来我们的笑话。</p><p id="7219" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">保持这种想法。这里有些可疑。</p><p id="50c6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">curl如何说明哪些数据(http响应)要传递给管道，哪些信息对用户有意义(进度条等)？毕竟，jq对请求的进度条不感兴趣，但是用户肯定感兴趣。</p><p id="9df9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您很可能知道答案:stderr。stdout是通过管道传递给命令的内容，而不是通过管道处理的stderr是由shell处理的。我们可以像这样显式地处理stderr:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="5b7a" class="lb jq hu kx b fv lc ld l le lf">% curl -vvv <a class="ae lg" href="http://api.icndb.com/jokes/random" rel="noopener ugc nofollow" target="_blank">http://api.icndb.com/jokes/random</a> 2&gt;/dev/null | jq '.value.joke'<br/>"Chuck Norris can win at solitaire with only 18 cards."</span></pre><p id="914d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">按照惯例，2是stderr的文件描述符，所以我们可以告诉我们的shell将它通过管道传输到某个文件。现在你看不到了。</p><p id="7ea1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可能没有注意到这里的“错误”，尤其是如果您是一个经验丰富的shell用户。我劝你再读一遍前面的几段。</p><p id="fcb9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">慢慢来。</p><h2 id="4c7d" class="lb jq hu bd jr lh li lj jv lk ll lm jz jc ln lo kd jg lp lq kh jk lr ls kl lt dt translated">搞什么</h2><p id="970f" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated"><em class="lu">我们究竟如何使用stderr作为约定来表示对用户有意义的输出呢？</em>它的字面意思是“标准<em class="lu">错误</em>，我们将其混编为<em class="lu">也就是</em>意思是“完全合法的输出”。</p><p id="63b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我试图想出一个合适的类比，但失败了，因为唯一合适的似乎是一家餐厅，它有一道名为“打我的脸”的菜，有时是美味的蛋奶酥，有时会让你脸上挨一拳。</p><p id="9cbd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这不仅仅是stderr。stdin也有问题:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="835e" class="lb jq hu kx b fv lc ld l le lf">% echo 4 | read -E<br/>4</span></pre><p id="7a04" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有一个程序接受来自stdin的输入，但也需要用户输入(“你确定”s，多步输入等)？太糟糕了，如果你是管道！</p><p id="7e8d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">是的，你可以做像操纵<em class="lu"> /dev/tty </em>和朋友这样的事情。但这不是重点。你也可以使用诅咒，或者写一个GUI或者一个服务器，或者你可以直接去百慕大或者巴哈马群岛。</p><p id="185f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">重点是stdin、stdout和stderr这三个神圣的组合有缺陷。他们混淆了两个不同的概念:<em class="lu">程序</em>交互和<em class="lu">用户</em>交互。我们希望管道用于数据的<em class="lu">程序化</em>操作，终端用于数据的<em class="lu">交互式</em>操作。</p><h2 id="36a1" class="lb jq hu bd jr lh li lj jv lk ll lm jz jc ln lo kd jg lp lq kh jk lr ls kl lt dt translated">一个谦卑的提议</h2><p id="6907" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">我们添加了另外两个流:userin和userout。管道在标准输入和标准输出之间绑定，用户输入和用户输出被绑定到终端。</p><figure class="ks kt ku kv fq lw fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/4482ed5c7b479459a978ec76ac86ef45.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*bDtPUCjiXGpV21dpuSEISg.png"/></div></figure><p id="24e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果在你面前没有管道，你从stdin中读取，那么你是从终端，也就是userin中读取。如果你没有连接到终端，那么一切正常:阅读将永远受阻，写作没有任何效果。</p><p id="2305" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以下是出现的一些复杂情况:</p><ol class=""><li id="8fe6" class="lz ma hu it b iu iv iy iz jc mb jg mc jk md jo me mf mg mh dt translated">我们应该如何将userin或userout重定向到其他管道？</li><li id="520c" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">任何硬编码fds 3或4的东西都将被破坏。</li><li id="2bbf" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">像apt-get这种你平时和<em class="lu"> yes </em>结合的程序呢？如果他们接受来自userin的输入，考虑到列表中的第1点，那么<em class="lu"> yes </em>将如何向其写入？坦白地说，我并不为他们感到遗憾。这应该是你传递给程序的一个标志。<em class="lu">是的</em>是一个hack。</li><li id="cc40" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">然而，它确实提出了一个有效的编程决策:我们从stdin接受什么，从userin接受什么？没有直接的答案，但是如果你想一想，你可能已经有答案了:适合程序的结构化输入(比如init文件格式、html或任何真正的结构化数据)来自stdin。人工输入(如提示、查询等)来自用户。这还得考虑清楚。</li><li id="2ebd" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">同样的问题也适用于stdout和userout。我的直觉告诉我，这也不是一个那么复杂的决定:每当您觉得需要写入stderr时，就使用userout，但这并不意味着出错。stdout仍然是程序的输出，这一点没有改变。userout是针对用户的显式输出<em class="lu">。</em></li><li id="c676" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">宋承宪呢？tmux呢？</li><li id="9171" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">这不仅仅是libc的变化，包括这些变量——终端需要合作。当您使用最新的libc，但使用非compat终端时，会发生什么情况？那么userin和userout的语义是什么呢？</li></ol><p id="02a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对这些问题的一个可能的解决方案是用一个libc函数给你userin和userout的句柄，这样它们就不是普通的全局变量了。这意味着它们是不可管道化的，至少没有特殊的语法是不行的。我对此很高兴。</p><p id="7e3c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我真的很喜欢这个想法，因为它增加了美感，同时又不破坏一切:程序仍然通过管道进行交互。而且是opt-in——引入userin和userout之前写的程序不会有什么感觉，之后写的程序终于可以不把用户输出写到stderr并且知道可以从userin获取用户输入了。</p><h1 id="1193" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">对人类有意义的输出</h1><p id="9beb" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">不过，说够了。让我们继续讨论更有争议的话题。</p><p id="79bb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在是2016年，我仍然不能在我的终端上查看图像，或者看到语法高亮显示的文件，或者交互式地阅读pdf或绘制图表。这里的趋势是，你只能查看文本，而不能查看其他任何内容。</p><p id="f1cb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不一定要这样。写下这几行字我就开始害怕了，但是如果……如果……终端不仅限于文本呢？</p><figure class="ks kt ku kv fq lw fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/1b5af673450a78978d2f252df9938b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*78wN9auFQXu60LaNwZ7ghw.png"/></div></figure><p id="6734" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">未来就在这里，它的提示是一只Nyan猫。<a class="ae lg" href="https://www.enlightenment.org/about-terminology" rel="noopener ugc nofollow" target="_blank">术语</a>实现了我要求的所有功能，甚至更多。在上面的图片中，我输入<em class="lu">蒂卡特·3d-save.png</em>，一个图像出现了，所以我有什么可抱怨的，对吗？</p><p id="4169" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">问题在于标准。我们需要一种标准的方式来告诉我们的终端，嘿，这里的输出是一个图像或视频或PostScript或代码文件，请适当地格式化它。对于这种输出，一个终端实现一个<em class="lu">单独的命令</em>是不够好的。刚刚安装完Ubuntu作为他们的第一个Linux发行版的人应该能够启动gnome-terminal和一个猫图像。</p><p id="021e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">记住，有了userout的加入，我们就有了一种方式来传达一条信息是给用户的，而不是给一个无关紧要的程序的，所以管道不是我们的一个大问题。</p><p id="9614" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这不是在公园散步。我们再次面临一系列问题:</p><ol class=""><li id="6f9a" class="lz ma hu it b iu iv iy iz jc mb jg mc jk md jo me mf mg mh dt translated">我们如何交流输出类型？我怎么说我将要写一个svg或者ogg呢？</li><li id="a7d8" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">我们如何写几个不同性质的东西？如果我有一个想播放的视频和一个要显示的gif，我必须在开始写gif之前写完视频吗？</li><li id="d7fc" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">支持哪些格式？列表实现是依赖的吗？有最低要求吗？是否有各种格式的规范实现列表？我们如何从中选择一个呢？</li><li id="8b50" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">控件呢？可以播放/暂停/静音/循环播放视频吗？这种支持是强制性的吗？最低要求的控制是什么？gif有控件吗？</li><li id="1691" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">那么<em class="lu">屏幕</em>和<em class="lu"> tmux </em>呢？我连接并在我的SuperAwesomeTerm <em class="lu"> cat </em>中连接一个图像，然后再连接OldGrumpyTerm。不仅如此，我还决定ssh到我自己和连接。会发生什么？</li><li id="4207" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">我们怎么关掉它？我实际上想看图像的二进制斑点。</li><li id="f85b" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">我是Bob，我写了BobTerm。你让我处理各种糟糕的事情！它曾经是简单的文本，但现在我必须知道如何输出随机的二进制格式！<a class="ae lg" href="https://github.com/GNOME/vte" rel="noopener ugc nofollow" target="_blank"> libvte </a>甚至不支持这个(…还不支持)。</li><li id="c2fc" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">这不是淘汰了<a class="ae lg" href="http://www.mplayerhq.hu/design7/news.html" rel="noopener ugc nofollow" target="_blank"> <em class="lu"> mplayer </em> </a>或者<a class="ae lg" href="https://feh.finalrewind.org/" rel="noopener ugc nofollow" target="_blank"> <em class="lu"> feh </em> </a>之类的东西吗？如果你能<em class="lu">猫</em>一个图像，那么你为什么需要<em class="lu"> feh </em>来做呢？其实这不是给了终端太大的权力吗？</li></ol><p id="cbf4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要解决的最简单的问题是发出文件格式的信号。对此我们有<a class="ae lg" href="https://tools.ietf.org/html/rfc2045" rel="noopener ugc nofollow" target="_blank">的模拟动作</a>。但这不是简单地写一个mime头后跟一个换行符的问题:如果我们不想发送mime头呢？如果我们不发送mime头，但是我们的输出看起来完全像一个mime头呢？</p><p id="8104" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要处理1和2，一个相对简单的方法是能够“分叉”一个流。c伪代码:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="66f7" class="lb jq hu kx b fv lc ld l le lf">FILE *userout = getuserout();<br/>FILE *video_stream = forkstream(userout, “video/ogg”);<br/>FILE *gif_tream = forkstream(userout, “image/gif”);</span></pre><p id="f191" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将允许我们提供一个mime类型，并且可以无忧无虑地传递文件。比这更酷的是确保在写入<em class="lu"> gif_stream </em>的同时写入<em class="lu"> video_stream </em>不会导致冲突。这将很难实现，但我认为这是值得的。</p><p id="47ff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">令人烦恼的是，我们需要处理3、4和5:不支持这些的终端怎么办？符合标准所需的最低格式数量是多少？多终端呢？</p><p id="d7f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们做一个侧边栏，我认为这个侧边栏不仅与这一点或这种咆哮有关，而且与整个系列的咆哮有关。与其听我唠叨(我敢肯定你现在已经厌倦了)，我建议你听听比我聪明的人说些聪明的话。收听，直到他展示幻灯片“网站需要在每个浏览器中看起来完全一样吗？”也许更多。无论如何你应该看那个讲座。尼古拉斯·扎卡斯谈渐进式改进:</p><figure class="ks kt ku kv fq lw"><div class="bz el l di"><div class="mo mp l"/></div></figure><p id="85da" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">决定跳过还是只想看我说话？哦，你这个马屁精。以下是他所说的内容:</p><p id="0c6b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">电视过去只显示黑白画面。然后，人们开始制造彩色电视，然后是高清电视。尽管它们的功能大相径庭，但它们都能够显示相同的内容:你插入它们，它们会向你显示《老友记》的第100次重播。</p><p id="8427" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我还没有意识到的一个问题是，这是否给了终端太多的责任。我认为答案是否定的。终端应该支持它想要支持的确切数量，而不是超出的格式。但是它应该有这个基本的能力:程序应该能够向用户显示它们正在显示的内容。</p><p id="e0cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是可能的。我们已经在其他地方做了。我们只是忽略了终点站。</p><h2 id="d4ce" class="lb jq hu bd jr lh li lj jv lk ll lm jz jc ln lo kd jg lp lq kh jk lr ls kl lt dt translated">让我们停止忽视终端</h2><p id="695b" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">鱼对你的壳做了惊人的事情。你有补全建议和颜色，还有这么多有意义的东西，以至于你想知道为什么还有人自愿使用bash！？<a class="ae lg" href="http://www.zsh.org/" rel="noopener ugc nofollow" target="_blank"> zsh </a>这是一个绝对的野兽，尽管它是bash的替代者，但仍然不是无处不在。</p><p id="8b05" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为什么？为什么你的发行版不附带zsh或者fish？平心而论，有些人是这样认为的。我可以说<a class="ae lg" href="http://archlinux.org" rel="noopener ugc nofollow" target="_blank"> Arch </a>的安装镜像带有一个配置好的zsh。但这只是沧海一粟。Ubuntu为什么不用zsh作为默认？为什么CentOS不给你鱼？</p><p id="e1cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我不知道为什么我们要这样对待自己。你的屏幕太棒了。你可以用它看高清电影。但是当你在终端工作的时候，你可能连反alised字体都没有。</p><h1 id="e728" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">我们几乎拥有的东西</h1><p id="9853" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">在写这篇文章的时候，我在谷歌上搜寻我的想法。不可能只有我一个人有添加标准流或者让shell不那么可怕的疯狂想法。事实上，出现了两个流行的项目:<a class="ae lg" href="https://github.com/p-e-w/finalterm" rel="noopener ugc nofollow" target="_blank"> FinalTerm </a>和<a class="ae lg" href="https://github.com/unconed/TermKit" rel="noopener ugc nofollow" target="_blank"> TermKit </a>。</p><p id="8c62" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">FinalTerm触及了我在终结部分提出的一些观点。它也从来没有脱离过alpha，而且它还遭受着<a class="ae lg" href="http://worldwidemann.com/finally-terminated/" rel="noopener ugc nofollow" target="_blank">死亡</a>的严重劣势。</p><p id="5f25" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">无论是好是坏，TermKit都让我吃惊。它击中了我的目标，然后更多。它也遭受同样的死亡症状。我不打算在这里涵盖一切，因为一篇文章发表在这个reddit页面上。</p><p id="ee00" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些项目的失败并没有让我开心。FinalTerm死于技术原因和常规的OSS原因(首席开发人员失去动力，谁来掌权？)，而TermKit的消亡既是因为技术原因，也是因为它试图在太短的时间内做太多的事情。这不是激励。</p><h2 id="0306" class="lb jq hu bd jr lh li lj jv lk ll lm jz jc ln lo kd jg lp lq kh jk lr ls kl lt dt translated">前进的道路</h2><p id="49f5" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">最让我难过的是，我就是不知道该拿这些想法怎么办。即使我实现了自己的shell和终端，这也是不够的——这些事情需要程序开发者的合作。有可能太晚了，我们会一直处于今天的状态。不是<em class="lu">不好是</em>不好。只是…呃。</p><p id="124e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">呃。</p><p id="4031" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我不知道接下来会发生什么。</p><h1 id="b329" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">更新:我接下来做了什么</h1><p id="c629" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">我开始开发一款名为plex的<a class="ae lg" href="https://github.com/Zirak/plex" rel="noopener ugc nofollow" target="_blank">终端模拟器。</a>这不会是一个完整的技术演示，只会提供这里提出的想法的概念证明(希望如此)。</p><p id="ee01" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们看看它去哪里。</p></div><div class="ab cl mq mr hc ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hn ho hp hq hr"><h1 id="0183" class="jp jq hu bd jr js mx ju jv jw my jy jz ka mz kc kd ke na kg kh ki nb kk kl km dt translated">附录</h1><p id="3569" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">但是等一下…你想去哪里？我们还没完成。这一部分详细描述了我无法解决的问题，或者我对这个问题的想法还不成熟，不重要。请随意跳过这一部分或整篇文章！做后一件事可能有点晚了。</p><h2 id="0717" class="lb jq hu bd jr lh li lj jv lk ll lm jz jc ln lo kd jg lp lq kh jk lr ls kl lt dt translated">Shell和getopt语法</h2><p id="b9e8" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">让我们从一些新鲜的东西开始:向命令传递参数。</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="2c00" class="lb jq hu kx b fv lc ld l le lf"># It always starts out simple:<br/>% ls something<br/>% ls -l something<br/>% ls --format=long<br/># wait, or was it<br/>% ls --format long<br/># what about spaces<br/>% ls ’01. Serenity.mp4'<br/># and quotes<br/>% ls “I’m a teapot”<br/>% ls I\’m\ a\ teapot<br/># now you’ll want to kill yourself<br/>% grep -EIrn ‘can \’you [\\doubt] \”w\\/hy’</span></pre><p id="00b8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我都不知道上一个例子对不对。我不忍心去经历它。</p><p id="2d46" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有很多方法可以向命令传递参数，其中一些必须以某种格式作为前缀。有些旗帜需要单破折号，有些旗帜需要双破折号。而且有很多不一致的逻辑:通常双破折号是一个多字母单词的前缀，但有时不是(例如:<em class="lu"> mplayer -sub subtitle-path </em>，还有<em class="lu"> mplayer - help </em>，以及<em class="lu"> find </em>是一个惯犯)。有时你可以在一个破折号中指定几个单字母的参数，例如<em class="lu"> grep </em>，但是有时事情很奇怪，比如在<em class="lu"> head -20 path </em>中，它将破折号后的数字参数视为表示<em class="lu"> -n </em>，这样的例子不胜枚举。</p><p id="e6c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不要让我开始<em class="lu"> find -exec </em>和你必须经历的那种杂耍，更不要说将东西通过管道传递到<em class="lu"> sh -c </em>！</p><p id="b8be" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">哦，让我们不要忘记<em class="lu"> -帮助</em>，这有时工作，但有时不处理。想象一下，如果您的shell能够通过首先使用- <em class="lu"> help </em>运行程序并解析结果，为您提供智能提示和补全，从而智能地推断程序的参数，这将是多么强大。但是当然，使用输出根本不是标准化的，所以你可以忘记这一点。像Python的<em class="lu"> argparse </em>或Ruby的<em class="lu"> optparse </em>这样的内置参数解析器在某种程度上缓解了这个问题，但是你永远不会在libc中看到这样的东西。</p><p id="cfe9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还有就是变量展开是多么的怪异。这就像愚蠢的文本宏。我们应该得到更好的。</p><p id="f7d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">fish在这个基础上有所改进，并且在这个过程中打破了很多东西(这有好有坏)。但我认为他们做得还不够。我想要一种合适的编程语言。</p><p id="b2cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在告诉我:你运行过ipython吗？</p><p id="23ec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是一次令人难以置信的经历。如果我是一个更勇敢的人，我会做。这更像是我们应得的。我们应该拥有一种合适的编程语言，拥有合理的管道和变量语法，以及真正的帮助。</p><p id="9b01" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们永远也不会得到它。</p><h2 id="9337" class="lb jq hu bd jr lh li lj jv lk ll lm jz jc ln lo kd jg lp lq kh jk lr ls kl lt dt translated">输出格式</h2><p id="4b02" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">假设你有两个程序，它们想互相发送数据。为了使事情变得简单一点，您可以通过shell运行两者，这样就可以用管道将它们连接起来。最著名的例子就是ps和grep:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="12b6" class="lb jq hu kx b fv lc ld l le lf">% ps aux | grep dbus</span></pre><p id="3922" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里又有问题了。我在第一个例子中用curl和jq巧妙地提到了这一点。程序不会互相发送结构化的、机器友好的数据。由于程序输出和人类输出之间的卷积，随着时间的推移，程序采用了它们自己的输出惯例，而你，这个输出消费者，只能靠你自己去理解这里发生了什么。<br/>澄清一下:<em class="lu"> ps </em>输出不容易被机器读取和解析。我们的程序既需要知道我们正在接受来自ps的输入，也需要知道如何解析该输入。</p><p id="0452" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这有好有坏。这很好，因为让你的程序输出自由格式的文本是令人惊奇的。这很糟糕，因为让程序输出自由格式的文本很难处理。</p><p id="e98d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这不是一个容易解决的问题。大多数人说“开始传递对象而不是文本”，但这并不像看起来那么容易。程序间通信的语义是一个难题。这里有一些困难:</p><ol class=""><li id="3b22" class="lz ma hu it b iu iv iy iz jc mb jg mc jk md jo me mf mg mh dt translated">改变这一切会打破一切。如果没有某种黑客解决方案，程序将需要知道昨天用X格式写输出的程序现在什么时候用y格式写输出。</li><li id="07e8" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">这需要改变<em class="lu">一切</em>。从<em class="lu"> ls </em>到<em class="lu"> ssh </em>到<em class="lu">安装</em>到<em class="lu">滑轨</em>。这种变化是巨大的，不会在一夜之间发生，这意味着采用将会落后。</li><li id="c64c" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">如果把结构化输出写到stdout会怎么样？你不希望用户看到一些难看的原始数据。</li><li id="5ebb" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">你失去了很多自由。如果你被绑定到一个输出格式，你想表达的东西不包括在那里，你就只能用黑客了。</li><li id="aff5" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">说到这里，我还没有说我们将使用什么格式。<a class="ae lg" href="http://json.org/" rel="noopener ugc nofollow" target="_blank"> JSON </a>？<a class="ae lg" href="http://msgpack.org/index.html" rel="noopener ugc nofollow" target="_blank">消息包</a>？<a class="ae lg" href="http://bert-rpc.org/" rel="noopener ugc nofollow" target="_blank">伯特</a>？<a class="ae lg" href="https://capnproto.org/" rel="noopener ugc nofollow" target="_blank"> Cap'n Proto </a>？数百万人中还有其他人吗？我们如何选择其中一个？<br/>如果我们选择像<a class="ae lg" href="https://developers.google.com/protocol-buffers/" rel="noopener ugc nofollow" target="_blank"> Protobuf </a>或<a class="ae lg" href="https://thrift.apache.org/" rel="noopener ugc nofollow" target="_blank">credit</a>这样的强类型解决方案，那么我们如何传达我们的模式呢？<br/>如果我们选择像<a class="ae lg" href="https://en.wikipedia.org/wiki/S-expression" rel="noopener ugc nofollow" target="_blank">S-表达式</a>这样的弱类型解决方案，我们会遇到验证和去串行化的问题，这将我们引向下一个问题:</li><li id="7f80" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">我们将如何实现序列化和反序列化？不同的语言对类型和值有着截然不同的概念。你如何编写一个非常大的整数，而又不破坏你旁边的程序，如果没有BigDecimal库，这个程序是无法处理的？日期和随机物体呢？你能发送函数吗？</li><li id="b021" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">谁负责验证？当然，程序应该总是净化它们的输入，但是如果程序写出无效的输出会发生什么呢？贝壳给了它严厉的谈话吗？它会随之滚动吗？</li><li id="c2ce" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">一旦选择了一种格式，我们就几乎永远被卡住了。新的语言必须实现这种序列化和反序列化。谁来写这些解析器呢？编写解析器很难。</li><li id="711f" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">更不用说流了——我们的数据序列化格式需要是可流的，以便通过管道正确使用。</li><li id="0a82" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">这如何影响通过文件访问的众多Linux APIs，比如在<em class="lu"> proc </em>树中的那些？是否将<em class="lu"> /proc/mount </em>和<em class="lu"> /proc/net/arp </em>等进行更改，以便为您提供此序列化输出？这些是向后不兼容的主要来源。</li><li id="f7c9" class="lz ma hu it b iu mi iy mj jc mk jg ml jk mm jo me mf mg mh dt translated">去他妈的，我不干了。</li></ol><p id="56c1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可能会认为Powershell已经解决了这个问题。这就像说Python解决了这个问题——Powershell只在特定平台上编写的程序之间进行通信，而不是在完全不同的平台之间进行通用的协调。Java如何将日期对象传递给Erlang？Io(使用原型继承)如何将对象发送给C？</p><p id="2225" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是一个难题。一个今天无法解决的问题。对于一个比我聪明的人来说，说聪明的话，我建议你看乔·阿姆斯特朗的《如何以及为什么把事情安排在一起》:</p><figure class="ks kt ku kv fq lw"><div class="bz el l di"><div class="nc mp l"/></div></figure><div class="ks kt ku kv fq ab cb"><figure class="nd lw ne nf ng nh ni paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nd lw ne nf ng nh ni paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nd lw ne nf ng nh ni paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nj nk nl"><p id="f922" class="ir is lu it b iu iv iw ix iy iz ja jb nm jd je jf nn jh ji jj no jl jm jn jo hn dt translated"><a class="ae lg" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae lg" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae lg" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae lg" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is lu it b iu iv iw ix iy iz ja jb nm jd je jf nn jh ji jj no jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae lg" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae lg" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ks kt ku kv fq lw fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff np"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure></div></div>    
</body>
</html>