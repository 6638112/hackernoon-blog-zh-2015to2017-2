<html>
<head>
<title>Multithreading, Multiprocessing and the NodeJS event loop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多线程、多重处理和NodeJS事件循环</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/multithreading-multiprocessing-and-the-nodejs-event-loop-5b2929bd450b?source=collection_archive---------0-----------------------#2016-04-12">https://medium.com/hackernoon/multithreading-multiprocessing-and-the-nodejs-event-loop-5b2929bd450b?source=collection_archive---------0-----------------------#2016-04-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/></div><div class="ab cl ir is hc it" role="separator"><span class="iu bw bk iv iw ix"/><span class="iu bw bk iv iw ix"/><span class="iu bw bk iv iw"/></div><div class="hn ho hp hq hr"><p id="941b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">最近有一位面试官问我关于NodeJS中多线程的问题。我声称精通NodeJS，但面试官和我自己很快意识到有一些基本概念我没有花时间去研究。面试后，我决定阅读NodeJS事件循环和多线程。</p><p id="ace2" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">Node.js应用程序在单线程上运行。在这个线程中，事件循环监听事件，然后在检测到事件时触发与事件相关的回调函数。通过这个简单的例子，我们可以看出Node.js不支持多线程，因为每个应用程序都运行在一个线程上。同样，如果面试官问Node.js是否支持多线程，你可以自信地说不。</p><p id="87cc" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">尽管不支持多线程，但有一种方法可以通过使用进程来利用多核系统的能力。Node.js有一个名为<strong class="ja hv"> cluster </strong>的模块，旨在支持多处理替代方案。让我们从Node.js <a class="ae jw" href="https://nodejs.org/api/cluster.html#cluster_cluster" rel="noopener ugc nofollow" target="_blank"> docs </a>中查看一些代码。</p><pre class="jx jy jz ka fq kb kc kd ke aw kf dt"><span id="c543" class="kg kh hu kc b fv ki kj l kk kl">const cluster = require('cluster');<br/>const http = require('http');<br/>const numCPUs = require('os').cpus().length;<br/><br/>if (cluster.isMaster) {<br/>  // Fork workers.<br/>  for (var i = 0; i &lt; numCPUs; i++) {<br/>    cluster.fork();<br/>  }<br/><br/>  cluster.on('exit', (worker, code, signal) =&gt; {<br/>    console.log(`worker ${worker.process.pid} died`);<br/>  });<br/>} else {<br/>  // Workers can share any TCP connection<br/>  // In this case it is an HTTP server<br/>  http.createServer((req, res) =&gt; {<br/>    res.writeHead(200);<br/>    res.end('hello world\n');<br/>  }).listen(8000);<br/>}</span></pre><p id="f404" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">集群模块允许您生成多个子进程，这些子进程可以共享一个公共端口。在此示例中，工作进程正在侦听端口8000上的http连接。有了子进程，系统可以处理更大的负载。万岁！</p><p id="fc8b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我们已经成功实现了一个多核Node.js应用，但是每一个设计决策都需要权衡评估。在这种情况下，我们的权衡与多线程和多处理的概念有关。线程共享相同的内存空间，创建新线程不会占用太多系统资源。进程在单独的内存分配中运行，程序的完整副本增加了应用程序的内存开销。在内存不足的情况下，Node.js可能是应用程序代码最低效的工具。</p><p id="e48b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果我向我的面试官解释这些概念，我肯定会给他留下深刻印象。不过，没造成什么伤害。最后，这次经历给了我一个学习新东西的机会。</p><p id="46a2" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">2016年4月12日</p></div><div class="ab cl ir is hc it" role="separator"><span class="iu bw bk iv iw ix"/><span class="iu bw bk iv iw ix"/><span class="iu bw bk iv iw"/></div><div class="hn ho hp hq hr"><p id="1946" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">👋🏽嗨！我是史蒂文·纳特拉。在推特上关注我<a class="ae jw" href="https://twitter.com/stevennatera" rel="noopener ugc nofollow" target="_blank"> @StevenNatera </a>。我积极参与了<a class="ae jw" href="https://github.com/nodox" rel="noopener ugc nofollow" target="_blank">开源社区</a>，特别是<a class="ae jw" href="https://www.gatsbyjs.org/contributors/steven-natera" rel="noopener ugc nofollow" target="_blank"> GatsbyJS </a>。我喜欢写代码、初创公司、React和Kubernetes。</p></div></div>    
</body>
</html>