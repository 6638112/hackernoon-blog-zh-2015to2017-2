<html>
<head>
<title>Getting Started with Buck build on Travis CI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从基于Travis CI的Buck build开始</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/getting-started-with-buck-build-on-travis-ci-d1208d363023?source=collection_archive---------9-----------------------#2017-06-14">https://medium.com/hackernoon/getting-started-with-buck-build-on-travis-ci-d1208d363023?source=collection_archive---------9-----------------------#2017-06-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/7f3bc404e7b1b722f063e510969d9f1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MCxfYV5auuhkoAUCGrZsfw.jpeg"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Travis CI, Made in Berlin (Photo by <a class="ae ih" href="https://unsplash.com/@markusspiske" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a>)</figcaption></figure><div class=""/><p id="bfd4" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><a class="ae ih" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>是一项为开源项目提供免费构建服务器的服务(<a class="ae ih" href="https://www.crunchbase.com/organization/travis-ci/timeline#/timeline/index" rel="noopener ugc nofollow" target="_blank">谢谢，风投们！</a>)。它与GitHub紧密集成，允许您在合并之前自动构建和测试pull请求中的代码。这对于有多个参与者的项目来说是非常好的，因为您可以运行测试而不用自己签出代码。</p><p id="f55e" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">但是你如何将一个基于Buck的项目与Travis CI整合起来呢？</p><p id="f5c3" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">要遵循本指南，您需要具备以下条件:</p><ul class=""><li id="8d37" class="kf kg ik jj b jk jl jo jp js kh jw ki ka kj ke kk kl km kn dt translated">用Buck构建的GitHub项目</li><li id="c67d" class="kf kg ik jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated">关于<a class="ae ih" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank">特拉维斯CI </a>的一个记述</li></ul><h2 id="3d68" class="kt ku ik bd kv kw kx ky kz la lb lc ld js le lf lg jw lh li lj ka lk ll lm ln dt translated">TL；速度三角形定位法(dead reckoning)</h2><p id="426e" class="pw-post-body-paragraph jh ji ik jj b jk lo jm jn jo lp jq jr js lq ju jv jw lr jy jz ka ls kc kd ke hn dt translated">从GitHub 上的<a class="ae ih" href="https://github.com/njlr/buck-travis-example" rel="noopener ugc nofollow" target="_blank">示例报告中获取相关文件。</a></p><h2 id="9fdb" class="kt ku ik bd kv kw kx ky kz la lb lc ld js le lf lg jw lh li lj ka lk ll lm ln dt translated">创建. travis.yml文件</h2><p id="3423" class="pw-post-body-paragraph jh ji ik jj b jk lo jm jn jo lp jq jr js lq ju jv jw lr jy jz ka ls kc kd ke hn dt translated">Travis项目的核心是<code class="eh lt lu lv lw b">.travis.yml</code>文件。这是一个YAML文件，它定义了项目的构建步骤和构建环境。最重要的属性是<code class="eh lt lu lv lw b">script</code>，它是Bash命令的列表。</p><p id="cb02" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">例如:</p><figure class="lx ly lz ma fq hw"><div class="bz el l di"><div class="mb mc l"/></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Run build.sh on Ubuntu “Trusty”</figcaption></figure><h2 id="a1c8" class="kt ku ik bd kv kw kx ky kz la lb lc ld js le lf lg jw lh li lj ka lk ll lm ln dt translated">安装生成依赖项</h2><p id="2e64" class="pw-post-body-paragraph jh ji ik jj b jk lo jm jn jo lp jq jr js lq ju jv jw lr jy jz ka ls kc kd ke hn dt translated">Buck没有与任何Travis系统映像打包在一起，所以我们需要在Travis文件中添加一个安装步骤。安装步骤活在<code class="eh lt lu lv lw b">before_install</code>元素下。</p><p id="d298" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让Buck在Linux上运行最简单的方法是通过<a class="ae ih" href="http://linuxbrew.sh/" rel="noopener ugc nofollow" target="_blank"> Linuxbrew </a>，这是<a class="ae ih" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">家酿</a>的Linux端口。像Homebrew一样，Linuxbrew允许我们在用户空间轻松地安装软件包，并且它基本上是软件包兼容的。</p><figure class="lx ly lz ma fq hw"><div class="bz el l di"><div class="mb mc l"/></div></figure><p id="7f3e" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">此代码片段在项目生成之前运行。首先，它安装Linuxbrew，然后使用Linuxbrew安装Buck。</p><p id="3f09" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可能已经注意到我们<em class="md">没有</em>使用提供的Linuxbrew安装脚本。这是因为最好将所有内容都保存在主文件夹中，这样可以确保Travis用户拥有读写权限。</p><p id="efbb" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">一旦我们安装了Buck，<code class="eh lt lu lv lw b">.travis.yml</code>的<code class="eh lt lu lv lw b">script</code>部分可以调用Buck:</p><figure class="lx ly lz ma fq hw"><div class="bz el l di"><div class="mb mc l"/></div></figure><p id="031b" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">综上所述，我们有以下几点:</p><figure class="lx ly lz ma fq hw"><div class="bz el l di"><div class="mb mc l"/></div></figure><p id="10eb" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">将该文件添加到您的项目的根目录，并确保将<code class="eh lt lu lv lw b">buck build</code>命令更改为指向正确的Buck目标！</p><h2 id="9e06" class="kt ku ik bd kv kw kx ky kz la lb lc ld js le lf lg jw lh li lj ka lk ll lm ln dt translated">将Travis CI连接到GitHub</h2><p id="d029" class="pw-post-body-paragraph jh ji ik jj b jk lo jm jn jo lp jq jr js lq ju jv jw lr jy jz ka ls kc kd ke hn dt translated">一旦Travis文件就绪，您需要将Travis CI连接到您的GitHub项目。<a class="ae ih" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank">在Travis CI </a>上创建一个账户，然后轻触你想要整合的项目。</p><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div class="fe ff me"><img src="../Images/cdfd179b9ba7ca0c062646ed06ac2945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*zzk45Yb4wmbccK-PHRZbDw.png"/></div></figure><p id="f439" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Travis现在将与您的项目集成在一起，它将开始构建<code class="eh lt lu lv lw b">master</code>。您还会注意到有用的通知出现在您的拉取请求中！</p><h2 id="e879" class="kt ku ik bd kv kw kx ky kz la lb lc ld js le lf lg jw lh li lj ka lk ll lm ln dt translated">加速构建</h2><p id="eac6" class="pw-post-body-paragraph jh ji ik jj b jk lo jm jn jo lp jq jr js lq ju jv jw lr jy jz ka ls kc kd ke hn dt translated">构建需要一段时间，因为每次都要安装所有的依赖项！我们可以通过利用Travis CI的缓存功能来大幅改善这一点。</p><p id="a078" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Travis CI允许您将目录标记为缓存的，这意味着它可以在两次构建之间重用。由于我们在userland中安装了Linuxbrew，我们可以缓存整个<code class="eh lt lu lv lw b">~/.linuxbrew</code>目录。在后续的构建中，Linuxbrew将检测到我们的依赖项已经安装，并跳过安装步骤。</p><figure class="lx ly lz ma fq hw"><div class="bz el l di"><div class="mb mc l"/></div></figure><p id="2d30" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们还需要确保我们不会<code class="eh lt lu lv lw b">git clone</code> Linuxbrew两次:</p><figure class="lx ly lz ma fq hw"><div class="bz el l di"><div class="mb mc l"/></div></figure><p id="5a54" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">把所有东西放在一起就能得到完整的特拉维斯档案。</p><figure class="lx ly lz ma fq hw"><div class="bz el l di"><div class="mb mc l"/></div></figure><h2 id="d0dc" class="kt ku ik bd kv kw kx ky kz la lb lc ld js le lf lg jw lh li lj ka lk ll lm ln dt translated">结论</h2><p id="f22a" class="pw-post-body-paragraph jh ji ik jj b jk lo jm jn jo lp jq jr js lq ju jv jw lr jy jz ka ls kc kd ke hn dt translated">就是这样！完整的Travis文件应该足以开始，或者您可以从GitHub 上的<a class="ae ih" href="https://github.com/njlr/buck-travis-example" rel="noopener ugc nofollow" target="_blank">示例repo中获取相关文件。</a></p><div class="lx ly lz ma fq ab cb"><figure class="mf hw mg mh mi mj mk paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mf hw mg mh mi mj mk paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mf hw mg mh mi mj mk paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ml mm mn"><p id="f922" class="jh ji md jj b jk jl jm jn jo jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd ke hn dt translated"><a class="ae ih" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ih" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ih" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ih" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jh ji md jj b jk jl jm jn jo jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd ke hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ih" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ih" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lx ly lz ma fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mr"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>