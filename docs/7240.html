<html>
<head>
<title>Continuous Deployment with AWS CodeDeploy &amp; Github</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS CodeDeploy和Github进行持续部署</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/continuous-deployment-with-aws-codedeploy-github-d1eb97550b82?source=collection_archive---------3-----------------------#2017-10-21">https://medium.com/hackernoon/continuous-deployment-with-aws-codedeploy-github-d1eb97550b82?source=collection_archive---------3-----------------------#2017-10-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/95f52c6a1485462269182149f509a29b.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/0*3JCMUy_03OMlg5r2."/></div></figure><p id="c3f6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这篇文章将带你了解如何使用<strong class="ja hv"> AWS CodeDeploy </strong>从<strong class="ja hv"> Github </strong>自动部署你的应用程序。</p><p id="ed2e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">让我们首先创建我们将在本教程中使用的2个<strong class="ja hv"> IAM角色</strong>:</p><ul class=""><li id="75dc" class="jw jx hu ja b jb jc jf jg jj jy jn jz jr ka jv kb kc kd ke dt translated">IAM角色用于<strong class="ja hv"> CodeDeploy </strong>与<strong class="ja hv"> EC2 </strong>实例对话。</li><li id="85e8" class="jw jx hu ja b jb kf jf kg jj kh jn ki jr kj jv kb kc kd ke dt translated">我是<strong class="ja hv"> EC2 </strong>访问<strong class="ja hv"> S3 </strong>的角色。</li></ul><p id="f9a9" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 1 —代码部署角色</strong></p><p id="3305" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">转到<a class="ae kk" href="https://console.aws.amazon.com/iam/home" rel="noopener ugc nofollow" target="_blank"> AWS IAM控制台</a>，然后导航到"<strong class="ja hv">角色</strong>，选择"<strong class="ja hv">创建新角色</strong>，选择"<strong class="ja hv">代码部署</strong>，并附加"<strong class="ja hv"> AWSCodeDeployRole </strong>"策略:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/7f7b30e6cebcac9259cfcef1d07936be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*x42w_F_DHdVDOu0p."/></div></figure><p id="e00e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 2 — EC2S3Role </strong></p><p id="1f85" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">创建另一个<strong class="ja hv"> IAM </strong>角色，但是这次选择<strong class="ja hv"> EC2 </strong>作为可信实体。然后，附加“<strong class="ja hv"> AmazonS3ReadOnlyAccess </strong>”策略:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/24cfa9ea73bde9ba40b9defd42e0323d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*305ZkJ-z_tfJou9A."/></div></figure><p id="f2de" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在我们已经创建了一个IAM角色，让我们启动一个EC2实例，CodeDeploy将使用它来部署我们的应用程序。</p><p id="e006" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 3 — EC2实例</strong></p><p id="63c3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">使用我们在上一节中创建的IAM角色启动一个新的<strong class="ja hv"> EC2 </strong>实例:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/4eeb01120e7e6850dd5396b03279b5fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*eA1OrS-8b0jaCnG-."/></div></figure><p id="d23e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在<strong class="ja hv">用户数据</strong>旁边键入以下脚本，以便在引导时安装<strong class="ja hv"> AWS CodeDeploy代理</strong>:</p><figure class="km kn ko kp fq iv"><div class="bz el l di"><div class="kq kr l"/></div></figure><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/32689465b719a5b9492502f19457d18a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*T72RioSZq7b_9Dw5."/></div></figure><p id="0b4c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:确保在安全组中允许<strong class="ja hv"> HTTP </strong>流量。</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/0b879b771132d9ef429db805d23b1193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*NWLLHGfkMb-C0hfp."/></div></figure><p id="71b3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">创建后，使用<strong class="ja hv">公共IP </strong>通过<strong class="ja hv"> SSH </strong>连接到实例，并验证<strong class="ja hv"> CodeDeploy </strong>代理是否正在运行:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff ks"><img src="../Images/87c767eeb038387619369fb93a40faf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*TX2ppY0ESB0463uN."/></div></div></figure><p id="4559" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 4 —应用</strong></p><p id="2e4a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">将<em class="kx"> appspec.yml </em>文件添加到应用程序中，以向AWS CodeDeploy描述如何管理应用程序的生命周期:</p><figure class="km kn ko kp fq iv"><div class="bz el l di"><div class="kq kr l"/></div></figure><p id="a815" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在安装之前的<strong class="ja hv">，将安装<strong class="ja hv"> apache </strong>服务器:</strong></p><figure class="km kn ko kp fq iv"><div class="bz el l di"><div class="kq kr l"/></div></figure><p id="9248" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">后安装</strong>将重启apache服务器</p><figure class="km kn ko kp fq iv"><div class="bz el l di"><div class="kq kr l"/></div></figure><p id="030f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 5 —设置代码部署</strong></p><p id="96cc" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">转到<a class="ae kk" href="https://console.aws.amazon.com/codedeploy" rel="noopener ugc nofollow" target="_blank"> AWS CodeDeploy </a>并创建一个新应用程序:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/efb4273206dcf13b579c6b34222f113f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*RN_LnSUGAnRLjxDJ."/></div></figure><p id="104c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">选择<strong class="ja hv">就地部署</strong>(带停机时间):</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/a37c8851d5953979531ea4c30bcb31a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*IMoHC99fwzsRyrTQ."/></div></figure><p id="94ea" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">点击“<strong class="ja hv">跳过</strong>”，因为我们已经设置了EC2实例:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/66ec5ed7a13076474670d0a69aa4de36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*NN0WElUr0jSZt9Oe."/></div></figure><p id="f815" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">以上将带您进入下一页，您需要在这里为您的应用程序命名:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/28d26899b2bcfa01405a9dfc1f01acdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*oiYO475nvGsdf5zH."/></div></figure><p id="8cc6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">选择EC2实例，并为部署组分配一个名称:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/b1b1624207bbb3fd2da858879ef7eccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*TcfRKRID3HNF2yPT."/></div></figure><p id="8757" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">选择我们在教程的第一部分中创建的<strong class="ja hv"> CodeDeployRole </strong>:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/20afcbacb4df9359a6e675cb28808f53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*BOWLtVW0jdECmXfh."/></div></figure><p id="5c52" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">然后点击<strong class="ja hv">部署</strong>:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff ky"><img src="../Images/f36af10e3448043ee2b38a44b7618781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/0*x0c6BCy-JMt644V5."/></div></figure><p id="6f7c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">创建一个部署，选择<strong class="ja hv"> Github </strong>作为数据源:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/7025e14b2bad6772977b73da8bd3a5ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*qaprzBoPb35PlQoH."/></div></figure><p id="effb" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">只需选择“<strong class="ja hv">连接GitHub </strong>”。这样做将弹出一个新的浏览器窗口，带你到Github登录，在那里你必须输入你的用户名和密码</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/49d02df2f80b134cc7b9a1fbc46745ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*xOkHIZJx5LWpyFKO."/></div></figure><p id="cb64" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">然后回到这个页面，你应该会看到类似下面的内容，只需输入剩下的细节，然后点击“<strong class="ja hv"> Deploy </strong>”</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/8de78daa374304afb55e25fe99d55696.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*WIlp9QfcjVa0etxv."/></div></figure><p id="b1b3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这将带您进入如下页面:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/c51c442e45a09984cb74caff9da061f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*a7rgYlGx9LOyjRLc."/></div></figure><p id="1656" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果您将浏览器指向<strong class="ja hv"> EC2公共IP </strong>，您应该会看到:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/8b6d7099d9f0b3c3902a0e8ec6f6079a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*VkR0NaL8H6jgwhvU."/></div></figure><p id="9050" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在，让我们使用<strong class="ja hv"> Github集成</strong>来自动化部署。</p><p id="bccf" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 6 —持续部署</strong></p><p id="d6b3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">转到<a class="ae kk" href="https://console.aws.amazon.com/iam" rel="noopener ugc nofollow" target="_blank"> IAM仪表板</a>，创建一个新策略，该策略允许从<strong class="ja hv"> Github </strong>注册和创建新部署。</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/623fd24506805cc06361bc5d4bf2576c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*4IG5FO9T82ZKqNK8."/></div></figure><p id="d191" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">接下来，创建一个新用户并附加我们之前创建的策略:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/0fe91025cee8e7b514b2150785c23616.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*cOIjY3R--8U_rSpx."/></div></figure><p id="dc3a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:将用户<strong class="ja hv"> AWS访问ID </strong> &amp; <strong class="ja hv"> AWS密钥</strong>复制到剪贴板。以后会派上用场的。</p><p id="5309" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 7 — Github集成</strong></p><p id="8752" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">生成一个<a class="ae kk" href="https://github.com/settings/tokens/new" rel="noopener ugc nofollow" target="_blank">新令牌</a>从<strong class="ja hv"> Github </strong>中调用<strong class="ja hv"> CodeDeploy </strong>:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/7c8fe5b0128fcef32cb1fbf8b3ab66fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*hDL_l_ZHiBmwAfTU."/></div></figure><p id="af5e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">生成令牌后，复制令牌并保存它。然后，添加<strong class="ja hv"> AWS CodeDeploy集成</strong>:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/1fdd5f679cb989db6893fe6986869e0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*x3QtKacfrbSW4bHm."/></div></figure><p id="dac1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">按如下方式填写字段:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kz"><img src="../Images/2e72a49221d04295a92d19e501daf8d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/0*NZIDql9_cWW8WJpX."/></div></figure><p id="f267" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">最后，添加<strong class="ja hv"> Github自动部署</strong></p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/1d30854ccc1b0736b4e775fc164168c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*B3woYhHgsZf3c7b_."/></div></figure><p id="afad" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">填写如下表格:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff la"><img src="../Images/7e3b79da3bde96e91856d60195ddb352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/0*fIkjK1oGLRKMauzP."/></div></figure><p id="5d4f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">为了测试它，让我们编辑一个文件或提交一个新文件。您应该会在<strong class="ja hv"> AWS CodeDeploy </strong>上看到新的部署:</p><figure class="km kn ko kp fq iv fe ff paragraph-image"><div class="fe ff kl"><img src="../Images/e103c685df9c665a0862ef1d00ce4452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*qNzAnyXo5difzqfq."/></div></figure></div></div>    
</body>
</html>