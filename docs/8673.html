<html>
<head>
<title>Deploying Kubernetes On-Premise with RKE and deploying OpenFaaS on it — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用RKE在本地部署Kubernetes并在其上部署OpenFaaS第2部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/deploying-kubernetes-on-premise-with-rke-and-deploying-openfaas-on-it-part-2-cc14004e7007?source=collection_archive---------11-----------------------#2017-12-10">https://medium.com/hackernoon/deploying-kubernetes-on-premise-with-rke-and-deploying-openfaas-on-it-part-2-cc14004e7007?source=collection_archive---------11-----------------------#2017-12-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="dbb8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在第1部分<a class="ae jp" rel="noopener" href="/@kenfdev/deploying-kubernetes-with-rke-and-deploying-openfaas-on-it-part-1-69a35ddfa507">中，我们使用RKE (Rancher Kubernetes引擎)部署了一个Kubernetes集群。现在我们有了一个工作的Kubernetes集群，让我们在其上部署</a><a class="ae jp" href="https://www.openfaas.com/" rel="noopener ugc nofollow" target="_blank"> OpenFaaS </a>(一个开源的无服务器平台)！</p><p id="4e51" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这篇文章不会详细介绍OpenFaaS。关于Kubernetes上OpenFaaS的相关介绍，你应该去看看<a class="ae jp" rel="noopener" href="/devopslinks/getting-started-with-openfaas-on-minikube-634502c7acdf">Alex Ellis</a>(OpenFaaS的创建者)写的《minikube上open FAAS入门》。</p><h1 id="3d28" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">先决条件</h1><p id="e809" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">我假设:</p><ul class=""><li id="9b9f" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated">您已经阅读了第1部分，并且拥有一个正在运行的Kubernetes集群</li><li id="e554" class="kt ku hu it b iu lc iy ld jc le jg lf jk lg jo ky kz la lb dt translated">您的<code class="eh lh li lj lk b">kubectl</code>被设置为针对您在<a class="ae jp" rel="noopener" href="/@kenfdev/deploying-kubernetes-with-rke-and-deploying-openfaas-on-it-part-1-69a35ddfa507">第1部分</a>上构建的Kubernetes集群</li><li id="1720" class="kt ku hu it b iu lc iy ld jc le jg lf jk lg jo ky kz la lb dt translated">您的客户机上安装了Helm</li></ul><h1 id="5882" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">通过Helm部署OpenFaaS</h1><p id="cf60" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">首先，让我们设置Helm，首先为tiller创建一个服务帐户:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="220f" class="lt jr hu lk b fv lu lv l lw lx">kubectl -n kube-system create sa tiller \<br/> &amp;&amp; kubectl create clusterrolebinding tiller \<br/> --clusterrole cluster-admin \<br/> --serviceaccount=kube-system:tiller</span><span id="7029" class="lt jr hu lk b fv ly lv l lw lx"># serviceaccount “tiller” created<br/># clusterrolebinding “tiller” created</span></pre><p id="bd9a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，安装舵杆:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="c07f" class="lt jr hu lk b fv lu lv l lw lx">helm init —-skip-refresh --upgrade --service-account tiller</span><span id="9249" class="lt jr hu lk b fv ly lv l lw lx"># $HELM_HOME has been configured at /Users/fukuyamaken/.helm.</span><span id="d336" class="lt jr hu lk b fv ly lv l lw lx"># Tiller (the Helm server-side component) has been installed into your Kubernetes Cluster.<br/># Happy Helming!</span></pre><p id="3668" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">之后，让我们将名为<code class="eh lh li lj lk b">faas-netes</code>和<code class="eh lh li lj lk b">cd</code>的用于OpenFaaS的kubernetes扩展库克隆到那个目录中。Helm所需的资源包含在该存储库中。</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="fe8e" class="lt jr hu lk b fv lu lv l lw lx">git clone https://github.com/openfaas/faas-netes &amp;&amp; \<br/>cd faas-netes</span></pre><p id="4245" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，将OpenFaaS部署到集群中。请注意，我们正在禁用rbac，因为该群集的rbac配置不正确。</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="3c45" class="lt jr hu lk b fv lu lv l lw lx">helm upgrade --install --debug --reset-values --set rbac=false --set async=false openfaas openfaas/</span></pre><p id="3bcd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">确认Kubernetes服务和部署正在使用<code class="eh lh li lj lk b">kubectl get svc,deployments</code>运行:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="a024" class="lt jr hu lk b fv lu lv l lw lx">NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE<br/>svc/alertmanager            ClusterIP   10.233.18.46    &lt;none&gt;        9093/TCP         4m<br/>svc/alertmanager-external   NodePort    10.233.1.242    &lt;none&gt;        9093:31113/TCP   4m<br/>svc/faas-netesd             ClusterIP   10.233.37.207   &lt;none&gt;        8080/TCP         4m<br/>svc/faas-netesd-external    NodePort    10.233.26.167   &lt;none&gt;        8080:31111/TCP   4m<br/>svc/gateway                 ClusterIP   10.233.55.73    &lt;none&gt;        8080/TCP         4m<br/>svc/gateway-external        NodePort    10.233.57.162   &lt;none&gt;        8080:31112/TCP   4m<br/>svc/kubernetes              ClusterIP   10.233.0.1      &lt;none&gt;        443/TCP          2h<br/>svc/prometheus              ClusterIP   10.233.46.236   &lt;none&gt;        9090/TCP         4m<br/>svc/prometheus-external     NodePort    10.233.15.159   &lt;none&gt;        9090:31119/TCP   4m</span><span id="02f0" class="lt jr hu lk b fv ly lv l lw lx">NAME                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE<br/>deploy/alertmanager   1         1         1            1           4m<br/>deploy/faas-netesd    1         1         1            1           4m<br/>deploy/gateway        1         1         1            1           4m<br/>deploy/prometheus     1         1         1            1           4m</span></pre><h1 id="221a" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">测试一下！</h1><p id="0dda" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">现在OpenFaaS已经在Kubernetes上运行了，让我们来测试一下吧！转到您的worker节点的端口<code class="eh lh li lj lk b">31112</code>(在我的例子中是<code class="eh lh li lj lk b">203.104.227.60:31112</code>)。您应该会看到类似以下截图的网关UI:</p><figure class="ll lm ln lo fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="fe ff lz"><img src="../Images/814333e8c672dce4c038fb4132bf0614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXiddLMFmoL3z_7JoOiKBA.png"/></div></div><figcaption class="mh mi fg fe ff mj mk bd b be z ek">OpenFaaS Gateway UI</figcaption></figure><p id="ae09" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们通过函数商店部署一个新函数。我喜欢约翰尼·姆哈尔制作的<code class="eh lh li lj lk b">Figlet</code>功能。让我们选择它并点击<code class="eh lh li lj lk b">Deploy</code>。</p><figure class="ll lm ln lo fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="fe ff ml"><img src="../Images/c884eb2568a4f17fd2d68064f7fe9627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6zHFYzaLsOT5rvCKYUI3Mw.png"/></div></div><figcaption class="mh mi fg fe ff mj mk bd b be z ek">OpenFaaS Function Store</figcaption></figure><p id="ec71" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">部署并刷新UI后，您应该会在函数列表中看到<code class="eh lh li lj lk b">figlet</code>。我们来输入一些很酷的单词和<code class="eh lh li lj lk b">INVOKE</code>功能。</p><figure class="ll lm ln lo fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="fe ff mm"><img src="../Images/7672d5ccad417979deaec9ade307ef29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aeTOho22nStqm2oXKLVfhw.png"/></div></div><figcaption class="mh mi fg fe ff mj mk bd b be z ek">Invoking the Figlet Function</figcaption></figure><p id="6e43" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">厉害！OpenFaaS运行在RKE部署的Kubernetes上(牧场主Kubernetes引擎)。2个节点只有1个内核和1GB RAM！请注意，由于缺乏资源，内存密集型和cpu密集型功能可能无法工作。在这种情况下，您应该添加更多具有资源的主机。</p><h1 id="43ef" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">包裹</h1><p id="b5ca" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">这篇由两部分组成的博客文章展示了通过RKE创建Kubernetes集群有多容易，以及在其上部署OpenFaaS有多容易。从这里开始，您也可以用OpenFaaS集成其他组件，这应该是一个很好的起点！</p></div></div>    
</body>
</html>