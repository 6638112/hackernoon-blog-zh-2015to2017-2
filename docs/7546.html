<html>
<head>
<title>The Services Stack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">服务堆栈</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-services-stack-235cca4a15f7?source=collection_archive---------23-----------------------#2017-10-31">https://medium.com/hackernoon/the-services-stack-235cca4a15f7?source=collection_archive---------23-----------------------#2017-10-31</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="7823" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">在AWS上快速部署微服务堆栈</h2></div><h2 id="b897" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">什么是微服务？</h2><blockquote class="kh ki kj"><p id="37bc" class="kk kl km kn b ko kp iv kq kr ks iy kt ku kv kw kx ky kz la lb lc ld le lf lg hn dt translated"><strong class="kn hv">微服务</strong>架构风格<a class="ae lh" href="https://martinfowler.com/articles/microservices.html#footnote-etymology" rel="noopener ugc nofollow" target="_blank">【1】</a>是一种将单个应用程序开发为一套小型服务的方法，每个服务运行在自己的进程中，并与轻量级机制(通常是HTTP资源API)进行通信。这些服务是围绕业务功能构建的，可由全自动部署机器独立部署。这些服务可以用不同的编程语言编写，并使用不同的数据存储技术，只有最低限度的集中管理。信用<a class="ae lh" href="https://martinfowler.com/articles/microservices.html" rel="noopener ugc nofollow" target="_blank">马丁·福勒</a></p></blockquote><p id="793f" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">如果你是微服务的新手，请完整阅读Martin Fowler的<a class="ae lh" href="https://martinfowler.com/articles/microservices.html" rel="noopener ugc nofollow" target="_blank">文章</a>。</p><h2 id="a4bc" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">什么是堆栈？</h2><p id="5419" class="pw-post-body-paragraph kk kl hu kn b ko li iv kq kr lj iy kt ju lk kw kx jy ll la lb kc lm le lf lg hn dt translated">一个<strong class="kn hv">栈</strong>是AWS资源的集合，您可以将它作为一个单元来管理。换句话说，您可以通过创建、更新或删除<strong class="kn hv">堆栈</strong>来创建、更新或删除资源集合。一个<strong class="kn hv">栈</strong>中的所有资源都由<strong class="kn hv">栈的</strong> AWS <a class="ae lh" href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacks.html" rel="noopener ugc nofollow" target="_blank"> CloudFormation </a>模板定义。</p><h2 id="9ed4" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">什么是<a class="ae lh" href="https://github.com/thestackshack/services-stack" rel="noopener ugc nofollow" target="_blank">服务栈</a></h2><p id="ee60" class="pw-post-body-paragraph kk kl hu kn b ko li iv kq kr lj iy kt ju lk kw kx jy ll la lb kc lm le lf lg hn dt translated"><a class="ae lh" href="https://github.com/thestackshack/services-stack" rel="noopener ugc nofollow" target="_blank"> <strong class="kn hv">服务栈</strong> </a>是如何在AWS上架构、开发和部署微服务的一个例子。具体使用AWS <a class="ae lh" href="https://aws.amazon.com/vpc/" rel="noopener ugc nofollow" target="_blank">虚拟私有云(VPC) </a>、<a class="ae lh" href="https://aws.amazon.com/ecr/" rel="noopener ugc nofollow" target="_blank"> EC2容器注册中心(ECR) </a>、<a class="ae lh" href="https://aws.amazon.com/ecs/" rel="noopener ugc nofollow" target="_blank"> EC2容器服务(ECS) </a>。</p><p id="fe80" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">这里是<a class="ae lh" href="https://github.com/thestackshack/services-stack" rel="noopener ugc nofollow" target="_blank">服务栈</a>架构的样子。</p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff ln"><img src="../Images/5f9fcbbc1a93a11aa5a907e03143a213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zaqbwkrkr5I412zCZ2IPvA.png"/></div></div></figure><p id="24a2" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">如果您准备好部署该堆栈并开始构建微服务，请单击此处的<a class="ae lh" href="https://github.com/thestackshack/services-stack" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl lz ma hc mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hn ho hp hq hr"><h1 id="17be" class="mg jk hu bd jl mh mi mj jp mk ml mm jt ja mn jb jx jd mo je kb jg mp jh kf mq dt translated">服务堆栈</h1><p id="038b" class="pw-post-body-paragraph kk kl hu kn b ko li iv kq kr lj iy kt ju lk kw kx jy ll la lb kc lm le lf lg hn dt translated">让我们了解一下组成这个堆栈的组件的更多信息。</p><h2 id="43a7" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">虚拟专用云(VPC)</h2><p id="4879" class="pw-post-body-paragraph kk kl hu kn b ko li iv kq kr lj iy kt ju lk kw kx jy ll la lb kc lm le lf lg hn dt translated">第一个构建模块是AWS VPC。把VPC想象成一个安全和隔离层，我们部署的所有其他东西都生活在里面。在VPC中，我们有公共子网和私有子网。</p><p id="92df" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">在大多数情况下，我们将所有重要的东西(应用程序、数据库等)放在私有子网中。然后，我们将所有通信资源(ALB、网关)放在公共子网中。通信资源是我们隐藏的服务和互联网之间的桥梁。</p><p id="e3bb" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">例如，我们的<strong class="kn hv">服务</strong>位于私有子网，而我们的<strong class="kn hv">应用负载均衡器(ALB) </strong>位于公共子网。当向我们的服务发出入站请求时，它们会通过ALB。互联网可以与我们的ALB对话，但不能直接与我们的服务对话。只有ALB能和我们的服务对话。</p><p id="9558" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">来自或<strong class="kn hv">服务</strong>到互联网的出站请求通过<strong class="kn hv"> NAT网关</strong>，它们也在公共子网中。</p><h2 id="c629" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">EC2集装箱注册中心(ECR)</h2><p id="fd93" class="pw-post-body-paragraph kk kl hu kn b ko li iv kq kr lj iy kt ju lk kw kx jy ll la lb kc lm le lf lg hn dt translated"><a class="ae lh" href="https://aws.amazon.com/ecr/" rel="noopener ugc nofollow" target="_blank"> AWS ECR </a>是一个完全托管的<a class="ae lh" href="https://aws.amazon.com/docker/" rel="noopener ugc nofollow" target="_blank"> Docker </a>容器注册中心，它使开发人员可以轻松地存储、管理和部署Docker容器映像。</p><p id="281d" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">可以将容器注册中心看作是您的构建工件的存储库，带有版本控制，随时可以运行。您只需告诉ECS部署这个版本的工件。我们的每项服务都需要ECR repo。</p><h2 id="1f99" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">什么是容器？</h2><p id="a6a7" class="pw-post-body-paragraph kk kl hu kn b ko li iv kq kr lj iy kt ju lk kw kx jy ll la lb kc lm le lf lg hn dt translated"><strong class="kn hv">容器</strong>是一种操作系统虚拟化的方法，允许您在资源隔离的进程中运行应用程序及其依赖项。<strong class="kn hv">容器</strong>允许您轻松地将应用程序的代码、配置和依赖项打包成易于使用的构建块，从而提供环境一致性、运营效率、开发人员生产力和版本控制。点击阅读更多关于<strong class="kn hv">集装箱</strong> <a class="ae lh" href="https://aws.amazon.com/containers/" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><h2 id="a467" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">Docker是什么？</h2><p id="44c1" class="pw-post-body-paragraph kk kl hu kn b ko li iv kq kr lj iy kt ju lk kw kx jy ll la lb kc lm le lf lg hn dt translated">Docker是帮助你开发、打包和部署容器的软件。点击阅读更多关于<strong class="kn hv">码头</strong>集装箱<a class="ae lh" href="https://aws.amazon.com/docker/" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><h2 id="6009" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">EC2集装箱服务</h2><p id="d423" class="pw-post-body-paragraph kk kl hu kn b ko li iv kq kr lj iy kt ju lk kw kx jy ll la lb kc lm le lf lg hn dt translated"><a class="ae lh" href="https://aws.amazon.com/ecs/" rel="noopener ugc nofollow" target="_blank"> AWS ECS </a>是一个高度可扩展、高性能的<a class="ae lh" href="https://aws.amazon.com/containers/" rel="noopener ugc nofollow" target="_blank">容器</a>管理服务，它支持<a class="ae lh" href="https://aws.amazon.com/docker/" rel="noopener ugc nofollow" target="_blank"> Docker </a>容器，并允许您在Amazon EC2实例的托管集群上轻松运行应用程序。</p><p id="d0cf" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">一个或多个EC2实例可以运行许多Docker容器服务。因此，您可以让一个EC2实例运行许多服务。</p><p id="1426" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">容器服务使您更容易在一组EC2实例中开发、部署和扩展Docker容器。</p><h2 id="cf32" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">应用程序负载平衡器(ALB)</h2><p id="61bb" class="pw-post-body-paragraph kk kl hu kn b ko li iv kq kr lj iy kt ju lk kw kx jy ll la lb kc lm le lf lg hn dt translated"><a class="ae lh" href="https://aws.amazon.com/elasticloadbalancing/details/#details" rel="noopener ugc nofollow" target="_blank"> AWS ALB </a>在请求层(第7层)运行，根据请求的内容将流量路由到目标(容器)。</p><p id="1801" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">在我们的例子中，ALB位于公共子网内，并基于URI将HTTP流量路由到我们的服务。ALB也足够聪明，知道我们的服务运行在每个EC2实例的哪个端口上，因此它可以相应地路由流量。</p><p id="2dc6" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">常见的设置是具有以下路由规则的ALB:</p><ul class=""><li id="969d" class="mr ms hu kn b ko kp kr ks ju mt jy mu kc mv lg mw mx my mz dt translated">https://yourdomain.com/service1-&gt;服务1</li><li id="1d91" class="mr ms hu kn b ko na kr nb ju nc jy nd kc ne lg mw mx my mz dt translated">https://yourdomain.com/service2-&gt;服务2</li></ul><h2 id="0212" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">微服务—服务1</h2><p id="c249" class="pw-post-body-paragraph kk kl hu kn b ko li iv kq kr lj iy kt ju lk kw kx jy ll la lb kc lm le lf lg hn dt translated">最后是代码。我们的服务是一个响应HTTP请求的简单web应用程序。它可以是任何语言或框架。这种架构的美妙之处在于，计算层不需要实施细节。它们封装在容器定义Dockerfile中。</p></div><div class="ab cl lz ma hc mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hn ho hp hq hr"><p id="484b" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">为了部署这个堆栈，我们使用CIM。</p><h2 id="349e" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated">什么是CIM？</h2><p id="93a1" class="pw-post-body-paragraph kk kl hu kn b ko li iv kq kr lj iy kt ju lk kw kx jy ll la lb kc lm le lf lg hn dt translated">在AWS上构建任何东西之前，我总是从云的形成开始。IaC是所有基于AWS构建的项目的必备组件。另外，它真的很有趣，让你感觉像一个真正的建筑。云的形成有一些棘手的问题。这也是为什么我建了<a class="ae lh" href="https://cim.sh" rel="noopener ugc nofollow" target="_blank"> <strong class="kn hv"> CIM </strong> </a>。</p><p id="8d0c" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated"><a class="ae lh" href="https://cim.sh/" rel="noopener ugc nofollow" target="_blank"> <strong class="kn hv"> CIM </strong> </a>是一个简单的命令行实用程序，它引导您的<a class="ae lh" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"> CloudFormation </a> CRUD操作，使它们更容易执行，可重复，并且更不容易出错。</p><p id="47f2" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">如果你想了解更多关于<strong class="kn hv"> CIM </strong>，以及我为什么要建立它，你可以阅读我的文章，<a class="ae lh" rel="noopener" href="/@rgfindley/meet-cim-cloud-infrastructure-manager-bc8bcfe0593c">认识CIM——云基础设施经理</a>。</p></div><div class="ab cl lz ma hc mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hn ho hp hq hr"><p id="94d7" class="pw-post-body-paragraph kk kl hu kn b ko kp iv kq kr ks iy kt ju kv kw kx jy kz la lb kc ld le lf lg hn dt translated">感谢您阅读关于服务堆栈的内容。我希望你喜欢它。</p></div></div>    
</body>
</html>