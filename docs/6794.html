<html>
<head>
<title>Chaos Testing for Docker Containers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">码头集装箱的混沌测试</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/chaos-testing-for-docker-containers-bc6e9d66645?source=collection_archive---------24-----------------------#2017-10-04">https://medium.com/hackernoon/chaos-testing-for-docker-containers-bc6e9d66645?source=collection_archive---------24-----------------------#2017-10-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><blockquote class="ir is it"><p id="8527" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">几周前，我在伦敦的<a class="ae jt" href="https://2017.container.camp/uk" rel="noopener ugc nofollow" target="_blank">集装箱仓库</a>展示了 <a class="ae jt" href="https://hackernoon.com/tagged/docker" rel="noopener ugc nofollow" target="_blank"> <em class="hu">码头工人</em> </a> <em class="hu">集装箱</em>的<em class="hu">混沌测试。你可以在这篇文章的结尾找到原始的录音和幻灯片，为了可读性，我对文本做了一些小的编辑，并添加了一些链接以获得更多的上下文。</em></p></blockquote><h1 id="2ee0" class="ju jv hu bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">介绍</h1><p id="beee" class="pw-post-body-paragraph iu iv hu ix b iy ks ja jb jc kt je jf ku kv ji jj kw kx jm jn ky kz jq jr js hn dt translated">软件开发是关于构建支持业务需求的软件服务。我们想要自动化和集成的业务流程越复杂，我们构建的软件系统就越复杂。解决方案的复杂性往往会随着时间和范围的增长而增长。</p><p id="4fda" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">越来越复杂的原因可能各不相同。一些系统处理太多的问题，或者需要与外部服务和内部遗留系统进行大量集成。这些系统由具有不同技能的不同人员在几年内多次编写和重写，试图满足不断变化的业务需求，使用不同的技术，遵循不同的技术和架构趋势。</p><p id="5801" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">所以，我的观点是，构建软件，随着时间的推移，无意中变得越来越复杂，是很容易的。我们以前都做过，现在可能也在做。为复杂系统构建一个“好的”软件架构，并在一段时间内保持它的“好”能力，真的很难。</p><p id="dd9e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">当您有太多的“移动”部分、集成和不断变化的需求时，在处理代码变更、安全升级、硬件现代化、多网络通信渠道等时，避免意外故障可能会成为一项“不可能完成的任务”。</p><h1 id="8149" class="ju jv hu bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">事情发生了！</h1><p id="4efd" class="pw-post-body-paragraph iu iv hu ix b iy ks ja jb jc kt je jf ku kv ji jj kw kx jm jn ky kz jq jr js hn dt translated">所有系统都会不时出现故障。你的软件系统也会失败。把这当成生活的现实。总会有一些事情会出错。无论我们如何努力，都无法构建完美的软件，我们所依赖的公司也是如此。即使是来自公司的最稳定和受尊敬的服务，实践CI/CD，测试驱动开发(TDD/BDD)，有巨大的QA部门和定义良好的发布过程，也会失败。</p><p id="552e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">仅举几个去年停机的例子:</p><ol class=""><li id="a27d" class="la lb hu ix b iy iz jc jd ku lc kw ld ky le js lf lg lh li dt translated"><strong class="ix hv"> IBM，1月26日</strong></li></ol><ul class=""><li id="1721" class="la lb hu ix b iy iz jc jd ku lc kw ld ky le js lj lg lh li dt translated">今年年初，当客户用来访问其Bluemix云基础设施的管理门户关闭几个小时时，IBM的云信誉受到了打击。虽然底层基础架构实际上没有出现故障，但用户却沮丧地发现他们无法管理自己的应用程序、添加或删除支持工作负载的云资源。</li><li id="931a" class="la lb hu ix b iy lk jc ll ku lm kw ln ky lo js lj lg lh li dt translated">IBM表示，这个问题是间歇性的，源于对界面的拙劣更新。</li></ul><p id="c475" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">2.<strong class="ix hv"> GitLab，1月31日</strong></p><ul class=""><li id="97c1" class="la lb hu ix b iy iz jc jd ku lc kw ld ky le js lj lg lh li dt translated">GitLab广受欢迎的在线代码库GibLab.com遭遇了18小时的服务中断，最终无法完全修复。</li><li id="d9f6" class="la lb hu ix b iy lk jc ll ku lm kw ln ky lo js lj lg lh li dt translated">当一名员工在维护过程中从错误的数据库服务器上删除了一个数据库目录时，问题就出现了。</li></ul><p id="86c9" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">3.<strong class="ix hv"> AWS，2月28日</strong></p><ul class=""><li id="4e4d" class="la lb hu ix b iy iz jc jd ku lc kw ld ky le js lj lg lh li dt translated"><a class="ae jt" href="http://www.crn.com/news/cloud/300083958/aws-storage-outage-wreaking-havoc-on-web-services-providers.htm" rel="noopener ugc nofollow" target="_blank">这就是震惊整个行业的停电事件</a>。</li><li id="a7d6" class="la lb hu ix b iy lk jc ll ku lm kw ln ky lo js lj lg lh li dt translated">一名亚马逊网络服务工程师试图在供应商的弗吉尼亚州数据中心调试S3存储系统时，意外地输入了错误的命令，导致互联网的大部分内容(包括Slack、Quora和Trello等许多企业平台)中断了四个小时。</li></ul><p id="7900" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">4.<strong class="ix hv">微软Azure，3月16日</strong></p><ul class=""><li id="7466" class="la lb hu ix b iy iz jc jd ku lc kw ld ky le js lj lg lh li dt translated">存储可用性问题困扰了微软的Azure公共云八个多小时，主要影响美国东部的客户。</li><li id="9d2c" class="la lb hu ix b iy lk jc ll ku lm kw ln ky lo js lj lg lh li dt translated">一些用户在调配新存储或访问该地区的现有资源时遇到了困难。微软的一个工程团队后来发现，罪魁祸首是一个存储集群断电，变得不可用。</li></ul><p id="d8b9" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">访问<a class="ae jt" href="http://outage.report/" rel="noopener ugc nofollow" target="_blank">停机。报告</a>或<a class="ae jt" href="http://downdetector.com/" rel="noopener ugc nofollow" target="_blank"> Downdetector </a>以查看由最终用户报告的持续更新的长列表。</p><h1 id="0ebc" class="ju jv hu bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">追逐软件质量</h1><p id="4c1b" class="pw-post-body-paragraph iu iv hu ix b iy ks ja jb jc kt je jf ku kv ji jj kw kx jm jn ky kz jq jr js hn dt translated">作为软件工程师，我们希望为我们正在构建的软件系统感到自豪。我们希望这些系统是高质量的，没有功能缺陷，安全漏洞，提供卓越的性能，对意外故障有弹性，自我修复，始终可用，易于维护和现代化。</p><p id="b60f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">每个新项目都是从“高质量”的图片开始的，没有人想创建蹩脚的软件，但是我们中很少有人(或者没有人)能够实现并保持所有良好的“能力”。那么，我们能做些什么来提高整体系统质量呢？我们应该做更多的测试吗？</p><p id="8c84" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">我倾向于说“是”——软件测试至关重要。但是仅仅运行单元、功能和性能测试是不够的。</p><p id="5e6e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">今天，利用我们拥有的所有令人惊奇的新技术，构建复杂的分布式系统变得更加容易。微服务架构是当今真正的趋势，各种容器技术支持这种架构。与过去相比，部署、扩展、链接、监控、更新和管理由多个“微服务”组成的分布式系统要容易得多。</p><p id="522c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">当我们构建分布式系统时，我们从<a class="ae jt" href="https://en.wikipedia.org/wiki/CAP_theorem" rel="noopener ugc nofollow" target="_blank"> CAP定理</a>中选择<strong class="ix hv"> P </strong> ( <em class="iw">分区容差</em>)，其次是<strong class="ix hv"> A </strong> ( <em class="iw">可用性</em> —最流行的选择)或<strong class="ix hv"> C </strong> ( <em class="iw">一致性</em>)。因此，我们需要找到一种测试<strong class="ix hv"> AP </strong>或<strong class="ix hv"> CP </strong>系统的好方法。</p><p id="47b1" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">传统的测试规程和工具不能很好地回答<em class="iw">当生产中出现意外情况时，您的分布式系统会如何表现？</em>。当然，事实上，你可以从以前的失败中吸取教训，而且你绝对应该这么做。但是，从过去的经验中学习不应该是为未来的失败做准备的唯一方法。</p><p id="630e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">等待生产中出现问题不是一个选项。<em class="iw">但是有什么选择呢？</em></p><h1 id="ba5d" class="ju jv hu bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">混沌工程</h1><p id="1ad5" class="pw-post-body-paragraph iu iv hu ix b iy ks ja jb jc kt je jf ku kv ji jj kw kx jm jn ky kz jq jr js hn dt translated">另一种选择是故意打碎东西。而<a class="ae jt" href="https://hackernoon.com/tagged/chaos-engineering" rel="noopener ugc nofollow" target="_blank">混沌工程</a>就是这样做的一种方法。混沌工程的理念就是<em class="iw">拥抱失败！</em></p><p id="829e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">分布式软件系统的混沌工程最初是由网飞推广的。</p><p id="f1da" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">混沌工程定义了分布式软件系统弹性测试的经验方法。你正在通过进行<em class="iw">混沌实验</em>来测试一个系统。</p><p id="12c3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">典型的<em class="iw">混沌实验</em>:</p><ul class=""><li id="b18f" class="la lb hu ix b iy iz jc jd ku lc kw ld ky le js lj lg lh li dt translated">定义系统的<em class="iw">正常/稳定</em>状态(例如，通过监控一组系统和业务指标)</li><li id="b563" class="la lb hu ix b iy lk jc ll ku lm kw ln ky lo js lj lg lh li dt translated">伪随机注入故障(例如，通过终止虚拟机、终止容器或改变网络行为)</li><li id="84c9" class="la lb hu ix b iy lk jc ll ku lm kw ln ky lo js lj lg lh li dt translated">尝试通过偏离预期或稳态行为来发现系统弱点</li></ul><p id="284d" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">破坏稳定状态越难，我们对系统的行为就越有信心。</p><h1 id="4de1" class="ju jv hu bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">混沌工程工具</h1><p id="8b45" class="pw-post-body-paragraph iu iv hu ix b iy ks ja jb jc kt je jf ku kv ji jj kw kx jm jn ky kz jq jr js hn dt translated">当然，手动练习混沌工程也是可以的。但是有一些很好的工具可以使用。</p><p id="b583" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">网飞为在公共云(AWS)中实践混沌工程构建了许多有用的工具:</p><ul class=""><li id="0491" class="la lb hu ix b iy iz jc jd ku lc kw ld ky le js lj lg lh li dt translated">混乱猴子——杀死EC2、杀死进程、烧毁CPU、填满磁盘、分离卷、增加网络延迟等</li><li id="dd7f" class="la lb hu ix b iy lk jc ll ku lm kw ln ky lo js lj lg lh li dt translated">混沌孔-移除整个AWS区域</li></ul><p id="67b5" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">这些都是非常好的工具，我鼓励你使用它们。但是当我开始我的新的基于容器的项目时(2年前)，感觉这些工具为我想要创建的<em class="iw">混乱</em>提供了<em class="iw">错误的</em>粒度。我不仅想在真正的集群中创建<em class="iw">混沌</em>，还想在单个开发人员的机器上创建混沌，以便能够调试和调优我的应用程序。我在Google上搜索了Docker 的<em class="iw"> Chaos Monkey，但是除了一些基本的Bash脚本之外什么也没找到。</em></p><p id="499b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">所以，我决定创造自己的工具。从第一天起，我就把它作为开源项目与社区分享。是混沌~~猴子~ ~疣猪对Docker — <a class="ae jt" href="https://github.com/gaia-adm/pumba" rel="noopener ugc nofollow" target="_blank"> Pumba </a></p><h1 id="c96a" class="ju jv hu bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">pumba——Docker的混沌测试</h1><p id="2b5b" class="pw-post-body-paragraph iu iv hu ix b iy ks ja jb jc kt je jf ku kv ji jj kw kx jm jn ky kz jq jr js hn dt translated"><em class="iw">什么是Pumba(a)？</em></p><p id="9940" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">我们这些有孩子或曾经是90年代孩子的人应该记得迪士尼动画电影《狮子王<strong class="ix hv">中的这个角色。在斯瓦希里语中，<strong class="ix hv">彭彭</strong>的意思是“<em class="iw">愚蠢、愚蠢、弱智、粗心、疏忽</em>”。我喜欢斯瓦希里语的意思。它和我想要创造的工具非常匹配。</strong></p><figure class="lp lq lr ls fq lt"><div class="bz el l di"><div class="lu lv l"/></div></figure><h1 id="1ff8" class="ju jv hu bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">Pumba能做什么？</h1><p id="4cc4" class="pw-post-body-paragraph iu iv hu ix b iy ks ja jb jc kt je jf ku kv ji jj kw kx jm jn ky kz jq jr js hn dt translated">Pumba通过注入不同的故障来扰乱正在运行的Docker运行时环境。Pumba可以<code class="eh lw lx ly lz b">kill</code>、<code class="eh lw lx ly lz b">stop</code>、<code class="eh lw lx ly lz b">remove</code>或<code class="eh lw lx ly lz b">pause</code>码头集装箱。</p><p id="54ae" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">Pumba还可以进行网络仿真，模拟不同的网络故障，如:延迟、数据包丢失(使用不同的概率丢失模型)、带宽速率限制等等。对于网络仿真，Pumba使用Linux内核流量控制<code class="eh lw lx ly lz b">tc</code>和<code class="eh lw lx ly lz b">netem</code>排队规则，在这里阅读更多<a class="ae jt" href="http://man7.org/linux/man-pages/man8/tc-netem.8.html" rel="noopener ugc nofollow" target="_blank"/>。如果<code class="eh lw lx ly lz b">tc</code>在目标容器中不可用，Pumba使用一个带有<code class="eh lw lx ly lz b">tc</code>的<em class="iw"> sidekick </em>容器，将其连接到目标容器网络。</p><p id="4e3c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">您可以将容器列表传递给Pumba，或者只编写一个正则表达式来选择匹配的容器。如果不指定容器，Pumba会试图扰乱所有正在运行的容器。使用<code class="eh lw lx ly lz b">--random</code>选项，从提供的列表中随机选择一个目标容器。也可以定义一个可重复的时间间隔和持续时间参数，以更好地控制你想要创造的混乱<em class="iw">的数量。</em></p><p id="a08b" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">Pumba可以作为Linux、MacOS和Windows的单一二进制文件，或者作为Docker容器。</p><pre class="lp lq lr ls fq ma lz mb mc aw md dt"><span id="cfc3" class="me jv hu lz b fv mf mg l mh mi"># Download binary from https://github.com/gaia-adm/pumba/releases<br/>curl https://github.com/gaia-adm/pumba/releases/download/0.4.6/pumba_linux_amd64 --output /usr/local/bin/pumba<br/>chmod <strong class="lz hv">+</strong>x /usr/local/bin/pumba <strong class="lz hv">&amp;&amp;</strong> pumba <strong class="lz hv">--</strong>help<br/><br/># Install with Homebrew (MacOS only)<br/>brew install pumba <strong class="lz hv">&amp;&amp;</strong> pumba <strong class="lz hv">--</strong>help<br/><br/># Use Docker image<br/>docker run gaiaadm/pumba pumba <strong class="lz hv">--</strong>help</span></pre><h1 id="a871" class="ju jv hu bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">Pumba命令示例</h1><p id="782b" class="pw-post-body-paragraph iu iv hu ix b iy ks ja jb jc kt je jf ku kv ji jj kw kx jm jn ky kz jq jr js hn dt translated">首先，运行<code class="eh lw lx ly lz b">pumba --help</code>获得可用命令和选项的帮助，运行<code class="eh lw lx ly lz b">pumba &lt;command&gt; --help</code>获得特定命令和子命令的帮助。</p><pre class="lp lq lr ls fq ma lz mb mc aw md dt"><span id="8596" class="me jv hu lz b fv mf mg l mh mi"># pumba help<br/>pumba <strong class="lz hv">--</strong>help<br/><br/># pumba kill help<br/>pumba kill <strong class="lz hv">--</strong>help<br/><br/># pumba netem delay help<br/>pumba netem delay <strong class="lz hv">--</strong>help</span></pre><p id="720d" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">杀死从<code class="eh lw lx ly lz b">^test</code> regex列表中随机选择的Docker容器。</p><pre class="lp lq lr ls fq ma lz mb mc aw md dt"><span id="ac3f" class="me jv hu lz b fv mf mg l mh mi"># on main pane/screen, run 7 test containers that do nothing<br/><strong class="lz hv">for</strong> i in {0..7}; <strong class="lz hv">do</strong> docker run <strong class="lz hv">-</strong>d <strong class="lz hv">--</strong>rm <strong class="lz hv">--</strong>name test$i alpine tail <strong class="lz hv">-</strong>f /dev/null; done<br/># run an additional container with 'skipme' name<br/>docker run <strong class="lz hv">-</strong>d <strong class="lz hv">--</strong>rm <strong class="lz hv">--</strong>name skipme alpine tail <strong class="lz hv">-</strong>f /dev/null<br/><br/># run this command in another pane/screen to see running docker containers<br/>watch docker ps <strong class="lz hv">-</strong>a<br/><br/># go back to main pane/screen and kill (once in 10s) random 'test' container, ignoring 'skipme'<br/>pumba <strong class="lz hv">--</strong>random <strong class="lz hv">--</strong>interval 10s kill re2:^test<br/># press Ctrl-C to stop Pumba at any time</span></pre><p id="d79c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">使用<em class="iw">正常</em>分布模型，为<code class="eh lw lx ly lz b">ping</code>容器的<em class="iw">工程</em>流量增加一个<code class="eh lw lx ly lz b">3000ms</code> ( <code class="eh lw lx ly lz b">+-50ms</code>)延迟<code class="eh lw lx ly lz b">20</code>秒。</p><pre class="lp lq lr ls fq ma lz mb mc aw md dt"><span id="2059" class="me jv hu lz b fv mf mg l mh mi"># run "ping" container on one screen/pane<br/>docker run <strong class="lz hv">-</strong>it <strong class="lz hv">--</strong>rm <strong class="lz hv">--</strong>name ping alpine ping 8.8.8.8<br/><br/># on second screen/pane, run pumba netem delay command, disturbing "ping" container; sidekick a "tc" helper container<br/>pumba netem <strong class="lz hv">--</strong>duration 20s <strong class="lz hv">--</strong>tc<strong class="lz hv">-</strong>image gaiadocker/iproute2 delay <strong class="lz hv">--</strong>time 3000 jitter 50 <strong class="lz hv">--</strong>distribution normal ping<br/># pumba will exit after 20s, or stop it with Ctrl-C</span></pre><p id="ba7c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">为了演示丢包能力，我们需要三个屏幕/面板。我将使用<code class="eh lw lx ly lz b">iperf</code>网络带宽测量<a class="ae jt" href="https://iperf.fr/" rel="noopener ugc nofollow" target="_blank">工具</a>。<br/>在第一个面板上，运行<em class="iw"> server </em> docker container和<code class="eh lw lx ly lz b">iperf</code> on-board，并在那里启动一个UDP服务器。在第二个窗格中，用<code class="eh lw lx ly lz b">iperf</code>启动<em class="iw">客户端</em> docker容器，并向<em class="iw">服务器</em>容器发送数据报。然后，在第三个窗格中，运行<code class="eh lw lx ly lz b">pumba netem loss</code>命令，向<em class="iw">客户端</em>容器添加一个丢包。享受混乱。</p><pre class="lp lq lr ls fq ma lz mb mc aw md dt"><span id="6790" class="me jv hu lz b fv mf mg l mh mi"># create docker network<br/>docker network create <strong class="lz hv">-</strong>d bridge testnet<br/><br/># &gt; Server Pane<br/># run server container<br/>docker run <strong class="lz hv">-</strong>it <strong class="lz hv">--</strong>name server <strong class="lz hv">--</strong>network testnet <strong class="lz hv">--</strong>rm alpine sh <strong class="lz hv">-</strong>c "apk add --no-cache iperf; sh"<br/># shell inside server container: run a UDP Server listening on UDP port 5001<br/>sh$ iperf <strong class="lz hv">-</strong>s <strong class="lz hv">-</strong>u <strong class="lz hv">-</strong>i 1<br/><br/># &gt; Client Pane<br/># run client container<br/>docker run <strong class="lz hv">-</strong>it <strong class="lz hv">--</strong>name client <strong class="lz hv">--</strong>network testnet <strong class="lz hv">--</strong>rm alpine sh <strong class="lz hv">-</strong>c "apk add --no-cache iperf; sh"<br/># shell inside client container: send datagrams to the server -&gt; see no packet loss<br/>sh$ iperf <strong class="lz hv">-</strong>c server <strong class="lz hv">-</strong>u<br/><br/># &gt; Server Pane<br/># see server receives datagrams without any packet loss<br/><br/># &gt; Pumba Pane<br/># inject 20% packet loss into client container, for 1m<br/>pumba netem <strong class="lz hv">--</strong>duration 1m <strong class="lz hv">--</strong>tc<strong class="lz hv">-</strong>image gaiadocker/iproute2 loss <strong class="lz hv">--</strong>percent 20 client<br/><br/># &gt; Client Pane<br/># shell inside client container: send datagrams to the server -&gt; see ~20% packet loss<br/>sh$ iperf <strong class="lz hv">-</strong>c server <strong class="lz hv">-</strong>u</span></pre><h1 id="ce26" class="ju jv hu bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">会议和幻灯片</h1><h2 id="72c1" class="me jv hu bd jw mj mk ml ka mm mn mo ke ku mp mq ki kw mr ms km ky mt mu kq mv dt translated">ContainerCamp英国2017年会议</h2><figure class="lp lq lr ls fq lt"><div class="bz el l di"><div class="lu lv l"/></div></figure><h2 id="ec85" class="me jv hu bd jw mj mk ml ka mm mn mo ke ku mp mq ki kw mr ms km ky mt mu kq mv dt translated">上述会议的幻灯片</h2><figure class="lp lq lr ls fq lt"><div class="bz el l di"><div class="mw lv l"/></div></figure><p id="f97f" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated"><a class="ae jt" href="https://www.slideshare.net/alexLM/chaos-engineering-for-docker" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hv">混沌工程</strong> </a> <strong class="ix hv"> </strong>来自<a class="ae jt" href="https://www.slideshare.net/alexLM" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hv">阿列克谢·列德涅夫</strong> </a></p><p id="5ff9" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated">希望，你觉得这篇帖子有用。我期待您的评论和任何问题。</p></div><div class="ab cl mx my hc mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="hn ho hp hq hr"><p id="ce4a" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ku jh ji jj kw jl jm jn ky jp jq jr js hn dt translated"><em class="iw">原载于2017年10月4日</em><a class="ae jt" href="https://codefresh.io/blog/chaos_testing_docker" rel="noopener ugc nofollow" target="_blank"><em class="iw">code fresh . io</em></a><em class="iw">。</em></p><figure class="lp lq lr ls fq lt"><div class="bz el l di"><div class="ne lv l"/></div></figure></div></div>    
</body>
</html>