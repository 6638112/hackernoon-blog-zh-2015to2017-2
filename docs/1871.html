<html>
<head>
<title>Build your first Facebook Messenger bot in Ruby with Sinatra and “facebook-messenger” gem (Part 1/3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Sinatra和“Facebook-Messenger”gem在Ruby中构建您的第一个Facebook Messenger机器人(第1/3部分)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/smooth-coordinator-1427dce17f00?source=collection_archive---------1-----------------------#2016-12-16">https://medium.com/hackernoon/smooth-coordinator-1427dce17f00?source=collection_archive---------1-----------------------#2016-12-16</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="97c6" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated"><em class="jj">下面是制作一个简单的脸书机器人的第1部分</em><strong class="ak"><em class="jj"/></strong><em class="jj">，它利用了</em> <a class="ae jk" href="https://developers.google.com/maps/documentation/geocoding/intro" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> <em class="jj">谷歌地图地理编码API </em> </strong> </a> <em class="jj">的力量。在</em> <a class="ae jk" href="https://hackernoon.com/build-your-first-facebook-messenger-bot-in-ruby-with-sinatra-part-2-3-b3d929a4606d#.4jblmtuod" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> <em class="jj">第二部分</em> </strong> <em class="jj"> </em> </a> <em class="jj">中我们将添加更多功能，重构代码，让一切</em> <a class="ae jk" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank"> <em class="jj">烘干机</em> </a> <em class="jj">。在</em> <a class="ae jk" href="https://hackernoon.com/build-your-first-facebook-messenger-bot-in-ruby-with-sinatra-part-3-3-c1b9f55ae121#.7jq1h0u5w" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> <em class="jj">第三部分</em> </strong> </a> <em class="jj">中，我们将把我们的bot部署到</em><a class="ae jk" href="http://heroku.com" rel="noopener ugc nofollow" target="_blank"><em class="jj">Heroku</em></a><em class="jj">并增强其接口。</em></h2></div><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="fe ff jl"><img src="../Images/28e48d5e09a101d579961e099da2eca3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*QqWrAjG9tVGdX3sNVrVBDg.jpeg"/></div></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">An obscure cultural reference for Soviet-born readers</figcaption></figure><p id="9ddd" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated"><em class="kx">本教程假设你已经在你的机器上安装了一个普通的Ruby环境，并且你知道《美丽新世界》</em><a class="ae jk" href="https://rubygems.org/" rel="noopener ugc nofollow" target="_blank"><em class="kx">Ruby gems</em></a><em class="kx">给我们的。下面是我们在第二部分结束时将要构建的内容的预览:</em></p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="fe ff ky"><img src="../Images/f48d6b9e444fa19884597bfe41bd5afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/1*yEpWUV1ZD52BLvPQoRUIKQ.gif"/></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">Cool, huh?</figcaption></figure><h1 id="d5bc" class="kz la hu bd lb lc ld le lf lg lh li lj ja lk jb ll jd lm je ln jg lo jh lp lq dt translated"><strong class="ak">前言</strong></h1><p id="b2f1" class="pw-post-body-paragraph kb kc hu kd b ke lr iv kg kh ls iy kj kk lt km kn ko lu kq kr ks lv ku kv kw hn dt lw translated">et面对难以忽视的真相。机器人被过度宣传，主要是因为<a class="ae jk" href="https://www.cnet.com/news/chatbots-facebook-bots-are-super-stupid-right-now/" rel="noopener ugc nofollow" target="_blank">它们仍然是哑的</a>。他们中的大多数。我今年32岁，从15岁起就对一切数码事物感到兴奋，我在<a class="ae jk" href="https://en.wikipedia.org/wiki/Internet_Relay_Chat" rel="noopener ugc nofollow" target="_blank"> IRC </a>上学会了快速打字。它是1988年首次出现的聊天服务，比万维网早了一两年。当网络聊天室成为现实时，IRC已经有了一个全球性的黑客社区。当我在DALnet上有自己的名为#402的频道时，我在那里至少认识了两个现在最好的朋友。是的，它有以散列符号开始的频道(我看着你，Slack，为复兴一个有25年历史的科技而喝彩)。它还有<a class="ae jk" href="https://en.wikipedia.org/wiki/IRC_bot" rel="noopener ugc nofollow" target="_blank"> <strong class="kd hv">机器人</strong> </a>。</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/b539ef4dfeb6fc1c2041f453a2de2d71.png" data-original-src="https://miro.medium.com/v2/format:webp/1*2pNf_3OmlryXt9jo3-Kxcw.png"/></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">Old is the new young, as seen by Google Trends</figcaption></figure><p id="035d" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">所以难怪当2016年bots再次成为一个家喻户晓的词时，我和我的朋友们只是耸耸肩。当然，当你加入一些严肃的AI巫毒时，机器人可以实现<a class="ae jk" href="http://www.telegraph.co.uk/technology/2016/03/24/microsofts-teen-girl-ai-turns-into-a-hitler-loving-sex-robot-wit/" rel="noopener ugc nofollow" target="_blank">惊人的壮举</a>。但是，说真的，让我们坦诚相待吧，我的开发伙伴们:你们的普通机器人并不比2002年在IRC服务器上运行的Perl脚本聪明多少。</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/4cd63444fd2f2aa77908d5f4ab0b2371.png" data-original-src="https://miro.medium.com/v2/format:webp/1*N72r9ubV32IKVuTL5MPhFg.png"/></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">A bot-related prehistoric meme circa 1995</figcaption></figure><p id="249c" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">综上所述，<strong class="kd hv">我仍然相信机器人是伟大的，它们将会变得伟大。即使他们从不打扮。为什么这样机器人可以减少前端的热量，降低应用程序的开发成本，因为开发人员可以专注于业务逻辑，而不是外观。JavaScript社区<a class="ae jk" href="https://hackernoon.com/how-it-feels-to-learn-javascript-in-2016-d3a717dd577f#.n05g4p88j" rel="noopener ugc nofollow" target="_blank">现在很混乱</a>，新的前端框架每隔一周就会出现，任何或多或少像样的现代界面都需要一个摇滚明星程序员，他碰巧也是一名设计师<strong class="kd hv">和一名UX工程师</strong>。虽然这对聪明人来说是个好消息，但对那些为了看起来漂亮而不得不雇佣更多聪明人的人来说却是个坏消息。</strong></p><p id="8f23" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">遇见机器人。很快你就会看到，你只需要一个微框架和一种后端语言(当然，它可以是JS，如<a class="ae jk" href="https://en.wikipedia.org/wiki/Node.js" rel="noopener ugc nofollow" target="_blank"> NodeJS </a>)来快速构建一个交互式应用。如果你用它做一些有用的事情，它实际上可能会吸引用户。</p></div><div class="ab cl mg mh hc mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hn ho hp hq hr"><h1 id="a1cd" class="kz la hu bd lb lc mn le lf lg mo li lj ja mp jb ll jd mq je ln jg mr jh lp lq dt translated"><strong class="ak">说够了，让我们造一个</strong></h1><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/a3999882995f25f02ea6b0e24ad58840.png" data-original-src="https://miro.medium.com/v2/format:webp/1*uR4Yirt37DqqrS-8VcpJOA.jpeg"/></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">Frank Sinatra after a certain Ruby framework stole his name and his hat</figcaption></figure><p id="1e45" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">尽管我想使用更多的Rails(不到三个月前，我在巴黎的Le Wagon boot camp开始学习Rails，并且只用它做了两个学生项目)，我们选择的武器将是Sinatra，下面的截图是原因。</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/a5bad1b530a6d50eb541a60bfe1635b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*WPUIobXkBstwSF4CRgSN6g.png"/></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">Folder structure of a Rails app (right) vs. the structure of a Sinatra app (left)</figcaption></figure><p id="0496" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">Sinatra让你只用几行代码就能创建一个正常运行的web应用，没有任何样板文件。在我们的例子中，我们将只需要Sinatra做一件具体的事情，其余的将由令人难以置信的<strong class="kd hv"> facebook-messenger </strong></p><p id="0809" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">转到您的控制台并键入:</p><pre class="jm jn jo jp fq mt mu mv mw aw mx dt"><span id="2566" class="my la hu mu b fv mz na l nb nc">gem install facebook-messenger</span></pre><p id="2037" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">机器人在<a class="ae jk" href="https://rack.github.io/" rel="noopener ugc nofollow" target="_blank">架</a>上运行，和Sinatra一样(就此而言，还有<a class="ae jk" href="http://blog.gauravchande.com/what-is-rack-in-ruby-rails" rel="noopener ugc nofollow" target="_blank">轨道</a>)。所以，为了开始，我们需要一个<strong class="kd hv">的备份文件</strong>。为您的项目创建一个文件夹(我的名为coordinator-bot ),并将名为<strong class="kd hv"> config.ru </strong>的文件放入其中。<em class="kx">。ru </em>代表rack-up(俄罗斯联邦的顶级互联网域名)。把这个放进去:</p><figure class="jm jn jo jp fq jq"><div class="bz el l di"><div class="nd ne l"/></div></figure><p id="039a" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">接下来，<strong class="kd hv">在同一个文件夹中创建一个名为<strong class="kd hv"> app.rb </strong>的文件</strong>，并放入以下内容:</p><figure class="jm jn jo jp fq jq"><div class="bz el l di"><div class="nd ne l"/></div></figure><p id="6149" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">接下来，创建<strong class="kd hv">另一个文件</strong>，名为<strong class="kd hv"> Gemfile </strong>，内容如下:</p><figure class="jm jn jo jp fq jq"><div class="bz el l di"><div class="nd ne l"/></div></figure><p id="aef2" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">现在转到命令行并运行:</p><pre class="jm jn jo jp fq mt mu mv mw aw mx dt"><span id="aa1c" class="my la hu mu b fv mz na l nb nc">bundle install</span></pre><h1 id="2d9c" class="kz la hu bd lb lc ld le lf lg lh li lj ja lk jb ll jd lm je ln jg lo jh lp lq dt translated"><strong class="ak">好了，是时候在脸书上创建我们的应用了</strong></h1><p id="a2f9" class="pw-post-body-paragraph kb kc hu kd b ke lr iv kg kh ls iy kj kk lt km kn ko lu kq kr ks lv ku kv kw hn dt translated">到目前为止，你是一个<a class="ae jk" href="https://hackernoon.com/tagged/facebook" rel="noopener ugc nofollow" target="_blank">脸书</a>用户，现在是时候成为一名脸书开发者了。前往<a class="ae jk" href="https://developers.facebook.com/" rel="noopener ugc nofollow" target="_blank">https://developers.facebook.com/</a>，使用您常用的脸书账户登录，在屏幕右上角选择<strong class="kd hv">“添加新应用”</strong>。</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/414f39a3bcc09e2df1348283e6824bf2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*SJmrywjOYhI9T8IT3sECSQ.png"/></div></figure><p id="823b" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">输入您的应用程序名称(使用您的幻想！)并且不要忘记设置一个类别为<strong class="kd hv">“Messenger应用程序”</strong>。</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/6726024be0dfe3767fac1bf7ed5fa1f3.png" data-original-src="https://miro.medium.com/v2/format:webp/1*l3IHMq5M7FJmu-AwzSI8dg.png"/></div></figure><p id="ccf2" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">然后脸书会确定你不是机器人，这很讽刺，但避免了天网的场景。然后，在<strong class="kd hv">“令牌生成”</strong>下，选择<strong class="kd hv">“创建新页面”</strong>并选择一个类别。我的是“品牌或产品”。</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/98d9ac3d3e27033ce94aad6b6f716dbc.png" data-original-src="https://miro.medium.com/v2/format:webp/1*WJRCi4Kp3NujVADy82Zmlw.png"/></div></figure><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/f9f324bcb05870dcc59f598a43ec80d8.png" data-original-src="https://miro.medium.com/v2/format:webp/1*tniZa7A74aJqOVWDcxUJ2Q.png"/></div></figure><p id="8aca" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">跳过向导菜单中的所有内容(当然，如果您想让您的测试页面看起来更好，请便！)，返回到开发人员的仪表板，为新页面生成一个令牌。</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/774097b5a4fc6e1a770b5b5cdbdbf507.png" data-original-src="https://miro.medium.com/v2/format:webp/1*QUA0pcNMLOJAfIZKoNpjbg.png"/></div></figure><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/ea3f7d2735f85ea42b77d37c36550d2e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*vpyuuTXnNUrF02zBHWtYMA.png"/></div></figure><p id="d888" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">把它保存在你电脑的某个地方(但是<strong class="kd hv">不要给任何人或者公开发布</strong>！)，一会儿你会需要的。</p><p id="397c" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">你的脸书仪表盘上会有两件你应该保密的东西。你的<strong class="kd hv">页面令牌</strong>(我们姑且称之为<em class="kx"> ACCESS_TOKEN </em>)和webhook验证的令牌(<em class="kx"> VERIFY_TOKEN </em>)。页面令牌刚刚生成，验证令牌可以是您想要的任何东西，只是要确保以后记住它。接下来，在您的终端中打开另一个选项卡，在“=”符号后键入<em class="kx"> export ACCESS_TOKEN= </em>和<em class="kx"> export VERIFY_TOKEN=，</em>而<em class="kx"> </em>使用您自己的值(另外，请注意，令牌周围没有引号)。这就是所谓的<strong class="kd hv">设置环境变量</strong>。</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/fc4af4acd7920b950812d68ead01332f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*svPH6vsj85hb9GczQldqWw.png"/></div></figure><p id="1638" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">对于Rails来说，这种事情可以由Figaro gem来处理，但是在Sinatra下我无法让它工作，我的猜测是:它不被支持(请在评论中纠正我)</p></div><div class="ab cl mg mh hc mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hn ho hp hq hr"><p id="bb3f" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated"><strong class="kd hv"> <em class="kx"> NB！</em> </strong> <em class="kx">在继续之前，从你的</em> <code class="eh nf ng nh mu b"><em class="kx">config.ru</em></code> <em class="kx">文件中注释掉</em> <code class="eh nf ng nh mu b"><em class="kx">require_relative 'bot'</em></code> <em class="kx">。当我们实际创建一个bot文件时，你需要把这一行放回去，但是现在，只是为了测试</em> <code class="eh nf ng nh mu b"><em class="kx">rackup</em></code> <em class="kx">是否工作，我们需要暂时禁用它。</em></p><p id="debc" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">是时候启动我们的服务器了。从你的项目文件夹中返回到命令行(<strong class="kd hv">注意！</strong>它应该是<strong class="kd hv">与您刚刚输入的环境变量相同的终端标签</strong>并输入:</p><pre class="jm jn jo jp fq mt mu mv mw aw mx dt"><span id="0bd4" class="my la hu mu b fv mz na l nb nc">rackup -p 5000</span></pre><p id="02e4" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">您应该看到这个:</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/2beb375230cd79d3369c3fdcf79f1802.png" data-original-src="https://miro.medium.com/v2/format:webp/1*tgyHb0_m-3zX_XszZkpHoQ.png"/></div></figure><p id="9d88" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">可以再挑一个端口号(<em class="kx"> 1337 </em>，有人吗？)，但它应该与我们将通过<strong class="kd hv"> Ngrok </strong>管道传输的那个相同。去<a class="ae jk" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> Ngrok的</a>网站，下载并把可执行文件放在你的项目文件夹或它的一个父文件夹中。然后你可以像这样运行它(在一个新的标签中)。</p><pre class="jm jn jo jp fq mt mu mv mw aw mx dt"><span id="77da" class="my la hu mu b fv mz na l nb nc">./ngrok http 5000</span></pre><p id="5b3d" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">具有这样的效果:</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/b3dc583a8ba0e398ecfdd30e5f471b32.png" data-original-src="https://miro.medium.com/v2/format:webp/1*5XyGK_xwMqlbc9gUalP7nQ.png"/></div></figure><p id="4e06" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">现在，您的本地主机<a class="ae jk" href="https://www.rt.com/viral/370070-russian-regulator-bans-itself/" rel="noopener ugc nofollow" target="_blank">上的端口5000上发生的任何事情都将在互联网上以一个为您唯一生成的域名广播，类似于以下内容:</a><a class="ae jk" href="http://982bd57f8.ngrok.io." rel="noopener ugc nofollow" target="_blank"><em class="kx">http://982 BD 57 f 8 . ngrok . io</em>。</a></p><p id="7789" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">在您的浏览器中转到这个地址:您应该会看到文本<em class="kx">“此处无内容”</em>。没错，这就是我们<strong class="kd hv"> app.rb </strong>中这些台词的内容:</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/dbbd684d981514ec8e737e15ac71f8da.png" data-original-src="https://miro.medium.com/v2/format:webp/1*IM8VGgx8eplnYb98OH073A.png"/></div></figure><p id="bf84" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">在您的脸书仪表板中，您刚刚为您的脸书页面生成了访问令牌，向下滚动一点，在<strong class="kd hv">“web hooks”</strong>下单击<strong class="kd hv">“Setup</strong><a class="ae jk" href="https://en.wikipedia.org/wiki/Webhook" rel="noopener ugc nofollow" target="_blank"><strong class="kd hv">web hooks</strong></a><strong class="kd hv">”。</strong>切换到您的终端(您运行了那个<em class="kx">)。/ngrok </em>命令在一个新的选项卡中，对吗？)，复制“转发”下的网址(确保复制的是以<a class="ae jk" href="https://%29" rel="noopener ugc nofollow" target="_blank"> <em class="kx"> https:// </em> ) </a>开头的，并附加<em class="kx"> /webhook </em>。这就是我们如何命名我们的服务器将与脸书通信的路径。我们可以称之为<em class="kx">/bot</em>——由你决定。在<strong class="kd hv">“验证令牌”</strong>下，输入之前设置环境变量时得到的相同字符串。勾选“信息”标记。</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/561b7ef73759692468117b8fe46745fa.png" data-original-src="https://miro.medium.com/v2/format:webp/1*wWpkkdRVdA3zU21Q9O9Qmw.png"/></div></figure><p id="e947" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">现在您可以<strong class="kd hv">点击</strong>“验证并保存”。如果你正确设置了你的服务器，脸书会调用你的ngrok URL上的/webhook path，给你发送一个“挑战”(只是一个随机的数字串)，然后等待它的回应。<strong class="kd hv"> app.rb </strong>中的这些行是这样做的:</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/148e9df7b474b7f352f82e288f7375cc.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ZGdIjxiW7uIs_6iWIxh-2A.png"/></div></figure><p id="696b" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">这就是我们需要辛纳屈的原因。继续前进。</p></div><div class="ab cl mg mh hc mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hn ho hp hq hr"><h1 id="fa99" class="kz la hu bd lb lc mn le lf lg mo li lj ja mp jb ll jd mq je ln jg mr jh lp lq dt translated">机器人，见见你的创造者</h1><p id="3f37" class="pw-post-body-paragraph kb kc hu kd b ke lr iv kg kh ls iy kj kk lt km kn ko lu kq kr ks lv ku kv kw hn dt translated">所有进一步的编程都将在我们的<strong class="kd hv"> bot.rb </strong>文件中完成。继续在您的项目文件夹中创建一个。你的第一个机器人只会说“你好！”人类送他的任何东西。</p><figure class="jm jn jo jp fq jq"><div class="bz el l di"><div class="nd ne l"/></div></figure><blockquote class="ni nj nk"><p id="3c0a" class="kb kc kx kd b ke kf iv kg kh ki iy kj nl kl km kn nm kp kq kr nn kt ku kv kw hn dt translated">记住，<strong class="kd hv">每次你改变任何文件中的某个东西</strong>，你都必须返回到你的rack服务器正在运行的终端标签页(你可以不动ngrok)，按Ctrl-C并重启它。同样，现在你需要在你的<code class="eh nf ng nh mu b">config.ru</code>中<code class="eh nf ng nh mu b">require_relative ‘bot’</code></p></blockquote><p id="e716" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">现在打开你的Facebook Messenger(无论是桌面还是移动)，在“搜索Messenger”下使用你最近创建的页面名称找到你的机器人，然后输入任何内容。他会回应“你好！”。</p><blockquote class="no"><p id="b356" class="np nq hu bd nr ns nt nu nv nw nx kw ek translated">祝贺你，你刚刚与你自己的机器人进行了第一次对话！</p></blockquote><p id="4fee" class="pw-post-body-paragraph kb kc hu kd b ke ny iv kg kh nz iy kj kk oa km kn ko ob kq kr ks oc ku kv kw hn dt translated">在您的服务器选项卡中，您应该会看到如下内容:</p><pre class="jm jn jo jp fq mt mu mv mw aw mx dt"><span id="771f" class="my la hu mu b fv mz na l nb nc">"POST /webhook HTTP/1.1" 200 - 0.0011</span></pre><p id="908d" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">这意味着bot已经在其/webhook路径上向您的服务器发送了一个<a class="ae jk" href="http://www.restapitutorial.com/lessons/httpmethods.html" rel="noopener ugc nofollow" target="_blank"> HTTP POST </a>请求，并且服务器(facebook-messenger gem)做出了相应的响应。您可以在<em class="kx"> Bot.on </em>块的开头添加这一行。</p><pre class="jm jn jo jp fq mt mu mv mw aw mx dt"><span id="8125" class="my la hu mu b fv mz na l nb nc">Bot.on :message do |message|<br/>    puts "Received '#{message.inspect}' from #{message.sender}" <br/>    (…rest of the code in bot.rb)</span></pre><p id="f990" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">它将让您了解更多关于您的机器人正在进行的对话，您的服务器选项卡将记录如下内容:</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div class="ab fr cl mf"><img src="../Images/58e64f926998f55ed362dfd3100dbd6e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*E6IYR8fvCkpsOpE8tmj10w.png"/></div></figure><p id="2533" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">好吧，你的机器人在这一点上并不特别聪明。让我们添加一些真实世界的功能。当你输入世界上任何一个地址的时候，机器人都会给你GPS坐标，怎么样？我们将使用<a class="ae jk" href="https://developers.google.com/maps/documentation/geocoding/intro" rel="noopener ugc nofollow" target="_blank"> <strong class="kd hv">谷歌地图地理编码API </strong> </a> <strong class="kd hv">。</strong>你需要做的就是发送一个GET请求(你也应该把你的私有API密匙放在URL的末尾，但是为了测试我们可以不用它，查看Google的文档以获得更多关于API密匙的信息):</p><pre class="jm jn jo jp fq mt mu mv mw aw mx dt"><span id="0abe" class="my la hu mu b fv mz na l nb nc"><a class="ae jk" href="https://maps.googleapis.com/maps/api/geocode/json?address=ANY_STRING_THAT_LOOKS_LIKE_ADDRESS" rel="noopener ugc nofollow" target="_blank">https://maps.googleapis.com/maps/api/geocode/json?address=ANY_STRING_THAT_LOOKS_LIKE_ADDRESS</a></span></pre><p id="6111" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">谷歌将施展它的魔法(例如，如果你与一个俄罗斯提供商连接，它将计算出你想要俄罗斯的莫斯科，而不是德克萨斯州的莫斯科)，它将发回一个包含所有有用数据的<a class="ae jk" href="https://en.wikipedia.org/wiki/JSON" rel="noopener ugc nofollow" target="_blank"> JSON </a>，即纬度和经度。</p><p id="d0e4" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">我们将使用一个神奇的<a class="ae jk" href="https://github.com/jnunemaker/httparty" rel="noopener ugc nofollow" target="_blank">http party</a>宝石来提出我们的请求。在最初的<em class="kx">包安装</em>期间，我们已经在我们的项目中安装了它。将此方法添加到您的<strong class="kd hv"> bot.rb </strong>中</p><figure class="jm jn jo jp fq jq"><div class="bz el l di"><div class="nd ne l"/></div></figure><p id="4e3f" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">我们使用Ruby的标准JSON解析功能将来自API的响应转换成常规的Hash对象。确保你的<strong class="kd hv"> bot.rb </strong>在顶部有一行<em class="kx">require‘JSON’</em>。</p><p id="6230" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">现在在杂凑里找我们的坐标。将此方法添加到<strong class="kd hv"> bot.rb </strong>中。</p><figure class="jm jn jo jp fq jq"><div class="bz el l di"><div class="nd ne l"/></div></figure><p id="ccc5" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">更新您的Bot块以发送回您从API获得的数据。将您的<em class="kx"> Bot.on </em>方法替换为:</p><figure class="jm jn jo jp fq jq"><div class="bz el l di"><div class="nd ne l"/></div></figure><p id="0bd8" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">最终你的<strong class="kd hv"> bot.rb </strong>应该是这样的:</p><figure class="jm jn jo jp fq jq"><div class="bz el l di"><div class="nd ne l"/></div></figure><p id="543d" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">太好了！继续测试你的机器人吧！它应该这样做。</p><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="fe ff od"><img src="../Images/89ede158162bf96443284aa763b55584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mqVI-WFGq0uW-jxAQGMJ_g.gif"/></div></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">YAY! Our first bot that makes sense!</figcaption></figure><p id="e893" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">现在我们的机器人仍然非常愚蠢。只有当你输入一个有效的地址时，它才能返回坐标给你。不打招呼，不道别。如果你输入谷歌找不到的东西，它就会挂起，你必须重新启动你的机架。</p><p id="f0fa" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated">在本教程的<strong class="kd hv">第二部分</strong>中，我们将让我们的机器人更加智能，它将能够跟上简单的对话。我们还将处理API不返回任何结果的情况，我们将教它查找任何位置的完整邮政地址。</p><blockquote class="no"><p id="34c5" class="np nq hu bd nr ns nt nu nv nw nx kw ek translated">暂时就这些了。我希望你喜欢它！</p></blockquote><h1 id="111c" class="kz la hu bd lb lc ld le lf lg lh li lj ja oe jb ll jd of je ln jg og jh lp lq dt translated">去看看第二部分吧！</h1></div><div class="ab cl mg mh hc mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hn ho hp hq hr"><blockquote class="ni nj nk"><p id="adb6" class="kb kc kx kd b ke kf iv kg kh ki iy kj nl kl km kn nm kp kq kr nn kt ku kv kw hn dt translated">我们的机器人在这个开发阶段的所有代码都可以在我的Github上找到。</p><p id="40fb" class="kb kc kx kd b ke kf iv kg kh ki iy kj nl kl km kn nm kp kq kr nn kt ku kv kw hn dt translated">您可以在同一个repo中找到最终项目的代码(在撰写本文时仍在WIP中)，但是在<a class="ae jk" href="https://github.com/progapandist/coordinator-bot" rel="noopener ugc nofollow" target="_blank">主分支</a>中。<strong class="kd hv">随便叉，随便克隆，随便玩。</strong></p></blockquote></div><div class="ab cl mg mh hc mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hn ho hp hq hr"><p id="68da" class="pw-post-body-paragraph kb kc hu kd b ke kf iv kg kh ki iy kj kk kl km kn ko kp kq kr ks kt ku kv kw hn dt translated"><strong class="kd hv">免责声明</strong> : <em class="kx">我是一名初学网站开发的人，曾是资深国际电视记者，也是一名对IT毫无经验的年轻父亲。在寻找我的第一份严肃的开发工作时，除了痴迷于编码风格并试图让我的脑袋充满技术文献之外，我最近以全班第一的成绩从巴黎的一个优秀的</em> <a class="ae jk" href="https://www.lewagon.com/" rel="noopener ugc nofollow" target="_blank"> <em class="kx"> Le Wagon </em> </a> <em class="kx">编码训练营毕业，并在那里与人合著了一个毕业项目</em><a class="ae jk" href="http://halfway.ninja" rel="noopener ugc nofollow" target="_blank"><em class="kx">【midway . ninja</em></a><em class="kx">。这是情侣机票的比较。去看看！你可以在</em><a class="ae jk" href="https://github.com/progapandist" rel="noopener ugc nofollow" target="_blank"><em class="kx">Github</em></a><em class="kx">，</em><a class="ae jk" href="https://twitter.com/progapandist" rel="noopener ugc nofollow" target="_blank"><em class="kx">Twitter</em></a><em class="kx">和</em><a class="ae jk" href="https://www.instagram.com/progapanda/" rel="noopener ugc nofollow" target="_blank"><em class="kx">insta gram</em></a><em class="kx">上找到我。我也拥有这个</em> <a class="ae jk" href="https://progapanda.org" rel="noopener ugc nofollow" target="_blank"> <em class="kx">域</em> </a> <em class="kx">。我也可以被雇佣，无论是鼓舞人心的实习，自由职业者，甚至是全职工作。我会说英语、俄语、法语、Ruby、JavaScript、Python和Swift，目前在俄罗斯联邦莫斯科工作。随便</em> <a class="ae jk" href="mailto:andybarnov@gmail.com" rel="noopener ugc nofollow" target="_blank"> <em class="kx">直接写我</em> </a> <em class="kx">有什么优惠(或者死亡威胁)。</em></p><div class="jm jn jo jp fq ab cb"><figure class="oh jq oi oj ok ol om paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="oh jq oi oj ok ol om paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="oh jq oi oj ok ol om paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ni nj nk"><p id="f922" class="kb kc kx kd b ke kf iv kg kh ki iy kj nl kl km kn nm kp kq kr nn kt ku kv kw hn dt translated"><a class="ae jk" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jk" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jk" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jk" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="kb kc kx kd b ke kf iv kg kh ki iy kj nl kl km kn nm kp kq kr nn kt ku kv kw hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jk" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jk" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jm jn jo jp fq jq fe ff paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="fe ff on"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="jm jn jo jp fq jq"><div class="bz el l di"><div class="oo ne l"/></div></figure></div></div>    
</body>
</html>