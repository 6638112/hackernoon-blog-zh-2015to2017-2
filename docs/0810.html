<html>
<head>
<title>Creating a Scripting Language with ANTLR — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用ANTLR创建脚本语言—第3部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/creating-a-scripting-language-with-antlr-part-2-e41fc68c60ba?source=collection_archive---------2-----------------------#2016-05-13">https://medium.com/hackernoon/creating-a-scripting-language-with-antlr-part-2-e41fc68c60ba?source=collection_archive---------2-----------------------#2016-05-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="1fe8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<a class="ae jp" rel="noopener" href="/@thosakwe/creating-a-scripting-language-with-antlr-part-2-ba4d8d6eab55">第2部分</a>中，我们编写了一个语法，生成了一个词法分析器和解析器，还编写了一个简单的函数来从输入代码生成AST。为了把所有的放在一起，我们需要走那条路。</p><p id="01dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的脚本语言支持两种类型的语句——变量赋值和函数调用。可以想象，变量赋值只是将变量的值设置为一个表达式。函数调用使用给定的参数调用给定的函数。如果函数的名字是“say”，那么我们改叫“alert”。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="09b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://hackernoon.com/tagged/antlr" rel="noopener ugc nofollow" target="_blank"> ANTLR </a>不仅仅生成词法分析器和语法分析器。它也产生听众和访问者。对于本教程，我们将使用一个监听器。侦听器遍历整个AST，并在进入给定类型的规则上下文时触发各种事件。通过扩展ANTLR生成的默认监听器，我们只需编写代码来处理在编译过程中起作用的规则。</p><p id="a558" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这种情况下，我们的侦听器只需要处理赋值和调用，以及解析表达式的值。</p><pre class="jx jy jz ka fq kb kc kd ke aw kf dt"><span id="2642" class="kg kh hu kc b fv ki kj l kk kl">function FooTranspiler {<br/>    BaseListener.call(this);<br/>    this.output = "";<br/>}</span></pre><p id="9961" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我们将填写resolveExpr方法。它将简单地把一个表达式上下文转换成一个字符串，该字符串包含该表达式的Javascript表示形式<a class="ae jp" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank">。在大多数情况下，表达式将一对一地转换。</a></p><p id="370e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您会注意到，为了访问表达式上下文中的子令牌和规则上下文，我调用了ExprContext对象的成员函数。除了命名的孩子，这些都应该通过函数访问。</p><pre class="jx jy jz ka fq kb kc kd ke aw kf dt"><span id="976c" class="kg kh hu kc b fv ki kj l kk kl">function resolveExpr(ctx) {<br/>    if (ctx.ID() != null) {<br/>        // full code in attached gist...<br/>    }<br/>}</span></pre><p id="0bb3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我们将实现赋值语句。这对于ANTLR来说非常简单，因为我们需要做的就是获得目标变量的文本，并将其设置为解析后的表达式值。</p><pre class="jx jy jz ka fq kb kc kd ke aw kf dt"><span id="752e" class="kg kh hu kc b fv ki kj l kk kl">FooTranspiler.prototype.enterAssignStmt = function(ctx) {<br/>    var target = ctx.ID().getText();<br/>    var value = this.resolveExpr(ctx.expr());<br/>    this.output += “var “ + target + “ = “ + value + “;”;<br/>};</span></pre><p id="382a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后是调用语句。使用ANTLR，我们甚至可以遍历输入代码中提供的每个表达式。</p><pre class="jx jy jz ka fq kb kc kd ke aw kf dt"><span id="6a01" class="kg kh hu kc b fv ki kj l kk kl">FooTranspiler.prototype.enterInvocationStmt = function(ctx) {<br/>    var functionName = ctx.name.text;<br/>    this.output += functionName + “(“;<br/>    // full code in gist...<br/>}</span></pre><p id="e445" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以下是完整的代码:</p><figure class="jx jy jz ka fq km"><div class="bz el l di"><div class="kn ko l"/></div></figure></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="fdc0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，我们可以把它们结合在一起。</p><pre class="jx jy jz ka fq kb kc kd ke aw kf dt"><span id="6489" class="kg kh hu kc b fv ki kj l kk kl">var antlr4 = require('antlr4');<br/>var buildAst = require('./build-ast');<br/>var FooTranspiler = require('./foo-transpiler');</span><span id="3579" class="kg kh hu kc b fv kp kj l kk kl">function runScript(inputText) {<br/>    var ast = buildAst(inputText);<br/>    var transpiler = new FooTranspiler();      antlr4.tree.ParseTreeWalker.DEFAULT.walk(transpiler, ast);<br/>    eval(transpiler.output);<br/>}</span><span id="9da4" class="kg kh hu kc b fv kp kj l kk kl">module.exports = runScript;</span></pre><p id="8030" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在你的浏览器中运行它(在使用了类似于<a class="ae jp" href="http://browserify.org/" rel="noopener ugc nofollow" target="_blank"> browserify </a>或<a class="ae jp" href="https://webpack.github.io/" rel="noopener ugc nofollow" target="_blank"> webpack </a>的东西之后)，并且将你的代码编译成Javascript并运行。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="7fec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">恭喜你！您刚刚创建了一种脚本语言！然而，这仅仅是开始。高级别的项目，比如Twitter的搜索API，使用ANTLR。天空才是真正的极限。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="f2f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你喜欢这个教程，请点击下面的链接推荐给朋友，或者在社交媒体上分享。</p><p id="835c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在推特上关注我:<a class="ae jp" href="https://twitter.com/_wapaa_" rel="noopener ugc nofollow" target="_blank"> @wapaa_ </a></p><blockquote class="kq kr ks"><p id="80e5" class="ir is kt it b iu iv iw ix iy iz ja jb ku jd je jf kv jh ji jj kw jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is kt it b iu iv iw ix iy iz ja jb ku jd je jf kv jh ji jj kw jl jm jn jo hn dt translated">要了解更多信息，请<a class="ae jp" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">阅读我们的“关于”页面</a>、<a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上点赞/给我们发消息</a>，或者简单地说，<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is kt it b iu iv iw ix iy iz ja jb ku jd je jf kv jh ji jj kw jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jx jy jz ka fq km"><div class="bz el l di"><div class="kx ko l"/></div></figure></div></div>    
</body>
</html>