<html>
<head>
<title>Setup Docker Swarm on AWS using Ansible &amp; Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Ansible &amp; Terraform在AWS上设置Docker Swarm</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/setup-docker-swarm-on-aws-using-ansible-terraform-daa1eabbc27d?source=collection_archive---------2-----------------------#2017-10-30">https://medium.com/hackernoon/setup-docker-swarm-on-aws-using-ansible-terraform-daa1eabbc27d?source=collection_archive---------2-----------------------#2017-10-30</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/75ca758a9ce093153202f9925c58aac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/0*09Sb8Ol7AQRp1zeq."/></div></figure><p id="2155" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">这篇文章是“<a class="ae jw" href="http://www.blog.labouardy.com/manage-aws-vpc-as-infrastructure-as-code-with-terraform/" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv"> IaC </strong> </a>”系列的一部分，解释如何使用<strong class="ja hv">基础设施作为代码</strong>概念与<strong class="ja hv">地形</strong>。在这一部分中，我将向您展示如何在不到<strong class="ja hv"> 1分钟</strong>的时间内使用<strong class="ja hv">Ansible</strong>&amp;<strong class="ja hv">terra form</strong>在<strong class="ja hv"> AWS </strong>上设置<strong class="ja hv"> Swarm </strong>集群，如下图所示(1个<strong class="ja hv"> Master </strong>和2个<strong class="ja hv"> Workers </strong>):</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><div class="fe ff jx"><img src="../Images/a3791eaa38218e05abc73ab184be2042.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/0*lras7LHwNT14trkL."/></div></figure><p id="043b" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">本教程中使用的所有模板和剧本都可以在我的<a class="ae jw" href="https://github.com/mlabouardy/terraform-aws-labs/tree/master/docker-swarm-cluster" rel="noopener ugc nofollow" target="_blank"> <strong class="ja hv"> Github </strong> </a>上找到。</p><p id="1a64" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:我做了一些关于如何在<strong class="ja hv"> AWS </strong>上开始使用<strong class="ja hv"> Terraform </strong>的教程，所以请确保在你阅读这篇文章之前阅读它。</p><p id="7fe6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 1 —使用Terraform </strong>设置EC2集群</p><p id="cd29" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 1.1 —全局变量</strong></p><p id="89f6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">该文件包含特定于环境的配置，如区域名称、实例类型…</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kc kd l"/></div></figure><p id="a015" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 1.2 —将AWS配置为提供商</strong></p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kc kd l"/></div></figure><p id="a3ad" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 1.3 —安全组</strong></p><p id="7d32" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">此<strong class="ja hv"> SG </strong>允许所有<strong class="ja hv">入站/出站</strong>流量:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kc kd l"/></div></figure><p id="c0df" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 1.4 — EC2实例</strong></p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kc kd l"/></div></figure><p id="0665" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">引导</strong>脚本安装最新版本的<strong class="ja hv"> Docker </strong>:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kc kd l"/></div></figure><p id="c1b5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv"> 2 —用Ansible转换为Swarm集群</strong></p><p id="d9ae" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">行动手册</strong>一目了然:</p><figure class="jy jz ka kb fq iv"><div class="bz el l di"><div class="kc kd l"/></div></figure><p id="6144" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">现在我们定义了所有需要的模板和行动手册，我们只需要键入2个命令来启动swarm集群:</p><p id="6ca3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">适用于地形</p><p id="1c22" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">|ansible -i hosts playbook.yml</p><p id="60f4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">注意:确保用每个<strong class="ja hv"> EC2 </strong>实例的<strong class="ja hv">公共ip </strong>更新<strong class="ja hv"> <em class="ke">主机</em> </strong> <em class="ke"> </em>文件。</p><p id="9c64" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">设置<strong class="ja hv">蜂群</strong>的操作如下所示:</p><figure class="jy jz ka kb fq iv fe ff paragraph-image"><a href="https://asciinema.org/a/135278"><div class="fe ff kf"><img src="../Images/757ae8804bac0ee7798ff1c38df43b7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*KQ8pjOXotwjvWf_J."/></div></a></figure></div></div>    
</body>
</html>