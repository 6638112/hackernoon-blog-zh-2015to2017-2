<html>
<head>
<title>Rewriting the ThoughtWorks Tech Radar in Elm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Elm重写ThoughtWorks技术雷达</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/rewriting-the-thoughtworks-tech-radar-in-elm-41a4e8244a13?source=collection_archive---------5-----------------------#2017-06-11">https://medium.com/hackernoon/rewriting-the-thoughtworks-tech-radar-in-elm-41a4e8244a13?source=collection_archive---------5-----------------------#2017-06-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="3098" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不久前,<a class="ae jp" href="https://www.thoughtworks.com/radar" rel="noopener ugc nofollow" target="_blank"> ThoughtWorks </a>发布了一个<a class="ae jp" href="https://github.com/thoughtworks/build-your-own-radar" rel="noopener ugc nofollow" target="_blank">开源库</a>,任何人都可以拥有自己的<a class="ae jp" href="https://hackernoon.com/tagged/technology" rel="noopener ugc nofollow" target="_blank">技术</a>雷达。</p><p id="ce83" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我很好奇这家著名的公司是如何实现它的，奇怪的是，我注意到了很多让我想起Java的概念，比如<strong class="it hv">有状态对象</strong>和使用<strong class="it hv"> try/catch/exception </strong>的错误处理。</p><p id="ea53" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">应用程序真正做的只是接受一个输入并产生一个技术雷达。Java风格的方法似乎不适合那个用例，所以我决定在<a class="ae jp" href="https://hackernoon.com/tagged/elm" rel="noopener ugc nofollow" target="_blank"> Elm </a>中重写一些！</p><h1 id="1f52" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">步骤1:建立雷达模型</h1><p id="35c5" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">让我们从思考如何对雷达本身建模开始。如果我们仔细地为我们的问题建模，它可以简化我们面前的工作。</p><p id="5b29" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先让我们考虑一下我们对数据的了解。雷达分为<em class="kt">四个象限</em>和<em class="kt">四个圆环</em>。这些象限和圆环代表几个<em class="kt">光点</em>可以被放入的不同类别。</p><p id="bdf8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为我们知道只有四个象限和环，所以让我们将它们表示为<strong class="it hv">联合类型</strong>。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/496d8954c2fb6a8bee67ad97e0bd3dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*0gtlmYY6pjPkwmk8wiiUOg.png"/></div></figure><p id="5d54" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">到目前为止一切顺利。接下来是光点。</p><p id="b88e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对信号建模需要一些额外的思考，因为信号有两种表现形式。</p><p id="e2c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一个表示是来自Google Sheet的blip数据(<a class="ae jp" href="https://docs.google.com/spreadsheets/d/1waDG0_W3-yNiAaUfxcZhTKvl7AUCgXwQw8mdPjCz86U" rel="noopener ugc nofollow" target="_blank">示例</a>)。包含的信息有<strong class="it hv">名称</strong>、<strong class="it hv">环</strong>、<strong class="it hv">象限</strong>、一个<strong class="it hv">新</strong>标志和一个<strong class="it hv">描述</strong>。</p><p id="d759" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">雷达上显示的光点需要同样的5个属性，但是为了在雷达上显示，它们还需要一个<strong class="it hv"> x-y位置</strong>。</p><p id="9300" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">模拟这些信号的几种方法包括:</p><ul class=""><li id="5a6e" class="lc ld hu it b iu iv iy iz jc le jg lf jk lg jo lh li lj lk dt translated"><strong class="it hv">将所有属性放入一条记录中，并将位置字段的类型设为<em class="kt"> Maybe </em>。</strong>该选项使用较少的类型，但将不可避免地导致更多的<em class="kt">可能处理</em>。</li><li id="e45c" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo lh li lj lk dt translated"><strong class="it hv">将谷歌地图上的光点作为一种独特的类型，并记录雷达上显示的光点。</strong>该选项删除了<em class="kt">可能的冗长性</em>，但代价是<em class="kt">在两个单独的记录字段中复制数据</em>。</li><li id="27ec" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo lh li lj lk dt translated">由于雷达信号的属性是来自Google工作表的信号的超集，我们可以用成分来表示数据。一个定位在雷达上的光点除了有一个确定的位置外，还会有Google Sheet的光点数据。</li></ul><p id="204f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还有其他值得考虑的选项，尤其是利用联合类型的选项，但是第三个选项现在已经足够了，如果需要，我们可以在以后进行重构。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff lq"><img src="../Images/52a6fa38361168af144cd127f95be8b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZ5dumBATgEqtF7esit0Bg.png"/></div></div></figure><p id="08fb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来是可视化雷达。</p><p id="bf35" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kt">如果你想知道与ThoughtWorks的开源例子相比，我们做得怎么样，那就转到他们的</em> <a class="ae jp" href="https://github.com/thoughtworks/build-your-own-radar/tree/master/src/models" rel="noopener ugc nofollow" target="_blank"> <em class="kt"> OO等效建模</em> </a> <em class="kt">。</em></p><h1 id="e80e" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">第二步:想象雷达</h1><p id="d6dc" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">现在我们已经有了构建视图的基本构件，让我们开始构建雷达可视化。</p><p id="598c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我想做的第一件事是让象限和环可视化。我们将大量使用SVG，并借鉴ThoughtWorks开源项目中的许多样式。我相信他们不会介意的。</p><p id="d482" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">创建圆弧</strong></p><p id="acd9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">雷达不是一个圆。严格来说是四个四分之一圆加在一起，也就是弧线。</p><p id="8629" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">SVG中的圆并没有那么难。另一方面，弧线相当复杂。这里有一个演示来说明我的意思。</p><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="4ffe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">随着上述代码的运行，它将被转移到一个实用模块中，这样我们就不必考虑在SVG中创建arc的实现细节。</p><p id="913b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">可视化象限</strong></p><p id="d429" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">可视化一个象限只需要我们可视化4个弧(环)，每个弧有不同的半径。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff lx"><img src="../Images/fea6fa162ad7a6f92e3e55297ce96f09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HfbXhDXr4zmQ73fu73-6CA.png"/></div></div></figure><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff ly"><img src="../Images/fe2e9aa3ede130bb67a5024a26344392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hTW1z84zP07dyMqjpfdU5g.png"/></div></div></figure><p id="9797" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还不错。如果我们这样做三次以上，并提供不同的数字，我们得到整个雷达背景。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff lz"><img src="../Images/d2eb5afe11e3e0153058d1f8695f025e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y4cbPIVXx41IHpNwmKIEQw.png"/></div></div></figure><p id="ba8e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">可视化光点</strong></p><p id="4327" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由<strong class="it hv"> isNew </strong>标志决定，有两种类型的光点可以被可视化。一个是圆角三角形，另一个类似于模糊的圆形。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div class="fe ff ma"><img src="../Images/2f3a6acbc2df3c5b6d12fe480800827d.png" data-original-src="https://miro.medium.com/v2/resize:fit:252/format:webp/1*A9MnNwyFpTZFui-Ui5pztA.png"/></div></figure><p id="8b3c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将简单地将ThoughtWorks的<a class="ae jp" href="https://github.com/thoughtworks/build-your-own-radar/blob/master/src/graphing/radar.js#L105-L109" rel="noopener ugc nofollow" target="_blank">代码</a>转录到Elm中，用于这些图像可视化。</p><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="c7d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">..更多的SVG实现细节，我们不会再看到了。</p><p id="ad7b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，可视化雷达上的模拟光点。</p><h1 id="4276" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">步骤3:用模拟数据连接视图</h1><p id="3126" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">在我们使用来自Google表单的实际数据之前，我们将模拟一些数据，以确保我们的信号在雷达上正确显示。</p><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="d45b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上述功能是暂时的，但它将在雷达上产生16个光点，每个象限的每个环一个。然而，这带来了一个问题，即究竟在哪里定位这些光点。</p><p id="0529" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我继续往前走，偷看了一下<a class="ae jp" href="https://github.com/thoughtworks/build-your-own-radar/blob/master/src/graphing/radar.js#L135-L154" rel="noopener ugc nofollow" target="_blank"> ThoughtWorks是怎么做的</a>。简而言之，它们产生一条正弦曲线，一个光点将被定位在该曲线上，如果它与另一个光点碰撞，它将尝试这条曲线上的另一个随机位置。</p><p id="0b53" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以在Elm中做同样的事情，但这带来了一个有趣的话题..<strong class="it hv">如何用纯函数式语言做随机性？</strong></p><p id="00c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kt"> &lt;快速迂回&gt; </em></p><p id="6ce9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">带有发生器的纯随机性</strong></p><p id="7094" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Elm中，每个函数都是纯函数。为了产生随机性，我们可以让Elm为给定的种子生成一个随机值。一个随机值和另一个种子被返回，这样我们可以使用那个种子来请求更多的随机值。</p><p id="8151" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，如果我们产生许多随机值，那么管理这些种子就变得非常乏味，并且容易出错。</p><p id="df5e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">幸运的是，Elm给了我们一个<strong class="it hv">生成器</strong>的概念。根据它的文档，<em class="kt">生成器就像一个生成某些随机值的配方。</em></p><p id="97ac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里有一个示例生成器，可以用来生成从3到7的随机整数。</p><pre class="kv kw kx ky fq mb mc md me aw mf dt"><span id="a995" class="mg jr hu mc b fv mh mi l mj mk">Random.int 3 7</span></pre><p id="3765" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是另一个生成器，用于生成100以下的偶数值的随机列表。</p><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="b5fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">简单地创建一个生成器实际上不会产生一个随机值。还是要传给<code class="eh ml mm mn mc b">Random.step</code>。</p><pre class="kv kw kx ky fq mb mc md me aw mf dt"><span id="32ba" class="mg jr hu mc b fv mh mi l mj mk">(randomEvens, nextSeed) =<br/>    Random.step (generateEvenValues 10) (Random.initialSeed 123)</span></pre><p id="b438" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有了这些知识，我们可以组成几个生成器，沿着正弦曲线随机定位光点，并在发生碰撞时继续产生值。这将与ThoughtWorks算法的行为相同，并且它也是我们将<code class="eh ml mm mn mc b">List GoogleSheetBlip</code>转换为<code class="eh ml mm mn mc b">List PositionedBlip</code>的地方。</p><p id="05ad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://github.com/ckoster22/techRadar/blob/blogpost/src/Page/Radar.elm#L367-L467" rel="noopener ugc nofollow" target="_blank">带有发电机的随机定位信号</a></p><p id="1f25" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我意识到我们用发电机在大约90秒内从0加速到60。如果上面的代码不能立即理解，不要担心。像Elm一样，它最初是陌生的，但是很快就变成了阅读代码的第二天性。</p><p id="3c80" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kt">&lt;/快速迂回&gt; </em></p><p id="81c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">随机显现的光点</strong></p><p id="6c0c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们将本节开头的模拟数据运行到我们的视图函数中时，我们会得到一个雷达图。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff mo"><img src="../Images/8a421382a6379529999d035f0d98b3c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QKmY4rCTh9mq-ajy1iYsag.png"/></div></div></figure><p id="0ec7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此时，我们可以继续向雷达发送数据，并验证用于确定光点位置的算法正在工作。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff mp"><img src="../Images/c42a297a55d6cebd3db2d5773225692e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FWW0fkTAdKbKzBaOtKNGqQ.png"/></div></div></figure><p id="37ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里的定位似乎很合理。继续前进。</p><p id="da3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kt">如果你正在跟踪进度</em> <a class="ae jp" href="https://github.com/thoughtworks/build-your-own-radar/blob/master/src/graphing/radar.js" rel="noopener ugc nofollow" target="_blank"> <em class="kt">这里是ThoughtWorks如何做同样的事情</em> </a> <em class="kt">。同样值得注意的是，雷达是沿y轴镜像的，因为我们对随机种子进行了硬编码。那很好。</em></p><h1 id="cc18" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">步骤4:对应用程序状态建模</h1><p id="cdb9" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">和以前一样，对应用程序状态建模非常重要。在编写自己的Elm应用程序时，值得停下来，讨论和考虑如何对数据建模的权衡。</p><p id="a3e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于这个应用程序，我们已经有一个雷达，但我们缺少一个页面来输入谷歌表的网址。</p><p id="fd3f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我选择这样对页面状态建模:</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div class="fe ff mq"><img src="../Images/8c4f0cb78bbd6641dfdb7dac4d1f21bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*6nW5AbpJtTG1G4L6e6e2rw.png"/></div></figure><p id="8086" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它将有一个初始url为空的表单。该表单可能有一个错误，我们想知道我们是否正在积极检索谷歌表。这种方法有<a class="ae jp" href="http://package.elm-lang.org/packages/krisajenkins/remotedata/4.3.0/RemoteData#RemoteData" rel="noopener ugc nofollow" target="_blank">种替代方案</a>，但是我们现在将坚持使用这三种属性。</p><p id="e254" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这涵盖了我所谓的<em class="kt">登陆页面</em>。最后，还有需要提供给Elm架构的<strong class="it hv">模型</strong>。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff mr"><img src="../Images/3dfaa48aa45ac97616e5584c37ca012a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ccETRZ8muuTZXjbriw_4WA.png"/></div></div></figure><p id="52f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这大致基于Richard Feldman的SPA示例，除了为了简单起见删除了一些内容，比如不处理这样一个小应用程序的路由。</p><p id="5c4d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">需要指出的是，在较高层次上，该应用程序处于两种状态之一:</p><ol class=""><li id="3590" class="lc ld hu it b iu iv iy iz jc le jg lf jk lg jo ms li lj lk dt translated">我们在登录页面上，正在与url输入表单进行交互</li><li id="2f2c" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo ms li lj lk dt translated">我们在雷达页面上与科技雷达互动</li></ol><h1 id="b02c" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">步骤5:用户输入、正则表达式、数据检索和错误处理</h1><p id="841f" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">登陆页面包括<strong class="it hv">接收来自用户的输入</strong>，<strong class="it hv">解析出一个Google Sheet ID </strong>，<strong class="it hv">执行一个HTTP请求</strong>，<strong class="it hv">解析响应</strong>，以及<strong class="it hv">处理所有这些情况下的错误</strong>。我将跳过用户输入部分，因为如果您已经做到这一步，您已经知道如何做了。</p><p id="33a4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kt">如果我错了，并且在Elm中处理用户输入对你来说是新的，我建议暂停并检查</em> <a class="ae jp" href="http://elm-lang.org/examples/websockets" rel="noopener ugc nofollow" target="_blank"> <em class="kt">这个例子</em> </a> <em class="kt">。</em></p><p id="3257" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">Elm中的正则表达式</strong></p><p id="4e7b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们又要从0加速到60了。坚持住。</p><p id="2b3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">用户将向我们提供他们发布的Google Sheet的链接，如"<a class="ae jp" href="https://docs.google.com/spreadsheets/d/11Fd0lwNIEUs2ymxNEiTfpM5CoQHQbMuOId8TjrQHDn0/edit?usp=sharing" rel="noopener ugc nofollow" target="_blank">https://docs . Google . com/spreadsheets/d/11fd 0 wnie us 2 ymxneitfpm 5 coqhqbmuoid 8 tjrqhdn 0/edit？usp =共享</a>"。</p><p id="e8c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">隐藏在这个URL中的是一个ID，我们需要它来执行HTTP请求。就是“/d/”和“/edit”之间那个不可读的字符串？。</p><p id="db96" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我们将声明一个查找ID的正则表达式。不言而喻，这个正则表达式的功劳又归于ThoughtWorks。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff mt"><img src="../Images/30009659130835cc7fa4c06d4aad894e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gdxArCCtFJvG9qyGaVhxDQ.png"/></div></div></figure><p id="cb44" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正则表达式中有组，我们特别关心第一个组。</p><p id="5019" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了对字符串应用正则表达式，我们使用了<code class="eh ml mm mn mc b">find</code>函数。</p><pre class="kv kw kx ky fq mb mc md me aw mf dt"><span id="c8dd" class="mg jr hu mc b fv mh mi l mj mk">matches =<br/>    find All sheetIdRegex url</span></pre><p id="0abe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它返回一个匹配列表，其形状如下。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff mu"><img src="../Images/e80086c17ed978ba41e97fb56633f6fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v56PGEs3kOFiP1-y30fshw.png"/></div></div></figure><p id="3bfd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的Google Sheet ID隐藏在<code class="eh ml mm mn mc b">submatches</code>列表中。所以我们要做的是从<code class="eh ml mm mn mc b">find</code>返回的匹配列表中获取第一个匹配，并在第一个匹配中找到它的<code class="eh ml mm mn mc b">submatches</code>中的第一个条目。</p><p id="b8e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你以前和Elm lists和<code class="eh ml mm mn mc b">List.head</code>合作过，你可能已经意识到我们将首先进入<em class="kt">梅伯兰</em>。多亏了<a class="ae jp" href="http://package.elm-lang.org/packages/elm-community/maybe-extra/latest" rel="noopener ugc nofollow" target="_blank">elm-community/maybe-extra</a>，提取ID并生成结果的代码并不太糟糕。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff mv"><img src="../Images/d3390661e8f442d722367cd491a7cc3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySYUKlXaxyE_qn81CxzDvA.png"/></div></div></figure><p id="aed2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一个<code class="eh ml mm mn mc b">MaybeExtra.join</code>折叠了当你在一个可能列表上做<code class="eh ml mm mn mc b">List.head</code>时出现的双重可能。然而，它仍然是从<code class="eh ml mm mn mc b">Maybe.map</code>返回的一个Maybe，所以第二个<code class="eh ml mm mn mc b">MaybeExtra.join</code>在把它转换成结果之前再折叠一次。</p><p id="69b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">检索谷歌表单数据</strong></p><p id="bad2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦我们有了ID，我们就可以请求以CSV格式检索Google工作表数据。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff mw"><img src="../Images/bfcd09795d15a2ae222374ace79fed85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZjwPtzP6dBYQqidGr2CFlg.png"/></div></div></figure><p id="585f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当执行这个命令时，它将调用<code class="eh ml mm mn mc b">httpResultToMsg</code>并给出结果。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff mx"><img src="../Images/c57575eeb0bb4665cffbcbb97c536422.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CEMMGRAYQXCqeqjtPhISAw.png"/></div></div></figure><p id="e7ae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上述函数执行以下操作</p><ol class=""><li id="a57b" class="lc ld hu it b iu iv iy iz jc le jg lf jk lg jo ms li lj lk dt translated">成功时，用新的行分割字符串</li><li id="26d4" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo ms li lj lk dt translated">遍历每一行，尝试将CSV解析为一个信号</li><li id="4d9a" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo ms li lj lk dt translated">成功解析数据会将其放入<code class="eh ml mm mn mc b">blips</code>列表，而解析错误会添加到<code class="eh ml mm mn mc b">errors</code>列表。</li><li id="4974" class="lc ld hu it b iu ll iy lm jc ln jg lo jk lp jo ms li lj lk dt translated">发送一条包含信号和任何错误的消息</li></ol><p id="2164" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">解析每个CSV行就像尝试将数据映射到我们之前定义的数据模型一样简单。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff my"><img src="../Images/35612ab70d85bde52ecd26c35badb454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oeYtaI63gpLCIumfE7ZCrA.png"/></div></div></figure><h1 id="3bd6" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">结论</h1><p id="34ee" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">这篇文章越来越长，所以我将通过重写ThoughtWorks Tech Radar中的一些观察来结束这篇文章。</p><p id="04b0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">BYO雷达项目使用<a class="ae jp" href="https://www.npmjs.com/package/chance" rel="noopener ugc nofollow" target="_blank">机会</a>用于<a class="ae jp" href="https://github.com/thoughtworks/build-your-own-radar/blob/0935381d4ea82f69b098afe65e93d248bd69d60d/src/graphing/radar.js#L135-L148" rel="noopener ugc nofollow" target="_blank">随机性</a>，<a class="ae jp" href="https://www.npmjs.com/package/d3" rel="noopener ugc nofollow" target="_blank"> d3 </a>用于图形和HTML模板化，<a class="ae jp" href="https://www.npmjs.com/package/tabletop" rel="noopener ugc nofollow" target="_blank">桌面</a>用于<a class="ae jp" href="https://github.com/thoughtworks/build-your-own-radar/blob/e95bf099d3d1534224de91971b6def5cc315a6bd/src/util/factory.js#L63-L114" rel="noopener ugc nofollow" target="_blank">解析</a> Google Sheets。它使用<a class="ae jp" href="https://github.com/thoughtworks/build-your-own-radar/tree/0935381d4ea82f69b098afe65e93d248bd69d60d/src/models" rel="noopener ugc nofollow" target="_blank">有状态对象实例</a>来建模其数据，并结合了<a class="ae jp" href="https://github.com/thoughtworks/build-your-own-radar/tree/e95bf099d3d1534224de91971b6def5cc315a6bd/src/exceptions" rel="noopener ugc nofollow" target="_blank">异常处理</a>而不是优雅地处理错误。</p><p id="a988" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">最重要的是，在花了这么多时间编写代码之后，我仍然不明白大部分代码是做什么的。</strong>代码相当复杂，即使理解了期望的行为，也很难跟踪实现细节。</p><p id="49e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另一方面，使用Elm的函数式方法产生了具有相似功能的更容易理解的代码。事实上，一旦你掌握了Elm处理随机性和正则表达式的方式，你就会意识到代码也简单多了。</p><p id="d31d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要查看实际的部分重写，请查看以下两个链接:</p><p id="bc2a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="http://ckoster22.github.io/elmradar/" rel="noopener ugc nofollow" target="_blank">http://ckoster22.github.io/elmradar/</a></p><p id="f7d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://github.com/ckoster22/techRadar/tree/blogpost" rel="noopener ugc nofollow" target="_blank">https://github.com/ckoster22/techRadar/tree/blogpost</a></p><div class="kv kw kx ky fq ab cb"><figure class="mz kz na nb nc nd ne paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mz kz na nb nc nd ne paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mz kz na nb nc nd ne paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nf ng nh"><p id="f922" class="ir is kt it b iu iv iw ix iy iz ja jb ni jd je jf nj jh ji jj nk jl jm jn jo hn dt translated">黑客中午是黑客如何开始他们的下午。我们是这个家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is kt it b iu iv iw ix iy iz ja jb ni jd je jf nj jh ji jj nk jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff nl"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="kv kw kx ky fq kz"><div class="bz el l di"><div class="nm lw l"/></div></figure></div></div>    
</body>
</html>