<html>
<head>
<title>Serverless Allergy Checker with Amazon Rekognition, Lex, Polly, DynamoDB, S3 and Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器过敏检查与亚马逊Rekognition，莱克斯，波利，DynamoDB，S3和λ</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/serverless-allergy-checker-with-amazon-rekognition-lex-polly-dynamodb-s3-and-lambda-35fd215b51b0?source=collection_archive---------11-----------------------#2017-10-15">https://medium.com/hackernoon/serverless-allergy-checker-with-amazon-rekognition-lex-polly-dynamodb-s3-and-lambda-35fd215b51b0?source=collection_archive---------11-----------------------#2017-10-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="ad02" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">本帖是我之前的博客</em>  <em class="jp">中</em> <a class="ae jq" href="https://ceyhunozgun.blogspot.com.tr" rel="noopener ugc nofollow" target="_blank"> <em class="jp">关于AWS服务的一系列帖子的一部分。</em></a></p><p id="5849" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们生活在一个软件和移动正在吞噬世界的时代，大公司开始转向人工智能优先。人工智能领域的进步是前所未有的。</p><p id="1b50" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这个快速变化的世界中，我们的责任是提供利用技术帮助人们的解决方案。Pollexy项目是利用技术帮助人们的一个很好的例子。</p><p id="9ad9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">看完那个用例，我一直在思考给<a class="ae jq" href="https://aws.amazon.com/rekognition/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">亚马逊Rekognition </strong> </a>找一个好的用例，这是一个使用深度学习技术的图像识别服务。Amazon Rekognition允许用户检测图片中的对象和场景。它还可以用于索引图像中的人脸和搜索人脸。</p><p id="a1de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的双胞胎喜欢在草地上玩耍，但是他们对草过敏，由于他们的过敏，我们不能花太多时间在草地上玩耍。当我在研究过敏时，我了解到在一些极端的情况下，<a class="ae jq" href="http://www.aaaai.org/about-aaaai/newsroom/allergy-statistics" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">药物过敏可能会引起过敏反应</strong> </a>。这对我打击很大。</p><p id="baf9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我决定使用Amazon Rekognition来保存和检索药物过敏患者的照片。该系统可用于急救服务，以方便快捷地记录和检查患者过敏信息。</p><p id="fcf8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，我已经决定使用Amazon Lex和Polly来允许紧急服务人员通过他们的声音免提使用该应用程序。这样就可以使用像谷歌眼镜这样的可穿戴设备，让人员自由使用双手，用声音记录和搜索患者信息。</p><p id="deee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">申请</strong></p><p id="b14a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该应用程序用于保存患者信息和检查患者信息。该应用程序是一个由静态web文件组成的无服务器应用程序,没有服务器端组件。web应用程序的静态文件托管在S3上，其他功能使用<a class="ae jq" href="https://hackernoon.com/tagged/books" rel="noopener ugc nofollow" target="_blank"> AWS </a>的托管服务实现。使用AWS JavaScript SDK直接从浏览器使用AWS服务。</p><p id="ee22" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用的服务如下:</p><ul class=""><li id="2e58" class="jr js hu it b iu iv iy iz jc jt jg ju jk jv jo jw jx jy jz dt translated"><a class="ae jq" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank">T5【S3】T6</a>用于存储患者的图片和web应用程序的静态文件</li><li id="3b75" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><a class="ae jq" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> DynamoDB </strong> </a>用于存储患者信息，包括姓名、过敏和图片网址</li><li id="4912" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><a class="ae jq" href="https://aws.amazon.com/rekognition/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">识别</strong> </a>用于索引和搜索患者面部</li><li id="1914" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><a class="ae jq" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">λ</strong></a>用于在<a class="ae jq" href="https://hackernoon.com/tagged/dynamedb" rel="noopener ugc nofollow" target="_blank"> DynamoDB </a>中添加患者记录时索引患者面部</li><li id="31a3" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><a class="ae jq" href="https://aws.amazon.com/lex/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> Lex </strong> </a>用于允许用户仅通过语音添加和搜索患者</li><li id="fb98" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><a class="ae jq" href="https://aws.amazon.com/polly/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">波利</strong> </a>用于给用户语音回复</li></ul><p id="e492" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下图显示了记录新患者信息时将使用的保存患者用例的步骤。一旦Lex bot确定了病人的姓名和过敏原，病人的照片就会在浏览器中显示并发送到S3。然后将患者记录插入DynamoDB。DynamoDB触发器获取图片并调用Rekognition来索引患者的面部。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kf"><img src="../Images/5a304d17c74b63fff275fb6298320f6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cI2ka1fEBgxDLaiadpg7Zg.png"/></div></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">Saving patient allergy information use case</figcaption></figure><p id="340b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们想要检查一个病人是否过敏时，我们可以在浏览器中拍摄病人的照片，并在Rekognition人脸集合中搜索病人的人脸。检查用例的步骤如下所示。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kv"><img src="../Images/b831b0707c4ba1d3e2cd1c0dde9ae615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jc983s6m4BXGJz5T8IEWGg.png"/></div></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">Checking patient allergy information use case</figcaption></figure><p id="d6f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">HTML5用户界面和相应的JavaScript代码，用于记录发送给Lex的音频，播放来自Lex的响应和聊天界面，使用来自<strong class="it hv">我的</strong> <a class="ae jq" href="https://ceyhunozgun.blogspot.com.tr/2017/07/nobody-understands-you-theres-app-for-that-with-amazon-lex.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">以前的帖子</strong> </a>，可以在<a class="ae jq" href="https://github.com/ceyhunozgun/cardstore9" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">我的GitHub repo </strong> </a>找到。该应用程序使用Java Spring服务器端处理命令，并使用Java SDK调用AWS服务，但在该应用程序中，所有AWS服务都是使用JavaScript SDK从浏览器调用的。</p><p id="696a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">准备</strong></p><p id="b688" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您应该有一个AWS帐户并<a class="ae jq" href="http://docs.aws.amazon.com/cli/latest/userguide/installing.html" rel="noopener ugc nofollow" target="_blank">安装AWS CLI </a>来创建所需的AWS资源。</p><p id="8f35" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请记住，并非所有地区都支持所有服务。我将使用us-east-1，US East (N. Virginia)地区，因为Amazon Lex目前仅在该地区受支持。</p><p id="6333" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">代码可以在<a class="ae jq" href="https://github.com/ceyhunozgun/serverlessAllergyChecker" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="47d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">注意:</strong>为了简单起见，使用JavaScript SDK访问AWS服务所使用的AWS访问密钥id和秘密密钥放在HTML文件中。在生产中，你绝对应该<strong class="it hv">保密你的AWS凭证</strong>。</p><p id="5726" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">步骤</strong></p><p id="9d56" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.获取代码</p><p id="344a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.创建和配置IAM策略、角色和用户</p><p id="fb64" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.创建Rekognition集合</p><p id="a0cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">4.创建并配置DynamoDB表</p><p id="77a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">5.创建Lambda DynamoDB触发器</p><p id="a45b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">6.创建和配置S3存储桶</p><p id="8f3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">7.创建Lex机器人</p><p id="d595" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">8.修改并检查应用程序</p><p id="bc05" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">9.测试应用程序</p><p id="82c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们开始吧。</p><p id="81cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> 1。</strong> <strong class="it hv">获取代码</strong></p><p id="93f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">克隆自GitHub repo <a class="ae jq" href="https://github.com/ceyhunozgun/serverlessAllergyChecker" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="b3ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> 2。</strong> <strong class="it hv">创建和配置IAM策略、角色和用户</strong></p><p id="736d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了访问AWS服务，我们将创建一个具有访问AWS服务的特定权限的角色，以根据最小特权原则提供最小权限集。请不要使用您的AWS root帐户或拥有更大权限的其他帐户。</p><p id="244e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">AWS CLI命令如下。首先，我们创建一个用户，然后创建一个策略并将该策略附加到新用户。请用您的AWS帐户ID替换<strong class="it hv"> AWS帐户ID </strong>。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kw kx l"/></div></figure><p id="5f03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">创建访问键后，输出将如下所示。<strong class="it hv">记下访问密钥id和秘密密钥</strong>,因为JavaScript SDK将使用这些凭证在浏览器中调用AWS服务。我们将把这些凭证放到HTML文件中。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kw kx l"/></div></figure><p id="ab01" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> 3。</strong> <strong class="it hv">创建认知集合</strong></p><p id="f653" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Rekognition使用人脸集合来存储从图像中提取的人脸信息，并使用该集合来搜索人脸。我们可以使用下面的命令创建集合。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kw kx l"/></div></figure><p id="c64a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> 4。</strong> <strong class="it hv">创建并配置DynamoDB表</strong></p><p id="f39f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将用名为<strong class="it hv"> patientId </strong>的分区键将患者信息存储在<strong class="it hv"> Patient </strong>表中，如下图所示。其他字段有<strong class="it hv">名称</strong>、<strong class="it hv">过敏原</strong>、<strong class="it hv"> imageUrl、</strong>和<strong class="it hv">S3文件</strong>。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff ky"><img src="../Images/043c3de7f01d678c696000a8b1b8ac2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LvmOSGYa8FErUXipYMSwRQ.png"/></div></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">Patient table</figcaption></figure><p id="502f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以创建<strong class="it hv">患者</strong>表，并使用下面的命令在其上启用流。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kw kx l"/></div></figure><p id="0520" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意输出中的<strong class="it hv"> LatestStreamArn </strong>，我们将使用该流作为Lambda触发器的事件源。会像<strong class="it hv">arn:AWS:dynamo db:us-east-1:AWS _ ACCOUNT _ ID:table/Patient/stream/2017–10–09t 19:41:06.419</strong>。</p><p id="1e84" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> 5。</strong>T30】创建Lambda DynamoDB触发器</p><p id="5d9c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">创建了Patient表之后，我们将关联一个Lambda函数，该函数将在向表中添加记录时执行。首先，我们创建一个Lambda执行角色，然后将我们之前创建的策略附加到这个角色。这为Lambda函数提供了调用其他AWS服务所需的权限，在本例中，<em class="jp"> indexFaces </em>方法的<em class="jp"> Rekognition </em>。</p><p id="b607" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请将<strong class="it hv"> AWS_ACCOUNT_ID </strong>替换为您的AWS帐户ID，将<strong class="it hv">PATIENT _ TABLE _ STREAM _ ARN</strong>替换为上一步创建的流ARN。同样将<strong class="it hv">S3 _桶_名称</strong>的值设置为您想要使用的S3桶名称。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kw kx l"/></div></figure><p id="a599" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Lambda函数运行时是<strong class="it hv"> Node.js </strong>，代码在<strong class="it hv">patientfaneindexerlambda . js</strong>文件中。代码如下所示。该代码在加载时创建一个Rekognition对象，并在患者被添加到<strong class="it hv">患者</strong>表时使用该对象来索引面部。患者图片url被放入<strong class="it hv">S3文件</strong>字段。</p><p id="b783" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">代码使用患者图片的S3桶名、我们的面部集合id和作为<strong class="it hv"> ExternalImageId </strong>的<strong class="it hv"> patientId </strong>调用<em class="jp"> indexFaces </em>方法。当我们用一张图片搜索一张人脸时，Rekognition将返回带有这个<strong class="it hv"> ExternalImageId </strong>的匹配人脸，我们可以用这个<strong class="it hv"> patientId </strong>找到其他信息。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kw kx l"/></div></figure><p id="1b8c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> 6。</strong> <strong class="it hv">创建并配置S3桶</strong></p><p id="e402" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将创建一个S3桶来存储病人的照片。通常情况下，我们不需要存储病人的图像来进行搜索，但是为了显示原始图像，当找到匹配的人脸时，我们将存储原始图片。</p><p id="1c16" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们应该<a class="ae jq" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/cors.html" rel="noopener ugc nofollow" target="_blank">启用CORS </a>，这样我们就可以从不同的域上传。为了简单起见，我启用了所有域，但是您应该限制在生产使用中访问bucket的域。CORS设置在<strong class="it hv"> s3-bucket-cors.json </strong>文件中，请相应设置。此外，将<strong class="it hv"> bucketName </strong>替换为您想要使用的名称。</p><p id="895c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上传到S3后，该应用程序将图片标记为<strong class="it hv">公共阅读</strong>，以使它们能够在浏览器中显示。在生产中，由于<strong class="it hv"> </strong> <a class="ae jq" href="https://www.theregister.co.uk/2017/08/22/open_aws_s3_bucket_leaked_hotel_booking_service_data_says_kromtech/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">最近的数据泄露</strong> </a>与<strong class="it hv">错误配置的S3桶</strong>相关，请相应设置桶权限。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kw kx l"/></div></figure><p id="eb77" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> 7。</strong> <strong class="it hv">创建Lex bot </strong></p><p id="960a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在所有资源都准备好了，除了Lex bot。实际上，要使用Rekognition、S3和DynamoDB，我们不需要创建一个机器人，但Lex bot将使用户能够轻松地使用语音系统，同时用手进行其他紧急操作。</p><p id="cfb5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">创建一个名为<strong class="it hv"> AllergyChecker </strong>的Lex bot，它有两个意图，<strong class="it hv"> AddPatient </strong>和<strong class="it hv"> CheckPatient </strong>。有关创建Lex bot的更多信息，您可以查看我在Lex  上的帖子或AWS Lex教程<a class="ae jq" href="http://docs.aws.amazon.com/lex/latest/dg/getting-started-ex2.html" rel="noopener ugc nofollow" target="_blank">练习2:创建自定义亚马逊Lex Bot </a>。</p><p id="bbe5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> AddPatient </strong> intent将用于向系统中添加患者，包括患者姓名和过敏原。该意向将使用<strong class="it hv">患者姓名</strong>和<strong class="it hv">过敏原</strong>插槽。当Lex已经引出槽时，web应用程序将拍摄病人的照片并将该信息保存到<strong class="it hv">病人</strong>表中。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kz"><img src="../Images/55637bd5ad562ca1c50a5d5e5faad8a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JStr9mj26Q7p2j5OEUL6tA.png"/></div></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">AddPatient intent</figcaption></figure><p id="d74a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">患者姓名</strong>槽的槽类型为<strong class="it hv">过敏患者姓名</strong>。我用过内置的亚马逊。人，但我遇到了问题，并创建了一个自定义插槽类型。自定义插槽表现更好。此外，我不得不使用英文名称，因为目前Lex只支持英文。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff la"><img src="../Images/6d565f82fab5789d211b2f89abf50f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*5VPaycUhr6X92aq5oaP3SQ.png"/></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">AllergicPersonName custom slot type</figcaption></figure><p id="a4b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另外，<strong class="it hv">过敏原</strong>槽使用了名为<strong class="it hv">过敏原</strong>的自定义槽。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff lb"><img src="../Images/20f3baf85677edefd2be49b5a9464180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*JKhaN6FTOPl9x0vETgO0xg.png"/></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">Allergen custom slot type</figcaption></figure><p id="8fa4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">检查患者</strong>意图将用于通过拍照来检查患者。此意图没有槽。当这一意图准备好实现时，网络应用程序将拍摄患者的照片，并调用<em class="jp"> Rekognition </em>来查找具有匹配面部的患者。如果找到患者，过敏原信息将与原始患者照片一起显示。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff lc"><img src="../Images/3fe713797c7294f987e5a996cce8488b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6mm1RN2PUc9wfZhe0bVCbw.png"/></div></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">CheckPatient intent</figcaption></figure><p id="6fc0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">8。 <strong class="it hv">修改和审核申请</strong></p><p id="b8d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在所有的AWS资源都准备好了。我们准备修改我们的应用程序。</p><p id="ec19" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在index.html中替换如下所示的配置变量。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kw kx l"/></div></figure><p id="bfea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们之前创建的<strong class="it hv">patient face indexer</strong>Lambda方法中实现了将患者添加到<em class="jp">recognition</em>face集合中。</p><p id="f0d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<strong class="it hv">index.html</strong>中的<strong class="it hv">检查病人</strong>方法中，使用<em class="jp">重新识别</em>检查病人。<strong class="it hv">使用面部集合id、图像和面部匹配阈值调用searchFacesByImage </strong>方法。我们希望<em class="jp">重新识别</em>返回匹配置信度大于80% 的人脸。如果找到匹配项，<strong class="it hv">handlecheckpatientorresponse</strong>方法显示患者姓名、过敏原和患者照片。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="kw kx l"/></div></figure><p id="ff62" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> 9。</strong> <strong class="it hv">测试应用程序</strong></p><p id="3e2a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在浏览器中打开<strong class="it hv">index.html</strong>。您应该使用兼容WebRTC的浏览器来录制音频和视频。你可以点击查看你的浏览器<a class="ae jq" href="http://iswebrtcreadyyet.com/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="5a93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">应用程序加载后，您可以说“<strong class="it hv">添加</strong>或“<strong class="it hv">检查</strong>”来使用应用程序，如下图所示。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="ld kx l"/></div></figure><p id="3483" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">接下来的步骤</strong></p><p id="eb1d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我想提醒你删除你为这篇文章创建的资源。请对您创建的资源的安全性非常严格。</p><p id="ced3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经完成了web应用程序中的意图。在实际应用中，Lambda函数可用于插槽验证和实现。</p><p id="e033" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">同样为了简单起见，音频被记录4秒，如果所有记录的数据都是无声的，则音频不被发送到Lex。在实际应用中，我们可以创建一个<code class="eh le lf lg lh b"><strong class="it hv">ScriptProcessorNode</strong></code>来实时分析记录的音频数据，如果在特定的持续时间内检测到静音，则停止记录。更多信息，请参见<a class="ae jq" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API" rel="noopener ugc nofollow" target="_blank">网络音频API文档</a>。</p><p id="5509" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了简单起见，我没有使用用户认证和授权机制，但在生产使用中，您绝对应该使用类似于<a class="ae jq" href="http://docs.aws.amazon.com/cognito/latest/developerguide/using-amazon-cognito-user-identity-pools-javascript-examples.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">亚马逊认知</strong> </a>的机制来提供安全性。通过这种方式，您可以保持AWS访问密钥和秘密密钥的私密性，而不用将凭证放在JS或HTML文件中。</p><p id="7b34" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">目前，Lex只支持英语语音命令。希望它能支持其他语言和地区。</p><p id="c786" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">总结</strong></p><p id="fd32" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这篇文章中，我开发了一个过敏检查器应用程序，它使用<strong class="it hv"> Amazon Rekognition </strong>来保存和查找患者面部的过敏信息。此外，我还展示了使用<strong class="it hv"> Amazon Lex </strong>和<strong class="it hv"> Amazon Polly </strong>接受语音命令并以自然语言给出响应。</p><p id="f336" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经用<a class="ae jq" href="https://aws.amazon.com/sdk-for-browser/" rel="noopener ugc nofollow" target="_blank"> AWS JavaScript SDK </a>调用AWS服务。</p><p id="e07b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里的 可以找到<a class="ae jq" href="https://github.com/ceyhunozgun/serverlessAllergyChecker" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">的代码。</strong></a></p><p id="c499" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有关AWS服务的更多信息，您可以查看我的帖子:</p><ul class=""><li id="d9a1" class="jr js hu it b iu iv iy iz jc jt jg ju jk jv jo jw jx jy jz dt translated"><a class="ae jq" href="https://ceyhunozgun.blogspot.com.tr/2017/04/uploading-images-to-amazon-s3-directly.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">直接从浏览器上传图片到亚马逊S3使用S3直接上传</strong> </a></li><li id="5859" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><a class="ae jq" href="https://ceyhunozgun.blogspot.com.tr/2017/04/implementing-object-persistence-with-dynamodb.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">用Amazon DynamoDB </strong> </a>为我们的数字卡实现对象持久性</li><li id="f56d" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><a class="ae jq" href="https://ceyhunozgun.blogspot.com.tr/2017/05/serverless-user-activation-mechanism-with-aws-lambda-step-functions-and-dynamodb-triggers.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">具有亚马逊Lambda、亚马逊Step函数和DynamoDB触发器的无服务器用户激活机制</strong> </a></li><li id="7712" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><a class="ae jq" href="https://ceyhunozgun.blogspot.com.tr/2017/07/nobody-understands-you-theres-app-for-that-with-amazon-lex.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">没人懂你？亚马逊Lex </strong> </a>有一个应用程序可以做到这一点</li><li id="61b3" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><a class="ae jq" href="https://ceyhunozgun.blogspot.com.tr/2017/05/look-whos-talking-creating-web-application-that-talks-with-amazon-polly.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">看谁在说话！。创建一个与Amazon Polly </strong> </a>对话的Web应用程序</li><li id="66b6" class="jr js hu it b iu ka iy kb jc kc jg kd jk ke jo jw jx jy jz dt translated"><a class="ae jq" href="https://ceyhunozgun.blogspot.com.tr/2017/04/storing-user-sessions-in-redis-using-elasticache.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">使用Amazon ElastiCache在Redis中存储用户会话</strong> </a></li></ul><p id="2aac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我想听听您对<em class="jp">重新识别</em>的应用和不同用例的意见。</p><p id="653c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你喜欢这篇文章，请分享，喜欢或关注。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="li kx l"/></div></figure></div></div>    
</body>
</html>