<html>
<head>
<title>Tips for Writing Cleaner Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写更简洁代码的技巧</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/tips-for-writing-cleaner-better-code-e36ffeb55526?source=collection_archive---------9-----------------------#2017-06-29">https://medium.com/hackernoon/tips-for-writing-cleaner-better-code-e36ffeb55526?source=collection_archive---------9-----------------------#2017-06-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/b27924fe12f3d7485a9db9e775831a5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cmqZiJz1TuUedRoeI3g_Iw.jpeg"/></div></div></figure><p id="ae7a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我决定写一篇文章，这将有助于初学者了解他们的错误，并把一些做法。</p><p id="1cab" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当然，这样的例子非常多，所以我只举几个。</p><h2 id="1e36" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">1.常数</h2><p id="8d63" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">这个问题不仅关系到javascript的<a class="ae la" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"/>，也关系到一般的<a class="ae la" href="https://hackernoon.com/tagged/programming" rel="noopener ugc nofollow" target="_blank">编程的</a>。考虑一个例子:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="5bd9" class="ka kb hu lg b fv lk ll l lm ln">$elem.on('keydown', <strong class="lg hv">function</strong>(e) {<br/>  <strong class="lg hv">if</strong> (e.keyCode == 27) {<br/>    <em class="lo">//...<br/>  </em>}<br/>});</span></pre><p id="5936" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">神奇的数字27是什么？经常编码的人会注意到——这是ESC键。但大多数开发者，尤其是初学者，要么不记得这些代码，要么根本不知道，面对代码时，被迫再次爬进搜索系统，浪费时间。<br/>当然你可以在代码中添加注释，但是输入一个常量会更有效，例如:KEY_ESC = 27</p><h2 id="78fd" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">2.<strong class="ak">标识符</strong></h2><p id="673d" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">通常我们需要获得一个元素的标识符(评论、帖子、用户等)。)来执行一些操作(例如，使用ajax评估注释),通常可以找到这种方法:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="9c5b" class="ka kb hu lg b fv lk ll l lm ln"><strong class="lg hv">var</strong> id = $(<strong class="lg hv">this</strong>).attr('id').substring(8);</span></pre><p id="cad3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">和前面的例子一样，开发人员必须猜测这个数字8是什么。</p><p id="c7b8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">再比如(这行是从一个真实的项目里抄来的):</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="2ff7" class="ka kb hu lg b fv lk ll l lm ln"><strong class="lg hv">var</strong> last_id = $('#answer_pid' + id + ' li:first div').attr('id').substr(7);</span></pre><p id="ae64" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">html布局中最微小的变化都会破坏代码。</p><p id="bc47" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">好吧，还有一个:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="e476" class="ka kb hu lg b fv lk ll l lm ln">&lt;div class="comment" id="comment_123"&gt;&lt;/div&gt;</span><span id="a710" class="ka kb hu lg b fv lp ll l lm ln"><strong class="lg hv">var</strong> id = $(<strong class="lg hv">this</strong>).attr('id').substring("comment_".length);</span></pre><p id="6e63" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这更好(至少没有有线数字)，但是这种方法仍然将js代码过多地绑定到html上。</p><p id="c3eb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们可以使用"<strong class="je hv">数据-* </strong>"参数:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="28f9" class="ka kb hu lg b fv lk ll l lm ln">&lt;div class="comment" data-id="123"&gt;&lt;/div&gt;</span></pre><p id="af11" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在获取标识符要容易得多:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="89a2" class="ka kb hu lg b fv lk ll l lm ln"><strong class="lg hv">var</strong> id = $(<strong class="lg hv">this</strong>).attr('data-id');</span></pre><p id="e6f2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">或者</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="8c3c" class="ka kb hu lg b fv lk ll l lm ln"><strong class="lg hv">var</strong> id = $(<strong class="lg hv">this</strong>).data('id');</span></pre><h2 id="0d21" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">3.$.邮政</h2><p id="238e" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">我们都知道一种使用ajax的jQuery方法— $ .ajax。得到，$。负载，美元。帖子等。</p><p id="bf4f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">添加这些函数是为了方便频繁执行的操作(上传脚本、json、执行post请求)，但是在实现中，所有这些方法都引用$ .ajax。</p><p id="1232" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我个人从不使用速记功能，这就是原因。</p><p id="6ad5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在初学者或没有经验的代码中，您可以找到几个不同的阶段:</p><p id="4479" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">a.开始</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="540e" class="ka kb hu lg b fv lk ll l lm ln">$.post(url, data, <strong class="lg hv">function</strong>(data) {<br/>  data = $.parseJSON(data);             <br/>  <em class="lo">//...<br/></em>});</span></pre><p id="5915" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">b.添加“尝试-捕捉”块</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="255c" class="ka kb hu lg b fv lk ll l lm ln">$.post(url, data, <strong class="lg hv">function</strong>(data) {<br/>  <strong class="lg hv">try</strong> {<br/>      data = $.parseJSON(data);<br/>  } <strong class="lg hv">catch</strong> (e) {<br/>      <strong class="lg hv">return</strong>;<br/>  }<br/>  <em class="lo">//...</em> <br/>});</span></pre><p id="0bb1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">c.我们从文档中了解到，在<strong class="je hv"> $。post </strong>最后一个参数可以传递给dataType(如果success函数不适合屏幕，它会在大量代码中消失)。</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="88f6" class="ka kb hu lg b fv lk ll l lm ln">$.post(url, data, <strong class="lg hv">function</strong>(data) {<br/>  <em class="lo">//...<br/></em>}, 'json');</span></pre><p id="1a0a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我很少能在初学者项目中看到错误处理程序，这主要是由于懒惰和不愿意花费额外的5分钟时间，或者开发人员只是确定不会有错误。</p><p id="3ce7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果开发人员决定向$添加一个错误处理程序。帖子，通常是这样的:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="bfc6" class="ka kb hu lg b fv lk ll l lm ln">$.post(url, data, <strong class="lg hv">function</strong>(data) {<br/>  <em class="lo">//...<br/></em>}, 'json').error(<strong class="lg hv">function</strong>() {<br/>  <em class="lo">//...</em> <br/>});</span></pre><p id="f179" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这真的很难读。每次都编写一个错误处理程序是一项繁琐的任务，因此您可以为所有ajax请求设置一个默认的错误处理程序，例如:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="ad8e" class="ka kb hu lg b fv lk ll l lm ln">$.ajaxSetup({<br/>  error: <strong class="lg hv">function</strong>() {<br/>    <em class="lo">// Error modal<br/>  </em>} <br/>});</span></pre><p id="ed2d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们回到$ .post .如上图所示，使用$。post使得代码看起来很糟糕(尤其是数据类型在不可理解的地方)。让我们用$ .ajax重写最后一个例子。</p><p id="d63e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在我看来，这种方法可读性更强，也更容易维护。</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="0886" class="ka kb hu lg b fv lk ll l lm ln">$.ajax({<br/>  type: "POST",<br/>  url: url,<br/>  data: data,<br/>  dataType: "json",<br/>  success: <strong class="lg hv">function</strong>(data) {<br/>    <em class="lo">//...</em><br/>  },<br/>  error: <strong class="lg hv">function</strong>() {<br/>    <em class="lo">//...<br/>  </em>}<br/>});</span></pre><h2 id="f65c" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">4.多个元素的事件处理程序</h2><p id="06da" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">有时有必要向页面元素添加事件处理程序(例如，“删除消息”按钮)。你经常会遇到这种方法:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="eba0" class="ka kb hu lg b fv lk ll l lm ln">$('.comment a.delete').click(<strong class="lg hv">function</strong>(){<br/>  <em class="lo">//...<br/></em>});</span></pre><p id="a6b4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在的问题是向新元素添加相同的处理程序(例如，向动态加载的注释)。我看到了很多解决方案，包括再次重新定义所有的处理程序:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="b9a0" class="ka kb hu lg b fv lk ll l lm ln">$('.comment a.delete').unbind('click').click(<strong class="lg hv">function</strong>() {<br/>  <em class="lo">//<br/></em>});</span></pre><p id="c867" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">jQuery 1.7中有一个名为“<a class="ae la" href="https://www.w3schools.com/jquery/event_on.asp" rel="noopener ugc nofollow" target="_blank"> on </a>”的方法，它绑定事件处理程序，通过选择器过滤元素。</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="c4bb" class="ka kb hu lg b fv lk ll l lm ln">$('body').on('click', 'a.external', <strong class="lg hv">function</strong>(e) {  <br/>  <em class="lo">// </em>The function will be called when you click on any link with the external class<br/>});</span></pre><p id="1560" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">重要的是要记住，这个处理程序也适用于动态创建的对象。应该明智地应用这种方法。例如，以下代码可能会导致浏览器的性能下降和速度变慢:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="ffcd" class="ka kb hu lg b fv lk ll l lm ln">$('body').on('mousemove', selector, <strong class="lg hv">function</strong>() {<br/>  <em class="lo">//...<br/></em>});</span></pre><h2 id="d9f4" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">5.命名空间事件</h2><p id="70b7" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">事实上，命名空间事件被添加到jQuery 1.2中——很少有人使用它(我想大多数人只是不知道它们)。</p><p id="4061" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">例如，我们有这样的代码:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="c8ce" class="ka kb hu lg b fv lk ll l lm ln">$('a').on('click', <strong class="lg hv">function</strong>() {<br/>  <em class="lo">// Handler 1<br/></em>}); </span><span id="f507" class="ka kb hu lg b fv lp ll l lm ln">$('a').on('click', <strong class="lg hv">function</strong>() {<br/>  <em class="lo">// Handler 2<br/></em>});</span></pre><p id="7023" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">例如，现在我们需要从链接中删除第二个处理程序。但是<strong class="je hv">$(‘一’)。off('click') </strong>将删除两个处理程序。</p><p id="d34f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们使用命名空间事件:</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="4ff1" class="ka kb hu lg b fv lk ll l lm ln">$('a').on('click.namespace1', <strong class="lg hv">function</strong>() {<br/>  <em class="lo">//Handler 1<br/></em>}); <br/>$('a').on('click.namespace2', <strong class="lg hv">function</strong>() {<br/>  <em class="lo">//Handler 2<br/></em>});</span></pre><p id="edff" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在可以通过调用</p><pre class="lb lc ld le fq lf lg lh li aw lj dt"><span id="bb3e" class="ka kb hu lg b fv lk ll l lm ln">$('a').off('click.namespace2');</span></pre><p id="8113" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">更多关于命名空间事件的信息可以在<a class="ae la" href="http://api.jquery.com/on/#event-names" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl lq lr hc ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hn ho hp hq hr"><p id="382b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这只是我在别人的代码中经常遇到的问题的一小部分。我希望这篇文章有助于提高代码的质量。</p><h2 id="ccd0" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">❤如果这篇文章有帮助，请点击小心脏！(在推特<a class="ae la" href="https://twitter.com/alik_chebotar" rel="noopener ugc nofollow" target="_blank">上关注我</a></h2><div class="lb lc ld le fq ab cb"><figure class="lx iv ly lz ma mb mc paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lx iv ly lz ma mb mc paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lx iv ly lz ma mb mc paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="md me mf"><p id="f922" class="jc jd lo je b jf jg jh ji jj jk jl jm mg jo jp jq mh js jt ju mi jw jx jy jz hn dt translated"><a class="ae la" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae la" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae la" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae la" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd lo je b jf jg jh ji jj jk jl jm mg jo jp jq mh js jt ju mi jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae la" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae la" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lb lc ld le fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mj"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="lb lc ld le fq iv"><div class="bz el l di"><div class="mk ml l"/></div></figure></div></div>    
</body>
</html>