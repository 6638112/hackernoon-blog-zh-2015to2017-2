<html>
<head>
<title>Assert Process was executed — Laravel 5.5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">断言流程已执行— Laravel 5.5</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/assert-process-was-executed-laravel-5-5-72228a8f6322?source=collection_archive---------10-----------------------#2017-09-21">https://medium.com/hackernoon/assert-process-was-executed-laravel-5-5-72228a8f6322?source=collection_archive---------10-----------------------#2017-09-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/></div><div class="ab cl ir is hc it" role="separator"><span class="iu bw bk iv iw ix"/><span class="iu bw bk iv iw ix"/><span class="iu bw bk iv iw"/></div><div class="hn ho hp hq hr"><figure class="iz ja jb jc fq jd fe ff paragraph-image"><div class="fe ff iy"><img src="../Images/9cc0c7de64b1a9e2260110aca1c8923f.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*F61kWAZr_-0s1qOKxTUuBw.png"/></div></figure><p id="3810" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我最近开始从事一个项目，这个项目非常依赖于在终端上运行命令。它很快妨碍了我进行TDD，所以我不得不实现某种过程Fake。这篇文章讲述了这有多简单。</p><h2 id="fc57" class="ke kf hu bd kg kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky dt translated">背景</h2><p id="d5ca" class="pw-post-body-paragraph jg jh hu ji b jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz ld kb kc kd hn dt translated">我用来写一个<code class="eh le lf lg lh b">Process::fake()</code>的心理过程是基于<code class="eh le lf lg lh b">Mail::fake()</code>、<code class="eh le lf lg lh b">Storage::fake()</code>和<code class="eh le lf lg lh b">Queue::fake()</code>的相同逻辑。它基本上是你的系统和一些外部服务之间的桥梁。</p><h2 id="a365" class="ke kf hu bd kg kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky dt translated">1-流程外观</h2><p id="250d" class="pw-post-body-paragraph jg jh hu ji b jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz ld kb kc kd hn dt translated">流程外观非常简单:它执行一个流程。这是Symfony流程的简单包装。</p><figure class="iz ja jb jc fq jd"><div class="bz el l di"><div class="lj lk l"/></div></figure><h2 id="f53f" class="ke kf hu bd kg kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky dt translated">2-TDD示例</h2><p id="0dff" class="pw-post-body-paragraph jg jh hu ji b jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz ld kb kc kd hn dt translated">假设我们想写一个<code class="eh le lf lg lh b">WebServerController</code>,公开重启Web服务器的能力。遵循TDD方法，我想编写一个如下所示的测试:</p><figure class="iz ja jb jc fq jd"><div class="bz el l di"><div class="lj lk l"/></div></figure><p id="ac9c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">为了通过测试，我们需要编写<code class="eh le lf lg lh b">ProcessFake</code>类以及<code class="eh le lf lg lh b">Controller</code>的实际实现。</p><h2 id="5fc7" class="ke kf hu bd kg kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky dt translated">3-web服务器控制器</h2><p id="1c26" class="pw-post-body-paragraph jg jh hu ji b jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz ld kb kc kd hn dt translated">特别注意<code class="eh le lf lg lh b">use Facades\App\Process</code>。这是一个实时的门面。这意味着Laravel将动态地为这个类生成一个Facade。你可以在这里了解更多信息<a class="ae ll" rel="noopener" href="/@taylorotwell/expressive-code-real-time-facades-41c442914291">。</a></p><figure class="iz ja jb jc fq jd"><div class="bz el l di"><div class="lj lk l"/></div></figure><h2 id="699c" class="ke kf hu bd kg kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky dt translated">ProcessFake类</h2><p id="94ba" class="pw-post-body-paragraph jg jh hu ji b jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz ld kb kc kd hn dt translated">为了完成(2)中要求的细节，一个能够断言命令已执行的<code class="eh le lf lg lh b">ProcessFake</code>工具。</p><figure class="iz ja jb jc fq jd"><div class="bz el l di"><div class="lj lk l"/></div></figure><p id="16b9" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">运行测试之前，不要忘记注册路线:</p><pre class="iz ja jb jc fq lm lh ln lo aw lp dt"><span id="297f" class="ke kf hu lh b fv lq lr l ls lt">Route::post('/webserver/restart', 'WebServerController@restart');</span></pre><h2 id="ef36" class="ke kf hu bd kg kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky dt translated">4-结论</h2><p id="a13d" class="pw-post-body-paragraph jg jh hu ji b jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz ld kb kc kd hn dt translated">总的来说，一个非常简单的Symfony Process包装器将允许我们执行应用程序提供的命令。因为我们使用的是实时Facade，所以我们可以用一个<code class="eh le lf lg lh b">Fake</code>来交换我们的特性测试的实现。</p><p id="0bd4" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">有人可能会问:什么能保证<code class="eh le lf lg lh b">Process</code>的外观真的能工作？一个测试覆盖报告可以告诉你实际的<code class="eh le lf lg lh b">Process</code>实现没有覆盖。一个解决方案是编写一个简单的集成测试。</p><h2 id="40d4" class="ke kf hu bd kg kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky dt translated">5-[奖金]集成测试</h2><p id="e6be" class="pw-post-body-paragraph jg jh hu ji b jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz ld kb kc kd hn dt translated">对于集成测试，我们可以编写一个简单的<code class="eh le lf lg lh b">bash</code>脚本，它可以在任何持续集成平台(比如TravisCI)中执行。为此，我们为bash文件提供了测试，并编写了运行它的测试。</p><figure class="iz ja jb jc fq jd"><div class="bz el l di"><div class="lj lk l"/></div></figure><p id="abd1" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">和简单的bash脚本</p><pre class="iz ja jb jc fq lm lh ln lo aw lp dt"><span id="f52f" class="ke kf hu lh b fv lq lr l ls lt">#!/bin/bash<br/>echo 'process output'</span></pre><p id="942d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">对于Travis，向脚本添加执行权限:</p><pre class="iz ja jb jc fq lm lh ln lo aw lp dt"><span id="c61f" class="ke kf hu lh b fv lq lr l ls lt"><strong class="lh hv">script: </strong>chmod a+x ./tests/Integration/process.sh &amp;&amp; vendor/bin/phpunit --verbose</span></pre><p id="b398" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">搞定了。</p><p id="9a3d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">欢迎在Medium上关注我，获取更多类似本文的文章。</p></div></div>    
</body>
</html>