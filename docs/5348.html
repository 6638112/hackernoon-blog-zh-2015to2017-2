<html>
<head>
<title>Data Interceptor for your views — Laravel 5.5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">视图的数据拦截器— Laravel 5.5</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/data-interceptor-for-your-views-laravel-5-5-c973a96bb45a?source=collection_archive---------14-----------------------#2017-07-21">https://medium.com/hackernoon/data-interceptor-for-your-views-laravel-5-5-c973a96bb45a?source=collection_archive---------14-----------------------#2017-07-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/534006b166d6240d0a64568a53bfe828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*1FYlXjiCASd691FfTL_zLg.png"/></div></figure><p id="8dfd" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">几天前，我在Laravel Internals上看到一条来自Colin Viebrock的消息，询问如何拦截从控制器传到视图的数据。我是这样做的。</p><h2 id="efc8" class="jy jz hu bd ka kb kc kd ke kf kg kh ki jj kj kk kl jn km kn ko jr kp kq kr ks dt translated">1-扩展视图服务提供者</h2><p id="1680" class="pw-post-body-paragraph iy iz hu ja b jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr kx jt ju jv hn dt translated">使用artisan我们可以<code class="eh ky kz la lb b">php artisan make:provider ViewServiceProvider</code>让我们开始。在新的服务提供者中，我们将扩展默认的服务提供者，并简单地覆盖方法<code class="eh ky kz la lb b">createFactory</code></p><pre class="lc ld le lf fq lg lb lh li aw lj dt"><span id="a57a" class="jy jz hu lb b fv lk ll l lm ln"><strong class="lb hv">&lt;?php<br/><br/>namespace </strong>App\Providers;<br/><br/><strong class="lb hv">use </strong>App\Support\View\MyViewFactory;<br/><strong class="lb hv">use </strong>Illuminate\View\ViewServiceProvider <strong class="lb hv">as </strong>BaseViewServiceProvider;<br/><br/><strong class="lb hv">class </strong>ViewServiceProvider <strong class="lb hv">extends </strong>BaseViewServiceProvider<br/>{<br/>    <strong class="lb hv">protected function </strong>createFactory($resolver, $finder, $events)<br/>    {<br/>        <strong class="lb hv">return new </strong>MyViewFactory($resolver, $finder, $events);<br/>    }<br/>}</span></pre><h2 id="110d" class="jy jz hu bd ka kb kc kd ke kf kg kh ki jj kj kk kl jn km kn ko jr kp kq kr ks dt translated">2-不要忘记交换服务提供商设置</h2><p id="a19f" class="pw-post-body-paragraph iy iz hu ja b jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr kx jt ju jv hn dt translated">在<strong class="ja hv">application/config/app . PHP</strong>中有一个将启动的提供者列表。让我们删除默认的<code class="eh ky kz la lb b">Illuminate</code>，用我们在第一步中创建的来替换它。应该是<code class="eh ky kz la lb b">\App\Providers\ViewServiceProvider</code>。</p><h2 id="6e9b" class="jy jz hu bd ka kb kc kd ke kf kg kh ki jj kj kk kl jn km kn ko jr kp kq kr ks dt translated">3-创建自定义视图工厂</h2><p id="129e" class="pw-post-body-paragraph iy iz hu ja b jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr kx jt ju jv hn dt translated">我决定在<strong class="ja hv">应用程序/应用程序/支持/视图</strong>中创建我的，如下所示:</p><pre class="lc ld le lf fq lg lb lh li aw lj dt"><span id="bf6d" class="jy jz hu lb b fv lk ll l lm ln"><strong class="lb hv">&lt;?php<br/><br/>namespace </strong>App\Support\View;<br/><br/><strong class="lb hv">use </strong>Illuminate\View\Factory;<br/><br/><strong class="lb hv">class </strong>MyViewFactory <strong class="lb hv">extends </strong>Factory<br/>{<br/>    <strong class="lb hv">protected function </strong>viewInstance($view, $path, $data)<br/>    {<br/>        <strong class="lb hv">return new </strong>MyView($this, $this-&gt;getEngineFromPath($path), $view, $path, $data);<br/>    }<br/>}</span></pre><h2 id="768c" class="jy jz hu bd ka kb kc kd ke kf kg kh ki jj kj kk kl jn km kn ko jr kp kq kr ks dt translated">4-在您的自定义视图中实现数据拦截</h2><p id="416a" class="pw-post-body-paragraph iy iz hu ja b jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr kx jt ju jv hn dt translated">在向视图提供数据之前，将调用<code class="eh ky kz la lb b">gatherData</code>方法。这是截取所有数据的最佳位置。</p><pre class="lc ld le lf fq lg lb lh li aw lj dt"><span id="2a56" class="jy jz hu lb b fv lk ll l lm ln"><strong class="lb hv">&lt;?php<br/><br/>namespace </strong>App\Support\View;<br/><br/><strong class="lb hv">use </strong>Illuminate\View\View;<br/><br/><strong class="lb hv">class </strong>MyView <strong class="lb hv">extends </strong>View<br/>{<br/>    <strong class="lb hv">protected function </strong>gatherData()<br/>    {<br/>        $data = <strong class="lb hv">parent</strong>::<em class="lo">gatherData</em>();<br/><br/>        <strong class="lb hv">return </strong>array_merge($data, ['intercepted' =&gt; <strong class="lb hv">true</strong>]);<br/>    }<br/>}</span></pre><h2 id="7ca7" class="jy jz hu bd ka kb kc kd ke kf kg kh ki jj kj kk kl jn km kn ko jr kp kq kr ks dt translated">5-看结果！</h2><p id="1a36" class="pw-post-body-paragraph iy iz hu ja b jb kt jd je jf ku jh ji jj kv jl jm jn kw jp jq jr kx jt ju jv hn dt translated">现在只需打开<code class="eh ky kz la lb b">welcome.blade.php</code>文件，并添加一个允许您测试拦截的代码片段:</p><pre class="lc ld le lf fq lg lb lh li aw lj dt"><span id="f3fd" class="jy jz hu lb b fv lk ll l lm ln"><strong class="lb hv">@if(</strong>$intercepted<strong class="lb hv">)<br/>    </strong>&lt;h1&gt;INTERCEPTED!&lt;/h1&gt;<br/><strong class="lb hv">@endif</strong></span></pre><p id="29d9" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">一旦你打开页面，你就能看到它。</p><figure class="lc ld le lf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="fe ff lp"><img src="../Images/678baeffb916d79a5f0c3d175446d4f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ziWSJeKejvO7iLSK9HMCw.png"/></div></div></figure></div></div>    
</body>
</html>