<html>
<head>
<title>consul2dogstats, with Dimensional Tagging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">consul2dogstats，带维度标记</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/consul2dogstats-with-dimensional-tagging-b55ade84e654?source=collection_archive---------14-----------------------#2017-05-05">https://medium.com/hackernoon/consul2dogstats-with-dimensional-tagging-b55ade84e654?source=collection_archive---------14-----------------------#2017-05-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="aaee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你同时使用Consul和Datadog，你会想要这个。</p><p id="cf9c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我写了一个小的<a class="ae jq" href="https://hackernoon.com/tagged/program" rel="noopener ugc nofollow" target="_blank">程序</a>，它维护一个名为<a class="ae jq" href="https://github.com/zendesk/consul2dogstats" rel="noopener ugc nofollow" target="_blank"> consul2dogstats </a>的数据中心咨询服务计数列表。它定期轮询Consul服务目录和健康端点以收集清单，然后将结果发布给<a class="ae jq" href="https://hackernoon.com/tagged/datadog" rel="noopener ugc nofollow" target="_blank"> Datadog </a>。这是Apache 2.0许可的。</p><h1 id="44f1" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">关于维度标记的一个旁白</h1><p id="b3d9" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">Datadog最强大的功能之一是<em class="jp">维度标签</em>。简而言之，维度标签是键值对，您可以将其附加到时间序列指标上，以便进行查询和聚合。</p><p id="67e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">假设您想要跟踪组织中web服务器的请求率。让我们称度量的名称为<code class="eh ku kv kw kx b">http_requests</code>。我们可以应用的一些有用的标签是:</p><ul class=""><li id="1500" class="ky kz hu it b iu iv iy iz jc la jg lb jk lc jo ld le lf lg dt translated">服务器主机(如<code class="eh ku kv kw kx b">app1</code>、<code class="eh ku kv kw kx b">ip-1-2-3-4</code>)</li><li id="b64e" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">网络服务(如<code class="eh ku kv kw kx b">frontend</code>、<code class="eh ku kv kw kx b">api</code>、<code class="eh ku kv kw kx b">gatekeeper</code>)</li><li id="e97b" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">环境(如<code class="eh ku kv kw kx b">production</code>、<code class="eh ku kv kw kx b">test</code>)</li><li id="9ed4" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">响应代码范围(如<code class="eh ku kv kw kx b">2xx</code>、<code class="eh ku kv kw kx b">3xx</code>、<code class="eh ku kv kw kx b">4xx</code>、<code class="eh ku kv kw kx b">5xx</code>)</li></ul><p id="ddb8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Datadog中，你可以给它们分配一个<em class="jp">维度键</em>。在上面的例子中，这些可能是<code class="eh ku kv kw kx b">hostname</code>、<code class="eh ku kv kw kx b">http_host</code>、<code class="eh ku kv kw kx b">env</code>和<code class="eh ku kv kw kx b">http_response_type</code>。</p><p id="6871" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你开始标记指标，聚集和过滤它们就是小菜一碟。您可以执行强大的查询来回答<em class="jp">实时</em>中的问题，例如:</p><ul class=""><li id="dbb0" class="ky kz hu it b iu iv iy iz jc la jg lb jk lc jo ld le lf lg dt translated">在整个生产过程中，我每分钟收到多少<code class="eh ku kv kw kx b">5xx</code>回复？</li><li id="0b56" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">在我的生产环境中，我每分钟为<code class="eh ku kv kw kx b">gatekeeper</code> web服务发送多少<code class="eh ku kv kw kx b">2xx</code>响应？</li></ul><p id="21e6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">与除了服务器主机之外没有其他维度的旧解决方案相比，这在功能和灵活性方面是一个巨大的飞跃(服务器主机本身在云环境中是一个越来越没用的维度，因为主机现在通常是短暂的，它们的规范名称毫无意义)。</p><p id="0389" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">考虑传统的点分隔形式的指标名称，如<code class="eh ku kv kw kx b">requests.production.frontend.2xx</code>或<code class="eh ku kv kw kx b">requests.test.gatekeeper.4xx</code>。这些给分析师带来了一些重大挑战。</p><p id="7292" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，选择要查询的指标是一个<em class="jp"> O(n) </em>操作，因为指标名称是不透明的(系统不知道您选择的命名结构的语义)。如果您正在收集大量的指标(您应该这样做！)，那可是一个<em class="jp">非常</em>昂贵的操作。</p><p id="8c40" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第二，添加新的维度是一场管理噩梦，因为如果您想要添加维度，您必须创建一个新的度量标准。假设我们想在上面的指标中增加一个像<code class="eh ku kv kw kx b">shard</code>这样的新维度。在支持开箱即用的维度标记的系统中，这没有问题:任何以前的图形都将像以前一样继续呈现。但是如果你使用平面指标，你将开始创建新的指标，比如<code class="eh ku kv kw kx b">requests.production.frontend.shard42.2xx</code>和<code class="eh ku kv kw kx b">requests.tests.gatekeeper.shard1.4xx</code>。一旦您用新的指标替换旧的指标，以前的指标数据的历史将会结束，这将产生一个不连续性，使执行时态分析更具挑战性。(当然，您可以继续以旧的名称提交指标，同时提交新的、更细粒度的指标。但是您将会重复计算，这可能会导致分析错误，并且向系统提交比需要的更多的指标，这可能会导致容量问题。)</p><p id="f656" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好消息是，即使你更喜欢自己管理指标，而不是使用SaaS提供商如Datadog，现在也有支持维度标记的开源指标系统。没有必要再忍受扁平的度量标准了。</p><h1 id="7867" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">维度反模式</h1><p id="6867" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">通常，运营指标系统旨在显示您的系统和应用程序的实时状态和运行状况。为了保持良好的性能，重要的是不要使公制尺寸<em class="jp">过于精细。<strong class="it hv">一个好的经验法则是确保特定键的可能值少于您拥有的服务器数量。</strong>因此，按环境、主机名或功能标记指标是好的。但是用客户或用户ID来标记它们是一个非常糟糕的主意；它将在后端创建如此多的表，性能将受到严重影响。</em></p><p id="5e9e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">直截了当地说:<strong class="it hv">不要用你的运营指标体系作为你的分析体系。</strong>有很多优秀的分析数据库和提供商，包括<a class="ae jq" href="https://www.vertica.com/" rel="noopener ugc nofollow" target="_blank"> Vertica </a>、<a class="ae jq" href="https://aws.amazon.com/redshift/" rel="noopener ugc nofollow" target="_blank"> Redshift </a>、<a class="ae jq" href="https://clickhouse.yandex/" rel="noopener ugc nofollow" target="_blank"> Clickhouse </a>和<a class="ae jq" href="https://cloud.google.com/bigquery/" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>。</p><h1 id="846f" class="jr js hu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">充满希望的风景</h1><p id="aa20" class="pw-post-body-paragraph ir is hu it b iu kp iw ix iy kq ja jb jc kr je jf jg ks ji jj jk kt jm jn jo hn dt translated">Datadog是第一个平台，无论是商业平台还是其他平台，它提供了一个支持尺寸度量标签的引人注目的产品。但是现在有更多的选择。查看它们，找出最适合您的一款:</p><p id="f722" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">商业</strong></p><ul class=""><li id="606c" class="ky kz hu it b iu iv iy iz jc la jg lb jk lc jo ld le lf lg dt translated"><a class="ae jq" href="https://datadoghq.com" rel="noopener ugc nofollow" target="_blank">数据狗</a></li><li id="2b1c" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated"><a class="ae jq" href="https://signalfx.com" rel="noopener ugc nofollow" target="_blank">信号Fx </a></li><li id="96f6" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated"><a class="ae jq" href="https://www.wavefront.com/" rel="noopener ugc nofollow" target="_blank">波前</a></li></ul><p id="eeb6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">开源</strong></p><ul class=""><li id="ac63" class="ky kz hu it b iu iv iy iz jc la jg lb jk lc jo ld le lf lg dt translated"><a class="ae jq" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank">普罗米修斯</a></li><li id="b07e" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated"><a class="ae jq" href="http://opentsdb.net/" rel="noopener ugc nofollow" target="_blank"> OpenTSDB </a></li></ul><blockquote class="lm ln lo"><p id="a63a" class="ir is jp it b iu iv iw ix iy iz ja jb lp jd je jf lq jh ji jj lr jl jm jn jo hn dt translated"><a class="ae jq" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿美族家庭的一员。我们现在<a class="ae jq" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jq" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is jp it b iu iv iw ix iy iz ja jb lp jd je jf lq jh ji jj lr jl jm jn jo hn dt translated">要了解更多信息，<a class="ae jq" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a>、<a class="ae jq" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上给我们点赞/发消息</a>，或者简单地说，<a class="ae jq" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is jp it b iu iv iw ix iy iz ja jb lp jd je jf lq jh ji jj lr jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jq" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jq" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ls lt lu lv fq lw"><div class="bz el l di"><div class="lx ly l"/></div></figure></div></div>    
</body>
</html>