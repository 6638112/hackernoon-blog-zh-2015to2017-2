<html>
<head>
<title>Migrating Perfect project to Swift 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将完美项目迁移到Swift 4</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/migrating-perfect-project-to-swift-4-3ada7b4a3c1a?source=collection_archive---------9-----------------------#2017-07-05">https://medium.com/hackernoon/migrating-perfect-project-to-swift-4-3ada7b4a3c1a?source=collection_archive---------9-----------------------#2017-07-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/e91e71ece5d5ad27df3011ac5e862a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UqmGBJI5X3gpGJTw8xGUNg.jpeg"/></div></div></figure><p id="618a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了检查Xcode9-beta和Swift4的新功能，我决定将在Xcode 8.3.3中编译没有问题的一个测试项目移到单独的文件夹中，并开始实验…</p><p id="dc11" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">名为“RAIDA”的项目是使用Perfect library编写的，具有以下依赖关系:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ka"><img src="../Images/3ba53305d8c5471042e0de680b77a2a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TouMZMW6cptD7D9Bb5AbqQ.png"/></div></div></figure><p id="449e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我已经从Git库克隆了项目。当然，最初它不包含任何依赖项。我需要用构建工具下载它们。</p><p id="4aa2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了让实验更干净，我决定从第一次操作开始就使用Xcode 9 toolchain。要使用新工具链，您必须从Xcode -&gt; Preferences -&gt; Locations中更改设置:</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kf"><img src="../Images/64a0d0ce57a44b904551677081da107f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWRn33N7X5nv6SP9fnZMtg.png"/></div></div></figure><p id="d7d3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">或者从命令行:</p><pre class="kb kc kd ke fq kg kh ki kj aw kk dt"><span id="a70e" class="kl km hu kh b fv kn ko l kp kq">$ xcode-select --switch /Applications/Xcode-beta.app/Contents/Developer/</span></pre><p id="44ec" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后运行生成Xcode配置的程序:</p><p id="24d2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh kr ks kt kh b">$ swift package generate-xcodeproj</code></p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ku"><img src="../Images/eab1034580092c74e1ddd8832e77eb1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*scBJaPGmmAcHecp4-iRyDA.png"/></div></div></figure><p id="b9ff" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所有依赖项都是从存储库和。xcodeproj文件已写入。现在<code class="eh kr ks kt kh b">$ open RAIDA.xcodeproj</code>启动了我的Xcode 9，自动设置了构建设置。</p><p id="e162" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">注意<a class="ae kv" href="https://hackernoon.com/tagged/swift" rel="noopener ugc nofollow" target="_blank"> swift </a>软件包工具是一个CLI命令<a class="ae kv" href="https://hackernoon.com/tagged/tool" rel="noopener ugc nofollow" target="_blank">工具</a>用于swift可再发行软件包，它不是一个带有某些选项的swift编译器。它实际上是一个名为<code class="eh kr ks kt kh b">swift-package</code>的独立工具</p><p id="1deb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在Xcode中，我试图按原样编译我的项目。我还没有在建筑设置中选择“Swift版本4”。是“3.2”。但是这个项目没有建成。它失败，并显示以下消息:</p><pre class="kb kc kd ke fq kg kh ki kj aw kk dt"><span id="a9c7" class="kl km hu kh b fv kn ko l kp kq">ld: library not found for -lCOpenSSL for architecture x86_64</span><span id="0b0a" class="kl km hu kh b fv kw ko l kp kq">clang: error: linker command failed with exit code 1 (use -v to see invocation)</span></pre><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div class="fe ff kx"><img src="../Images/3649758c46154f22340a37e9e0e89f74.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/format:webp/1*Dx4FWOuNXafRsBFKSUQfbQ.png"/></div></figure><p id="6c22" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">链接器失败。它找不到与-l标志链接的COpenSSL库。</p><p id="bffa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完善的网络图书馆依赖于C工程COpenSSL。而且在XCode 8.3.3正常链接没有任何问题。XCode 9中发生了什么，它已经停止构建了？</p><p id="a4b0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">事实上，我花了一天时间尝试不同的可能性，玩链接器标志等等。Stackoverflow没有帮助，人们以不同的方式解决类似的问题，但它看起来更像是“铸造”，而不是工程解决方案。</p><p id="13d8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，我做出了一个显而易见的决定——阅读XCode发行说明。:)通常我们都很懒去读文档——太长太无聊了。但是当你被困住了，就没有别的办法了。当我在XCode 8.3中发现以下内容时非常惊讶(！)发布说明(记得在8.3版本中，我构建的项目没有任何问题)</p><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ky"><img src="../Images/a54689b16dcb0fe923462d21384eff07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cw2_7-n7Z1rz5oObn8EKrw.png"/></div></div></figure><p id="8aa0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我在两个C库——COpenSSL和CHTTPParser中做了这个测试，项目最终完成了！我相信，在你所依赖的每一个C库中，你都必须这样做。</p><p id="f8f6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我无法想象这是怎么发生的，XCode 8.3中引入的新功能实际上在XCode 9中已经开始工作了。很可能苹果在8.3中留下了新旧建筑方案</p><p id="caae" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我擦去额头上的汗水…</p><p id="1e13" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在是时候修复我的项目中这些临时的(我相信PerfectlySoft将在不久的将来修复这些)问题了。令人高兴的是，swift软件包现在支持依赖关系的“编辑模式”——当您可以编辑依赖关系源文件时，它们将不会被稍后发生的重新提取所覆盖。</p><pre class="kb kc kd ke fq kg kh ki kj aw kk dt"><span id="5e3a" class="kl km hu kh b fv kn ko l kp kq">swift package edit COpenSSL<br/>swift package edit PerfectHTTPServer</span></pre><p id="f6b4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">由于PerfectHTTPServer包含C库CHTTPParser，我需要将它整体置于“编辑”模式。</p><pre class="kb kc kd ke fq kg kh ki kj aw kk dt"><span id="260b" class="kl km hu kh b fv kn ko l kp kq">swift package generate-xcodeproj</span></pre><p id="c68a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在这些包在我的项目的packages文件夹中，我可以将它们添加到git存储库中以修复这些重要的更改。</p><p id="c051" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">希望对某人有所帮助！</p><div class="kb kc kd ke fq ab cb"><figure class="kz iv la lb lc ld le paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="kz iv la lb lc ld le paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="kz iv la lb lc ld le paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="lf lg lh"><p id="f922" class="jc jd li je b jf jg jh ji jj jk jl jm lj jo jp jq lk js jt ju ll jw jx jy jz hn dt translated"><a class="ae kv" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kv" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kv" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae kv" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd li je b jf jg jh ji jj jk jl jm lj jo jp jq lk js jt ju ll jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kv" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kv" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lm"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="ln lo l"/></div></figure></div></div>    
</body>
</html>