<html>
<head>
<title>Avoid a bad date and have a good time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">避免糟糕的约会，享受美好时光</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/avoid-a-bad-date-and-have-a-good-time-423792186f30?source=collection_archive---------4-----------------------#2017-06-13">https://medium.com/hackernoon/avoid-a-bad-date-and-have-a-good-time-423792186f30?source=collection_archive---------4-----------------------#2017-06-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/8dc8ea8879b529e67cfe0b51681350e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*wrN0r3PaCBb2cTg4."/></div></figure><p id="fc21" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">声明:这个帖子是针对编程中的datetime的。对于正常人的其他类型的约会，我完全没有建议(就像图片中的那个)</p><p id="2ec0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我使用术语“日期/时间”来表示从Jon Skeet的博客帖子中检索的“任何类型的时序信息”</p><p id="918f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt jx translated">向任何程序员询问他们处理日期和时间的经验，他们可能会分享一些战争故事。我记得在大学的头几年，我听说日期会让开发人员头疼，就像c语言中的指针一样。那时我还没有经历过，因为我还没有进入软件行业。后来我作为一名开发人员实习了一年，在那里我遇到了这些问题。我记得有一天，因为一个日期错误，我和我的主管(公司的一名高级开发人员)很晚才下班。最糟糕的是代码已经部署在实际环境中。这不是我加入公司以来遇到的第一个日期/时间问题，但却是最糟糕的一个。这促使我开设了一个问题帖<a class="ae kg" href="https://www.quora.com/What-are-the-best-practices-when-working-with-datetime-to-avoid-bugs-and-errors-for-any-programming-language" rel="noopener ugc nofollow" target="_blank"> Quora </a>，试图从其他有经验的开发者那里获得最佳实践，以避免将来出现这样的问题。</p><p id="73e0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">从远古时代开始，日期时间就一直困扰着科学家。这是因为时间是复杂的，如果你认为我在说谎，试着理解相对论。</p><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff kh"><img src="../Images/02bdd9829bfed95ba0a406adf5c29bec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vcdKJJ8hOURADYKU."/></div></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">Time as interpreted by the master of time</figcaption></figure><p id="b218" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">日期一直是程序员的眼中钉，也许是因为他们通常不喜欢其他日期🙍。</p><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff ku"><img src="../Images/c94e6036fd4961f924c2e69830d72133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l4kBQq464yQQlXgT.jpg"/></div></div></figure><p id="2ca1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">证明就是千年虫。2000年问题是一个计算机缺陷，或错误，可能在处理1999年12月31日以后的日期时造成问题。全世界的计算机程序员和用户在2000年1月1日面临的这个缺陷也被称为“千年虫”。它们是许多不太出名的其他日期错误。</p><p id="f989" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">关于解析和格式化日期/时间值，堆栈溢出有很多很多问题。这里的大多数参考资料都是用python编写的，但是大多数问题对于大多数处理web上的日期时间的编程语言来说都是通用的。避免此类陷阱的最佳方式是遵循编码最佳实践。开发人员的<a class="ae kg" href="https://www.quora.com/What-are-the-best-practices-when-working-with-datetime-to-avoid-bugs-and-errors-for-any-programming-language" rel="noopener ugc nofollow" target="_blank">实践</a>可能有所不同，但大多数都是相同的。</p><p id="8e80" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><strong class="ja hv">日期时间面临的常见问题是由</strong>造成的</p><ul class=""><li id="e11b" class="kv kw hu ja b jb jc jf jg jj kx jn ky jr kz jv la lb lc ld dt translated">时区问题</li><li id="72b8" class="kv kw hu ja b jb le jf lf jj lg jn lh jr li jv la lb lc ld dt translated">不一致的日期时间格式/模式</li><li id="4320" class="kv kw hu ja b jb le jf lf jj lg jn lh jr li jv la lb lc ld dt translated">部署服务器和本地开发计算机上的不同区域设置</li><li id="3575" class="kv kw hu ja b jb le jf lf jj lg jn lh jr li jv la lb lc ld dt translated">日期运算</li><li id="823b" class="kv kw hu ja b jb le jf lf jj lg jn lh jr li jv la lb lc ld dt translated">传递给数据库的值与数据库中的实际类型不一致</li><li id="d564" class="kv kw hu ja b jb le jf lf jj lg jn lh jr li jv la lb lc ld dt translated">日期时间序列化</li></ul><p id="8813" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">避免日期时间错误最常见也是最好的方法是不要搬起石头砸自己的脚。</p><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/2b0ac448f9c4cfd60ac28a2600974dfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*wnGwStoT0AMYLG6n1EkMbA.jpeg"/></div></figure><p id="4bcd" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">不要搬起石头砸自己的脚，我的意思是总是阅读你正在使用的框架或语言的文档。也要知道你所在的时区。我将简要地研究一些问题。其中大部分都有其他博客文章来解决这些问题。</p><h2 id="cea5" class="lk ll hu bd lm ln lo lp lq lr ls lt lu jj lv lw lx jn ly lz ma jr mb mc md me dt translated">时区</h2><p id="7fff" class="pw-post-body-paragraph iy iz hu ja b jb mf jd je jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv hn dt translated"><strong class="ja hv">时区</strong>是地球上出于法律、商业和社会目的遵守统一<a class="ae kg" href="https://en.wikipedia.org/wiki/Standard_time" rel="noopener ugc nofollow" target="_blank">标准时间</a>的一个区域。时区倾向于遵循国家及其分支机构的边界，因为这样便于商业或其他交流密切的地区保持相同的时间。这让程序员很头疼，因为他们必须跟踪每个用户的不同时区。您的应用程序不应该处理没有时区信息的时间戳。对于python来说,<a class="ae kg" href="https://docs.python.org/3.4/library/datetime.html" rel="noopener ugc nofollow" target="_blank">数据时间</a>模块有两个日期时间对象，它们是天真的和有意识的。一个感知对象对适用的算法和政治时间调整有足够的了解，例如时区，以相对于其他感知对象定位自身。简单对象不包含足够的信息来明确地定位自己相对于其他日期/时间对象的位置。一个简单对象是表示协调世界时(UTC)、本地时间还是其他时区的时间完全取决于程序。简单的对象很容易理解和使用。对于时区感知对象，将tzinfo属性设置为抽象<code class="eh mk ml mm mn b"><a class="ae kg" href="https://docs.python.org/3.4/library/datetime.html#datetime.tzinfo" rel="noopener ugc nofollow" target="_blank"><strong class="ja hv">tzinfo</strong></a></code> <strong class="ja hv"> </strong>类的子类的实例。标准库没有定义任何时区(至少没有很好地定义)。你可以在这里看到完整的博客文章<a class="ae kg" href="http://agiliq.com/blog/2009/02/understanding-datetime-tzinfo-timedelta-amp-timezo/" rel="noopener ugc nofollow" target="_blank"/>。最好的处理方式是使用其他库，比如dateutil或<a class="ae kg" href="http://pytz.sourceforge.net/" rel="noopener ugc nofollow" target="_blank"> pytz </a>。</p><pre class="ki kj kk kl fq mo mn mp mq aw mr dt"><span id="1d01" class="lk ll hu mn b fv ms mt l mu mv">&gt;&gt;import pytz<br/>&gt;&gt;import datetime as dt<br/><strong class="mn hv">&gt;&gt;def</strong> <strong class="mn hv">utcnow</strong>():<br/>    <strong class="mn hv">return</strong> dt<strong class="mn hv">.</strong>datetime<strong class="mn hv">.</strong>now(tz<strong class="mn hv">=</strong>pytz<strong class="mn hv">.</strong>utc)<br/>&gt;&gt;utcnow()<strong class="mn hv">.</strong>isoformat()<br/>'2017-06-06T14:45:21.982600+02:00'</span></pre><p id="e3e4" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果您需要解析包含ISO 8601格式时间戳的字符串，您可以依靠<a class="ae kg" href="https://pypi.python.org/pypi/iso8601" rel="noopener ugc nofollow" target="_blank"> <em class="jw"> iso8601 </em> </a>，它会返回带有正确时区信息的时间戳</p><p id="dae8" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">对于Django应用程序，如果启用了对时区的支持，Django会在数据库中以UTC格式存储日期时间信息，在内部使用支持时区的日期时间对象，并在模板和表单中将它们转换为最终用户的时区。要启用时区，请在设置文件中设置<code class="eh mk ml mm mn b"><a class="ae kg" href="https://docs.djangoproject.com/en/1.11/ref/settings/#std:setting-USE_TZ" rel="noopener ugc nofollow" target="_blank"><strong class="ja hv">USE_TZ = True</strong></a></code>，并设置TIME_ZONE = 'UTC '。</p><pre class="ki kj kk kl fq mo mn mp mq aw mr dt"><span id="cf81" class="lk ll hu mn b fv ms mt l mu mv"><strong class="mn hv">from</strong> <strong class="mn hv">django.utils</strong> <strong class="mn hv">import</strong> timezone<br/><br/>now = timezone.now()</span></pre><h2 id="6eb9" class="lk ll hu bd lm ln lo lp lq lr ls lt lu jj lv lw lx jn ly lz ma jr mb mc md me dt translated">不一致的日期时间格式/模式</h2><p id="1119" class="pw-post-body-paragraph iy iz hu ja b jb mf jd je jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv hn dt translated">日期时间的其他问题是由不一致的格式引起的。这种错误来自客户端。为用户创建日期输入字段时，不要让用户采用日期格式。为U.I .使用一个datepicker库是明智的。他们有相当多的datepicker库，只选择一个你喜欢使用的。如果你不是美国人，我会建议你使用dd/mm/yy或yy/mm/dd ISO格式，因为美国人只是通过做不同的事情来寻求关注😒(随便说说)。我建议在整个平台上使用相同格式，即服务器端和客户端都使用相同的格式。</p><h2 id="c877" class="lk ll hu bd lm ln lo lp lq lr ls lt lu jj lv lw lx jn ly lz ma jr mb mc md me dt translated">日期和时间序列化</h2><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div class="fe ff mw"><img src="../Images/ac700730187e5933c92c149a8f15ef20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/0*HAWCW8EQO0yavZ-Z.jpg"/></div></figure><p id="2129" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">近年来，JSON已经成为一种相当流行的序列化格式，而且它确实是一种很好的格式。大多数原始数据类型很容易用JSON序列化。int和Strings大多比较容易。约会吗？一场噩梦。因为日期是复杂的对象，所以它们总是如此。JSON和JavaScript中日期的问题是JavaScript没有日期文字。为了在JavaScript中表示日期，JSON使用特定的字符串格式<a class="ae kg" href="http://www.w3.org/TR/NOTE-datetime" rel="noopener ugc nofollow" target="_blank"> ISO 8601 </a>将日期编码为字符串。序列化部分非常简单，但是反序列化时会出现问题。</p><p id="da83" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">要用JSON对日期进行编码，可以使用JSON序列化程序的stringify()方法。</p><pre class="ki kj kk kl fq mo mn mp mq aw mr dt"><span id="218b" class="lk ll hu mn b fv ms mt l mu mv">var date = new Date();<br/>console.log(date);   //Thu Jun 08 2017 16:25:36 GMT+0200 (South Africa Standard Time)<br/>        <br/>var json = JSON.stringify(date);<br/>console.log(json);    //"2017-06-08T14:25:36.005Z"</span></pre><p id="dff0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">当反序列化日期时，返回日期的字符串表示形式。</p><pre class="ki kj kk kl fq mo mn mp mq aw mr dt"><span id="6c90" class="lk ll hu mn b fv ms mt l mu mv">var dateStr = JSON.parse(json);  <br/>console.log(dateStr); // "2017-06-08T14:25:36.005Z"</span></pre><p id="6757" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">然而，通过将字符串传递给JavaScript日期构造函数，可以将日期转换回JavaScript日期。</p><pre class="ki kj kk kl fq mo mn mp mq aw mr dt"><span id="2b25" class="lk ll hu mn b fv ms mt l mu mv">var date = new Date(dateStr);<br/>console.log(date);  //Thu Jun 08 2017 16:25:36 GMT+0200 (South Africa Standard Time)</span></pre><p id="7473" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我还记得第一次遇到这个问题是在从。Net WebForm并在我的ajax调用后得到了<code class="eh mk ml mm mn b">/Date(1245398693390)/ </code>。幸运的是,<a class="ae kg" href="https://stackoverflow.com/questions/1016847/converting-net-datetime-to-json" rel="noopener ugc nofollow" target="_blank">斯达克弗洛</a>在那里拯救了我们。</p><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/d8d69576a8191eecc8cee0401ec6b2d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*jGwINkY88uQ4N0bKmaWiTA.png"/></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">I had to do something somewhat similar to this to solve the issue</figcaption></figure><p id="55c7" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">事实证明，这个有趣的输出实际上是从epoch开始的毫秒数。</p><p id="944a" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">使用python序列化datetime对象会引发TypeError。</p><p id="4e9d" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">&gt;&gt;&gt;导入json <br/> &gt; &gt; &gt;导入日期时间<br/> &gt; &gt; &gt;现在= datetime . datetime . now(datetime . time zone . utc)<br/>&gt;&gt;&gt;JSON . dumps(现在)</p><p id="8151" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">type error:datetime . datetime(2017，6，9，8，27，26，832835，tzinfo=datetime.timezone.utc)不是JSON可序列化的</p><p id="0e81" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">要解决这个问题，请将datetime解析为isoformat对象，因为json日期是ISO字符串。</p><p id="a5a5" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">now =日期时间.日期时间. now(日期时间.时区. utc)。等格式()</p><h2 id="a8f5" class="lk ll hu bd lm ln lo lp lq lr ls lt lu jj lv lw lx jn ly lz ma jr mb mc md me dt translated">结论</h2><p id="fa29" class="pw-post-body-paragraph iy iz hu ja b jb mf jd je jf mg jh ji jj mh jl jm jn mi jp jq jr mj jt ju jv hn dt translated">这些是初级开发人员在开始时面临的一些日期问题。我没有穷尽所有的列表，但是下面是一些其他的博客文章和视频，可以帮助你了解更多关于datetime的内容。</p><ul class=""><li id="01aa" class="kv kw hu ja b jb jc jf jg jj kx jn ky jr kz jv la lb lc ld dt translated"><a class="ae kg" href="https://www.youtube.com/watch?v=2BRdKf6WYIQ&amp;t=1041s" rel="noopener ugc nofollow" target="_blank">马里奥·科切罗2017年PyCon日期时间到了</a></li><li id="ebcb" class="kv kw hu ja b jb le jf lf jj lg jn lh jr li jv la lb lc ld dt translated"><a class="ae kg" href="https://julien.danjou.info/blog/2015/python-and-timezones" rel="noopener ugc nofollow" target="_blank">时区和Python </a></li><li id="1019" class="kv kw hu ja b jb le jf lf jj lg jn lh jr li jv la lb lc ld dt translated"><a class="ae kg" href="https://weblog.west-wind.com/posts/2014/jan/06/javascript-json-date-parsing-and-real-dates" rel="noopener ugc nofollow" target="_blank"> JavaScript JSON日期解析和真实日期</a></li><li id="bb68" class="kv kw hu ja b jb le jf lf jj lg jn lh jr li jv la lb lc ld dt translated"><a class="ae kg" href="https://codeblog.jonskeet.uk/2015/05/05/common-mistakes-in-datetime-formatting-and-parsing/" rel="noopener ugc nofollow" target="_blank">日期/时间格式和解析中的常见错误</a></li></ul><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div class="fe ff my"><img src="../Images/d77eae1fc5c69bfb2b8e7f72f27c25c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*L0PFkhvBxW8ZDjSF.jpg"/></div></figure><div class="ki kj kk kl fq ab cb"><figure class="mz iv na nb nc nd ne paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mz iv na nb nc nd ne paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mz iv na nb nc nd ne paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nf ng nh"><p id="f922" class="iy iz jw ja b jb jc jd je jf jg jh ji ni jk jl jm nj jo jp jq nk js jt ju jv hn dt translated"><a class="ae kg" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kg" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kg" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kg" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="iy iz jw ja b jb jc jd je jf jg jh ji ni jk jl jm nj jo jp jq nk js jt ju jv hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kg" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kg" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff nl"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>