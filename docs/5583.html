<html>
<head>
<title>Continuous deployment of a webpack app to multiple environments using Travic CI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Travic CI将webpack应用程序持续部署到多个环境中</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/continuous-deployment-of-a-webpack-app-to-multiple-environments-using-travic-ci-d2c6f22eac50?source=collection_archive---------13-----------------------#2017-08-03">https://medium.com/hackernoon/continuous-deployment-of-a-webpack-app-to-multiple-environments-using-travic-ci-d2c6f22eac50?source=collection_archive---------13-----------------------#2017-08-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><h1 id="6467" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">TL；速度三角形定位法(dead reckoning)</h1><p id="8d6e" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">我使用<a class="ae kn" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>和<a class="ae kn" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>在<a class="ae kn" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase </a>上进行<a class="ae kn" href="https://facebook.github.io/jest/" rel="noopener ugc nofollow" target="_blank"> Jest </a>测试，设置了一个<a class="ae kn" href="https://webpack.github.io/" rel="noopener ugc nofollow" target="_blank"> webpack </a>应用的持续部署。部署到开发环境是在每次提交到主机时完成的。部署到<a class="ae kn" href="https://hackernoon.com/tagged/prod" rel="noopener ugc nofollow" target="_blank"> PROD </a>环境是在每个标签上完成的。</p><p id="c740" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">点击查看代码<a class="ae kn" href="https://github.com/bartw/multi_env_webpack_travis_app" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="18ec" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">如何？</h1><p id="e19d" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">在代码中，我使用了一个默认值:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="807b" class="lc is hu ky b fv ld le l lf lg">var text = __CONFIG__ || “default”;</span></pre><p id="3a3c" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">该值可以在<a class="ae kn" href="https://hackernoon.com/tagged/webpack" rel="noopener ugc nofollow" target="_blank"> webpack </a>配置文件中被覆盖:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="04de" class="lc is hu ky b fv ld le l lf lg">plugins: [<br/>  new webpack.DefinePlugin({ <br/>    __CONFIG__: JSON.stringify("override")<br/>  })<br/>]</span></pre><p id="cd72" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">在我的。我定义了多个Firebase项目:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="de3b" class="lc is hu ky b fv ld le l lf lg">{<br/>  "projects": {<br/>    "prod": "prod-multi-webpack-travis",<br/>    "dev": "dev-multi-webpack-travis"<br/>  }<br/>}</span></pre><p id="893f" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">这允许我通过执行以下命令为每个项目设置配置项:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="0c8f" class="lc is hu ky b fv ld le l lf lg">firebase use dev<br/>firebase login:ci<br/>travis encrypt "1/xxx"</span></pre><p id="3a8b" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">在. travis.yml文件中，我定义了多个部署:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="55f2" class="lc is hu ky b fv ld le l lf lg">deploy:<br/>  - provider: firebase<br/>    project: dev<br/>    token:<br/>      secure: "encrypted stuff"<br/>    skip_cleanup: true<br/>    on:<br/>      branch: "master"<br/>  - provider: firebase<br/>    project: prod<br/>    token:<br/>      secure: "encrypted stuff"<br/>    skip_cleanup: true<br/>    on:<br/>      tags: true</span></pre><p id="17d8" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">现在，我还可以使用Travis在我的webpack配置文件中定义的环境变量:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="2ee5" class="lc is hu ky b fv ld le l lf lg">plugins: [<br/>  new webpack.DefinePlugin({ <br/>    __CONFIG__: JSON.stringify(<br/>      process.env.TRAVIS_TAG ? "override on tag" : "override"<br/>    )<br/>  })<br/>]</span></pre><p id="368c" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">如果我推送GitHub，就会触发开发部署，如果我更新版本，就会触发开发和生产部署:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="ef83" class="lc is hu ky b fv ld le l lf lg">npm version patch<br/>git push --follow-tags</span></pre><p id="93a8" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">为了在使用环境文件的文件上进行Jest测试，我在package.json文件中添加了一些Jest配置:</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="910b" class="lc is hu ky b fv ld le l lf lg">"jest": {<br/>  "globals": {<br/>    "__CONFIG__": null<br/>  }<br/>}</span></pre><h1 id="841b" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">结论</h1><p id="9882" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">我花了很长时间才完成这个工作，所以我决定写这篇博文。这种设置使得为每个环境配置不同的配置变得非常容易。</p><p id="8137" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">缺点是每次改变环境时都需要重新捆绑代码。</p><figure class="kt ku kv kw fq lh"><div class="bz el l di"><div class="li lj l"/></div></figure></div></div>    
</body>
</html>