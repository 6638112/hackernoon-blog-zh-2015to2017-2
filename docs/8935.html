<html>
<head>
<title>Integrating Travis CI and Codecov into a Python-based Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Travis CI和Codecov集成到基于Python的项目中</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/integrating-travis-ci-and-codecov-into-a-python-based-project-6f658074ff63?source=collection_archive---------17-----------------------#2017-12-20">https://medium.com/hackernoon/integrating-travis-ci-and-codecov-into-a-python-based-project-6f658074ff63?source=collection_archive---------17-----------------------#2017-12-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/b2da7ef7769343cbb23c59959f6e50c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WBx6LespURe9hahuMnkaQQ.png"/></div></div></figure><p id="6866" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一点背景:在过去的几个月里，我一直在开源组织<a class="ae ka" href="https://github.com/fossasia" rel="noopener ugc nofollow" target="_blank"> FOSSASIA </a>做贡献，在那里我从事一个名为<a class="ae ka" href="https://github.com/fossasia/badgeyay" rel="noopener ugc nofollow" target="_blank"> BadgeYaY </a>的项目。这是一个徽章生成器，具有简单的web用户界面，可以添加数据并生成PDF格式的可打印徽章。BadgeYay使用Flask，这是一个基于Python的微框架。</p><p id="3a95" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我想在我的持续集成流程中包含一个测试覆盖报告器，只要我的<a class="ae ka" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank"> TravisCI </a>构建通过，它就会被理想地部署到<a class="ae ka" href="https://heroku.com" rel="noopener ugc nofollow" target="_blank"> Heroku </a>。为此，我决定使用<a class="ae ka" href="http://codecov.io" rel="noopener ugc nofollow" target="_blank"> codecov.io </a>来集成代码覆盖。</p><p id="8f9e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，让我们看看什么是“代码覆盖”这个东西；然后我们将继续讨论如何在Travis CI的帮助下集成Codecov。</p><p id="b875" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">什么是代码覆盖率？</strong></p><p id="b72e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">简单地说，代码覆盖率是一种度量，用于表达测试套件运行时源代码被执行的程度。代码覆盖率高的程序意味着测试套件在运行时执行了更多的源代码。因此，这意味着源代码包含未检测到的错误的机会较小。我们使用三个主要术语来描述执行的源代码行。</p><ul class=""><li id="44b6" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated"><strong class="je hv"> hit </strong>表示测试套件执行了给定的源代码。</li><li id="382b" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated"><strong class="je hv">部分</strong>表示源代码没有被测试套件完全执行；还有未执行的剩余分支。</li><li id="64fe" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated"><strong class="je hv">未命中</strong>表示源代码没有被测试套件执行。</li></ul><p id="fc41" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">覆盖率是<code class="eh kp kq kr ks b">hits / (hit + partial + miss)</code>的比值。在总共12行代码中，有5行由测试执行的代码库将获得41%的覆盖率。我不是在吹牛，但是在我写这篇文章的时候，<a class="ae ka" href="https://github.com/fossasia/badgeyay#badgeyay" rel="noopener ugc nofollow" target="_blank">badgeya已经有了100%的代码覆盖率！</a>😎</p><figure class="ku kv kw kx fq iv fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/dff2af4f7d647a048832700402857d16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*qvdvN9h7oovqYD87IIXS5g.png"/></div><figcaption class="ky kz fg fe ff la lb bd b be z ek">Code coverage is a like tool for building tools, and is integrated to other such tools like Git and Travis CI. Source: <a class="ae ka" href="https://www.explainxkcd.com/wiki/index.php/1629:_Tools" rel="noopener ugc nofollow" target="_blank">XKCD</a></figcaption></figure><p id="a771" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">CodeCov对代码覆盖率有什么帮助？</strong></p><p id="9be3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Codecov专注于集成和促进健康的拉请求。它将覆盖度量直接交付或“注入”到现代源代码管理工作流中，以促进更多的代码覆盖。这尤其增加了在新特性和错误修复经常出现的拉请求中检查覆盖率的便利性。</p><p id="dfd4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们可以改变Codecov处理报告和表达覆盖率信息的方式。让我们看看我是如何配置它来适应BadgeYaY的——通过将它与Travis CI集成。</p><p id="2f93" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，Codecov使用一行代码就可以很好地处理Travis CI:</p><pre class="ku kv kw kx fq lc ks ld le aw lf dt"><span id="9b86" class="lg lh hu ks b fv li lj l lk ll">bash &lt; (curl -s <a class="ae ka" href="https://codecov.io/bash)" rel="noopener ugc nofollow" target="_blank">https://codecov.io/bash)</a></span></pre><p id="1985" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">BadgeYaY使用<a class="ae ka" href="https://docs.python.org/3/library/unittest.html" rel="noopener ugc nofollow" target="_blank"> Python单元测试</a>进行断言，借助<a class="ae ka" href="https://github.com/SeleniumHQ/Selenium" rel="noopener ugc nofollow" target="_blank"> Selenium </a>进行web浏览器自动化。基本上，这是用来测试代码的。我以这样一种方式配置CodeCov，它根据这个测试的结果生成覆盖率报告，所以我在<code class="eh kp kq kr ks b">travis.yml</code>中的<code class="eh kp kq kr ks b">scripts</code>中添加了以下内容</p><pre class="ku kv kw kx fq lc ks ld le aw lf dt"><span id="5662" class="lg lh hu ks b fv li lj l lk ll">“scripts”: {<br/> — nosetests app/tests/test.py -v — with-coverage<br/>}</span></pre><p id="c04d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我创建了一个<code class="eh kp kq kr ks b">codecov.yml</code>文件，它告诉我们代码覆盖后生成的报告的配置。代码如下:</p><pre class="ku kv kw kx fq lc ks ld le aw lf dt"><span id="5f24" class="lg lh hu ks b fv li lj l lk ll">codecov:<br/> notify:<br/> require_ci_to_pass: yes</span><span id="9346" class="lg lh hu ks b fv lm lj l lk ll">coverage:<br/> precision: 2<br/> round: down<br/> range: “70…100”</span><span id="6418" class="lg lh hu ks b fv lm lj l lk ll">status:<br/> project: yes<br/> patch: yes<br/> changes: no</span><span id="4641" class="lg lh hu ks b fv lm lj l lk ll">comment:<br/> layout: “reach, diff, flags, files, footer”<br/> behavior: default<br/> require_changes: no</span></pre><p id="429c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是BadgeYaY的项目资源库中<code class="eh kp kq kr ks b">travis.yml</code>的一些代码，这些代码在成功构建后集成了codecov。</p><pre class="ku kv kw kx fq lc ks ld le aw lf dt"><span id="ee5d" class="lg lh hu ks b fv li lj l lk ll">Script:<br/>- python app/main.py &gt;&gt; log.txt 2&gt;&amp;1 &amp;<br/>- nosetts app/tests/test.py -v — with-coverage<br/>- python3 -m pyflakes<br/>after_success:<br/>- bash &lt; (curl -s <a class="ae ka" href="https://codecov.io/bash)" rel="noopener ugc nofollow" target="_blank">https://codecov.io/bash)</a></span></pre><p id="bca4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="ln">另外两个脚本与codecov集成无关，但是如果您感兴趣的话，可以随意查阅。</em></p><p id="da3d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦所有这些都设置好了，Codecov就可以开始行动了。现在，当任何人向BadgeYaY发出pull请求时，Codecov都会根据上面的配置对其进行分析，并生成显示其代码覆盖率的报告。</p><p id="c292" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">至此，我们已经结束了关于将Travis CI和Codecov集成到基于Python的项目中的讨论。我写这篇文章是为了解决BadgeYaY项目中的这个问题。如果你喜欢这篇文章，可以考虑看看我在GitHub上的其他作品🙂。</p><p id="feed" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">来源:<a class="ae ka" href="http://docs.codecov.io" rel="noopener ugc nofollow" target="_blank"> codecov.io </a>，<a class="ae ka" href="https://en.wikipedia.org/wiki/Code_coverage" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></div></div>    
</body>
</html>