<html>
<head>
<title>Elmchemy — Write type-safe Elixir code with Elm’s syntax — part 2 — Our own RPG character module</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Elmchemy —用Elm的语法编写类型安全的仙丹代码—第2部分—我们自己的RPG字符模块</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/elmchemy-write-type-safe-elixir-code-with-elms-syntax-part-2-our-own-rpg-character-module-cedbf7da138d?source=collection_archive---------4-----------------------#2017-07-02">https://medium.com/hackernoon/elmchemy-write-type-safe-elixir-code-with-elms-syntax-part-2-our-own-rpg-character-module-cedbf7da138d?source=collection_archive---------4-----------------------#2017-07-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="9d3c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在文章的这一部分，我们将使用<a class="ae jp" href="http://github.com/wende/elmchemy" rel="noopener ugc nofollow" target="_blank"> Elmchemy </a>编写自己的库。<br/>如果你还没有读过<a class="ae jp" rel="noopener" href="/@krzysztof.wende/elmchemy-write-type-safe-elixir-code-with-elms-syntax-part-1-introduction-8968b76d721d">第一部</a>，强烈建议你这么做。它涵盖了开始一个新项目和用<a class="ae jp" href="https://hackernoon.com/tagged/elmchemy" rel="noopener ugc nofollow" target="_blank"> Elmchemy </a>编译器集成一个现有项目的基础知识。</p><p id="f9ba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本教程中，我们将学习如何:</p><ol class=""><li id="9871" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">定义类型别名</li><li id="7999" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">定义工会类型</li><li id="6d0e" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">使用别名和标记联合作为函数</li><li id="b736" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">联合类型的模式匹配</li><li id="f8d9" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">将运算符用作函数，并定义自己的自定义函数</li><li id="536d" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">从其他模块导入类型和类型别名</li></ol></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><p id="c691" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">想象我们正在写一个游戏。令人惊叹的创新游戏。一个前无古人的游戏。有角色，等级，统计和物品的游戏。它以科幻世界为背景，所以我们可以拥有十字弓、步枪、撬棍、爆能枪等等。因为我们正在创建一个block-buster，而项目经理很少碰巧有不可思议的期限预期，所以我们被分配了一个单一的任务:我们的工作是创建一个负责我们主要角色的模块。<br/>我们是一家初创公司，我们的工资大约是每月500美元，所以我们有机会自己设计功能(产品经理会说这不是他想要的)。</p><p id="202d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们是一个懒惰的程序员，我们将使用在<a class="ae jp" rel="noopener" href="/@krzysztof.wende/elmchemy-write-type-safe-elixir-code-with-elms-syntax-part-1-introduction-8968b76d721d">第一部分</a>中创建的项目。如果你没有，那么你已经失败了。你的股权没了。<br/>作为第一步，我们将创建几个场景来测试未实现的功能，然后我们将开始考虑如何实现它们。它被称为TDD，是你在不被解雇的情况下最接近工作中的游戏。测试套件将在Elixir的ExUnit中实现，就像本教程的前一部分一样，其他的都将只使用Elmchemy进行编码。</p><p id="4ad0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">说够了。是时候开始编码了。</p><h1 id="d798" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">准备</h1><p id="d108" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated"><em class="lo">*本文是使用Elmchemy 0.3.31编写的。确保拥有高于0.3.31但不高于0.4的版本* </em></p><p id="1b20" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于你的工资和每周不可协商的全职小时数，你遭受了退出魔兽世界的痛苦。缺少你最讨厌和最喜欢的游戏会导致一个相当大胆的声明:<strong class="it hv">每个游戏角色都必须有属性</strong>。</p><p id="23c9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们编写一个测试来检查新角色是否拥有它们。<br/>如果您遵循上一部分，您的项目结构应该如下所示:</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff lp"><img src="../Images/8b3a5005701cb8d0796c0b0c49bbf813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eip-SuOa76Vbme58FJCX-Q.png"/></div></div></figure><p id="b887" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<code class="eh mb mc md me b">test</code>目录下创建一个名为<code class="eh mb mc md me b">character_test.exs</code>的新文件，并从一个样板文件开始:</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff mf"><img src="../Images/c93d9056c45fd3819c1d214f20917eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y4ajAfbswCoUWyV2qZW9UA.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">test/character_test.exs - Ignore the error on `use Elmchemy`. Our plugin just can’t see dependencies that are installed as mix archives</figcaption></figure><p id="fd8f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们的角色应该有什么？肯定是名和姓。有些性别也不错。年龄被高估了，所以我们不考虑它。不多，但对我们的MVP来说足够了。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff mk"><img src="../Images/389e2b8254ae31b5b728382c0558bd61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7018JckRFynJMTVr1xrOpg.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">test/character_test.exs</figcaption></figure><p id="ad61" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">酷毙了。下一件事是我们希望他有基本的统计数据。伤害的力量，武器需求的智力，生命值的活力，应该足够我们的MVP了。我们还不知道默认值是什么，所以让我们检查统计数据是否存在并且是整数。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff ml"><img src="../Images/83c3ddf9d8f2ac0129ed6bde00a73f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s6dzriEpPG4Shk91s8-hFw.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">character_test.exs</figcaption></figure><p id="dbc3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们也检查我们是否能使用<code class="eh mb mc md me b">set_stat/3</code>功能为我们的角色设置一个属性。</p><p id="10c3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果统计数据不能为拥有它们提供一些好处，它们就什么都不是:</p><p id="1614" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">活力提升健康，显示为{current_hp，max_hp}元组:</strong></p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff mm"><img src="../Images/9fcdbfb83529fd1ac605372f00195c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lDKjJaTV54AmTghW1JaXRQ.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">test/character_test.exs — We check that max hp increased, and also that our current hp adjusted itself accordingly</figcaption></figure><p id="d9a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们的测试中，我们创建了一个新的Gordon，并克隆了他的两个副本。一个增强了10点生命力，另一个和我们一样是程序员——0点。然后我们比较他们的健康点，期望前者有更多的健康点。在最后一行中，我们确保提高戈登的最大生命值，也相应地提高他的基础生命值。</p><p id="5f06" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lo">*请注意，我们将函数的目标作为最后一个参数，而不是第一个。那是因为在</em> <a class="ae jp" href="https://en.wikipedia.org/wiki/Currying" rel="noopener ugc nofollow" target="_blank"> <em class="lo">固化的</em> </a> <em class="lo">环境中，为了让管道工作，我们需要把管道目标作为最后一个参数——这就是埃尔姆和埃尔姆切米的标准* </em></p><p id="5dc7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">情报让我们可以装备更先进的武器:</strong></p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff mm"><img src="../Images/2c0a6db2f840288dcd4d86b78ce0e91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Y9cGmCnS-eiiGqHPEMkEQ.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">test/character_test.exs — We create two Gordons, a weapon with 9 intelligence requirement,</figcaption></figure><p id="5ed3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里我们创建了一个新角色和一个9级100伤害的武器。然后我们得到戈登的两个克隆体:<br/> -一个有<code class="eh mb mc md me b">10</code>智力<br/> -另一个有<code class="eh mb mc md me b">0</code>。我们对两个角色都运行了<code class="eh mb mc md me b">equip</code>功能，预计它会在有<code class="eh mb mc md me b">0</code>智能的角色上失败，但在有<code class="eh mb mc md me b">10</code>智能的角色上成功</p><p id="1e49" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在最后，我们确保了更聪明的戈登的克隆人在他的手臂上有一件武器。请注意，我们将其包装在单元组<code class="eh mb mc md me b">{weapon}</code>中，因为这就是Elmchemy表示<code class="eh mb mc md me b"><a class="ae jp" href="http://package.elm-lang.org/packages/elm-lang/core/latest/Maybe" rel="noopener ugc nofollow" target="_blank">Maybe</a></code>类型的方式。其中<code class="eh mb mc md me b">{value}</code>为<code class="eh mb mc md me b">Just value</code>，而<code class="eh mb mc md me b">nil</code>为<code class="eh mb mc md me b">Nothing.</code></p></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><h1 id="a9f8" class="kl km hu bd kn ko mn kq kr ks mo ku kv kw mp ky kz la mq lc ld le mr lg lh li dt translated">履行</h1><h1 id="2cde" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">测试#1 —人物姓名、姓氏和性别</h1><h2 id="3a2b" class="ms km hu bd kn mt mu mv kr mw mx my kv jc mz na kz jg nb nc ld jk nd ne lh nf dt translated">功能1-类型别名</h2><p id="50ae" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">现在我们有了测试，我们可以开始实现我们的角色了！对于我们的模式，我们将使用一个<code class="eh mb mc md me b">type alias</code>。它允许我们对任何其他类型有一个共同的名称。我们要用它来给一个结构体起别名。Elmchemy用原子作为键来表示地图。</p><p id="bc4a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">用我们的类型别名声明创建一个<code class="eh mb mc md me b">elm/Character.elm</code>文件。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff ng"><img src="../Images/886be3f2ead1f51fbbffd37ef8f558a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xojaiSEnVRKccTXN1gtD4w.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">elm/Character.elm</figcaption></figure><blockquote class="nh ni nj"><p id="a853" class="ir is lo it b iu iv iw ix iy iz ja jb nk jd je jf nl jh ji jj nm jl jm jn jo hn dt translated"><strong class="it hv">类型别名提示</strong>:如果我们别名化的类型是一个结构或元组，我们可以使用别名作为一个函数来创建它的一个实例，其中每个参数都是我们类型中的一个后续值。f.i <code class="eh mb mc md me b">Character name surname gender health</code></p></blockquote><p id="1cf3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们声明我们的角色有名字和姓氏，它们是字符串。<br/>一个<code class="eh mb mc md me b">Gender</code>类型的性别，是我们还没有声明的类型，健康为tuple，其中第一个是当前健康，后者是最大健康。</p><h2 id="1fd0" class="ms km hu bd kn mt mu mv kr mw mx my kv jc mz na kz jg nb nc ld jk nd ne lh nf dt translated">特征2-联合类型</h2><p id="c38b" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">每当我们不想要匹配的东西，我们想要一个自定义类型。Elmchemy <code class="eh mb mc md me b">types</code>中的<br/>是所谓的<a class="ae jp" href="https://en.wikipedia.org/wiki/Tagged_union" rel="noopener ugc nofollow" target="_blank">‘标记联合’</a>，它的基本意思是，每个类型声明中的第一个符号是一个‘标记’，它告诉我们值代表什么类型。Elmchemy中的联合类型在单个标记的情况下表示为原子，在包装一个或多个类型的标记的情况下表示为以原子开始的元组。<br/>这就是我们宣布性别的方式</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff nn"><img src="../Images/8d89a002458b45557284fa031bcdcbe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8NDcxK0AeobX3Ca35MhCiA.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">elm/Character.elm — We declare that gender can either be an atom :male, :female or :other</figcaption></figure><h2 id="8116" class="ms km hu bd kn mt mu mv kr mw mx my kv jc mz na kz jg nb nc ld jk nd ne lh nf dt translated">功能3-将别名类型作为函数</h2><p id="9d1e" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">现在我们可以声明一个<code class="eh mb mc md me b">new</code>函数，它根据参数返回一个新字符。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff no"><img src="../Images/1643fcbf9a75cae05ee9f128ddeba9fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*go2fFkq7-0MoOJRcfVK_kQ.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">elm/Character.elm — function returning our Character type alias intance</figcaption></figure><p id="a4cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们接受3个参数，它们是作为字符串的名字和姓氏，以及作为我们新创建的<code class="eh mb mc md me b">Gender</code>联合类型的性别。然后，我们按照定义字段的顺序将参数作为函数传递给字符类型。我们也在100最大值上传递了健康值为100的默认参数。</p><p id="685c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们现在在终端中运行<code class="eh mb mc md me b">mix test</code>，我们应该会通过第一个测试。还剩三个。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff np"><img src="../Images/50c795cc1ff651df4d08fa093957c6aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-_5JQ41v_0mE3No8gshfbQ.png"/></div></div></figure><h1 id="4b77" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">测试2——性格统计</h1><p id="10cd" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">是时候添加统计数据了。让我们回忆一下我们的测试案例</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff ml"><img src="../Images/83c3ddf9d8f2ac0129ed6bde00a73f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s6dzriEpPG4Shk91s8-hFw.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">character_test.exs</figcaption></figure><p id="2915" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先我们需要为我们的角色类型定义属性。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff nq"><img src="../Images/0c7a45c53d6154509bead13ac09ec1f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1D9yM_jR4T0iJQLFVZMf1Q.png"/></div></div></figure><p id="7b45" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并定义统计结构:</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff nr"><img src="../Images/a66857ce98725ed7af66989b31484156.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-It8RHZyN1qz23qJGrWTww.png"/></div></div></figure><p id="f2ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们保存时，我们的编译器应该提醒我们，我们的<code class="eh mb mc md me b">new/3</code>函数不再与我们的类型相关。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff ns"><img src="../Images/96433d502d21ed7cf1c279aedb98e858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PCNm3bU-XAHd2mzJMwCn2g.png"/></div></div></figure><p id="a134" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们更新它以包含所有值为0的默认统计信息</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff nt"><img src="../Images/8bed880ae9c4943392ce4b4b0f48346d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_EYW-xEpMjRVOSmGBqf-mg.png"/></div></div></figure><h2 id="4ab7" class="ms km hu bd kn mt mu mv kr mw mx my kv jc mz na kz jg nb nc ld jk nd ne lh nf dt translated">特性4 —关于联合类型和记录更新语法的case语句</h2><p id="825d" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">我们需要一种统计数据来匹配</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff nu"><img src="../Images/f1a659f1507a3a18fb7c6c32a2474e92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vXHdVca48WVFpRVuGD4aYQ.png"/></div></div></figure><p id="0fa8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们需要声明一个函数，它接受一个stat、值和字符，并将stat更新为我们想要的值。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff nv"><img src="../Images/ebafd516cadbb2179f8af9f84402b30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ROFGur0hLZ_fPCgOakFfXg.png"/></div></div></figure><blockquote class="nh ni nj"><p id="3967" class="ir is lo it b iu iv iw ix iy iz ja jb nk jd je jf nl jh ji jj nm jl jm jn jo hn dt translated">你知道吗？<br/> 你可以使用记录更新语法定义类型别名。<br/> <code class="eh mb mc md me b">type alias Namable a = { a | name : String}</code> <br/>表示任何具有类型为<code class="eh mb mc md me b">String</code>的字段<code class="eh mb mc md me b">name</code>的结构。<br/>然后你可以像这样创建从它派生的类型:<br/> <code class="eh mb mc md me b">type alias Cat = Namable { lactoseIntolerance : Bool }<br/></code> <code class="eh mb mc md me b">type alias Dog = Namable { catIntolerance : Int }</code> <br/>但是记住，这样你牺牲了实例化类型别名的短语法，并且必须手工键入整个结构。</p></blockquote><p id="24f8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">太好了。那是另一项测试！</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff nw"><img src="../Images/f99f6121c1233f5fa3025b49fad4c6ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NsESpRiay70cHm794-ppHg.png"/></div></div></figure><h1 id="8f09" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">测试3——增强活力</h1><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff mm"><img src="../Images/9fcdbfb83529fd1ac605372f00195c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lDKjJaTV54AmTghW1JaXRQ.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">test/character_test.exs — We check that max hp increased, and also that our current hp adjusted itself accordingly</figcaption></figure><p id="6e92" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们需要在设置活力属性时增加改变生命值的功能。</p><h2 id="70b6" class="ms km hu bd kn mt mu mv kr mw mx my kv jc mz na kz jg nb nc ld jk nd ne lh nf dt translated">功能5—作为函数的运算符和自定义运算符</h2><p id="b1c7" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">因为我们的HP是一个元组，所以我们想对它使用<code class="eh mb mc md me b">Tuple.map</code>。但是为了代码的整洁，我们将定义一个操作符作为中缀操作符。</p><p id="6a27" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以使用任何我喜欢的操作符，但是为了形状的缘故，我为左边的元组元素选择了<code class="eh mb mc md me b">&lt;$</code>,为右边的元组元素选择了<code class="eh mb mc md me b">$&gt;</code>。你可以尝试最适合你的方法。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff nx"><img src="../Images/64fcf90e692a747b6708e236feb88164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bl4O5E3aQJJEx5le4GYgCw.png"/></div></div></figure><blockquote class="nh ni nj"><p id="e7f4" class="ir is lo it b iu iv iw ix iy iz ja jb nk jd je jf nl jh ji jj nm jl jm jn jo hn dt translated">你知道吗？ <br/>有大量的内置操作器让你的生活更轻松。您可以使用<code class="eh mb mc md me b">|&gt;</code>和<code class="eh mb mc md me b">&lt;|</code>来传输函数结果，使用<code class="eh mb mc md me b">&lt;&lt;</code>和<code class="eh mb mc md me b">&gt;&gt;</code>来组合函数。甚至有一个逗号运算符可以为您创建元组。<br/> <code class="eh mb mc md me b">(,) a b</code>相当于<code class="eh mb mc md me b">(a, b)<br/>(,,) a b c</code>到<code class="eh mb mc md me b">(a, b, c)</code>等等。每个操作符仍然是一个函数，所以我们可以把它们传递给其他函数，让我们的代码更有表现力。<br/>实现两个列表的压缩所需要的只是编写<br/> <code class="eh mb mc md me b">List.map2 (,) listA listB</code></p></blockquote><p id="9f55" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">太好了。现在我们可以将健康变化添加到我们的<code class="eh mb mc md me b">setStat</code>案例的<code class="eh mb mc md me b">Vitality</code>分支中。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff nx"><img src="../Images/147757bbae313d87b450ca22a09c7db6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*inQe0nuCJmOWaz5GOFupAA.png"/></div></div></figure><p id="2491" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们用<code class="eh mb mc md me b">&lt;$</code>加上当前生命力的差值和新的生命力值乘以10。<br/>然后我们用<code class="eh mb mc md me b">$&gt;</code>设置为基数100加10倍体力值。<br/>因为我们需要给它传递一个函数，在第一种情况下我们给它一个<code class="eh mb mc md me b">(+)</code>函数，在第二种情况下我们给它<code class="eh mb mc md me b">always</code>，它基本上返回<em class="lo">总是</em>同样的东西(基本上它的意思和<code class="eh mb mc md me b">\_ -&gt; (100 + 10 * value)</code>一样)<br/>如果我们不使用我们的操作符，代码将如下所示</p><pre class="lq lr ls lt fq ny me nz oa aw ob dt"><span id="cbe4" class="ms km hu me b fv oc od l oe of">character.health<br/>  |&gt; Tuple.mapFirst ((+) ((value - character.stats.vitality) * 10))<br/>  |&gt; Tuple.mapSecond (always (100 + 10 * value))</span></pre><p id="299a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们应该只剩下一个测试失败了。</p><h1 id="86b6" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">测试# 4——当我们足够聪明的时候装备武器</h1><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff mm"><img src="../Images/2c0a6db2f840288dcd4d86b78ce0e91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Y9cGmCnS-eiiGqHPEMkEQ.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">test/character_test.exs - a weapon with 9 intelligence requirement,</figcaption></figure><p id="0124" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以我们需要一个功能，要么能要么不能装备武器。为此，我们将使用<code class="eh mb mc md me b">Result a b</code>类型，其值为<br/> <code class="eh mb mc md me b">Err a</code>或<code class="eh mb mc md me b">Ok b</code>，直接转换为<code class="eh mb mc md me b">{:ok, a}</code>或<code class="eh mb mc md me b">{:error, b}</code>。</p><blockquote class="nh ni nj"><p id="2a75" class="ir is lo it b iu iv iw ix iy iz ja jb nk jd je jf nl jh ji jj nm jl jm jn jo hn dt translated">请注意Err翻译成<code class="eh mb mc md me b">:error</code>而不是<code class="eh mb mc md me b">:err</code>的区别。这是Elmchemy中的一个例外，在不牺牲一致性的情况下保持Elixir和Elm的互操作性</p></blockquote><p id="0dd1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但在此之前，我们需要实现一个通用的武器类型。为此，我们创建一个新文件，并学习导入和使用远程类型。</p><h2 id="1b70" class="ms km hu bd kn mt mu mv kr mw mx my kv jc mz na kz jg nb nc ld jk nd ne lh nf dt translated">功能6-从其他模块导入的联合类型和类型别名</h2><p id="cac2" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">让我们创建一个新的<code class="eh mb mc md me b">elm/Weapon.elm</code>文件，并添加一个<code class="eh mb mc md me b">new</code>函数，为我们创建一个武器</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff og"><img src="../Images/8e3f790d0d2b3de925e44076b176667e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mtKYCxIEtYQdsCtko8dQ7g.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">elm/Weapon.elm — weapon type definition</figcaption></figure><p id="3dc7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lo">*请注意，我们创建</em> <code class="eh mb mc md me b"><em class="lo">new</em></code> <em class="lo">函数只是为了在我们的灵丹妙药代码中使用。</em> <code class="eh mb mc md me b"><em class="lo">Weapon</em></code> <em class="lo">类型别名在Elmchemy的作用域内使用时本身就是一个工厂函数。</em> <code class="eh mb mc md me b"><em class="lo">Character</em></code> <em class="lo">工厂函数(</em> <code class="eh mb mc md me b"><em class="lo">Character.new</em></code> <em class="lo">)有所不同，因为我们为它指定了一些默认值* </em></p><p id="49c3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们已经有了我们的<code class="eh mb mc md me b">Weapon</code>类型，我们可以实现我们的<code class="eh mb mc md me b">equip</code>函数，但是首先我们需要在我们的<code class="eh mb mc md me b">Character.elm</code>文件的顶部添加一个导入，<br/>我们使用<code class="eh mb mc md me b">import Weapon exposing (Weapon)</code>，因为第一个是模块的名称，后者是我们想要导入的类型别名。</p><p id="bcbf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">而且我们的角色现在没有胳膊。让我们添加一个手臂，类型为<code class="eh mb mc md me b">Maybe Weapon</code>。就像我们之前决定的那样，我们想要使用<code class="eh mb mc md me b">Maybe</code>类型，因为我们的角色要么手里有东西，要么什么都没有。<br/>让我们给我们的<code class="eh mb mc md me b">Character</code>型加上一只手臂</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff oh"><img src="../Images/49887ca3ec779d4358c6a5d46d45680e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EnyNETBnMBndEouId_2pzA.png"/></div></div></figure><blockquote class="nh ni nj"><p id="72cb" class="ir is lo it b iu iv iw ix iy iz ja jb nk jd je jf nl jh ji jj nm jl jm jn jo hn dt translated">你知道吗？<br/> 有一种速记语法，可以将struct中的字段作为函数来访问。通过编写<code class="eh mb mc md me b">.field</code>，你可以拥有一个函数来获取记录的<code class="eh mb mc md me b">field</code>。相当于<code class="eh mb mc md me b">\a -&gt; a.field</code> <br/>比如:<br/> <code class="eh mb mc md me b">arsenal : List Character -&gt; List Weapon</code> <br/> <code class="eh mb mc md me b">arsenal squad = List.map .arm <em class="hu">squad</em></code></p></blockquote><p id="1577" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还需要给我们的<code class="eh mb mc md me b">Character.new</code>函数添加一个<code class="eh mb mc md me b">arm</code>的默认值。</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff oh"><img src="../Images/95439465f0bb5024183e58e55ad320dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*USFG4JtOx887x66Su82gCQ.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">elm/Character.elm</figcaption></figure><p id="322a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们有了从其他文件导入的类型和角色的手臂，我们可以开始我们的武器装备实现了:</p><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff oi"><img src="../Images/b2633d6bc7344cdd53fc561ebe256289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I7JN29ga6jQzFeoKccrJNw.png"/></div></div><figcaption class="mg mh fg fe ff mi mj bd b be z ek">elm/Character.elm</figcaption></figure><p id="6473" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就是这样！如果我们现在运行测试，我们应该看到所有4个测试都是绿色的。</p><p id="c748" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你跳过了一些部分，你可以在这个库下面看到整个项目:<br/><a class="ae jp" href="https://github.com/wende/elmchemy-article-example" rel="noopener ugc nofollow" target="_blank">https://github.com/wende/elmchemy-article-example</a></p><p id="b254" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">这是第二部分的结尾，在第三部分中，我们将关注从Elmchemy调用Elixir code并编写自己的本机模块。</strong></p><p id="73ac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果有任何关于这个项目的问题，我很乐意在评论区回答。</p><h1 id="4615" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">公告:</h1><h2 id="8995" class="ms km hu bd kn mt mu mv kr mw mx my kv jc mz na kz jg nb nc ld jk nd ne lh nf dt translated">Elmchemy正在更名，很快将被命名为“Elchemy”(不带“m”)</h2><p id="bf75" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">第一部分</p><p id="e6f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">—第三部分&gt;&gt;&gt;</p><div class="lq lr ls lt fq ab cb"><figure class="oj lu ok ol om on oo paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="oj lu ok ol om on oo paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="oj lu ok ol om on oo paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nh ni nj"><p id="f922" class="ir is lo it b iu iv iw ix iy iz ja jb nk jd je jf nl jh ji jj nm jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是这个家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is lo it b iu iv iw ix iy iz ja jb nk jd je jf nl jh ji jj nm jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lq lr ls lt fq lu fe ff paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="fe ff op"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="lq lr ls lt fq lu"><div class="bz el l di"><div class="oq or l"/></div></figure></div></div>    
</body>
</html>