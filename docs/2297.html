<html>
<head>
<title>Scrape any Website/Service/API with a single SQL Select Statement</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用一条SQL Select语句抓取任何网站/服务/API</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/scrape-any-website-service-api-with-a-single-sql-select-statement-8d60be1e9a49?source=collection_archive---------3-----------------------#2017-01-18">https://medium.com/hackernoon/scrape-any-website-service-api-with-a-single-sql-select-statement-8d60be1e9a49?source=collection_archive---------3-----------------------#2017-01-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="ac0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我喜欢SQL，通过SQL语法的力量所能完成的事情总是让我惊讶不已。在本例中，我们将创建一个简单的包装器，它将任何网页或HTTP端点视为一个SQL表，可以通过一个SQL select语句进行查询。此外，我们将演示如何将查询结果导出为各种有用的格式:(JSON、TEXT、TAB/CSV分隔、EXCEL等)。</p><p id="e830" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个例子利用了我最喜欢的应用程序之一，PhantomJS。</p><div class="jp jq fm fo jr js"><a href="http://phantomjs.org/" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab ej"><div class="ju ab jv cl cj jw"><h2 class="bd hv fv z el jx eo ep jy er et ht dt translated">幻想|幻想</h2><div class="jz l"><h3 class="bd b fv z el jx eo ep jy er et ek translated">编辑描述</h3></div><div class="ka l"><p class="bd b gc z el jx eo ep jy er et ek translated">phantomjs.org</p></div></div><div class="kb l"><div class="kc l kd ke kf kb kg kh js"/></div></div></a></div><p id="b298" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">PhantomJS是一个无头的WebKit，可以用一个<a class="ae ki" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a> API来编写脚本，它支持以下功能:</p><h2 id="d57c" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">无头网站测试</h2><p id="2f6b" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">用Jasmine、QUnit、Mocha、Capybara、WebDriver等框架进行功能测试。<a class="ae ki" href="http://phantomjs.org/headless-testing.html" rel="noopener ugc nofollow" target="_blank">了解更多</a></p><h2 id="a25f" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">屏幕捕获</h2><p id="1698" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">以编程方式捕获web内容，包括SVG和Canvas。创建带有缩略图预览的网站截图。<a class="ae ki" href="http://phantomjs.org/screen-capture.html" rel="noopener ugc nofollow" target="_blank">了解更多</a></p><h2 id="9dcd" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">页面自动化</h2><p id="cf4e" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">使用标准的DOM API或jQuery等常用库来访问和操作网页。<br/> <a class="ae ki" href="http://phantomjs.org/page-automation.html" rel="noopener ugc nofollow" target="_blank">了解更多</a></p><h2 id="bb31" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">网络监视</h2><p id="1305" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">监控页面加载和导出为标准HAR文件。使用YSlow和Jenkins自动进行性能分析。<a class="ae ki" href="http://phantomjs.org/network-monitoring.html" rel="noopener ugc nofollow" target="_blank">了解更多信息</a></p><p id="094e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">结合PhantomJS，我们还将利用来自以下网站的出色的JavaScript <a class="ae ki" href="https://hackernoon.com/tagged/sql" rel="noopener ugc nofollow" target="_blank"> SQL </a>库- <strong class="it hv"> ALASQL </strong>:</p><div class="jp jq fm fo jr js"><a href="http://alasql.org/" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab ej"><div class="ju ab jv cl cj jw"><h2 class="bd hv fv z el jx eo ep jy er et ht dt translated">AlaSQL - javascript SQL数据库库</h2><div class="jz l"><h3 class="bd b fv z el jx eo ep jy er et ek translated">AlaSQL是用纯JavaScript编写的，不使用浏览器WebSQL数据库。</h3></div><div class="ka l"><p class="bd b gc z el jx eo ep jy er et ek translated">alasql.org</p></div></div><div class="kb l"><div class="lj l kd ke kf kb kg kh js"/></div></div></a></div><p id="b77f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">AlaSQL</strong>—‘àla SQL’—是一个轻量级的客户端内存SQL数据库，设计用于browser和Node.js。</p><p id="e64e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> AlaSQL </strong>是用纯JavaScript编写的，不使用浏览器WebSQL数据库。</p><p id="56a1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">AlaSQL是一个全功能的压缩SQL服务器，支持连接、组、联合、ANY、ALL、IN、子查询和非常有限的事务。</p><p id="55b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> AlaSQL </strong>支持ROLLUP()、CUBE()和GROUPING SETS()函数</p><p id="46cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> AlaSQL </strong>适用于所有现代版本的浏览器(Chrome、Firefox、IE、Safari)、Node.js以及移动iOS和Android。</p><p id="a384" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> AlaSQL </strong>之所以快，是因为它使用了一些优化方法。</p><p id="3905" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">执行我们任务的代码如下:</p><figure class="lk ll lm ln fq lo"><div class="bz el l di"><div class="lp lq l"/></div></figure><p id="e0a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要实现这一点，首先需要安装PhantomJS。说明在这里:</p><div class="jp jq fm fo jr js"><a href="http://phantomjs.org/download.html" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab ej"><div class="ju ab jv cl cj jw"><h2 class="bd hv fv z el jx eo ep jy er et ht dt translated">下载|幻想</h2><div class="jz l"><h3 class="bd b fv z el jx eo ep jy er et ek translated">注意:对于这个静态构建，二进制文件是独立的。不需要安装Qt、WebKit或任何其他…</h3></div><div class="ka l"><p class="bd b gc z el jx eo ep jy er et ek translated">phantomjs.org</p></div></div><div class="kb l"><div class="lr l kd ke kf kb kg kh js"/></div></div></a></div><p id="0e6f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">成功下载PhantomJS后，使用上面的代码创建一个名为scrapepage.js的新文本文件。然后，在命令提示符下，只需键入如下命令，即可开始使用该应用程序:</p><pre class="lk ll lm ln fq ls lt lu lv aw lw dt"><span id="e88f" class="kj kk hu lt b fv lx ly l lz ma">phantomjs scrapepage.js "<a class="ae ki" href="https://news.ycombinator.com/news" rel="noopener ugc nofollow" target="_blank">https://news.ycombinator.com/news</a>" "select nodeName,href,innerText from document where className='storylink' limit 5"</span></pre><p id="8c43" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将产生一个类似如下的列表:</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff mb"><img src="../Images/8df8d1bf4c10e2f9f0709c8fb5054d48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WlW1CKhsUD7ECTTRiRT72A.png"/></div></div></figure><p id="3771" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者，您可以尝试以下方法:</p><pre class="lk ll lm ln fq ls lt lu lv aw lw dt"><span id="c5d2" class="kj kk hu lt b fv lx ly l lz ma">phantomjs scrapePage.js "<a class="ae ki" href="https://news.ycombinator.com/news" rel="noopener ugc nofollow" target="_blank">https://news.ycombinator.com/news</a>" "select nodeName,count(nodeName) as Nodes INTO CSV() from document group by nodeName order by Nodes desc"</span></pre><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff mb"><img src="../Images/f304746e3541f84f5ff1021eff7732c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5DFpz4dev8wu04DD64qrPw.png"/></div></div></figure><p id="645a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请注意，您可以利用ALASQL的大多数选项，如下所述:</p><div class="jp jq fm fo jr js"><a href="https://github.com/agershun/alasql/wiki" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab ej"><div class="ju ab jv cl cj jw"><h2 class="bd hv fv z el jx eo ep jy er et ht dt translated">阿格顺/阿拉sql</h2><div class="jz l"><h3 class="bd b fv z el jx eo ep jy er et ek translated">用于浏览器和Node.js的JavaScript SQL数据库。处理传统的关系表和…</h3></div><div class="ka l"><p class="bd b gc z el jx eo ep jy er et ek translated">github.com</p></div></div><div class="kb l"><div class="mh l kd ke kf kb kg kh js"/></div></div></a></div><p id="350d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">显然，您可以将查询结果通过管道传输到一个文件中，如下所示:</p><pre class="lk ll lm ln fq ls lt lu lv aw lw dt"><span id="0300" class="kj kk hu lt b fv lx ly l lz ma">phantomjs scrapepage.js "url" "sql" &gt; somefile.json</span></pre><p id="897d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如，让我们通过键入以下命令创建一个Excel电子表格:</p><pre class="lk ll lm ln fq ls lt lu lv aw lw dt"><span id="05d3" class="kj kk hu lt b fv lx ly l lz ma">phantomjs scrapepage.js "<a class="ae ki" href="https://news.ycombinator.com/news" rel="noopener ugc nofollow" target="_blank">https://news.ycombinator.com/news</a>" "select nodeName,href,innerText INTO XLSXML({headers:true}) from document where className='storylink'" &gt; mydata.xls</span></pre><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff mi"><img src="../Images/e5f607391f8b98fc49df1814f1b76553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XHpOe_7S1WO7NbVuJANdyg.png"/></div></div></figure><p id="3b97" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如你所看到的，你可以通过执行一个简单的命令将任何网页的内容转换成有用的格式。</p><p id="f50d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">文档表中的每一行代表网页的HTML Dom(文档对象模型)树中的一个节点。要查看特定节点上的所有字段，请在浏览器中打开开发工具，查看控制台中的节点:</p><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div class="fe ff mj"><img src="../Images/75ecda304a8fe852a35f789fb0b6c7f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*m-cRGxgLFerGog-RRpvlNQ.png"/></div></figure><p id="a47a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要访问节点上的子属性，请使用以下语法:</p><div class="jp jq fm fo jr js"><a href="https://github.com/agershun/alasql/wiki/JSON" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab ej"><div class="ju ab jv cl cj jw"><h2 class="bd hv fv z el jx eo ep jy er et ht dt translated">阿格顺/阿拉sql</h2><div class="jz l"><h3 class="bd b fv z el jx eo ep jy er et ek translated">用于浏览器和Node.js的JavaScript SQL数据库。处理传统的关系表和…</h3></div><div class="ka l"><p class="bd b gc z el jx eo ep jy er et ek translated">github.com</p></div></div><div class="kb l"><div class="mk l kd ke kf kb kg kh js"/></div></div></a></div><p id="4268" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如，要访问样式对象的属性，可以指定:</p><pre class="lk ll lm ln fq ls lt lu lv aw lw dt"><span id="2365" class="kj kk hu lt b fv lx ly l lz ma">select nodeName,style-&gt;border as border from document</span></pre><p id="ec63" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要调用方法，</p><pre class="lk ll lm ln fq ls lt lu lv aw lw dt"><span id="c1bb" class="kj kk hu lt b fv lx ly l lz ma">select nodeName,attributes-&gt;getNamedItem("href") as href from document</span></pre><p id="b831" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本文只是触及了将PhantomJS与ALASQL结合使用的可能性的皮毛。我强烈推荐阅读这两种产品的文档，以掌握web页面清理的艺术。</p><p id="d014" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你喜欢这篇文章，请推荐！</p><div class="lk ll lm ln fq ab cb"><figure class="ml lo mm mn mo mp mq paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ml lo mm mn mo mp mq paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ml lo mm mn mo mp mq paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mr ms mt"><p id="f922" class="ir is mu it b iu iv iw ix iy iz ja jb mv jd je jf mw jh ji jj mx jl jm jn jo hn dt translated"><a class="ae ki" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ki" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ki" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae ki" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is mu it b iu iv iw ix iy iz ja jb mv jd je jf mw jh ji jj mx jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ki" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ki" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lk ll lm ln fq lo fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff my"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="lk ll lm ln fq lo"><div class="bz el l di"><div class="mz lq l"/></div></figure></div></div>    
</body>
</html>