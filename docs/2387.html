<html>
<head>
<title>Easier Facebook bots using pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用管道的简单脸书机器人</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/easier-facebook-bots-using-pipelines-503da0cd461a?source=collection_archive---------15-----------------------#2017-01-23">https://medium.com/hackernoon/easier-facebook-bots-using-pipelines-503da0cd461a?source=collection_archive---------15-----------------------#2017-01-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="3f05" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我最近试用了Fb机器人，其实挺好玩的。</p><p id="b9a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">他们通过某种程度上直截了当的发布过程，让普通开发人员很容易就能创建出机器人。</p><p id="8e6e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最简单地说，你需要知道的是:</p><p id="6cbb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你需要一个服务器来处理人们输入FB Messenger的信息</p><p id="1b0e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后你只需将这些消息发送回Fb，Fb再将消息发送给用户。</p><p id="4441" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">用HTTP术语来说，每次用户发送一条消息，Fb就把它发送到你的服务器，然后你把响应发送回Fb，Fb再把它转发给用户。</p><p id="7ec9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">管道很好地处理了这种请求/响应模式——著名的是Express使用app.use(function)。让我们构建一个机器人，用. use()函数简化我们的消息处理。</p><p id="a43b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里，我们将使用一个模块fbmbot，它将隐藏所有的express服务器细节，并公开函数来处理来自Fb的消息。它给你这些函数使用，并隐藏了Express服务器和HTTP通信。</p><div class="jp jq fm fo jr js"><a href="https://github.com/digplan/fbmbot" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab ej"><div class="ju ab jv cl cj jw"><h2 class="bd hv fv z el jx eo ep jy er et ht dt translated">digplan/fbmbot</h2><div class="jz l"><h3 class="bd b fv z el jx eo ep jy er et ek translated">fbmbot -更简单的Facebook Messenger机器人</h3></div><div class="ka l"><p class="bd b gc z el jx eo ep jy er et ek translated">github.com</p></div></div><div class="kb l"><div class="kc l kd ke kf kb kg kh js"/></div></div></a></div><pre class="ki kj kk kl fq km kn ko kp aw kq dt"><span id="6c52" class="kr ks hu kn b fv kt ku l kv kw">var bot = require('fbmbot')();<br/><br/>bot.onmessagetext = (user, txt, body) =&gt; {<br/>  bot.sendText(user.id, 'Hi')  // (fbid, txt, [wait seconds, metadata]<br/>}<br/>bot.onpostback = (user, postback) =&gt; {<br/>  ...<br/>}<br/><br/>bot.setupGetStartedButton()  one-time<br/>bot.sendTypingOn(user.id)<br/>bot.sendQuickReply(user.id, [])<br/>bot.sendPromptLocation(user.id)<br/>bot.queryUser(user.id, callback)<br/>bot.sendMessage(user.id, {})<br/>bot.users // [users since bot was restarted]<br/>bot.app  // express app</span></pre><p id="f56e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我会用优秀的Gomix @gomixme游乐场做bot。我们可以简单地使用这个模块来处理请求，我们的机器人是这样创建的:</p><figure class="ki kj kk kl fq ky fe ff paragraph-image"><div class="fe ff kx"><img src="../Images/e87e957475df306753b8b8eec5ef64bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*AKKDhpddiO5kF_bUGFdIKg.jpeg"/></div></figure><p id="a43c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Fb有“回发”的概念，即当某人点击一个按钮时。这将在用户开始新对话时运行。</p><p id="d17b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">onmessage text将处理初始消息之后的新消息。</p><p id="9b85" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，我们来介绍一个处理管道，ala Express。使用()</p><p id="2e7f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这里，我们创建了自己的“用户管理器”，它将通过id查询一个用户信息，并将其保存在users={}中。如果需要在服务器重启时保存，我们可以将它保存在某个地方。即时用户管理器！</p><figure class="ki kj kk kl fq ky"><div class="bz el l di"><div class="la lb l"/></div></figure><p id="8abf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请记住，这些过程顺序相反。第一个bot.use()检查并查看我们是否有用户信息。然后，它发送回带有用户名的响应。</p><p id="56e5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些管道允许以可组合的方式制作你的机器人。</p><blockquote class="lc ld le"><p id="b942" class="ir is lf it b iu iv iw ix iy iz ja jb lg jd je jf lh jh ji jj li jl jm jn jo hn dt translated"><a class="ae lj" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae lj" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae lj" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae lj" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is lf it b iu iv iw ix iy iz ja jb lg jd je jf lh jh ji jj li jl jm jn jo hn dt translated">要了解更多信息，<a class="ae lj" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a>、<a class="ae lj" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上点赞/给我们发消息</a>，或者简单地说，<a class="ae lj" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is lf it b iu iv iw ix iy iz ja jb lg jd je jf lh jh ji jj li jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae lj" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae lj" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote></div></div>    
</body>
</html>