<html>
<head>
<title>Tips and Tricks for Writing Elixir BDD Gherkin Tests with White Bread</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用白面包编写药剂BDD小黄瓜测试的技巧和诀窍</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/tips-and-tricks-for-writing-elixir-bdd-gherkin-tests-with-white-bread-4f9894e9ea18?source=collection_archive---------15-----------------------#2017-02-03">https://medium.com/hackernoon/tips-and-tricks-for-writing-elixir-bdd-gherkin-tests-with-white-bread-4f9894e9ea18?source=collection_archive---------15-----------------------#2017-02-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="eee5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用<a class="ae jp" href="https://github.com/cucumber/cucumber/wiki/Gherkin" rel="noopener ugc nofollow" target="_blank">小黄瓜语法</a>编写行为驱动的<a class="ae jp" href="https://hackernoon.com/tagged/development" rel="noopener ugc nofollow" target="_blank">开发</a>测试是开发人员与非技术员工(例如产品经理)交流的好方法。这是因为小黄瓜语法非常接近英语，阅读或编写它不需要任何技术专业知识。它只需要以一致和已知的方式编写，这样它就可以被解释为可执行代码的步骤。</p><p id="9889" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">许多语言都有很棒的BDD小黄瓜库，比如cumber用于Ruby，Behat用于PHP。我认为目前最适合长生不老药语言的是由meadsteve创建的白面包库。</p><p id="c98b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这篇文章不是关于白面包的入门指南，如果你正在寻找，我建议你看一看白面包项目的<code class="eh jq jr js jt b">README.md</code>。根据我的经验，这篇文章更像是从白面包(和小黄瓜)中获取最佳营养的提示和技巧指南。</p></div><div class="ab cl ju jv hc jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hn ho hp hq hr"><p id="5403" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一个建议适用于为任何编程语言编写小黄瓜。也就是说，以一种可重用和显式的方式编写您的小黄瓜步骤。首先，我会给你看一个不要做什么的例子，然后解释我们如何收拾残局。让我们从一个如下所示的特征文件开始:</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="7b0a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，这些步骤中的每一个都写得很相似，但是有细微的差别，因此需要在代码中有不同的实现。让我们看看与这些步骤相匹配的上下文代码:</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="11a2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经从上面的上下文中省略了一些步骤，但是你已经可以看到在相似的步骤之间有多少重复。为了避免这种情况，应该以可重用的方式编写步骤，其中可以使用变量，以便可以对每个步骤执行相同的上下文步骤，如下所示:</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="9690" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这允许使用相同的步骤，即使用于用户名的名称不同，如我们所见:</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="ecbf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面的步骤使用Regex的能力来捕获两个语音标记之间的名称，并将其设置为<code class="eh jq jr js jt b">name</code>变量。</p><p id="a010" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以进一步清理这个特征文件。如果我们想写一个步骤来改变一个用户的电子邮件地址呢？那离改名字那么近，为什么要用两个不同的步骤呢？</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="892c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将允许使用相同的步骤，而不管用户的哪个属性正在被改变。</p><p id="fc8d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我想注册一个用户，但不在乎给他们一个特定的名称。我可以想出一个默认的名字(例如John ),然后像这样重构步骤:</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="5b09" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种重构背后的想法是，你可以写尽可能少的代码，并保持代码干燥(不要重复)。但是你可能会把重构做得太过火，把小黄瓜语法推到一个非技术人员无法清楚理解的程度，所以在做这种重构的时候要记住这一点。</p></div><div class="ab cl ju jv hc jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hn ho hp hq hr"><p id="a680" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我推荐的第二件事是每个特性文件都有自己的上下文文件。我设置的方式是每个特性文件也有一个套件，有一个<code class="eh jq jr js jt b">context_per_feature</code>配置，但是我发现这个使用起来很麻烦。因此，我的配置文件应该是这样的:</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="3c71" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我这样做的原因是为了让每个特性都有自己的入口点，可以进入您将要编写的所有不同的上下文模块。</p></div><div class="ab cl ju jv hc jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hn ho hp hq hr"><p id="fd05" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我建议的第三件事是，当你发现自己在编写一个可以被多个特性重用的步骤时，把它放在自己的上下文中！这样，每个功能都可以共享这个公共步骤。</p><p id="ef73" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我经常发现自己需要的一步是什么都没发生。这一开始听起来可能很傻，但是小黄瓜语言要求每个特性都有一个给定的步骤，有时我不需要在给定的步骤中进行任何设置。看起来是这样的:</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="4645" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了将它添加到另一个上下文中，我将使用如下所示的<code class="eh jq jr js jt b">subcontext</code>:</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="c279" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这样，作为特性文件入口点的上下文就很小，并且只有特定于特性的步骤，这也有助于保持代码干燥。</p></div><div class="ab cl ju jv hc jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hn ho hp hq hr"><p id="549f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后一个建议是创建一个带有状态帮助函数的模块。</p><p id="8f72" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">White Bread允许您在每个步骤之间传递状态，例如，如果您在第一步中添加了一个用户并获得了他们的ID，然后在下一步中需要该ID来对用户进行进一步的修改，那么这是必需的。</p><p id="a496" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">状态只是一个映射，所以向其添加数据很容易，但是最好将该逻辑封装在一些帮助函数中，如下所示:</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="351d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用这些助手函数，我们前面的例子看起来会像这样:</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kg kh l"/></div></figure><p id="5df9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这样做的好处可能还不明显，但是一旦有20多个上下文文件都以可能略有不同的方式操作状态，好处就会变得明显。</p></div><div class="ab cl ju jv hc jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hn ho hp hq hr"><p id="daf5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就是这样！感谢您的阅读，我希望您发现上面的一些提示和技巧是有用的。</p><p id="3c18" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，我恳求你为白面包项目捐款。Elixir是一种每天都在增长的语言，它需要一个强大的BDD小黄瓜库，我认为白面包可以成为这样的库。</p><blockquote class="ki kj kk"><p id="fafc" class="ir is kl it b iu iv iw ix iy iz ja jb km jd je jf kn jh ji jj ko jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is kl it b iu iv iw ix iy iz ja jb km jd je jf kn jh ji jj ko jl jm jn jo hn dt translated">要了解更多信息，请<a class="ae jp" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">阅读我们的“关于”页面</a>、<a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上点赞/给我们发消息</a>，或者简单地说，<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is kl it b iu iv iw ix iy iz ja jb km jd je jf kn jh ji jj ko jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="kp kh l"/></div></figure></div></div>    
</body>
</html>