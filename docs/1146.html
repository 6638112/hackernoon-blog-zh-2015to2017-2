<html>
<head>
<title>Why you should care about your Swift compile time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么您应该关心您的快速编译时间</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/why-you-should-care-about-your-swift-compile-time-f69f9054610c?source=collection_archive---------2-----------------------#2016-09-13">https://medium.com/hackernoon/why-you-should-care-about-your-swift-compile-time-f69f9054610c?source=collection_archive---------2-----------------------#2016-09-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="3e08" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是一个关于Travis-CI T2 50分钟构建超时T3让我关心代码编译时间的故事。</p><p id="9dec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> TL:DR: </strong>安装<a class="ae jp" href="https://github.com/RobertGummesson/BuildTimeAnalyzer-for-Xcode" rel="noopener ugc nofollow" target="_blank">构建时分析器</a>，将<a class="ae jp" href="https://gist.github.com/ivanbruel/408e5b1fd11fcce83de6e7ffb3de24ea" rel="noopener ugc nofollow" target="_blank">这个</a>添加到你的Podfile中，<a class="ae jp" rel="noopener" href="/@RobertGummesson/regarding-swift-build-time-optimizations-fc92cdd91e31#.ial53sjhi">修复</a>你的代码，<a class="ae jp" href="https://github.com/BradLarson/GPUImage2/pull/60" rel="noopener ugc nofollow" target="_blank">为你的依赖项制作PRs </a>，花更少的时间编译。</p><h1 id="a252" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">特拉维斯·CI的奋斗</h1><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div class="fe ff ko"><img src="../Images/2f24f1af2409e2f2ef510e1d5e6aee8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*CV7aVhGfXhoSq4-9wYbOKw.png"/></div></figure><p id="eebd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Travis CI与许多其他CI平台一样，为开源提供了一个免费层，但并非没有限制。在Travis的具体案例中，限制是<a class="ae jp" href="https://docs.travis-ci.com/user/customizing-the-build#Build-Timeouts" rel="noopener ugc nofollow" target="_blank"> 50分钟的构建时间</a>。</p><p id="75b2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我理解为开源项目提供这样一个伟大工具的服务器成本，但这种限制似乎也存在于<a class="ae jp" href="http://travis-ci.com" rel="noopener ugc nofollow" target="_blank">Travis-CI.com</a>上(Travis CI的付费版本)。</p><p id="3439" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尽管这对于测试大型框架来说不成问题，例如<a class="ae jp" href="https://github.com/ReactiveX/RxSwift" rel="noopener ugc nofollow" target="_blank">rx swift</a>(997次测试)或<a class="ae jp" href="https://github.com/ReactiveCocoa/ReactiveCocoa" rel="noopener ugc nofollow" target="_blank">react ive cocoa</a>(1508次测试)，但是对于测试/部署具有大量依赖项和/或庞大代码库的实际应用来说就不一样了。</p><h1 id="6d54" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">瑞士作为研究案例</h1><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div class="fe ff kw"><img src="../Images/6e993be270d66df3c7e9174f8ac7ce8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*7nkfZhdFBK_4qfH1myKXow.png"/></div><figcaption class="kx ky fg fe ff kz la bd b be z ek">SwipeIt — Reddit with a swipe</figcaption></figure><p id="b9d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在过去的几个月里，我一直在开发<a class="ae jp" href="https://github.com/ivanbruel/SwipeIt" rel="noopener ugc nofollow" target="_blank"> SwipeIt </a>作为基准测试的一部分，在<a class="ae jp" href="https://hackernoon.com/tagged/ios" rel="noopener ugc nofollow" target="_blank"> iOS </a>开发中开发<a class="ae jp" href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel" rel="noopener ugc nofollow" target="_blank"> MVVM </a>和<a class="ae jp" href="https://developer.apple.com/library/ios/documentation/General/Conceptual/DevPedia-CocoaCore/MVC.html" rel="noopener ugc nofollow" target="_blank"> MVC </a>(你可以在<a class="ae jp" rel="noopener" href="/faber-dev/mvvm-benchmark-in-an-mvc-world-part-1-dab952617395">另一个媒体故事</a>中了解更多)。</p><p id="d778" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lb"> SwipeIt </em>是一款<em class="lb"> Tinder </em> like app，用于<a class="ae jp" href="https://www.reddit.com/" rel="noopener ugc nofollow" target="_blank"><em class="lb">Reddit</em></a><em class="lb"/>在这里，你必须投票支持或否决一个链接，才能进入下一个链接。</p><p id="906c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为参考<em class="lb">，SwipeIt </em>在单元测试目标上有大约10个依赖项，编译72个<em class="lb">。swift </em>文件(其中16个是<em class="lb"> specs </em>)复制20个bundle资源(包括<em class="lb"> JSON </em>文件和<em class="lb"> HTML </em>)。</p><p id="d8c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">至于实际的应用目标，它有28个依赖项，编译132个<em class="lb">。swift </em>归档并复制6个捆绑包资源。</p><p id="7640" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Travis上的<a class="ae jp" href="https://travis-ci.org/ivanbruel/SwipeIt/builds/150973201" rel="noopener ugc nofollow" target="_blank">最后一次(未优化)成功测试运行</a>耗时14分钟，通过了77项测试。在这14分钟里，只有<strong class="it hv"> 2.4秒</strong>花在了实际测试上，而其余的时间都花在了构建所需的文件上。</p><h2 id="bec6" class="lc jr hu bd js ld le lf jw lg lh li ka jc lj lk ke jg ll lm ki jk ln lo km lp dt translated">接下来是部署</h2><p id="e8ad" class="pw-post-body-paragraph ir is hu it b iu lq iw ix iy lr ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">这就是构建时间变得困难的地方。鉴于单元测试在<a class="ae jp" href="https://hackernoon.com/tagged/debug" rel="noopener ugc nofollow" target="_blank"> <em class="lb">调试</em> </a>构建设置上运行，对<em class="lb"> Fabric </em>、<em class="lb"> Testflight </em>或<em class="lb"> HockeyApp </em>的任何部署都应该在<em class="lb">发布</em>构建设置上运行。这导致共享依赖项和被测试代码的实际构建时间增加了2倍。</p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/9f93fe296af9d0f1a4569e7ed9d444ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*zDG5nXefvWUw6e1cFlL5XQ.jpeg"/></div><figcaption class="kx ky fg fe ff kz la bd b be z ek">Jack Bauer meme, circa 2004</figcaption></figure><p id="9bb1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如在<a class="ae jp" href="https://travis-ci.org/ivanbruel/SwipeIt/builds" rel="noopener ugc nofollow" target="_blank"> Travis-CI的构建历史</a>中可以看到的，一个<em class="lb">测试</em>和<em class="lb">部署</em>策略花费了超过50分钟的阈值。</p><h1 id="13ca" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">Swift和构建时间分析器</h1><p id="ea7e" class="pw-post-body-paragraph ir is hu it b iu lq iw ix iy lr ja jb jc ls je jf jg lt ji jj jk lu jm jn jo hn dt translated">众所周知，Swift在类型推断、零合并运算符、强制转换、惰性属性和其他一些方面存在编译时问题(更多信息，请查看<a class="ae jp" rel="noopener" href="/@RobertGummesson/regarding-swift-build-time-optimizations-fc92cdd91e31#.ial53sjhi">这篇精彩的帖子</a>和<a class="ae jp" rel="noopener" href="/swift-programming/swift-build-time-optimizations-part-2-37b0a7514cbe#.t4h9ch9dr">的后续文章</a>)。</p><p id="e52d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有了<a class="ae jp" href="https://github.com/RobertGummesson/BuildTimeAnalyzer-for-Xcode" rel="noopener ugc nofollow" target="_blank">构建时间分析器</a>，我们可以很容易地了解哪些部分的代码编译时间最长。</p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff lw"><img src="../Images/8df2474ebc2b9f8c4b36c675b2605c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5tNHJ4zpKwaQs4leQSlPvg.png"/></div></div><figcaption class="kx ky fg fe ff kz la bd b be z ek">SwipeIt’s Build Time Analyzer</figcaption></figure><p id="1649" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尽管BTA确实有助于调试我可能做错的地方，但是大部分编译时间实际上都花在了依赖项上。</p><figure class="kp kq kr ks fq kt"><div class="bz el l di"><div class="mb mc l"/></div></figure><p id="25e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将上面的代码添加到你的<em class="lb"> Podfile </em>将确保你可以<em class="lb">构建时间分析器</em>也将分析你的<em class="lb"> Cocoapod </em>依赖项。</p><h1 id="a7d6" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">拯救世界一次一个公关</h1><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div class="fe ff md"><img src="../Images/d1764eb37161aee068bd5b557e48c27e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*_8Zbnw74-k1t3LVOh50LsA.png"/></div></figure><p id="aa79" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当时我发现我的大部分编译时间都花在了两个流行的库上，<a class="ae jp" href="https://github.com/BradLarson/GPUImage2" rel="noopener ugc nofollow" target="_blank"> GPUImage2 </a>和<a class="ae jp" href="https://github.com/Hearst-DD/ObjectMapper" rel="noopener ugc nofollow" target="_blank"> ObjectMapper </a>。</p><p id="eb0c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从我的两个拉请求<a class="ae jp" href="https://github.com/BradLarson/GPUImage2/pull/60" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae jp" href="https://github.com/Hearst-DD/ObjectMapper/pull/557" rel="noopener ugc nofollow" target="_blank">这里</a>可以看出，通过解决<em class="lb"> Swift </em>的编译器问题，可以节省很多时间。</p><p id="113a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然在<em class="lb"> ObjectMapper </em>上节省<strong class="it hv"> 1秒</strong>和在<em class="lb"> GPUImage2 </em>上节省<strong class="it hv"> 9秒</strong>可能看起来无关紧要，但这些指标是在最新的Macbook Pro Retina 13英寸上获得的。不是每个使用这些库的人都有如此强大的笔记本电脑，尤其是在CI平台上，这几秒钟可能会变成几分钟。</p><p id="1301" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，通过优化我的代码、隔离测试目标和调整我的<a class="ae jp" href="https://github.com/ivanbruel/SwipeIt/blob/master/fastlane/Fastfile" rel="noopener ugc nofollow" target="_blank"> <em class="lb">【浪子</em> </a>配置，我让<em class="lb"> SwipeIt </em>只花了7分钟来测试和33分钟来测试<em class="lb"/>+<em class="lb">在Travis-CI 上部署</em>任务<a class="ae jp" href="https://travis-ci.org/ivanbruel/SwipeIt/builds/158714039" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="b067" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的干净构建也少了很多:)</p><div class="kp kq kr ks fq ab cb"><figure class="me kt mf mg mh mi mj paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="me kt mf mg mh mi mj paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="me kt mf mg mh mi mj paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mk ml mm"><p id="f922" class="ir is lb it b iu iv iw ix iy iz ja jb mn jd je jf mo jh ji jj mp jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is lb it b iu iv iw ix iy iz ja jb mn jd je jf mo jh ji jj mp jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kp kq kr ks fq kt fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff mq"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure><figure class="kp kq kr ks fq kt"><div class="bz el l di"><div class="mr mc l"/></div></figure></div></div>    
</body>
</html>