<html>
<head>
<title>ELI5: What does Square’s Flow library do?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Eli 5:Square的流量库是做什么的？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/eli5-what-does-squares-flow-library-do-ecd497b61dc3?source=collection_archive---------6-----------------------#2016-12-07">https://medium.com/hackernoon/eli5-what-does-squares-flow-library-do-ecd497b61dc3?source=collection_archive---------6-----------------------#2016-12-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/7ea7bf9c25c3afe575280749ee5bf905.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rm7bwbakSD2cJ4PjJSwjnw.png"/></div></div></figure><p id="3c1a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" href="https://github.com/square/flow/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">流</strong> </a>(或者我的叉吧，<a class="ae ka" href="https://github.com/Zhuinden/flowless" rel="noopener ugc nofollow" target="_blank">无流</a>)是背刺。嗯，<a class="ae ka" href="https://hackernoon.com/tagged/tachnically" rel="noopener ugc nofollow" target="_blank">技术上来说</a>是持有<a class="ae ka" href="https://hackernoon.com/tagged/backstack" rel="noopener ugc nofollow" target="_blank">逆推</a>的东西，叫做<strong class="je hv">历史</strong>。</p><p id="971d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh kb kc kd ke b">History</code>是——你可以猜到——应用程序在给定时间的历史。这个<code class="eh kb kc kd ke b">History</code>实际上只是一个对象列表——尽管它的索引是反向的，其中<code class="eh kb kc kd ke b">get(0)</code>返回最后插入的元素，而<code class="eh kb kc kd ke b">get(size-1)</code>返回第一个插入的元素。一堆，如果你愿意的话。</p><pre class="kf kg kh ki fq kj ke kk kl aw km dt"><span id="f6d6" class="kn ko hu ke b fv kp kq l kr ks">A  ← top <strong class="ke hv">element</strong>, .get(0)<br/>-<br/>B<br/>-<br/>C<br/>-<br/>D</span></pre><p id="6997" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">作为列表:</p><p id="fc0b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh kb kc kd ke b">[D,C,B,A]</code></p><p id="bcc2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这个列表中，对象<code class="eh kb kc kd ke b">D</code>、<code class="eh kb kc kd ke b">C</code>、<code class="eh kb kc kd ke b">B</code>、<code class="eh kb kc kd ke b">A</code>只是一个类的简单实例，带有一些数据字段和hashCode/equals方法；也称为“值对象”。这只是一个看起来像这样的类</p><pre class="kf kg kh ki fq kj ke kk kl aw km dt"><span id="414a" class="kn ko hu ke b fv kp kq l kr ks"><strong class="ke hv">public class </strong>A {<br/>    <strong class="ke hv">private final </strong>String <strong class="ke hv">data</strong>;<br/><br/>    <strong class="ke hv">public </strong>A(String data) {<br/>        <strong class="ke hv">this</strong>.<strong class="ke hv">data </strong>= data;<br/>    }<br/><br/>    @Override<br/>    <strong class="ke hv">public boolean </strong>equals(Object object) { <em class="kt">// auto-generated<br/>        </em><strong class="ke hv">if</strong>(object == <strong class="ke hv">null</strong>) {<br/>            <strong class="ke hv">return false</strong>;<br/>        }<br/>        <strong class="ke hv">if</strong>(!(object <strong class="ke hv">instanceof </strong>A)) {<br/>            <strong class="ke hv">return false</strong>;<br/>        }<br/>        <strong class="ke hv">return </strong>StringUtils.equals(<strong class="ke hv">this</strong>, <strong class="ke hv">data</strong>, ((A) object).<strong class="ke hv">data</strong>);<br/>    }<br/><br/>    @Override<br/>    <strong class="ke hv">public int </strong>hashCode() { <em class="kt">// auto-generated<br/>        </em><strong class="ke hv">return </strong>getClass().hashCode() + 31 * (<strong class="ke hv">null </strong>== <strong class="ke hv">data </strong>? 0 : <strong class="ke hv">data</strong>.hashCode());<br/>    }<br/>}</span></pre><p id="dfd3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以，这个<code class="eh kb kc kd ke b">A</code>完全简单的对象被称为<code class="eh kb kc kd ke b">Key</code>，它只包含一个字符串并覆盖equals/hashCode。这代表了您在应用程序中的位置。</p><p id="5834" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在活动的情况下，这意味着您有以下活动:</p><p id="3310" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh kb kc kd ke b">DActivity, CActivity, BActivity, AActivity</code></p><p id="98fc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在<code class="eh kb kc kd ke b">onStop</code>中<code class="eh kb kc kd ke b">DActivity</code>、<code class="eh kb kc kd ke b">CActivity</code>、<code class="eh kb kc kd ke b">BActivity</code>会在背景中(但不会被破坏)，而<code class="eh kb kc kd ke b">AActivity</code>在前面(调用<code class="eh kb kc kd ke b">onStart()</code>和<code class="eh kb kc kd ke b">onResume()</code>)。</p><p id="1aa5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当你在<code class="eh kb kc kd ke b">BActivity</code>中启动<code class="eh kb kc kd ke b">AActivity</code>时，发生的事情是<code class="eh kb kc kd ke b">BActivity</code>被放到<code class="eh kb kc kd ke b">onPause()</code>中，<code class="eh kb kc kd ke b">AActivity</code>启动并被放到……实际上，让我来抓取文档</p><blockquote class="ku kv kw"><p id="fa59" class="jc jd kt je b jf jg jh ji jj jk jl jm kx jo jp jq ky js jt ju kz jw jx jy jz hn dt translated">执行活动A的onPause()方法。</p><p id="0424" class="jc jd kt je b jf jg jh ji jj jk jl jm kx jo jp jq ky js jt ju kz jw jx jy jz hn dt translated">活动B的onCreate()、onStart()和onResume()方法按顺序执行。(活动B现在有了用户焦点。)</p><p id="17b3" class="jc jd kt je b jf jg jh ji jj jk jl jm kx jo jp jq ky js jt ju kz jw jx jy jz hn dt translated">然后，如果Activity A在屏幕上不再可见，它的onStop()方法就会执行。</p></blockquote><p id="2a79" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但在这种情况下，我不得不:</p><p id="274d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.)查看文档，了解发生了什么</p><p id="2cd3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.)backstack是隐式的，所以立即从<code class="eh kb kc kd ke b">AActivity</code>到<code class="eh kb kc kd ke b">CActivity</code>是非常非常困难的。你需要修补<code class="eh kb kc kd ke b">CLEAR_TOP</code>意图标志，并希望它实际工作。如果没有，你甚至可以在你的活动上设置<code class="eh kb kc kd ke b">singleTop</code> launchMode，以某种方式最终让它工作。</p><p id="d917" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt">— — — — -</p><p id="0394" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">就心流而言，这并不复杂。当你打电话时</p><p id="5d0c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh kb kc kd ke b">Flow.get(this).set(A.create());</code></p><p id="951d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">那么你收到的就叫做“遍历”，是“分派”的。简而言之，它告诉你发生了一些事情，并显示你之前在应用程序中的位置:<code class="eh kb kc kd ke b">[D,C,B]</code>，以及你正在前往的位置:<code class="eh kb kc kd ke b">[D,C,B,A]</code>。</p><p id="0f0b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你在<code class="eh kb kc kd ke b">[D,C,B,A]</code>中调用<code class="eh kb kc kd ke b">Flow.get(this).set(C.create());</code>，那么你将得到一个遍历，表明你在<code class="eh kb kc kd ke b">[D,C,B,A]</code>中，你将到达<code class="eh kb kc kd ke b">[D,C]</code>。</p><p id="d92e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">发生了什么(我从文档中抓取的东西)完全由你来写<em class="kt">，所以你可以直接控制发生了什么。</em></p><p id="5617" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这通常意味着您最终会:</p><p id="1603" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">-检查您是否仍处于完全相同的状态，如果是，则不做任何事情(告诉流您已经处理了遍历)<br/> -保持当前布局的状态<br/> -移除当前布局<br/> -膨胀新布局<br/> -恢复新布局的状态(如果状态存在)<br/> -添加新布局<br/> -告诉流您已经处理了遍历</p><p id="4830" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">(<a class="ae ka" href="https://github.com/Zhuinden/flowless/blob/master/flowless-sample-transitions/src/main/java/com/zhuinden/flowtransitions/TransitionDispatcher.java#L40-L62" rel="noopener ugc nofollow" target="_blank">这里有一个简单调度器的例子</a>)</p><p id="4af2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt">— — — — — —</p><p id="0984" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这实际上很棒，原因有很多:</p><p id="d9eb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">1.)在<code class="eh kb kc kd ke b">onPause()</code>中，后台的视图不会被破坏，所以您不必确保在返回时“重新加载数据并刷新”</p><p id="266b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">2.)视图被销毁，从而释放了内存，这更具性能</p><p id="ee24" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">3.)活动转换有额外的开销，这使得它们比视图转换慢(同样，<code class="eh kb kc kd ke b">TransitionEverywhere</code>对视图有效，但对活动/片段无效)</p><p id="e562" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">4.)现在，您可以直接访问“您在应用程序中的位置”，还可以访问“当我从这里到那里时会发生什么”，这样设置遍历实际上非常容易:</p><p id="e33e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh kb kc kd ke b">[D,C,B,A]</code> = &gt; <code class="eh kb kc kd ke b">[C,E,B]</code></p><p id="5e23" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为这实际上只是</p><pre class="kf kg kh ki fq kj ke kk kl aw km dt"><span id="cb2d" class="kn ko hu ke b fv kp kq l kr ks">Flow.get(<strong class="ke hv">this</strong>).setHistory(<br/>        History.newBuilder()<br/>            .push(C.create())<br/>            .push(E.create())<br/>            .push(B.create())<br/>        .build()<br/>);</span></pre><p id="7488" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您打算如何使用活动堆栈和意图标志来实现这一点？没有该死的线索！</p><p id="deb6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt">— — — — — — — — — — — — — — — — — — — — — — —</p><p id="4413" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt">— — — — — — — — — — — — — — — — — — — — — — —</p><p id="6869" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">TL；DR: <strong class="je hv"> Flow </strong>是一个backstack库，允许您轻松地保持/恢复视图的状态，并允许您处理在给定时刻的位置和前进方向之间的变化。这差不多就是它所做的一切。</p><p id="0a15" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kt"> (Reddit讨论线程:</em><a class="ae ka" href="https://www.reddit.com/r/androiddev/comments/5h0er6/eli5_what_does_squares_flow_library_do/" rel="noopener ugc nofollow" target="_blank"><em class="kt">https://www . Reddit . com/r/androiddev/comments/5h0er 6/Eli 5 _ what _ does _ squares _ flow _ library _ do/</em></a><em class="kt">)</em></p><div class="kf kg kh ki fq ab cb"><figure class="la iv lb lc ld le lf paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="la iv lb lc ld le lf paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="la iv lb lc ld le lf paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ku kv kw"><p id="f922" class="jc jd kt je b jf jg jh ji jj jk jl jm kx jo jp jq ky js jt ju kz jw jx jy jz hn dt translated"><a class="ae ka" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿妹家庭的一员。我们现在<a class="ae ka" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ka" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd kt je b jf jg jh ji jj jk jl jm kx jo jp jq ky js jt ju kz jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ka" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ka" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lg"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><p id="4bb8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" href="https://upscri.be/hackernoon/" rel="noopener ugc nofollow" target="_blank">https://upscri.be/hackernoon/</a></p></div></div>    
</body>
</html>