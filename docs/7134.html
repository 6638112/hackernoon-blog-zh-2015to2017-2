<html>
<head>
<title>Microservices in Java — A Second Look</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java中的微服务——再看</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/microservices-in-java-a-second-look-460ba3909c44?source=collection_archive---------1-----------------------#2017-10-18">https://medium.com/hackernoon/microservices-in-java-a-second-look-460ba3909c44?source=collection_archive---------1-----------------------#2017-10-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="1173" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以最近我发表了一篇名为《Java 中的微服务？从来没有。”这严重分裂了阵营。对语言、工具、框架等充满热情的Java开发人员提出了一些非常好的反驳，在阅读了这些观点后，我想我应该再看一眼这种语言及其对基于微服务的<a class="ae jp" href="https://hackernoon.com/tagged/future" rel="noopener ugc nofollow" target="_blank">未来</a>的适用性。</p><h2 id="c32b" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">我第一个论点中的漏洞</h2><p id="a559" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">当提出我最初的论点时，我认为我没有足够清楚地说明我最初的内存需求来自哪里。老实说，正如一个人所说的，我的确是在拿苹果和橘子做比较。</p><p id="6aac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我说过，在Spring Boot上运行一个基本的Java应用程序至少需要1GB的RAM才能运行。我们遇到了基于CloudFoundry的Spring boot应用程序的问题，如果它们没有设置为1GB的最小值，就会出现内存不足的错误并崩溃。因此，如果您要将一个整体应用程序分解成一系列微服务，那么所述微服务的每个实例至少需要1GB的RAM。你可以用512MB启动应用程序，但你偶尔会发现你的应用程序在奇怪的情况下崩溃。</p><p id="7b14" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我在上一篇文章中收到的一些反馈表明，您可以使用内存计算器来指定堆空间大小之类的东西，但是平心而论，开发团队在正常环境中这样做的可能性微乎其微。</p><p id="3459" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我用这个作为我的论点的基础，虽然这对于一个这样的环境来说是正确的，但是把所有的Java应用程序都归为一类是有点不公平的。</p><h2 id="20c7" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">深入挖掘</h2><p id="67a3" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">让我们来看看3种不同的语言；当然是Java，Python和Go。为了进行更公平的比较，我们将编写3个准系统http服务器，当根路径被点击时，它们将返回“Hello World”。</p><p id="66dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还将使用Docker运行这3个不同的应用程序。为了子孙后代，我将包含用于构建和运行这些基于docker的容器的源文件。这些将是我有限的Docker知识所允许的最小限度。</p><h2 id="a6b9" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">Go示例</h2><p id="32b5" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">我们的go服务器的docker文件如下所示。</p><figure class="kq kr ks kt fq ku"><div class="bz el l di"><div class="kv kw l"/></div></figure><p id="a335" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的go服务器将利用<code class="eh kx ky kz la b">"net/http"</code>包，看起来像这样:</p><figure class="kq kr ks kt fq ku"><div class="bz el l di"><div class="kv kw l"/></div></figure><h2 id="d53e" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">Java的例子</h2><p id="5d19" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">我们的Java示例将使用一个非常简单的httpserver，使用sun库来运行它。</p><figure class="kq kr ks kt fq ku"><div class="bz el l di"><div class="kv kw l"/></div></figure><p id="323a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将使用Java 8作为Java示例的基础映像</p><figure class="kq kr ks kt fq ku"><div class="bz el l di"><div class="kv kw l"/></div></figure><h2 id="93e3" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">Python的例子</h2><p id="e701" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">我们的Python库应该是一个基于flask的应用程序。</p><figure class="kq kr ks kt fq ku"><div class="bz el l di"><div class="kv kw l"/></div></figure><p id="bad6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将使用Python 2.7作为docker容器的基础。</p><figure class="kq kr ks kt fq ku"><div class="bz el l di"><div class="kv kw l"/></div></figure><h2 id="fabd" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">基线结果</h2><p id="b2dd" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">在运行这3个不同的容器时，我对Python的结果感到非常惊讶。Python消耗的基本内存比基于Java和Go的等效内存的总和还要多。</p><p id="0b3d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不出所料，基于Go的等效程序仅占用1MB多一点。Java版本刚刚超过10MB，Python 2.7 Docker镜像需要15MB。</p><figure class="kq kr ks kt fq ku fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lb"><img src="../Images/ab97b8b66805a1bbe889b390301683d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q80YLDwyHKxrrXlItV6Wpg.png"/></div></div></figure><h2 id="de67" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">深入挖掘</h2><p id="69c4" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">因此，基于这些有点奇怪的结果，我决定深入研究一下，看看Spring Boot这样的应用程序会消耗多少资源，以及基于Python 3 aiohttp/asyncio的服务器会消耗多少资源。令我惊讶的是，我发现Python 3版本的aiohttp更重，运行一个简单的服务器大约需要18MB。</p><h2 id="6a90" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">Spring Boot巨人</h2><p id="72f6" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">现在是检验Spring Boot码头集装箱的时候了。我构建了一个hello-world风格的Spring Boot应用程序，并使用maven编译它。我启动了它，发现它使用的内存是基于go的同类软件的260倍。</p><p id="c5f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们示例应用程序的docker文件如下所示:</p><figure class="kq kr ks kt fq ku"><div class="bz el l di"><div class="kv kw l"/></div></figure><p id="f80e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然我们的项目依赖项的总和采用这种形式:</p><figure class="kq kr ks kt fq ku"><div class="bz el l di"><div class="kv kw l"/></div></figure><p id="1e17" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如你所看到的，除了json库之外什么也没有，我们的spring boot依赖项就放在这里。</p><p id="4300" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在构建docker映像并启动它之后，我们得到了如下结果:</p><figure class="kq kr ks kt fq ku fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lj"><img src="../Images/b8a9e2bbf415e5f1d6e4b6a4097f9470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nlS6ZQmyzd6LuJn-1GB7Ag.png"/></div></div><figcaption class="lk ll fg fe ff lm ln bd b be z ek">The final somewhat horrifying results</figcaption></figure><h2 id="03fa" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">结论</h2><p id="17e0" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">相比较而言，使用像Spring Boot这样的东西作为你所有微服务的基础，你可能会面临和我之前文章中描述的差不多的命运。您将在基础设施成本方面付出更多，并且您最终将为大多数项目中根本不需要的功能买单。</p><p id="c45d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在每个项目中使用Spring Boot就像买了一台高性能游戏电脑，而你真正需要的只是一个树莓派。通过选择一个较小的框架和考虑你的选择之前，你Spring Boot所有的事情！你可以为自己省下一大笔钱。</p><figure class="kq kr ks kt fq ku"><div class="bz el l di"><div class="lo kw l"/></div></figure></div></div>    
</body>
</html>