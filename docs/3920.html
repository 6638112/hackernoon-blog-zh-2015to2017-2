<html>
<head>
<title>Configuring Proguard and Xamarin Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">配置Proguard和Xamarin Android</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/configuring-proguard-and-xamarin-android-eea5a56bc316?source=collection_archive---------8-----------------------#2017-05-01">https://medium.com/hackernoon/configuring-proguard-and-xamarin-android-eea5a56bc316?source=collection_archive---------8-----------------------#2017-05-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><h1 id="c9cd" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">方案</h1><p id="9c8d" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">最近，我决定在我的应用程序中加入谷歌分析。虽然这对于理解用户通过应用程序的路径是必要的，但添加Android版本的SDK并没有想象中那么容易。</p><p id="2331" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">首先，我决定从Xamarin store中添加SDK作为组件。这很容易做到，但是当我添加SDK时，它带来了一大堆我不需要的依赖项。</p><p id="b846" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">对我来说不幸的是，这让我超过了apk的Dex限制(大约是限制的两倍)。因此，我做了一些研究，所有的答案都告诉我要启用Proguard。Proguard是一个工具，它将去掉任何不使用的代码和方法，减少APK的大小，并且不包括谷歌分析决定加入的20个新依赖项中的任何一个。只是我实际使用的一些代码。</p><h1 id="77aa" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">解决办法</h1><p id="4a6f" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">所以在Xamarin中启用Proguard有多难。Android be？</p><p id="a032" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">结果很难！下面是我让它工作的步骤和我在这个过程中学到的东西。</p><p id="bd10" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">首先，如果你的目标是Android 7 / N / API 24 /谷歌决定为Android版本起的其他名字，那么你需要更换使用的Proguard版本。这可以通过以下步骤完成:</p><ol class=""><li id="51ae" class="ks kt hu jr b js kn jw ko ka ku ke kv ki kw km kx ky kz la dt translated">从<a class="ae lb" href="https://sourceforge.net/projects/proguard/files/" rel="noopener ugc nofollow" target="_blank">这里</a>下载Proguard的最新版本</li><li id="eefa" class="ks kt hu jr b js lc jw ld ka le ke lf ki lg km kx ky kz la dt translated">找到你的Android SDK的安装位置。在我的mac上，我似乎有两个安装。一个用于Android Studio使用的Android原生版本。另一个是Xamarin使用的Android版本。因为我是为基于Xamarin的构建而做的，所以我将使用它的位置，在这种情况下，它类似于“/Users/your username/Library/Developer/xa marin/Android-SDK-ma cosx/tools/proguard”</li><li id="cdc3" class="ks kt hu jr b js lc jw ld ka le ke lf ki lg km kx ky kz la dt translated">用新版本替换旧版本的Proguard。要做到这一点，将当前文件夹重命名为类似“Proguard-needless”的名称，并将新文件夹复制到tools文件夹中。确保新版本的文件夹重命名为“proguard”。</li><li id="9503" class="ks kt hu jr b js lc jw ld ka le ke lf ki lg km kx ky kz la dt translated">确保所有配置文件也复制到新的Proguard文件夹中。对我来说，这是proguard-android-optimize.txt、proguard-android.txt和proguard-project.txt。</li></ol><p id="4f4d" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">现在您有了正确的版本，您需要为您的Android项目启用Proguard。这可以通过右击您的。Xamarin studio中的Droid项目并选择选项。一旦面板打开，在Build部分下面找到Android Build，选择你要发布的配置，然后选择Enable Proguard复选框。见下面截图，供参考。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/85bc21c7bf58b67c7ada3bc692db5856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YIlyMM-R6WAE843K6ZZD3w.png"/></div></div></figure><p id="1802" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">一旦您为项目配置了Proguard，请确保您在Xamarin Studio中以发布模式作为目标进行构建。试着构建一下，看看会发生什么。就我而言，我收到了与谷歌地图、脸书广告和OkIo相关的警告。要抑制这些警告，您需要添加自己的Proguard配置文件。为此，请遵循以下步骤</p><ol class=""><li id="cd65" class="ks kt hu jr b js kn jw ko ka ku ke kv ki kw km kx ky kz la dt translated">向Droid项目的根目录添加一个名为proguard.cfg的新文件</li><li id="0dbc" class="ks kt hu jr b js lc jw ld ka le ke lf ki lg km kx ky kz la dt translated">因为Xamarin是智能的，它保存这个新文件在UTF-8与BOM，你将需要改变这一点。打开类似Visual Studio代码的东西，用UTF-8编码重新保存文件。这是必需的，因为Proguard不会读取文件，除非它是UTF-8编码。</li><li id="3c46" class="ks kt hu jr b js lc jw ld ka le ke lf ki lg km kx ky kz la dt translated">在Xamarin studio中，右键单击该文件并选择properties。对于构建操作，选择程序配置。见下面截图，供参考。</li><li id="5256" class="ks kt hu jr b js lc jw ld ka le ke lf ki lg km kx ky kz la dt translated">将相关的keep或dontwarn子句添加到文件中，参见下面的代码示例，该示例保留google maps文件并忽略OkIo警告。</li></ol><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lt"><img src="../Images/2e956cdd8837889491b0f378d61de814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VKtlO91oUNDci6eRQNteQg.png"/></div></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Select ProguardConfiguration as a build action for your custom Proguard file</figcaption></figure><pre class="li lj lk ll fq ly lz ma mb aw mc dt"><span id="3120" class="md is hu lz b fv me mf l mg mh">-dontwarn com.google.android.gms.**<br/>-keep class com.google.android.gms.**<br/> <br/>-dontwarn com.facebook.ads.internal.adapters.**<br/>-keep class com.facebook.ads.internal.adapters.**<br/> <br/>-dontwarn okio.**</span></pre><p id="eeaa" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">完成这些步骤后，再次尝试构建。希望这次会更成功。如果不成功，检查您的构建输出，看看Proguard给出了什么警告和注释。从这个阶段开始，就是要确定你需要对你的定制Proguard文件做什么样的修改，一旦成功了，构建就成功了。</p><h1 id="23bc" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">结论</h1><p id="f10a" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">如您所见，将Proguard添加到您的Xamarin Android项目并不容易。希望这能帮助其他需要这样做的人。此外，Xamarin有望在未来让开发人员更容易、更清楚地了解这个过程。</p><div class="li lj lk ll fq ab cb"><figure class="mi lm mj mk ml mm mn paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mi lm mj mk ml mm mn paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mi lm mj mk ml mm mn paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mo mp mq"><p id="f922" class="jp jq mr jr b js kn ju jv jw ko jy jz ms kp kc kd mt kq kg kh mu kr kk kl km hn dt translated"><a class="ae lb" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae lb" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae lb" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae lb" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jp jq mr jr b js kn ju jv jw ko jy jz ms kp kc kd mt kq kg kh mu kr kk kl km hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae lb" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae lb" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mv"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>