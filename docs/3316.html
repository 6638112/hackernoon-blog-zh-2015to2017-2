<html>
<head>
<title>How to Use Queue in Laravel 5.4 For Email Verification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Laravel 5.4中使用队列进行邮件验证</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-use-queue-in-laravel-5-4-for-email-verification-3617527a7dbf?source=collection_archive---------0-----------------------#2017-03-27">https://medium.com/hackernoon/how-to-use-queue-in-laravel-5-4-for-email-verification-3617527a7dbf?source=collection_archive---------0-----------------------#2017-03-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4911" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">今天，我将通过使用集成的auth RegisterController演示如何在Laravel 5.4中使用队列进行电子邮件验证。此外，我还将向您展示如何将电子邮件发送过程添加到队列中，以使您的应用程序处理速度更快。</p><p id="3792" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本文中，我将为队列作业使用一个数据库。然而，<a class="ae jp" href="https://www.cloudways.com/blog/redis-for-queuing-in-laravel-5/" rel="noopener ugc nofollow" target="_blank">你可以使用Redis </a>或任何其他驱动程序，如<a class="ae jp" href="https://laravel.com/docs/5.4/queues" rel="noopener ugc nofollow" target="_blank">官方文件</a>中所定义的。</p><p id="6710" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">出于本文的目的，我假设您已经使用以下代码创建了一个Laravel auth:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="3f8a" class="jz ka hu jv b fv kb kc l kd ke">php artisan make:auth</span></pre><p id="2e30" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果没有，现在就创建它。完成后，让我们开始学习教程。</p><h2 id="3e0e" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">摆桌子</h2><p id="07bd" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">让我们从在预先存在的数据库中为用户和队列添加表开始。</p><h2 id="3cbc" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">更新用户表</h2><p id="2e1c" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">让我们首先为用户更新现有的迁移文件。打开用户表迁移文件(位于<strong class="it hv">数据库/迁移</strong>文件夹中)并在其中添加两个新列。一个用于<strong class="it hv">电子邮件令牌</strong>，第二个用于检查用户是否通过<strong class="it hv">验证</strong>。以下是<strong class="it hv">用户</strong>表的更新模式:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="602e" class="jz ka hu jv b fv kb kc l kd ke">Schema::create(‘users’, function (Blueprint $table) {</span><span id="7379" class="jz ka hu jv b fv ld kc l kd ke">$table-&gt;increments(‘id’);</span><span id="cd4a" class="jz ka hu jv b fv ld kc l kd ke">$table-&gt;string(‘name’);</span><span id="8d7e" class="jz ka hu jv b fv ld kc l kd ke">$table-&gt;string(‘email’)-&gt;unique();</span><span id="258d" class="jz ka hu jv b fv ld kc l kd ke">$table-&gt;string(‘password’);</span><span id="14cc" class="jz ka hu jv b fv ld kc l kd ke">$table-&gt;tinyInteger(‘verified’)-&gt;default(0);</span><span id="cfd4" class="jz ka hu jv b fv ld kc l kd ke">$table-&gt;string(‘email_token’)-&gt;nullable();</span><span id="5910" class="jz ka hu jv b fv ld kc l kd ke">$table-&gt;rememberToken();</span><span id="9fe1" class="jz ka hu jv b fv ld kc l kd ke">$table-&gt;timestamps();</span><span id="6337" class="jz ka hu jv b fv ld kc l kd ke">});</span></pre><h2 id="2e01" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">为队列添加表</h2><p id="ee38" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">现在让我们添加队列作业和失败作业的表。为此，运行以下Artisan命令:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="160a" class="jz ka hu jv b fv kb kc l kd ke">php artisan queue:table</span><span id="08fe" class="jz ka hu jv b fv ld kc l kd ke">php artisan queue:failed-table</span></pre><h2 id="6cfd" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">迁移表</h2><p id="27c1" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">现在我已经有了所有需要的表，让我们使用下面的Artisan命令来迁移它:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="22d2" class="jz ka hu jv b fv kb kc l kd ke">php artisan migrate</span></pre><figure class="jq jr js jt fq lf fe ff paragraph-image"><div class="fe ff le"><img src="../Images/c4cca55c47a7b6f9f8408a9d3021664d.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/0*1dAqJUtjVuYTnGMa."/></div></figure><p id="d845" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦命令完成，所有的表都将生成。</p><h2 id="8b21" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">正在更新。环境文件</h2><p id="4551" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">我现在将更新。包含邮件和队列驱动程序信息的env文件。我将使用Gmail发送验证邮件。以下是中的更改。环境文件:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="a6fd" class="jz ka hu jv b fv kb kc l kd ke">QUEUE_DRIVER=database</span><span id="babe" class="jz ka hu jv b fv ld kc l kd ke">MAIL_DRIVER=smtp</span><span id="7b36" class="jz ka hu jv b fv ld kc l kd ke">MAIL_HOST=smtp.gmail.com</span><span id="6f58" class="jz ka hu jv b fv ld kc l kd ke">MAIL_PORT=587</span><span id="7aed" class="jz ka hu jv b fv ld kc l kd ke">MAIL_USERNAME=ahmedkhan27.92@gmail.com</span><span id="647e" class="jz ka hu jv b fv ld kc l kd ke">MAIL_PASSWORD=</span><span id="4b1e" class="jz ka hu jv b fv ld kc l kd ke">MAIL_ENCRYPTION=tls</span><span id="b802" class="jz ka hu jv b fv ld kc l kd ke">MAIL_FROM_ADDRESS=ahmedkhan27.92@gmail.com</span><span id="8047" class="jz ka hu jv b fv ld kc l kd ke">MAIL_FROM_NAME=”Ahmed Khan”</span></pre><p id="f356" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意，我添加了两个新的常量<strong class="it hv"> MAIL_FROM_ADDRESS </strong>和<strong class="it hv"> MAIL_FROM_NAME </strong>，这样我就不需要每次都指定电子邮件地址了。如你所见，我已经输入了一个Gmail地址，验证邮件将从该地址发出。</p><h2 id="e99f" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">创建邮件和电子邮件验证视图</h2><p id="06bf" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">既然我已经设置了SMTP来发送电子邮件，现在是时候创建一个email类，它将返回视图和令牌，以便随电子邮件一起发送。运行以下Artisan命令创建电子邮件设置:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="5c2d" class="jz ka hu jv b fv kb kc l kd ke">php artisan make:mail EmailVerification</span></pre><p id="26fa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦命令完成，一个名为<strong class="it hv"> Mail </strong>的新文件夹以及<strong class="it hv"> EmailVerification </strong>类文件将在<strong class="it hv"> app </strong>文件夹中创建。这是我需要发邮件时需要调用的文件。</p><h2 id="313a" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">更新EmailVerification类</h2><p id="b1c8" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">这个类有两个方法。第一个是<strong class="it hv">构造函数()</strong>，第二个是<strong class="it hv">构建函数()</strong>，它们将完成大部分工作。它将视图与电子邮件绑定在一起。我将随视图一起发送一个用户令牌，以便可以验证用户。为此，在名为<strong class="it hv"> $user </strong>的类中添加一个新的受保护变量:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="8af0" class="jz ka hu jv b fv kb kc l kd ke">protected $user;</span></pre><p id="0bd2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，在构造函数中添加一个新的<strong class="it hv"> $user </strong>参数，并将其传递给类变量<strong class="it hv"> $user </strong>。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="94af" class="jz ka hu jv b fv kb kc l kd ke">public function __construct($user)</span><span id="e94b" class="jz ka hu jv b fv ld kc l kd ke">{</span><span id="622e" class="jz ka hu jv b fv ld kc l kd ke">//.</span><span id="e11d" class="jz ka hu jv b fv ld kc l kd ke">$this-&gt;user = $user;</span><span id="ea3c" class="jz ka hu jv b fv ld kc l kd ke">}</span></pre><p id="6726" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，更新<strong class="it hv"> build() </strong>方法，以便它可以返回一个视图和用户令牌。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="8906" class="jz ka hu jv b fv kb kc l kd ke">public function build()</span><span id="3a5c" class="jz ka hu jv b fv ld kc l kd ke">{</span><span id="8681" class="jz ka hu jv b fv ld kc l kd ke">return $this-&gt;view(‘email.email’)-&gt;with([</span><span id="75f4" class="jz ka hu jv b fv ld kc l kd ke">‘email_token’ =&gt; $this-&gt;user-&gt;email_token,</span><span id="91e2" class="jz ka hu jv b fv ld kc l kd ke">]);</span><span id="f19e" class="jz ka hu jv b fv ld kc l kd ke">}</span></pre><h2 id="464a" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">创建电子邮件模板</h2><p id="c6dd" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">为了创建电子邮件模板，在<strong class="it hv">视图</strong>文件夹内创建一个名为<strong class="it hv">电子邮件</strong>的新文件夹，然后在该文件夹内创建一个名为<strong class="it hv">email.blade.php</strong>的新文件。该文件将包含以下简单模板:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="f988" class="jz ka hu jv b fv kb kc l kd ke">&lt;h1&gt;Click the Link To Verify Your Email&lt;/h1&gt;</span><span id="47c4" class="jz ka hu jv b fv ld kc l kd ke">Click the following link to verify your email {{url(‘/verifyemail/’.$email_token)}}</span></pre><p id="79de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">电子邮件的视图现在已经完成。接下来，我将创建一个新队列，向注册用户发送电子邮件。</p><h2 id="3624" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">创建SendVerficationEmail队列作业</h2><p id="b677" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">现在运行以下Artisan命令来创建新的队列作业</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="6f7e" class="jz ka hu jv b fv kb kc l kd ke">php artisan make:job SendVerificationEmail</span></pre><p id="51ff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当该命令完成时，一个名为<strong class="it hv"> Jobs </strong>的新文件夹出现在<strong class="it hv"> app </strong>文件夹中，同时出现的还有<strong class="it hv"> SendVerificationEmail </strong>作业类。我现在将编辑这个文件，以便它可以用来发送电子邮件。</p><p id="b7ed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先在其中添加Mail和EmailVerification名称空间。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="699d" class="jz ka hu jv b fv kb kc l kd ke">use Mail;</span><span id="d67d" class="jz ka hu jv b fv ld kc l kd ke">use App\Mail\EmailVerification;</span></pre><p id="bd66" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在创建一个新的受保护变量<strong class="it hv"> $user </strong>(也是在EmailVerification类中创建的)。接下来，在构造函数()中添加一个新参数<strong class="it hv"> $user </strong>，并将其值传递给类<strong class="it hv"> $user </strong>变量</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="05a3" class="jz ka hu jv b fv kb kc l kd ke">protected $user;</span><span id="e98a" class="jz ka hu jv b fv ld kc l kd ke">public function __construct($user)</span><span id="bf6a" class="jz ka hu jv b fv ld kc l kd ke">{</span><span id="0639" class="jz ka hu jv b fv ld kc l kd ke">$this-&gt;user = $user;</span><span id="1e44" class="jz ka hu jv b fv ld kc l kd ke">}</span></pre><p id="62d5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我将在<strong class="it hv"> handle() </strong>方法中设置电子邮件发送流程。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="3db9" class="jz ka hu jv b fv kb kc l kd ke">public function handle()</span><span id="ff68" class="jz ka hu jv b fv ld kc l kd ke">{</span><span id="689b" class="jz ka hu jv b fv ld kc l kd ke">$email = new EmailVerification($this-&gt;user);</span><span id="44ec" class="jz ka hu jv b fv ld kc l kd ke">Mail::to($this-&gt;user-&gt;email)-&gt;send($email);</span><span id="1068" class="jz ka hu jv b fv ld kc l kd ke">}</span></pre><p id="21eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">句柄</strong>函数的作用是创建一个电子邮件验证模板的实例，并将其传递给mail，以便向用户发送电子邮件。</p><h2 id="8d1d" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">更新授权注册流程</h2><p id="9ab2" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">在开始之前，在用户模型的<strong class="it hv"> $fillable </strong>数组中添加<strong class="it hv">‘email _ token’</strong>。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="ba54" class="jz ka hu jv b fv kb kc l kd ke">protected $fillable = [</span><span id="29b7" class="jz ka hu jv b fv ld kc l kd ke">‘name’, ‘email’, ‘password’,’email_token’</span><span id="c8b9" class="jz ka hu jv b fv ld kc l kd ke">];</span></pre><p id="6488" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在打开<strong class="it hv">RegisterController.php</strong>文件(位于<strong class="it hv">控制器/授权</strong>文件夹内)。</p><p id="2371" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先添加以下名称空间:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="ee36" class="jz ka hu jv b fv kb kc l kd ke">use Illuminate\Auth\Events\Registered;</span><span id="f53a" class="jz ka hu jv b fv ld kc l kd ke">use Illuminate\Http\Request;</span><span id="865a" class="jz ka hu jv b fv ld kc l kd ke">use App\Jobs\SendVerificationEmail;</span></pre><p id="0276" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先修改<strong class="it hv"> create() </strong>方法，在其中添加email_token。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="be40" class="jz ka hu jv b fv kb kc l kd ke">protected function create(array $data)</span><span id="3686" class="jz ka hu jv b fv ld kc l kd ke">{</span><span id="349b" class="jz ka hu jv b fv ld kc l kd ke">return User::create([</span><span id="e8f4" class="jz ka hu jv b fv ld kc l kd ke">‘name’ =&gt; $data[‘name’],</span><span id="33c8" class="jz ka hu jv b fv ld kc l kd ke">‘email’ =&gt; $data[‘email’],</span><span id="b212" class="jz ka hu jv b fv ld kc l kd ke">‘password’ =&gt; bcrypt($data[‘password’]),</span><span id="5dc5" class="jz ka hu jv b fv ld kc l kd ke">‘email_token’ =&gt; base64_encode($data[‘email’])</span><span id="27cd" class="jz ka hu jv b fv ld kc l kd ke">]);</span><span id="29e7" class="jz ka hu jv b fv ld kc l kd ke">}</span></pre><p id="100a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于电子邮件令牌，我使用了用户电子邮件地址的<strong class="it hv"> base64 </strong>编码。接下来，我在其中添加了以下两个新功能:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="caca" class="jz ka hu jv b fv kb kc l kd ke">/**</span><span id="e24f" class="jz ka hu jv b fv ld kc l kd ke">* Handle a registration request for the application.</span><span id="17f4" class="jz ka hu jv b fv ld kc l kd ke">*</span><span id="9304" class="jz ka hu jv b fv ld kc l kd ke">* @param \Illuminate\Http\Request $request</span><span id="38f5" class="jz ka hu jv b fv ld kc l kd ke">* @return \Illuminate\Http\Response</span><span id="fa6b" class="jz ka hu jv b fv ld kc l kd ke">*/</span><span id="3bde" class="jz ka hu jv b fv ld kc l kd ke">public function register(Request $request)</span><span id="96b4" class="jz ka hu jv b fv ld kc l kd ke">{</span><span id="5fde" class="jz ka hu jv b fv ld kc l kd ke">$this-&gt;validator($request-&gt;all())-&gt;validate();</span><span id="701e" class="jz ka hu jv b fv ld kc l kd ke">event(new Registered($user = $this-&gt;create($request-&gt;all())));</span><span id="e7c8" class="jz ka hu jv b fv ld kc l kd ke">dispatch(new SendVerificationEmail($user));</span><span id="fe11" class="jz ka hu jv b fv ld kc l kd ke">return view(‘verification’);</span><span id="6a79" class="jz ka hu jv b fv ld kc l kd ke">}</span><span id="68f5" class="jz ka hu jv b fv ld kc l kd ke">/**</span><span id="72fd" class="jz ka hu jv b fv ld kc l kd ke">* Handle a registration request for the application.</span><span id="f9c2" class="jz ka hu jv b fv ld kc l kd ke">*</span><span id="0929" class="jz ka hu jv b fv ld kc l kd ke">* @param $token</span><span id="7908" class="jz ka hu jv b fv ld kc l kd ke">* @return \Illuminate\Http\Response</span><span id="f04f" class="jz ka hu jv b fv ld kc l kd ke">*/</span><span id="ca61" class="jz ka hu jv b fv ld kc l kd ke">public function verify($token)</span><span id="178e" class="jz ka hu jv b fv ld kc l kd ke">{</span><span id="314c" class="jz ka hu jv b fv ld kc l kd ke">$user = User::where(‘email_token’,$token)-&gt;first();</span><span id="90bd" class="jz ka hu jv b fv ld kc l kd ke">$user-&gt;verified = 1;</span><span id="a7b8" class="jz ka hu jv b fv ld kc l kd ke">if($user-&gt;save()){</span><span id="b2f0" class="jz ka hu jv b fv ld kc l kd ke">return view(‘emailconfirm’,[‘user’=&gt;$user]);</span><span id="cc79" class="jz ka hu jv b fv ld kc l kd ke">}</span><span id="06b5" class="jz ka hu jv b fv ld kc l kd ke">}</span></pre><p id="9fe6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我所做的是覆盖<strong class="it hv"> register() </strong>父方法，并在其中添加了两行。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="c019" class="jz ka hu jv b fv kb kc l kd ke">dispatch(new SendVerificationEmail($user));</span><span id="af9e" class="jz ka hu jv b fv ld kc l kd ke">return view(‘verification’);</span></pre><p id="4af8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过这种方式，电子邮件被发送到队列中，而不是直接登录该用户，我会将他重定向到另一个页面，要求他验证他的电子邮件才能继续。接下来，我创建了一个新的<strong class="it hv"> verify() </strong>方法来验证用户及其令牌。接下来，我将创建我在这两个方法中调用的视图。</p><p id="e192" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<strong class="it hv">视图</strong>文件夹中创建一个名为【emailconfirm.blade.php】T4的新文件，并粘贴以下代码。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="292b" class="jz ka hu jv b fv kb kc l kd ke">@extends(‘layouts.app’)</span><span id="12af" class="jz ka hu jv b fv ld kc l kd ke">@section(‘content’)</span><span id="c7ea" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”container”&gt;</span><span id="f0df" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”row”&gt;</span><span id="7ef3" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”col-md-8 col-md-offset-2"&gt;</span><span id="0508" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”panel panel-default”&gt;</span><span id="8cf8" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”panel-heading”&gt;Registration Confirmed&lt;/div&gt;</span><span id="72d3" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”panel-body”&gt;</span><span id="7524" class="jz ka hu jv b fv ld kc l kd ke">Your Email is successfully verified. Click here to &lt;a href=”{{url(‘/login’)}}”&gt;login&lt;/a&gt;</span><span id="db9e" class="jz ka hu jv b fv ld kc l kd ke">&lt;/div&gt;</span><span id="fd15" class="jz ka hu jv b fv ld kc l kd ke">&lt;/div&gt;</span><span id="3a4e" class="jz ka hu jv b fv ld kc l kd ke">&lt;/div&gt;</span><span id="1588" class="jz ka hu jv b fv ld kc l kd ke">&lt;/div&gt;</span><span id="95f1" class="jz ka hu jv b fv ld kc l kd ke">&lt;/div&gt;</span><span id="4a7f" class="jz ka hu jv b fv ld kc l kd ke">@endsection</span></pre><p id="53db" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<strong class="it hv">视图</strong>文件夹中创建另一个名为<strong class="it hv">verification.blade.php的新文件。</strong>把下面的代码粘贴进去。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="3f1e" class="jz ka hu jv b fv kb kc l kd ke">@extends(‘layouts.app’)</span><span id="1f07" class="jz ka hu jv b fv ld kc l kd ke">@section(‘content’)</span><span id="a8c4" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”container”&gt;</span><span id="c15a" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”row”&gt;</span><span id="3433" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”col-md-8 col-md-offset-2"&gt;</span><span id="e3b3" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”panel panel-default”&gt;</span><span id="181e" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”panel-heading”&gt;Registration&lt;/div&gt;</span><span id="71a3" class="jz ka hu jv b fv ld kc l kd ke">&lt;div class=”panel-body”&gt;</span><span id="906c" class="jz ka hu jv b fv ld kc l kd ke">You have successfully registered. An email is sent to you for verification.</span><span id="f8b2" class="jz ka hu jv b fv ld kc l kd ke">&lt;/div&gt;</span><span id="f46a" class="jz ka hu jv b fv ld kc l kd ke">&lt;/div&gt;</span><span id="d638" class="jz ka hu jv b fv ld kc l kd ke">&lt;/div&gt;</span><span id="2be9" class="jz ka hu jv b fv ld kc l kd ke">&lt;/div&gt;</span><span id="04f0" class="jz ka hu jv b fv ld kc l kd ke">&lt;/div&gt;</span><span id="2d54" class="jz ka hu jv b fv ld kc l kd ke">@endsection</span></pre><p id="dbe1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此时，代码已经完成，可以使用了。让我们试一试。</p><p id="5c01" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<strong class="it hv">web.php</strong>文件中添加以下路线供用户验证:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="f300" class="jz ka hu jv b fv kb kc l kd ke">Route::get(‘/verifyemail/{token}’, ‘Auth\RegisterController@verify’);</span></pre><h2 id="0321" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">测试电子邮件验证流程</h2><p id="0682" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">在命令行中，执行以下命令开始监听队列。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="fa75" class="jz ka hu jv b fv kb kc l kd ke">php artisan queue:work</span></pre><p id="de93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">保持命令行窗口打开，并在另一个选项卡中打开注册页面。填写表格并注册一个新用户。</p><figure class="jq jr js jt fq lf fe ff paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="fe ff li"><img src="../Images/e5530fc8c08b9100a9490a1a024f4e25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*adRvU2EEkYVulxQC."/></div></div></figure><p id="4479" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">单击<strong class="it hv">注册</strong>按钮后，您会发现注册确认页面会快速打开，因为它会被分派到队列中。</p><figure class="jq jr js jt fq lf fe ff paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="fe ff ln"><img src="../Images/24086034582fa36791d4d47d38c15165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KRVmhCmup7R-fdE8."/></div></div></figure><p id="669d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在看看命令行:一个新的作业已经成功处理。</p><figure class="jq jr js jt fq lf fe ff paragraph-image"><div class="fe ff lo"><img src="../Images/11122d1484f11c8a3405b5526364944c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/0*4RyvwHrny_SN5odF."/></div></figure><p id="ed42" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着已经向用户发送了一封电子邮件。</p><figure class="jq jr js jt fq lf fe ff paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="fe ff lp"><img src="../Images/90715f8f6afbbf328d506bd260e9a070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZBLegMGrzZB2Q6Hv."/></div></div></figure><p id="25eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当用户点击链接时，他/她将被验证:</p><figure class="jq jr js jt fq lf fe ff paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="fe ff lq"><img src="../Images/571a94f90037fe6f4b0c174ce9050429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Xu5h4mcs9RaSxrZ3."/></div></div></figure><p id="bdfe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意:一旦关闭终端，队列将停止工作。如果希望队列继续监听，可以在Linux终端中运行以下命令:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="72d5" class="jz ka hu jv b fv kb kc l kd ke"><strong class="jv hv">nohup php artisan queue:work &amp;</strong></span></pre><p id="6de1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">即使您关闭了终端，该命令也将在后台继续运行。或者，您可以<a class="ae jp" href="https://www.cloudways.com/blog/schedule-cron-jobs-in-php/" rel="noopener ugc nofollow" target="_blank">为它安排一个Cron作业</a>，它每分钟运行一次。</p><h2 id="565c" class="jz ka hu bd kf kg kh ki kj kk kl km kn jc ko kp kq jg kr ks kt jk ku kv kw kx dt translated">结论</h2><p id="124e" class="pw-post-body-paragraph ir is hu it b iu ky iw ix iy kz ja jb jc la je jf jg lb ji jj jk lc jm jn jo hn dt translated">在本文中，我使用队列和邮件在Laravel 5.4中创建了电子邮件验证。我已经更新了一个现有的<strong class="it hv"> RegisterController </strong>，它带有一个Laravel auth。我还创建了一个基本的电子邮件模板，并通过代码验证了用户。请随意添加您的评论，以便进一步讨论。</p><div class="jq jr js jt fq ab cb"><figure class="lr lf ls lt lu lv lw paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lr lf ls lt lu lv lw paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lr lf ls lt lu lv lw paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="lx ly lz"><p id="f922" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是T21家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jq jr js jt fq lf fe ff paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="fe ff me"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>