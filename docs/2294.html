<html>
<head>
<title>React Native Basics: Geolocation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React本机基础:地理定位</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/react-native-basics-geolocation-adf3c0d10112?source=collection_archive---------0-----------------------#2017-01-18">https://medium.com/hackernoon/react-native-basics-geolocation-adf3c0d10112?source=collection_archive---------0-----------------------#2017-01-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="9dca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我最近一直在React Native中使用地理定位API。这是一个API，我没有意识到它存在于React Native中，也没有意识到它实际上有多容易使用。</p><p id="9087" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">React Native有一些很棒的聚合填充，将我们在web上已经习惯的API带到了移动设备上，这使得使用它们变得非常容易。React Native中的地理位置API只是web规范的一个扩展。这篇文章基本上是官方文档的翻版，带有一些额外的评论和例子。除此之外，我鼓励您阅读官方文档。</p><ul class=""><li id="637d" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated"><a class="ae jy" href="https://facebook.github.io/react-native/docs/geolocation.html" rel="noopener ugc nofollow" target="_blank"> <em class="jz">反应原生地理位置</em> </a></li><li id="d071" class="jp jq hu it b iu ka iy kb jc kc jg kd jk ke jo ju jv jw jx dt translated"><a class="ae jy" href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation" rel="noopener ugc nofollow" target="_blank"> <em class="jz">网络地理定位API </em> </a></li></ul><h2 id="9783" class="kf kg hu bd kh ki kj kk kl km kn ko kp jc kq kr ks jg kt ku kv jk kw kx ky kz dt translated">装置</h2><p id="ab62" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">安装非常简单。在iOS上，当您创建新应用程序时，info . plist(<em class="jz">NSLocationWhenInUseUsageDescription</em>)中的必要键已经设置好。如果你想在应用程序处于后台时使用用户的位置，你必须做一些额外的配置。</p><p id="baeb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Android上也很简单，只是默认没有启用。在您的<em class="jz"> AndroidManifest.xml </em>中，您需要添加以下权限请求</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="f0bf" class="kf kg hu lk b fv lo lp l lq lr">&lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt;</span></pre><p id="05ac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它在iOS上默认启用而在Android上不启用的原因归结于每个平台如何&amp;何时请求使用位置数据的许可。在iOS上，当你第一次尝试使用它时会被请求许可，而在Android上，当下载应用程序时会被请求许可。因此，如果Android上默认启用了位置权限，用户会看到它请求的内容(位置数据)，如果你的应用程序没有充分的理由需要他们的位置信息，他们可能不会下载你的应用程序。</p><h2 id="19c9" class="kf kg hu bd kh ki kj kk kl km kn ko kp jc kq kr ks jg kt ku kv jk kw kx ky kz dt translated">API概述</h2><p id="c560" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">地理定位api存在于React Native中的全局<code class="eh ls lt lu lk b">navigator</code>对象上，就像在web上一样，因此您可以通过<code class="eh ls lt lu lk b">navigator.geolocation</code>访问它。</p><p id="98b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我将介绍在<code class="eh ls lt lu lk b">navigator.geolocation</code> — <code class="eh ls lt lu lk b">getCurrentPosition</code>、<code class="eh ls lt lu lk b">watchPosition</code>和<code class="eh ls lt lu lk b">clearWatch</code>上可用的三种方法。</p><p id="50c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> getCurrentPosition </strong>允许我们随时请求用户的位置。它接受三个参数—成功回调、错误回调和配置对象(按此顺序)。成功回调将被传递一个类似</p><figure class="lf lg lh li fq lv"><div class="bz el l di"><div class="lw lx l"/></div></figure><p id="9763" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将向错误回调传递一条标准错误消息。最后，配置对象有</p><ul class=""><li id="a0d4" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated"><em class="jz"/><em class="jz">【布尔】</em>——可以让你得到最准确的位置。由于它获取位置(通过GPS)的方式，返回结果可能会比较慢，但启用后会更准确。</li><li id="1ad5" class="jp jq hu it b iu ka iy kb jc kc jg kd jk ke jo ju jv jw jx dt translated"><em class="jz">超时(毫秒)</em> —在抛出错误之前，API需要多长时间返回位置？</li><li id="8d51" class="jp jq hu it b iu ka iy kb jc kc jg kd jk ke jo ju jv jw jx dt translated"><em class="jz">maximum image(毫秒)</em> —如果一个位置存在于设备缓存中，在它对您的应用程序不再有价值之前，它可以存在多久？</li></ul><p id="a904" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">watch position<em class="jz"/></strong>和getCurrentPosition很像。唯一的区别是，每当用户的位置更新时，都会调用成功或错误回调。config对象中还有一个额外的选项，那就是<code class="eh ls lt lu lk b">distanceFilter</code>这将允许您指定在再次触发回调之前用户必须移动多少米。</p><p id="a734" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">使用<code class="eh ls lt lu lk b">watchPosition</code>时，应随时使用clearWatch </strong>。这将告诉设备，你的应用程序不再需要位置信息。就像你应该总是清除一个间隔，当应用程序卸载或者你不再需要它的时候，你应该总是清除一个位置监视。</p><h2 id="3dd2" class="kf kg hu bd kh ki kj kk kl km kn ko kp jc kq kr ks jg kt ku kv jk kw kx ky kz dt translated"><em class="ly"> getCurrentPosition </em>示例</h2><figure class="lf lg lh li fq lv"><div class="bz el l di"><div class="lw lx l"/></div></figure><p id="21da" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以在上面看到用这个API访问当前位置是多么简单。</p><h2 id="2553" class="kf kg hu bd kh ki kj kk kl km kn ko kp jc kq kr ks jg kt ku kv jk kw kx ky kz dt translated">观察位置示例</h2><figure class="lf lg lh li fq lv"><div class="bz el l di"><div class="lw lx l"/></div></figure><p id="330c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以看到，使用观察位置与获取位置非常相似，只是位置发生变化。注意两件事很重要</p><ol class=""><li id="2719" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo lz jv jw jx dt translated">当组件被卸载时，确保清除监视(见第30行)</li><li id="c513" class="jp jq hu it b iu ka iy kb jc kc jg kd jk ke jo lz jv jw jx dt translated">如果您不需要实时更新位置信息，请使用<em class="jz"> getCurrentPosition </em>来代替，因为它不太耗电</li></ol></div><div class="ab cl ma mb hc mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hn ho hp hq hr"><blockquote class="mh"><p id="bdcd" class="mi mj hu bd mk ml mm mn mo mp mq jo ek translated">想看看在生产质量应用程序中使用地理定位是什么样的吗？结账<a class="ae jy" href="https://learn.handlebarlabs.com/p/react-native-meteor" rel="noopener ugc nofollow" target="_blank">这个反应土产课程</a>(众多中的一个)！</p></blockquote><blockquote class="mr ms mt"><p id="2368" class="ir is jz it b iu mu iw ix iy mv ja jb mw mx je jf my mz ji jj na nb jm jn jo hn dt translated"><a class="ae jy" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是这个家庭的一员。我们现在<a class="ae jy" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jy" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is jz it b iu iv iw ix iy iz ja jb mw jd je jf my jh ji jj na jl jm jn jo hn dt translated">要了解更多信息，<a class="ae jy" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a> , <a class="ae jy" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">喜欢/在脸书给我们发消息</a>，或者简单地，<a class="ae jy" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank">发推文/DM @HackerNoon。</a></p><p id="708a" class="ir is jz it b iu iv iw ix iy iz ja jb mw jd je jf my jh ji jj na jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jy" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jy" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lf lg lh li fq lv"><div class="bz el l di"><div class="nc lx l"/></div></figure></div></div>    
</body>
</html>