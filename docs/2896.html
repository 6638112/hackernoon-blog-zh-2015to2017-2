<html>
<head>
<title>How to Create and Deploy a Telegram Bot?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建和部署电报机器人？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-create-and-deploy-a-telegram-bot-2addd8aec6b4?source=collection_archive---------1-----------------------#2017-02-27">https://medium.com/hackernoon/how-to-create-and-deploy-a-telegram-bot-2addd8aec6b4?source=collection_archive---------1-----------------------#2017-02-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/d9bb4e7be57f7ad1b883dd89b45d5e22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rEGExeRMb2lXCyC8gukkQQ.png"/></div></div></figure><h1 id="8f24" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">介绍或为什么你应该尝试一个机器人</h1><p id="bd44" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><strong class="kc hv"> <em class="ky">(如果你已经知道如何处理你的机器人，你可以跳过)</em> </strong></p><blockquote class="kz"><p id="552d" class="la lb hu bd lc ld le lf lg lh li kx ek translated">注意:由于降价，代码示例可能显示不正确。我建议<a class="ae lj" href="https://djangostars.com/blog/how-to-create-and-deploy-a-telegram-bot/?utm_source=medium&amp;utm_medium=hackernoon.com&amp;utm_campaign=telegram%20bot&amp;utm_content=continue%20reading" rel="noopener ugc nofollow" target="_blank">继续阅读我们博客</a>上的原文，以确保所有的例子都能正确显示。</p></blockquote><p id="9e66" class="pw-post-body-paragraph ka kb hu kc b kd lk kf kg kh ll kj kk kl lm kn ko kp ln kr ks kt lo kv kw kx hn dt translated">机器人无处不在。似乎就在昨天，我们甚至不知道它们的存在；现在我们几乎无法想象没有他们的生活。它们在messengers的众多活跃用户中广受欢迎，因为它们有各种各样的使用范围——从娱乐内容，包括循序渐进的游戏和在餐馆收集奖励积分，到保持饮食计划，跟踪送货，甚至为不同的服务付款。</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lp"><img src="../Images/d105b45068fd6499fa351d6185ad26f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lxgdxOo2yoGjRjjo.png"/></div></div></figure><p id="1757" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">为什么它们如此受欢迎？他们的秘诀是什么？我认为更相关的问题是为什么它们比一个app更方便。有几个原因。</p><p id="284f" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated"><strong class="kc hv"> 1)极简简单的设计。</strong> <br/>嗯，bot根本就不能有多彩的设计。但是毫无疑问，与众多不同设计的应用程序相比，当你必须记住在哪里点击什么时，bot更通用和容易；它通过文本提供简单的交流。</p><p id="4b77" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated"><strong class="kc hv"> 2) Bot广告最少，关注用户需求。如果你可以从机器人那里获得所有必要的帮助，你就不必为每项服务安装数百个应用程序。这对餐馆和商店特别有用。客户很少渴望从他们访问过的地方安装应用程序。正因为如此，企业主错过了客户的反馈，失去了与他们的沟通。如果每个地方都有自己的机器人可以在不同的信使中使用，对用户来说会更加方便和友好。没有人喜欢用那些只使用一两次的不必要的应用程序来填满手机的存储空间。然而，客户需要与服务所有者接触，他们会很高兴通过他们最喜欢的信使来这样做。</strong></p><p id="4c78" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated"><strong class="kc hv"> 3)无需注册、授权和不断重新登录</strong> <br/>使用机器人，用户只需在机器人加入聊天时通过一次授权。客户端可以根据需要使用该机器人，当不再需要它时，用户只需阻止该机器人。就这样，简单！不再有密码重置。</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lz"><img src="../Images/aaaff79aa96f70b15cd75db251f1ddc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zI8hR6O6bwlwK26K.png"/></div></div></figure><p id="dceb" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">不需要记住密码或登录使用。将bot添加到网站或应用程序中会增加用户受众的数量，因为它使与客户的沟通和向他们提供帮助变得更加容易和用户友好。</p><p id="8bf4" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">因此，我们描述了机器人的主要优势，现在你必须愿意创建自己的机器人。让我们继续练习。但首先，我们将看看在预开发阶段必须解决的问题。</p><h1 id="7ad9" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">电报机器人开发的细微差别</h1><p id="76cf" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">当我们已经确定了创建<a class="ae lj" href="https://chatbotslife.com/" rel="noopener ugc nofollow" target="_blank">机器人</a>的原因时，现在是时候考虑我们计划如何组织开发过程以及我们需要什么工具了。此外，我们将在实践中演示如何创建您的第一个机器人，以及如何教它把我们的信息翻过来。</p><p id="477e" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">在这一部分，我们计划如何<a class="ae lj" href="https://djangostars.com/blog/how-much-it-costs-to-build-a-web-application/?utm_source=medium&amp;utm_medium=hackernoon.com&amp;utm_campaign=telegram%20bot&amp;utm_content=build%20the%20app" rel="noopener ugc nofollow" target="_blank">构建应用</a>以及使用什么开发工具。此外，我们将展示如何建立您的第一个电报机器人，并将教它把我们的信息。<br/>因为这是初学者的手册，我们将使用单个端点运行服务器，该端点将接收我们的电报消息并做出回答。</p><p id="6b88" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">为此，我们将使用以下工具:</p><ul class=""><li id="b3d6" class="ma mb hu kc b kd lu kh lv kl mc kp md kt me kx mf mg mh mi dt translated"><a class="ae lj" href="https://bottlepy.org/docs/dev/" rel="noopener ugc nofollow" target="_blank">瓶子</a> —为我们的服务器；一个简单轻量的WSGI微型网络框架</li><li id="f4bb" class="ma mb hu kc b kd mj kh mk kl ml kp mm kt mn kx mf mg mh mi dt translated"><a class="ae lj" href="http://docs.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank">请求</a> —用于向电报发送请求。lib不需要有过多的代表。它在世界各地的各种项目中普遍使用。<br/>注意:你必须在你的电脑上安装这些工具。我们以后会需要它们。为此，打开bash控制台并通过pip安装它</li></ul><pre class="lq lr ls lt fq ms mr mt mu aw mv dt"><span id="af2b" class="mw jd hu mr b fv mx my l mz na">pip install bottle requests</span></pre><ul class=""><li id="f4b9" class="ma mb hu kc b kd lu kh lv kl mc kp md kt me kx mf mg mh mi dt translated"><code class="eh mo mp mq mr b">ngrok</code>–这是一个应用程序，在整个开发阶段为我们提供与Telegram WebHook交互的公共URL(请在下面的WebHook上查找信息)。这很有用，因为Telegram将无法与我们的本地服务器建立连接，因为我们无法在Telegram API配置中指定我们的本地地址。<br/>你要从<a class="ae lj" href="https://ngrok.com/download" rel="noopener ugc nofollow" target="_blank">官方网站</a>下载<code class="eh mo mp mq mr b">ngrok</code>，把安装好的app放在有项目的文件夹里。</li></ul><h1 id="dda0" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">创建你的第一个机器人怎么样？</h1><p id="c7ff" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">如果你热衷于此，探索这一部分，我们将提供一个详细的电报机器人开发教程。</p><p id="9890" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">重要的事情先来。你需要在电报上登记(很明显)。我推荐使用<a class="ae lj" href="https://web.telegram.org/" rel="noopener ugc nofollow" target="_blank"> Telegram web客户端</a>来测试基本概念。</p><p id="d54c" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">打开Telegram app，搜索<strong class="kc hv"> @BotFather </strong>，开始聊天。发送<strong class="kc hv"> /newbot </strong>命令并按照指示操作。完成初始步骤后，您将获得—</p><ul class=""><li id="cb55" class="ma mb hu kc b kd lu kh lv kl mc kp md kt me kx mf mg mh mi dt translated">你的令牌</li><li id="8c16" class="ma mb hu kc b kd mj kh mk kl ml kp mm kt mn kx mf mg mh mi dt translated">电报API URL—<a class="ae lj" href="https://api.telegram.org/bot" rel="noopener ugc nofollow" target="_blank"><strong class="kc hv">https://api.telegram.org/bot</strong></a></li><li id="9278" class="ma mb hu kc b kd mj kh mk kl ml kp mm kt mn kx mf mg mh mi dt translated"><a class="ae lj" href="https://core.telegram.org/bots/api" rel="noopener ugc nofollow" target="_blank">文档链接</a></li></ul><p id="16c9" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">威尔斯，其实就是这样。目前，机器人是100%被动的。</p><p id="f69f" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">您需要初始化与您的<a class="ae lj" href="https://chatbotslife.com/" rel="noopener ugc nofollow" target="_blank">机器人</a>的对话。打开搜索，输入你的机器人的名字。点击<strong class="kc hv">/开始</strong>按钮开始对话。键入类似“你好”的内容。这条消息很重要，因为它是你的机器人将收到的第一个更新。</p><p id="9242" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">如果这是您第一次体验构建API，您可以使用web浏览器轻松了解这个想法。在浏览器中打开一个新标签，使用电报API URL–</p><p id="4629" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated"><a class="ae lj" href="https://api.telegram.org/bot%3Ctoken%3E/getUpdates" rel="noopener ugc nofollow" target="_blank"><strong class="kc hv">https://api.telegram.org/bot&lt;令牌&gt; /getUpdates </strong> </a></p><p id="43a5" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">当您在web浏览器中打开这个URL时，您向Telegram服务器发出请求，它用JSON作出响应。响应类似于Python字典。您应该会看到类似这样的内容:</p><pre class="lq lr ls lt fq ms mr mt mu aw mv dt"><span id="989a" class="mw jd hu mr b fv mx my l mz na">{"ok":true,"result":[{"update_id":523349956,<br/>"message":{"message_id":51,"from":{"id":303262877,"first_name":"YourName"},"chat":{"id":303262877,"first_name":"YourName","type":"private"},"date":1486829360,"text":"Hello"}}]}</span></pre><p id="0efe" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">如果你打开bots文档并检查<strong class="kc hv"> /sendMessage </strong>方法<a class="ae lj" href="https://core.telegram.org/bots/api#sendmessage" rel="noopener ugc nofollow" target="_blank">部分</a>，你会注意到这个方法需要两个额外的参数<strong class="kc hv"> chat_id </strong>和<strong class="kc hv"> text </strong>。在浏览器搜索栏中，您可以使用<strong class="kc hv">链接参数。</strong>为第一个，<strong class="kc hv"> &amp;为所有的后件。发送消息看起来像这样</strong></p><pre class="lq lr ls lt fq ms mr mt mu aw mv dt"><span id="2882" class="mw jd hu mr b fv mx my l mz na">/sendMessage?chat_id=303262877&amp;text=test</span></pre><p id="d88f" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">尝试通过调用<strong class="kc hv"> /getUpdates </strong>将<strong class="kc hv"> chat_id </strong>替换为您获得的回复。我的号码是303262877。文本参数由您决定。请求应该是这样的</p><p id="3240" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">https://api.telegram.org/bot&lt;你的-token &gt; /sendMessage？chat _ id =&amp;text =&lt;your-text&gt;T37】</p><h1 id="927e" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">WebHook</h1><p id="7b07" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><strong class="kc hv">(如果你熟悉WebHook可以跳过这一部分)</strong></p><p id="badb" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">简而言之，WebHook是一个越来越流行的API概念。WebHook的概念很简单。WebHook是一个HTTP回调:一个HTTP POST，当某件事情发生时发生；通过HTTP POST的简单事件通知。</p><p id="f477" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">再解释一下，有时在线应用程序之间的交互需要对事件做出即时响应，而持续不断连接的解决方案通常都很麻烦、苛刻且难以支持。在这种情况下，最好也是最容易的解决方案是通过HTTP立即回调(最常见的是POST)。</p><p id="48fc" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">换句话说，该解决方案通过向其他连接的应用程序发送HTTP POST请求来通知它或让它响应，从而确保对一个应用程序内的任何事件的响应。</p><p id="012d" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">这个确切的概念叫做WebHook。它广泛用于:</p><ul class=""><li id="ccac" class="ma mb hu kc b kd lu kh lv kl mc kp md kt me kx mf mg mh mi dt translated">实时接收数据</li><li id="a343" class="ma mb hu kc b kd mj kh mk kl ml kp mm kt mn kx mf mg mh mi dt translated">接收数据并传递数据</li><li id="43cd" class="ma mb hu kc b kd mj kh mk kl ml kp mm kt mn kx mf mg mh mi dt translated">处理数据并给予回报</li></ul><p id="17cf" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">这似乎是电报客户端(电报应用程序)与我们的项目交互的最佳解决方案。</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lp"><img src="../Images/99b3967de606ebf59de9ed4709210083.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sXEHo-3QNeWeKKqr.png"/></div></div></figure><h1 id="60a1" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">编码部分</h1><p id="2ee2" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">最后，我们开始最实际的部分，你将能够开发一个电报机器人。</p><p id="81ab" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated"><em class="ky">主要任务:教我们的机器人把我们的信息反过来</em></p><p id="0ef4" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">首先，为我们的bot项目创建一个文件夹。</p><p id="83db" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">其次，创建bot.py文件，做一个瓶子服务器。</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lp"><img src="../Images/85d28dff02607450ed4f5570782787e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HIi8IMyyLJwQOIAf.png"/></div></div></figure><p id="f19a" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">接下来，我们开发bot.py</p><pre class="lq lr ls lt fq ms mr mt mu aw mv dt"><span id="2530" class="mw jd hu mr b fv mx my l mz na">from bottle import run, post</span><span id="e16a" class="mw jd hu mr b fv nb my l mz na">@post('/')  # our python function based endpoint<br/>def main():  <br/>    return</span><span id="0365" class="mw jd hu mr b fv nb my l mz na">if __name__ == '__main__':  <br/>    run(host='localhost', port=8080, debug=True)</span></pre><p id="4700" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">让我们尝试启动我们的服务器。为此，在您的bot文件夹中打开bash。</p><pre class="lq lr ls lt fq ms mr mt mu aw mv dt"><span id="41f1" class="mw jd hu mr b fv mx my l mz na">python bot.py</span></pre><p id="897b" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">在结果中，您应该会看到类似这样的内容:</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/950d7b9e1e1ecf5ab35b59a6fac87729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dbzp1FqnBYAloo_8.png"/></div></div></figure><p id="f60a" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">然后，打开一个新标签。在下一个选项卡中，我们将开始<code class="eh mo mp mq mr b">ngrok</code></p><p id="1e26" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated"><code class="eh mo mp mq mr b">./ngrok http &lt;our_server_port&gt;</code></p><pre class="lq lr ls lt fq ms mr mt mu aw mv dt"><span id="446e" class="mw jd hu mr b fv mx my l mz na">./ngrok http 8080</span></pre><p id="9bf3" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">之后，您会看到类似这样的内容:</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nd"><img src="../Images/07872d18bebe620efd512cafa8dd5367.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jjS_Jptl9hAin1Za.png"/></div></div></figure><p id="4b29" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">现在，让我们设置WebHook。</p><p id="8293" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated"><a class="ae lj" rel="noopener ugc nofollow" target="_blank" href="/">https://api.telegram.org/bot&lt;your _ token&gt;/setweb hook？URL =</a><a class="ae lj" href="https://%3Cyour_ngrok_url.ngrok.io/" rel="noopener ugc nofollow" target="_blank">https://&lt;your _ ngrok _ URL . ngrok . io/</a></p><ul class=""><li id="8f65" class="ma mb hu kc b kd lu kh lv kl mc kp md kt me kx mf mg mh mi dt translated">注意:要找到ngrok URL，您必须启动ngrok。然后，在类似于下图的屏幕上，您会找到URL(它在我们的截屏上突出显示)。您在设置WebHook的链接中使用的URL。</li></ul><p id="244f" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">对链接的回应应该是:</p><p id="b797" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated"><code class="eh mo mp mq mr b">{"ok":true,"result":true,"description":"Webhook was set"}</code></p><p id="e899" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">让我们检查一下你是否成功设置了WebHook。使用您的令牌访问此链接:</p><p id="7396" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated"><a class="ae lj" rel="noopener ugc nofollow" target="_blank" href="/">https://api.telegram.org/bot&lt;your _ token&gt;/getWebhookInfo</a></p><p id="9a59" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">如果一切正常，您将在配置时指定的URL键前面看到相同的ngrok地址值。</p><p id="9623" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">恭喜，它还活着！</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div class="fe ff ne"><img src="../Images/98213f4e5a1d7b07a693c0c594b7d9b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/0*Z2EBKT4do0iuYlj9.gif"/></div></figure><p id="3d7e" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">现在，我们需要实现一个消息请求/响应机制。<br/>基本上，我们的端点获取json格式的数据。因此，通常情况下，您会看到数据消息。</p><pre class="lq lr ls lt fq ms mr mt mu aw mv dt"><span id="5459" class="mw jd hu mr b fv mx my l mz na">from bottle import run, post, request as bottle_request  # &lt;--- we add bottle request</span><span id="55f0" class="mw jd hu mr b fv nb my l mz na">@post('/')<br/>def main():  <br/>    data = bottle_request.json  # &lt;--- extract all request data<br/>    print(data)</span><span id="cd32" class="mw jd hu mr b fv nb my l mz na">return</span><span id="18ac" class="mw jd hu mr b fv nb my l mz na">if __name__ == '__main__':  <br/>    run(host='localhost', port=8080, debug=True)</span></pre><p id="20a1" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">它应该类似于启动服务器的控制台选项卡中的内容。</p><pre class="lq lr ls lt fq ms mr mt mu aw mv dt"><span id="6576" class="mw jd hu mr b fv mx my l mz na">{'update_id': &lt;integer&gt;, 'message': {'message_id': &lt;integer&gt;, 'from': {'id': &lt;your telegram id&gt;, 'is_bot': False, 'first_name': '&lt;your telegram name&gt;', 'last_name': '&lt;...&gt;', 'username': '&lt;...&gt;', 'language_code': 'en-En'}, 'chat': {'id': &lt;integer chat id&gt;, 'first_name': '&lt;...&gt;', 'last_name': '&lt;...&gt;', 'username': '&lt;...&gt;', 'type': 'private'}, 'date': 1535022558, 'text': '1'}}</span></pre><p id="4349" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">关于参数的更多详细信息，您可以在<a class="ae lj" href="https://core.telegram.org/bots/api" rel="noopener ugc nofollow" target="_blank">电报</a>的官方文档中找到。</p><p id="7f54" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">现在，我们必须提取<code class="eh mo mp mq mr b">chat_id</code>和<code class="eh mo mp mq mr b">text</code>，以便将我们的消息反过来发送答案。</p><pre class="lq lr ls lt fq ms mr mt mu aw mv dt"><span id="e858" class="mw jd hu mr b fv mx my l mz na">from bottle import (  <br/>    run, post, response, request as bottle_request<br/>)</span><span id="3939" class="mw jd hu mr b fv nb my l mz na">def get_chat_id(data):  <br/>    """<br/>    Method to extract chat id from telegram request.<br/>    """<br/>    chat_id = data['message']['chat']['id']</span><span id="f62e" class="mw jd hu mr b fv nb my l mz na">return chat_id</span><span id="86b9" class="mw jd hu mr b fv nb my l mz na">def get_message(data):  <br/>    """<br/>    Method to extract message id from telegram request.<br/>    """<br/>    message_text = data['message']['text']<br/>    return message_text</span><span id="209f" class="mw jd hu mr b fv nb my l mz na">def change_text_message(text):  <br/>    """<br/>    To turn our message backwards.<br/>    """<br/>    return text[::-1]</span><span id="e914" class="mw jd hu mr b fv nb my l mz na">@post('/')<br/>def main():  <br/>    data = bottle_request.json<br/>    answer_data = prepare_data_for_answer(data)</span><span id="4b9c" class="mw jd hu mr b fv nb my l mz na">return response  # status 200 OK by default</span></pre><p id="8972" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">现在，我们已经准备好了答案。我们把它发给电报机器人吧。</p><pre class="lq lr ls lt fq ms mr mt mu aw mv dt"><span id="6ceb" class="mw jd hu mr b fv mx my l mz na">import requests  <br/>from bottle import (  <br/>    run, post, response, request as bottle_request<br/>)</span><span id="b007" class="mw jd hu mr b fv nb my l mz na">BOT_URL = '<a class="ae lj" href="https://api.telegram.org/bot" rel="noopener ugc nofollow" target="_blank">https://api.telegram.org/bot</a>&lt;YOUR_TOKEN&gt;/' # &lt;--- add your telegram token here; it should be like <a class="ae lj" href="https://api.telegram.org/bot12345678:SOMErAn2dom/" rel="noopener ugc nofollow" target="_blank">https://api.telegram.org/bot12345678:SOMErAn2dom/</a></span><span id="3365" class="mw jd hu mr b fv nb my l mz na">def get_chat_id(data):  <br/>    """<br/>    Method to extract chat id from telegram request.<br/>    """<br/>    chat_id = data['message']['chat']['id']</span><span id="8e45" class="mw jd hu mr b fv nb my l mz na">return chat_id</span><span id="2014" class="mw jd hu mr b fv nb my l mz na">def get_message(data):  <br/>    """<br/>    Method to extract message id from telegram request.<br/>    """<br/>    message_text = data['message']['text']</span><span id="cf30" class="mw jd hu mr b fv nb my l mz na">return message_text</span><span id="59be" class="mw jd hu mr b fv nb my l mz na">def send_message(prepared_data):  <br/>    """<br/>    Prepared data should be json which includes at least `chat_id` and `text`<br/>    """ <br/>    message_url = BOT_URL + 'sendMessage'<br/>    requests.post(message_url, json=prepared_data)  # don't forget to make import requests lib</span><span id="a94d" class="mw jd hu mr b fv nb my l mz na">def change_text_message(text):  <br/>    """<br/>    To enable turning our message inside out<br/>    """<br/>    return text[::-1]</span><span id="7166" class="mw jd hu mr b fv nb my l mz na">def prepare_data_for_answer(data):  <br/>    answer = change_text_message(get_message(data))</span><span id="7f68" class="mw jd hu mr b fv nb my l mz na">json_data = {<br/>        "chat_id": get_chat_id(data),<br/>        "text": answer,<br/>    }</span><span id="7ecc" class="mw jd hu mr b fv nb my l mz na">return json_data</span><span id="5f2f" class="mw jd hu mr b fv nb my l mz na">@post('/')<br/>def main():  <br/>    data = bottle_request.json</span><span id="75b2" class="mw jd hu mr b fv nb my l mz na">answer_data = prepare_data_for_answer(data)<br/>    send_message(answer_data)  # &lt;--- function for sending answer</span><span id="451c" class="mw jd hu mr b fv nb my l mz na">return response  # status 200 OK by default</span><span id="6938" class="mw jd hu mr b fv nb my l mz na">if __name__ == '__main__':  <br/>    run(host='localhost', port=8080, debug=True)</span></pre><p id="5d0b" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">在所有的准备和编码之后，如果一切正常，让我们试着和我们的机器人聊天。</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div class="fe ff nf"><img src="../Images/38e5307fc3a8a470fad66760c854977c.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/0*Y3RcCULlZgG5ZzFf.png"/></div></figure><p id="53db" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">现在，让我们的代码更具可读性，实现OOP结构。</p><pre class="lq lr ls lt fq ms mr mt mu aw mv dt"><span id="1cf9" class="mw jd hu mr b fv mx my l mz na">import requests  <br/>from bottle import Bottle, response, request as bottle_request</span><span id="f6e8" class="mw jd hu mr b fv nb my l mz na">class BotHandlerMixin:  <br/>    BOT_URL = None</span><span id="d244" class="mw jd hu mr b fv nb my l mz na">def get_chat_id(self, data):<br/>        """<br/>        Method to extract chat id from telegram request.<br/>        """<br/>        chat_id = data['message']['chat']['id']</span><span id="8b2c" class="mw jd hu mr b fv nb my l mz na">return chat_id</span><span id="ee52" class="mw jd hu mr b fv nb my l mz na">def get_message(self, data):<br/>        """<br/>        Method to extract message id from telegram request.<br/>        """<br/>        message_text = data['message']['text']</span><span id="7e70" class="mw jd hu mr b fv nb my l mz na">return message_text</span><span id="b818" class="mw jd hu mr b fv nb my l mz na">def send_message(self, prepared_data):<br/>        """<br/>        Prepared data should be json which includes at least `chat_id` and `text`<br/>        """       <br/>        message_url = self.BOT_URL + 'sendMessage'<br/>        requests.post(message_url, json=prepared_data)</span><span id="83e6" class="mw jd hu mr b fv nb my l mz na">class TelegramBot(BotHandlerMixin, Bottle):  <br/>    BOT_URL = '<a class="ae lj" href="https://api.telegram.org/bot000000000:aaaaaaaaaaaaaaaaaaaaaaaaaa/" rel="noopener ugc nofollow" target="_blank">https://api.telegram.org/bot000000000:aaaaaaaaaaaaaaaaaaaaaaaaaa/</a>'</span><span id="a743" class="mw jd hu mr b fv nb my l mz na">def __init__(self, *args, **kwargs):<br/>        super(TelegramBot, self).__init__()<br/>        self.route('/', callback=self.post_handler, method="POST")</span><span id="91b1" class="mw jd hu mr b fv nb my l mz na">def change_text_message(self, text):<br/>        return text[::-1]</span><span id="892b" class="mw jd hu mr b fv nb my l mz na">def prepare_data_for_answer(self, data):<br/>        message = self.get_message(data)<br/>        answer = self.change_text_message(message)<br/>        chat_id = self.get_chat_id(data)<br/>        json_data = {<br/>            "chat_id": chat_id,<br/>            "text": answer,<br/>        }</span><span id="7876" class="mw jd hu mr b fv nb my l mz na">return json_data</span><span id="892c" class="mw jd hu mr b fv nb my l mz na">def post_handler(self):<br/>        data = bottle_request.json<br/>        answer_data = self.prepare_data_for_answer(data)<br/>        self.send_message(answer_data)</span><span id="c53c" class="mw jd hu mr b fv nb my l mz na">return response</span><span id="d0d1" class="mw jd hu mr b fv nb my l mz na">if __name__ == '__main__':  <br/>    app = TelegramBot()<br/>    app.run(host='localhost', port=8080)</span></pre><p id="16dd" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">差不多就是这样。现在你有了一个可以工作的电报机器人，它甚至可以倒着拼写“赛车”。恭喜你。你可以在这里找到错误代码<a class="ae lj" href="https://devcenter.heroku.com/articles/error-codes" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="67a5" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">有了免费账户，你将面临某些限制。然而，这里你有一个功能齐全的机器人。</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><a href="https://djangostars.com/services/python-django-development/?utm_source=medium&amp;utm_medium=hackernoon.com&amp;utm_campaign=telegram%20bot&amp;utm_content=banner_end"><div class="fe ff ng"><img src="../Images/6d17f1f498aa416fd7fa01921bc012f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A_uHZvyUk2wIql_cXIsZcw.png"/></div></a></figure></div><div class="ab cl nh ni hc nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="hn ho hp hq hr"><blockquote class="no np nq"><p id="8659" class="ka kb ky kc b kd lu kf kg kh lv kj kk nr lw kn ko ns lx kr ks nt ly kv kw kx hn dt translated">这篇文章是由<a class="ae lj" href="https://djangostars.com" rel="noopener ugc nofollow" target="_blank"> Django Stars </a>的后端工程师Arez Khalimi 撰写的。这篇关于<a class="ae lj" href="https://djangostars.com/blog/how-to-create-and-deploy-a-telegram-bot/?utm_source=medium&amp;utm_medium=hackernoon.com&amp;utm_campaign=telegram%20bot&amp;utm_content=telegram" rel="noopener ugc nofollow" target="_blank"> telegram </a>的文章最初发布在<strong class="kc hv"> Django Stars博客</strong>上。</p><p id="907c" class="ka kb ky kc b kd lu kf kg kh lv kj kk nr lw kn ko ns lx kr ks nt ly kv kw kx hn dt translated">特别分享给<a class="nu nv gr" href="https://medium.com/u/4a8a924edf41?source=post_page-----2addd8aec6b4--------------------------------" rel="noopener" target="_blank"> Hackernoon </a>读者。</p></blockquote><p id="0415" class="pw-post-body-paragraph ka kb hu kc b kd lu kf kg kh lv kj kk kl lw kn ko kp lx kr ks kt ly kv kw kx hn dt translated">我们随时欢迎您提出问题，分享您想阅读的话题！</p><blockquote class="kz"><p id="8682" class="la lb hu bd lc ld le lf lg lh li kx ek translated"><em class="nw">如果你觉得这篇文章有用，请点击👏下面的按钮:)</em></p></blockquote><figure class="nx ny nz oa ob iv"><div class="bz el l di"><div class="oc od l"/></div></figure><div class="lq lr ls lt fq ab cb"><figure class="oe iv of og oh oi oj paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="oe iv of og oh oi oj paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="oe iv of og oh oi oj paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="no np nq"><p id="f922" class="ka kb ky kc b kd lu kf kg kh lv kj kk nr lw kn ko ns lx kr ks nt ly kv kw kx hn dt translated"><a class="ae lj" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是T21家庭的一员。我们现在<a class="ae lj" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae lj" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ka kb ky kc b kd lu kf kg kh lv kj kk nr lw kn ko ns lx kr ks nt ly kv kw kx hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae lj" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae lj" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ok"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>