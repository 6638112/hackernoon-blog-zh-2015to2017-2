<html>
<head>
<title>System Settings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">系统设置</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/system-settings-9ed72d5ef629?source=collection_archive---------5-----------------------#2016-11-09">https://medium.com/hackernoon/system-settings-9ed72d5ef629?source=collection_archive---------5-----------------------#2016-11-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="b4a5" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">Inaka从代码中移除<em class="jj">文字</em>的方法</h2></div><p id="6605" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">至此，对于大多数开发者来说，我们为什么不喜欢<a class="ae kg" href="https://en.wikipedia.org/wiki/Magic_number_(programming)" rel="noopener ugc nofollow" target="_blank"> <em class="kh">幻数</em> </a>应该很清楚了。</p><figure class="kj kk kl km fq kn fe ff paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="fe ff ki"><img src="../Images/d8c728944d83493eb35f6a740785db99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PX12xsC5QclgIMmvsh0KKg.jpeg"/></div></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">Sorry guys, nothing personal.</figcaption></figure><p id="a589" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">代码中出现的幻数或其他文字值(数字、字符串或任何东西)通常被<a class="ae kg" href="http://www.techrepublic.com/article/avoid-using-magic-numbers-and-string-literals-in-your-code/" rel="noopener ugc nofollow" target="_blank">认为是<em class="kh">不良气味</em> </a>。然而，<em class="kh">默认的</em>解决方案并不总能完全解决<em class="kh">问题</em>。在这篇文章中，我将向你展示我们在Inaka的方式，不管构建每个特定的系统使用什么语言，我们都喜欢处理这种情况。</p></div><div class="ab cl ky kz hc la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hn ho hp hq hr"><h1 id="147d" class="lf lg hu bd lh li lj lk ll lm ln lo lp ja lq jb lr jd ls je lt jg lu jh lv lw dt translated">场景</h1><p id="2df8" class="pw-post-body-paragraph jk jl hu jm b jn lx iv jp jq ly iy js jt lz jv jw jx ma jz ka kb mb kd ke kf hn dt translated">首先，我的解决方案(和任何解决方案一样)并不适用于<em class="kh">所有场景</em>。要使此方法适用于您的系统，应满足以下条件:</p><ol class=""><li id="19a6" class="mc md hu jm b jn jo jq jr jt me jx mf kb mg kf mh mi mj mk dt translated">该系统必须包括数据库、键/值存储或一些其他持久层。</li><li id="98e5" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mh mi mj mk dt translated">该系统必须包括一个可以访问持久层的管理界面。</li><li id="026d" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mh mi mj mk dt translated">系统不应该有超严格的实时约束。如果是这种情况，您应该寻找编译时解决方案，我的是运行时解决方案。</li></ol><p id="4fbe" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">如果您的系统不满足这个标准，您可以放心地跳过本文的其余部分。下周见:)</p><p id="4b1b" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">为了让您更好地了解推荐技术背后的动机，我将向您展示我在代码中看到的一些文字。这些显然不是最终可能成为<em class="kh">神奇文字</em>的所有<strong class="jm hv">东西，但这些是促使我在公司内部推广<em class="kh">系统设置方法</em>的东西:</strong></p><ul class=""><li id="e5de" class="mc md hu jm b jn jo jq jr jt me jx mf kb mg kf mq mi mj mk dt translated"><strong class="jm hv">用户凭证/应用令牌:</strong>当处理第三方API时，比如脸书或Twitter(特别是如果这涉及到OAuth)，你通常必须注册一个应用，并获得一个应用令牌，你必须在所有请求中使用它。那个app token或者用户id或者app id在开发者眼里可能看起来是<em class="kh">不变的</em>。</li><li id="da30" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated"><strong class="jm hv">页面大小或其他API配置:</strong>例如，在提供或使用分页API时，页面大小往往也被视为一个<em class="kh">常量</em>。</li><li id="9d9f" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">默认值:当你的应用程序提供默认值给你的用户，当他们要输入一些东西的时候，有时候直接用代码写这些默认值是很诱人的。</li><li id="ee7d" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated"><strong class="jm hv">内部系统配置:</strong>例如，如果发生错误，系统将向其报告错误的电子邮件。在代码中保留这个值似乎不是一个坏主意，因为它会一直被使用，最终用户<em class="kh">不会看到它，也不会被它影响</em>。那封邮件甚至可能是<em class="kh">毕竟只是你的邮件</em>。</li></ul><p id="60ea" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">您可能会明白为什么将这些东西(以及许多类似的东西)保存在代码中不是一个好主意。它们往往会在你最意想不到的时候发生变化，例如，客户希望改变他们的品牌，因此他们创建了一个新的FB应用程序，使用信息确定为了获得更好的UX，页面的大小应该缩小/扩大，系统管理电子邮件的所有者刚刚离开公司或被转移到其他团队，等等。如果这些值是硬编码的，更改它们需要代码更改、测试、拉式请求、代码审查、在不同环境中部署、QA测试等等…</p><p id="7d4b" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">有更好的方法来实现这些事情。</p><h1 id="b9e6" class="lf lg hu bd lh li mr lk ll lm ms lo lp ja mt jb lr jd mu je lt jg mv jh lv lw dt translated">通常的嫌疑人</h1><p id="6388" class="pw-post-body-paragraph jk jl hu jm b jn lx iv jp jq ly iy js jt lz jv jw jx ma jz ka kb mb kd ke kf hn dt translated">现在，在深入研究建议的方法之前，让我们看一些替代方案。因为，正如我所说的，这个问题是众所周知的，大多数语言都提供了一种机制来很好地从代码中提取这些文字。我记得我用过的那些:</p><ul class=""><li id="f8ef" class="mc md hu jm b jn jo jq jr jt me jx mf kb mg kf mq mi mj mk dt translated">Visual Basic的ini文件。哦耶，宝贝！我也写了几年VB6代码。</li><li id="cdf5" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">C# / ASP。NET的资源文件(resx，如果我没记错的话)。</li><li id="2a4e" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">露比的。环境和秘密文件。</li><li id="4c1f" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">Erlang的sys.config文件。</li><li id="c2ea" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">Elixir的config.exs文件。</li><li id="f929" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">Swift / Objective-C .plist文件。</li></ul><p id="720a" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">你看到了共同的模式，对吗？它们都是文本文件，你把所有的常量/文字放在里面。然后，它们会与您的系统捆绑在一起发布。它们很容易编辑，并且通常带有智能机制，允许DevOps根据系统部署的不同环境来调整它们。这些语言/库也为开发人员提供了访问这些文件中的信息的超级简单的方法。但是编辑这些文件中的某些内容可能会带来一些挑战:</p><ul class=""><li id="1211" class="mc md hu jm b jn jo jq jr jt me jx mf kb mg kf mq mi mj mk dt translated">它通常需要系统重启和/或重新部署。如果没有，至少应该部署编辑过的文件并重新加载配置。</li><li id="6d60" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">非技术人员通常无法访问这些文件，而大多数时候他们才是需要更改的人。更改参数需要DevOps或SysAdmin人员的干预。</li><li id="27ed" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">即使有时通过注释添加，每个字段的文档也不是必需的，有时甚至会被忽略。</li><li id="a6c3" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">通常情况下，对这些文件的编辑没有保留任何听觉线索。</li><li id="8e47" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">在分布式系统中，您也必须将文件分发到所有节点。</li></ul><p id="ffaa" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">当然，这些问题中的每一个都可以用不同的解决方法或工具来解决。我们在系统中使用的是一种更通用的方法，试图一次解决所有这些问题。</p></div><div class="ab cl ky kz hc la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hn ho hp hq hr"><figure class="kj kk kl km fq kn fe ff paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="fe ff mw"><img src="../Images/ef4eb8c910e9e41acf5fb9b5124d08a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HeYA3vDYJeapwo0cosvrqw.jpeg"/></div></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">Gears #1 (by Steve Gadomski)</figcaption></figure><h1 id="63e8" class="lf lg hu bd lh li mr lk ll lm ms lo lp ja mt jb lr jd mu je lt jg mv jh lv lw dt translated">系统设置</h1><p id="97a9" class="pw-post-body-paragraph jk jl hu jm b jn lx iv jp jq ly iy js jt lz jv jw jx ma jz ka kb mb kd ke kf hn dt translated">那么，我们该怎么办？从概念上讲，我们的想法是将这些常量/文字作为我们系统模型的一等公民。因此，如果我们在OOP中工作，我们添加对象/类来表示这些系统设置。如果我们用函数式语言工作，我们用它们自己的<em class="kh">抽象数据类型</em>来表示这些设置，正如这里的<a class="ae kg" rel="noopener" href="/tech-lead-talks/7-heuristics-for-development-f8646d4a5219#.sd6d6slmv">所描述的</a>。</p><p id="46ff" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">实际上，它最终被保存在我们数据库的一个表中。正如所料，该表/模型有一个<strong class="jm hv">键</strong>和一个<strong class="jm hv">值</strong>。但是该模型还包括每个键的强制<strong class="jm hv">描述</strong>(从而提供适当的文档)和额外的<strong class="jm hv">元数据</strong>(在同一模型或另一个相关模型中)以跟踪谁在何时修改了值。它甚至可能包括以前的值，因此任何更改都可以很容易地回滚。</p><p id="1357" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">为了编辑这些值，我们在管理界面中添加了一个面板(通常是只有系统管理员才能访问的私有web应用程序)。根据系统和要配置的参数，该面板可提供或多或少的灵活性。一般来说，它提供了一个设置列表，每个设置都有它的关键字、描述和一个输入控件，管理员用户可以在其中编辑相应的值。</p><p id="60cc" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">然后，我们的系统从数据库表中获取这些值，尽管我们通常会在其上添加一个缓存层，以避免不断地在数据库中查询相同的值。为了处理缓存层，我们为管理面板添加了一个内部机制，让服务器知道它必须刷新缓存。每当设置发生变化时，就会执行该机制(通常是REST端点)。</p><h2 id="81ba" class="mx lg hu bd lh my mz na ll nb nc nd lp jt ne nf lr jx ng nh lt kb ni nj lv nk dt translated">对等</h2><ul class=""><li id="2f65" class="mc md hu jm b jn lx jq ly jt nl jx nm kb nn kf mq mi mj mk dt translated">非技术用户现在可以访问设置。他们不需要要求DevOps改变什么。</li><li id="2683" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">我们通过正确地建模我们领域的所有实体来遵循<a class="ae kg" rel="noopener" href="/tech-lead-talks/7-heuristics-for-development-f8646d4a5219#.sd6d6slmv"> 7开发启发法</a>。</li><li id="fe40" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">我们可以很容易地将所有想要的元数据添加到设置对象中(如描述、以前的值等。).</li><li id="02dc" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">很容易保持所有变化的听觉记录。有时候我们可以使用外部库，比如Ruby的<a class="ae kg" href="https://github.com/airblade/paper_trail" rel="noopener ugc nofollow" target="_blank"> PaperTrail </a></li><li id="6f50" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">重建和重新部署的需求大大减少。它并没有被完全消除(见下面的缺点),但是大多数时候不再需要它了，因为服务器可以在需要的时候获取新值。</li><li id="afe9" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">以这种方式开发系统在系统交付后需要更少的努力。换句话说，系统所有者可以自己管理它，这是系统所有者和开发人员都应该期望的。</li></ul><h2 id="6e23" class="mx lg hu bd lh my mz na ll nb nc nd lp jt ne nf lr jx ng nh lt kb ni nj lv nk dt translated">下降趋势</h2><ul class=""><li id="ce88" class="mc md hu jm b jn lx jq ly jt nl jx nm kb nn kf mq mi mj mk dt translated">非技术用户现在可以访问设置。他们可能会因失误而严重扰乱系统。强大的力量伴随着巨大的责任。</li><li id="c695" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">有些设置不能存储在数据库表或键/值存储中(例如，数据库url和端口)，因此配置文件或其他机制仍然必须用于此。</li><li id="a2f9" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">所有设置的初始值仍然需要包含在某个地方(例如，在Ruby中，我们仍然需要将所有的used-to-be-literals添加到seeds.rb文件中，有时仍然从。env文件也是)。</li><li id="69a3" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">改变一些值<em class="kh">可能需要</em>服务器重启(例如，它监听的TCP端口)。对于这些值，您需要仔细考虑它们是否不应该出现在这个表中，或者更改它们是否会触发重启机制。</li><li id="6400" class="mc md hu jm b jn ml jq mm jt mn jx mo kb mp kf mq mi mj mk dt translated">以这种方式开发系统需要更多的前期工作。</li></ul></div><div class="ab cl ky kz hc la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hn ho hp hq hr"><h1 id="b684" class="lf lg hu bd lh li lj lk ll lm ln lo lp ja lq jb lr jd ls je lt jg lu jh lv lw dt translated">结论</h1><p id="23fa" class="pw-post-body-paragraph jk jl hu jm b jn lx iv jp jq ly iy js jt lz jv jw jx ma jz ka kb mb kd ke kf hn dt translated">我们第一次想出这种技术，是因为我们已经厌倦了在凌晨1点被叫去(我们大多数人在布宜诺斯艾利斯为美国西海岸的公司工作)改变单个参数并再次部署系统。我们知道我们可以告诉客户在适当的配置文件中更改该值，并且我们可以教他们如何重启系统。实际上，我们不止一次地写了相关的文档。这并没有奏效:他们仍然觉得配置文件在某种程度上是我们的<em class="kh">领地</em>。事实上，他们离真相并不远。</p><p id="a4e6" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">我很确定在我们之前很多人都知道这件事，你们中的很多人在读完这篇文章后会想<em class="kh">嗯，伙计…当然！我已经用这种方式构建系统30年了！</em>。但是也许，希望，你们中的一些人还没有想到它，它可能会改善你们的生活，就像它改善了我们的生活一样。</p><p id="d36c" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">这个解决方案当然不创新，但是很管用！</p><p id="8356" class="pw-post-body-paragraph jk jl hu jm b jn jo iv jp jq jr iy js jt ju jv jw jx jy jz ka kb kc kd ke kf hn dt translated">客户仍然会在奇怪的时间打电话给我们要求更改一些东西，但是现在我们很高兴地告诉他们“是的，就在你的系统设置页面里。你可以自己改！”然后开心自豪的挂掉电话:)</p><div class="kj kk kl km fq ab cb"><figure class="no kn np nq nr ns nt paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="no kn np nq nr ns nt paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="no kn np nq nr ns nt paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nu nv nw"><p id="f922" class="jk jl kh jm b jn jo iv jp jq jr iy js nx ju jv jw ny jy jz ka nz kc kd ke kf hn dt translated"><a class="ae kg" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿妹家庭的一员。我们现在<a class="ae kg" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kg" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jk jl kh jm b jn jo iv jp jq jr iy js nx ju jv jw ny jy jz ka nz kc kd ke kf hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kg" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kg" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kj kk kl km fq kn fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff oa"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure></div></div>    
</body>
</html>