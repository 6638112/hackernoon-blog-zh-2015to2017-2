<html>
<head>
<title>Don’t Waste Your Time With MySQL Full-Text Search</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不要在MySQL全文搜索上浪费时间</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/dont-waste-your-time-with-mysql-full-text-search-61f644a54dfa?source=collection_archive---------2-----------------------#2017-10-05">https://medium.com/hackernoon/dont-waste-your-time-with-mysql-full-text-search-61f644a54dfa?source=collection_archive---------2-----------------------#2017-10-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b601" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我花了宝贵的时间尝试使用MySQL版本以来包含的<a class="ae jp" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-fulltext-index.html" rel="noopener ugc nofollow" target="_blank"> InnoDB全文搜索</a>功能，最终发现<strong class="it hv">它工作的用例相当有限</strong> …</p><p id="13e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为示例，让我们创建一个非常基本的表:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="1f0c" class="jz ka hu jv b fv kb kc l kd ke">CREATE TABLE document (<br/>  id int PRIMARY KEY,<br/>  content longtext NOT NULL,<br/>  FULLTEXT KEY (content)<br/>)</span></pre><p id="bedf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该表填充了<strong class="it hv">200万行</strong>。<code class="eh kf kg kh jv b">content</code>的平均长度为2千字节。</p><p id="00b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，让我们运行一个简单的查询:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="c645" class="jz ka hu jv b fv kb kc l kd ke">SELECT id <br/>FROM document <br/>WHERE MATCH(content) AGAINST ('commercial' IN BOOLEAN MODE) <br/>LIMIT 50</span></pre><p id="76d1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它是在50毫秒内执行的<strong class="it hv">。没问题。</strong></p><p id="371e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，让我们在同一个查询中结合对“普通”列的过滤和全文搜索:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="f846" class="jz ka hu jv b fv kb kc l kd ke">SELECT id <br/>from document <br/>WHERE MATCH(content) AGAINST ('commercial' IN BOOLEAN MODE)<br/>AND id &gt; 10000000<br/>LIMIT 50</span></pre><p id="7fcb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它是在50秒内执行的<strong class="it hv">，这使得它无法使用…</strong></p><p id="0c20" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请注意，这是与上面相同的查询，只有一个附加条件(<code class="eh kf kg kh jv b">id &gt; 10000000</code>)。此外，该查询不返回任何行，因为附加条件排除了所有行(所有id都低于10，000，000)。</p><p id="5f33" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">为什么这么慢？</strong>这是因为我的查询中使用的术语“商业”很常见(大约300，000个文档包含该术语)，还因为MySQL不擅长合并索引。基本上，MySQL使用全文索引来查找“商业”一词，然后它执行一种嵌套连接来查找300，000行并检查<code class="eh kf kg kh jv b">id</code>上的条件。前者很快，后者极慢。</p><p id="4294" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果MySQL能够使用内存位图组合多个索引，那就太好了。这将使内置的全文搜索更加有用。与此同时，我必须找到一个替代方案。</p><p id="f18e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您有任何关于如何在不切换到另一个数据库引擎的情况下解决这个问题的想法，请联系我。</p></div><div class="ab cl ki kj hc kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hn ho hp hq hr"><p id="525b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kp">感谢</em> <a class="kq kr gr" href="https://medium.com/u/f17156a1915f?source=post_page-----61f644a54dfa--------------------------------" rel="noopener" target="_blank"> <em class="kp">卡洛斯奥特罗巴罗斯</em> </a> <em class="kp">举报一个错别字。</em></p><figure class="jq jr js jt fq ks"><div class="bz el l di"><div class="kt ku l"/></div></figure></div></div>    
</body>
</html>