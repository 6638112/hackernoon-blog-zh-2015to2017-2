<html>
<head>
<title>Introduction to Web scraping with Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java网页抓取简介</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/introduction-to-web-scraping-with-java-3d8a8d0f250b?source=collection_archive---------1-----------------------#2017-12-01">https://medium.com/hackernoon/introduction-to-web-scraping-with-java-3d8a8d0f250b?source=collection_archive---------1-----------------------#2017-12-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/8c995658f573034f7fb352e33cb9f719.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJKIoC2oL-mkT5qNg-UCpg.jpeg"/></div></div></figure><div class=""/><p id="af4b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" href="https://hackernoon.com/tagged/web-scraping" rel="noopener ugc nofollow" target="_blank">网页抓取</a>或爬行是通过下载和解析HTML代码从第三方网站获取数据，以提取您想要的数据。</p><p id="c0aa" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为每个网站都不提供干净的API，或者根本不提供API，所以当涉及到提取网站信息时，web抓取可能是唯一的解决方案。<br/>许多公司使用它来获取有关竞争对手价格、新闻聚合、大量电子邮件收集的信息…</p><p id="0781" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">几乎所有东西都可以从<a class="ae ka" href="https://hackernoon.com/tagged/html" rel="noopener ugc nofollow" target="_blank"> HTML </a>中提取，唯一“难以”提取的信息是内部图像或其他媒体。</p><p id="47dd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这篇文章中，我们将看到在<a class="ae ka" href="https://hackernoon.com/tagged/java" rel="noopener ugc nofollow" target="_blank"> Java </a>中获取和解析数据的基本技术。</p><p id="4b22" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> <em class="kb">本文节选自我的新书</em> </strong> <a class="ae ka" href="https://www.javawebscrapinghandbook.com/?utm_source=medium&amp;utm_medium=blogpost&amp;utm_campaign=post1" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> <em class="kb"> Java网页抓取手册</em> </strong> </a> <strong class="je ig"> <em class="kb">。这本书将教你高尚的网络搜集艺术。从解析HTML到破解验证码，处理大量使用Javascript的网站等等。</em> </strong></p><h1 id="b402" class="kc kd if bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">先决条件</h1><ul class=""><li id="d950" class="la lb if je b jf lc jj ld jn le jr lf jv lg jz lh li lj lk dt translated">基本的Java理解</li><li id="03bf" class="la lb if je b jf ll jj lm jn ln jr lo jv lp jz lh li lj lk dt translated">基本XPath</li></ul><p id="cddb" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你将需要带有HtmlUnit的Java 8</p><figure class="lq lr ls lt fq hw"><div class="bz el l di"><div class="lu lv l"/></div></figure><p id="767a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您正在使用Eclipse，我建议您在细节窗格中配置最大长度(当您单击variables选项卡时),这样您将看到当前页面的整个HTML。</p><figure class="lq lr ls lt fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lw"><img src="../Images/311d240a311a5bd949b54585efe014f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zERQFDjmZl1paDnx.jpg"/></div></div></figure><h1 id="74a1" class="kc kd if bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">让我们刮刮克雷格列表</h1><p id="a4bb" class="pw-post-body-paragraph jc jd if je b jf lc jh ji jj ld jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">对于我们的第一个例子，我们将从CraigList获取商品，因为他们似乎没有提供API，以收集名称、价格和图像，并将其导出到JSON。</p><p id="9d84" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先让我们看看当你在CraigList上搜索一个项目时会发生什么。打开Chrome开发工具，点击网络选项卡:</p><figure class="lq lr ls lt fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ma"><img src="../Images/d5a9e1ecb51ac3eacee696be517695fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6MG-RILeHmj7R_v9.jpg"/></div></div></figure><p id="dcf8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">搜索URL是:</p><pre class="lq lr ls lt fq mb mc md me aw mf dt"><span id="83af" class="mg kd if mc b fv mh mi l mj mk"><a class="ae ka" href="https://newyork.craigslist.org/search/moa?is_paid=all&amp;search_distance_type=mi&amp;query=iphone+6s" rel="noopener ugc nofollow" target="_blank">https://newyork.craigslist.org/search/moa?is_paid=all&amp;search_distance_type=mi&amp;query=iphone+6s</a></span></pre><p id="7f64" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你也可以使用</p><pre class="lq lr ls lt fq mb mc md me aw mf dt"><span id="675d" class="mg kd if mc b fv mh mi l mj mk"><a class="ae ka" href="https://newyork.craigslist.org/search/sss?sort=rel&amp;query=iphone+6s" rel="noopener ugc nofollow" target="_blank">https://newyork.craigslist.org/search/sss?sort=rel&amp;query=iphone+6s</a></span></pre><p id="3489" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在你可以打开你最喜欢的IDE了，是时候编码了。HtmlUnit需要一个WebClient来发出请求。有许多选项(代理设置、浏览器、启用重定向…)</p><p id="271b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将禁用<a class="ae ka" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> Javascript </a>，因为我们的示例不需要它，并且禁用Javascript会使页面加载更快:</p><figure class="lq lr ls lt fq hw"><div class="bz el l di"><div class="lu lv l"/></div></figure><p id="1b8a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">HtmlPage对象将包含HTML代码，你可以用<code class="eh ml mm mn mc b">asXml()</code>方法访问它。</p><p id="c1ab" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们将获取标题、图像和价格。我们需要检查一个项目的DOM结构:</p><figure class="lq lr ls lt fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mo"><img src="../Images/5339e183314c00c63d2dc1584fb6991a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5KDEYrSfqLa3XS7-.jpg"/></div></div></figure><p id="f84f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用HtmlUnit，您有几个选择html标签的选项:</p><ul class=""><li id="0c2a" class="la lb if je b jf jg jj jk jn mp jr mq jv mr jz lh li lj lk dt translated"><code class="eh ml mm mn mc b">getHtmlElementById(String id)</code></li><li id="7b3d" class="la lb if je b jf ll jj lm jn ln jr lo jv lp jz lh li lj lk dt translated"><code class="eh ml mm mn mc b">getFirstByXPath(String Xpath)</code> - <code class="eh ml mm mn mc b">getByXPath(String XPath)</code>返回一个列表</li><li id="999f" class="la lb if je b jf ll jj lm jn ln jr lo jv lp jz lh li lj lk dt translated">很多其他的，rtfm！</li></ul><p id="cb23" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为没有我们可以使用的ID，所以我们必须创建一个<a class="ae ka" href="http://www.w3schools.com/xsl/xpath_syntax.asp" rel="noopener ugc nofollow" target="_blank"> Xpath </a>表达式来选择我们想要的标签。</p><p id="30d2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> XPath </strong>是一种选择XML节点的查询语言(在我们的例子中是HTML)。</p><p id="db9e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，我们将选择所有具有类别<code class="eh ml mm mn mc b">`result-info</code>的<code class="eh ml mm mn mc b">&lt;p&gt;</code>标签</p><p id="345e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后我们将遍历这个列表，为每个项目选择名称、价格和url，然后打印它。</p><figure class="lq lr ls lt fq hw"><div class="bz el l di"><div class="lu lv l"/></div></figure><p id="c71e" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，我们将使用<a class="ae ka" href="https://github.com/FasterXML/jackson" rel="noopener ugc nofollow" target="_blank"> Jackson </a>库把结果放到JSON中，以JSON格式映射条目，而不只是打印结果。</p><p id="a039" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，我们需要一个POJO(普通旧java对象)来表示项目</p><p id="cf9b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig">Item.java</strong></p><figure class="lq lr ls lt fq hw"><div class="bz el l di"><div class="lu lv l"/></div></figure><p id="c6ae" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后将其添加到pom.xml中:</p><figure class="lq lr ls lt fq hw"><div class="bz el l di"><div class="lu lv l"/></div></figure><p id="1c0a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们要做的就是创建一个项目，设置它的属性，并将其转换为JSON字符串(或文件……)，并稍微修改一下前面的代码:</p><figure class="lq lr ls lt fq hw"><div class="bz el l di"><div class="lu lv l"/></div></figure><h1 id="7b3b" class="kc kd if bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">更进一步</h1><p id="5e29" class="pw-post-body-paragraph jc jd if je b jf lc jh ji jj ld jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hn dt translated">这个例子并不完美，还有很多可以改进的地方:</p><ul class=""><li id="7808" class="la lb if je b jf jg jj jk jn mp jr mq jv mr jz lh li lj lk dt translated">多城市搜索</li><li id="6f12" class="la lb if je b jf ll jj lm jn ln jr lo jv lp jz lh li lj lk dt translated">处理分页</li><li id="0967" class="la lb if je b jf ll jj lm jn ln jr lo jv lp jz lh li lj lk dt translated">多标准搜索</li></ul><p id="4922" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以在这个<a class="ae ka" href="https://github.com/ksahin/introWebScraping" rel="noopener ugc nofollow" target="_blank"> Github repo </a>中找到代码</p><p id="2664" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我希望你喜欢这篇文章，欢迎在评论中给我反馈。</p><p id="e097" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kb">这篇文章是摘自我的新书:<br/> </em> <a class="ae ka" href="https://www.javawebscrapinghandbook.com/?utm_source=medium&amp;utm_medium=blogpost&amp;utm_campaign=post1" rel="noopener ugc nofollow" target="_blank"> <strong class="je ig"> <em class="kb"> Java网页抓取手册</em> </strong> </a> <strong class="je ig"> <em class="kb">。</em> </strong> <em class="kb"> <br/>本书将教你高贵的刮网艺术。从解析HTML到破解验证码，处理大量使用Javascript的网站等等。</em></p><figure class="lq lr ls lt fq hw"><div class="bz el l di"><div class="ms lv l"/></div></figure></div><div class="ab cl mt mu hc mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hn ho hp hq hr"><p id="cd19" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="kb">原载于2017年12月1日</em><a class="ae ka" href="https://ksah.in/introduction-to-web-scraping-with-java/" rel="noopener ugc nofollow" target="_blank"><em class="kb">ksah . in</em></a><em class="kb">。</em></p><figure class="lq lr ls lt fq hw"><div class="bz el l di"><div class="ms lv l"/></div></figure></div></div>    
</body>
</html>