<html>
<head>
<title>Tutorial: Creating and managing a Node.js server on AWS, part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:在AWS上创建和管理Node.js服务器，第1部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/tutorial-creating-and-managing-a-node-js-server-on-aws-part-1-d67367ac5171?source=collection_archive---------1-----------------------#2016-12-20">https://medium.com/hackernoon/tutorial-creating-and-managing-a-node-js-server-on-aws-part-1-d67367ac5171?source=collection_archive---------1-----------------------#2016-12-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><h1 id="037d" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">介绍</h1><p id="af1a" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">运行服务器的方式有很多种，也有很多云平台可以做到这一点。要开始这个系列教程，我将从使用AWS (Amazon Web Services)管理EC2服务器开始，这是最基本的，也可能是运行Node.js应用程序最常见的方式。</p><p id="949e" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">本教程系列旨在帮助更好地理解基于云的服务器，尽管会有一些小部分展示如何设置一个简单的Node.js应用程序。</p><p id="0309" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">我发现大多数配置AWS或云服务器的教程通常需要相当多的知识，而且可能会令人望而生畏。在很大程度上，字里行间有相当多的含义需要理解。我希望这很容易做到。为了使它尽可能简单，我将考虑Mac用户来编写它，但是如果你使用Linux，那么它将不是一个大问题，我们将仅仅使用bash和一个文本编辑器。</p><p id="0383" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">这一部分将涵盖</p><ul class=""><li id="e8da" class="ks kt hu jr b js kn jw ko ka ku ke kv ki kw km kx ky kz la dt translated">启动AWS服务器</li><li id="f79a" class="ks kt hu jr b js lb jw lc ka ld ke le ki lf km kx ky kz la dt translated">SSH到您的服务器</li><li id="43e1" class="ks kt hu jr b js lb jw lc ka ld ke le ki lf km kx ky kz la dt translated">安装Node.js</li><li id="20e2" class="ks kt hu jr b js lb jw lc ka ld ke le ki lf km kx ky kz la dt translated">创建用静态消息响应的公共HTTP端点</li></ul><h1 id="8f97" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">创建和启动服务器</h1><p id="6502" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">如果你还没有创建AWS账户，打开<a class="ae lg" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/</a>，然后选择<strong class="jr hv"> <em class="lh">创建AWS账户</em> </strong>。按照步骤进行帐户设置。</p><p id="731d" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">登录到您的AWS帐户后，我们将创建一台EC2机器。EC2代表<em class="lh">亚马逊弹性计算云。</em>云计算只是亚马逊数据中心中连接到互联网的一批计算机，可以通过使用AWS仪表板进行控制。我们将从这些机器中挑选一台，安装好供我们使用。</p><p id="6b69" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">点击导航栏上的<strong class="jr hv"> <em class="lh">【服务】</em> </strong>，选择<strong class="jr hv"> <em class="lh">计算</em> </strong>类别下的EC2。点击<strong class="jr hv"> <em class="lh">启动实例</em> </strong>。你将会看到一大堆不同图片的选项。映像是硬盘驱动器的精确副本，可以轻松地加载到空硬盘驱动器上，在这种情况下，它们被用作预设，以便轻松设置您的机器。如果没有至少一个操作系统和SSH，甚至不可能配置实例，所以一些预置软件是必要的。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff li"><img src="../Images/9ebf0665d341d0ac9d95217a44ab3987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nJR0OCEtnci11pr6UBiN2g.png"/></div></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Selecting an image</figcaption></figure><p id="e6a3" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">这些选项包括不同版本的Windows和Linux。大多数服务器运行Linux，这是开发Node.js的一个很好的选择，Windows服务器只对一些特殊的应用程序有用，比如。净*颤栗*。对于我们将在本教程中做的基本事情，Linux映像之间没有太大的区别。我选择使用<strong class="jr hv"> <em class="lh"> Ubuntu Server </em> </strong>，因为它被广泛使用，有大量的指南和大量关于堆栈溢出的问题和答案。</p><p id="50fb" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">一旦选择了一个图像，我们需要选择一个实例类型。注意，这是一个<strong class="jr hv"> <em class="lh">虚拟服务器</em> </strong>，带<strong class="jr hv"> <em class="lh">虚拟CPU</em></strong>。虚拟化意味着，虽然看起来我们连接并配置了一台计算机，但实际上Amazon将在同一台计算机上运行多个实例，而假装不是这样，这对于扩展和定价来说非常好。让我们选择<strong class="jr hv"> <em class="lh"> t2.micro </em> </strong>，它符合<a class="ae lg" href="https://aws.amazon.com/free/" rel="noopener ugc nofollow" target="_blank">免费层</a>的条件，因此如果您的帐户不到12个月，您可以免费运行您的服务器。感谢亚马逊！</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff ly"><img src="../Images/cb1fe003575d111e2a01a65451210883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nLEHnWw2_Hot0_YIiAGGzg.png"/></div></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Selecting an instance type</figcaption></figure><p id="c1f4" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">选择实例类型后，点击<strong class="jr hv"> <em class="lh">下一步:配置实例详细信息</em> </strong>。接下来的页面更复杂，但是你现在可以忽略它的大部分，我们以后会探索这些选项。</p><p id="8a18" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">点击<strong class="jr hv"> <em class="lh">下一步:添加存储</em> </strong>。默认是8GB的固态硬盘，这对我们来说很好。点击<strong class="jr hv"> <em class="lh">下一步:添加标签</em> </strong>。我们不需要任何标签，但是当你有大量的实例，并且你需要过滤和搜索它们时，它们是有用的。</p><p id="9787" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">点击<strong class="jr hv"> <em class="lh">下一步:配置安全组</em> </strong>。安全组是您的服务器的配置，告诉它应该将哪些端口暴露给特定类型流量的哪些IP地址。给小组起个有意义的名字，我选了<strong class="jr hv"> <em class="lh">辅导组</em> </strong>。</p><p id="65e0" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">要运行我们的应用程序，我们需要SSH访问，默认情况下它位于端口22，使用TCP协议。亚马逊默认为我们添加了这个。有一个关于源是<code class="eh lz ma mb mc b">0.0.0.0/0</code>的警告，它允许我们从任何IP地址进行SSH，但是这没问题。如果您从VPN或公司网络部署和配置您的应用程序，那么您可以只限制该IP的SSH访问，这是在生产中运行某些东西时的一个很好的安全预防措施，但是SSH访问需要正确的SSH密钥，因此即使没有这项措施也是完全安全的。</p><p id="8ff3" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">因为我们还想为一个应用程序提供服务，所以我们需要公开一个HTTP端口，默认情况下这是端口80(但是浏览器会去掉这个端口，所以你在URL中看不到它)。点击<strong class="jr hv"> <em class="lh">添加规则</em> </strong>并选择类型为<strong class="jr hv"> <em class="lh"> HTTP </em> </strong>，默认设置将使用TCP作为协议，并向所有IP开放端口80。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff ly"><img src="../Images/cc158ab01f657e3d14571c66c89cfd9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sRsK_NjW6wYR9i8kDwM3iQ.png"/></div></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Configuring a security group</figcaption></figure><p id="8532" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">要启动实例，点击<strong class="jr hv"> <em class="lh">查看并启动，</em> </strong>然后点击<strong class="jr hv"> <em class="lh">启动</em> </strong>。将提示您设置一个SSH密钥，这将允许您访问实例。选择<strong class="jr hv"> <em class="lh">创建新的密钥对</em> </strong>，并给密钥命名，我将其命名为“教程”。点击<strong class="jr hv"> <em class="lh">下载密钥对</em> </strong>。这将下载一个. pem文件，该文件可用于SSH到服务器。请妥善保管该文件，因为任何人都可以使用它连接到您的服务器，如果您丢失了该文件，您需要重新生成一个文件。</p><p id="3018" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">点击<strong class="jr hv"> <em class="lh">启动实例</em> </strong>。点击<strong class="jr hv"> <em class="lh">查看实例</em> </strong>。呜！您的实例应该正在启动。一旦<strong class="jr hv"> <em class="lh">实例状态</em> </strong>为<strong class="jr hv"> <em class="lh">运行</em> </strong>那么你就准备好SSH进入了。</p><p id="7511" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated"><strong class="jr hv"> <em class="lh">注意:</em> </strong>不运行实例时，记得停止它！为此只需右键点击<strong class="jr hv">下的<em class="lh">实例，在</em>实例状态下</strong>点击<strong class="jr hv"> <em class="lh">停止</em> </strong>。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff md"><img src="../Images/e77b2a56d4d2a7da113734f5986b48c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*25YIcjkNeRUSwG7rL-d6nQ.png"/></div></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Stopping an instance</figcaption></figure><h1 id="f4b9" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">SSH到您的服务器</h1><p id="2e84" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">通常，放置<code class="eh lz ma mb mc b">.pem</code>文件的正确位置是在用户目录下的<code class="eh lz ma mb mc b">.ssh</code>文件夹中。<code class="eh lz ma mb mc b">.ssh</code>文件夹是一个隐藏文件夹，在finder open terminal中打开并执行<code class="eh lz ma mb mc b">open</code>命令。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="c159" class="mi is hu mc b fv mj mk l ml mm"># The open command will open the<br/># given path using the default system<br/># application for the file type. For<br/># folders it uses finder!<br/>$ open ~/.ssh</span></pre><p id="710f" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">一旦<code class="eh lz ma mb mc b">.pem</code>文件在你的ssh文件夹中，使用<code class="eh lz ma mb mc b">chmod</code>来设置权限，这样它就可以被用作一个密钥。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="7c58" class="mi is hu mc b fv mj mk l ml mm">$ chmod 400 ~/.ssh/whatever-your-key-name-is.pem</span></pre><p id="e421" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">对于SSH，我们需要一个用户名、一个地址和一个密钥。当我们在EC2 instances仪表板中单击我们的实例时，该地址是可用的。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff ly"><img src="../Images/7a16e8b221cec2a03117c49cef4bd74a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ockW62GV_RnFxcUoLjLrkQ.png"/></div></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Instance details</figcaption></figure><p id="18b7" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">我设置的实例有一个我可以用来连接的公共IP <code class="eh lz ma mb mc b">52.214.64.31</code>，使用<code class="eh lz ma mb mc b">-i</code>标志将<code class="eh lz ma mb mc b">.pem</code>文件作为密钥。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="bd78" class="mi is hu mc b fv mj mk l ml mm"># Don't actually run this command<br/>$ ssh -i ~/.ssh/whatever-your-key-name-is.pem <!-- -->52.214.64.3</span></pre><p id="5290" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">然而，更正确的做法是使用公共DNS(唯一真正的区别是，当您从EC2机器连接到EC2机器时，DNS将解析为私有IP，而不是公共IP)。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="f282" class="mi is hu mc b fv mj mk l ml mm"># Don't run this command either<br/>$ ssh -i ~/.ssh/whatever-your-key-name-is.pem ec2-52-214-64-31.eu-west-1.compute.amazonaws.com</span></pre><p id="ffb5" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">快到了。默认情况下，在没有用户名的情况下连接到您的实例会尝试以<code class="eh lz ma mb mc b">root</code>的身份登录，这通常是不允许的。通过右键单击您的实例并选择<strong class="jr hv"> <em class="lh">连接</em> </strong>，我们可以看到正确的用户名是什么。这取决于你选择的图片，对于ubuntu用户名默认为<code class="eh lz ma mb mc b">ubuntu</code>。你可以在<strong class="jr hv"> <em class="lh">示例中看到用户名</em> </strong>部分的对话，它是<code class="eh lz ma mb mc b">@</code>符号之前的部分。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff mn"><img src="../Images/b448295cc8ccedf6e6e3597ec3d11eac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rXhzy4hfCWeEbjFOYQ-SvA.png"/></div></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Finding the SSH username</figcaption></figure><p id="ce6a" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">要进行连接，SSH命令应该类似于</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="d29b" class="mi is hu mc b fv mj mk l ml mm"># Fill in your specific details for this to work.<br/>$ ssh -i ~/.ssh/whatever-your-key-name-is.pem ubuntu@ec2-52-214-64-31.eu-west-1.compute.amazonaws.com</span></pre><p id="6f47" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">这应该会将您连接到您的实例，只需在提示时键入<code class="eh lz ma mb mc b">yes</code>，以便您可以将您的实例添加为已知主机。你接通了！</p><h1 id="c809" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">安装节点和系统依赖项</h1><p id="6c03" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">在SSH会话中，首先要做的是获取Node.js。<a class="ae lg" href="https://github.com/creationix/nvm" rel="noopener ugc nofollow" target="_blank">NVM(节点版本管理器)</a>是安装Node . js的一种非常好的方式，如果需要，它允许您轻松地切换版本。</p><p id="3f73" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">要安装NVM，只需运行此命令(与NVM安装说明相同)。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="8de6" class="mi is hu mc b fv mj mk l ml mm">$ curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.32.1/install.sh | bash</span></pre><p id="fb22" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">这个命令从远程URL下载一个脚本并运行它。你现在有NVM了！但是如果你运行<code class="eh lz ma mb mc b">nvm ls</code>，你会发现它不存在。这是因为NVM给你的<code class="eh lz ma mb mc b">~/.bashrc</code>加了一些代码。这个文件是一个特殊的文件，在您每次登录到您的实例时都会运行，因此要让NVM运行，您可以注销并再次登录。然而，您可以使用<code class="eh lz ma mb mc b">source</code>命令手动运行该文件。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="1975" class="mi is hu mc b fv mj mk l ml mm">$ source ~/.bashrc</span></pre><p id="1e8a" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">现在运行<code class="eh lz ma mb mc b">nvm ls</code>有效！但是没有安装任何节点版本！要获得最新版本，只需<code class="eh lz ma mb mc b">nvm install &lt;latest version number&gt;</code>。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="1d7a" class="mi is hu mc b fv mj mk l ml mm">$ nvm install 7</span></pre><p id="bd7f" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">要检查节点是否准备就绪，只需回显版本。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="b725" class="mi is hu mc b fv mj mk l ml mm">$ node --version</span></pre><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff mo"><img src="../Images/a0b1eeb685732cdd8670b15866b12a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f2mCDmWJzW8MhcQjIpBRjg.png"/></div></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Installing node</figcaption></figure><p id="6060" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">Node.js已安装！</p><h1 id="6414" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">创建公共HTTP端点</h1><p id="0c92" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">在结束这部分教程之前，我们将创建一个任何人都可以从浏览器请求的公共URL，以便从服务器获得响应。</p><p id="c465" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">为服务器创建一个目录，并将<code class="eh lz ma mb mc b">cd</code>放入其中。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="6a0f" class="mi is hu mc b fv mj mk l ml mm">$ mkdir server<br/>$ cd server</span></pre><p id="635f" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">现在你在你的服务器目录中，你需要<code class="eh lz ma mb mc b">npm init</code></p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="a420" class="mi is hu mc b fv mj mk l ml mm">$ npm init</span></pre><p id="f519" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">这将创建一个package.json文件，用于跟踪我们使用的任何依赖项。<code class="eh lz ma mb mc b">npm init</code>会询问一系列信息，我倾向于只按<code class="eh lz ma mb mc b">enter</code>来使用所有的默认值。</p><p id="fa1a" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">运行我们的服务器所需要的就是<code class="eh lz ma mb mc b">express</code>包。安装<code class="eh lz ma mb mc b">express</code>并将其添加到<code class="eh lz ma mb mc b">package.json</code>中。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="29ff" class="mi is hu mc b fv mj mk l ml mm">$ npm install express --save-dev</span></pre><p id="4477" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">注意，现在您应该有一个<code class="eh lz ma mb mc b">node_modules</code>目录和<code class="eh lz ma mb mc b">package.json</code></p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="03e6" class="mi is hu mc b fv mj mk l ml mm">$ ls</span></pre><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff mp"><img src="../Images/bd983e5d5e2e9f5f02e83eec3db02a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aQelypyf2C8jeIRYQdSUiA.png"/></div></div></figure><p id="f4d8" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">现在我们只需要添加一些代码来运行服务器。我们将使用nano在一个<code class="eh lz ma mb mc b">index.js</code>文件中编写服务器。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="077d" class="mi is hu mc b fv mj mk l ml mm">$ nano index.js</span></pre><p id="bbf6" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">我用的服务器只是回应“嘿！”当你向<code class="eh lz ma mb mc b">/</code>发出请求时。我在端口3000上监听请求。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="0216" class="mi is hu mc b fv mj mk l ml mm">const express = require('express')<br/>const app = express()</span><span id="6970" class="mi is hu mc b fv mq mk l ml mm">app.get('/', (req, res) =&gt; {<br/>  res.send('HEY!')<br/>})</span><span id="215f" class="mi is hu mc b fv mq mk l ml mm">app.listen(3000, () =&gt; console.log('Server running on port 3000'))</span></pre><p id="4a1c" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">按下<code class="eh lz ma mb mc b">ctrl+x</code>退出，确保通过按下<code class="eh lz ma mb mc b">y</code>再按下<code class="eh lz ma mb mc b">enter</code>退出时保存。</p><p id="20d5" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">现在我们可以使用node来启动服务器了！</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="20ee" class="mi is hu mc b fv mj mk l ml mm">$ node index.js</span></pre><p id="3382" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">一旦监听，这应该记录“服务器在端口3000上运行”。您可能已经注意到，我们没有将服务器流量开放给端口<code class="eh lz ma mb mc b">3000</code>，而是开放给端口<code class="eh lz ma mb mc b">80</code>。端口<code class="eh lz ma mb mc b">80</code>是一个特权端口，在那里使用Node.js运行服务器是不常见的，通常使用路由器更好。如果您将<code class="eh lz ma mb mc b">index.js</code>文件更改为使用<code class="eh lz ma mb mc b">80</code>，然后运行<code class="eh lz ma mb mc b">node index.js</code>，您将会注意到一个权限被拒绝的错误。</p><p id="07bc" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">在下一个教程中，我们将添加一个路由器来使用端口<code class="eh lz ma mb mc b">80</code>，但是现在让我们打开端口<code class="eh lz ma mb mc b">3000</code>，这样我们就可以测试我们的服务器了。</p><p id="869a" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">让您的服务器保持运行，并转到EC2控制台中的<strong class="jr hv">安全组</strong>选项卡。右键单击您设置的安全组，然后单击<strong class="jr hv"> <em class="lh">编辑入站规则</em> </strong>。点击<strong class="jr hv"> <em class="lh">添加规则</em> </strong>。这次我们将在端口3000上使用一个自定义的TCP规则，它对任何地方都开放。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff mr"><img src="../Images/d3c21a5a593b05144c597a7ca5bcb34f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CuzuWfaIsittNBeAhU2HcQ.png"/></div></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Opening up port 3000 to TCP traffic</figcaption></figure><p id="bb5d" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">单击保存。我们现在应该可以访问我们的服务器了！使用浏览器，使用端口3000访问您的公共DNS URL，您应该会看到<code class="eh lz ma mb mc b">HEY!</code>响应。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff ms"><img src="../Images/91a8cef56460262f38a94b3ba7ef7d01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2hCAp9YGfhF7tc198YTNOA.png"/></div></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">The response from your server</figcaption></figure><p id="6ae5" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">要在我们注销时让服务器继续运行，我们需要按<code class="eh lz ma mb mc b">ctrl+z</code>来暂停这个过程(这只在您的服务器正在运行时有效，<code class="eh lz ma mb mc b">node index.js</code>)。当您按下<code class="eh lz ma mb mc b">ctrl+z</code>时，您将看到所有作业，在这种情况下，只有暂停的Node.js作业。</p><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/2850fd00393b4e9045941840ae1c5296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*xleLw24KhRGEgpYgH3b7vg.png"/></div></figure><p id="b8ea" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">你可以看到<code class="eh lz ma mb mc b">node index.js</code>的工号是1(如<code class="eh lz ma mb mc b">[1]+</code>所示)。要在后台运行，使用<code class="eh lz ma mb mc b">bg</code>命令。</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="6cc3" class="mi is hu mc b fv mj mk l ml mm">$ bg %1</span></pre><p id="f0ce" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">然后注销</p><pre class="lj lk ll lm fq me mc mf mg aw mh dt"><span id="1ed6" class="mi is hu mc b fv mj mk l ml mm">$ exit</span></pre><p id="b3c6" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">你应该仍然能够访问你的网址，并看到“嘿！”回应。</p><h1 id="04eb" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">结论</h1><p id="010a" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">如果一切顺利，我们应该有一个简单的Node.js应用程序，可以从世界上任何地方的公共URL访问它！</p><p id="ab6f" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">要停止实例，只需导航到EC2仪表板中的<strong class="jr hv"> <em class="lh">实例</em> </strong>选项卡，右键单击您的实例，并在<strong class="jr hv"> <em class="lh">实例</em> </strong> <strong class="jr hv"> <em class="lh">状态</em> </strong>中单击<strong class="jr hv"> <em class="lh">停止</em> </strong>。</p><p id="b066" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">在下一篇教程中，我打算介绍</p><ul class=""><li id="1eb2" class="ks kt hu jr b js kn jw ko ka ku ke kv ki kw km kx ky kz la dt translated">使用nginx在端口80上运行应用程序</li><li id="52e0" class="ks kt hu jr b js lb jw lc ka ld ke le ki lf km kx ky kz la dt translated">使用PM2在重启后保持应用程序运行</li><li id="41d7" class="ks kt hu jr b js lb jw lc ka ld ke le ki lf km kx ky kz la dt translated">使用PM2从本地目录部署应用程序</li></ul><p id="715d" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated">如果我错过了什么或者有点困惑，请在评论区告诉我！</p><p id="fce3" class="pw-post-body-paragraph jp jq hu jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hn dt translated"><a class="ae lg" rel="noopener" href="/@bobtodski/tutorial-creating-and-managing-a-node-js-server-on-aws-part-2-5fbdea95f8a1#.mnlkymeti">第2部分现已推出。</a></p><div class="lj lk ll lm fq ab cb"><figure class="mu ln mv mw mx my mz paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mu ln mv mw mx my mz paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mu ln mv mw mx my mz paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="na nb nc"><p id="f922" class="jp jq lh jr b js kn ju jv jw ko jy jz nd kp kc kd ne kq kg kh nf kr kk kl km hn dt translated"><a class="ae lg" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是T21家庭的一员。我们现在<a class="ae lg" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae lg" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jp jq lh jr b js kn ju jv jw ko jy jz nd kp kc kd ne kq kg kh nf kr kk kl km hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae lg" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae lg" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lj lk ll lm fq ln fe ff paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="fe ff ng"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>