<html>
<head>
<title>Shut down your Raspberry Pi, the easy way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关闭你的树莓派，简单的方法</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/shut-down-your-raspberry-pi-the-easy-way-9c7be0b4fff8?source=collection_archive---------3-----------------------#2016-11-29">https://medium.com/hackernoon/shut-down-your-raspberry-pi-the-easy-way-9c7be0b4fff8?source=collection_archive---------3-----------------------#2016-11-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/bd1df555476a7abb367a9d97f2c80a86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9r9UtjGUNePkokjqLl1ZQ.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">A Raspberry Pi 3</figcaption></figure><p id="5857" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">树莓派(又名rpi)是一个很好的小东西。它很便宜，用SD卡运行debian。在它上面做任何事情都很快很容易，只要你不把它当成一个<em class="ke">无头</em>设备。</p><p id="0929" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">无头设备是指没有连接显示器、鼠标或键盘等外围设备的设备。他们基本上处于最低限度:权力<strong class="ji hv">和网络<strong class="ji hv"/>。(这些可以在没有GUI的情况下运行轻量级发行版)。访问这些机器的唯一方式是通过串行转usb适配器或ssh。特别是，通过ssh的访问也有自己的问题。</strong></p><h1 id="5d7f" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">如果没有网络连接，您将如何关闭您的无头rpi？</h1><p id="b5ef" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">reddit上有一整个<a class="ae li" href="https://www.reddit.com/r/raspberry_pi/comments/59nate/really_wish_the_rpi_had_a_power_switch/" rel="noopener ugc nofollow" target="_blank">线程</a>致力于关闭无头pi。大多数答案都围绕着给GPIO附加一个按钮或者购买一个附加板。有相当多的解决方案涉及买东西。</p><p id="e1bc" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我要买东西吗？<br/> <em class="ke">没门！</em></p><p id="f657" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">很久以前，Stefan Tomanek写了一个叫做<a class="ae li" href="https://github.com/wertarbyte/triggerhappy" rel="noopener ugc nofollow" target="_blank"> triggerhappy </a>的东西。用他的话说，</p><blockquote class="lj lk ll"><p id="c2c9" class="jg jh ke ji b jj jk jl jm jn jo jp jq lm js jt ju ln jw jx jy lo ka kb kc kd hn dt translated">Triggerhappy是一个热键守护程序，专为小型嵌入式系统开发，例如基于linux的路由器。它附加到输入设备文件上，<br/>解释接收到的事件数据，并执行在<br/>配置中配置的脚本。</p></blockquote><h1 id="3fda" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">给我台阶就行了！</h1><p id="ceda" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">要关闭pi，我们将鼠标插入pi的USB并右键单击。我们将配置<em class="ke"> triggerhappy </em>守护进程来监听该事件并调用shutdown命令。</p><p id="7ee9" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">找到触发</strong>的事件代码<br/>将鼠标(或任何其他输入设备)连接到rpi。通过运行<code class="eh lp lq lr ls b">thd --dump /dev/input*</code>找出您点击/敲击的事件名称。这将列出与您的点击相关的事件。在我的例子中，按下鼠标右键是<code class="eh lp lq lr ls b">BTN_RIGHT 1</code>，按下按钮是<code class="eh lp lq lr ls b">BTN_RIGHT 0</code>。</p><p id="e8b9" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">创建关机脚本<br/> </strong>制作文件<code class="eh lp lq lr ls b">/etc/trigger.sh</code></p><pre class="lt lu lv lw fq lx ls ly lz aw ma dt"><span id="94e7" class="mb kg hu ls b fv mc md l me mf">#!/bin/bash</span><span id="7482" class="mb kg hu ls b fv mg md l me mf"># Announce to all terminals<br/>wall 'A mouse forced me to shut down'</span><span id="5faa" class="mb kg hu ls b fv mg md l me mf"># The actual shutdown command. sudo is used because shutdown    <br/># needs root previlages <br/>sudo /sbin/shutdown now</span></pre><p id="2e41" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">使脚本可执行</strong></p><pre class="lt lu lv lw fq lx ls ly lz aw ma dt"><span id="8e57" class="mb kg hu ls b fv mc md l me mf">sudo chmod +x /etc/trigger.sh </span></pre><p id="c369" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">创建<em class="ke"> triggerhappy </em>配置文件</strong> <br/>创建一个包含以下内容的文件<code class="eh lp lq lr ls b">/etc/triggerhappy/triggers.d/mouse-poweroff.conf</code>。(用第一步中的触发事件代码替换<code class="eh lp lq lr ls b">BTN_RIGHT</code>)</p><pre class="lt lu lv lw fq lx ls ly lz aw ma dt"><span id="758a" class="mb kg hu ls b fv mc md l me mf">BTN_RIGHT 1 /etc/trigger.sh</span></pre><p id="12c7" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">重启<em class="ke">触发</em>快乐</strong></p><pre class="lt lu lv lw fq lx ls ly lz aw ma dt"><span id="96c8" class="mb kg hu ls b fv mc md l me mf">sudo systemctl restart triggerhappy.service</span></pre><h1 id="9250" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">路障！</h1><p id="0a37" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">嗯，它不是应该已经开始工作了吗？没有。<br/>  triggerhappy，作为名为<code class="eh lp lq lr ls b">nobody</code>的用户执行我们的脚本。根据<a class="ae li" href="https://en.wikipedia.org/wiki/Nobody_(username)" rel="noopener ugc nofollow" target="_blank">维基百科</a>，</p><blockquote class="lj lk ll"><p id="30e8" class="jg jh ke ji b jj jk jl jm jn jo jp jq lm js jt ju ln jw jx jy lo ka kb kc kd hn dt translated">在许多Unix变体中，“<strong class="ji hv"> nobody </strong>”是一个用户帐户的常规名称，它不拥有任何文件，不属于任何特权组，并且除了其他用户拥有的能力之外，没有其他能力。有些系统还定义了一个等价的群“nogroup”。</p></blockquote><p id="4ece" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh lp lq lr ls b">shutdown</code>命令<a class="ae li" href="https://github.com/systemd/systemd/blob/master/src/core/shutdown.c" rel="noopener ugc nofollow" target="_blank">需要根预览</a>来实际关闭pi。<code class="eh lp lq lr ls b">nobody</code>实际上不能用超级用户权限执行任何命令。我们现在要绕过它。我们需要允许用户<code class="eh lp lq lr ls b">nobody</code>在不需要密码的情况下用<code class="eh lp lq lr ls b">sudo</code>执行<code class="eh lp lq lr ls b">shutdown</code>。</p><p id="12b4" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在，<code class="eh lp lq lr ls b">sudo visudo</code>会打开一个编辑器来编辑<code class="eh lp lq lr ls b">sudoers</code>文件。在末尾添加以下内容，保存并退出。</p><pre class="lt lu lv lw fq lx ls ly lz aw ma dt"><span id="a669" class="mb kg hu ls b fv mc md l me mf"># We add echo command for testing. Remove later<br/>nobody ALL =NOPASSWD: /bin/echo*,/sbin/shutdown*</span></pre><p id="0c98" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv"> <em class="ke">警告:</em> </strong> <em class="ke"> </em>这不是一种干净或安全的方式，因为我们正在授予<code class="eh lp lq lr ls b">nobody</code>关闭您的pi的权限。</p><p id="20a0" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">要查看它是否有效，请从您的当前用户处获取<code class="eh lp lq lr ls b">sudo su -s /bin/bash nobody</code>，并检查您是否可以将<code class="eh lp lq lr ls b">sudo echo 'hello world'</code>作为<code class="eh lp lq lr ls b">nobody</code>。</p><h1 id="0df9" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">我们结束了。</h1><p id="f249" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">将鼠标连接到rpi，右键单击并观察rpi关闭。</p><div class="lt lu lv lw fq ab cb"><figure class="mh iv mi mj mk ml mm paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mh iv mi mj mk ml mm paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mh iv mi mj mk ml mm paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="lj lk ll"><p id="f922" class="jg jh ke ji b jj jk jl jm jn jo jp jq lm js jt ju ln jw jx jy lo ka kb kc kd hn dt translated"><a class="ae li" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae li" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae li" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae li" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jg jh ke ji b jj jk jl jm jn jo jp jq lm js jt ju ln jw jx jy lo ka kb kc kd hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae li" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae li" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lt lu lv lw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mn"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>