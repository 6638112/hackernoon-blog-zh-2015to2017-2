<html>
<head>
<title>How to refresh the Android Tv BrowseFragment ?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何刷新安卓电视的BrowseFragment？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-refresh-the-android-tv-browsefragment-6e4d2d3c6690?source=collection_archive---------0-----------------------#2016-07-27">https://medium.com/hackernoon/how-to-refresh-the-android-tv-browsefragment-6e4d2d3c6690?source=collection_archive---------0-----------------------#2016-07-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="667e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我在工作中遇到了一个严重的问题: <a class="ae jp" href="https://developer.android.com/reference/android/support/v17/leanback/app/BrowseFragment.html" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">的BrowseFragment </strong> </a> <strong class="it hv">的行</strong>刷新项目时的<strong class="it hv">闪烁效果。</strong></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/490b4f8826476d555fc1bd09b73a636f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*OTWbNzyHGz9k2qie29ecOA.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">source: <a class="ae jp" href="https://developer.android.com/training/tv/playback/browse.html" rel="noopener ugc nofollow" target="_blank">https://developer.android.com/training/tv/playback/browse.html</a></figcaption></figure><h2 id="0763" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">介绍</h2><p id="f661" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">在说问题的解决方法之前，先介绍一下<a class="ae jp" href="https://developer.android.com/reference/android/support/v17/leanback/app/BrowseFragment.html" rel="noopener ugc nofollow" target="_blank"> BrowseFragment </a>。<a class="ae jp" href="https://developer.android.com/reference/android/support/v17/leanback/app/BrowseFragment.html" rel="noopener ugc nofollow" target="_blank"> BrowseFragment </a>是用于创建媒体目录的<a class="ae jp" href="https://hackernoon.com/tagged/fragment" rel="noopener ugc nofollow" target="_blank">片段</a>。在媒体目录中，我们可以从左侧浏览类别，并在右侧选择所选类别的内容。媒体目录由一个<a class="ae jp" href="https://www.google.it/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwim7NDS_I_OAhXK7hoKHdKTD-QQFggeMAA&amp;url=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fsupport%2Fv17%2Fleanback%2Fapp%2FRowsFragment.html&amp;usg=AFQjCNH3LwDzkprl2n8C962-df692UqAbw&amp;sig2=w0aZIg3OOiqP9Rwq7y8B0w" rel="noopener ugc nofollow" target="_blank"> RowsFragment </a>和一个<a class="ae jp" href="https://www.google.it/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwjPzunU_I_OAhVHDxoKHdnfC3cQFggeMAA&amp;url=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fsupport%2Fv17%2Fleanback%2Fapp%2FHeadersFragment.html&amp;usg=AFQjCNEkzUIM6J9eUBbE6bZW5KRWAXPpew&amp;sig2=xppB_b8XZQ56mI5GEqjTcw" rel="noopener ugc nofollow" target="_blank">header fragment</a>组成。一个<a class="ae jp" href="https://developer.android.com/reference/android/support/v17/leanback/app/BrowseFragment.html" rel="noopener ugc nofollow" target="_blank"> BrowseFragment </a>将它的<a class="ae jp" href="https://www.google.it/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwiU6-Te_I_OAhWMExoKHbi9CHsQFggeMAA&amp;url=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fsupport%2Fv17%2Fleanback%2Fwidget%2FObjectAdapter.html&amp;usg=AFQjCNEQlBvXY0HAKCHWZxCyBTu11gcMUA&amp;sig2=b1J7LwVD4KUpRvOyZaEdNw" rel="noopener ugc nofollow" target="_blank"> ObjectAdapter </a>的元素呈现为一个垂直列表中的一组行。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/7e8d8ccaf46972a897dda0d53dfe4177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*L7bcWUFf3vq9ExdFrQtN7w.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">media catalog</figcaption></figure><p id="24a7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，让我们假设我们希望通过后台任务每5秒钟刷新一次<a class="ae jp" href="https://developer.android.com/reference/android/support/v17/leanback/app/RowsFragment.html" rel="noopener ugc nofollow" target="_blank">行片段</a>的数据。<br/>我们怎样才能做到呢？</p><h2 id="524d" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">第一种解决方案:只需更新适配器</h2><p id="7541" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated"><a class="ae jp" href="https://developer.android.com/reference/android/support/v17/leanback/app/BrowseFragment.html" rel="noopener ugc nofollow" target="_blank"> BrowseFragment </a>使用<a class="ae jp" href="https://developer.android.com/reference/android/support/v17/leanback/widget/ArrayObjectAdapter.html" rel="noopener ugc nofollow" target="_blank"> ArrayObjectAdapter </a>来显示数据。我们只需要:<br/> 1。清除适配器的项目(<em class="lc">清除</em> ) <br/> 2。向适配器添加新项目(<em class="lc"> addAll </em> ) <br/> <br/> <strong class="it hv">问题:闪光效果</strong></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff ld"><img src="../Images/cc0c14cfa9403cf8fe4be9c2b5e9b3d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*3T_6uQzDOGZvGS_Yb2pPjw.gif"/></div></figure><p id="5c46" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每次有刷新，片段就闪烁。闪烁效果是由适配器通知UI对项目的每个操作引起的。我们可以看到clear()和addAll()方法有一个通知方法<a class="ae jp" href="https://developer.android.com/reference/android/support/v17/leanback/widget/ArrayObjectAdapter.html" rel="noopener ugc nofollow" target="_blank"> ArrayObjectAdapter </a>有一个通知方法:</p><pre class="jr js jt ju fq le lf lg lh aw li dt"><span id="a137" class="kc kd hu lf b fv lj lk l ll lm">public void clear() {<br/>    int itemCount = mItems.size();<br/>    if (itemCount == 0) {<br/>        return;<br/>    }<br/>    mItems.clear();  <br/>    <strong class="lf hv">notifyItemRangeRemoved(0, itemCount);</strong> //notifies UI<br/>}</span><span id="c8fe" class="kc kd hu lf b fv ln lk l ll lm">public void addAll(int index, Collection items) {<br/>    int itemsCount = items.size();<br/>    if (itemsCount == 0) {<br/>        return;<br/>    }<br/>    mItems.addAll(index, items);<br/>    <strong class="lf hv">notifyItemRangeInserted(index, itemsCount);</strong>//notifies UI<br/>}</span></pre><h2 id="8556" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">第二个解决方案:您自己的适配器:</h2><p id="1986" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">我们可以创建自己的适配器，并选择何时以及如何通知项目的更改。</p><p id="1372" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我用一个新的replaceAll()方法创建了一个定制的ObjectAdapter 。</p><pre class="jr js jt ju fq le lf lg lh aw li dt"><span id="064b" class="kc kd hu lf b fv lj lk l ll lm">public void replaceAll(Collection items){<br/>    int itemsCount = items.size();<br/>    if (itemsCount == 0){<br/>        return;<br/>    }<br/>   <strong class="lf hv"> mItems.clear();<br/>    mItems.addAll(index, items);<br/>    notifyItemRangeChanged(0, itemsCount);</strong><br/>}</span></pre><h2 id="d55f" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">给我看看代码</h2><p id="a2f1" class="pw-post-body-paragraph ir is hu it b iu kx iw ix iy ky ja jb jc kz je jf jg la ji jj jk lb jm jn jo hn dt translated">全班都在这里:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lo lp l"/></div></figure><h2 id="5e2c" class="kc kd hu bd ke kf kg kh ki kj kk kl km jc kn ko kp jg kq kr ks jk kt ku kv kw dt translated">参考资料:</h2><div class="lq lr fm fo ls lt"><a href="https://developer.android.com/training/tv/playback/browse.html" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hv fv z el ly eo ep lz er et ht dt translated">创建目录浏览器| Android开发人员</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">在电视上运行的媒体应用程序需要允许用户浏览其内容，做出选择，并开始播放…</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">developer.android.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh jw lt"/></div></div></a></div><p id="3deb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">n E X T→<a class="ae jp" rel="noopener" href="/@be.betr.codr/documenting-my-android-adventure-9352747910e6">T22】记录我的安卓冒险T24】</a></p><p id="8aa1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在你离开之前… 如果你喜欢这篇文章，你会喜欢订阅我的时事通讯。获取我的小抄:“<a class="ae jp" href="https://hackernoon.com/tagged/android" rel="noopener ugc nofollow" target="_blank"><em class="lc">Android</em></a><em class="lc">Studio键盘快捷键小抄”。</em></p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="mi lp l"/></div></figure></div></div>    
</body>
</html>