<html>
<head>
<title>Building a botnet on PyPi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在PyPi上构建僵尸网络</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/building-a-botnet-on-pypi-be1ad280b8d6?source=collection_archive---------4-----------------------#2017-05-19">https://medium.com/hackernoon/building-a-botnet-on-pypi-be1ad280b8d6?source=collection_archive---------4-----------------------#2017-05-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="1456" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">或者能够</em></p><h2 id="80d9" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">最新消息—2017年9月</h2><p id="b2d1" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">大约一周前，一些学生将这一概念应用于拼写错误(用与流行库相似的名称注册恶意包)的想法。通过让一所大学发布安全通知，他们产生了一些兴趣，并最终导致对pypi/warehouse进行一些更改来解决这些问题。</p><p id="0111" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我决定再看一下我的包的下载量，看看我的恶意化身会造成什么样的损害。</p><figure class="kr ks kt ku fq kv fe ff paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="fe ff kq"><img src="../Images/9e4fb80a3ffd242533cfbf84f655d85a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1kCe4wWgyUe_IteLMduReQ.png"/></div></div></figure><p id="e8d7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我托管的12个系统模块包中，通过pip，我平均每天获得1500次下载。今年到目前为止，总共下载了491，292次。我希望在我的包被删除之前达到50万次下载！</p><p id="ebd4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从软件包来看，下载率与5月份的数据非常吻合:</p><figure class="kr ks kt ku fq kv fe ff paragraph-image"><div class="fe ff lc"><img src="../Images/474845e12e116174efce24a4182f156c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*6765wLQ_oq5EjCyYNke_hQ.png"/></div></figure><p id="399c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有一个计划删除我的假包，现在已经增加了限制，以防止这种攻击，但它是有趣的，而它持续下去！</p><h2 id="3e31" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">介绍</h2><figure class="kr ks kt ku fq kv fe ff paragraph-image"><div class="fe ff ld"><img src="../Images/75caef90b02316e26d80cfa0d8704779.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*colp9WeRXX-3bwCY1zlUaQ.png"/></div></figure><p id="638d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在去年10月的伦敦python Dojo上，我们发现PyPi允许用内置模块名注册包。</p><p id="6028" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那又怎样？你可能会问。谁会安装系统软件包？故事大概是这样的:</p><ol class=""><li id="1bc0" class="lf lg hu it b iu iv iy iz jc lh jg li jk lj jo lk ll lm ln dt translated">一个没有经验的Python开发者/部署者意识到他们需要X功能</li><li id="34ec" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">通过搜索/询问，他们发现人们使用<code class="eh lt lu lv lw b">pip</code>来安装软件包</li><li id="723e" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">开发人员愉快地输入例如<code class="eh lt lu lv lw b">pip install sys</code></li><li id="8d10" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">Baddie已经注册了<code class="eh lt lu lv lw b">sys</code> pip模块，并且包含了一个恶意的有效载荷</li><li id="98c2" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">开发者现在被恶意包pwn了，但是python中的<code class="eh lt lu lv lw b">import sys</code>起作用了，导入了一个功能sys模块，所以没人注意到。</li></ol><p id="59bb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当我们发现这一点时，我对它作为攻击媒介的可能性非常感兴趣，所以做了几件事:</p><ol class=""><li id="6b34" class="lf lg hu it b iu iv iy iz jc lh jg li jk lj jo lk ll lm ln dt translated">向pypi上列出的pypi <a class="ae le" href="https://hackernoon.com/tagged/security" rel="noopener ugc nofollow" target="_blank">安全</a>联系人发送电子邮件</li><li id="0b36" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">主动注册所有我能想到的通用系统模块名，作为包</li><li id="794a" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">给他们每个人上传了一个空包，除了立即追溯之外，它什么也不做:</li></ol><pre class="kr ks kt ku fq lx lw ly lz aw ma dt"><span id="e41c" class="jq jr hu lw b fv mb mc l md me">raise RuntimeError("Package 'json' must not be downloaded from pypi")</span></pre><h2 id="d10a" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">为什么要上传东西？</h2><p id="67b1" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">完全有可能蹲在pypi包上而不上传任何文件。但是通过添加一个空的包，我可以从pypi下载统计中跟踪下载。</p><p id="dc27" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Pypi将他们的访问日志(sans识别信息)上传到<a class="ae le" href="https://cloud.google.com/bigquery/" rel="noopener ugc nofollow" target="_blank"> google big query </a>，这非常棒，让我们可以很好地了解每个包最终在多少个系统上。</p><h2 id="3fc1" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">这种攻击媒介的效果如何？</h2><figure class="kr ks kt ku fq kv fe ff paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="fe ff mf"><img src="../Images/5cb7f0bf9b9bdacf627c1c77f356eea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YFwz5yhpMV6JH9RAXSQVcg.png"/></div></div></figure><p id="517f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">大查询说，今年到目前为止(2017年5月19日)，我的虚拟包已经被下载了~244k次，幸运的是它们是良性的，否则就是40万台被感染的机器！</p><p id="ca0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一些下载将是人们使用定制的刮刀，其他的可能是自动构建作业，一遍又一遍地运行，但是我使用了一些策略来衡量这些数据的质量:</p><ol class=""><li id="bd21" class="lf lg hu it b iu iv iy iz jc lh jg li jk lj jo lk ll lm ln dt translated">pypi下载日志包括一个列<code class="eh lt lu lv lw b">installer.name</code>，这看起来相当于一个HTTP用户代理字符串，通过只选择installer.name为<code class="eh lt lu lv lw b">pip</code>的行，我们更有可能计算实际安装，而不是抓取器或其他机器人</li><li id="189a" class="lf lg hu it b iu lo iy lp jc lq jg lr jk ls jo lk ll lm ln dt translated">另一个专栏:<code class="eh lt lu lv lw b">system.release</code>跟踪非常高级的系统版本信息(例如<code class="eh lt lu lv lw b">4.1.13–18.26.amzn1.x86_64</code>)通过将此包括在计数中，我们可以看到许多不同类型的安装程序正在下载这些包，这表明不只是少数几个机器人在抓取网站。今年有31k个不同的系统版本下载了我的包，相比之下，整个pypi总共有33k个不同的版本</li></ol><p id="32c1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我使用的查询如下:</p><figure class="kr ks kt ku fq kv"><div class="bz el l di"><div class="mg mh l"/></div></figure><h2 id="d16f" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">现在怎么办？</h2><p id="e2eb" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">实际上，我从未收到过对我邮件的回复，所以过了一会儿，我在一月份的官方<a class="ae le" href="https://github.com/pypa/pypi-legacy/issues/585" rel="noopener ugc nofollow" target="_blank"> pypi github问题跟踪器</a>上提出了一个问题。这也没有得到答复。</p><p id="390e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我目前占用了所有看起来风险最大的系统包名称，并且是用良性包来这样做的，所以我现在看不到披露这些的风险。</p><div class="kr ks kt ku fq ab cb"><figure class="mi kv mj mk ml mm mn paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mi kv mj mk ml mm mn paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mi kv mj mk ml mm mn paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mo mp mq"><p id="f922" class="ir is jp it b iu iv iw ix iy iz ja jb mr jd je jf ms jh ji jj mt jl jm jn jo hn dt translated"><a class="ae le" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae le" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae le" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae le" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is jp it b iu iv iw ix iy iz ja jb mr jd je jf ms jh ji jj mt jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae le" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae le" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kr ks kt ku fq kv fe ff paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="fe ff mu"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="kr ks kt ku fq kv"><div class="bz el l di"><div class="mv mh l"/></div></figure></div></div>    
</body>
</html>