<html>
<head>
<title>[Node.js] set up Websocket + Express + HTML service in 3 step</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[Node.js]分三步设置Websocket + Express + HTML服务</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/nodejs-web-socket-example-tutorial-send-message-connect-express-set-up-easy-step-30347a2c5535?source=collection_archive---------2-----------------------#2017-10-31">https://medium.com/hackernoon/nodejs-web-socket-example-tutorial-send-message-connect-express-set-up-easy-step-30347a2c5535?source=collection_archive---------2-----------------------#2017-10-31</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/2b6c9408901ea279a16fac4d4dfa2da7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64WWkKs8zE6-f7qZGCFlkA.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">websocket nodejs serve rclient browser</figcaption></figure><p id="084b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">Web Sockets现在在你周围的使用可能比你想象的要多，大多数实时交互的东西很可能都是通过这些小宝石运行的。</p><p id="82b0" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">它们非常适合将数据从一台机器即时传输到一个或多个其他连接的客户端，用于即时聊天、协作草图环境等等。</p><h1 id="6e4d" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">步骤1:设置Express服务器</h1><p id="fc22" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">Express扮演HTTP服务器的角色，提供HTML文件和Websocket服务</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="85e9" class="lr kg hu ln b fv ls lt l lu lv">var express = require('express')</span><span id="e4d4" class="lr kg hu ln b fv lw lt l lu lv"><strong class="ln hv">var ws = require('./ws')</strong></span><span id="27e8" class="lr kg hu ln b fv lw lt l lu lv">var app = express()</span><span id="020b" class="lr kg hu ln b fv lw lt l lu lv">app.get('/', function (req, res) {<br/>   <strong class="ln hv">res.sendfile(__dirname + '/ws.html');</strong><br/>})</span><span id="dc97" class="lr kg hu ln b fv lw lt l lu lv">app.listen(3000, function () {<br/>   console.log('Example app listening on port 3000!')<br/>})</span></pre><h1 id="ca8b" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">步骤2:设置客户端HTML文件</h1><p id="6a92" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated"><code class="eh lx ly lz ln b">websocket client</code>是浏览器支持的对象。</p><p id="053b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">下面将介绍三个重要的功能:</p><ul class=""><li id="ae53" class="ma mb hu ji b jj jk jn jo jr mc jv md jz me kd mf mg mh mi dt translated"><code class="eh lx ly lz ln b">ws.onopen</code>:连接时发出</li><li id="60a9" class="ma mb hu ji b jj mj jn mk jr ml jv mm jz mn kd mf mg mh mi dt translated"><code class="eh lx ly lz ln b">ws.send</code>:向websocket服务器发送发送事件</li><li id="ae80" class="ma mb hu ji b jj mj jn mk jr ml jv mm jz mn kd mf mg mh mi dt translated"><code class="eh lx ly lz ln b">ws.onmessage</code>:接收消息时发出的事件</li></ul><p id="e668" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">(<a class="ae ke" href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications" rel="noopener ugc nofollow" target="_blank">阅读更多</a>)</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="6f77" class="lr kg hu ln b fv ls lt l lu lv">&lt;script&gt;<br/>    var ws = new WebSocket('ws://localhost:40510');</span><span id="02be" class="lr kg hu ln b fv lw lt l lu lv">    // event emmited when connected<br/>    ws.onopen = function () {<br/>        console.log('websocket is connected ...')</span><span id="1302" class="lr kg hu ln b fv lw lt l lu lv">        // sending a send event to websocket server<br/>        ws.send('connected')<br/>    }</span><span id="3de8" class="lr kg hu ln b fv lw lt l lu lv">    // event emmited when receiving message <br/>    ws.onmessage = function (ev) {<br/>        console.log(ev);<br/>    }<br/>&lt;/script&gt;</span></pre><h1 id="34e9" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">步骤3:设置Websocket服务</h1><p id="207f" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">服务器代码很简单，我想你会明白的</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="4068" class="lr kg hu ln b fv ls lt l lu lv">var WebSocketServer = require('ws').Server,<br/>  wss = new WebSocketServer({port: 40510})</span><span id="ea32" class="lr kg hu ln b fv lw lt l lu lv">wss.on('connection', function (ws) {<br/>  ws.on('message', function (message) {<br/>    console.log('received: %s', message)<br/>  })</span><span id="f433" class="lr kg hu ln b fv lw lt l lu lv">  setInterval(<br/>    () =&gt; ws.send(`${new Date()}`),<br/>    1000<br/>  )<br/>})</span></pre></div><div class="ab cl mo mp hc mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hn ho hp hq hr"><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mv"><img src="../Images/a3f0a82dd88b7432756f8ed74ed9f0e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ic9rXEcorSUhTfAo.png"/></div></div></figure><h1 id="c20f" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">成为一个懒惰的人</h1><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="f048" class="lr kg hu ln b fv ls lt l lu lv">$ git clone git@github.com:wahengchang/nodejs-websocket-example.git</span><span id="1dcd" class="lr kg hu ln b fv lw lt l lu lv">$ npm install</span><span id="8738" class="lr kg hu ln b fv lw lt l lu lv">$ npm start</span></pre><p id="96a6" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">打开浏览器</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="c5c8" class="lr kg hu ln b fv ls lt l lu lv"><a class="ae ke" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a></span></pre><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mv"><img src="../Images/a3f0a82dd88b7432756f8ed74ed9f0e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ic9rXEcorSUhTfAo.png"/></div></div></figure></div><div class="ab cl mo mp hc mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hn ho hp hq hr"><h1 id="a467" class="kf kg hu bd kh ki mw kk kl km mx ko kp kq my ks kt ku mz kw kx ky na la lb lc dt translated">卸载ws</h1><p id="4a19" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated"><code class="eh lx ly lz ln b">ws</code>是一个WebSocket客户端和服务器实现，快速，易用(【阅读更多】(<a class="ae ke" href="https://stackoverflow.com/questions/16392260/which-websocket-library-to-use-with-node-js" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/16392260/which-web socket-library-to-use-with-node-js</a>))。</p></div><div class="ab cl mo mp hc mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hn ho hp hq hr"><h1 id="5e7d" class="kf kg hu bd kh ki mw kk kl km mx ko kp kq my ks kt ku mz kw kx ky na la lb lc dt translated">参考</h1><ul class=""><li id="6f18" class="ma mb hu ji b jj ld jn le jr nb jv nc jz nd kd mf mg mh mi dt translated"><a class="ae ke" href="https://github.com/wahengchang/nodejs-websocket-example" rel="noopener ugc nofollow" target="_blank">https://github.com/wahengchang/nodejs-websocket-example</a></li><li id="cb47" class="ma mb hu ji b jj mj jn mk jr ml jv mm jz mn kd mf mg mh mi dt translated"><a class="ae ke" href="https://github.com/websockets/ws" rel="noopener ugc nofollow" target="_blank">https://github.com/websockets/ws</a></li><li id="5b2a" class="ma mb hu ji b jj mj jn mk jr ml jv mm jz mn kd mf mg mh mi dt translated"><a class="ae ke" href="https://websockets.github.io/ws/" rel="noopener ugc nofollow" target="_blank">https://websockets.github.io/ws/</a></li><li id="1855" class="ma mb hu ji b jj mj jn mk jr ml jv mm jz mn kd mf mg mh mi dt translated">【http://codular.com/node-web-sockets】</li></ul></div></div>    
</body>
</html>