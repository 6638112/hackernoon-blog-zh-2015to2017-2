<html>
<head>
<title>Concurrent JavaScript VI: Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">并发JavaScript VI:服务器</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/concurrent-javascript-vi-server-9bb626f7cae1?source=collection_archive---------0-----------------------#2016-06-25">https://medium.com/hackernoon/concurrent-javascript-vi-server-9bb626f7cae1?source=collection_archive---------0-----------------------#2016-06-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="a569" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">又到了每月的这个时候，我离开了一段时间，在我母亲的紧急心脏手术后在医院里追逐医生。我很感激她恢复得很好。她是我的生命之光，现在她安全了。我可以再做一次<a class="ae jp" href="https://hackernoon.com/tagged/nexus-js" rel="noopener ugc nofollow" target="_blank"> Nexus.js </a>了！</p><p id="e822" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你正在阅读这篇文章，但你不知道Nexus.js是什么，请阅读这里的介绍:</p><div class="jq jr fm fo js jt"><a rel="noopener follow" target="_blank" href="/@voodooattack/multi-threaded-javascript-introduction-faba95d3bd06"><div class="ju ab ej"><div class="jv ab jw cl cj jx"><h2 class="bd hv fv z el jy eo ep jz er et ht dt translated">并发JavaScript —简介</h2><div class="ka l"><h3 class="bd b fv z el jy eo ep jz er et ek translated">所以，我一直在做一个多线程的JavaScript运行时，Nexus.js。你可以把它想象成Node的疯狂表亲…</h3></div><div class="kb l"><p class="bd b gc z el jy eo ep jz er et ek translated">medium.com</p></div></div><div class="kc l"><div class="kd l ke kf kg kc kh ki jt"/></div></div></a></div><p id="a093" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">既然那已经不碍事了…</p><p id="5c4f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我刚刚在<a class="ae jp" href="https://github.com/voodooattack/nexusjs" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中获得了一个<a class="ae jp" href="https://github.com/voodooattack/nexusjs/commit/a81535706642f0f2695f0a275a6e5a458f6f8dcf" rel="noopener ugc nofollow" target="_blank">提交</a>，我对此非常满意。这个提交允许Nexus作为一个<a class="ae jp" href="https://hackernoon.com/tagged/tcp-server" rel="noopener ugc nofollow" target="_blank"> TCP服务器</a>工作，并且是一个非常高性能的服务器。</p><p id="a39d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们看看它是如何工作的。</p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="fe ff kj"><img src="../Images/bb1e89a3d96f0ca33173a4a0dd9159b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvOVXADPVLI_JblBQs6Szw.png"/></div></div></figure><p id="dc89" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，你有一个接受者。接受者的工作是绑定一个接口(或多个接口)并监听连接。当有新的连接时，它会创建一个TCPSocket并发出一个“连接”事件。</p><p id="8422" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">“连接”事件是您应该处理流量的地方，第二个参数包含端点信息(传入地址和端口)。</p><p id="db81" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">传递给回调的TCPSocket是一个双向I/O设备，就像任何其他I/O设备一样，您可以在它的基础上构造流来处理输入和输出以及操作数据。</p><p id="6d3c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以，让我们对它进行一点压力测试。1024个连接会消耗多少内存？</p><figure class="kk kl km kn fq ko"><div class="bz el l di"><div class="ku kv l"/></div></figure><p id="c96e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">18 MB支持1000个连接？很好。但话说回来，那些只是联系。客户端没有向服务器发送任何数据。</p><p id="a7eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以让我们用数据再试一次。这一次，每个客户端将发送一条消息，并保持线路畅通，直到它们都断开连接。</p><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="fe ff kw"><img src="../Images/953aa6c42d48793727b8d3d566b43b63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frxPPsaX-e7zhM9sq6KjNg.png"/></div></div></figure><p id="17b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">38.7 MB，现在让我们用node.js进行最后一次测试，代码如下:</p><figure class="kk kl km kn fq ko"><div class="bz el l di"><div class="kx kv l"/></div></figure><figure class="kk kl km kn fq ko fe ff paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="fe ff ky"><img src="../Images/434da167a19c95d96abba2ef973efe22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZGJAEMHlcpWBKOY_Cf-wMw.png"/></div></div></figure><p id="9dd2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Node.js是靠内存取胜的吧？</p><p id="de72" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">完全不是，如果你仔细观察连接，你会发现它们都是按顺序处理的，而nexus是并行处理所有内核来处理负载。现在，将内核数量乘以节点的内存使用量，以获得如果您尝试使用集群API扩展此用例时节点将消耗的实际内存(4 * 15 MB = 60 MB)，然后它将不会以最佳方式利用逻辑CPU。</p><p id="e2ff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这只是一个开始。我已经为HTTP-和HTTP 2-服务器API制定了计划。</p><h2 id="e35e" class="kz la hu bd lb lc ld le lf lg lh li lj jc lk ll lm jg ln lo lp jk lq lr ls lt dt translated">有问题吗？</h2><p id="8721" class="pw-post-body-paragraph ir is hu it b iu lu iw ix iy lv ja jb jc lw je jf jg lx ji jj jk ly jm jn jo hn dt translated">你有什么问题吗？我很乐意回答这些问题。在评论中把它们发送到这里，或者在Twitter上发送到<a class="ae jp" href="https://twitter.com/voodooattack" rel="noopener ugc nofollow" target="_blank">@ voodoo attack</a>，和往常一样:你可以在<a class="ae jp" href="https://github.com/voodooattack/nexusjs" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上查看该项目的代码。</p></div><div class="ab cl lz ma hc mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hn ho hp hq hr"><div class="kk kl km kn fq jt"><a rel="noopener follow" target="_blank" href="/@voodooattack/concurrent-javascript-a-years-absence-ea5ae93d3b91"><div class="ju ab ej"><div class="jv ab jw cl cj jx"><h2 class="bd hv fv z el jy eo ep jz er et ht dt translated">并发JavaScript——缺席一年</h2><div class="ka l"><h3 class="bd b fv z el jy eo ep jz er et ek translated">如果你不知道Nexus.js是什么，请从这里开始阅读:</h3></div><div class="kb l"><p class="bd b gc z el jy eo ep jz er et ek translated">medium.com</p></div></div><div class="kc l"><div class="mg l ke kf kg kc kh ki jt"/></div></div></a></div><div class="kk kl km kn fq ab cb"><figure class="mh ko mi mj mk ml mm paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mh ko mi mj mk ml mm paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mh ko mi mj mk ml mm paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mn mo mp"><p id="f922" class="ir is mq it b iu iv iw ix iy iz ja jb mr jd je jf ms jh ji jj mt jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is mq it b iu iv iw ix iy iz ja jb mr jd je jf ms jh ji jj mt jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kk kl km kn fq ko fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff mu"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure><figure class="kk kl km kn fq ko"><div class="bz el l di"><div class="mv kv l"/></div></figure></div></div>    
</body>
</html>