<html>
<head>
<title>Mind the 75GB limit on AWS Lambda deployment packages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">注意AWS Lambda部署包的75GB限制</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/mind-the-75gb-limit-on-aws-lambda-deployment-packages-163b93c8eb72?source=collection_archive---------5-----------------------#2017-09-20">https://medium.com/hackernoon/mind-the-75gb-limit-on-aws-lambda-deployment-packages-163b93c8eb72?source=collection_archive---------5-----------------------#2017-09-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="25c8" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">Lambda为您的所有部署包设置了75GB的区域限制，虽然这乍听起来可能很多，但当部署没有摩擦并且您一天要部署多次时，这实际上很容易达到。</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/8f69d5a52bfab1600f074d2198151370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h6dJ3WFL16CgEUCcg_22SQ.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Gotta clean up those old Lambda deployment packages!</figcaption></figure><p id="17ee" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt kv translated">有了<span class="l kw kx ky bm kz la lb lc ld di"> W </span>和<em class="le"> AWS Lambda </em>和<em class="le">无服务器</em>框架，部署你的代码变得如此简单和顺畅。</p><p id="075f" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">随着越来越多的架构转移到Lambda上运行，您可能会发现，除了更快地完成工作，您还会更频繁地部署代码。</p><p id="3de0" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">太棒了。</p><p id="7135" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">但是，当您为这一新发现的让您的用户和利益相关者满意的超级能力而欣喜时，您需要注意所有上传的部署包的75GB的区域限制。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff lf"><img src="../Images/dd63cecfc4c65022652158396771210f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KYnLggi6nsNsf2gHZ-0GNw.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek"><a class="ae lg" href="http://docs.aws.amazon.com/lambda/latest/dg/limits.html" rel="noopener ugc nofollow" target="_blank">http://docs.aws.amazon.com/lambda/latest/dg/limits.html</a></figcaption></figure><p id="1a4f" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">在Yubl，我和一个由6名服务器工程师组成的小组设法在3个月内完成了近20GB的部署包。</p><div class="lh li fm fo lj lk"><a href="https://hackernoon.com/yubls-road-to-serverless-part-1-overview-ca348370acde" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab ej"><div class="lm ab ln cl cj lo"><h2 class="bd hv fv z el lp eo ep lq er et ht dt translated">Yubl的无服务器之路—第1部分，概述</h2><div class="lr l"><h3 class="bd b fv z el lp eo ep lq er et ek translated">这条路到此为止</h3></div><div class="ls l"><p class="bd b gc z el lp eo ep lq er et ek translated">hackernoon.com</p></div></div><div class="lt l"><div class="lu l lv lw lx lt ly jt lk"/></div></div></a></div><p id="f86f" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">我们用Nodejs编写了所有的Lambda函数，部署包通常小于2MB。但是部署的频率确保了部署包的整体规模稳步增长。</p><p id="9f5b" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">现在我用Scala编写了大部分Lambda函数(Scala是<a class="ae lg" href="http://spaceapegames.com/" rel="noopener ugc nofollow" target="_blank"> Space Ape Games </a>服务器团队的首选武器)，我要处理的部署包要大得多！</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff lz"><img src="../Images/c2644bce806c3efd9f8c1e319b33e4ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UTBSvd2o4k97skYuMANfgQ.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">When authoring Lambda functions in Java, be prepared to significantly bigger deployment packages.</figcaption></figure><h1 id="0a1b" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">无服务器框架:禁用版本功能</h1><p id="9304" class="pw-post-body-paragraph jz ka hu kb b kc ms iv ke kf mt iy kh ki mu kk kl km mv ko kp kq mw ks kt ku hn dt translated">默认情况下，<em class="le">无服务器</em>框架会在每次部署时创建一个新版本的函数。</p><p id="1ff2" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">在<em class="le">无服务器</em> 0。x，这是需要的，因为它使用了函数别名。例如，对于同一个功能，我可以有多个部署阶段— <code class="eh mx my mz na b">dev</code>、<code class="eh mx my mz na b">staging</code>和<code class="eh mx my mz na b">production</code>。但是在Lambda控制台中只有一个函数，每个阶段只是指向同一函数的不同版本的别名。</p><p id="94d7" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">不幸的是，这种行为也使得管理IAM权限变得困难，因为同一个函数的多个版本共享同一个IAM角色。由于您不能使用函数对IAM角色进行版本控制，这使得您很难在不破坏旧版本的情况下添加或删除权限。</p><p id="a9dc" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">幸运的是，开发人员听取了社区和<strong class="kb hv">的意见，因为1.0版本的每个阶段都被部署为一个独立的功能</strong>。</p><p id="5d74" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">本质上，这允许您用部署阶段“版本化”IAM角色，因为每个阶段都有一个单独的IAM角色。因此，从技术上讲，您不再需要为每个部署创建新版本。但是，这仍然是默认行为，除非您通过将<code class="eh mx my mz na b">versionFunctions</code>设置为<code class="eh mx my mz na b">false</code>在<code class="eh mx my mz na b">serverless.yml</code>中明确禁用它。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nb"><img src="../Images/2707dfed0f6157869bb025d5b357a1d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tzdOgA1b7lzSiWFlM9eeMQ.png"/></div></div></figure><p id="916c" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">您可能会争辩说，在产品中使用旧版本的函数可以更快地回滚。</p><p id="cc0f" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">在这种情况下，请仅在生产阶段启用它。要做到这一点，这里有一个方便的技巧，允许您的<code class="eh mx my mz na b">serverless.yml</code>中的默认配置被部署阶段覆盖。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nc"><img src="../Images/3b0c77b96834e3b00e63e8cc47ce994a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c2NLnegnZuxumpJhdokBoA.png"/></div></div></figure><p id="cbde" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">然而，以我个人的经验，除非你非常小心并使用别名来标记生产版本，否则实际上很难知道哪个版本与什么相关。假设你有可复制的构建，如果我们从代码的<code class="eh mx my mz na b">hotfix</code>或<code class="eh mx my mz na b">support</code>分支进行部署，我会更有信心。</p><h1 id="39bb" class="ma mb hu bd mc md me mf mg mh mi mj mk ja ml jb mm jd mn je mo jg mp jh mq mr dt translated">用看门人-lambda清理旧版本</h1><p id="b45d" class="pw-post-body-paragraph jz ka hu kb b kc ms iv ke kf mt iy kh ki mu kk kl km mv ko kp kq mw ks kt ku hn dt translated">如果对所有项目禁用<code class="eh mx my mz na b">serverless.yml</code>中的<code class="eh mx my mz na b">versionFunctions</code>很难实施，另一种方法是追溯删除不再被别名引用的旧版本函数。</p><p id="a3e1" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">为此，您可以创建一个cron作业(即预定的CloudWatch event + Lambda)，它将扫描您的函数，查找未被引用的版本并删除它们。</p><p id="0bb0" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">我从网飞的<a class="ae lg" rel="noopener" href="/netflix-techblog/janitor-monkey-keeping-the-cloud-tidy-and-clean-d517ad74d648">看门猴</a>中获得了一些灵感，并创建了一个<a class="ae lg" href="https://github.com/theburningmonk/janitor-lambda" rel="noopener ugc nofollow" target="_blank">看门猴λ</a>函数，您可以将其部署到您的AWS环境中，以清理您的函数的未使用版本。</p><p id="ea6a" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">在我们使用了这个<em class="le">看门人Lambda </em>函数之后，我们的总部署包从20GB变成了1GB(我们有很多函数…)。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/8f69d5a52bfab1600f074d2198151370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h6dJ3WFL16CgEUCcg_22SQ.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Gotta clean up those old Lambda deployment packages!</figcaption></figure><div class="lh li fm fo lj lk"><a href="https://github.com/theburningmonk/janitor-lambda" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab ej"><div class="lm ab ln cl cj lo"><h2 class="bd hv fv z el lp eo ep lq er et ht dt translated">燃烧的蒙克/看门人-拉姆达</h2><div class="lr l"><h3 class="bd b fv z el lp eo ep lq er et ek translated">清理lambda函数的旧的、未被引用的版本</h3></div><div class="ls l"><p class="bd b gc z el lp eo ep lq er et ek translated">github.com</p></div></div><div class="lt l"><div class="nd l lv lw lx lt ly jt lk"/></div></div></a></div></div><div class="ab cl ne nf hc ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="hn ho hp hq hr"><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="ab fr cl nl"><img src="../Images/8b4e4721bb1973db389b5b533d727ad1.png" data-original-src="https://miro.medium.com/v2/format:webp/0*b_1R345KzKSaI8sg.png"/></div></figure><p id="f870" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">嗨，我的名字是<strong class="kb hv">崔琰</strong>。我是一个<a class="ae lg" href="https://aws.amazon.com/developer/community/heroes/yan-cui/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb hv"> AWS无服务器英雄</strong> </a>和<a class="ae lg" href="https://bit.ly/production-ready-serverless" rel="noopener ugc nofollow" target="_blank"> <strong class="kb hv">量产无服务器</strong> </a>的作者。我已经在AWS中运行了近10年的大规模生产工作负载，我是一名架构师或首席工程师，涉足从银行、电子商务、体育流媒体到移动游戏等多个行业。我目前是一名专注于AWS和无服务器的独立顾问。</p><p id="c37e" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">你可以通过<a class="ae lg" href="mailto:theburningmonk.com" rel="noopener ugc nofollow" target="_blank">邮箱</a>、<a class="ae lg" href="https://twitter.com/theburningmonk" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae lg" href="https://www.linkedin.com/in/theburningmonk/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。</p></div><div class="ab cl ne nf hc ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="hn ho hp hq hr"><p id="404d" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">查看我的新课程，<a class="ae lg" href="https://theburningmonk.thinkific.com/courses/complete-guide-to-aws-step-functions" rel="noopener ugc nofollow" target="_blank"><strong class="kb hv">AWS步骤功能完整指南</strong> </a>。</p><p id="a329" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">在本课程中，我们将介绍有效使用AWS Step Functions服务所需了解的一切。包括基本概念、HTTP和事件触发器、活动、设计模式和最佳实践。</p><p id="cd40" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">在这里拿到你的副本。</p></div><div class="ab cl ne nf hc ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="hn ho hp hq hr"><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nm"><img src="../Images/2faf40b47320300fed81b3e09483ffb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZYcHhOOzUf5VB-Ri.png"/></div></div></figure><p id="ee8c" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">来了解AWS Lambda: CI/CD的操作性<strong class="kb hv">最佳实践</strong>，本地测试&amp;调试功能、日志记录、监控、分布式跟踪、canary部署、配置管理、认证&amp;授权、VPC、安全性、错误处理等等。</p><p id="8bb5" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">还可以用代码<strong class="kb hv"> ytcui </strong>获得<strong class="kb hv">票面价格6折</strong>。</p><p id="2e68" class="pw-post-body-paragraph jz ka hu kb b kc kd iv ke kf kg iy kh ki kj kk kl km kn ko kp kq kr ks kt ku hn dt translated">点击获取您的副本<a class="ae lg" href="https://bit.ly/production-ready-serverless" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>