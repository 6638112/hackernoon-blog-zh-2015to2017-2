# Rails 网络规模是昂贵的

> 原文：<https://medium.com/hackernoon/rails-web-scale-is-expensive-b86facc11381>

上周 [**@** nateberkopec](https://twitter.com/nateberkopec) 写了[“Ruby 对于网络规模来说是不是太慢了？”](https://www.speedshop.co/2017/07/11/is-ruby-too-slow-for-web-scale.html)讨论了关于 [Rails](https://hackernoon.com/tagged/rails) 太慢而不适合网络规模的谣言。你猜怎么着！？它不是。Nate 详细解释了原因，整个 Rails-Bubble Twitter 圈子也跟了过来。我同意一般的假设，但在我看来，它缺少几个非常重要的点(例如，你必须支付的价格。字面意思！).我想用这篇文章来澄清一些迷雾，让整个 Rails 生态系统来反对我。；-)

> 内特写他的帖子是为了获得更多的可见性，这转化为更多的咨询合同。我也是。我们都以挑战 Rails 应用程序的速度极限为生。这种对抗不是针对个人的，而只是指出一些缺陷，认识到这些缺陷是很重要的。我很乐意请他或我在这篇文章或任何后续推文中提到的任何人喝一杯！

![](img/91eb01878be59f0c28c27be18ebc774d.png)

Heroku is so easy to use in the beginning. And at some point in the future the invoices become bigger and bigger.

# 100 毫秒的谎言

Nate 曾说过，用户不会感觉到 Rails web 服务器的 1 毫秒(快)和 100 毫秒(慢)响应之间的差别(这意味着 Rails 在服务器上呈现 HTML 所花费的时间，而 HTML 仍然需要被传送到客户端)。他甚至用雅各布·尼尔森的一项研究来证明他的观点。内特的论点是错误的，具有误导性。它没有解释典型的网络性能问题，更重要的是:他误读了 Jakob Nielsen 的工作。尼尔森的研究称，100 毫秒以下的一切都被感觉为*“瞬间反应”*。*“1.0 秒大约是用户思想流动保持不中断的极限”*。因此，web 性能的黄金标准是 1 秒以下的一切。访问谷歌。在美国的任何地方，它都会在不到 1 秒的时间内被点燃。这也是它如此受欢迎的原因之一。如果谷歌花了 5 秒钟才加载，你就不会用它了。

因此，如果你想参加 WebPerformance premium 联赛，100 毫秒和 1 毫秒之间有很大的差别。公司雇佣像我和内特这样的人就是因为这种差异！

在 WebPerformance 的上下文中，将永远需要向您介绍 100 毫秒延迟的含义。如果你真的想了解它们，我强烈推荐你阅读网络性能之神[伊利亚·格里戈利克](https://www.igvita.com)的[高性能浏览器网络](https://hpbn.co)。

但是，如果给定页面的网页性能很差(意思是所有的东西都在 2-3 秒以上)，那么 Nate 的观点就变得更加有效了。一旦你达到了 5 秒的门槛，那就没关系了。

底线:如果你想要一个真正快速的网页，一切都很重要，服务器上的 100 毫秒非常重要。

# Rails 并不慢。周围的一切都是。说真的！？

内特写道

*   *“通常，花在与这些数据库交互上的时间会占一个响应的 25%或更多。”*
*   web 应用程序在框架本身上花费了最多 50%的执行时间，在实际的应用程序代码和其他附加的依赖上花费了更多的时间。

首先:我不同意那些数字。根据我作为 Ruby on Rails 顾问的经验，与数据库的交互是所有问题中最小的。当然，偶尔会有一家公司忘记设置索引或做一些非常疯狂的连接，这需要花费很长时间，但在十之八九的情况下，SQL 数据库不是最大的瓶颈。

> 不要误解我:每一毫秒都很重要，总有改进的空间。

我的观点是:**人不在乎时间浪费在哪里。他们使用 Rails 作为一站式商店，使用 Rails 生态系统中的所有东西。他们使用它是因为它很容易使用。他们不想分析哪种数据存储解决方案可能会成为瓶颈。**

这些年来，Rails 变得非常容易使用，它确实有一个很好的生态系统，但它在性能方面失败了。人们不会考虑宝石的成本。他们只是包含它并启动捆绑包。

# 每月节省 1，000 美元

在某一点上，Nate 谈到了将一个缓慢的 Rails 应用程序重写为一个快速的(如 Phoenix)应用程序的好处不够大。他说:*“那么，恭喜你:你重写了你的应用程序(或者选择了你的框架)以节省每月 3000 美元。”*

他错在这里:

*   对于大多数公司来说，每月减少 3000 美元是一笔很大的交易。
*   他用平均值来做所有的计算。但对大多数公司来说，平均成本并不是最大的成本因素。峰值是问题所在。他们购买或租赁大型和多台服务器，因为他们希望能够应对高峰，因为那是他们销售最多的时候。所以仅仅用平均值是一种非常误导人的论证方式。

风投资助的公司烧钱就像没有明天一样，这是个例外。我们大多数人和我的大多数客户都必须尽可能地省钱。

对于许多低成本或免费的服务，这成为一个更大的问题。请看一下 [https://www.vutuv.de](https://www.vutuv.de) 这是一个商业网络(想想 LinkedIn 但是免费、安全、开源)。Vutuv 最初是作为 Ruby on Rails 应用程序编写的。但是由于 web 性能和预算的原因，它被重写为 Phoenix/Elixir 应用程序。

# 统计数字

当我咆哮的时候，让我们把 [DHH](https://medium.com/u/54bcbf647830?source=post_page-----b86facc11381--------------------------------) 也加入到这个讨论中来。他在讨论中添加了这条推文:

有趣的数字。但是我想问大家:这些数字是什么意思？没有他们的服务器基础设施和他们的代码库的知识什么都没有。37signals 为他们的服务器烧了多少钱？

顺便说一句:我对 180 毫秒的第 90 百分位印象不深。这些峰值是大多数头痛的原因。

# 那么 Rails 速度慢因此不好吗？

在我看来，Ruby on Rails 相对较慢。与目前许多 Rails 开发者的新救星 [Phoenix Framework](http://www.phoenixframework.org) 相比，它慢了 10 倍。这重要吗？很糟糕吗？大多数时候不是。

知道像 Phoenix Framework 这样的替代方案更快，就像知道汇编程序比 Rust 或 c 更快一样重要。只有在速度和代码量非常重要的时候才使用它。

所以 Rails 在大多数情况下更慢也更贵(就服务器而言),但这并不意味着它是个坏选择。我的观点是让每个人都意识到这一点。我见过许多公司因为高额的 Heroku 账单而陷入困境。

不要仅仅因为 [Shopify](https://www.shopify.com) 和 [Basecamp](https://basecamp.com) 使用 Rails。用它是因为你喜欢这个框架。因为你觉得那是给你最好的发展环境。当你明白它对你预算的影响时，就使用它。请花时间阅读[“Phoenix 更好但 Rails 更受欢迎”](https://hackernoon.com/phoenix-is-better-but-rails-is-more-popular-8975d5e68879)。

如果您遇到任何性能问题，或者需要 Ruby on Rails 或 Phoenix 咨询/培训，请通过电子邮件(sw@wintermeyer-consulting.de)或 Twitter 上的 DM(@ winter Meyer)与我联系。