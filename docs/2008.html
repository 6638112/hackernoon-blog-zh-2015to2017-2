<html>
<head>
<title>Animating particles using React Motion</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用反应运动制作粒子动画</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/animating-particles-using-react-motion-dcded1895f17?source=collection_archive---------4-----------------------#2017-01-01">https://medium.com/hackernoon/animating-particles-using-react-motion-dcded1895f17?source=collection_archive---------4-----------------------#2017-01-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="2be4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在做一个个人开源项目<a class="ae jp" href="https://github.com/saada/container-hive" rel="noopener ugc nofollow" target="_blank">容器配置单元</a>时，我面临了不少挑战，要让粒子在每个Docker容器之间正确动画。Container Hive试图帮助您可视化您的服务之间的一切是如何组合在一起的。这是它目前的样子…</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/3dd1a1918b9c3ebec8e2930c70b0638a.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/1*uOFUNQErzDaCDSYzYELaIQ.gif"/></div></figure><p id="1b50" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每个粒子是一个SVG圆，看起来像…</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="5b9c" class="kd ke hu jz b fv kf kg l kh ki">&lt;svg width='8' height='8'&gt;<br/>  &lt;circle cx='4' cy='4' r='4' fill='darkcyan' /&gt;<br/>&lt;/svg&gt;</span></pre><p id="71e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">既然我用的是<a class="ae jp" href="https://hackernoon.com/tagged/react" rel="noopener ugc nofollow" target="_blank"> React </a>，我自然倾向于尝试<a class="ae jp" href="https://github.com/chenglou/react-motion" rel="noopener ugc nofollow" target="_blank"> React Motion </a>。</p><h2 id="e66d" class="kd ke hu bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb dt translated"><strong class="ak">挑战I —在DevTools崩溃时调试漏洞</strong></h2><p id="62bc" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">当你刷新页面的时候，过了一段时间，你会看到…</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/9093fcb6957f2f8451bd5ba69f7513ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*ZeRC5rJdiYNpaUldQTwHBg.png"/></div></figure><p id="07c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这确实令人沮丧，因为不仅tab崩溃了，DevTools窗口本身也崩溃了。我尝试了许多方法来分析我的脚本，最终得出了一个有趣的方法。我打开控制台，时机成熟的时候，我键入<strong class="it hv"> <em class="li">调试器</em> </strong>然后嘣！我暂停了一切。所有的动画停止，反应生命周期，反应运动，一切！我还确保在DevTools中打开了<strong class="it hv">时间轴</strong>标签，以便在页面刷新时开始记录性能。我能够查看我的脚本的所有度量和调试性能，以及任何CPU/内存泄漏。</p><h2 id="ce11" class="kd ke hu bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb dt translated"><strong class="ak">挑战二——transition motion的默认样式不起作用(bug) </strong></h2><p id="e8f7" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">使用<em class="li"> TransitionMotion </em>非常适合处理多个动画元素，并控制每个组件的安装和卸载。但我无法使用react-motion@0.4.7让它工作。我最初的做法是使用<em class="li">默认样式</em>作为每个粒子的初始位置，然后从<em class="li">默认样式</em>开始设置<em class="li">样式</em>作为最终的过渡样式。</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="3788" class="kd ke hu jz b fv kf kg l kh ki">&lt;TransitionMotion<br/>  defaultStyles={particles.map(particle =&gt; ({<br/>    key: particle.key,<br/>    style: {<br/>      translateX: particle.x1,<br/>      translateY: particle.y1,<br/>      opacity: 0<br/>    }<br/>  }))}<br/>  styles={particles.map(particle =&gt; ({<br/>    key: particle.key,<br/>    style: {<br/>      translateX: spring(particle.x2, particleSpring),<br/>      translateY: spring(particle.y2, particleSpring),<br/>      opacity: spring(1, particleSpring)<br/>    }<br/>  }))}&gt;<br/>  {interpolatedStyles =&gt;<br/>    &lt;div&gt;<br/>      {interpolatedStyles.map(({key, style: {opacity, translateX, translateY}}) =&gt; {<br/>        return &lt;svg key={key} width='8' height='8' style={{<br/>          transform: `translate3d(${translateX}px, ${translateY}px, 0) scale(1)`,<br/>          marginTop: `${(50 / 2) - borderWidth / 2}px`,<br/>          marginLeft: `${(50 / 2) - borderWidth / 2}px`,<br/>          opacity: opacity,<br/>          position: 'absolute',<br/>          zIndex: 1000<br/>        }}&gt;<br/>          &lt;circle cx='4' cy='4' r='4' fill='yellow' /&gt;<br/>        &lt;/svg&gt;<br/>      })}<br/>    &lt;/div&gt;<br/>  }<br/>&lt;/TransitionMotion&gt;</span></pre><p id="cefe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所发生的是粒子会停留在最终位置，根本不会经历动画阶段。几乎就像<em class="li"> defaultStyles </em>并没有真正做什么。</p><p id="04f8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">解决方案:</strong>经过三天各种方案的尝试，奏效的是使用<em class="li"> willLeave </em>道具，通过在其回调中返回最终状态来执行所有动画。实际上，忽略了<em class="li">默认样式</em>属性。下面是工作片段。</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="2e49" class="kd ke hu jz b fv kf kg l kh ki">&lt;TransitionMotion<br/>  willLeave={particle =&gt; {<br/>    return {<br/>      translateX: spring(particle.data.x2, particleSpring),<br/>      translateY: spring(particle.data.y2, particleSpring),<br/>      opacity: spring(1, particleSpring)<br/>    }<br/>  }}</span><span id="2909" class="kd ke hu jz b fv lj kg l kh ki">styles={particles.map(particle =&gt; ({<br/>    key: particle.key,<br/>    data: particle,<br/>    style: {<br/>      translateX: particle.x1,<br/>      translateY: particle.y1,<br/>      opacity: 0.5<br/>    }<br/>  }))}&gt;<br/>  {interpolatedStyles =&gt;<br/>    &lt;div&gt;<br/>      {interpolatedStyles.map(({key, style: {translateX, translateY, opacity}}, index) =&gt; {<br/>        return &lt;svg key={key} width='8' height='8' style={{<br/>          transform: `translate3d(${translateX}px, ${translateY}px, 0) scale(1)`,<br/>          marginTop: `${(50 / 2) - borderWidth / 2}px`,<br/>          marginLeft: `${(50 / 2) - borderWidth / 2}px`,<br/>          opacity: opacity,<br/>          position: 'absolute',<br/>          zIndex: 1000<br/>        }}&gt;<br/>          &lt;circle cx='4' cy='4' r='4' fill={allColors[index % allColors.length]} /&gt;<br/>        &lt;/svg&gt;<br/>      })}<br/>    &lt;/div&gt;<br/>  }<br/>&lt;/TransitionMotion&gt;</span></pre><p id="0e63" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过完全去掉<em class="li">默认样式</em>并将<em class="li">样式</em>作为动画的初始状态，一切都完美地工作了。我在下面的Github上提出了这个问题。</p><div class="lk ll fm fo lm ln"><a href="https://github.com/chenglou/react-motion/issues/416" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab ej"><div class="lp ab lq cl cj lr"><h2 class="bd hv fv z el ls eo ep lt er et ht dt translated">过渡运动默认样式不反映动画问题#416成楼的初始状态…</h2><div class="lu l"><h3 class="bd b fv z el ls eo ep lt er et ek translated">react-motion -解决动画问题的弹簧。</h3></div><div class="lv l"><p class="bd b gc z el ls eo ep lt er et ek translated">github.com</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb jw ln"/></div></div></a></div><p id="76cb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">结论</strong></p><p id="f41d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">React Motion非常棒，为动画提供了非常强大的工具，但它仍然有一些问题和文档需要解决。如果你在堆栈中使用Docker，试试<a class="ae jp" href="https://github.com/saada/container-hive" rel="noopener ugc nofollow" target="_blank">容器Hive </a>。这是一个有趣有趣的景象，让你对微服务网络有了直觉。</p><div class="jr js jt ju fq ab cb"><figure class="mc jv md me mf mg mh paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mc jv md me mf mg mh paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mc jv md me mf mg mh paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mi mj mk"><p id="f922" class="ir is li it b iu iv iw ix iy iz ja jb ml jd je jf mm jh ji jj mn jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is li it b iu iv iw ix iy iz ja jb ml jd je jf mm jh ji jj mn jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="fe ff mo"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="mt mu l"/></div></figure></div></div>    
</body>
</html>