<html>
<head>
<title>Are Futures in Dart threads?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">期货是飞镖线吗？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/are-futures-in-dart-threads-2cdc5bd8063a?source=collection_archive---------4-----------------------#2017-04-26">https://medium.com/hackernoon/are-futures-in-dart-threads-2cdc5bd8063a?source=collection_archive---------4-----------------------#2017-04-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="967e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">嗯，<em class="jp">没有</em>。Dart有一个执行的<a class="ae jq" href="https://webdev.dartlang.org/articles/performance/event-loop" rel="noopener ugc nofollow" target="_blank">单线程，或事件循环</a>。然而，通常你会看到使用<em class="jp"> Future </em>的代码有一个注释，大意是<em class="jp">“//避免竞争条件:检查…</em>。那是什么意思？</p><blockquote class="jr js jt"><p id="6a19" class="ir is jp it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated"><strong class="it hv">期货新手？</strong>阅读Dart网站上的<a class="ae jq" href="https://www.dartlang.org/tutorials/language/futures" rel="noopener ugc nofollow" target="_blank">异步编程:未来</a>。</p></blockquote><p id="c9d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然<em class="jp"> Dart </em>只有一个执行线程，但它可以与运行在单独线程中的其他代码(Dart或其他代码，如服务器端代码)进行交互。<em class="jp">未来&lt; T &gt; </em>作为API的意思简单来说就是“<em class="jp">在一个</em> <a class="ae jq" href="https://hackernoon.com/tagged/future" rel="noopener ugc nofollow" target="_blank"> <em class="jp">未来</em> </a> <em class="jp">时间点</em>获取一个值，T”。那次？它可能在微任务循环的末尾，可能在一秒钟之后，可能在从磁盘读取文件之后，可能在RPC完成之后。也可能永远不会(例如，由于超时)。</p><blockquote class="jr js jt"><p id="11e0" class="ir is jp it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">你可以在GitHub上查看这篇博文中的所有例子。</p></blockquote><p id="a66d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们来介绍一个简单的例子:</p><figure class="jx jy jz ka fq kb"><div class="bz el l di"><div class="kc kd l"/></div></figure><p id="c08a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们打印字符串“1”、“2”、“3”和“4”——看似按顺序，但实际上它将打印“1”、“4”、“2”和“3”。那是因为“1”是同步<em class="jp">打印</em>的，而“2”是打印在<em class="jp">微任务循环</em>的末端，“3”是打印一个未来<em class="jp">事件循环。</em></p><p id="a793" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您还可以使用<em class="jp">完成器</em> API来改编非<em class="jp">未来</em> API:</p><figure class="jx jy jz ka fq kb"><div class="bz el l di"><div class="kc kd l"/></div></figure></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><h1 id="016f" class="kl km hu bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">但是，<a class="ae jq" href="https://api.dartlang.org/stable/1.23.0/dart-isolate/dart-isolate-library.html" rel="noopener ugc nofollow" target="_blank">隔离</a>呢？</h1><p id="d846" class="pw-post-body-paragraph ir is hu it b iu lj iw ix iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo hn dt translated">Dart能够产生独立的进程，称为<em class="jp">隔离</em>(dart 2 js中的web workers)，它们在主程序运行时不共享内存，但是能够异步运行，在另一个进程(实际上是一个线程)中能够在不阻塞主线程的情况下进行计算。</p><p id="0d5a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在下面的例子中，我们计算斐波那契数列两次——一次在同一线程中同步进行，一次在另一个线程中异步进行。</p><figure class="jx jy jz ka fq kb"><div class="bz el l di"><div class="kc kd l"/></div></figure><p id="101e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这个例子中，仍然使用了<em class="jp">Future</em>——它只是表示“将在未来执行”，还记得吗？在这种情况下，我们产生另一个隔离，要求它计算，当我们有结果时，未来完成。例如，如果您的计算机负载过重，可能需要一段时间。</p><p id="361b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">看起来很困惑？<em class="jp">隔离</em> API是相当低级的。当在您自己的代码中使用时，我建议查看<a class="ae jq" href="https://pub.dartlang.org/packages/isolate" rel="noopener ugc nofollow" target="_blank">包:从包:stream_channel </a>中隔离或<a class="ae jq" href="https://www.dartdocs.org/documentation/stream_channel/1.6.1/stream_channel/IsolateChannel-class.html" rel="noopener ugc nofollow" target="_blank"> <em class="jp"> IsolateChannel </em>类。</a></p></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><p id="395d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">再举一个例子，这次是文件I/O。我们可以<em class="jp">使用隔离来模拟<a class="ae jq" href="https://api.dartlang.org/stable/1.23.0/dart-io/File/readAsStringSync.html" rel="noopener ugc nofollow" target="_blank">文件#readAsStringSync </a>和<a class="ae jq" href="https://api.dartlang.org/stable/1.23.0/dart-io/File/readAsString.html" rel="noopener ugc nofollow" target="_blank">文件#readAsString </a>之间的差异:</em></p><figure class="jx jy jz ka fq kb"><div class="bz el l di"><div class="kc kd l"/></div></figure><p id="0fbd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这种情况下，我们读取<em class="jp"> "file.json" </em>三次—一次同步，一次异步(即在Dart VM管理的另一个线程中)，最后一次同步，但在另一个隔离中。</p></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><p id="2e57" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从Dart 1.22.0开始，我们引入了一个有限的联合类型，<a class="ae jq" href="https://api.dartlang.org/stable/1.22.1/dart-async/FutureOr-class.html" rel="noopener ugc nofollow" target="_blank"><em class="jp">Future or&lt;T&gt;</em></a>——它代表<em class="jp">未来&lt;T&gt;T21】或<em class="jp"> T。例如，看一下缓存未来的结果:</em></em></p><figure class="jx jy jz ka fq kb"><div class="bz el l di"><div class="kc kd l"/></div></figure></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><p id="d608" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我希望你喜欢这篇简短的博文，如果你对在Dart中使用futures或异步API有任何疑问，请在这里或twitter上发表评论。谢谢！</p><blockquote class="jr js jt"><p id="250c" class="ir is jp it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated"><a class="ae jq" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是这个家庭的一员。我们现在<a class="ae jq" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jq" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is jp it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">要了解更多信息，<a class="ae jq" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">请阅读我们的“关于”页面</a>、<a class="ae jq" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上给我们点赞/发消息</a>，或者简单地说，<a class="ae jq" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is jp it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jq" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jq" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jx jy jz ka fq kb"><div class="bz el l di"><div class="lo kd l"/></div></figure></div></div>    
</body>
</html>