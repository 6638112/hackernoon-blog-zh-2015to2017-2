<html>
<head>
<title>Understanding JS: Coercion</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解JS:强制</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/understanding-js-coercion-ff5684475bfc?source=collection_archive---------3-----------------------#2017-08-10">https://medium.com/hackernoon/understanding-js-coercion-ff5684475bfc?source=collection_archive---------3-----------------------#2017-08-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/a5d80f9ae02ec001221bf3dbc4461938.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yxM5X81kN-iMiIv58JCUfw.jpeg"/></div></div></figure><p id="1a3d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">由于数量惊人的库、工具和各种各样的东西使你的开发变得更容易，许多程序员在没有深入了解某些东西如何工作的情况下就开始构建应用程序。JavaScript就是这种行为的典型代表。虽然它是最复杂和传播最广的语言之一，但许多开发人员被吸引到使用更高级的工具和抽象掉语言的“不好的部分”。</p><p id="daca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">虽然您仍然能够构建令人惊叹的应用程序，但是进入JavaScript maelstrom对您非常有益。理解“奇怪的部分”是普通普通程序员和高级开发人员的区别，虽然JS生态系统是不断变化的，但基础是所有其他工具构建的基础。理解这些会给你一个更广阔的视野，并改变你看待开发过程的方式。</p><h1 id="4dd0" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">什么是强制？</h1><p id="7458" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated"><strong class="je hv">强制</strong>是JavaScript中用于<em class="ld">意外类型转换</em>的术语。通常，当您处理数据时，您需要将其从一种数据类型转换为另一种数据类型，这是每个开发人员每天都要做的事情。<strong class="je hv">强制</strong>是指那些作为不同操作的副作用而发生的不明显的类型强制转换。</p><p id="a1f5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">大多数人认为这让他们的生活更加艰难。有些人认为这是语言设计中的一个流程，并试图避免它。然而，我建议我们进行更深入的研究，理解它是如何工作的，并拥抱JS的混乱。除非您想编写自己的JavaScript引擎，否则您很可能不得不使用强制方法。即使你决定尽可能地避免它，知道解决什么和如何解决也是很重要的。</p><p id="8df6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当然，如果处理不当，强制可能是破坏性的，会导致代码库中不必要的错误和复杂性。但是现在，让我们关注另一个观点——为了简化我们的代码并去掉那些会使我们的代码更混乱的不必要的样板文件，强制是必要的。</p><h1 id="5250" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">字符串和数字</h1><p id="18b2" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">让我们从简单的开始——如何将数字和字符串结合起来？我们如何把一个数字变成一个字符串，反之亦然？将数字转换成字符串最简单也是最常用的方法是使用<strong class="je hv"> + </strong>操作符。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d9f1" class="ln kb hu lj b fv lo lp l lq lr">14 + "" // "14"</span></pre><p id="52d3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">每当您使用“<strong class="je hv"> + </strong>”或“<strong class="je hv"> - </strong>”时，您要加或减的值必须是同一类型。在上面的例子中，他们显然不是。所以接下来会发生的是，JS会尝试将它们拉平——在这种情况下，将我们的数字转换为一个字符串，然后将它们加在一起。换句话说，每个包含字符串的“<strong class="je hv"> + </strong>”表达式都会产生一个字符串。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="4857" class="ln kb hu lj b fv lo lp l lq lr">42 + "0" // "420"</span></pre><p id="298a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们可以使用“<strong class="je hv"> + </strong>”来连接字符串，但是如果我们使用“<strong class="je hv"> - </strong>”会发生什么？它只能用于数字，所以JS会再次将值转换为相同的类型——这次是数字。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="03d0" class="ln kb hu lj b fv lo lp l lq lr">"42" - 7 // 35<br/>"42" - 0 // 42<br/>"42" - "9" // 33</span></pre><p id="f240" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">好吧，这并不难，但总有一个陷阱。让我们尝试将两个数组相加，看看会发生什么:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="12a2" class="ln kb hu lj b fv lo lp l lq lr">["alex", "sam"] + ["jon", "mary"] // "alex,samjon,mary"</span></pre><p id="efb5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">等等，刚刚发生了什么？现在，无论何时使用“<strong class="je hv"> + </strong>”操作符，如果其中一个已经是字符串，那么这些值将会连接起来，或者如果可能的话，它们将被转换为字符串。因此，您得到两个数组的字符串表示，然后将它们相加。一旦你理解了它，它就是合乎逻辑的，但是当它出乎意料地发生时，它会导致失望。</p><p id="ab85" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">另一个有趣的例子是当我们使用“<strong class="je hv"> - </strong>”操作符时会发生什么。正如我前面提到的，它只保留给数字类型，所以有用的JavaScript语言会将值转换为数字(如果可能的话)，然后对结果值执行该操作。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="765c" class="ln kb hu lj b fv lo lp l lq lr">[3] - [1] // 2<br/>["alex", "sam"] - ["jon", "mary"] // NaN</span></pre><p id="8829" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">JavaScript只是尽可能地为您节省一些时间。一些开发人员希望它能像其他语言一样工作，这让他们对结果不满意。您对JS细节越熟悉，您在代码中引入的错误就越少。</p><h1 id="7113" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated"><strong class="ak">布尔型</strong></h1><p id="e980" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">这无疑给更有经验的开发者带来了麻烦。布尔强制通常用在if语句、循环检查、三元和逻辑运算符中。当你使用其中一个变量时，如果变量不是布尔值，它将被强制为1。更重要的是，逻辑表达式的结果不一定是布尔值，而是所使用的两个操作数之一的值。也许举个例子会更好:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="0f75" class="ln kb hu lj b fv lo lp l lq lr">const a = 100<br/>const b = "test"<br/>const c = null</span><span id="cd77" class="ln kb hu lj b fv ls lp l lq lr">a || b // 100<br/>a &amp;&amp; b // "test"</span><span id="01fa" class="ln kb hu lj b fv ls lp l lq lr">a || c // 100<br/>a &amp;&amp; c // null</span><span id="2561" class="ln kb hu lj b fv ls lp l lq lr">b || c // "test"<br/>b &amp;&amp; c // null</span></pre><p id="33c4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们来分析一下这是怎么回事。例如，来自其他语言的开发人员在条件检查中使用它时，可能希望它返回true或false。事实上你得到的是其中一个操作数的值。</p><p id="1dd1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当您使用<strong class="je hv"> || </strong>操作符时，如果第一个值转换为true，您将得到该值的返回值。否则，你总会得到第二个。在&amp; &amp;的情况下，如果都被强制为真，你将总是得到第二个值<strong class="je hv">。如果第一个转换为false，那么你将得到它的返回值。</strong></p><p id="4ecf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，您可能正在思考JavaScript语言的缺陷，并考虑您的职业选择，但让我提醒您，这与您在Python和Ruby中得到的行为完全相同(令人惊讶)。它们的继承实现也以类似于原型继承的方式运行，但是这是一个不同的主题。</p><p id="5505" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">那么，这为什么有用呢？经常可以看到这样初始化变量:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="99e3" class="ln kb hu lj b fv lo lp l lq lr">function greet (name) {<br/>    name = name || 'visitor'<br/>    console.log(`Hello, ${name}!`)<br/>}</span><span id="af99" class="ln kb hu lj b fv ls lp l lq lr">greet() // Hello, visitor!</span></pre><p id="19a6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，我们使用这种确切的行为来检查一个值是否丢失，如果是，则分配另一个值。你可以在许多代码库中看到这一点。顺便提一下，在ES6中，您可以直接在函数参数中定义默认值，以避免在函数开始时检查所有传递的值。</p><h1 id="9be8" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">平等</h1><p id="6d1b" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">当谈到强制时，我们还必须提到等式运算符以及对它们的常见误解。流行的解释是<strong class="je hv"> == </strong>比较值而不检查类型<strong class="je hv"> === </strong>比较值和类型。虽然这是解释正在发生的事情的简单方法，但它并不完全正确。</p><p id="b753" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正如我们前面提到的，一些操作不能在不同类型的值上运行，所以幕后的JavaScript将使用强制来使我们的生活更容易。每当我们使用<strong class="je hv"> == </strong>比较两个值时，JavaScript将使用强制转换将值转换为相同的类型。另一方面，当我们使用严格的等式<strong class="je hv"> === </strong>时，JS不会对值进行类型转换(这意味着如果它们属于不同的类型，它们就不相等)。</p><p id="1356" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">简单来说，<strong class="je hv"> == </strong>是允许强制的比较，<strong class="je hv">= =</strong>是没有强制的比较。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="fa53" class="ln kb hu lj b fv lo lp l lq lr">42 == "42" // true<br/>42 === "42" // false</span></pre><h1 id="22c8" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">结论</h1><p id="5702" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">总之，作为JS开发人员，强制是您每天都会遇到的事情，所以理解它是至关重要的。本文中的信息足以让您有一个大致的了解，但是关于JavaScript这种有用的语言的本质，还有很多东西需要学习。</p><p id="3477" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你对更多的JS相关内容感兴趣，你可以从<a class="ae lt" href="https://buttondown.email/kondov" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> <em class="ld">这里</em> </strong> </a>订阅我的时事通讯，或者你可以看看同一系列的其他文章:</p><div class="lu lv fm fo lw lx"><a href="https://hackernoon.com/understanding-javascript-scope-1d4a74adcdf5" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab ej"><div class="lz ab ma cl cj mb"><h2 class="bd hv fv z el mc eo ep md er et ht dt translated">理解JavaScript:范围</h2><div class="me l"><h3 class="bd b fv z el mc eo ep md er et ek translated">由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…</h3></div><div class="mf l"><p class="bd b gc z el mc eo ep md er et ek translated">hackernoon.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml ja lx"/></div></div></a></div><div class="lu lv fm fo lw lx"><a href="https://hackernoon.com/understanding-javascript-prototype-and-inheritance-d55a9a23bde2" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab ej"><div class="lz ab ma cl cj mb"><h2 class="bd hv fv z el mc eo ep md er et ht dt translated">理解JavaScript:原型和继承</h2><div class="me l"><h3 class="bd b fv z el mc eo ep md er et ek translated">由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…</h3></div><div class="mf l"><p class="bd b gc z el mc eo ep md er et ek translated">hackernoon.com</p></div></div><div class="mg l"><div class="mm l mi mj mk mg ml ja lx"/></div></div></a></div><div class="lu lv fm fo lw lx"><a href="https://hackernoon.com/understanding-javascript-the-this-keyword-4de325d77f68" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab ej"><div class="lz ab ma cl cj mb"><h2 class="bd hv fv z el mc eo ep md er et ht dt translated">理解JavaScript:这个关键字</h2><div class="me l"><h3 class="bd b fv z el mc eo ep md er et ek translated">由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…</h3></div><div class="mf l"><p class="bd b gc z el mc eo ep md er et ek translated">hackernoon.com</p></div></div><div class="mg l"><div class="mn l mi mj mk mg ml ja lx"/></div></div></a></div><div class="lu lv fm fo lw lx"><a href="https://hackernoon.com/understanding-javascript-new-keyword-ec67c8caaa74" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab ej"><div class="lz ab ma cl cj mb"><h2 class="bd hv fv z el mc eo ep md er et ht dt translated">理解JavaScript:新关键字</h2><div class="me l"><h3 class="bd b fv z el mc eo ep md er et ek translated">由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…</h3></div><div class="mf l"><p class="bd b gc z el mc eo ep md er et ek translated">hackernoon.com</p></div></div><div class="mg l"><div class="mo l mi mj mk mg ml ja lx"/></div></div></a></div><div class="lu lv fm fo lw lx"><a href="https://hackernoon.com/understanding-js-coercion-ff5684475bfc" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab ej"><div class="lz ab ma cl cj mb"><h2 class="bd hv fv z el mc eo ep md er et ht dt translated">理解JS:强制</h2><div class="me l"><h3 class="bd b fv z el mc eo ep md er et ek translated">由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…</h3></div><div class="mf l"><p class="bd b gc z el mc eo ep md er et ek translated">hackernoon.com</p></div></div><div class="mg l"><div class="mp l mi mj mk mg ml ja lx"/></div></div></a></div><div class="lu lv fm fo lw lx"><a href="https://hackernoon.com/understanding-js-the-event-loop-959beae3ac40" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab ej"><div class="lz ab ma cl cj mb"><h2 class="bd hv fv z el mc eo ep md er et ht dt translated">理解JS:事件循环</h2><div class="me l"><h3 class="bd b fv z el mc eo ep md er et ek translated">由于数量惊人的库、工具和各种各样的东西使你的开发更容易，很多…</h3></div><div class="mf l"><p class="bd b gc z el mc eo ep md er et ek translated">hackernoon.com</p></div></div><div class="mg l"><div class="mq l mi mj mk mg ml ja lx"/></div></div></a></div></div></div>    
</body>
</html>