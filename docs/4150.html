<html>
<head>
<title>Some polish</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一些波兰人</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/some-polish-62200a044d27?source=collection_archive---------20-----------------------#2017-05-15">https://medium.com/hackernoon/some-polish-62200a044d27?source=collection_archive---------20-----------------------#2017-05-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="7a28" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是N部分系列的第9部分，详细介绍了我如何制作我的动画。</p><p id="47e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://hackernoon.com/rates-of-change-ca904f010a19" rel="noopener ugc nofollow" target="_blank">上一张</a>T20】下一张</p><p id="dfb7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我发现在<a class="ae jp" href="https://hackernoon.com/tagged/processing" rel="noopener ugc nofollow" target="_blank">加工</a>中有一个<a class="ae jp" href="https://hackernoon.com/tagged/command" rel="noopener ugc nofollow" target="_blank">命令</a>来绘制一个点，而不是像我做的那样绘制一个小椭圆！我看了看处理是如何设置像素的，这是用<code class="eh jq jr js jt b"><a class="ae jp" href="https://processing.org/reference/set_.html" rel="noopener ugc nofollow" target="_blank">set()</a></code>命令做的，但是像素太小了。Processing还有一个<code class="eh jq jr js jt b"><a class="ae jp" href="https://processing.org/reference/point_.html" rel="noopener ugc nofollow" target="_blank">point()</a></code>命令，我忽略了它，因为它看起来是一样的。不同的是，<code class="eh jq jr js jt b">point()</code>以<code class="eh jq jr js jt b">strokeWeight()</code>为大小画一个圆！</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="0d93" class="kc kd hu jt b fv ke kf l kg kh">strokeWeight(10);<br/>stroke(255,255,0);<br/>point(50,50);</span></pre><p id="76f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">生产:</p><figure class="ju jv jw jx fq kj fe ff paragraph-image"><div class="fe ff ki"><img src="../Images/a7916994ea01ed006187af6b2acf6799.png" data-original-src="https://miro.medium.com/v2/resize:fit:264/format:webp/1*1YyGGulYa3fUTkG2CgscLA.png"/></div></figure><p id="cab0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">哇哦，现在回到我们定期安排的节目…</p></div><div class="ab cl km kn hc ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hn ho hp hq hr"><p id="c832" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的数学老师反复向我灌输“永远给你的轴贴上标签”,所以让我们也给真正的轴贴上标签。</p><p id="34b3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">哦，但是我们的规模在不断变化。这让事情变得更加棘手，但并非不可能…</p><p id="94f8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我们最好为他们腾出一些空间，目前我们的地块紧靠着窗户的边缘。</p><p id="474c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我本打算只创建一个<code class="eh jq jr js jt b">margin</code>变量，然后简单地将它添加到<code class="eh jq jr js jt b">x</code>和<code class="eh jq jr js jt b">y</code>值中，但这比我想象的要复杂，因为我不得不以一种非直观的方式修改缩放算法(实际发生的情况是，我根本无法正确缩放它，并厌恶地放弃了)。</p><p id="e892" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以一个简单得多的方法是将代码提取到一个函数中，然后传入新的位置、宽度和高度。听起来工作量很大，但事实并非如此。首先将<code class="eh jq jr js jt b">draw()</code>函数重命名为<code class="eh jq jr js jt b">drawGraph()</code>。创建一个新的<code class="eh jq jr js jt b">draw()</code>函数并放入主体<code class="eh jq jr js jt b">drawGraph();</code>中，如下所示:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="2393" class="kc kd hu jt b fv ke kf l kg kh">void draw()<br/>{<br/>   drawGraph();<br/>}</span><span id="30ae" class="kc kd hu jt b fv kt kf l kg kh">void drawGraph()<br/>{<br/>   ...<br/>}</span></pre><p id="1d17" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在给<code class="eh jq jr js jt b">drawGraph()</code>加上<code class="eh jq jr js jt b">xPos</code>、<code class="eh jq jr js jt b">yPos</code>、<code class="eh jq jr js jt b">graphWidth</code>、<code class="eh jq jr js jt b">graphHeight</code>整数。</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="5bc9" class="kc kd hu jt b fv ke kf l kg kh">void drawGraph(int xPos, int yPos, int graphWidth, int graphHeight)</span></pre><p id="08e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我认为60像素的边距是一个很好的起点。所以让我们用这个值做一个全局常数。在<code class="eh jq jr js jt b">draw()</code>之前添加这一行:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="a1dc" class="kc kd hu jt b fv ke kf l kg kh">final int MARGIN = 60;</span></pre><p id="3f20" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将某物标记为<code class="eh jq jr js jt b">final</code>意味着它不能被修改，按照惯例，这些变量全部用大写字母命名。</p><p id="6c4a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们所做的就是从<code class="eh jq jr js jt b">draw()</code>呼叫<code class="eh jq jr js jt b">drawGraph()</code>,内容如下:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="dd26" class="kc kd hu jt b fv ke kf l kg kh">drawGraph(MARGIN, height - MARGIN, width - MARGIN, height - MARGIN);</span></pre><p id="9868" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以让我们开始使用<code class="eh jq jr js jt b">drawGraph()</code>中的那些值:</p><p id="23e5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先分别用<code class="eh jq jr js jt b">graphWidth</code>和<code class="eh jq jr js jt b">graphHeight</code>替换<code class="eh jq jr js jt b">width</code>和<code class="eh jq jr js jt b">height</code>的所有用途。</p><p id="3ea5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后用新发现的<code class="eh jq jr js jt b">point()</code>函数替换<code class="eh jq jr js jt b">ellipse()</code>函数:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="12cc" class="kc kd hu jt b fv ke kf l kg kh">point(xPos + x * xScale, yPos - (y * yScale));</span></pre><p id="25da" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你就完了。用<code class="eh jq jr js jt b">point()</code>绘图似乎也快了很多！哦，对了，把<code class="eh jq jr js jt b">strokeWeight(3)</code>加到<code class="eh jq jr js jt b">setup()</code>上，否则你的点数将是1个像素。</p><p id="6f03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好，让我们画一些轴。从上到下使用<code class="eh jq jr js jt b">MARGIN</code>的简单线条，所以在<code class="eh jq jr js jt b">draw()</code>功能中:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="08e0" class="kc kd hu jt b fv ke kf l kg kh">line(MARGIN, 0, MARGIN, height);<br/>line(0, height - MARGIN, width, height - MARGIN);</span></pre><p id="a2c1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">嗯，我第一次没成功。这是因为将<code class="eh jq jr js jt b">background(0)</code>留在了<code class="eh jq jr js jt b">drawGraph()</code>功能中，该功能正在清除绘制的线。将它移到<code class="eh jq jr js jt b">draw()</code>的第一行，它将全部工作。</p><p id="3f02" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">结果应该是这样的:</p><figure class="ju jv jw jx fq kj fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/de93fa1d89f2e61807b4f9951d09e1f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*K97u1nqdo4L7brr9XvEicw.png"/></div></figure><p id="e675" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">线条粗细继承自<code class="eh jq jr js jt b">setup()</code>中的<code class="eh jq jr js jt b">strokeWeight</code>命令。因此，让我们将它移到<code class="eh jq jr js jt b">drawGraph()</code>的第一行，并将<code class="eh jq jr js jt b">strokeWeight(1)</code>添加到<code class="eh jq jr js jt b">draw()</code>的第一行。这将使一条细线的轴和图表的重点。</p><p id="1e4b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以现在我们需要添加刻度线。由于刻度线需要缩放到与图表相同，因此需要从<code class="eh jq jr js jt b">drawGraph()</code>函数内部绘制。我们先做x轴，标记每年。</p><p id="81d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">呀。这不像我想象的那么简单。因为每个数据点都是在星期六记录的，我们只需将我们的<code class="eh jq jr js jt b">dataIndex</code>乘以7，就可以得到从开始日期算起的天数，从而得到数据，这使得计算刻度线变得非常重要。</p><p id="f0e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">经过相当多的实验，我能够将复杂度降低到以下函数:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="50ad" class="kc kd hu jt b fv ke kf l kg kh">void drawXAxis(int xAxisMaximum, float xScale)<br/>{<br/>  int yPos = height - MARGIN;<br/>  float xAxisTick = 279.0 / 7.0;<br/>  int axisYear = 1958;<br/>  <br/>  while(xAxisTick &lt;= xAxisMaximum)<br/>  {<br/>    int tickLength = 5;<br/>    int xPos = MARGIN + int(xAxisTick * xScale);<br/>    <br/>    if(axisYear % 5 == 0)<br/>    {<br/>      text(axisYear, xPos, yPos + 22);<br/>      tickLength = 10;<br/>    }<br/>        <br/>    line(xPos, yPos, xPos, yPos + tickLength);<br/>    <br/>    xAxisTick += 365.25 / 7.0;<br/>    axisYear++;<br/>  }<br/>}</span></pre><p id="2760" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其中<code class="eh jq jr js jt b">xAxisMaximum</code>以绘图宽度开始，然后随着比例尺增加缩放的最大x值。<code class="eh jq jr js jt b">xAxisTick</code>的初始值是1958年3月29日(279)除以7转换成周之后的剩余天数。</p><p id="de0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里我介绍一个<code class="eh jq jr js jt b">while</code>循环。当括号的内容为真时，这种类型的循环继续执行。在这种情况下，刻度的当前位置小于轴上的最大x值。</p><p id="b122" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第<code class="eh jq jr js jt b">if(axisYear % 5 == 0)</code>行利用模数运算符<code class="eh jq jr js jt b">%</code>制作一个更长的刻度线，每五年显示一次年份。然后，我们简单地为分笔成交点画一条线，然后将分笔成交点位置增加一年中的平均周数。</p><p id="7482" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这导致:</p><figure class="ju jv jw jx fq kj"><div class="bz el l di"><div class="kv kw l"/></div></figure><p id="b5f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对此我很满意。下面是完整的代码:</p><pre class="ju jv jw jx fq jy jt jz ka aw kb dt"><span id="2b09" class="kc kd hu jt b fv ke kf l kg kh">import java.time.*;<br/>import de.looksgood.ani.*;<br/>Ani _ani;</span><span id="4c1d" class="kc kd hu jt b fv kt kf l kg kh">FloatDict _data = new FloatDict();<br/>LocalDate _startDate = LocalDate.of(1958, 3, 29);</span><span id="bf0f" class="kc kd hu jt b fv kt kf l kg kh">void setup()<br/>{<br/>  loadData();<br/>  size(500,500);<br/>  background(0);<br/>  stroke(255,255,0);<br/>  textAlign(CENTER);<br/>  <br/>  Ani.init(this);<br/>  Ani.setDefaultTimeMode(Ani.FRAMES);<br/>  _ani = new Ani(this, 1032, "_change", 3, Ani.EXPO_IN);<br/>}</span><span id="1537" class="kc kd hu jt b fv kt kf l kg kh">float yScale = 20.0;</span><span id="5397" class="kc kd hu jt b fv kt kf l kg kh">boolean _coda = false;<br/>int _codaCount = 0;</span><span id="403c" class="kc kd hu jt b fv kt kf l kg kh">float _change = 1.0;<br/>final int MARGIN = 60;</span><span id="6553" class="kc kd hu jt b fv kt kf l kg kh">void draw()<br/>{<br/>  background(0);<br/>  strokeWeight(1);<br/>  <br/>  line(MARGIN, 0, MARGIN, height);<br/>  line(0, height - MARGIN, width, height - MARGIN);<br/>  <br/>  drawGraph(MARGIN, height - MARGIN, width - MARGIN, height - MARGIN);<br/>}</span><span id="7f2b" class="kc kd hu jt b fv kt kf l kg kh">void drawGraph(int xPos, int yPos, int graphWidth, int graphHeight)<br/>{<br/>  int deltaX = int(frameCount * _change);<br/>    <br/>  float xScale = 1.0;<br/>  <br/>  int xAxisMaximum = graphWidth;<br/>  <br/>  if(deltaX &gt; graphWidth)<br/>  {<br/>    xAxisMaximum = deltaX;<br/>    xScale = float(graphWidth) / float(deltaX);<br/>  }<br/>  <br/>  drawXAxis(xAxisMaximum, xScale);<br/>  <br/>  strokeWeight(3);<br/>  <br/>  for(int dataIndex = 1; dataIndex &lt;= deltaX; dataIndex++)<br/>  {<br/>    <br/>    int daysFromStart = (dataIndex - 1) * 7;<br/>    LocalDate frameDate = _startDate.plusDays(daysFromStart);<br/>       <br/>    <br/>    if(_data.hasKey(frameDate.toString()))<br/>    {<br/>      float co2 = _data.get(frameDate.toString());<br/>            <br/>      float x = dataIndex;<br/>      float y = (co2 - 313.04) ;<br/>      <br/>      if(y * yScale &gt; graphHeight) <br/>      {<br/>        yScale = float(graphHeight)/y;<br/>      }<br/>      <br/>      point(xPos + x * xScale, yPos - (y * yScale));<br/>    }<br/>  }    <br/>}</span><span id="b86c" class="kc kd hu jt b fv kt kf l kg kh">void drawXAxis(int xAxisMaximum, float xScale)<br/>{<br/>  int yPos = height - MARGIN;<br/>  float xAxisTick = 279.0 / 7.0;<br/>  int axisYear = 1958;<br/>  <br/>  while(xAxisTick &lt;= xAxisMaximum)<br/>  {<br/>    int tickLength = 5;<br/>    int xPos = MARGIN + int(xAxisTick * xScale);<br/>    <br/>    if(axisYear % 5 == 0)<br/>    {<br/>      text(axisYear, xPos, yPos + 22);<br/>      tickLength = 10;<br/>    }<br/>        <br/>    line(xPos, yPos, xPos, yPos + tickLength);<br/>    <br/>    xAxisTick += 365.25 / 7.0;<br/>    axisYear++;<br/>  }<br/>}</span><span id="ede5" class="kc kd hu jt b fv kt kf l kg kh">void loadData()<br/>{<br/>  String[] lines = loadStrings("weekly_in_situ_co2_mlo.csv");<br/>  <br/>  for (String line : lines) <br/>  {<br/>    if( line.startsWith("\"") ) continue;<br/>    <br/>    String[] values = split(line, ',');<br/>    String date = values[0];<br/>    float co2 = parseFloat(values[1]);<br/>    _data.set(date, co2);<br/>  }<br/>}</span></pre><p id="4100" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这比我想象的要复杂得多。我打算这篇文章涵盖x和y轴以及标题等！我想那会是下周吧…</p><div class="ju jv jw jx fq ab cb"><figure class="kx kj ky kz la lb lc paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="kx kj ky kz la lb lc paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="kx kj ky kz la lb lc paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ld le lf"><p id="f922" class="ir is lg it b iu iv iw ix iy iz ja jb lh jd je jf li jh ji jj lj jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客们下午的开始。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is lg it b iu iv iw ix iy iz ja jb lh jd je jf li jh ji jj lj jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ju jv jw jx fq kj fe ff paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="fe ff lk"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="ju jv jw jx fq kj"><div class="bz el l di"><div class="lp kw l"/></div></figure></div></div>    
</body>
</html>