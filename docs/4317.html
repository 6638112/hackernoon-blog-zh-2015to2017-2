<html>
<head>
<title>RaspberryPi Home Surveillance with only ~150 lines of Python Code.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RaspberryPi家庭监控，只有大约150行Python代码。</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/raspberrypi-home-surveillance-with-only-150-lines-of-python-code-2701bd0373c9?source=collection_archive---------0-----------------------#2017-05-25">https://medium.com/hackernoon/raspberrypi-home-surveillance-with-only-150-lines-of-python-code-2701bd0373c9?source=collection_archive---------0-----------------------#2017-05-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4e9c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">很久以前我有一个树莓派，它就放在我的技术清洗箱里。在看了Youtube上一段充满创意的覆盆子应用程序后，带着羡慕，我决定自己尝试一下。第一个显而易见的想法，我是一个家庭安全系统，检查你的房子，而你不在。</p><p id="1329" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后一个东西能够通过摄像机检测和粗略定位任何运动。它会拍照并把照片发到你的邮箱里。此外，我们能够在本地网络中使用简单的web界面与它进行交互，因此我们能够在家门口激活或停用它。我假设，如果有人能够到达本地wifi网络，那么他/她很可能是我们中的一员(够公平吧？).</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/840bb1ee4ab34bb16823113b7fa74af1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9dZQ2UYbcz6CZQyqcAj1DQ.jpeg"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">This is the final look of my raspi.</figcaption></figure><p id="cebe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于本文的其余部分，我试图总结重要的实现细节。希望你会觉得有趣。也可以直接去<a class="ae kf" href="https://github.com/erogol/RaspiSecurity" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> Github </strong> </a> <strong class="it hv"> </strong>查看执行情况。</p><p id="f317" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从硬件开始。你需要这个项目:</p><ul class=""><li id="90c1" class="kg kh hu it b iu iv iy iz jc ki jg kj jk kk jo kl km kn ko dt translated"><a class="ae kf" href="https://www.amazon.com/gp/product/B01CD5VC92?ie=UTF8&amp;tag=erogol-20&amp;camp=1789&amp;linkCode=xm2&amp;creativeASIN=B01CD5VC92" rel="noopener ugc nofollow" target="_blank">树莓Pi 2 B+ </a>(其他版本也可以)</li><li id="5bdb" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated"><a class="ae kf" href="https://www.amazon.com/gp/product/B012V1HEP4?ie=UTF8&amp;tag=erogol-20&amp;camp=1789&amp;linkCode=xm2&amp;creativeASIN=B012V1HEP4" rel="noopener ugc nofollow" target="_blank">树莓相机</a>和一个相机外壳(或称创意外壳)</li><li id="e70e" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated"><a class="ae kf" href="https://www.amazon.com/gp/product/B06Y5MX9Q8?ie=UTF8&amp;tag=erogol-20&amp;camp=1789&amp;linkCode=xm2&amp;creativeASIN=B06Y5MX9Q8" rel="noopener ugc nofollow" target="_blank"> Wifi加密狗</a>(不需要Pi 3)</li><li id="db0f" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated"><a class="ae kf" href="https://www.amazon.com/gp/product/B01CDVSBPO?ie=UTF8&amp;tag=erogol-20&amp;camp=1789&amp;linkCode=xm2&amp;creativeASIN=B01CDVSBPO" rel="noopener ugc nofollow" target="_blank">覆盆子盒</a>(可选)</li></ul><p id="e510" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们需要安装相关的Python库。它们都符合“pip安装”的条件</p><ul class=""><li id="e06a" class="kg kh hu it b iu iv iy iz jc ki jg kj jk kk jo kl km kn ko dt translated"><strong class="it hv"> PiCamera </strong>:用于从Raspi相机中取帧</li><li id="94de" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated"><strong class="it hv"> cv2 </strong>:全智能计算机视觉算法</li><li id="e815" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated"><strong class="it hv"> smtplib </strong>:发送邮件</li><li id="71a3" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated"><strong class="it hv">电子邮件:</strong>格式化邮件数据</li><li id="91e2" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated"><strong class="it hv">烧瓶</strong>:简单的开/关安全网站</li></ul><h1 id="2853" class="ku kv hu bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr dt translated">运动检测</h1><p id="1456" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">开始编码吧！我们需要做的第一件事是像老板一样导入我们的库！然后初始化raspi camera，使其准备好传输帧。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><p id="6c9d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们喜欢检测每一帧的运动，但我们也喜欢忽略错误的警报。因此；我们计算连续检测的数量，如果它大于一个给定的值，我们真的报警；否则我们就无视。此外，在开始运行之前，我们给系统一些时间来进行自我调整。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><p id="0b8a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为下一步，我们开始通过帧循环，并运行背景减除算法。具体而言，我们应用以下操作来检测运动；</p><ul class=""><li id="e333" class="kg kh hu it b iu iv iy iz jc ki jg kj jk kk jo kl km kn ko dt translated">将帧转换为灰度</li><li id="c6fe" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated">模糊帧以减少帧细节。</li><li id="a681" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated">计算帧和平均背景帧的差异。</li><li id="3e19" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated">用加权移动平均更新平均背景帧。</li></ul><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lz"><img src="../Images/83e63c3537bae4090ac154efb7271a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*vIiY6zGDgzdpQA6Y_0mEaA.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">This is a overall scheme of background subtraction. We only use average frame for background model but there are many smarter algorithms for more robust modelling. However, in Raspi faster is better</figcaption></figure><p id="1df4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以上步骤给了我们一个像素变化的遮罩。这还不够。在继续之前，我们需要更多的调整来减少噪音，填补漏洞和收集指示移动部分的轮廓。走得更远；</p><ul class=""><li id="9b01" class="kg kh hu it b iu iv iy iz jc ki jg kj jk kk jo kl km kn ko dt translated">阈值差异帧降噪。</li><li id="7cc3" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated">用于填孔扩张门槛框架。</li><li id="d946" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated">查找轮廓</li><li id="cc62" class="kg kh hu it b iu kp iy kq jc kr jg ks jk kt jo kl km kn ko dt translated">找到轮廓周围的边界框来定位运动。</li></ul><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ma"><img src="../Images/f50234f3c3e52a7cb2658749a554d89f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*37zgcP7ut4UfUFsLXgZP9g.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Effect of dilation</figcaption></figure><p id="1402" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在所有这些老派算法阶段之后，我们检测运动。现在是实现警报系统逻辑的时候了。我们首先检查连续运动检测的数量。如果计数高于阈值，我们会发送一封邮件，其中包含在特定时间间隔内拍摄的快照。这里，我们喜欢用合理数量的帧快照捕捉各种视图。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><h1 id="d189" class="ku kv hu bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr dt translated">发送电子邮件</h1><p id="f849" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">使用Python时，做事情总是很容易，发送电子邮件也是如此。最初，我们需要租用一个电子邮件地址(我租用了一个gmail地址)。然后，我们只需使用下面的代码发送一封包含我们需要的所有内容的电子邮件。棘手的部分是在附加到电子邮件之前将帧转换成正确的数据格式。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><h1 id="2d36" class="ku kv hu bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr dt translated">网站(全球资讯网的主机站)</h1><p id="67f8" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">该项目的最后一部分是创建一个网站，可从本地网络，用于启用和禁用安全系统。为此，我们使用Flask framework，它是世界上最简单的web服务器框架。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><p id="2c82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，我们需要用jQuery支持的基本html代码创建一个漂亮的登录页面，以便向我们的服务器发送on/off ajax请求并更新系统状态。我们对此进行编码，并将其放入项目根文件夹中名为“templates”的文件夹中。这是烧瓶html内容的默认位置。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/d0e29a2e95252a70ff1d19fa0294b592.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*KVQ2dUtlqGVBPEazVpXx-w.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Screenshot of system interface</figcaption></figure><h1 id="ff0d" class="ku kv hu bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr dt translated">可能的改进</h1><p id="2c21" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">通过更好的算法处理，某些人可能会有更健壮的检测结果。也许是一个更强大的背景建模，更多的图像处理步骤或更好的算法参数。</p><p id="2816" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您也可以使用powerbank移动相同的系统。我试过我的10000 mAh Anker powerbank，它可以让系统运行15个小时。如果你喜欢在无插头的地方使用，这足够用一天了。</p><p id="8fd3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一个简单的改进是在黑暗的地方使用红外摄像机。我上面分享的设备有一个简单的黑暗盲相机，但我最近开始使用红外版本。真的很好用。</p><h1 id="b51b" class="ku kv hu bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr dt translated">最后的话</h1><p id="96d4" class="pw-post-body-paragraph ir is hu it b iu ls iw ix iy lt ja jb jc lu je jf jg lv ji jj jk lw jm jn jo hn dt translated">我们完成了，可以走了！这里我也分享一下我的<a class="ae kf" href="https://github.com/erogol/RaspiSecurity" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> Github回购</strong> </a>。请随意评论和投稿。</p><p id="1d4b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">希望你的房子永远不需要监控系统。但是如果你还需要一个便宜的，这里我给你一个。如果你懒于实施所有这些【(erengolge@gmail.com】联系我，让我给你安排一些事情。祝你好运！</p><p id="b7c3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在离开我的星球大战的收银台之前。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/0a88f75643bbbdda7b8099fda72d5ba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*6EJfOYoUwQKy-mJBGhQqjg.gif"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Catching up my wife in a false alarm !! GIF of mailed images</figcaption></figure><div class="jq jr js jt fq ab cb"><figure class="md ju me mf mg mh mi paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="md ju me mf mg mh mi paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="md ju me mf mg mh mi paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mj mk ml"><p id="f922" class="ir is mm it b iu iv iw ix iy iz ja jb mn jd je jf mo jh ji jj mp jl jm jn jo hn dt translated"><a class="ae kf" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kf" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kf" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kf" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is mm it b iu iv iw ix iy iz ja jb mn jd je jf mo jh ji jj mp jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kf" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kf" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mq"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>