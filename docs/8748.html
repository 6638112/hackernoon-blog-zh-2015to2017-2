<html>
<head>
<title>Managing Encryption Keys With AWS KMS In Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js中的AWS KMS管理加密密钥</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/managing-encryption-keys-with-aws-kms-in-node-js-c320c860019a?source=collection_archive---------1-----------------------#2017-12-13">https://medium.com/hackernoon/managing-encryption-keys-with-aws-kms-in-node-js-c320c860019a?source=collection_archive---------1-----------------------#2017-12-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/9a5974262c34121956b175436f8b65d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NIprKu4bXQXNmW59MDZmfQ.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">itsgoingdown.org</figcaption></figure><p id="e82a" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><a class="ae ke" href="https://hackernoon.com/tagged/security" rel="noopener ugc nofollow" target="_blank">安全性</a>在开发应用时非常重要。如何在应用程序中加密数据和管理加密密钥？成功的密钥<a class="ae ke" href="https://hackernoon.com/tagged/management" rel="noopener ugc nofollow" target="_blank">管理</a>对于密码系统的安全性至关重要。这就是KMS发挥作用的地方。让我们先来看看什么是真正的KMS。</p><h1 id="bc32" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">密钥管理系统(KMS)</h1><p id="d0f5" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">根据维基百科，</p><blockquote class="li lj lk"><p id="4203" class="jg jh ll ji b jj jk jl jm jn jo jp jq lm js jt ju ln jw jx jy lo ka kb kc kd hn dt translated">一个<strong class="ji hv">密钥管理系统</strong> (KMS)，也被称为<strong class="ji hv">加密密钥管理系统</strong> (CKMS)，是一种为设备和应用程序生成、分发和管理<a class="ae ke" href="https://en.wikipedia.org/wiki/Key_(cryptography)" rel="noopener ugc nofollow" target="_blank">加密密钥</a>的集成方法。与术语密钥管理相比，KMS是为特定的用例定制的，如安全软件更新或<a class="ae ke" href="https://en.wikipedia.org/wiki/Machine-to-machine" rel="noopener ugc nofollow" target="_blank">机器对机器</a>通信。从整体来看，它涵盖了安全性的所有方面—从通过安全的密钥交换安全地生成密钥，到客户端上安全的密钥处理和存储。因此，KMS包括用于<a class="ae ke" href="https://en.wikipedia.org/wiki/Key_generation" rel="noopener ugc nofollow" target="_blank">密钥生成</a>、分发和替换的后端功能，以及用于在设备上注入密钥、存储和管理密钥的客户端功能。随着<a class="ae ke" href="https://en.wikipedia.org/wiki/Internet_of_Things" rel="noopener ugc nofollow" target="_blank">物联网</a>的出现，KMS成为互联设备安全的重要组成部分。</p></blockquote><p id="415c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">当处理密钥管理和加密时，KMS使你的生活变得容易。</p><h1 id="f624" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">AWS KMS</h1><p id="6754" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">现在我们知道了什么是密钥管理系统。让我们简单谈谈AWS KMS。</p><p id="7c17" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">AWS KMS是AWS提供的一项服务，让您可以轻松管理您的加密密钥。它在后端使用硬件安全模块(HSM)。自动气象站KMS与其他自动气象站服务集成。成本也低。AWS KMS提供对您的密钥的访问控制，以便您可以确定谁可以访问密钥，何时可以访问密钥以及许多其他选项。</p><p id="782a" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">AWS KMS在<a class="ae ke" href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="noopener ugc nofollow" target="_blank">伽罗瓦/计数器模式(GCM) </a>中使用<a class="ae ke" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" rel="noopener ugc nofollow" target="_blank">高级加密标准(AES) </a>算法，被称为AES-GCM。AWS KMS使用256位密钥的算法。</p><p id="4bb5" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">AWS KMS定价可点击查看<a class="ae ke" href="https://aws.amazon.com/kms/pricing/" rel="noopener ugc nofollow" target="_blank">。免费层包括每月20，000次请求。</a></p><h1 id="6492" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">通过Node.js使用AWS KMS</h1><p id="e3b8" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">在这一节中，我将分享如何在Node.js应用程序中使用AWS KMS。我将在这里讨论以下主题，</p><ul class=""><li id="0c52" class="lp lq hu ji b jj jk jn jo jr lr jv ls jz lt kd lu lv lw lx dt translated">如何创建CMK(客户主密钥)。</li><li id="49cc" class="lp lq hu ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated">如何使用IP受限策略将IAM用户连接到CMK。</li><li id="3b42" class="lp lq hu ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated">如何使用CMK加密数据？</li><li id="9856" class="lp lq hu ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated">如何使用CMK解密数据？</li><li id="5400" class="lp lq hu ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated">使用自动气象站KMS的信封加密。</li><li id="c20f" class="lp lq hu ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated">加密上下文(简介)</li></ul><p id="2112" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">话虽如此，我想首先声明，我不是一个密码专家！。</p><h2 id="2f35" class="md kg hu bd kh me mf mg kl mh mi mj kp jr mk ml kt jv mm mn kx jz mo mp lb mq dt translated">如何创建CMK(客户主密钥)</h2><p id="8cb9" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">AWS KMS的主要资源是<em class="ll">客户主密钥</em> (CMKs)。cmk由客户管理或AWS管理。让我们看看如何在AWS中创建客户主密钥。</p><p id="3551" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">登录AWS控制台并转到服务。然后选择“IAM”。在左边你可以看到一个叫做“加密密钥”的部分。导航到该部分。然后选择左上角的“创建密钥”。</p><figure class="ms mt mu mv fq iv fe ff paragraph-image"><div class="fe ff mr"><img src="../Images/94d8948da8440dc0b1ec3502dca1fce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*4DtQtqXQR4LykIgMOM3slw.png"/></div></figure><p id="054d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">输入密钥的别名和描述。在高级选项中选择KMS。如果需要，您可以在这里导入自己的外部密钥。我不打算在这里介绍如何导入一个外部键(这也非常简单)。</p><p id="8704" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">单击下一步。如果需要，添加标签(可选)。再次转到下一步。如果您已经创建了IAM用户(如果没有，请跳过选择用户。我们稍后将创建一个用户)，如果您希望允许该用户访问此密钥，请从列表中选择该用户，然后单击“下一步”。最后完成流程。现在将创建您的密钥。</p><h2 id="e0b4" class="md kg hu bd kh me mf mg kl mh mi mj kp jr mk ml kt jv mm mn kx jz mo mp lb mq dt translated">如何使用IP受限策略将IAM用户连接到CMK</h2><p id="4fff" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">现在，如果您之前没有创建IAM用户，请按照以下步骤创建一个。</p><p id="ea8a" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">转到“IAM”(如上)。选择左侧的“用户”。选择左上角的“添加用户”。填写所需的详细信息。下面给出一个例子。</p><figure class="ms mt mu mv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mw"><img src="../Images/f4a94c910c2242f3a139e84f0c1647f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4J0ZyppNiWkdTgSXu_nnNg.png"/></div></div></figure><p id="f4e0" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">选择下一步。选择“直接附加现有策略”选项。然后选择“创建策略”。您可以直观地编辑策略或编辑策略的json。我将在这里编辑json。选择“json”选项卡。我将使用下面的简单策略，只允许从一个选定的IP访问CMK。您可以选择一个IP范围，也可以以任何方式自定义策略。</p><figure class="ms mt mu mv fq iv"><div class="bz el l di"><div class="mx my l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">policy</figcaption></figure><p id="8b5b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">之后，按照说明保存创建的策略。然后完成用户的创建。在最后一页，将显示新用户的访问密钥ID和秘密访问密钥。下载那些信息。之后您将无法查看它(但您可以再次创建新的凭据)。</p><p id="5c3c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">现在转到加密密钥并选择您刚刚创建的密钥。转到“关键用户”部分并选择“添加”。选择您创建的用户。然后，该用户将被添加到您创建的CMK的允许列表中。</p><figure class="ms mt mu mv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mz"><img src="../Images/876658eea09bf7796ff2ec6d8b26414c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M137zrHSlb9A5li0uYppdA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Key Users</figcaption></figure><h2 id="8740" class="md kg hu bd kh me mf mg kl mh mi mj kp jr mk ml kt jv mm mn kx jz mo mp lb mq dt translated">如何使用CMK加密数据</h2><p id="865e" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">足够的设置事情，让我们看看如何使用AWS KMS！</p><p id="1384" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我在这里使用的是Node.js的AWS SDK。让我们从npm安装AWS SDK包。</p><pre class="ms mt mu mv fq na nb nc nd aw ne dt"><span id="9f3b" class="md kg hu nb b fv nf ng l nh ni">npm install aws-sdk</span></pre><p id="68b1" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">下面的函数加密一个给定的缓冲区并输出密文blob。</p><pre class="ms mt mu mv fq na nb nc nd aw ne dt"><span id="b518" class="md kg hu nb b fv nf ng l nh ni"><strong class="nb hv">function </strong>encrypt(buffer) {<br/>    <strong class="nb hv">const </strong>kms = <strong class="nb hv">new </strong>aws.KMS({<br/>        accessKeyId: 'AKCVBTRNOSMLTIA7RPQQ', //credentials for your IAM user<br/>        secretAccessKey: 'lJQtdIfH/Cup9AyaaHV8h2NnR/eKFIsZea5Vn0k', //credentials for your IAM user<br/>        region: 'ap-southeast-1'<br/>    });<br/>    <strong class="nb hv">return new </strong>Promise((resolve, reject) =&gt; {<br/>        <strong class="nb hv">const </strong>params = {<br/>            KeyId: '965d2884-b2cd-4d79-8773-6b1f57133300', // The identifier of the CMK to use for encryption. You can use the key ID or Amazon Resource Name (ARN) of the CMK, or the name or ARN of an alias that refers to the CMK.<br/>            Plaintext: buffer// The data to encrypt.<br/>        };<br/>        kms.encrypt(params, (err, data) =&gt; {<br/>            <strong class="nb hv">if </strong>(err) {<br/>                reject(err);<br/>            } <strong class="nb hv">else </strong>{<br/>                resolve(data.CiphertextBlob);<br/>            }<br/>        });<br/>    });<br/>}</span></pre><h2 id="5a70" class="md kg hu bd kh me mf mg kl mh mi mj kp jr mk ml kt jv mm mn kx jz mo mp lb mq dt translated">如何使用CMK解密数据</h2><p id="1ea8" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">下面的函数解密之前加密的密文blob，并返回纯文本缓冲区。</p><pre class="ms mt mu mv fq na nb nc nd aw ne dt"><span id="69bf" class="md kg hu nb b fv nf ng l nh ni"><strong class="nb hv">function </strong>decrypt(buffer) {<br/>    <strong class="nb hv">const </strong>kms = <strong class="nb hv">new </strong>aws.KMS({<br/>        accessKeyId: 'AKCVBTRNOSMLTIB7ROQQ',<br/>        secretAccessKey: 'lJQtdIfH/Cup9AyabHV9h2NnR/eKFIsZea2Vn0k',<br/>        region: 'ap-southeast-1'<br/>    });<br/>    <strong class="nb hv">return new </strong>Promise((resolve, reject) =&gt; {<br/>        <strong class="nb hv">const </strong>params = {<br/>            CiphertextBlob: buffer// The data to dencrypt.<br/>        };<br/>        kms.decrypt(params, (err, data) =&gt; {<br/>            <strong class="nb hv">if </strong>(err) {<br/>                reject(err);<br/>            } <strong class="nb hv">else </strong>{<br/>                resolve(data.Plaintext);<br/>            }<br/>        });<br/>    });<br/>}</span></pre><p id="524d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">下面的代码加密文本“abc ”,然后解密，并将值打印到控制台</p><pre class="ms mt mu mv fq na nb nc nd aw ne dt"><span id="ff50" class="md kg hu nb b fv nf ng l nh ni">encrypt(<strong class="nb hv">new </strong>Buffer('abc','utf-8')).then(decrypt).then(plaintext =&gt; {<br/>    console.log(plaintext.toString('utf-8'));<br/>});</span></pre><h2 id="2551" class="md kg hu bd kh me mf mg kl mh mi mj kp jr mk ml kt jv mm mn kx jz mo mp lb mq dt translated">使用AWS KMS的信封加密</h2><p id="56f6" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">AWS KMS对使用CMK直接加密数据有大小限制。每个请求最多只能加密4千字节的数据。如果你想加密更大的数据，例如视频，你需要使用信封加密。</p><p id="25c7" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在信封加密中，我们使用KMS的CMK生成数据密钥。当生成数据密钥时，AWS向我们发送明文密钥和加密密钥(使用我们的CMK)。然后我们使用生成的明文数据密钥来加密我们的数据。加密数据后，我们销毁明文密钥，并保留加密密钥。当我们想要解密数据时，我们将加密密钥发送给AWS KMS，并取回明文密钥，然后继续解密。</p><p id="62af" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">首先，我们需要从AWS KMS生成一个数据密钥。下图描述了该过程。</p><figure class="ms mt mu mv fq iv fe ff paragraph-image"><div class="fe ff nj"><img src="../Images/b3894b654f229accf0b421f38fd311fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/0*rwe9TTmzwypWGmIN.png"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae ke" href="http://docs.aws.amazon.com" rel="noopener ugc nofollow" target="_blank">http://docs.aws.amazon.com</a></figcaption></figure><p id="f7c7" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">以下函数从AWS KMS生成数据密钥。</p><pre class="ms mt mu mv fq na nb nc nd aw ne dt"><span id="43b2" class="md kg hu nb b fv nf ng l nh ni"><strong class="nb hv">function </strong>generateDataKey() {<br/>    <strong class="nb hv">const </strong>kms = <strong class="nb hv">new </strong>aws.KMS({<br/>        accessKeyId: 'AKCVBTRNOSMLTIB7ROQQ',<br/>        secretAccessKey: 'lJQtdIfH/Cup9AyabHV9h2NnR/eKFIsZea2Vn0k',<br/>        region: 'ap-southeast-1'<br/>    });<br/>    <strong class="nb hv">return new </strong>Promise((resolve, reject) =&gt; {<br/>        <strong class="nb hv">const </strong>params = {<br/>            KeyId: '965d2884-b2ab-4e78-8773-6b1f57133300', // The identifier of the CMK to use to encrypt the data key. You can use the key ID or Amazon Resource Name (ARN) of the CMK, or the name or ARN of an alias that refers to the CMK.<br/>            KeySpec: 'AES_256'// Specifies the type of data key to return.<br/>        };<br/>        kms.generateDataKey(params, (err, data) =&gt; {<br/>            <strong class="nb hv">if </strong>(err) {<br/>                reject(err);<br/>            } <strong class="nb hv">else </strong>{<br/>                resolve(data);<br/>            }<br/>        });<br/>    });<br/>}</span></pre><p id="45e9" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">“数据”有加密数据密钥和明文数据密钥作为缓冲区。</p><p id="650b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">下一步是用明文数据密钥加密数据。</p><figure class="ms mt mu mv fq iv fe ff paragraph-image"><div class="fe ff nk"><img src="../Images/1e3c9021e02640d1b4dda06180d2fda4.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/0*nHKMpKw2J4V3ZLgo.png"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae ke" href="http://docs.aws.amazon.com" rel="noopener ugc nofollow" target="_blank">http://docs.aws.amazon.com</a></figcaption></figure><p id="e263" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">以下是使用AES-CBC通过数据密钥加密数据的示例代码。这使用加密包。为了简单起见，这里我使用了一个固定的iv(初始化向量)。</p><pre class="ms mt mu mv fq na nb nc nd aw ne dt"><span id="9e81" class="md kg hu nb b fv nf ng l nh ni"><strong class="nb hv">function </strong>encryptAES(key, buffer) {<br/>    <strong class="nb hv">const </strong>algorithm = 'AES-256-CBC';<br/><br/>    <strong class="nb hv">const </strong>iv = <strong class="nb hv">new </strong>Buffer('00000000000000000000000000000000', 'hex');<br/><br/>    encryptor = crypto.createCipheriv(algorithm, key, iv);<br/>    encryptor.write(strBuffer);<br/>    encryptor.end();<br/><br/>    <strong class="nb hv">return </strong>encryptor.read();<br/>}</span></pre><p id="07cb" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">让我们看看如何解密加密的数据。首先，我们需要使用CMK来解密我们的加密密钥。下图说明了这一点。我之前发布的代码片段可以用来做这件事(就像常规的数据解密一样)。</p><figure class="ms mt mu mv fq iv fe ff paragraph-image"><div class="fe ff nl"><img src="../Images/85f00c03a94fa4011fd8cf7f10a23a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/0*1kNGSnq7FX-oybkM.png"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae ke" href="http://docs.aws.amazon.com" rel="noopener ugc nofollow" target="_blank">http://docs.aws.amazon.com</a></figcaption></figure><p id="167f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">最后一步是解密数据。下图说明了这一点。</p><figure class="ms mt mu mv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nj"><img src="../Images/439d9f9918df610f8d66e17049de9a14.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/0*EVHcJoaQ1TbpnocW.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae ke" href="http://docs.aws.amazon.com" rel="noopener ugc nofollow" target="_blank">http://docs.aws.amazon.com</a></figcaption></figure><p id="9eef" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">下面显示了使用AES-CBC对我们上面加密的数据进行解密的示例代码。</p><pre class="ms mt mu mv fq na nb nc nd aw ne dt"><span id="f9b1" class="md kg hu nb b fv nf ng l nh ni"><strong class="nb hv">function </strong>decryptAES(key, buffer) {<br/>    <strong class="nb hv">const </strong>algorithm = 'AES-256-CBC';<br/><br/>    <strong class="nb hv">const </strong>iv = <strong class="nb hv">new </strong>Buffer('00000000000000000000000000000000', 'hex');<br/><br/>    encryptor = crypto.createDecipheriv(algorithm, key, iv);<br/>    encryptor.write(buffer);<br/>    encryptor.end();<br/><br/>    <strong class="nb hv">return </strong>encryptor.read();<br/>}</span></pre><p id="a307" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">下面是使用信封加密对字符串进行加密和解密的代码片段。</p><pre class="ms mt mu mv fq na nb nc nd aw ne dt"><span id="0629" class="md kg hu nb b fv nf ng l nh ni">generateDataKey()<br/>    .then(data =&gt; {<br/>        <strong class="nb hv">const </strong>cipherTextBlob = encryptAES(data.Plaintext, <strong class="nb hv">new </strong>Buffer('abc', 'utf-8'));<br/>        <strong class="nb hv">for </strong>(<strong class="nb hv">let </strong>i = 0; i &lt; data.Plaintext.length; i++) {<br/>            data.Plaintext[i] = <strong class="nb hv">null</strong>;<br/>        }<br/>        decrypt(data.CiphertextBlob)<br/>            .then(key =&gt;    {<br/>                <strong class="nb hv">const </strong>dataBuffer = decryptAES(key, cipherTextBlob);<br/>                console.log(dataBuffer.toString('utf-8'));<br/>            });<br/>    });</span></pre><h2 id="8502" class="md kg hu bd kh me mf mg kl mh mi mj kp jr mk ml kt jv mm mn kx jz mo mp lb mq dt translated">加密上下文</h2><p id="0253" class="pw-post-body-paragraph jg jh hu ji b jj ld jl jm jn le jp jq jr lf jt ju jv lg jx jy jz lh kb kc kd hn dt translated">除了所有这些AWS，KMS还提供了对加密上下文的支持，以进一步增强安全性。使用加密上下文可以缓解一些安全问题。要了解更多关于加密上下文以及如何使用它的信息，请点击<a class="ae ke" href="http://docs.aws.amazon.com/kms/latest/developerguide/encryption-context.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="6582" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">好了，我们到终点了。这是一篇相当长的文章。但是我希望你能从中学到一些东西。现在是你检查AWS KMS的时候了！！！</p><figure class="ms mt mu mv fq iv"><div class="bz el l di"><div class="nm my l"/></div></figure></div></div>    
</body>
</html>