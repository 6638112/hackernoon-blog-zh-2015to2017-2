<html>
<head>
<title>Cheap Broken Tool Detection for Haas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Haas的廉价破损刀具检测</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/if-youve-got-an-older-machine-that-doesn-t-have-macros-or-a-probe-and-you-need-to-detect-broken-8da7d249825f?source=collection_archive---------6-----------------------#2017-01-22">https://medium.com/hackernoon/if-youve-got-an-older-machine-that-doesn-t-have-macros-or-a-probe-and-you-need-to-detect-broken-8da7d249825f?source=collection_archive---------6-----------------------#2017-01-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="5078" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你有一台没有宏或探针的旧机器，你需要检测坏了的工具，下面是如何做的。</p><h1 id="eb7e" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">基本思想</h1><p id="4132" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">在工作台上安装一个限位开关，并将其位置保存为工作偏移量。将该开关连接到您的一个M21–25继电器和M-Fin引脚。每当你想检查一个损坏的刀具时，让你的程序调用一个子程序，该子程序快速到达开关，按下开关，并触发一个M21，这将使机器等待M-Fin信号。如果按下开关，它会立即看到信号，并继续它的快乐之路。如果工具坏了，它会一直等到你来修理。这就是概述。以下是详细情况:</p><h1 id="c459" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">开关</h1><p id="98ba" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">你需要一个IP67等级的常开限位开关，这样你就可以用冷却剂喷洒它。我用的是Automation Direct的<a class="ae ks" href="https://www.automationdirect.com/adc/Shopping/Catalog/Sensors_-z-_Encoders/Limit_Switches/Compact_Limit_Switches_(AEM2G_Series)/Metal_Plunger_Actuator/AEM2G11X11-3" rel="noopener ugc nofollow" target="_blank">这个</a>。我加工了一块安装在桌子上，并用螺栓固定在远处的角落。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/953010a58c065ad2bb3f21d1fa94dd2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pt2qVq0w95P94ABWpO5bMw.jpeg"/></div></div><figcaption class="lf lg fg fe ff lh li bd b be z ek">The position at which a tool will press the switch is saved as a work offset so you can send the tool to X0 Y0 Z0.</figcaption></figure><p id="cb82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了设置开关，将按钮闭合触点的点保存为工作偏移，这样您可以将<a class="ae ks" href="https://hackernoon.com/tagged/tool" rel="noopener ugc nofollow" target="_blank">工具</a>带到X-Zero Y-Zero Z-Zero进行触发。这个开关应该重复到0.002”，但为了安全起见，我将Z零点设置为开关闭合点以下的0.005”。</p><p id="fc1b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了让机器不会吃掉电线，我使用了<a class="ae ks" href="https://www.amazon.com/gp/product/B00IYFOIRO/ref=s9_acsd_zgift_hd_bw_b16rhT_c_x_w?pf_rd_m=ATVPDKIKX0DER&amp;pf_rd_s=merchandised-search-9&amp;pf_rd_r=M5BHE05YVGPPSBZ8Z18E&amp;pf_rd_t=101&amp;pf_rd_p=18bf1809-501b-5b2c-ab7e-0653f9f1ed66&amp;pf_rd_i=16412731" rel="noopener ugc nofollow" target="_blank">这些方便的磁铁钩</a>粘在外壳的内部(我可能会尝试通过一个夹在吊环螺栓上的铁锁来运行它们，以便更容易运行新电缆或修改设置):</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff lj"><img src="../Images/d98e5bed975d1db6368674595a5aa105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SvJZJOSm1LpC-_x3RPaIzQ.jpeg"/></div></div></figure><h1 id="7a58" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">给开关接线</h1><p id="71de" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">说到电线，这对我来说是可怕的部分，因为在此之前，我从来没有把任何电线连接到<a class="ae ks" href="https://hackernoon.com/tagged/haas" rel="noopener ugc nofollow" target="_blank">哈斯</a>控制器上。我的机器有一个M功能端口，我认为是用于哈斯索引器。它使用一个4针DIN连接器，但我身边没有这样的连接器，所以我打开了橱柜，剪下了那些电线(如果我想的话，以后再重新连接就很容易了)。在你把它全部弄乱之前，这里是接线的样子:</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div class="fe ff lk"><img src="../Images/7daa1d5d09f2f496a426b0525910331a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*Rdgr3DHPZcaYFkffr0xxtw.png"/></div><figcaption class="lf lg fg fe ff lh li bd b be z ek">The wiring as Haas intended it.</figcaption></figure><p id="d1f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接好开关后应该是这样的:</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div class="fe ff lk"><img src="../Images/5af3c23de902685882121fa69b7bb1d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*7Gmro-AoNaXbGoBMiZwVvg.jpeg"/></div><figcaption class="lf lg fg fe ff lh li bd b be z ek">The wiring as hacks like us intended it. If you need the M-Function port you can wire it up to retain this functionality. You’d just use another M-relay for the broken tool switch. It’s okay for multiple sources to fire the M-Fin signal.</figcaption></figure><h1 id="f60f" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">代码</h1><p id="9aeb" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">所以一旦你把所有东西都连接好了，你就需要告诉机器做你的破损检测。这涉及三个部分:</p><ol class=""><li id="d96f" class="ll lm hu it b iu iv iy iz jc ln jg lo jk lp jo lq lr ls lt dt translated">您的子程序</li><li id="b884" class="ll lm hu it b iu lu iy lv jc lw jg lx jk ly jo lq lr ls lt dt translated">你的零件程序</li><li id="61e7" class="ll lm hu it b iu lu iy lv jc lw jg lx jk ly jo lq lr ls lt dt translated">你的后处理器</li></ol><h2 id="69a6" class="lz jq hu bd jr ma mb mc jv md me mf jz jc mg mh kd jg mi mj kh jk mk ml kl mm dt translated">您的子程序</h2><pre class="ku kv kw kx fq mn mo mp mq aw mr dt"><span id="11b6" class="lz jq hu mo b fv ms mt l mu mv">O02030      (Tool Breakage Detection)<br/>G53 G0 Z0.  (retract Z to safe level)<br/>G129        (set Tool probe Work Offset)<br/>M5          (make sure spindle is stopped)<br/>M9          (turn off coolant)<br/>G0 X0. Y0.  (go to switch)<br/>G0 Z.25     (rapid close to switch)<br/>M8          (turn on coolant to blast chips away)<br/>G1 Z0. F10. (slowly press switch)<br/>M9          (turn off coolant)<br/>M21         (waits for M-Fin signal)<br/>G53 G0 Z0.  (retract Z to safe level)<br/>M99         (back to part program)<br/>%</span></pre><h2 id="e2be" class="lz jq hu bd jr ma mb mc jv md me mf jz jc mg mh kd jg mi mj kh jk mk ml kl mm dt translated">你的零件程序</h2><p id="fa7a" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">每当您想要检测一个损坏的工具时，您需要您的gcode看起来像下面的代码。您只需调用检测子程序，然后在调用子程序之前重置先前的工作偏移量。</p><pre class="ku kv kw kx fq mn mo mp mq aw mr dt"><span id="8a17" class="lz jq hu mo b fv ms mt l mu mv">M98 P02030   (Call your subprogram)<br/>G112         (Make sure to reinstitute your prior work offset)</span></pre><h2 id="d752" class="lz jq hu bd jr ma mb mc jv md me mf jz jc mg mh kd jg mi mj kh jk mk ml kl mm dt translated">你的后处理器</h2><p id="4e66" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">我使用Fusion 360进行CAM，因此这些说明就是为了这个目的。请记住，我在这方面是一个超级新手，所以采取这些指示与一个强烈的警告，做自己的尽职调查。这对我有效，但对你可能无效。</p><p id="4d4f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Fusion 360允许您打开特定工具的中断控制。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div class="fe ff mw"><img src="../Images/43b677f8b43124930da2b1e65736520b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*OehwdIY9RmOtu5fbWXlvDg.png"/></div></figure><p id="00a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我修改了通用哈斯邮报。这是我摆弄它之前的样子。对我来说，这个块从第1889行开始:</p><pre class="ku kv kw kx fq mn mo mp mq aw mr dt"><span id="e1fe" class="lz jq hu mo b fv ms mt l mu mv">case COMMAND_BREAK_CONTROL:<br/>    if (!toolChecked) { // avoid duplicate COMMAND_BREAK_CONTROL<br/>      onCommand(COMMAND_STOP_SPINDLE);<br/>      onCommand(COMMAND_COOLANT_OFF);<br/>      writeBlock(<br/>        gFormat.format(65),<br/>        "P" + 9853,<br/>        "T" + toolFormat.format(tool.number),<br/>        "B" + xyzFormat.format(0),<br/>        "H" + xyzFormat.format(properties.toolBreakageTolerance)<br/>      );<br/>      toolChecked = true;<br/>    }</span></pre><p id="e4b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我把它改成了:</p><pre class="ku kv kw kx fq mn mo mp mq aw mr dt"><span id="e85b" class="lz jq hu mo b fv ms mt l mu mv">case COMMAND_BREAK_CONTROL:<br/>    if (!toolChecked) { // avoid duplicate COMMAND_BREAK_CONTROL<br/>      onCommand(COMMAND_STOP_SPINDLE);<br/>      onCommand(COMMAND_COOLANT_OFF);<br/>      writeBlock(mFormat.format(98), "P" + "02030");<br/>      if (currentWorkOffset &lt; 6) {writeBlock(gFormat.format(53 + currentWorkOffset));<br/>      } else {<br/>      {writeBlock(gFormat.format(103 + currentWorkOffset));<br/>      }<br/>      }<br/>      toolChecked = true;<br/>    }</span></pre><p id="f060" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一些解释:这只是在刀具检查应该去的地方插入子程序调用，然后用当前的工作偏移量跟踪它。我的机器喜欢G54-G59和G110-G129，因此if语句只是寻找Fusion 360的WCS偏移，并输出正确的范围。如果你使用G154偏移，你会想要重写那部分。</p><h1 id="f618" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">最后</h1><p id="42b1" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">原来如此。如果你有任何改进的想法，请告诉我。这在我的平面铣刀上不起作用，因为它只在中心点检测，但是你可以在子程序中建立一些逻辑来为某些刀具偏移X-0Y-0。祝你好运。</p><div class="ku kv kw kx fq ab cb"><figure class="mx ky my mz na nb nc paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mx ky my mz na nb nc paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mx ky my mz na nb nc paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nd ne nf"><p id="f922" class="ir is ng it b iu iv iw ix iy iz ja jb nh jd je jf ni jh ji jj nj jl jm jn jo hn dt translated"><a class="ae ks" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ks" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ks" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae ks" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is ng it b iu iv iw ix iy iz ja jb nh jd je jf ni jh ji jj nj jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ks" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ks" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff nk"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="ku kv kw kx fq ky"><div class="bz el l di"><div class="nl nm l"/></div></figure></div></div>    
</body>
</html>