<html>
<head>
<title>A Serverless GraphQL Blog in 60 Seconds with OpenFaaS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenFaaS在60秒内完成一个无服务器的GraphQL博客</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-serverless-graphql-blog-in-60-seconds-with-openfaas-aaedd566b1f3?source=collection_archive---------5-----------------------#2017-09-23">https://medium.com/hackernoon/a-serverless-graphql-blog-in-60-seconds-with-openfaas-aaedd566b1f3?source=collection_archive---------5-----------------------#2017-09-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="ecf9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于我在上一篇文章(<a class="ae jp" rel="noopener" href="/statuscode/integrating-openfaas-and-graphql-experimental-1870bd22f2a">“集成OpenFaaS和GraphQL”</a>)中已经集成了GraphQL和<a class="ae jp" href="https://www.openfaas.com/" rel="noopener ugc nofollow" target="_blank"> OpenFaaS </a>，我接下来想做的是将其与数据库集成。所以我想把数据保存到存储器中。数据库可以是任何东西，但是这次我选择了<a class="ae jp" href="https://www.arangodb.com/" rel="noopener ugc nofollow" target="_blank"> ArangoDB </a>。这就是建筑的样子。你可以在<a class="ae jp" href="https://github.com/kenfdev/openfaas-graphql-blog" rel="noopener ugc nofollow" target="_blank">kenf dev/open FAAS-graph QL-blog</a>中找到这个项目的代码。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/7b3801048143d1ca9218355a5e7413b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*3LIbXmZytUezx8UrUXIywQ.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">OpenFaaS + GraphQL + ArangoDB</figcaption></figure><p id="1fdb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面的视频展示了我在这个架构上取得的成就。(有些部分快进)</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="kc kd l"/></div></figure><p id="cfbf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我希望每个人都能轻松地创建这个环境，所以我选择了Docker Swarm作为编排工具。只需点击几个命令，就可以使用graphql博客了。当然，你可以选择你自己的编排工具，这里<a class="ae jp" href="https://github.com/alexellis/faas/blob/master/community.md#third-party-integrations--openfaas-providers" rel="noopener ugc nofollow" target="_blank">列出了</a>，但这与本文的主题无关。</p><h1 id="74df" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">GraphQL博客</h1><p id="75fa" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">这项服务的灵感来自于<a class="ae jp" href="https://github.com/serverless/serverless-graphql-blog" rel="noopener ugc nofollow" target="_blank">server less/server less-graph QL-blog</a>，但它并不依赖于AWS。此外，它缺少实体之间的一些关系(afaik ),所以我添加了一些。所以这个graphql博客可以:</p><ul class=""><li id="ae4e" class="lh li hu it b iu iv iy iz jc lj jg lk jk ll jo lm ln lo lp dt translated">创造一个作者</li><li id="764f" class="lh li hu it b iu lq iy lr jc ls jg lt jk lu jo lm ln lo lp dt translated">为作者创建帖子</li><li id="d20e" class="lh li hu it b iu lq iy lr jc ls jg lt jk lu jo lm ln lo lp dt translated">为帖子创建评论</li><li id="9cc4" class="lh li hu it b iu lq iy lr jc ls jg lt jk lu jo lm ln lo lp dt translated">查询作者</li><li id="2cf1" class="lh li hu it b iu lq iy lr jc ls jg lt jk lu jo lm ln lo lp dt translated">查询帖子及其评论</li></ul><p id="dae2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我还没有为这个GraphQL博客捆绑一个前端，所以你需要一个像<code class="eh lv lw lx ly b">GraphiQL</code>这样的客户端来查询服务器(你可以在这里找到一个<a class="ae jp" href="https://github.com/skevy/graphiql-app" rel="noopener ugc nofollow" target="_blank"/>)。</p><h1 id="1512" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">试试看！</h1><p id="4df8" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">如果你想尝试这个项目，你可以从这里开始。我假设你了解Docker，并且已经安装了它。在你克隆了<a class="ae jp" href="https://github.com/kenfdev/openfaas-graphql-blog" rel="noopener ugc nofollow" target="_blank">项目</a>之后，点击</p><pre class="jr js jt ju fq lz ly ma mb aw mc dt"><span id="126e" class="md kf hu ly b fv me mf l mg mh">docker swarm init</span></pre><p id="13b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并通过执行<code class="eh lv lw lx ly b">deploy_stack.sh</code>部署堆栈。部署成功后，arangodb需要几秒钟时间准备接收请求。投票<code class="eh lv lw lx ly b">http://localhost:8529</code>直到你看到arangodb的登录表单。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/cb9cfbd090495d8054f2a97e10780fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*975uFoUPMyCuGO1tZba5ng.png"/></div></figure><p id="96f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，您需要准备数据库和集合。可以在项目中找到<code class="eh lv lw lx ly b">arango/setup_database.sh</code>。执行这个命令，您就可以使用GraphQL博客了。顺便可以从OpenFaaS的gateway UI查看功能。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="fe ff mj"><img src="../Images/cd66db33fe651997941d65148f4ba3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0OoCydy-jNl6mvtdDGARdQ.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">GraphQL Blog Function via OpenFaaS</figcaption></figure><h1 id="6ffd" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">创造一个作者</h1><p id="e503" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">您可以通过使用<code class="eh lv lw lx ly b">createAuthor</code>突变来创建一个作者。</p><pre class="jr js jt ju fq lz ly ma mb aw mc dt"><span id="f22e" class="md kf hu ly b fv me mf l mg mh">mutation {<br/>  createAuthor(name: "Jane") {<br/>    id<br/>    name<br/>  }<br/>}</span></pre><p id="6eff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">响应应该是这样的(记住<code class="eh lv lw lx ly b">id</code>，因为您稍后会用到它):</p><pre class="jr js jt ju fq lz ly ma mb aw mc dt"><span id="b870" class="md kf hu ly b fv me mf l mg mh">{<br/>  "data": {<br/>    "createAuthor": {<br/>      "id": "4350",<br/>      "name": "Jane"<br/>    }<br/>  }<br/>}</span></pre><h1 id="3d68" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">创建帖子</h1><p id="9388" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">你可以通过使用<code class="eh lv lw lx ly b">createPost</code>突变来创建一个帖子。</p><pre class="jr js jt ju fq lz ly ma mb aw mc dt"><span id="bc9f" class="md kf hu ly b fv me mf l mg mh">mutation {<br/>  createPost(title: "Some Sample Post", bodyContent: "This is a sample post", author: "4350") {<br/>    id<br/>    title<br/>    bodyContent<br/>    author {<br/>      name<br/>    }<br/>    comments {<br/>      id<br/>    }<br/>  }<br/>}</span></pre><p id="8d61" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">回应会是这样的(也记住这个<code class="eh lv lw lx ly b">id</code>):</p><pre class="jr js jt ju fq lz ly ma mb aw mc dt"><span id="15aa" class="md kf hu ly b fv me mf l mg mh">{<br/>  "data": {<br/>    "createPost": {<br/>      "id": "4849",<br/>      "title": "Some Sample Post",<br/>      "bodyContent": "This is a sample post",<br/>      "author": {<br/>        "name": "Jane"<br/>      },<br/>      "comments": []<br/>    }<br/>  }<br/>}</span></pre><h1 id="b9a6" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">给帖子添加评论</h1><p id="a229" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">你可以通过<code class="eh lv lw lx ly b">createComment</code>突变给帖子添加评论。为此，你需要一个作者<code class="eh lv lw lx ly b">id</code>和一个帖子<code class="eh lv lw lx ly b">id</code>。</p><pre class="jr js jt ju fq lz ly ma mb aw mc dt"><span id="1b5f" class="md kf hu ly b fv me mf l mg mh">mutation {<br/>  createComment(content: "This is a comment", author: "4350", post: "4849") {<br/>    id<br/>    content<br/>    author {<br/>      name<br/>    }<br/>  }<br/>}</span></pre><p id="0e05" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">答案是这样的:</p><pre class="jr js jt ju fq lz ly ma mb aw mc dt"><span id="6b87" class="md kf hu ly b fv me mf l mg mh">{<br/>  "data": {<br/>    "createComment": {<br/>      "id": "5018",<br/>      "content": "This is a comment",<br/>      "author": {<br/>        "name": "Jane"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><h1 id="b2d7" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">质疑帖子</h1><p id="c2da" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">现在我们有了一篇文章和这篇文章的评论，让我们通过<code class="eh lv lw lx ly b">posts</code>查询来查询它。</p><pre class="jr js jt ju fq lz ly ma mb aw mc dt"><span id="5621" class="md kf hu ly b fv me mf l mg mh">query {<br/>  posts(authorId: "4350") {<br/>    id<br/>    title<br/>    bodyContent<br/>    author {<br/>      name<br/>    }<br/>    comments {<br/>      content<br/>      author {<br/>        name<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="5cce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">答案会是:</p><pre class="jr js jt ju fq lz ly ma mb aw mc dt"><span id="114e" class="md kf hu ly b fv me mf l mg mh">{<br/>  "data": {<br/>    "posts": [<br/>      {<br/>        "id": "4849",<br/>        "title": "Some Sample Post",<br/>        "bodyContent": "This is a sample post",<br/>        "author": {<br/>          "name": "Jane"<br/>        },<br/>        "comments": [<br/>          {<br/>            "content": "This is a comment",<br/>            "author": {<br/>              "name": "Jane"<br/>            }<br/>          }<br/>        ]<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="1780" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">很酷不是吗？一个无服务器的GraphQL博客在近60秒内启动！</p><h1 id="a447" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">下一步是什么…</h1><p id="8fa1" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">我们现在有了一个工作的无服务器GraphQL博客。但是我们还没有深入研究OpenFaaS的好处。在下一篇文章中，我将研究这个函数在出现请求高峰时是如何伸缩的。</p><p id="78a7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="mo">如果你对OpenFaaS感兴趣，请给</em><a class="ae jp" href="https://github.com/alexellis/faas" rel="noopener ugc nofollow" target="_blank"><em class="mo">GitHub repo</em></a><em class="mo">一颗</em> <strong class="it hv"> <em class="mo">星</em> </strong> <em class="mo">以示支持！</em></p></div></div>    
</body>
</html>