<html>
<head>
<title>Angular Pro Tip: How to dynamically create components in </title></head><body>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>


<h1 class="translated">Angular Pro提示:如何在中动态创建组件</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/angular-pro-tip-how-to-dynamically-create-components-in-body-ba200cc289e6?source=collection_archive---------0-----------------------#2017-06-24">https://medium.com/hackernoon/angular-pro-tip-how-to-dynamically-create-components-in-body-ba200cc289e6?source=collection_archive---------0-----------------------#2017-06-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/348e746f3ec3449a5ee06ad6696e6db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hYmsOB52L4fxv0i5WN8IBA.png"/></div></div></figure><p id="9c50" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">更新:</strong>我写了另一篇博文，解释了如何使用棱角分明的CDK的门户来实现完全相同的结果。请看一看<a class="ae ka" href="https://hackernoon.com/a-first-look-into-the-angular-cdk-67e68807ed9b" rel="noopener ugc nofollow" target="_blank">吧</a>。如果你对魔术不感兴趣，想知道如何从头开始，那么请继续阅读这篇文章。</p></div><div class="ab cl kb kc hc kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hn ho hp hq hr"><h1 id="846f" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated"><strong class="ak">给我看看代码</strong></h1><p id="6372" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">如果你有点像我，你只是想看看代码，你会弄明白，所以你去吧。下面的服务只有一个简单的方法<code class="eh ll lm ln lo b">appendComponentToBody</code>,它将把你的组件作为body的直接子组件添加到Angular的组件树中(这样它就可以包含在Angular的变化检测周期中)。<strong class="je hv">见本帖末尾的working plunker。</strong></p><figure class="lp lq lr ls fq iv"><div class="bz el l di"><div class="lt lu l"/></div></figure><h1 id="4b71" class="ki kj hu bd kk kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf dt translated"><strong class="ak">酷，但是，见鬼那是什么？</strong></h1><p id="a2ca" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">如果您是在检查完代码后到达这里的，那么这意味着您需要对要点中发生的事情进行一些解释。</p><h2 id="102f" class="ma kj hu bd kk mb mc md ko me mf mg ks jn mh mi kw jr mj mk la jv ml mm le mn dt translated">一点背景知识</h2><p id="554b" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">我第一次遇到这个问题是在不久前，当时我试图将模态添加到我的web应用程序中。我找不到好的文档来动态地将组件添加到我的文档主体中。一些备选方案建议在<code class="eh ll lm ln lo b">app.component.html</code>级别添加<em class="mo">助手</em>组件作为宿主容器，一些其他方案建议将<code class="eh ll lm ln lo b">app.component.ts</code>中的<code class="eh ll lm ln lo b">viewRef</code>传递给定制服务，以便<code class="eh ll lm ln lo b">app-root</code>可以在以后用作锚，等等。不过，我都不喜欢。然后我前往ng-conf寻找答案，并向Jeremy Elbourn (@jelbourn)询问了这个问题，他向我指出了Angular Material中的几个实用类。</p><h2 id="1fd4" class="ma kj hu bd kk mb mc md ko me mf mg ks jn mh mi kw jr mj mk la jv ml mm le mn dt translated">导航角材料</h2><p id="8f07" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">简单地说，角材料回购是<strong class="je hv">一个好资源</strong>地狱。如果你真的想了解如何构建健壮且编写良好的角度组件，你应该每天都学习:<a class="ae ka" href="https://github.com/angular/material2" rel="noopener ugc nofollow" target="_blank">https://github.com/angular/material2</a>。</p><p id="8875" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">不过，我花了一段时间才明白它们是如何将组件附加到主体上的。他们从一堆文件中调用一堆方法，但我在这里为你分解它。让我们直接开始吧。</p><h1 id="b110" class="ki kj hu bd kk kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf dt translated">分解要点</h1><p id="aaf6" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">再次检查代码片段，并查看注释中的数字。我将使用这些数字进行解释。</p><h2 id="e4be" class="ma kj hu bd kk mb mc md ko me mf mg ks jn mh mi kw jr mj mk la jv ml mm le mn dt translated"><strong class="ak"> 1。创建组件参考</strong></h2><p id="be58" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">使用<code class="eh ll lm ln lo b">ComponentFactoryResolver</code>创建组件的引用。因为您将把您的组件添加到<code class="eh ll lm ln lo b">AppRef</code>(参见步骤2)，所以您需要使用构造函数中提供的Angular的默认注入器来创建这个组件。</p><p id="dde3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">请注意</strong>此时，您可以使用<code class="eh ll lm ln lo b">componentRef</code>将数据绑定到组件的输入，如<code class="eh ll lm ln lo b">componentRef.instance.myInput = 'yay!'</code>。</p><h2 id="cd9d" class="ma kj hu bd kk mb mc md ko me mf mg ks jn mh mi kw jr mj mk la jv ml mm le mn dt translated">2.将组件附加到应用程序参考</h2><p id="430e" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">在这一点上，你有了一个对你的组件的引用，但是它还没有生活在Angular的世界里。该组件不在ng组件树中，因此Angular不会对其运行更改检测。为了允许对我们的组件进行变更检测，我们应该将它附加到<code class="eh ll lm ln lo b">ApplicationRef</code>。</p><h2 id="7c5c" class="ma kj hu bd kk mb mc md ko me mf mg ks jn mh mi kw jr mj mk la jv ml mm le mn dt translated">3.从组件引用中获取DOM元素</h2><p id="dfef" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">我们快到了。我们有一个<code class="eh ll lm ln lo b">componentRef</code>，它也生活在Angular的世界里。现在，我们希望看到它在页面中呈现，为此，我们必须将DOM元素从组件中取出。代码非常冗长，无法让TypeScript理解我们想要实现的目标，但基本上，我们这样做是为了获取组件的DOM元素:<code class="eh ll lm ln lo b">componentRef.hostView.rootnodes[0]</code>。</p><h2 id="1014" class="ma kj hu bd kk mb mc md ko me mf mg ks jn mh mi kw jr mj mk la jv ml mm le mn dt translated">4.追加组件主体</h2><p id="71ba" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated"><strong class="je hv">TL；dr</strong>使用我们在步骤3中得到的DOM元素。</p><p id="69ea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">关于这个</strong>的一些备注。据说Angular是一个平台，在服务器、网络工作者、移动设备(？)，等等。但是，话虽如此，我还是很难找到一个用例，在这个用例中，动态创建的组件必须呈现在服务器端或其他上下文中。我不知道它在Ionic中如何工作，但可以肯定的是有一个父anchor DOM元素，你可以用<code class="eh ll lm ln lo b">body</code>替换它来实现这个功能。</p><h2 id="3218" class="ma kj hu bd kk mb mc md ko me mf mg ks jn mh mi kw jr mj mk la jv ml mm le mn dt translated">5.(可选)用核武器摧毁它</h2><p id="c45a" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">这让您知道如何通过两步来移除组件:</p><ol class=""><li id="af13" class="mp mq hu je b jf jg jj jk jn mr jr ms jv mt jz mu mv mw mx dt translated">将视图从<code class="eh ll lm ln lo b">ApplicationRef</code>上拆下，这样Angular就不会进行变化检测。</li><li id="f348" class="mp mq hu je b jf my jj mz jn na jr nb jv nc jz mu mv mw mx dt translated">销毁组件参考。这将自动从文档中移除DOM元素。</li></ol><p id="935b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">非常重要:</strong>您必须在主模块声明中将您的组件添加到<code class="eh ll lm ln lo b">entryComponents</code>中。这将允许Angular动态创建组件。</p></div><div class="ab cl kb kc hc kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hn ho hp hq hr"><p id="a22d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">干活的扑通:【https://plnkr.co/edit/Yc1ijM6shHt2JAPi7Fdg】T22</strong></p><p id="98b7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">使用这种方法的角插件:</strong>【https://github.com/jdjuan/ng-notyf T2】</p></div><div class="ab cl kb kc hc kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hn ho hp hq hr"><p id="0ef2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你喜欢，就表现出你的爱。留下评论。请通过Twitter @caroso1222联系我。</p><figure class="lp lq lr ls fq iv"><div class="bz el l di"><div class="nd lu l"/></div></figure></div></div>    

</body></html>