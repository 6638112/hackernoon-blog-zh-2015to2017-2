<html>
<head>
<title>Creating an Elm Native module for currency formatting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为货币格式创建Elm本机模块</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/creating-an-elm-native-module-for-currency-formatting-c9800e57a908?source=collection_archive---------6-----------------------#2017-02-25">https://medium.com/hackernoon/creating-an-elm-native-module-for-currency-formatting-c9800e57a908?source=collection_archive---------6-----------------------#2017-02-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="f180" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">埃尔姆的很多东西都很好，但偶尔你会发现一个缺口。对我来说，货币格式化就是这样一个缺口。如果你需要处理不同的地区和不同的货币，这就够烦人的了。Javascript有一个完美的api来实现这一点，它就是<a class="ae jp" href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Number/toLocaleString" rel="noopener ugc nofollow" target="_blank"> toLocaleString </a>函数。</p><p id="06ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Elm有一个未记录的特性叫做本地模块，允许您直接调用javascript函数。当然，这是一个坏主意，很容易重新引入您试图避免的所有类型混乱和运行时错误。但是在这种情况下，这似乎是合理的——为什么要重新发明一个完美的api呢？</p><p id="5131" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我能找到的关于如何做这个的<a class="ae jp" href="https://github.com/eeue56/take-home/wiki/Writing-your-first-Elm-Native-module" rel="noopener ugc nofollow" target="_blank">信息有点过时了，这就是为什么我写了如何在Elm 0.18中做的原因。</a></p><h1 id="f400" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">创建一个普通的Elm模块</h1><p id="0fa9" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">第一步是创建一个普通的Elm模块来公开您的函数。</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="4884" class="lc jr hu ky b fv ld le l lf lg">module Utils.CurrencyFormat exposing (format)</span><span id="a664" class="lc jr hu ky b fv lh le l lf lg">--this is where we import the native module<br/>import Native.CurrencyFormat</span><span id="6001" class="lc jr hu ky b fv lh le l lf lg">format : String -&gt; String -&gt; number -&gt; String<br/>format culture currency num =<br/>    let<br/>        res =<br/>            Native.CurrencyFormat.format culture currency num<br/>    in<br/>        case res of<br/>            Ok str -&gt;<br/>                str</span><span id="54ef" class="lc jr hu ky b fv lh le l lf lg">            Err err -&gt;<br/>                let<br/>                    _ =<br/>                        Debug.log "CurrencyFormatError" err<br/>                in<br/>                toString num</span></pre><h1 id="81e5" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">创建您的本机js文件</h1><p id="79ec" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">接下来创建一个名为/src/Native/CurrencyFormat.js的js文件。现在，再一次，这是<em class="li">不安全</em>所以尽你所能使这个js函数防弹。</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="2f87" class="lc jr hu ky b fv ld le l lf lg">var _user$project$Native_CurrencyFormat = (function () {</span><span id="dfcc" class="lc jr hu ky b fv lh le l lf lg">    var format = function(cultureCode, currency, num) {<br/>        try {<br/>            var result = num.toLocaleString(cultureCode, {style: 'currency', currency: currency});<br/>            return {<br/>                ctor: "Ok",<br/>                _0: result<br/>            };<br/>        } catch (e) {<br/>            return {<br/>                ctor: "Err",<br/>                _0: e.message<br/>            };<br/>        }<br/>    };<br/>    return {<br/>        format: F3(format)<br/>    };<br/>})();</span></pre><p id="0a70" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将向Elm公开这个函数，以便从我们在第一步中创建的模块中调用。注意一些事情:如果我们给它错误的输入，toLocaleString可能会失败。为此，我们将调用包装在try catch中，并通过提供Ok或Err的构造函数将结果作为Elm(结果字符串)返回。我们可以选择将结果传递给调用代码，或者在我们的实用函数中处理它，就像我已经做的那样，只记录它并返回一个普通的字符串数字。这取决于这个错误对你来说有多重要。</p><p id="9585" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第二件要注意的事情是，我将返回的函数包装在对一个神秘的F3函数的调用中。我在这里猜测了一点，但是我很确定这确保了函数被适当地定制，这样部分应用程序将在Elm端按预期工作。</p><h1 id="79ab" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">配置您的应用程序以允许本机模块</h1><p id="3488" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">对您的elm-package.json文件做如下小小的修改</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="d978" class="lc jr hu ky b fv ld le l lf lg">{<br/>    "version": "1.0.0",<br/>    "summary": "",<br/>    "repository": "<a class="ae jp" href="https://github.com/user/project.git" rel="noopener ugc nofollow" target="_blank">https://github.com/user/project.git</a>",<br/>    "license": "BSD3",<br/>    "source-directories": [<br/>        "./client/elm"<br/>    ],<br/>    <strong class="ky hv">"native-modules": true,</strong><br/>    "exposed-modules": [],<br/>    "dependencies": {<br/>        "elm-lang/core": "5.0.0 &lt;= v &lt; 6.0.0",<br/>        "elm-lang/html": "2.0.0 &lt;= v &lt; 3.0.0",<br/>        "elm-lang/http": "1.0.0 &lt;= v &lt; 2.0.0"<br/>    },<br/>    "elm-version": "0.18.0 &lt;= v &lt; 0.19.0"<br/>}</span></pre><h1 id="070b" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">像平常一样消耗你的功能</h1><p id="f447" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">如果你做的一切都正确，你的函数应该像一个普通的Elm函数一样工作。它甚至会像任何其他Elm函数一样支持自动currying。尝试一下…</p><pre class="kt ku kv kw fq kx ky kz la aw lb dt"><span id="1eed" class="lc jr hu ky b fv ld le l lf lg">toCurrency : number -&gt; String<br/>toCurrency =<br/>    Currency.format "en" "GBP"</span></pre><p id="e768" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我认为在某些有限的情况下，这是一个很好的解决方案。但是请注意，这是一个没有文档记录的特性，它可以随时改变和被破坏，所以使用它要自担风险。</p><blockquote class="lj lk ll"><p id="6f0d" class="ir is li it b iu iv iw ix iy iz ja jb lm jd je jf ln jh ji jj lo jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is li it b iu iv iw ix iy iz ja jb lm jd je jf ln jh ji jj lo jl jm jn jo hn dt translated">要了解更多信息，请<a class="ae jp" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">阅读我们的“关于”页面</a>、<a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上点赞/给我们发消息</a>，或者简单地说，<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is li it b iu iv iw ix iy iz ja jb lm jd je jf ln jh ji jj lo jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote></div></div>    
</body>
</html>