<html>
<head>
<title>How I (sort of) got around the Google Maps API results limit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何(在某种程度上)绕过谷歌地图API结果限制的</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-i-sort-of-got-around-the-google-maps-api-results-limit-1c673e66ef36?source=collection_archive---------1-----------------------#2016-10-21">https://medium.com/hackernoon/how-i-sort-of-got-around-the-google-maps-api-results-limit-1c673e66ef36?source=collection_archive---------1-----------------------#2016-10-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="90a4" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">在JavaScript中使用闭包的一个实际例子</h2></div><p id="f09f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">前一阵子我在找一份网页开发员的工作时，我到处寻找巴黎所有网页代理的名单。我想比较它们中的每一个，并在网上搜索一个我从未找到的详细而详尽的列表。</p><p id="462d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">所以除了自己做，我看不到别的解决办法。我开始想知道在网上哪里可以很容易地找到这些机构，而不会迷失在谷歌搜索的500多万个结果中。</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="759a" class="kn ko hu bd kp kq kr ks kt ku kv kw kx js ky kz la jw lb lc ld ka le lf lg lh dt translated">Googles Places是一个在任何给定地区通过关键词找到企业的好方法</h2><p id="5b66" class="pw-post-body-paragraph jj jk hu jl b jm li iv jo jp lj iy jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">我意识到，几乎每个网络机构在谷歌地图上都被称为一个地方。你猜怎么着？<a class="ae kf" href="https://developers.google.com/maps/" rel="noopener ugc nofollow" target="_blank">谷歌地图API </a>，更确切地说是<a class="ae kf" href="https://developers.google.com/places/" rel="noopener ugc nofollow" target="_blank">谷歌地点API </a>，可以让你做各种令人惊奇的事情，包括用关键词过滤器搜索地点，获取地点的名称，以及相应的网址、照片和用户评级。</p><p id="9c64" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果我能找到一种方法，使用Google Places获取尽可能多的巴黎地区的结果，很大一部分工作就会自动完成，并为我节省大量宝贵的时间。</p><p id="521d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">剧透:</strong>我设法得到了巴黎地区的186个结果，我知道这实际上并不是网络代理的总数(其中一些没有在Google Places上注册，其他的出于未知原因根本没有出现在结果中)，但这让我发现了一些有趣的结果，否则我不会发现这些结果。看起来是这样的:</p><p id="4ed2" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">地图:</strong></p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff ln"><img src="../Images/5e5770d82fb9b859925862037db4594a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3pE4HJK-kbQo8gVLYtGVwA.png"/></div></div><figcaption class="lz ma fg fe ff mb mc bd b be z ek">Web agencies in Paris</figcaption></figure><p id="3b5b" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv">列表(节选):</strong></p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff ln"><img src="../Images/cddc05ed12aaec7626f0c6451664e46a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Ga2GHvcHRC_pigWaADZ5Q.png"/></div></div><figcaption class="lz ma fg fe ff mb mc bd b be z ek">Data fetched from Google Places</figcaption></figure><p id="c46e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jl hv"> Google Places API </strong>似乎拥有了我所需要的一切:一旦搜索完成并返回结果，<a class="ae kf" href="https://developers.google.com/places/web-service/details" rel="noopener ugc nofollow" target="_blank"> Place Details request </a>允许你获取每个地方的名称、网址、照片和评级。我希望能够通过员工数量来评估每个机构的规模，但是嘿。</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="70fb" class="kn ko hu bd kp kq kr ks kt ku kv kw kx js ky kz la jw lb lc ld ka le lf lg lh dt translated">开始搜索</h2><p id="4dcc" class="pw-post-body-paragraph jj jk hu jl b jm li iv jo jp lj iy jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">我在localhost上建立了一个项目(稍后我需要使用PHP将结果写入一个文件中)，并遵循<a class="ae kf" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a> API文档来启动地图(在这里获取它<a class="ae kf" href="https://developers.google.com/maps/documentation/javascript/tutorial" rel="noopener ugc nofollow" target="_blank">，并发出一个雷达搜索请求(在这里</a><a class="ae kf" href="https://developers.google.com/places/web-service/search" rel="noopener ugc nofollow" target="_blank">获取它</a>):</p><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="md me l"/></div></figure><p id="f8ad" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">文本搜索或附近的搜索请求可以让您直接访问所需的响应参数，但有一个主要限制:每个查询最多返回20个结果。每次搜索可以返回多达60个结果，分布在三个页面上，这意味着您可以调用一个<strong class="jl hv"> next_page_token </strong>数据，并得到一个<strong class="jl hv">总计60个结果</strong>，但随后您就被卡住了。</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="e337" class="kn ko hu bd kp kq kr ks kt ku kv kw kx js ky kz la jw lb lc ld ka le lf lg lh dt translated">避开60个结果的查询限制</h2><p id="cf63" class="pw-post-body-paragraph jj jk hu jl b jm li iv jo jp lj iy jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated"><strong class="jl hv">雷达搜索</strong>请求可以让你一次搜索多达<strong class="jl hv"> 200个地方</strong>，但是比通常从文本搜索或附近搜索请求返回的细节要少。你基本上得到每个地方的ID，但没有更多的细节，甚至没有一个名字。</p><p id="6d0c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这意味着您必须遍历您的结果，通过传递您找到的每个地点的ID来调用<a class="ae kf" href="https://developers.google.com/places/web-service/details" rel="noopener ugc nofollow" target="_blank">地点详细信息请求</a>。Place Details请求是返回我们寻找的所有参数的地方。</p><p id="5c36" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将发生在我们的<code class="eh mf mg mh mi b">service.radarSearch</code>函数的回调中:</p><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="md me l"/></div></figure><p id="f3a1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这部分有效。虽然总数是186，但是我<strong class="jl hv">通过循环结果只得到10个详细的结果</strong>。这是为什么呢？</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><h2 id="fd40" class="kn ko hu bd kp kq kr ks kt ku kv kw kx js ky kz la jw lb lc ld ka le lf lg lh dt translated">避开每秒10次查询的限制:<code class="eh mf mg mh mi b">setTimeout</code>和闭包</h2><p id="99b8" class="pw-post-body-paragraph jj jk hu jl b jm li iv jo jp lj iy jr js lk ju jv jw ll jy jz ka lm kc kd ke hn dt translated">嗯，地点详细信息请求的问题是它让你每秒只能查询<em class="mj">10个结果</em>。代码的执行用时不到一秒，所以看起来我们在这里碰壁了，不是吗？</p><p id="a2bc" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果我们使用<code class="eh mf mg mh mi b">setTimeout</code>函数每秒查询一个结果，因此永远不会达到每秒10个结果的限制，会怎么样？</p><p id="7d42" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">for循环中使用的setTimeout函数是JavaScript中意外行为的典型例子<a class="ae kf" rel="noopener" href="/@shyamseshadri/the-5-types-of-js-developers-i-find-in-interviews-225bd547c421#.7sm5bg578">。</a></p><p id="ae8f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这就是<strong class="jl hv">闭包</strong>对有很大帮助的地方<a class="ae kf" rel="noopener" href="/@lenafaure/how-to-use-javascript-closures-with-confidence-85cd1f841a6b">，它允许我们存储186个结果中找到的每个值，并将它们存储在<code class="eh mf mg mh mi b">agencies</code>数组中以备后用:</a></p><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="md me l"/></div></figure><p id="091d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最后，完整的JavaScript代码片段是:</p><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="md me l"/></div></figure><p id="66c8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我现在可以用它来获取我想要的结果并使用数据，结果看起来很有趣:</p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff mk"><img src="../Images/eb09da9ddadbce43220784fe5eb67404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*uEaKefe0MFjPtWa_NfO5Pw.gif"/></div></div><figcaption class="lz ma fg fe ff mb mc bd b be z ek">Fetching one result / second</figcaption></figure><p id="1748" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">当然，这对于实时应用程序来说是行不通的，但是对于获取我想要查找的特定地点的数据来说，这非常有用:)</p></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><p id="b7d7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">想了解更多关于JavaScript的基础知识吗？查看我的其他文章:</p><ul class=""><li id="1dcd" class="ml mm hu jl b jm jn jp jq js mn jw mo ka mp ke mq mr ms mt dt translated"><a class="ae kf" href="https://hackernoon.com/hoisting-in-javascript-a-quick-guide-cc4d9597bbd7" rel="noopener ugc nofollow" target="_blank"><strong class="jl hv">JavaScript中的吊装:快速指南</strong> </a></li><li id="f056" class="ml mm hu jl b jm mu jp mv js mw jw mx ka my ke mq mr ms mt dt translated"><a class="ae kf" href="https://hackernoon.com/understand-javascript-variable-scope-with-ease-221a6d41dc43" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hv">轻松理解JavaScript变量作用域</strong> </a></li><li id="c791" class="ml mm hu jl b jm mu jp mv js mw jw mx ka my ke mq mr ms mt dt translated"><a class="ae kf" href="https://hackernoon.com/get-your-head-around-this-73c23653b102" rel="noopener ugc nofollow" target="_blank"><strong class="jl hv"/></a>搞清楚“这个”</li><li id="71c6" class="ml mm hu jl b jm mu jp mv js mw jw mx ka my ke mq mr ms mt dt translated"><a class="ae kf" rel="noopener" href="/@lenafaure/how-to-use-javascript-closures-with-confidence-85cd1f841a6b"> <strong class="jl hv">如何自信地使用JavaScript闭包</strong> </a></li><li id="3d58" class="ml mm hu jl b jm mu jp mv js mw jw mx ka my ke mq mr ms mt dt translated"><a class="ae kf" href="https://hackernoon.com/grasp-by-value-and-by-reference-in-javascript-7ed75efa1293" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hv">掌握JavaScript </strong> </a>中的“按值”和“按引用”</li></ul></div><div class="ab cl kg kh hc ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hn ho hp hq hr"><p id="4729" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我希望你喜欢这篇文章，随时评论并喜欢这篇文章，以便其他人可以在媒体上轻松找到它！</p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><a href="http://eepurl.com/dvio9L"><div class="fe ff mz"><img src="../Images/3183c9cfe7a8644bc0a59d2e3e57fa27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*td_Zl-oX7vl2kIsoldqcLA.png"/></div></a></figure><div class="lo lp lq lr fq ab cb"><figure class="na ls nb nc nd ne nf paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="na ls nb nc nd ne nf paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="na ls nb nc nd ne nf paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="ng nh ni"><p id="f922" class="jj jk mj jl b jm jn iv jo jp jq iy jr nj jt ju jv nk jx jy jz nl kb kc kd ke hn dt translated"><a class="ae kf" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿美族家庭的一员。我们现在<a class="ae kf" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kf" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jj jk mj jl b jm jn iv jo jp jq iy jr nj jt ju jv nk jx jy jz nl kb kc kd ke hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kf" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kf" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lo lp lq lr fq ls fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff nm"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure><figure class="lo lp lq lr fq ls"><div class="bz el l di"><div class="nn me l"/></div></figure></div></div>    
</body>
</html>