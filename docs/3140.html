<html>
<head>
<title>Remote-DOM aka Virtual Virtual DOM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">远程DOM又名虚拟虚拟DOM</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/remote-dom-aka-virtual-virtual-dom-479c6d88de54?source=collection_archive---------12-----------------------#2017-03-15">https://medium.com/hackernoon/remote-dom-aka-virtual-virtual-dom-479c6d88de54?source=collection_archive---------12-----------------------#2017-03-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="eca7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">浏览器中的信任是一件要么全有要么全无的事情，你要么在主UI线程上的主文档中运行一段JavaScript，访问DOM的每个全局或任何部分，要么在一个隔离的环境中运行它要么在iframe中被限制在一个小矩形框中，要么在WebWorker中根本不能直接影响UI。</p><p id="ab93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我想要更多，使用多个iframes会使网站变慢，它迫使浏览器多次解析/编译/评估相同的JavaScript源，并使你的UI包含在这些小盒子里…</p><p id="212e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我希望能够编写React组件，运行它们而不必信任它们的代码，并让它们绘制到同一个DOM。我找到了一个不错的开源库<a class="ae jp" href="https://github.com/web-perf/react-worker-dom" rel="noopener ugc nofollow" target="_blank"> react-worker-dom </a>，并开始对它进行修补。</p><p id="b30a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">React-Worker-DOM是对React的一个重大修改，由两个互补的部分组成。一个是您实际的React代码所在的位置，在这里，应该接触DOM的每一行都被修改了，因此它最终会将来自WebWorker的消息发送回主框架。另一半，解释这些消息，将它们应用到DOM &amp;监听事件，以相反的方向将它们发送回来。</p><p id="85f0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该项目的重点是通过WebWorker在不同的线程中运行大部分代码的性能优势，它工作得非常好。虽然它不支持我需要的一些功能，如可插拔传输层和多租户，但这些功能相对容易添加，我甚至努力将代码移植到较新的React 0.14，以了解跟上较新的React版本有多难。</p><p id="4c35" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我几乎可以说服自己这个解决方案已经足够好了，但是当一个朋友真的问我它是否足够好到可以用在生产中时，我犹豫了，它很复杂，修复其中的bug很困难，要把它移植到React a mornight的新版本中。我知道使用它意味着让自己不断努力去维护一些不可维护的东西…</p><p id="04fb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">很久以前我就发现，当事情变得困难时，通常意味着我做错了。必须有一种更理智的方式来获得我们需要的利益，而不要不断地耗费我的时间和快乐。很多软件工程都是关于学习在不同的拼图块之间画出边界线，手头的任务有什么独特之处，什么应该被重用，什么应该被抛弃。</p><p id="2435" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我走了很长一段路，试图找到解决问题的替代方法，然后我突然想到了这个问题。我需要一些对聚合填充或修补更稳定的东西，而React是一个移动太快的目标，我必须从等式中删除React。只留下浏览器DOM API本身，React几乎只写DOM而不做任何读取，我所要做的就是提供一个facade，提供React期望的一小组浏览器API，我可以获得所有的好处，而无需修改React的一行代码，因此<a class="ae jp" href="https://github.com/wix/remote-dom" rel="noopener ugc nofollow" target="_blank"> Remote-DOM </a>诞生了。</p><p id="5e61" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Remote-DOM是一个很小的库，只有不到1k行代码，分为远程和本地两部分。远程部分向其他库提供浏览器外观、虚拟窗口和文档，让它们使用它们知道并期望浏览器提供的API，如document . createelement window . addevent listener等，而没有任何实际的DOM，并将这些命令作为JSONs发送回本地部分。库的本地部分解释JSON，并真正创建DOM节点和添加事件侦听器，当事件发生时，它会将其信息作为JSON发送回远程端，要连接它们，您需要做的只是为它们提供一种相互通信的方法。</p><p id="27ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种方法的一个显著限制是，因为通信总线是异步的，所以有些事情不能透明地完成，不能读取DOM节点的offsetHeight并期望它的值在那里，也不能在事件循环中响应事件，为了减轻这一点，我添加了一个新的本地调用概念，这是一个在库的本地DOM端定义的动词小字典，可以从远程端调用。例如，这允许您在移动safari中点击播放视频，而浏览器不会播放视频，除非它在事件循环中被触发。</p><p id="251a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">那么你能用它做什么呢？通过从主UI线程中移除React来获得性能，构建真正分布式的广告网络，除了远程dom库之外，不需要在浏览器中运行任何代码，因此可以流畅地连接到许多广告提供商， 或者可能只是可能创造React的下一个进化步骤——使用React的服务器端渲染是很棒的，但是在HTML加载和所有客户端代码完全准备好之间的时间里，你有一个不响应用户事件的静态网站，如果我们改变它，使服务器使用remote-dom渲染并继续处理用户交互直到客户端准备好，这时客户端将获得redux存储的快照并切换到处理事件本身……但这是另一篇文章的故事； )</p><p id="2992" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不管怎样，它已经发布了，而且是开源的(感谢<a class="ae jp" href="https://github.com/wix" rel="noopener ugc nofollow" target="_blank"> Wix </a>)，玩得开心。</p><blockquote class="jq jr js"><p id="b738" class="ir is jt it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is jt it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">要了解更多信息，请<a class="ae jp" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">阅读我们的“关于”页面</a>、<a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上点赞/给我们发消息</a>，或者简单地说，<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is jt it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote></div></div>    
</body>
</html>