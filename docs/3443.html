<html>
<head>
<title>Yubl’s road to Serverless — Part 1, Overview</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Yubl的无服务器之路—第1部分，概述</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/yubls-road-to-serverless-part-1-overview-ca348370acde?source=collection_archive---------2-----------------------#2017-04-02">https://medium.com/hackernoon/yubls-road-to-serverless-part-1-overview-ca348370acde?source=collection_archive---------2-----------------------#2017-04-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><h1 id="a6bb" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">这条路到此为止</h1><p id="c8a4" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">第1部分:<a class="ae kn" rel="noopener" href="/@theburningmonk/yubls-road-to-serverless-part-1-overview-ca348370acde">概述</a></p><p id="211d" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">第2部分:<a class="ae kn" rel="noopener" href="/@theburningmonk/yubls-road-to-serverless-part-2-testing-and-ci-cd-72b2e583fe64">测试和持续交付策略</a></p><p id="5c21" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">第三部:<a class="ae kn" href="https://hackernoon.com/yubls-road-to-serverless-part-3-ops-6c82139bb7ee" rel="noopener ugc nofollow" target="_blank"> ops </a></p><p id="cd1c" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">第4部分:<a class="ae kn" href="https://hackernoon.com/yubls-road-to-serverless-part-4-building-a-scalable-push-notification-system-62b38924ed61" rel="noopener ugc nofollow" target="_blank">构建可伸缩的推送通知系统</a></p><p id="bf4a" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">第5部分:<a class="ae kn" href="https://hackernoon.com/yubls-road-to-serverless-part-5-building-better-recommendations-with-lambda-bigquery-and-1d74407f3b3a" rel="noopener ugc nofollow" target="_blank">建立一个更好的推荐系统</a></p><p id="5df6" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">自从<a class="ae kn" href="http://theburningmonk.com/2016/11/yubl-a-sad-end-to-a-wonderful-journey/" rel="noopener ugc nofollow" target="_blank"> Yubl的关闭</a>以来，有相当多的人询问我们最终采用的无服务器架构，以及我们在这一过程中学到的一些东西。</p><p id="acbc" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">因此，这是我分享我们学到的一些经验的系列文章的第一篇。但是，请记住这一特定领域的变化速度，这样我们遇到的一些挑战/问题可能在您阅读本文时已经解决了。</p><p id="547e" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">ps。我在2016年<em class="kt"> Leetspeak </em>上关于<em class="kt"> Amazon Lambda </em>的演讲中已经涉及了这个系列的很多方面，你可以在这里找到演讲的幻灯片和录音<a class="ae kn" href="http://theburningmonk.com/2016/11/slides-and-recording-of-my-lambda-talk-at-leetspeak-2016/" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="2341" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">从整体开始</h1><p id="ea2b" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">当我在4月份加入Yubl时，我继承了一个运行在EC2实例上的单片<strong class="jr hv"> Node.js </strong>后端，混合了<strong class="jr hv"> MongoLab </strong>(托管<strong class="jr hv"> MongoDB </strong>)和<strong class="jr hv"> CloudAMQP </strong>(托管<strong class="jr hv"> RabbitMQ </strong>)。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/28bcd15c679d7dda0961508f600cedbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/0*K_QaT22tQZ69Y0s0."/></div></figure><p id="ec44" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">这个遗留系统有许多问题，有些可以通过增量更改(例如蓝绿部署)来纠正，但其他的需要在架构级别上重新思考。虽然事情在纸面上看起来很简单(在架构图级别)，但所有的复杂性都隐藏在这3个服务中，天哪，原来如此复杂！</p><p id="373f" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">我的首要任务是与运营团队合作，改进现有的部署渠道，并起草一份我们希望从我们的架构中获得的特性列表:</p><ul class=""><li id="2809" class="lc ld hu jr b js ko jw kp ka le ke lf ki lg km lh li lj lk dt translated"><strong class="jr hv">能够进行小规模的增量部署</strong></li><li id="4be8" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated"><strong class="jr hv">部署应该快速，并且不需要停机</strong></li><li id="fc97" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated"><strong class="jr hv">无锁定步骤部署</strong></li><li id="7560" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated"><strong class="jr hv">功能可以独立部署</strong></li><li id="9137" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated"><strong class="jr hv">功能通过消息松散耦合</strong></li><li id="f61e" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated"><strong class="jr hv">将未使用资源的成本降至最低</strong></li><li id="cb07" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated"><strong class="jr hv">最大限度减少运营工作量</strong></li></ul><p id="9584" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">从这里开始，我们决定采用面向服务的架构，考虑到我们的工作负载，Amazon Lambda似乎是一个完美的工具:</p><ul class=""><li id="fa79" class="lc ld hu jr b js ko jw kp ka le ke lf ki lg km lh li lj lk dt translated">大量API，全HTTPS，没有超低延迟要求</li><li id="8f6b" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">许多后台任务，其中许多有软实时的要求(如发布帖子到追随者的时间线)</li></ul><h1 id="ddc8" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">到无服务器端</h1><p id="5f96" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">可以说，我们知道迁移将是一条漫长的道路，沿途会有许多挑战，我们希望循序渐进地完成迁移，并逐步提高交付速度。</p><blockquote class="lq lr ls"><p id="15b3" class="jp jq kt jr b js ko ju jv jw kp jy jz lt kq kc kd lu kr kg kh lv ks kk kl km hn dt translated">“从订货到有人说谢谢的时间是唯一重要的声誉衡量标准”</p><p id="4a64" class="jp jq kt jr b js ko ju jv jw kp jy jz lt kq kc kd lu kr kg kh lv ks kk kl km hn dt translated">丹·诺斯</p></blockquote><p id="6d5c" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">迁移的第一步是让遗留系统发布系统中的状态变化(例如，用户加入，用户A跟随用户B，等等)。)以便我们可以在遗留系统的基础上开始构建新的功能。</p><p id="ae90" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">为此，我们更新了遗留系统，将事件发布到<strong class="jr hv"> <em class="kt"> Kinesis </em> </strong>流。</p><p id="dcd2" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">我们的总体战略是:</p><ul class=""><li id="748e" class="lc ld hu jr b js ko jw kp ka le ke lf ki lg km lh li lj lk dt translated">在这些事件的基础上构建新的特性，这些特性通常有自己的数据存储(如<strong class="jr hv"><em class="kt">【DynamoDB】</em></strong><em class="kt"/><strong class="jr hv"><em class="kt">cloud search</em></strong><em class="kt"/><strong class="jr hv"><em class="kt">S3</em></strong><em class="kt"/><strong class="jr hv"><em class="kt">big query</em></strong><em class="kt"/>等)。)以及后台处理管道和API</li><li id="0065" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">将遗留系统中的现有特性/概念提取到并行运行的服务中</li><li id="6741" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">这些新服务最初将由同一个共享的<strong class="jr hv"> <em class="kt"> MongoLab </em> </strong>数据库支持</li><li id="3312" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">其他服务(包括遗留服务)被更新为使用手工制作的API客户端通过新的API访问封装的资源，而不是直接访问共享的<strong class="jr hv"> <em class="kt"> MongoLab </em> </strong>数据库</li><li id="ad79" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">一旦通过新的API完成了对这些资源的所有访问，数据迁移(通常是到<strong class="jr hv"> <em class="kt"> DynamoDB </em> </strong>表)将在后台开始</li><li id="fcac" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">只要有可能，对现有API端点的请求都会被转发到新的API，这样我们就不必等待iOS和Android应用的更新(这可能需要数周时间),并且可以更早地获得好处</li></ul><p id="08b8" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">经过6个月的努力工作，我的6名后端工程师团队(包括我自己)彻底改造了我们的后端基础设施。亚马逊对我们与Lambda一起做的工作印象非常深刻，当Yubl在我们主要股东的心血来潮下被关闭时，我们正在撰写我们工作的案例研究。</p><p id="cbbd" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">这是我们最终得到的架构的几乎完整的图片(为了简洁和清晰，省略了一些细节)。</p><figure class="kv kw kx ky fq kz fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff lw"><img src="../Images/6fcd9704c4c65b97f63a491bb12c0465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4Jipys3ne27i6GK9."/></div></div></figure><p id="8211" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">一些有趣的数据:</p><ul class=""><li id="490d" class="lc ld hu jr b js ko jw kp ka le ke lf ki lg km lh li lj lk dt translated">生产中运行的170个Lambda函数</li><li id="2834" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">大约1GB的总部署包大小(在<a class="ae kn" href="http://theburningmonk.com/2016/08/aws-lambda-janitor-lambda-function-to-clean-up-old-deployment-packages/" rel="noopener ugc nofollow" target="_blank">管理员λ</a>清除未引用的版本之后)</li><li id="b1fc" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">对于同等计算量，Lambda的成本约为EC2的5%</li><li id="cd5e" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">生产部署的数量从4月的9个/月增加到9月的155个</li></ul><p id="29a1" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">在本系列的其余部分，我将深入探讨具体的功能，我们如何利用各种AWS服务，以及我们如何应对以下挑战:</p><ul class=""><li id="fbea" class="lc ld hu jr b js ko jw kp ka le ke lf ki lg km lh li lj lk dt translated">集中伐木</li><li id="a5a0" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">集中式配置管理</li><li id="09f9" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">用于Lambda函数的具有相关id的分布式跟踪</li><li id="a682" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">保持Lambda函数温暖，以避免冷启动损失</li><li id="fb1d" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">自动扩展不能动态扩展的AWS资源</li><li id="2895" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">自动清理旧的Lambda函数版本</li><li id="1b1b" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">保护敏感数据(如mongodb连接字符串、服务凭证等)。)</li></ul><h1 id="b020" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">链接</h1><ul class=""><li id="c4ed" class="lc ld hu jr b js jt jw jx ka mb ke mc ki md km lh li lj lk dt translated"><a class="ae kn" href="http://theburningmonk.com/2016/11/slides-and-recording-of-my-lambda-talk-at-leetspeak-2016/" rel="noopener ugc nofollow" target="_blank">我在Leetspeak的亚马逊Lambda演讲的幻灯片和录音</a></li><li id="246e" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated"><a class="ae kn" href="http://theburningmonk.com/2016/08/aws-lambda-janitor-lambda-function-to-clean-up-old-deployment-packages/" rel="noopener ugc nofollow" target="_blank">清理旧部署包的看门人-Lambda函数</a></li></ul></div><div class="ab cl me mf hc mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="hn ho hp hq hr"><p id="c832" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">喜欢您正在阅读的内容，但需要更多帮助？我很乐意作为独立顾问<strong class="jr hv">提供我的服务</strong>并帮助您完成您的无服务器项目——架构审查、代码审查、构建概念验证，或者提供关于领先实践和工具的建议。</p><p id="e3d4" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">我在<strong class="jr hv">伦敦，英国</strong>，目前唯一在英国的<a class="ae kn" href="https://aws.amazon.com/developer/community/heroes/yan-cui/" rel="noopener ugc nofollow" target="_blank"> <strong class="jr hv"> AWS无服务器英雄</strong> </a>。我有近<strong class="jr hv"> 10年</strong>的<a class="ae kn" href="https://www.linkedin.com/in/theburningmonk/" rel="noopener ugc nofollow" target="_blank">经验</a>在AWS中大规模运行生产工作负载。我主要在英国开展业务，但我愿意出差一周以上。要了解我们如何合作，请在这里告诉我更多关于您试图解决的问题的信息。</p><p id="fa31" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">我还可以举办一个内部研讨会，帮助您的无服务器架构进入生产准备阶段。您可以在这里找到关于为期两天的研讨会<a class="ae kn" href="https://theburningmonk.com/workshops/" rel="noopener ugc nofollow" target="_blank">的更多信息，该研讨会将带您从AWS Lambda的基础知识一直到日志聚合、分发跟踪和安全最佳实践的通用操作模式。</a></p><p id="2399" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">如果你喜欢按照自己的进度学习，那么你也可以找到与我为曼宁制作的<a class="ae kn" href="https://bit.ly/production-ready-serverless" rel="noopener ugc nofollow" target="_blank"><strong class="jr hv"/></a>视频课程相同的研讨会内容。我们将讨论的主题包括:</p><ul class=""><li id="27e5" class="lc ld hu jr b js ko jw kp ka le ke lf ki lg km lh li lj lk dt translated">认证<em class="kt"> &amp; </em>授权与API网关<em class="kt"> &amp; </em>认知</li><li id="cb0f" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">本地测试<em class="kt"> &amp; </em>运行功能</li><li id="25ea" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">CI/CD</li><li id="3af2" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">日志聚合</li><li id="649a" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">监控最佳实践</li><li id="8c34" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">X射线分布式跟踪</li><li id="8d1b" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">跟踪相关id</li><li id="880c" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">性能<em class="kt"> &amp; </em>成本优化</li><li id="1377" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">错误处理</li><li id="916b" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">配置管理</li><li id="8f57" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">金丝雀部署</li><li id="5d40" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">VPC</li><li id="908b" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">安全</li><li id="a387" class="lc ld hu jr b js ll jw lm ka ln ke lo ki lp km lh li lj lk dt translated">Lambda、Kinesis和API网关的最佳实践</li></ul><p id="2e68" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">代码<strong class="jr hv"> ytcui </strong>也可以获得<strong class="jr hv">票面价格6折优惠</strong>。不过，这个数字只有在我们参加曼宁的早期访问计划(MEAP)时才有效。</p></div></div>    
</body>
</html>