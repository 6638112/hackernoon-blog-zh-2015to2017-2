<html>
<head>
<title>How To Automatically Register All Models In Django Admin?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Django Admin中自动注册所有型号？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/automatically-register-all-models-in-django-admin-django-tips-481382cf75e5?source=collection_archive---------3-----------------------#2017-11-24">https://medium.com/hackernoon/automatically-register-all-models-in-django-admin-django-tips-481382cf75e5?source=collection_archive---------3-----------------------#2017-11-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="097c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">内置的<a class="ae jp" href="https://docs.djangoproject.com/en/1.11/ref/contrib/admin/" rel="noopener ugc nofollow" target="_blank">管理界面</a>是Django最强大的&amp;流行特性之一。一旦我们创建了模型，我们需要向管理界面注册它们，以便它可以读取元数据并为它填充界面。</p><p id="b3ae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果Django项目有太多的模型，或者如果它有一个遗留数据库，那么将所有这些模型添加到admin中就变成了一项单调乏味的任务。为了自动化这个过程，我们可以以编程方式获取项目中的所有模型，并在管理界面中注册它们。</p><p id="320f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">打开admin.py文件并将此代码添加到其中。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="f79a" class="jz ka hu jv b fv kb kc l kd ke">from django.apps import apps<br/><br/><br/>models = apps.get_models()<br/><br/>for model in models:<br/>    admin.site.register(model)</span></pre><p id="ba47" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将获取所有应用程序中的所有模型，并在管理界面中注册它们。</p><p id="feb1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们自动注册所有的模型，这就很好了。然而，如果我们单独注册一些定制的模型，并试图再次注册我们应用程序中的所有模型，将会出现冲突，因为Django不允许注册同一个模型两次。</p><p id="a019" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，我们需要确保这段代码运行在<code class="eh kf kg kh jv b">admin.py</code>文件的末尾，它应该忽略已经注册的模型。我们可以将这段代码添加到admin.py文件的末尾。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="28ba" class="jz ka hu jv b fv kb kc l kd ke">from django.apps import apps</span><span id="6db8" class="jz ka hu jv b fv ki kc l kd ke">from book.models import Book<br/></span><span id="ea11" class="jz ka hu jv b fv ki kc l kd ke">class BookAdmin(admin.ModelAdmin):<br/>    list_display = ('name', 'author')</span><span id="f9c7" class="jz ka hu jv b fv ki kc l kd ke"><em class="kj"># model registered with custom admin<br/>admin.site.register(Book, BookAdmin)</em></span><span id="9a70" class="jz ka hu jv b fv ki kc l kd ke"># all other models<br/>models = apps.get_models()<br/><br/>for model in models:<br/>    try:<br/>        admin.site.register(model)<br/>    except admin.sites.AlreadyRegistered:<br/>        pass</span></pre><p id="9fd0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，手动注册的模型将首先注册，然后自动注册剩余的模型。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="1731" class="jz ka hu jv b fv kb kc l kd ke"><strong class="jv hv">class </strong>Book(models.Model):<br/>    name = models.CharField<strong class="jv hv"><em class="kj">(</em></strong>max_length=100<strong class="jv hv"><em class="kj">)<br/>    </em></strong>author = models.ForeignKey<strong class="jv hv"><em class="kj">(</em></strong>Author, null=True<strong class="jv hv"><em class="kj">)<br/>    </em></strong>borrowed = models.CharField<strong class="jv hv"><em class="kj">(</em></strong>max_length=100, default=<strong class="jv hv">''<em class="kj">)<br/><br/>    </em>def </strong>__str__(self):<br/>        <strong class="jv hv">return </strong>self.name</span></pre><p id="c9d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们去一个管理模型页面，自动注册的模型只会显示这样一列。</p><figure class="jq jr js jt fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff kk"><img src="../Images/77787b183869d3542afdb9063ade5a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SmDcI7g9pymsqZTKowj-fg.png"/></div></div><figcaption class="ks kt fg fe ff ku kv bd b be z ek">django-admin</figcaption></figure><p id="3c37" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于想要查看数据的用户来说，这个界面并不提供信息。为了改进这一点，我们可以创建一个<code class="eh kf kg kh jv b">ListAdminMixin</code>，它将用模型中的所有字段填充<code class="eh kf kg kh jv b">list_display</code>。</p><p id="bfa3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以创建一个新的管理类，它将子类化<code class="eh kf kg kh jv b">ListAdminMixin</code> &amp; <code class="eh kf kg kh jv b">ModelAdmin</code>。我们可以在注册模型时使用这个admin类，这样模型中的所有字段都会显示在admin中。</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="c503" class="jz ka hu jv b fv kb kc l kd ke">from django.apps import apps<br/>from django.contrib import admin<br/><br/><br/>class ListAdminMixin(object):<br/>    def __init__(self, model, admin_site):<br/>        self.list_display = [field.name for field in model._meta.fields]<br/>        super(ListAdminMixin, self).__init__(model, admin_site)<br/><br/><br/>models = apps.get_models()<br/>for model in models:<br/>    admin_class = type('AdminClass', (ListAdminMixin, admin.ModelAdmin), {})<br/>    try:<br/>        admin.site.register(model, admin_class)<br/>    except admin.sites.AlreadyRegistered:<br/>        pass</span></pre><p id="65b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，每当我们创建一个新的模型或添加一个新的字段到一个现有的模型，它会自动反映在管理。</p><figure class="jq jr js jt fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff kw"><img src="../Images/ad5daa12631a4777e4fde0937711006f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l22iJH4ERJetdFK8SoijqQ.png"/></div></div></figure><p id="b346" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这样，每当模型被添加到我们的应用程序时，我们可以避免向管理员注册模型。</p><p id="632e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — -</p><p id="0db6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kj">原载于2017年11月24日</em><a class="ae jp" href="https://avilpage.com/2017/11/django-tricks-auto-register-models-admin.html" rel="noopener ugc nofollow" target="_blank"><em class="kj">https://avilpage.com</em></a><em class="kj">。</em></p><p id="a8ab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">更多Django小贴士和技巧在<a class="ae jp" href="https://avilpage.com/tags/django.html" rel="noopener ugc nofollow" target="_blank">https://avilpage.com/tags/django.html</a></p><figure class="jq jr js jt fq kl"><div class="bz el l di"><div class="kx ky l"/></div></figure></div></div>    
</body>
</html>