<html>
<head>
<title>My holy grail: Connect Excel with LINQPad</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的圣杯:用LINQPad连接Excel</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/my-holy-grail-connect-excel-with-linqpad-fa05889c80d0?source=collection_archive---------4-----------------------#2017-03-07">https://medium.com/hackernoon/my-holy-grail-connect-excel-with-linqpad-fa05889c80d0?source=collection_archive---------4-----------------------#2017-03-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4471" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为<a class="ae jp" href="https://tessin.se/" rel="noopener ugc nofollow" target="_blank"> Tessin.se </a>的growth hacker和之前<a class="ae jp" href="https://offerta.se/" rel="noopener ugc nofollow" target="_blank"> Offerta.se </a>的CTO，我经常面临“用用户电子邮件获取这个Excel文件并从数据库中检索X，Y &amp; Z列”(比如名称或订单总值)形式的任务。</p><p id="08ae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我一直在寻找一种实用的解决方案，可以有效地做到这一点，而不必每次都编写自定义代码。经过几次迭代，我得出了以下结论:</p><p id="dbed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我是一个超级粉丝。Net便签本<a class="ae jp" href="https://www.linqpad.net/" rel="noopener ugc nofollow" target="_blank"> LINQPad </a>。这个应用程序使得使用C#和linq查询数据库变得非常简单。由于我更喜欢C#而不是VBA，这正是我想要用来解决问题的工具。</p><p id="1a63" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一次尝试是在LINQpad中编写一个脚本，打开一个XLS文件，从一列中读取输入值(email ),然后在其他列中输出结果。但是这不是很灵活。</p><p id="2ffe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对我来说，最大的愿望是有一种方法可以在Excel中创建特定的公式，接受电子邮件等输入，并从数据库中返回指定的值。</p><p id="17d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为此，我在LINQPad脚本中使用<a class="ae jp" href="http://nancyfx.org/" rel="noopener ugc nofollow" target="_blank"> Nancy Web Framework </a>创建了一个小型的自托管JSON REST服务:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/d7e08a014e37a660fe00c0a2f41f9481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oOReO6di8JJH-Krr0KMMYQ.png"/></div></div></figure><p id="3639" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">运行此脚本时，会在您的计算机上本地启动一个小型web服务:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff kc"><img src="../Images/bcb13f24c017cb57a4dd7bfc56dffdf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R3BV1jPOq7h5lTU2aPAKcA.png"/></div></div></figure><p id="341b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下一步是将这个REST API与Excel连接起来。为了做到这一点，我使用了一个我写的工具，叫做<a class="ae jp" href="http://seotoolsforexcel.com/" rel="noopener ugc nofollow" target="_blank"> SeoTools for Excel </a>。这是一个Excel插件(不是免费的，但有14天的试用期)，它有一堆对增长黑客有用的特性。对于这个解决方案，我使用<a class="ae jp" href="http://seotoolsforexcel.com/jsonpathonurl/" rel="noopener ugc nofollow" target="_blank"> JsonPathOnUrl </a>函数从我们编写的REST服务中获取JSON响应，并使用<a class="ae jp" href="http://goessner.net/articles/JsonPath/" rel="noopener ugc nofollow" target="_blank"> JSONPath </a>查询语言获取一部分结构:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="fe4f" class="ki kj hu ke b fv kk kl l km kn">=JsonPathOnUrl("<a class="ae jp" href="http://localhost:8090/user-by-email/" rel="noopener ugc nofollow" target="_blank">http://localhost:8090/user-by-email/</a>"&amp;A2;"firstName")</span></pre><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ko"><img src="../Images/fff5fa4c442780f388509e59cb94fea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ElsipHScJa9vOIsJ1mTi2g.png"/></div></div></figure><p id="b8ba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们可以很容易地得到我们需要的所有值。SeoTools负责缓存，这样同一个请求就不会被执行多次。Nancy REST服务可以根据您需要从数据库中检索的任何信息轻松地进行修改。这需要一点设置，但是一旦你安装并运行它，它就像一个魔咒一样工作。如果您不想使用SeoTools，找到VBA解决方案并不困难。</p><p id="0e13" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我有一个SOAP服务(LINQPad 4有一个SOAP驱动程序)想用Excel查询，我也会使用这种技术。我不是一个VBA球迷，所以如果我有任何需要脚本(字符串操作等)。)然后我用LINQPad的C#写这段代码就简单多了。</p><p id="548d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这绝对是我每天节省时间的十大生产力秘诀之一！请让我知道你的想法或你会如何解决这个问题。</p><h1 id="4c38" class="kp kj hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">LINQPad样板代码</h1><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lm ln l"/></div></figure><p id="13b6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您还需要将Nuget包<code class="eh lo lp lq ke b">Nancy.Hosting.Self</code>添加到LINQPad脚本中，并包含它的名称空间。</p><div class="jr js jt ju fq ab cb"><figure class="lr jv ls lt lu lv lw paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lr jv ls lt lu lv lw paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lr jv ls lt lu lv lw paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="lx ly lz"><p id="f922" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is ma it b iu iv iw ix iy iz ja jb mb jd je jf mc jh ji jj md jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff me"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>