# Groovy 有什么问题？

> 原文：<https://medium.com/hackernoon/what-is-wrong-with-groovy-482b7064f591>

![](img/26395224ed01b7b16a73fa3fb26acace.png)

我的一个朋友用头撞墙，因为这个很棒的代码。

让我们快速解释一下这是干什么的。

首先，我们创建一个空映射，然后我们定义一个作为字符串插值结果的键。关键会是`"job-4"`。

然后我们验证钥匙是否已经在地图上。如果地图没有键，我们用值`1`添加它，然后我们再次做同样的事情，但是只是这一次键会在地图上，什么都不会改变。键`"job-4"`的值应该保持不变，即值`1`。

我告诉你，我们都错了。实际上，`println(cache[key])`行将打印`2`。

这太疯狂了。！！所以我们研究了其他语言，看看其中是否有一种语言的行为方式与 Groovy 相同。

在 Ruby 中，我们做到了:

它像预期的那样打印出值`1`！

在 JavaScript 中，我们做到了:

它像预期的那样打印出值`1`！

在酏剂中，我们做到了:

它像预期的那样打印出值`1`！

在 Scala 中，我们做到了:

它像预期的那样打印出值`1`！

Groovy 怎么了！！！！？？？

问题来自 Groovy 管理动态类型和字符串插值的方式。

当 Groovy 进行字符串插值时，得到的类型是`GStringImpl`,这意味着比较不是您期望的方式。我们需要迫使`GStringImpl`成为`String`正在做的`.toString()`。

如果我们只做:

```
def key = "job-${4}".toString()
```

一切开始按预期工作。

# 结论

停止使用 Groovy！！！