<html>
<head>
<title>Easy JavaScript Evaluation on Windows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Windows上的简单JavaScript评估</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/easy-javascript-evaluation-on-windows-2b5af3af82d1?source=collection_archive---------14-----------------------#2017-01-02">https://medium.com/hackernoon/easy-javascript-evaluation-on-windows-2b5af3af82d1?source=collection_archive---------14-----------------------#2017-01-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0de3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在硬盘上创建一个包含以下内容的文本文件(JSEvaluate.wsc ):</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="a28e" class="jy jz hu ju b fv ka kb l kc kd">&lt;component&gt;<br/>&lt;public&gt;<br/>&lt;method name="Evaluate"&gt;<br/> &lt;PARAMETER name="code"/&gt;<br/>&lt;/method&gt;<br/>&lt;property name="Application"/&gt;<br/>&lt;property name="Global"/&gt;<br/>&lt;/public&gt;<br/>&lt;script language='JScript'&gt;</span><span id="77a3" class="jy jz hu ju b fv ke kb l kc kd">Global = this;</span><span id="8cba" class="jy jz hu ju b fv ke kb l kc kd">function Evaluate(code) {<br/> var result;<br/> try {<br/>  result=Global.eval(code);</span><span id="430e" class="jy jz hu ju b fv ke kb l kc kd">} catch(e) {</span><span id="080c" class="jy jz hu ju b fv ke kb l kc kd">result=e.message;</span><span id="e9cc" class="jy jz hu ju b fv ke kb l kc kd">}<br/> <br/> return result;<br/>}</span><span id="7a9e" class="jy jz hu ju b fv ke kb l kc kd">&lt;/script&gt;<br/>&lt;/component&gt;</span></pre><p id="1602" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在你有了一个可嵌入的JavaScript引擎，你可以从任何窗口的应用程序调用它。</p><p id="70ab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要测试，打开Excel/Word/Outlook/PowerPoint等。</p><p id="64a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们的例子中，我们将使用Excel。一旦加载了Excel，按ALT+F11打开VBA开发<a class="ae kf" href="https://hackernoon.com/tagged/tools" rel="noopener ugc nofollow" target="_blank">工具</a>:</p><figure class="jp jq jr js fq kh fe ff paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="fe ff kg"><img src="../Images/b552c509a05d61f0c1502c8e093294a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fz8SIXYPUHQ99tzyT5SILQ.jpeg"/></div></div></figure><p id="b0f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如上面的屏幕截图所示，访问新的JavaScript引擎就像通过调用COM GetObject函数实例化一个新对象一样简单。几乎所有Window的编程语言都以这样或那样的形式存在这种能力。</p><p id="0e39" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">既然我们已经能够动态地计算JavaScript表达式，我们可能希望与主机应用程序更紧密地集成，这样我们就可以通过脚本扩展它的特性。下面的代码片段说明了这是多么简单:</p><figure class="jp jq jr js fq kh fe ff paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="fe ff ko"><img src="../Images/77afaa6d0097715664ca85de55402538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X4rGqpAaNgVGDVfl5t-Xtw.jpeg"/></div></div></figure><p id="4d23" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">更进一步，我们可以创建一个新的Excel函数</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="cb45" class="jy jz hu ju b fv ka kb l kc kd">=Eval()</span></pre><p id="5667" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它提供了在本机Excel宏中执行JavaScript代码的能力。这可以通过在新的VBA模块中包含以下代码来实现，该模块可以是现有工作簿的一部分，也可以是PERSONAL.XSLB的一部分。在您的VBA代码中插入一个新模块，并添加以下代码:</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="d068" class="jy jz hu ju b fv ka kb l kc kd">Public JScript As Object</span><span id="7b1a" class="jy jz hu ju b fv ke kb l kc kd">Public Function Eval(code As String)<br/>    If JScript is Nothing Then<br/>        Set JScript = GetObject("script:c:\temp\jsevaluate.wsc")<br/>        Set JScript.Application = Excel.Application<br/>    End If<br/>    Eval = JScript.Evaluate(code)<br/>End Function</span></pre><p id="2071" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在开发环境中应该是这样的:</p><figure class="jp jq jr js fq kh fe ff paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="fe ff ko"><img src="../Images/6fef21ccdee5288662f2c42ac055e264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GawCAOsdkVp1Qs2Pmu-G5Q.jpeg"/></div></div></figure><p id="d8ec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您现在有了一个新的Excel函数(Eval ),可以在任何Excel公式中使用:</p><figure class="jp jq jr js fq kh fe ff paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="fe ff kp"><img src="../Images/eb792d62eb37444c75a81267b2cbc859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJjWfUblE8nHgLJSzijLUg.png"/></div></div></figure><p id="dcfa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，由于JavaScript引擎可以在Excel应用程序的全局上下文中访问它，所以您可以做一些非常复杂的事情，而这些事情很难在本地Excel公式中完成。事实上，您可以用JavaScript编写整个程序，并通过Excel公式进行访问。在下面的示例中，我们在列A中编写JavaScript代码片段，并在列B中使用我们的Eval公式对它们进行评估:</p><figure class="jp jq jr js fq kh fe ff paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="fe ff kp"><img src="../Images/76876f7fb3e5e5a4636e2713cea35787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MIusktQvSHrT7wS9R6LoCw.png"/></div></div></figure><p id="90f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，在我们的JavaScript引擎范围内，通过COM对象调用任何可用的本地函数的能力非常强大。这在上面的例子中通过</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="a622" class="jy jz hu ju b fv ka kb l kc kd">=Eval(A9)</span></pre><p id="fd75" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它调用外部网站来检索一些信息。</p><p id="cf19" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">期待大家的评论。</p><p id="483f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">干杯。</p><div class="jp jq jr js fq ab cb"><figure class="kq kh kr ks kt ku kv paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="kq kh kr ks kt ku kv paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="kq kh kr ks kt ku kv paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="kw kx ky"><p id="f922" class="ir is kz it b iu iv iw ix iy iz ja jb la jd je jf lb jh ji jj lc jl jm jn jo hn dt translated"><a class="ae kf" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kf" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kf" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae kf" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is kz it b iu iv iw ix iy iz ja jb la jd je jf lb jh ji jj lc jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kf" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kf" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jp jq jr js fq kh fe ff paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="fe ff ld"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="jp jq jr js fq kh"><div class="bz el l di"><div class="le lf l"/></div></figure></div></div>    
</body>
</html>