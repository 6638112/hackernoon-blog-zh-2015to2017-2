<html>
<head>
<title>Basic Project Design in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Go中的基本项目设计</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/basic-monorepo-design-in-go-e9ba1cb8e4e6?source=collection_archive---------5-----------------------#2017-04-01">https://medium.com/hackernoon/basic-monorepo-design-in-go-e9ba1cb8e4e6?source=collection_archive---------5-----------------------#2017-04-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div class="fe ff hs"><img src="../Images/9691e7d05fd429e7df29f5beb56aa24b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*MUch1im_s0R3YIOcttD-tQ.jpeg"/></div><figcaption class="hz ia fg fe ff ib ic bd b be z ek">Gopher Nest Structure</figcaption></figure><div class=""/><p id="55ef" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je ig"> tldr </strong> : <em class="ka">使用基本的monorepo(所有服务代码的一个存储库)项目设计可以在构建许多服务时使开发更容易。</em></p><h1 id="8f4d" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">背景</h1><p id="b3ee" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我在一家学习型公司工作，该公司有两个主要目标:</p><ol class=""><li id="7064" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">帮助个人学习/发现与其组织需求相关的技能。</li><li id="fe90" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">帮助组织留住/接纳/培训个人。</li></ol><p id="9c50" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了实现这两个目标，我们公司收集、处理和分析了大量数据。这种数据挑战在许多从事企业级工作的公司中很常见。它需要一个坚实的数据管道基础设施，既要<strong class="je ig">快速</strong>和<strong class="je ig">可扩展</strong>，又要<strong class="je ig">可靠</strong>。建造时有<a class="ae ls" href="https://hackernoon.com/tagged/design" rel="noopener ugc nofollow" target="_blank">设计</a>注意事项需要考虑。这篇博客文章将只关注这个管道的一小部分的高级视图。</p><h1 id="163b" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">为什么要用Golang？</h1><ul class=""><li id="b209" class="le lf if je b jf kz jj la jn lt jr lu jv lv jz lw lk ll lm dt translated"><strong class="je ig">可扩展性</strong> : Go在设计时就考虑到了简单性。只有<a class="ae ls" href="https://golang.org/ref/spec#Keywords" rel="noopener ugc nofollow" target="_blank"> 25个关键字</a>，只有一个循环(即<code class="eh lx ly lz ma b">for</code>循环)，由于<code class="eh lx ly lz ma b">go fmt</code>，所有代码都有一个共同的风格，等等。这种简单性允许团队意义上的可伸缩性。如果新的团队成员要开发用Go编写的应用程序，他们会更容易阅读和理解代码。这增加了帮助开发的程序员的数量。</li><li id="c773" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lw lk ll lm dt translated"><strong class="je ig">可靠性</strong>:因为Go是一种强类型语言，它也有很好的错误处理机制，所以它能产生非常可靠的代码。Go项目还有一个很棒的竞争检测工具，可以帮助识别可能的竞争情况。</li><li id="354c" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lw lk ll lm dt translated"><strong class="je ig">速度</strong>:走的是<a class="ae ls" href="http://benchmarksgame.alioth.debian.org/u64q/go.html" rel="noopener ugc nofollow" target="_blank">快</a>。</li></ul><h1 id="f60d" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">为什么要使用服务和单向回购？</h1><p id="adca" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">扩展团队不仅仅是选择一种每个人都能使用的语言。代码的组织方式必须便于查找和修改。这通常要求<em class="ka">代码彼此紧密联系</em>，同时具有<em class="ka">明确定义的职责</em>。</p><p id="c3c3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">设计良好的monoliths可以完成这些任务，但是当设计模式出现分歧、职责不正确或者应用程序的特定部分过于耗费资源并导致整个应用程序停止运行时，它有时会停止工作。资源密集型部分是一些项目选择将代码分解成独立服务的原因。</p><p id="8850" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">服务(或任何你想称之为服务的东西)可能会遇到与整体项目相同的问题；然而，许多服务也分散在多个存储库中，这使得新的团队成员很难快速浏览整个项目。</p><p id="2ab6" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">数据处理对任务有各种各样的要求。一些任务可能需要快速的周转时间。其他人可能会收到需要几分钟处理的大量数据。由于这些任务的需求变化很大，使用服务是有意义的。可能还会有问题，但是基于它们各自的需求横向/纵向扩展各个流程要容易得多。最后一个问题是代码邻近性。在某些情况下，<strong class="je ig"> monorepo </strong> <em class="ka">(所有服务代码的一个存储库)</em>的概念可以减轻邻近性问题。对于许多Go服务经常共享类似包的场景，monorepo的概念非常好。</p><h1 id="197a" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">设计</h1><p id="af90" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">monorepo项目设计与一揽子项目或小型项目相比有所不同。需要注意的是，这些设计建议只是建议。</p><h2 id="ffbf" class="mb kc if bd kd mc md me kh mf mg mh kl jn mi mj kp jr mk ml kt jv mm mn kx mo dt translated">文件夹结构</h2><p id="f806" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">项目的结构对组织来说很重要。某人越快将项目视为一个整体，他们就能越快做出贡献。有了Golang ,设计师们不再强迫一个文件夹约定，这样你的团队就可以利用他们的想法和偏好来找到解决方案。下面是一个monorepo文件夹结构的例子。</p><pre class="mp mq mr ms fq mt ma mu mv aw mw dt"><span id="9a44" class="mb kc if ma b fv mx my l mz na">├──<!-- -->Makefile<br/>├──<!-- -->Readme.md<br/>├──<!-- -->cmd<br/>│<!-- -->  <!-- -->├──<!-- -->parser<br/>│<!-- -->  <!-- -->│<!-- -->  <!-- -->└──<!-- -->parser.go<br/>│<!-- -->  <!-- -->└──<!-- -->terminator<br/>│<!-- -->     <!-- -->└──<!-- -->terminator.go<br/>├──pkg<br/>│<!-- -->  <!-- -->├──apps<br/>│<!-- -->  <!-- -->│<!-- -->  <!-- -->├──<!-- -->parser<br/>│<!-- -->  <!-- -->│<!-- -->  <!-- -->│  └──<!-- -->parser.go<br/>│<!-- -->  <!-- -->│<!-- -->  <!-- -->└──<!-- -->terminator<br/>│<!-- -->  <!-- -->│<!-- -->    <!-- --> └──<!-- -->terminator.go<br/>│<!-- -->  <!-- -->├──metrics<br/>│<!-- -->  <!-- -->│<!-- -->  <!-- -->└──<!-- -->metrics.go<br/>│<!-- -->  <!-- -->└──sentry<br/>│<!-- -->     <!-- -->└──<!-- -->sentry.go<br/>├──bin<br/>│<!-- -->  <!-- -->├──parser<br/>│<!-- -->  <!-- -->└──terminator<br/>├──scripts<br/>│<!-- -->  <!-- -->└──deploy.sh<br/>└──docs<br/> <!-- -->  <!-- -->├──components<br/> <!-- -->  <!-- -->│<!-- -->  <!-- -->├──sentry.md<br/> <!-- -->  <!-- -->│<!-- -->  <!-- -->└──redshift.md<br/> <!-- -->  <!-- -->└──apps<br/> <!-- -->     <!-- -->├──parser.md<br/> <!-- -->     <!-- -->└──terminator.md</span></pre><h2 id="dcd3" class="mb kc if bd kd mc md me kh mf mg mh kl jn mi mj kp jr mk ml kt jv mm mn kx mo dt translated">生成文件</h2><p id="5c5b" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">当项目越来越大，越来越多的人开始贡献代码时，强迫每个人使用相同的命令就变得很困难。Makefile可以帮助标准化一个好的快捷方式列表，供贡献者使用。以下是您可能希望包含在项目中的一些任务:</p><ul class=""><li id="8bd1" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lw lk ll lm dt translated"><strong class="je ig">构建</strong>:为您的go项目构建二进制文件，并将其放在<code class="eh lx ly lz ma b">bin</code>文件夹中。</li><li id="ba03" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lw lk ll lm dt translated"><strong class="je ig">测试</strong>:使用特定的标志或工具运行测试。使用Go的测试包，如果你的代码库变得非常大，你也可以指定测试组。</li><li id="6049" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lw lk ll lm dt translated"><strong class="je ig">部署</strong>:运行一个部署脚本或触发器来部署一个特定的项目。将构建和部署任务分开通常是有意义的。您的Makefile总是可以指定一个特定的顺序来运行它们。</li><li id="18b8" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lw lk ll lm dt translated"><strong class="je ig">清理</strong>:清理旧的构建对象和工件。</li></ul><h2 id="1c93" class="mb kc if bd kd mc md me kh mf mg mh kl jn mi mj kp jr mk ml kt jv mm mn kx mo dt translated">cmd文件夹</h2><p id="0709" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">cmd文件夹是用来存放应用程序入口点(主函数)的。这些入口点文件负责设置和配置每个应用程序。</p><h2 id="9be0" class="mb kc if bd kd mc md me kh mf mg mh kl jn mi mj kp jr mk ml kt jv mm mn kx mo dt translated"><strong class="ak"> pkg文件夹</strong></h2><p id="ee7a" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">所有作为独立包没有意义的内部包应该放在一个pkg文件夹中。该文件夹中文件的组织将取决于您的组织。这里有一些通用的提示。</p><ul class=""><li id="98d1" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lw lk ll lm dt translated">组织时牢记<a class="ae ls" href="https://en.wikipedia.org/wiki/KISS_principle" rel="noopener ugc nofollow" target="_blank">亲吻原则</a>。</li><li id="b53f" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lw lk ll lm dt translated">团队经常会尝试用熟悉的语言文件夹风格来设计项目，但是重要的是要记住Go就是语言，为每个数据模型准备一个包可能没有意义。</li><li id="3627" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lw lk ll lm dt translated">让<a class="ae ls" href="https://blog.golang.org/package-names" rel="noopener ugc nofollow" target="_blank">通用包</a>命名为<code class="eh lx ly lz ma b">utils</code>或<code class="eh lx ly lz ma b">misc</code>对于不熟悉你的代码库的开发者来说是不清楚的。如果代码库变得足够大，开发人员甚至可能会忘记这些通用包中包含哪些函数，并最终添加重复的函数。</li><li id="ddfb" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lw lk ll lm dt translated">将一个包分割成具有良好名称的独立文件通常有助于组织，但是拥有20个只有20行长的文件可能没有意义，并且很可能会惹恼开发人员。有时候一个文件就够了。</li><li id="7cf5" class="le lf if je b jf ln jj lo jn lp jr lq jv lr jz lw lk ll lm dt translated">设计一个包含所有错误类型的包似乎是一个很好的组织策略，但是它增加了包的复杂性，迫使开发人员从一个文件跳到另一个文件。</li></ul><h2 id="1d68" class="mb kc if bd kd mc md me kh mf mg mh kl jn mi mj kp jr mk ml kt jv mm mn kx mo dt translated"><strong class="ak"> bin文件夹</strong></h2><p id="c0ff" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">对于许多项目来说,<code class="eh lx ly lz ma b">bin</code>文件夹负责保存二进制文件。所以在这个文件夹中存储任何二进制文件是有意义的。尤其是我们编译的项目。</p><h2 id="cd90" class="mb kc if bd kd mc md me kh mf mg mh kl jn mi mj kp jr mk ml kt jv mm mn kx mo dt translated">脚本文件夹</h2><p id="0344" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">当与Makefile一起使用时，拥有一个专用于脚本的文件夹效果很好。团队可以拥有复杂的部署脚本，这些脚本触发多个操作，并将代码与Makefile分开。这使Makefile保持清晰和简单。</p><h2 id="7034" class="mb kc if bd kd mc md me kh mf mg mh kl jn mi mj kp jr mk ml kt jv mm mn kx mo dt translated">文档文件夹</h2><p id="990b" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">每个Go项目都应该使用<a class="ae ls" href="https://blog.golang.org/godoc-documenting-go-code" rel="noopener ugc nofollow" target="_blank"> Godoc的</a>方法，但是制作不包含在Go文件中的文档也有好处。对于不关心内部工作的用户，可以定制更高级别的文档。它们还可以包含部署过程、贡献指南和其他信息，这些信息包含在包文档中是没有意义的。</p><h1 id="4fa5" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="7e51" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">这篇文章是作为一个关于项目设计的小意见而写的。它的目的是给出建议，而不是强制标准。随意表达不同意见或分享观点或想法。</p><p id="087a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你有兴趣了解我们公司的更多信息，请访问Pathgather。</p><p id="3857" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">链接:</p><ul class=""><li id="1db0" class="le lf if je b jf jg jj jk jn lg jr lh jv li jz lw lk ll lm dt translated">图片来自:<a class="ae ls" href="http://www.pcanimalcontrol.com/gopher-control-removal.php" rel="noopener ugc nofollow" target="_blank">http://www.pcanimalcontrol.com/gopher-control-removal.php</a></li></ul><div class="mp mq mr ms fq ab cb"><figure class="nb hw nc nd ne nf ng paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="nb hw nc nd ne nf ng paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="nb hw nc nd ne nf ng paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nh ni nj"><p id="f922" class="jc jd ka je b jf jg jh ji jj jk jl jm nk jo jp jq nl js jt ju nm jw jx jy jz hn dt translated"><a class="ae ls" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ls" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ls" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae ls" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd ka je b jf jg jh ji jj jk jl jm nk jo jp jq nl js jt ju nm jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ls" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ls" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="mp mq mr ms fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="fe ff nn"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="mp mq mr ms fq hw"><div class="bz el l di"><div class="ns nt l"/></div></figure></div></div>    
</body>
</html>