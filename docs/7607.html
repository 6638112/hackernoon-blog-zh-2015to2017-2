<html>
<head>
<title>How to setup subdomain for aws api gateway?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为aws api网关设置子域？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-setup-subdomain-for-aws-api-gateway-d526a9fd6722?source=collection_archive---------32-----------------------#2017-11-01">https://medium.com/hackernoon/how-to-setup-subdomain-for-aws-api-gateway-d526a9fd6722?source=collection_archive---------32-----------------------#2017-11-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="abc2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2017年11月1日。5分钟读取。</p><p id="7d63" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我需要为AWS API Gateway中托管的REST服务设置一个子域。</p><p id="4f3b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">许多组件必须正确配置才能让所有组件协同工作。我在网上找不到简明的说明，AWS文档中有太多的东西需要阅读。我将分享我为使它工作所做的具体步骤，这样其他人就不必像我一样用一种困难的方式来解决它。</p><h1 id="15bd" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">目标</h1><p id="28a4" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">在这篇文章中，我将使用<code class="eh ks kt ku kv b">mydomain.com</code>作为一个示例域。</p><p id="f9eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经拥有了一辆和namecheap.com一起购买的mydomain.com。此外，根域——mydomain.com已经由Wix.com提供服务，并且是通过<a class="ae kw" href="https://support.wix.com/en/article/tutorial-connecting-your-domain-using-name-servers" rel="noopener ugc nofollow" target="_blank">配置名称服务器</a>设置的。我的目标是创建子域<strong class="it hv"><em class="kx">api.mydomain.com</em></strong>指向AWS API网关，并且仍然有<em class="kx">mydomain.com</em>与Wix一起工作。</p><p id="9a70" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以下是我如何让它工作的逐步说明:</p><h1 id="be85" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">1.从ACM获得HTTPs证书</h1><p id="5d54" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">第一步是我需要在Amazon Certificate Manager (ACM)中为我的站点申请证书。以下是步骤:</p><ol class=""><li id="1836" class="ky kz hu it b iu iv iy iz jc la jg lb jk lc jo ld le lf lg dt translated">登录Amazon Certificate Manager (ACM)并将地区切换到N. Virginia(这是<strong class="it hv">重要的</strong>)</li><li id="ce83" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">点击了请求证书</li><li id="45b0" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">为域名输入了<code class="eh ks kt ku kv b">*.mydomain.com</code>。</li><li id="5af8" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">点击“添加另一个名字到此证书”并输入<code class="eh ks kt ku kv b">mydomain.com</code>。</li><li id="ed21" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">点击审查和请求。</li><li id="f955" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">我收到了一封带有批准请求链接的电子邮件。</li></ol><p id="5e50" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">批准后，证书看起来像这样</p><figure class="ln lo lp lq fq lr fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff lm"><img src="../Images/edffe29a943de414bcf68f09edfa46ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SUgTWYpYp0BNrSNl.jpg"/></div></div></figure><h1 id="78e6" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">2.在API网关中创建了自定义域</h1><p id="c7fd" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">下一步是将自定义域添加到API网关:</p><ol class=""><li id="0ab6" class="ky kz hu it b iu iv iy iz jc la jg lb jk lc jo ld le lf lg dt translated">登录到亚马逊API网关</li><li id="1d2b" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">点击左侧导航栏上的<em class="kx">“自定义域名”</em></li><li id="f95b" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">为域名输入了<code class="eh ks kt ku kv b">api.mydomain.com</code>。</li><li id="ab0a" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">在上一步中为ACM证书创建的选定证书。</li><li id="735e" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">添加了路径<code class="eh ks kt ku kv b">/</code>到目的地的基本路径映射，作为我部署的API网关应用程序。</li><li id="545c" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">点击<em class="kx">【保存】</em></li><li id="73ce" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">记下“目标域名”处显示的云前端分发url。</li></ol><p id="6220" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是我的API网关配置的快照</p><figure class="ln lo lp lq fq lr fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff ly"><img src="../Images/c38a351fde9853e381938138b959d6b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CBokGJ8zoOU7u-fi.jpg"/></div></div></figure><h1 id="ed5a" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">3.在AWS路线53中创建了托管区域。</h1><p id="6d51" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">接下来，我定义了DNS设置AWS路由53:</p><ol class=""><li id="8877" class="ky kz hu it b iu iv iy iz jc la jg lb jk lc jo ld le lf lg dt translated">登录到AWS路线53。</li><li id="aa45" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">点击<em class="kx">“创建托管区域”</em></li><li id="89e0" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">提供域名为<code class="eh ks kt ku kv b">mydomain.com</code>，点击创建。(<strong class="it hv">注意域应该是根域，而不是子域</strong>)</li><li id="ca9c" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">选择已创建的域来配置<code class="eh ks kt ku kv b">A</code>记录。</li><li id="e388" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">点击“创建记录集”</li><li id="c620" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">输入<code class="eh ks kt ku kv b">api.mydomain.com</code>作为名称</li><li id="7110" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">选择<em class="kx">“A-IP v4地址”</em>作为类型。</li><li id="b20d" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">选择<em class="kx">【是】</em>为别名。</li><li id="b270" class="ky kz hu it b iu lh iy li jc lj jg lk jk ll jo ld le lf lg dt translated">输入上一步创建的云锋分布id作为值。</li></ol><p id="44cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的托管区域别名看起来像ethis</p><figure class="ln lo lp lq fq lr fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff lz"><img src="../Images/9a073e3beee0dcda3cf309b79fcd8855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*E7Oe6ldLCbwFocXE.jpg"/></div></div></figure><h1 id="29bd" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">4.在Name price中添加了Route 53名称服务器</h1><p id="8b5d" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">我在我域名的DNS设置下有wix域名服务器。我删除了Wix名称服务器，添加了AWS Route 53名称服务器。我在Route 53<em class="kx">“NS”</em>类型的记录集中找到了我的域名托管区域的域名服务器，如下图所示</p><figure class="ln lo lp lq fq lr fe ff paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="fe ff ma"><img src="../Images/eada69d74a808e0dcfb930ae335e9bc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TADzjPxqmO8waxbQ.jpg"/></div></div></figure><h1 id="749e" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">5.将Wix域设置切换到指向配置</h1><p id="6fbf" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">我需要从dns服务器将wix域连接类型更改为<em class="kx">“指向”</em>。所以我从wix断开了我的域，并通过域设置向导。我选择连接类型为<em class="kx">“指向”</em>，并遵循Wix提供的这些说明。</p><blockquote class="mb mc md"><p id="be20" class="ir is kx it b iu iv iw ix iy iz ja jb me jd je jf mf jh ji jj mg jl jm jn jo hn dt translated"><em class="hu">对于yourdomain.com，</em>创建一个指向23.236.62.147的A记录</p><p id="e3af" class="ir is kx it b iu iv iw ix iy iz ja jb me jd je jf mf jh ji jj mg jl jm jn jo hn dt translated">对于<a class="ae kw" href="http://www.yourdomain.com," rel="noopener ugc nofollow" target="_blank">www.yourdomain.com，</a>创建一个Cname记录，指向:www174.wixdns.net</p><p id="5108" class="ir is kx it b iu iv iw ix iy iz ja jb me jd je jf mf jh ji jj mg jl jm jn jo hn dt translated">对于m.yourdomain.com，创建一个Cname记录，指向:www174.wixdns.net</p></blockquote><p id="ce7e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以再次登录53号公路来设置这些A和CNAME记录集。</p><h1 id="a8ba" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">提示和技巧</h1><p id="74a9" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">以下是我遇到的问题和解决问题的建议。</p><h1 id="87b2" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">不能同时使用Wix和Route 53名称服务器。</h1><p id="52ad" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">我首先尝试将Wix名称服务器与Route 53名称服务器放在一起。但是域api.mydomain.com变得无法解析。然后，我没有使用Route 53，而是尝试在wix中直接添加CNAME，将<code class="eh ks kt ku kv b">api.mydomain.com</code>指向为我的定制域配置的cloudfront目标域。但是我得到了它返回的这个错误:</p><blockquote class="mb mc md"><p id="2766" class="ir is kx it b iu iv iw ix iy iz ja jb me jd je jf mf jh ji jj mg jl jm jn jo hn dt translated"><em class="hu">错误无法满足请求。错误的请求。由cloudfront(云锋)生成</em></p></blockquote><p id="801a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，我必须删除wix名称服务器，并将Wix自定义域设置切换到指向类型配置。</p><h1 id="c330" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">API网关中的自定义域名应该是子域。</h1><p id="dedf" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">当我在API网关自定义域配置中使用根域名时，我得到了以下SSL错误:</p><blockquote class="mb mc md"><p id="026f" class="ir is kx it b iu iv iw ix iy iz ja jb me jd je jf mf jh ji jj mg jl jm jn jo hn dt translated"><em class="hu">不支持的协议。ERR _ SSL _ VERSION _ OR _ CIPHER _ MISMATCH</em></p></blockquote><p id="6d24" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该错误具有误导性，但真正的原因是自动创建的云分布对于备用域名具有错误的值，因为我使用了根域名而不是子域名。</p><h1 id="ce9c" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">自定义域设置需要基本路径映射。</h1><p id="58e0" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">首先，我错过了添加自定义域设置中的基本路径映射，我得到了<code class="eh ks kt ku kv b">Bad request. Generated by cloudfront (CloudFront)</code>错误。这是因为如果没有基本路径映射，云前端将不知道将请求路由到哪个目的地。在添加了基本路径之后，它的工作就像一个魔咒！</p></div><div class="ab cl mh mi hc mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hn ho hp hq hr"><p id="c5d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kx">最初发布于</em><a class="ae kw" href="http://erajasekar.com/posts/how-to-setup-subdomain-for-aws-api-gateway/" rel="noopener ugc nofollow" target="_blank"><em class="kx">http://erajasekar . com/posts/how-to-setup-subdomain-for-AWS-API-gateway/</em></a><em class="kx">。</em></p></div></div>    
</body>
</html>