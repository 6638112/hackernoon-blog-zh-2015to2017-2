<html>
<head>
<title>Tips to Reduce Docker Image Sizes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">缩小Docker图像尺寸的技巧</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/tips-to-reduce-docker-image-sizes-876095da3b34?source=collection_archive---------2-----------------------#2017-06-23">https://medium.com/hackernoon/tips-to-reduce-docker-image-sizes-876095da3b34?source=collection_archive---------2-----------------------#2017-06-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="feff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Docker图像可以轻松达到2–3GB。这里有一些小贴士可以帮助你缩小它们的尺寸。</p><h1 id="3124" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">技巧1——使用较小的基本图像</h1><pre class="kn ko kp kq fq kr ks kt ku aw kv dt"><span id="6233" class="kw jq hu ks b fv kx ky l kz la">FROM ubuntu</span></pre><p id="296b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一开始会将您设置为128MB。考虑使用较小的基础图像。对于您在<code class="eh lb lc ld ks b">Dockerfile</code>中添加的每一个<code class="eh lb lc ld ks b">apt-get install</code>或<code class="eh lb lc ld ks b">yum install</code>行，您将按照库的大小增加图像的大小。意识到你可能不需要你正在安装的那些库。</p><p id="f2eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">考虑使用一个<a class="ae le" href="https://hub.docker.com/_/alpine/" rel="noopener ugc nofollow" target="_blank"> alpine </a> base image(大小只有5MB)。最有可能的是，您正在使用的编程语言有alpine标签。比如Python有<code class="eh lb lc ld ks b">2.7-alpine</code> (~50MB)和<code class="eh lb lc ld ks b">3.5-alpine</code> (~65MB)。</p><h1 id="1fbe" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">技巧2——不要安装像vim/curl这样的调试工具</h1><p id="660b" class="pw-post-body-paragraph ir is hu it b iu lf iw ix iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo hn dt translated">我注意到许多开发人员在他们的<code class="eh lb lc ld ks b">Dockerfile</code>中安装了<code class="eh lb lc ld ks b">vim</code>和<code class="eh lb lc ld ks b">curl</code>，这样他们可以更容易地调试他们的应用程序。除非您的应用程序依赖它，否则不要安装这些依赖项。这样做违背了使用小型基础映像的目的。</p><p id="c3a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是我如何调试呢？</p><p id="adb7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一种技术是拥有一个开发文档和一个生产文档。在开发过程中，准备好您需要的所有工具，然后在部署到生产环境时，删除开发工具。</p><h1 id="25bb" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">提示#3 —最小化图层</h1><p id="e2c0" class="pw-post-body-paragraph ir is hu it b iu lf iw ix iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo hn dt translated"><code class="eh lb lc ld ks b">Dockerfile</code>的每一行都是构建过程中的一个步骤；占据尺寸的层。合并您的RUN语句以减小图像大小。代替</p><pre class="kn ko kp kq fq kr ks kt ku aw kv dt"><span id="68fe" class="kw jq hu ks b fv kx ky l kz la">FROM debian<br/>RUN apt-get install -y &lt;packageA&gt;<br/>RUN apt-get install -y &lt;packageB&gt;</span></pre><p id="4c61" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">做</p><pre class="kn ko kp kq fq kr ks kt ku aw kv dt"><span id="7df0" class="kw jq hu ks b fv kx ky l kz la">FROM debian<br/>RUN apt-get install -y &lt;packageA&gt; &lt;packageB&gt;</span></pre><p id="28cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这种方法的一个缺点是，每次添加新库时，您都必须重新构建整个映像。如果你不知道，Docker不会重建它已经建立的层，它会逐行缓存<code class="eh lb lc ld ks b">Dockerfile</code>尝试改变你已经建立的<code class="eh lb lc ld ks b">Dockerfile</code>的一个字符，然后重建。您会注意到，该行上面的每一步都被认为是已经构建好的，但是您更改的行(以及后面的每一行)都将被重新构建。</p><p id="c004" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我推荐的一个策略是，在开发和测试依赖项时，分离出<code class="eh lb lc ld ks b">RUN</code>命令。一旦准备好部署到生产环境，就将<code class="eh lb lc ld ks b">RUN</code>语句组合成一行。</p><h1 id="9090" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">技巧4使用<code class="eh lb lc ld ks b">— no-install-recommends on apt-get install</code></h1><p id="a9ab" class="pw-post-body-paragraph ir is hu it b iu lf iw ix iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo hn dt translated">将<code class="eh lb lc ld ks b"> — no-install-recommends</code>添加到<code class="eh lb lc ld ks b">apt-get install -y</code>中可以避免安装技术上不依赖但建议与软件包一起安装的软件包，从而有助于显著减小大小。</p><p id="a646" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lb lc ld ks b">apk add</code>命令应增加<code class="eh lb lc ld ks b">--no-cache</code>。</p><h1 id="617e" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">技巧5将RM-RF/<strong class="ak">var</strong>/lib/apt/lists<em class="ll">/*添加到与apt-get安装</em>相同的层</h1><p id="910d" class="pw-post-body-paragraph ir is hu it b iu lf iw ix iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo hn dt translated">在<code class="eh lb lc ld ks b">apt-get -y install</code>后添加<code class="eh lb lc ld ks b">rm -rf /<strong class="it hv">var</strong>/lib/apt/lists/*</code> <em class="lk"> </em>来清理安装包。</p><p id="ef0d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于<code class="eh lb lc ld ks b">yum</code>，增加<code class="eh lb lc ld ks b">yum clean all</code></p><p id="a06f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">同样，如果你安装<code class="eh lb lc ld ks b">wget</code>或<code class="eh lb lc ld ks b">curl</code>是为了下载一些包，记得把它们都放在一个<code class="eh lb lc ld ks b">RUN</code>语句中。然后在run语句的末尾，一旦你不再需要它们就选择<code class="eh lb lc ld ks b">apt-get remove curl</code>或<code class="eh lb lc ld ks b">wget</code>。这个建议适用于任何你只是暂时需要的包。</p><h1 id="87ef" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">技巧6使用FromLatest.io</h1><p id="abbd" class="pw-post-body-paragraph ir is hu it b iu lf iw ix iy lg ja jb jc lh je jf jg li ji jj jk lj jm jn jo hn dt translated"><a class="ae le" href="https://www.fromlatest.io/#/" rel="noopener ugc nofollow" target="_blank"> FromLatest </a>将Lint您的docker文件，并检查您可以执行的更多步骤来减小您的图像大小。</p></div><div class="ab cl lm ln hc lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hn ho hp hq hr"><p id="37a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还有许多其他的提示。请随意分享我可能错过的。</p><blockquote class="lt lu lv"><p id="8a86" class="ir is lk it b iu iv iw ix iy iz ja jb lw jd je jf lx jh ji jj ly jl jm jn jo hn dt translated"><a class="ae le" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae le" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae le" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae le" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is lk it b iu iv iw ix iy iz ja jb lw jd je jf lx jh ji jj ly jl jm jn jo hn dt translated">要了解更多信息，请阅读我们的“关于”页面、<a class="ae le" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">喜欢/在脸书上给我们发消息</a>，或者简单地发送<a class="ae le" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is lk it b iu iv iw ix iy iz ja jb lw jd je jf lx jh ji jj ly jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae le" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae le" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote></div></div>    
</body>
</html>