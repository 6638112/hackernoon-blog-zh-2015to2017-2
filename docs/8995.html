<html>
<head>
<title>How to set up HTTPS for your domain on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在AWS上为您的域名设置HTTPS</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-set-up-https-for-your-domain-on-aws-8f771686603d?source=collection_archive---------1-----------------------#2017-12-22">https://medium.com/hackernoon/how-to-set-up-https-for-your-domain-on-aws-8f771686603d?source=collection_archive---------1-----------------------#2017-12-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="a3e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在AWS上托管所有这些不同的页面，还有大量的指南，如果你想在你的域名前放上绿色HTTPS，那会变得相当混乱。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/1f2a52a660079c60f94c83885dbdefce.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*o2boMKG6FfeYfgjtnYH7EA.png"/></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">This is what we want</figcaption></figure><p id="3133" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这里，我将为下面的每一种情况分解一步一步达到HTTPS的方法。总的来说，这个策略包括(a)获得一个<a class="ae jp" href="https://en.wikipedia.org/wiki/Certificate_authority" rel="noopener ugc nofollow" target="_blank"> SSL证书</a> , (b)将它链接到你的域名，并且可选地(c)将所有<a class="ae jp" href="https://hackernoon.com/tagged/http" rel="noopener ugc nofollow" target="_blank"> HTTP </a>流量定向到HTTPS。</p><ol class=""><li id="5c4e" class="kc kd hu it b iu iv iy iz jc ke jg kf jk kg jo kh ki kj kk dt translated">弹性豆茎上的静态页面</li><li id="16a9" class="kc kd hu it b iu kl iy km jc kn jg ko jk kp jo kh ki kj kk dt translated">亚马逊S3上的静态页面</li><li id="d72f" class="kc kd hu it b iu kl iy km jc kn jg ko jk kp jo kh ki kj kk dt translated">使用NGINX的EC2实例上的通用web应用程序</li></ol><p id="da04" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请注意，您的域名不一定需要通过AWS获得(例如。不支持“ai”名称)，但是您总是可以将您的DNS服务器迁移到AWS Route 53托管区域。</p></div><div class="ab cl kq kr hc ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hn ho hp hq hr"><h1 id="e37d" class="kx ky hu bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated"><strong class="ak"> 1。弹性豆茎</strong></h1><h2 id="d1a5" class="lv ky hu bd kz lw lx ly ld lz ma mb lh jc mc md ll jg me mf lp jk mg mh lt mi dt translated">a)获取SSL证书</h2><p id="0867" class="pw-post-body-paragraph ir is hu it b iu mj iw ix iy mk ja jb jc ml je jf jg mm ji jj jk mn jm jn jo hn dt translated">要获得您的SSL证书，只需访问<a class="ae jp" href="https://aws.amazon.com/certificate-manager/" rel="noopener ugc nofollow" target="_blank"> AWS证书管理器</a> (ACM)，它会免费发布证书。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="fe ff mo"><img src="../Images/d25f1e6d26d58bed712aff8d9e5000cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aSvieY1dxP5lJytLKhcGhA.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Register SSL certificate through ACM</figcaption></figure><p id="f556" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一步，你输入你想注册的域名。随后，在第二步中，它将要求您验证您是否确实是该域的所有者。这两个选项是(1) DNS和(2)电子邮件，只需按照说明，很快你就会有你的证书(可能需要60分钟)。如果您的域已经在AWS托管区域上，我推荐DNS路由。</p><h2 id="8d50" class="lv ky hu bd kz lw lx ly ld lz ma mb lh jc mc md ll jg me mf lp jk mg mh lt mi dt translated">b)链接到您的EB实例</h2><p id="e0ac" class="pw-post-body-paragraph ir is hu it b iu mj iw ix iy mk ja jb jc ml je jf jg mm ji jj jk mn jm jn jo hn dt translated">接下来，您只需将证书链接到与您的EB实例相关联的负载平衡器。转到AWS控制台中的<a class="ae jp" href="https://console.aws.amazon.com/elasticbeanstalk/home" rel="noopener ugc nofollow" target="_blank"> EB页面</a>，选择您的应用程序。单击左侧菜单上的“配置”，并在“网络层”下找到您的负载平衡器。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="fe ff mt"><img src="../Images/88c45455a6ad0bbc5e52943c105ae74e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wVWeOz-ZUuUcn-TFZwmWAQ.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Click on the settings icon</figcaption></figure><p id="f84f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">单击设置图标，并在“SSL证书ID”下拉列表中找到您刚刚注册的ACM SSL证书。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="fe ff mu"><img src="../Images/91404d1d7d30b6d140de750ab87005b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hFIyLofprN1y2pBcRiXpYw.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Attach SSL certificate to EB Load Balancer</figcaption></figure><h2 id="e59c" class="lv ky hu bd kz lw lx ly ld lz ma mb lh jc mc md ll jg me mf lp jk mg mh lt mi dt translated">c)通过重定向HTTP流量来强制HTTPS</h2><p id="909f" class="pw-post-body-paragraph ir is hu it b iu mj iw ix iy mk ja jb jc ml je jf jg mm ji jj jk mn jm jn jo hn dt translated">这一步是迄今为止最烦人的。我发现这很困难，因为缺乏可用的文档，而且所有的指南要么已经过时，要么只适用于特定的案例。我将介绍适用于所有情况的一般策略，但这里的细节将针对<em class="mv">单集装箱码头应用</em>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff mw"><img src="../Images/f4ed2ae4a34e6d3ae17d7e3458d7558f.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*ilo5A0c6Up5q-OB4JjUtcQ.png"/></div></figure><p id="209b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">总体思路是，你的EB应用背后的服务器是另一个EC2实例，你可以在你的AWS控制台的<a class="ae jp" href="https://console.aws.amazon.com/ec2/v2/home" rel="noopener ugc nofollow" target="_blank"> EC2部分</a>中找到它。您必须在这台机器上定制Nginx配置，将HTTP流量(端口80)重定向到HTTPS(端口443)。</p><p id="75ec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可能会看到很多指南告诉你使用<code class="eh mx my mz na b">.ebextensions</code>目录，但是很难知道在那里做什么，因为对别人有用的东西可能对你没用。通过使用Nginx，您可以在基础级别设置路由。点击此处了解更多信息:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff nb"><img src="../Images/e4dd611a041c8f518b91b25fbf69f7ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*Lqqzohxt5sznYqtnrAh09w.png"/></div></figure><p id="418e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在SSH进入EC2实例。如果你已经知道如何做到这一点，很好。否则，最简单的方法是获取EB CLI，并运行<code class="eh mx my mz na b">eb ssh</code>。</p><p id="0924" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦进入，找到nginx配置文件，并打开它。</p><pre class="jr js jt ju fq nc na nd ne aw nf dt"><span id="4967" class="lv ky hu na b fv ng nh l ni nj">$ sudo vim /etc/nginx/nginx.conf</span></pre><p id="646b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在里面，您会看到一个<code class="eh mx my mz na b">include</code>语句，指向路由实际发生的文件。在我们的例子中，它是<code class="eh mx my mz na b">elasticbeanstalk-nginx-docker-proxy.conf</code>。</p><pre class="jr js jt ju fq nc na nd ne aw nf dt"><span id="7b12" class="lv ky hu na b fv ng nh l ni nj">$ sudo vim /etc/nginx/sites-enabled/elasticbeanstalk-nginx-docker-proxy.conf</span></pre><p id="ce98" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">机器将总是监听端口80，您可以看到它正在代理传递到Docker容器。现在，HTTP和HTTPS都被路由到Docker，只是有所不同。用下面的代码替换<code class="eh mx my mz na b">server</code>部分。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="nk nl l"/></div></figure><p id="16d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本质上，因为请求必须通过端口80，您只需测试它是否已经是HTTPS，在这种情况下，您继续将它路由到Docker。否则，你重定向它使用HTTPS。</p><p id="146e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，重启Nginx，我们就完成了！</p><pre class="jr js jt ju fq nc na nd ne aw nf dt"><span id="77b3" class="lv ky hu na b fv ng nh l ni nj">$ sudo service nginx restart</span></pre><h1 id="7a11" class="kx ky hu bd kz la nm lc ld le nn lg lh li no lk ll lm np lo lp lq nq ls lt lu dt translated">2.亚马逊S3</h1><h2 id="3c22" class="lv ky hu bd kz lw lx ly ld lz ma mb lh jc mc md ll jg me mf lp jk mg mh lt mi dt translated">a)获取SSL证书</h2><p id="ddad" class="pw-post-body-paragraph ir is hu it b iu mj iw ix iy mk ja jb jc ml je jf jg mm ji jj jk mn jm jn jo hn dt translated">同样，最好使用AWS证书管理器发布的免费SSL证书。有关说明，请参见第1节。</p><h2 id="90f8" class="lv ky hu bd kz lw lx ly ld lz ma mb lh jc mc md ll jg me mf lp jk mg mh lt mi dt translated">b)链接到您的S3页面</h2><p id="9317" class="pw-post-body-paragraph ir is hu it b iu mj iw ix iy mk ja jb jc ml je jf jg mm ji jj jk mn jm jn jo hn dt translated">要使用你的SSL证书才能把你的S3页面放到HTTPS，我们必须使用一种叫做CloudFront的服务。你可以在你的AWS控制台上找到它。点击“创建发行版”,浏览各个字段——您可以保留大部分字段。</p><p id="9fa4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">重要的字段是原点设置，通过它你可以链接到已经存在的S3页面。此外，再往下，您可以选择相应的SSL证书。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="fe ff nr"><img src="../Images/0d3ae6e8ec2b77aca95a4ada0fef4cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0VWX3p4GynCjp53gb1F1Gg.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Create a CloudFront distribution</figcaption></figure><p id="e726" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦创建了发行版，基本上就有了一个可以处理HTTPS的页面外层。</p><p id="6ea1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你如何让你的URL地址真正指向那里？转到AWS控制台中的<a class="ae jp" href="https://console.aws.amazon.com/route53/home" rel="noopener ugc nofollow" target="_blank"> Route 53 </a>管理器。现在单击“托管区域”，选择您的域，然后“创建记录集”。这里的目标是创建一个<em class="mv">别名</em>，将您的域链接到您刚刚创建的CloudFront发行版。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="fe ff ns"><img src="../Images/a87afe8645b28629302966e834f7c754.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1HJZBRyW3D9tAyMAa7iQbg.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Create an alias in your Record Set</figcaption></figure><p id="6578" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从“别名目标”下拉列表中选择您的CloudFront发行版，并创建。这些更改可能需要一点时间来传播，但是您已经完成了！</p><h1 id="9771" class="kx ky hu bd kz la nm lc ld le nn lg lh li no lk ll lm np lo lp lq nq ls lt lu dt translated">3.使用NGINX的EC2实例</h1><h2 id="34cb" class="lv ky hu bd kz lw lx ly ld lz ma mb lh jc mc md ll jg me mf lp jk mg mh lt mi dt translated">a)获取SSL证书</h2><p id="c10f" class="pw-post-body-paragraph ir is hu it b iu mj iw ix iy mk ja jb jc ml je jf jg mm ji jj jk mn jm jn jo hn dt translated">我稍后使用的策略需要SSL证书的实际密钥文件，这是无法从ACM获得的(ACM的证书只能应用于负载平衡器或S3)。</p><p id="a5c0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，我们转向另一种选择，这也很容易:<a class="ae jp" href="https://certbot.eff.org/" rel="noopener ugc nofollow" target="_blank"> Certbot </a>。SSH进入您的机器，并按照网站上的说明获取您的SSL证书文件。这些命令会在<code class="eh mx my mz na b">/etc/letsencrypt/</code>将SSL全链和私钥下载到您的本地机器上。</p><h2 id="8b41" class="lv ky hu bd kz lw lx ly ld lz ma mb lh jc mc md ll jg me mf lp jk mg mh lt mi dt translated">b)将SSL证书链接到您的web应用程序</h2><p id="c802" class="pw-post-body-paragraph ir is hu it b iu mj iw ix iy mk ja jb jc ml je jf jg mm ji jj jk mn jm jn jo hn dt translated">同样，所有的路由都发生在NGINX中。没有HTTPS，你可能只是监听端口80，并将其重定向到你的应用程序进程。现在，我们想把文件修改成这样。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="nk nl l"/></div></figure><p id="6c43" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请注意，现在我们正在监听端口80和443。在端口443上，当您收到HTTPS请求时，您利用您的SSL证书将其重定向到您的应用程序。</p><h2 id="f786" class="lv ky hu bd kz lw lx ly ld lz ma mb lh jc mc md ll jg me mf lp jk mg mh lt mi dt translated">c)通过重定向HTTP流量来强制HTTPS</h2><p id="78e7" class="pw-post-body-paragraph ir is hu it b iu mj iw ix iy mk ja jb jc ml je jf jg mm ji jj jk mn jm jn jo hn dt translated">上面的代码实际上是一举两得。第33–38行告诉服务器也监听端口80，并将其重定向到使用HTTPS。如果你不想要这个功能，只需去掉那些线条。</p></div><div class="ab cl kq kr hc ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hn ho hp hq hr"><p id="70ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">希望这有助于总结在AWS上设置HTTPS的不同技术！一如既往，如果你有什么要补充的，欢迎反馈或评论。</p><p id="ae9b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想知道什么是<a class="ae jp" href="https://camelot.ai" rel="noopener ugc nofollow" target="_blank"> camelot.ai </a>，我们的团队正在为内容创作者建立一种新的赚钱方式，让粉丝在他们的内容中发表意见或直接与他们交流。您可能会认出平台上已经有的许多游戏彩带！</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="fe ff nt"><img src="../Images/0581bba5c997cc3d520e0a2919e3eb52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NNDz8fXBg40nwNhDeyk0Jg.png"/></div></div><figcaption class="jy jz fg fe ff ka kb bd b be z ek">Our landing page</figcaption></figure><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="nu nl l"/></div></figure></div></div>    
</body>
</html>