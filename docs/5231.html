<html>
<head>
<title>Rails Web-Scale is Expensive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rails网络规模是昂贵的</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/rails-web-scale-is-expensive-b86facc11381?source=collection_archive---------9-----------------------#2017-07-17">https://medium.com/hackernoon/rails-web-scale-is-expensive-b86facc11381?source=collection_archive---------9-----------------------#2017-07-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="6c12" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上周<a class="ae jp" href="https://twitter.com/nateberkopec" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> @ </strong> nateberkopec </a>写了<a class="ae jp" href="https://www.speedshop.co/2017/07/11/is-ruby-too-slow-for-web-scale.html" rel="noopener ugc nofollow" target="_blank">“Ruby对于网络规模来说是不是太慢了？”</a>讨论了关于<a class="ae jp" href="https://hackernoon.com/tagged/rails" rel="noopener ugc nofollow" target="_blank"> Rails </a>太慢而不适合网络规模的谣言。你猜怎么着！？它不是。Nate详细解释了原因，整个Rails-Bubble Twitter圈子也跟了过来。我同意一般的假设，但在我看来，它缺少几个非常重要的点(例如，你必须支付的价格。字面意思！).我想用这篇文章来澄清一些迷雾，让整个Rails生态系统来反对我。；-)</p><blockquote class="jq jr js"><p id="fa30" class="ir is jt it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">内特写他的帖子是为了获得更多的可见性，这转化为更多的咨询合同。我也是。我们都以挑战Rails应用程序的速度极限为生。这种对抗不是针对个人的，而只是指出一些缺陷，认识到这些缺陷是很重要的。我很乐意请他或我在这篇文章或任何后续推文中提到的任何人喝一杯！</p></blockquote><figure class="jy jz ka kb fq kc fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff jx"><img src="../Images/91eb01878be59f0c28c27be18ebc774d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Guub1PY10xKm1eTXeLe32g.jpeg"/></div></div><figcaption class="kj kk fg fe ff kl km bd b be z ek">Heroku is so easy to use in the beginning. And at some point in the future the invoices become bigger and bigger.</figcaption></figure><h1 id="3cba" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">100毫秒的谎言</h1><p id="4e99" class="pw-post-body-paragraph ir is hu it b iu ll iw ix iy lm ja jb jc ln je jf jg lo ji jj jk lp jm jn jo hn dt translated">Nate曾说过，用户不会感觉到Rails web服务器的1毫秒(快)和100毫秒(慢)响应之间的差别(这意味着Rails在服务器上呈现HTML所花费的时间，而HTML仍然需要被传送到客户端)。他甚至用雅各布·尼尔森的一项研究来证明他的观点。内特的论点是错误的，具有误导性。它没有解释典型的网络性能问题，更重要的是:他误读了Jakob Nielsen的工作。尼尔森的研究称，100毫秒以下的一切都被感觉为<em class="jt">“瞬间反应”</em>。<em class="jt">“1.0秒大约是用户思想流动保持不中断的极限”</em>。因此，web性能的黄金标准是1秒以下的一切。访问谷歌。在美国的任何地方，它都会在不到1秒的时间内被点燃。这也是它如此受欢迎的原因之一。如果谷歌花了5秒钟才加载，你就不会用它了。</p><p id="c93e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，如果你想参加WebPerformance premium联赛，100毫秒和1毫秒之间有很大的差别。公司雇佣像我和内特这样的人就是因为这种差异！</p><p id="58cf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在WebPerformance的上下文中，将永远需要向您介绍100毫秒延迟的含义。如果你真的想了解它们，我强烈推荐你阅读网络性能之神<a class="ae jp" href="https://www.igvita.com" rel="noopener ugc nofollow" target="_blank">伊利亚·格里戈利克</a>的<a class="ae jp" href="https://hpbn.co" rel="noopener ugc nofollow" target="_blank">高性能浏览器网络</a>。</p><p id="ce5f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，如果给定页面的网页性能很差(意思是所有的东西都在2-3秒以上)，那么Nate的观点就变得更加有效了。一旦你达到了5秒的门槛，那就没关系了。</p><p id="ac82" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">底线:如果你想要一个真正快速的网页，一切都很重要，服务器上的100毫秒非常重要。</p><h1 id="6726" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">Rails并不慢。周围的一切都是。说真的！？</h1><p id="1997" class="pw-post-body-paragraph ir is hu it b iu ll iw ix iy lm ja jb jc ln je jf jg lo ji jj jk lp jm jn jo hn dt translated">内特写道</p><ul class=""><li id="d33d" class="lq lr hu it b iu iv iy iz jc ls jg lt jk lu jo lv lw lx ly dt translated"><em class="jt">“通常，花在与这些数据库交互上的时间会占一个响应的25%或更多。”</em></li><li id="25a3" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated">web应用程序在框架本身上花费了最多50%的执行时间，在实际的应用程序代码和其他附加的依赖上花费了更多的时间。</li></ul><p id="befe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先:我不同意那些数字。根据我作为Ruby on Rails顾问的经验，与数据库的交互是所有问题中最小的。当然，偶尔会有一家公司忘记设置索引或做一些非常疯狂的连接，这需要花费很长时间，但在十之八九的情况下，SQL数据库不是最大的瓶颈。</p><blockquote class="jq jr js"><p id="45dc" class="ir is jt it b iu iv iw ix iy iz ja jb ju jd je jf jv jh ji jj jw jl jm jn jo hn dt translated">不要误解我:每一毫秒都很重要，总有改进的空间。</p></blockquote><p id="8aad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我的观点是:<strong class="it hv">人不在乎时间浪费在哪里。他们使用Rails作为一站式商店，使用Rails生态系统中的所有东西。他们使用它是因为它很容易使用。他们不想分析哪种数据存储解决方案可能会成为瓶颈。</strong></p><p id="f2de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些年来，Rails变得非常容易使用，它确实有一个很好的生态系统，但它在性能方面失败了。人们不会考虑宝石的成本。他们只是包含它并启动捆绑包。</p><h1 id="01e7" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">每月节省1，000美元</h1><p id="be2d" class="pw-post-body-paragraph ir is hu it b iu ll iw ix iy lm ja jb jc ln je jf jg lo ji jj jk lp jm jn jo hn dt translated">在某一点上，Nate谈到了将一个缓慢的Rails应用程序重写为一个快速的(如Phoenix)应用程序的好处不够大。他说:<em class="jt">“那么，恭喜你:你重写了你的应用程序(或者选择了你的框架)以节省每月3000美元。”</em></p><p id="96a9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">他错在这里:</p><ul class=""><li id="6ca2" class="lq lr hu it b iu iv iy iz jc ls jg lt jk lu jo lv lw lx ly dt translated">对于大多数公司来说，每月减少3000美元是一笔很大的交易。</li><li id="5bf2" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated">他用平均值来做所有的计算。但对大多数公司来说，平均成本并不是最大的成本因素。峰值是问题所在。他们购买或租赁大型和多台服务器，因为他们希望能够应对高峰，因为那是他们销售最多的时候。所以仅仅用平均值是一种非常误导人的论证方式。</li></ul><p id="0a9a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">风投资助的公司烧钱就像没有明天一样，这是个例外。我们大多数人和我的大多数客户都必须尽可能地省钱。</p><p id="b163" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于许多低成本或免费的服务，这成为一个更大的问题。请看一下<a class="ae jp" href="https://www.vutuv.de" rel="noopener ugc nofollow" target="_blank"> https://www.vutuv.de </a>这是一个商业网络(想想LinkedIn但是免费、安全、开源)。Vutuv最初是作为Ruby on Rails应用程序编写的。但是由于web性能和预算的原因，它被重写为Phoenix/Elixir应用程序。</p><h1 id="e6cb" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">统计数字</h1><p id="cca7" class="pw-post-body-paragraph ir is hu it b iu ll iw ix iy lm ja jb jc ln je jf jg lo ji jj jk lp jm jn jo hn dt translated">当我咆哮的时候，让我们把<a class="me mf gr" href="https://medium.com/u/54bcbf647830?source=post_page-----b86facc11381--------------------------------" rel="noopener" target="_blank"> DHH </a>也加入到这个讨论中来。他在讨论中添加了这条推文:</p><figure class="jy jz ka kb fq kc"><div class="bz el l di"><div class="mg mh l"/></div></figure><p id="2c2f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有趣的数字。但是我想问大家:这些数字是什么意思？没有他们的服务器基础设施和他们的代码库的知识什么都没有。37signals为他们的服务器烧了多少钱？</p><p id="a29a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">顺便说一句:我对180毫秒的第90百分位印象不深。这些峰值是大多数头痛的原因。</p><h1 id="4a98" class="kn ko hu bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">那么Rails速度慢因此不好吗？</h1><p id="1922" class="pw-post-body-paragraph ir is hu it b iu ll iw ix iy lm ja jb jc ln je jf jg lo ji jj jk lp jm jn jo hn dt translated">在我看来，Ruby on Rails相对较慢。与目前许多Rails开发者的新救星<a class="ae jp" href="http://www.phoenixframework.org" rel="noopener ugc nofollow" target="_blank"> Phoenix Framework </a>相比，它慢了10倍。这重要吗？很糟糕吗？大多数时候不是。</p><p id="0c3c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">知道像Phoenix Framework这样的替代方案更快，就像知道汇编程序比Rust或c更快一样重要。只有在速度和代码量非常重要的时候才使用它。</p><p id="ad14" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以Rails在大多数情况下更慢也更贵(就服务器而言),但这并不意味着它是个坏选择。我的观点是让每个人都意识到这一点。我见过许多公司因为高额的Heroku账单而陷入困境。</p><p id="7fba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不要仅仅因为<a class="ae jp" href="https://www.shopify.com" rel="noopener ugc nofollow" target="_blank"> Shopify </a>和<a class="ae jp" href="https://basecamp.com" rel="noopener ugc nofollow" target="_blank"> Basecamp </a>使用Rails。用它是因为你喜欢这个框架。因为你觉得那是给你最好的发展环境。当你明白它对你预算的影响时，就使用它。请花时间阅读<a class="ae jp" href="https://hackernoon.com/phoenix-is-better-but-rails-is-more-popular-8975d5e68879" rel="noopener ugc nofollow" target="_blank">“Phoenix更好但Rails更受欢迎”</a>。</p><p id="5333" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您遇到任何性能问题，或者需要Ruby on Rails或Phoenix咨询/培训，请通过电子邮件(sw@wintermeyer-consulting.de)或Twitter上的DM(@ winter Meyer)与我联系。</p><figure class="jy jz ka kb fq kc"><div class="bz el l di"><div class="mi mh l"/></div></figure></div></div>    
</body>
</html>