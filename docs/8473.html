<html>
<head>
<title>Automating open source project configuration with Mrm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Mrm自动化开源项目配置</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/automating-open-source-project-configuration-with-mrm-7f67fd55a9b0?source=collection_archive---------18-----------------------#2017-12-03">https://medium.com/hackernoon/automating-open-source-project-configuration-with-mrm-7f67fd55a9b0?source=collection_archive---------18-----------------------#2017-12-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="9edf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们使用许多工具，比如linters、test runners和持续集成，让我们作为开发人员的生活变得更加轻松。但是维护这些工具的配置并不容易，尤其是如果您希望所有项目中的配置都是最新的。<a class="ae jp" href="https://github.com/sapegin/mrm" rel="noopener ugc nofollow" target="_blank"> Mrm </a>试图解决这个问题。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/3bb4cc004df26736245caf03e3777387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ErDZPxz5bSZOwXXV2YwIKA.jpeg"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek"><em class="kg">Slightly different files. Photo by </em><a class="ae jp" href="http://morning.photos/albums/travel/2009-09-17-0908" rel="noopener ugc nofollow" target="_blank">yours truly</a>.</figcaption></figure><h2 id="1126" class="kh ki hu bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb dt translated">有什么问题吗</h2><p id="1461" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">唯一多次阻止我将一些通用函数提取到一个单独的包中的是需要复制和修改十几个配置文件——所有这些——仅仅是为了发布一个50行的函数。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ll"><img src="../Images/ab50fe3e5f2a960b8385fbc991fe9839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PgcpIZP23kObiRWas6DvOg.png"/></div></div></figure><p id="7447" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在你所有的项目中，这些支持文件通常只是<em class="lm">略有不同</em>。例如，一个<code class="eh lh li lj lk b">.gitignore</code>文件有<code class="eh lh li lj lk b">node_modules</code>和编辑器工件，您希望在所有项目之间共享，但是有些项目有额外的行，您不希望在其他项目中出现。我们需要一种方法来保持同步的共同部分，但允许每个项目的定制。</p><p id="ec63" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">基于模板的工具，比如Yeoman，对于初始的项目引导是很好的，但是对于更新就不太好了:它们会用新的版本覆盖一个文件，并且你会丢失你的定制。</p><h2 id="d236" class="kh ki hu bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb dt translated">什么是Mrm</h2><p id="4acb" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">Mrm 采取了不同的方法。它的工作方式类似于<a class="ae jp" href="https://www.sitepoint.com/getting-started-with-codemods/" rel="noopener ugc nofollow" target="_blank"> codemods </a>:你用代码描述如何<em class="lm">修改</em>或创建文件以达到文件的期望状态，而不是覆盖一切的模板。</p><h2 id="2083" class="kh ki hu bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb dt translated">最小的变化</h2><p id="daf6" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">Mrm试图通过推断缩进样式或从EditorConfig中读取，并在JSON文件中保留注释来做最小的更改。</p><h2 id="f2ef" class="kh ki hu bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb dt translated">最低配置</h2><p id="e07f" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">它只需要很少的配置:它将使用来自项目本身或环境的值，比如从Git或npm配置中读取您的姓名和电子邮件。</p><h2 id="5320" class="kh ki hu bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb dt translated">专注但丰富的API</h2><p id="6ca2" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">Mrm有一些实用程序可以处理流行的配置文件格式:JSON、YAML、INI和新行分隔的文本文件；安装npm软件包；和文件操作。</p><p id="969d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这允许您创建智能<em class="lm">任务</em>，因此结果取决于您的项目需求。</p><h2 id="d385" class="kh ki hu bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb dt translated">可用任务</h2><p id="29f5" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">Mrm有许多现成的任务:CodeCov、EditorConfig、ESLint。gitignore、Jest、lint-staged、appeller、semantic-release、React Styleguidist、stylelint、Travis CI、TypeScript、package.json、投稿指南、许可证和自述文件。您可以创建自己的任务或使用别名合并多个任务。</p><p id="db51" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如，<a class="ae jp" href="https://github.com/sapegin/mrm-tasks/tree/master/packages/mrm-task-jest" rel="noopener ugc nofollow" target="_blank">玩笑任务</a>:</p><ul class=""><li id="0426" class="ln lo hu it b iu iv iy iz jc lp jg lq jk lr jo ls lt lu lv dt translated">添加npm脚本以运行Jest</li><li id="5d2b" class="ln lo hu it b iu lw iy lx jc ly jg lz jk ma jo ls lt lu lv dt translated">如果需要，向<code class="eh lh li lj lk b">package.json</code>添加配置；</li><li id="ab40" class="ln lo hu it b iu lw iy lx jc ly jg lz jk ma jo ls lt lu lv dt translated">用常用模式更新<code class="eh lh li lj lk b">.gitignore</code>、<code class="eh lh li lj lk b">.npmignore</code>、<code class="eh lh li lj lk b">.eslintignore</code>；</li><li id="b74f" class="ln lo hu it b iu lw iy lx jc ly jg lz jk ma jo ls lt lu lv dt translated">根据需要安装Jest、<code class="eh lh li lj lk b">babel-jest</code>、<code class="eh lh li lj lk b">ts-jest</code>或酵素；</li><li id="26d9" class="ln lo hu it b iu lw iy lx jc ly jg lz jk ma jo ls lt lu lv dt translated">试图摆脱摩卡和AVA配置和依赖；</li><li id="1c45" class="ln lo hu it b iu lw iy lx jc ly jg lz jk ma jo ls lt lu lv dt translated">建议我们<code class="eh lh li lj lk b">jest-codemods</code>项目是否使用其他测试框架。</li></ul><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mb"><img src="../Images/87b043cf999762c0c80967fe9d7066ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yf_sYeuA-In-1PeByYhlQQ.png"/></div></div></figure><p id="5614" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者<a class="ae jp" href="https://github.com/sapegin/mrm-tasks/tree/master/packages/mrm-task-gitignore" rel="noopener ugc nofollow" target="_blank"> gitignore任务</a>，它将向<code class="eh lh li lj lk b">.gitignore</code>文件添加新行，但不会删除每个项目的定制:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mc"><img src="../Images/db7e1f9d3a446809e9995f72990dc25e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zdgk92kH_j7FaLH8x_pPaA.png"/></div></div></figure><h2 id="f08a" class="kh ki hu bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb dt translated">安装和使用</h2><p id="98dc" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">从npm安装Mrm:</p><pre class="jr js jt ju fq md lk me mf aw mg dt"><span id="5f72" class="kh ki hu lk b fv mh mi l mj mk">npm install -g mrm</span></pre><p id="4d16" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">像这样跑:</p><pre class="jr js jt ju fq md lk me mf aw mg dt"><span id="d020" class="kh ki hu lk b fv mh mi l mj mk">mrm gitignore<br/>mrm license --config:licenseFile <!-- -->LICENSE</span></pre><p id="3473" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者在不安装的情况下通过<a class="ae jp" rel="noopener" href="/@maybekatz/introducing-npx-an-npm-package-runner-55f7d4bd282b"> npx </a>运行Mrm:</p><pre class="jr js jt ju fq md lk me mf aw mg dt"><span id="40b5" class="kh ki hu lk b fv mh mi l mj mk">npx mrm gitignore<br/>npx mrm license --config:licenseFile <!-- -->LICENSE</span></pre><p id="0e92" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">可选地，在<code class="eh lh li lj lk b">~/.mrm/config.json</code>或<code class="eh lh li lj lk b">~/dotfiles/mrm/config.json</code>创建一个配置文件，而不是通过命令行传递值:</p><pre class="jr js jt ju fq md lk me mf aw mg dt"><span id="f155" class="kh ki hu lk b fv mh mi l mj mk">{<br/>  "github": "sapegin",<br/>  "eslintPreset": "airbnb",<br/>  "aliases": {<br/>    // Aliases to run multiple tasks at once<br/>    "node": ["license", "readme", "editorconfig", "gitignore"]<br/>  }<br/>}</span></pre><p id="482a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在文档中查看更多使用示例和选项<a class="ae jp" href="https://github.com/sapegin/mrm#usage" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="2a76" class="kh ki hu bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb dt translated">创建您自己的任务</h2><p id="ae7e" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">Mrm的真正强大之处在于定制任务和<a class="ae jp" href="https://github.com/sapegin/mrm-core" rel="noopener ugc nofollow" target="_blank">Mrm-核心库</a>，它为您提供了处理配置文件、依赖项、文件操作等的工具。</p><p id="e719" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最简单的任务可能是这样的:</p><pre class="jr js jt ju fq md lk me mf aw mg dt"><span id="7975" class="kh ki hu lk b fv mh mi l mj mk">// Mrm module to work with new line separated text files<br/>const { lines } = require('mrm-core');<br/><br/>function task() {<br/>  // Read .gitignore if it exists<br/>  lines('.gitignore')<br/>    // Add lines that do not exist in a file yet,<br/>    // but keep all existing lines<br/>    .add(['node_modules/', '.DS_Store'])<br/>    // Update or create a file<br/>    .save();<br/>}<br/><br/>task.description = 'Adds .gitignore';<br/>module.exports = task;</span></pre><p id="6843" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">参见文档中的更多示例<a class="ae jp" href="https://github.com/sapegin/mrm#writing-your-own-tasks" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="35e6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以将您的任务保存在本地，<a class="ae jp" href="https://github.com/sapegin/mrm#sharing-tasks-via-npm" rel="noopener ugc nofollow" target="_blank">发布到npm </a>上，或者将多个任务<a class="ae jp" href="https://github.com/sapegin/mrm#custom-presets" rel="noopener ugc nofollow" target="_blank">合并到一个预置</a>中。</p><h2 id="8cdc" class="kh ki hu bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb dt translated">结论</h2><p id="5c05" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">如果您有许多具有相似堆栈的项目或者一个大的多存储库项目，Mrm可能是管理它们的配置的好方法，并且可以节省您的时间。</p><p id="ae31" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从默认任务开始，然后为您的项目或组织编写自己的任务或创建预设。</p><p id="4950" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个项目还很年轻——让我知道你在评论或GitHub问题上的想法。</p><p id="1dad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另外，看看我们关于<a class="ae jp" href="https://survivejs.com/maintenance/" rel="noopener ugc nofollow" target="_blank"> JavaScript项目维护</a>的新书。</p></div><div class="ab cl ml mm hc mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="hn ho hp hq hr"><p id="3a62" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lm">感谢</em> <a class="ms mt gr" href="https://medium.com/u/82815f6b43dc?source=post_page-----7f67fd55a9b0--------------------------------" rel="noopener" target="_blank"> <em class="lm">安娜·热鲁斯</em></a><em class="lm"/><a class="ms mt gr" href="https://medium.com/u/4a0f6a534c55?source=post_page-----7f67fd55a9b0--------------------------------" rel="noopener" target="_blank"><em class="lm">卡尔·霍基</em></a><em class="lm"/><a class="ms mt gr" href="https://medium.com/u/5829a67c85f9?source=post_page-----7f67fd55a9b0--------------------------------" rel="noopener" target="_blank"><em class="lm">安德烈·奥科涅奇尼科夫</em></a><em class="lm"/><a class="ms mt gr" href="https://medium.com/u/7c635fc6907?source=post_page-----7f67fd55a9b0--------------------------------" rel="noopener" target="_blank"><em class="lm">奥列格·斯洛博德斯科伊</em> </a> <em class="lm">、奥尔加·西连科、</em> <a class="ms mt gr" href="https://medium.com/u/a82419fa03ca?source=post_page-----7f67fd55a9b0--------------------------------" rel="noopener" target="_blank"> <em class="lm">尤霍·韦普斯莱宁</em></a></p></div></div>    
</body>
</html>