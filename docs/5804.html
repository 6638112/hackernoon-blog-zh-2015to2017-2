<html>
<head>
<title>WTF, Android SDK? → Part III: Geocoder aphasia</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WTF，安卓SDK？→第三部分:地理编码器失语症</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/wtf-android-sdk-part-iii-geocoder-aphasia-3bb8b9b6016b?source=collection_archive---------6-----------------------#2017-08-17">https://medium.com/hackernoon/wtf-android-sdk-part-iii-geocoder-aphasia-3bb8b9b6016b?source=collection_archive---------6-----------------------#2017-08-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/97a55b22feb53ec9a1eea7b55408d7fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ComVe1NjJLLV8-u3sXp-Lw.jpeg"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">“Oh shit, not again!”</figcaption></figure><div class=""/><div class=""><h2 id="a88d" class="pw-subtitle-paragraph jg ii ij bd b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ek translated">或者它是如何停止工作的，你对此无能为力</h2></div><p id="60cf" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">因此，情况是这样的:您希望获得一组坐标(纬度和经度)的可读地址，这些坐标是您刚刚使用LocationManager API或FusedLocation API检索的。</p><p id="4000" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">Stack Overflow上的一个好心的陌生人……是啊，不是——Stack Overflow上的一个彻头彻尾的鸡巴洞让你在编辑、锁定然后删除你的帖子之前应该使用Android的Geocoder API，这是一个惊人的Neckbeard能力展示，他妈的是啊。</p><p id="f916" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">毫不担心，你谷歌“地理编码器”，并决定使用它来获得你的坐标地址。很快，您发现Geocoder有一个名为<strong class="ka ik"> getFromLocation() </strong>的方法，它返回一组坐标的地址列表。正是医生吩咐的！</p><pre class="ku kv kw kx fq ky kz la lb aw lc dt"><span id="f3de" class="ld le ij kz b fv lf lg l lh li">List&lt;Address&gt; addresses = new ArrayList&lt;Address&gt;(); <br/>Geocoder geocoder = new Geocoder(this, Locale.getDefault()); </span><span id="0c91" class="ld le ij kz b fv lj lg l lh li">try { <br/>         addresses = geocoder.<strong class="kz ik">getFromLocation</strong>(latitude, longitude, 1); <br/>   } catch (IOException e) { </span><span id="3cb4" class="ld le ij kz b fv lj lg l lh li">         e.printStackTrace(); </span><span id="4e67" class="ld le ij kz b fv lj lg l lh li">}</span></pre><p id="f24f" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">getFromLocation()中传递的第三个参数是您希望获得的最大结果数，在本例中为1。</p><p id="833a" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">你让这个方法完成它的工作(警告:这需要一个互联网连接，它发生在UI线程上，你已经被警告过了)，如果你幸运的话，它一返回你就得到一个列表<address>和一个结果。然后从地址对象中提取地址</address></p><pre class="ku kv kw kx fq ky kz la lb aw lc dt"><span id="9a4a" class="ld le ij kz b fv lf lg l lh li">String city = “unknown location”; <br/>String country = “unknown location”; <br/>String address = “unknown address”; </span><span id="c064" class="ld le ij kz b fv lj lg l lh li">try { </span><span id="6751" class="ld le ij kz b fv lj lg l lh li">     city = addresses.get(0).getAddressLine(1); <br/>     country = addresses.get(0).getAddressLine(2); <br/>     address = addresses.get(0).getAddressLine(0); </span><span id="4aa0" class="ld le ij kz b fv lj lg l lh li">    } catch (Exception e) { </span><span id="430c" class="ld le ij kz b fv lj lg l lh li">     city = “unknown location”; <br/>     country = “unknown location”; <br/>     address = “unknown address”; </span><span id="8815" class="ld le ij kz b fv lj lg l lh li">}</span></pre><p id="cb83" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">有时，当调用getAddressLine()方法时，您会得到一个空值，因此您必须进行通常的尽职调查。</p><p id="1f68" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">到目前为止，一切顺利。没有你没见过的。现在，让我引用一下<a class="ae lk" href="https://developer.android.com/reference/android/location/Geocoder.html" rel="noopener ugc nofollow" target="_blank"> Geocoder的官方文档</a></p><blockquote class="ll lm ln"><p id="a197" class="jy jz lo ka b kb kc jk kd ke kf jn kg lp ki kj kk lq km kn ko lr kq kr ks kt hn dt translated">Geocoder类需要一个不包含在核心android框架中的后端服务。</p></blockquote><p id="d090" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">这很有意义(尽管他们忘了大写“Android ”,这导致我的IBS再次爆发),因为查找自然会在线发生。</p><p id="5e09" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">现在，我挑战你去Geocoder的文档页面，找到任何提到的关于你可以调用Geocoder后端服务的次数的限制。来吧，我谅你也不敢。</p><figure class="ku kv kw kx fq hw"><div class="bz el l di"><div class="ls lt l"/></div></figure><p id="1af4" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">剧透警告:你将一无所获。官方文件中没有提到这个事实。</p><p id="3bfd" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">这不是开玩笑。在对Geocoder后端服务进行一定次数的调用后(或者一定的调用频率或其他——这是关键:没有人知道),返回的Address对象的每个地址行将包含null。</p><p id="5470" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">在logcat中，您不会得到任何有关这方面的警告。你不会收到一封电子邮件告诉你已经超过了某个限度，你肯定也不会有一个谷歌工程师打电话给你，以确保你没事，如果你想喝点茶。</p><p id="464b" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">不，你的应用程序会从这个样子</p><figure class="ku kv kw kx fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lu"><img src="../Images/ca6e901a802ce27f86e38277979015d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BGpHMXOxAojKRsX9TcdonA.png"/></div></div></figure><p id="8b8e" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">…变成这样</p><figure class="ku kv kw kx fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lv"><img src="../Images/9614cf6fad790a51d43025557a46ec2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DM_8OVC7OcBvbdrNaXsx6A.png"/></div></div></figure><p id="e688" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">也就是说，如果您已经很好地处理了空值。如果你还没有，祝你好运向你愤怒的用户解释什么是npe。</p><p id="1a1b" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">眼尖的读者可能已经注意到，这两张截图来自不同的设备:一张来自2013款Moto G，另一张分别来自Pixel XL。两次通话相隔几分钟，在同一个Wi-Fi网络上进行，这似乎表明对地理编码器通话的限制是基于每个设备的。</p><p id="e594" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">搜了一下网页，偶然发现了这个<a class="ae lk" href="https://stackoverflow.com/questions/8218764/android-geocoder-quota-limits" rel="noopener ugc nofollow" target="_blank">栈溢出问题</a>(抱歉之前对你那么凶，所以，是因为我爱你)。在有人就此联系了开发者支持之后，这是谷歌支持对此事的回应</p><blockquote class="ll lm ln"><p id="39fc" class="jy jz lo ka b kb kc jk kd ke kf jn kg lp ki kj kk lq km kn ko lr kq kr ks kt hn dt translated"><strong class="ka ik">这个API是为客户端应用程序的合理使用而设计的。它被积极地监控滥用情况(例如，每秒的请求数)，但是您所描述的用例应该没有任何问题。</strong></p></blockquote><p id="b159" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">我不想听起来像一个爱发牢骚的婴儿，但是谷歌的开发者支持真的认为“合理使用”是一个合理的答案吗？而具体是什么构成了<em class="lo">虐</em>？</p><p id="48b6" class="pw-post-body-paragraph jy jz ij ka b kb kc jk kd ke kf jn kg kh ki kj kk kl km kn ko kp kq kr ks kt hn dt translated">这种事情不应该在类文档中提及吗？</p><blockquote class="lw"><p id="e1d0" class="lx ly ij bd lz ma mb mc md me mf kt ek translated">这可能会让你的应用瞬间变得一团糟，但你在文档中没有提到限制，没有提到滥用，也没有提到你的通话被监听。相反，在没有任何警告的情况下，您只是被阻止获取任何有用的数据。</p></blockquote><p id="6bb8" class="pw-post-body-paragraph jy jz ij ka b kb mg jk kd ke mh jn kg kh mi kj kk kl mj kn ko kp mk kr ks kt hn dt translated">WTF，安卓SDK？</p></div></div>    
</body>
</html>