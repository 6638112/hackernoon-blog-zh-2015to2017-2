<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-i-wrote-the-atom-medium-exporter-and-how-you-can-help-make-it-better-9e9e4c401da1?source=collection_archive---------8-----------------------#2016-10-19">https://medium.com/hackernoon/how-i-wrote-the-atom-medium-exporter-and-how-you-can-help-make-it-better-9e9e4c401da1?source=collection_archive---------8-----------------------#2016-10-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><h2 id="af7a" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">我是如何编写Atom Medium Exporter的，以及如何帮助它变得更好</h2><p id="0690" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb ie jc jd je ii jf jg jh im ji jj jk jl hn dt translated">我喜欢Atom文本编辑器。我说出来了。我为Vim、Emacs和Sublime fans做好了准备，但它最适合我和我的用例，这也是你选择编辑器应该考虑的。</p><p id="f22a" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">我喜欢它，因为它是用JavaScript(和CoffeeScript)构建的，很容易定制和破解，即使对于像我这样不是“真正”程序员的人(我是一名作家)也是如此。</p><p id="9037" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">作为一个经常写博客的人，<a class="ae jm" rel="noopener" href="/"> Medium </a>(有时)是一个将我的作品展示给更多读者的好工具。Medium以其写作体验和编辑器界面而自豪，虽然它简单易用，但我喜欢能够离线访问我的作品，并通过版本控制在上面进行协作。我喜欢用Atom来写作😁。</p><p id="e898" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">我看了看是否有任何降价到中等出口的选项，并发现了<a class="ae jm" href="http://ulyssesapp.com/" rel="noopener ugc nofollow" target="_blank">尤利西斯</a> (Mac)编辑器，这是一个很好的应用程序，但对于我需要的一个功能来说太贵了。它使用<a class="ae jm" href="https://github.com/Medium/medium-api-docs" rel="noopener ugc nofollow" target="_blank">中间API </a>来导出你的文本，这让我想知道编写自己的Atom包来做同样的事情不会那么难。</p><p id="ca9e" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">虽然Medium强烈建议您使用他们图形界面进行写作，但他们实际上有一个扩展的API，隐藏了Markdown和HTML的导入选项。答对了。</p><p id="cd10" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">我的包的当前代码处于早期阶段，本教程解释了它是如何工作的。在功能上有许多差距，我将从头到尾强调其中的一些。如果你有任何改进的想法或者想要实现一个特性，那么我鼓励你<a class="ae jm" href="https://github.com/ChrisChinchilla/Medium-Export-for-Atom" rel="noopener ugc nofollow" target="_blank">克隆我的库</a>并提交一个拉请求。</p><h2 id="f6eb" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">Atom包生成器</h2><h2 id="6753" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">不喜欢咖啡？</h2><p id="4373" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb ie jc jd je ii jf jg jh im ji jj jk jl hn dt translated">Atom有一个包生成器包，可以为您构建大量样板代码。我刚刚发现的一个特性是，您可以将它切换为生成基于JavaScript的包，而不是默认的CoffeeScript。CoffeeScript有它的优势，但是JavaScript上的可用文档要多得多，Atom也有计划停止如此频繁地使用CoffeeScript。</p><figure class="jt ju jv jw fq jx fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff js"><img src="../Images/8cf9b7ba89705af1e7088061e986f519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EU8Dgsl66ohj9uHp.png"/></div></div></figure><h2 id="b6f9" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">创建一个包</h2><p id="f057" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb ie jc jd je ii jf jg jh im ji jj jk jl hn dt translated">打开命令托盘，搜索“生成包”命令，并为包命名。在整篇文章中，我鼓励你帮助我开发当前的插件，而不是创建你自己的插件，所以为了避免命名冲突，我建议你使用一个像“你的名字-媒体-导出”这样的名字。确保将代码示例中提到的任何medium-export都改为yourname-medium-export。</p><p id="e57a" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">该命令将在指定目录下创建一个项目文件夹，并在<em class="ke"> ~/中对其进行符号链接。原子/包</em>。我不会过多关注为Atom创建一个包的一般概念，我建议查看<a class="ae jm" href="https://www.sitepoint.com/?s=atom" rel="noopener ugc nofollow" target="_blank">网站上关于主题</a>的教程，而是关注这个包的细节。</p><figure class="jt ju jv jw fq jx fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff kf"><img src="../Images/11cf09e9dff3d0b3d787bf66a1e8e35e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6Ote5BoG3Jwz4HIW.png"/></div></div></figure><h2 id="fc4a" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">访问媒体SDK</h2><p id="b235" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb ie jc jd je ii jf jg jh im ji jj jk jl hn dt translated">为了让生活变得更简单，使用<a class="ae jm" href="https://www.npmjs.com/package/medium-sdk" rel="noopener ugc nofollow" target="_blank">中的JavaScript SDK </a>，因此将其添加到<em class="ke"> package.json. </em>中的包依赖项中</p><p id="cd97" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">首先，您需要<a class="ae jm" href="https://medium.com/me/applications/new" rel="noopener">创建一个新的应用程序</a>，您需要为回调URL添加一个值，但是由于这不是一个web应用程序，所以实际上不会使用它。对于桌面应用程序，您需要使用生成的客户端令牌，然后要求用户提供一个访问令牌，以发布到他们的帐户中。</p><p id="110b" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">在<em class="ke">lib/your name-medium-export . js</em>中的activate函数底部添加以下几行:</p><pre class="jt ju jv jw fq kg kh ki kj aw kk dt"><span id="2e78" class="hs ht hu kh b fv kl km l kn ko">medium = require ('medium-sdk');<br/>client = new medium.MediumClient({<br/>  clientId: '&lt;CLIENT_ID&gt;',<br/>  clientSecret: '&lt;CLIENT_SECRET&gt;'<br/>});<br/><br/>client.setAccessToken(atom.config.get('medium-export.accessToken'));</span></pre><p id="20a8" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">由于客户机令牌是你的(即开发者的)并且不会经常改变，我认为硬编码它们是可以的。这可能意味着其他人可以使用它们，但也是一种更好的用户体验，需要用户进行更少的配置。</p><p id="928d" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">然而，访问令牌对每个用户来说都是个人的(创建并找到<a class="ae jm" rel="noopener" href="/me/settings">这里是</a>)，因此您需要请求将其作为设置选项。初始化文件顶部附近的设置:</p><pre class="jt ju jv jw fq kg kh ki kj aw kk dt"><span id="a05a" class="hs ht hu kh b fv kl km l kn ko">...<br/>export default {<br/>  ...<br/>  modalPanel: null,<br/>  subscriptions: null,<br/>  config: {<br/>    accessToken: {<br/>      type: 'string',<br/>      default: ''<br/>    }<br/>  },<br/>  ...</span></pre><p id="f171" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">这将产生一个帮助用户添加访问令牌的文本字段。</p><figure class="jt ju jv jw fq jx fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff kp"><img src="../Images/e40f6c7c843cce1f6d6acd56f82dbeb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sCLgkF4uuxdREGQXgYGPWA.png"/></div></div></figure><h2 id="5b81" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">获取编辑器内容</h2><p id="9875" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb ie jc jd je ii jf jg jh im ji jj jk jl hn dt translated">导出帖子的命令是从一个打开的文件中运行的，所以首先您需要<a class="ae jm" href="https://atom.io/docs/api/v1.10.2/Workspace#instance-getActiveTextEditor" rel="noopener ugc nofollow" target="_blank">检查是否有一个活动的编辑器</a>来防止向API发送空值:</p><pre class="jt ju jv jw fq kg kh ki kj aw kk dt"><span id="2815" class="hs ht hu kh b fv kl km l kn ko">...<br/>if (editor = atom.workspace.getActiveTextEditor()) {<br/>  ...<br/>}</span></pre><p id="64e3" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">在if语句中，获取文本编辑器内容并为文章设置标题。为了得到标题，我假设减价是有效的，取顶行，假设它是第一级标题，去掉' # '。这可能更灵活，或者使用对话框来手动设置标题。</p><pre class="jt ju jv jw fq kg kh ki kj aw kk dt"><span id="6e2a" class="hs ht hu kh b fv kl km l kn ko">currentText = editor.getText();<br/>postTitle = editor.getTextInBufferRange([[0,2], [0,100]]);<br/>postTitle.replace (/^\s+|\s+$/g, "");</span></pre><p id="ead5" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">接下来，由于Medium SDK，接下来的步骤是获取用户的Medium帐户的详细信息，如果这样做没有错误，<a class="ae jm" href="https://github.com/Medium/medium-api-docs#33-posts" rel="noopener ugc nofollow" target="_blank">创建帖子</a>。</p><pre class="jt ju jv jw fq kg kh ki kj aw kk dt"><span id="f07f" class="hs ht hu kh b fv kl km l kn ko">client.getUser(function (err, user) {<br/>  client.createPost({<br/>    userId: user.id,<br/>    title: postTitle,<br/>    contentFormat: medium.PostContentFormat.MARKDOWN,<br/>    content: currentText,<br/>    publishStatus: medium.PostPublishStatus.DRAFT<br/>  }, function (err, post) {<br/>    console.log(err, user, post)<br/>  })<br/>});</span></pre><p id="a785" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">createPost函数允许您定义要发送到媒体的帖子的各种属性，在我的代码中，我执行了以下操作:</p><ul class=""><li id="c8d5" class="kq kr hu it b iu jn iy jo ie ks ii kt im ku jl kv kw kx ky dt translated">从用户对象中设置userId，一个帖子需要分配给一个用户。</li><li id="fc88" class="kq kr hu it b iu kz iy la ie lb ii lc im ld jl kv kw kx ky dt translated">标题，来自前面创建的变量。</li><li id="f0a1" class="kq kr hu it b iu kz iy la ie lb ii lc im ld jl kv kw kx ky dt translated">contentFormat，在本例中是medium。PostContentFormat.MARKDOWN，但也可能是medium.PostContentFormat.HTML。一种改进是检测文件类型并相应地进行设置。</li><li id="2d10" class="kq kr hu it b iu kz iy la ie lb ii lc im ld jl kv kw kx ky dt translated">先前创建的变量的内容。</li><li id="5133" class="kq kr hu it b iu kz iy la ie lb ii lc im ld jl kv kw kx ky dt translated">publishStatus，设置为中。这样用户就有机会在发布前检查一切是否正常，但这也可能是一个设置或在导出时定义的。</li></ul><p id="f3cd" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">你还可以用createPost方法发送其他选项，<a class="ae jm" href="https://github.com/Medium/medium-api-docs#33-posts" rel="noopener ugc nofollow" target="_blank">在这里找到完整的引用</a>。</p><h2 id="7068" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">触发命令</h2><p id="ce5d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb ie jc jd je ii jf jg jh im ji jj jk jl hn dt translated">剩下的就是将功能绑定到命令和键盘快捷键上。</p><p id="36dc" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">将package trigger命令改为与函数更相关的命令:</p><pre class="jt ju jv jw fq kg kh ki kj aw kk dt"><span id="46ac" class="hs ht hu kh b fv kl km l kn ko">this.subscriptions.add(atom.commands.add('atom-workspace', {<br/>  'medium-export:export': () =&gt; this.export()<br/>}));</span></pre><p id="974b" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">重命名现有的切换功能，并删除console.log命令:</p><pre class="jt ju jv jw fq kg kh ki kj aw kk dt"><span id="fa7f" class="hs ht hu kh b fv kl km l kn ko">...<br/>export() {<br/>  return (<br/>    this.modalPanel.isVisible() ?<br/>    this.modalPanel.hide() :<br/>    this.modalPanel.show()<br/>  );<br/>}<br/>...</span></pre><p id="d86e" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">这个函数将切换Atom package generator添加的模态视图(<em class="ke">lib/your name-medium-export-view . js</em>)，以便在文章导出后通知用户。这种模态对话可以被改进，以向用户显示到媒体上的新帖子的链接。</p><p id="295c" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">现在只需更改模式中显示的文本:</p><pre class="jt ju jv jw fq kg kh ki kj aw kk dt"><span id="e31a" class="hs ht hu kh b fv kl km l kn ko">...<br/>message.textContent = 'Your file has been exported to Medium.';<br/>...</span></pre><p id="fd10" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">在<em class="ke">key maps/your name-medium-export . JSON</em>中，您可以定义一个快捷键来触发导出，并更新它调用的函数:</p><pre class="jt ju jv jw fq kg kh ki kj aw kk dt"><span id="aeba" class="hs ht hu kh b fv kl km l kn ko">{<br/>  "atom-workspace": {<br/>    "ctrl-alt-e": "medium-export:export"<br/>  }<br/>}</span></pre><p id="4bbb" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">同样地，如果你想在<em class="ke">menus/your name-medium-export . js</em>中保留现有的菜单命令，那么也要改变触发的功能和标签文本。</p><h2 id="d385" class="hs ht hu bd hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq dt translated">博客，博客和客场</h2><p id="2a12" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb ie jc jd je ii jf jg jh im ji jj jk jl hn dt translated">就是这样！本质上，这个包很简单，可以处理您想处理的大多数格式。我还没有添加对图像、媒体或如何处理<a class="ae jm" href="https://help.medium.com/hc/en-us/articles/214981378-Embeds" rel="noopener">媒体嵌入功能</a>的支持，但我觉得它们不会太难实现。</p><p id="c4c7" class="pw-post-body-paragraph ir is hu it b iu jn iw ix iy jo ja jb ie jp jd je ii jq jg jh im jr jj jk jl hn dt translated">我希望这篇文章能够帮助您理解如何获取Atom文本内容并将其发送给外部服务。如果你想帮助我，那么<a class="ae jm" href="https://github.com/ChrisChinchilla/Medium-Export-for-Atom" rel="noopener ugc nofollow" target="_blank">派生存储库</a>并开始发出拉请求。如果没有，那么我已经帮助你理解了如何做一个有用的内容输出器。</p><h1 id="be5b" class="le ht hu bd hv lf lg lh hz li lj lk id ll lm ln ih lo lp lq il lr ls lt ip lu dt translated">喜欢你看到的吗？</h1><p id="37e5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb ie jc jd je ii jf jg jh im ji jj jk jl hn dt translated"><em class="ke">如果你欣赏我所做的，</em> <a class="ae jm" href="https://www.gregariousmammal.com/connect" rel="noopener ugc nofollow" target="_blank"> <em class="ke">那么我很乐意收到你的来信</em> </a> <em class="ke">，或者</em> <a class="ae jm" href="https://www.gregariousmammal.com/support" rel="noopener ugc nofollow" target="_blank"> <em class="ke">你可以支持我的工作</em> </a> <em class="ke">。</em></p><blockquote class="lv lw lx"><p id="8b43" class="ir is ke it b iu jn iw ix iy jo ja jb ly jp jd je lz jq jg jh ma jr jj jk jl hn dt translated"><a class="ae jm" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jm" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jm" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jm" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="dca4" class="ir is ke it b iu jn iw ix iy jo ja jb ly jp jd je lz jq jg jh ma jr jj jk jl hn dt translated">要了解更多信息，请<a class="ae jm" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">阅读我们的“关于”页面</a>、<a class="ae jm" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">在脸书上点赞/给我们发消息</a>，或者简单地说，<a class="ae jm" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is ke it b iu jn iw ix iy jo ja jb ly jp jd je lz jq jg jh ma jr jj jk jl hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jm" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jm" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote></div></div>    
</body>
</html>