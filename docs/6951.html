<html>
<head>
<title>Google Token Authentication with Laravel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Laravel的Google令牌认证</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/google-token-authentication-with-laravel-22da5e0fbbda?source=collection_archive---------9-----------------------#2017-10-11">https://medium.com/hackernoon/google-token-authentication-with-laravel-22da5e0fbbda?source=collection_archive---------9-----------------------#2017-10-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/d4995386e0a213f05cb897060074959b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*bzVbdlVIn-xS45s5CUHqRw.png"/></div></figure><p id="66f1" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我最近在我工作的一个项目中实现了多因素认证。<a class="jw jx gr" href="https://medium.com/u/dde5a8ca29bc?source=post_page-----22da5e0fbbda--------------------------------" rel="noopener" target="_blank">安东尼奥·里贝罗</a>有一个很棒的软件包可以让这个实现变得非常容易，并且<a class="ae jy" href="https://www.sitepoint.com/2fa-in-laravel-with-google-authenticator-get-secure/" rel="noopener ugc nofollow" target="_blank"> Christopher Thomas </a>为此发布了一个很酷的策略。让我们复习一下这些步骤。</p><h2 id="658f" class="jz ka hu bd kb kc kd ke kf kg kh ki kj jj kk kl km jn kn ko kp jr kq kr ks kt dt translated">1-安装google2fa-laravel</h2><pre class="ku kv kw kx fq ky kz la lb aw lc dt"><span id="c2a5" class="jz ka hu kz b fv ld le l lf lg">composer require pragmarx/google2fa-laravel</span></pre><h2 id="cb74" class="jz ka hu bd kb kc kd ke kf kg kh ki kj jj kk kl km jn kn ko kp jr kq kr ks kt dt translated">2-生成二维码</h2><p id="8961" class="pw-post-body-paragraph iy iz hu ja b jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv hn dt translated">用户首先需要的是启用/禁用多因素身份认证的方法。实现这一点的一个方法是在<code class="eh lm ln lo kz b">GET profile/token</code>上公开一个请求，如果用户没有私钥，这个请求将呈现一个<strong class="ja hv">启用</strong>视图，或者如果用户已经启用了<strong class="ja hv">禁用</strong>视图。</p><figure class="ku kv kw kx fq iv"><div class="bz el l di"><div class="lp lq l"/></div></figure><p id="a493" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在<code class="eh lm ln lo kz b">showEnableTokenForm</code>中，Google2FA Facade将负责生成一个密钥，并生成用户可以用来捕获密钥的二维码。</p><p id="d8de" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">不要忘记通过图像标签显示二维码</p><pre class="ku kv kw kx fq ky kz la lb aw lc dt"><span id="7924" class="jz ka hu kz b fv ld le l lf lg">&lt;img src="{{ $QRCode }}" alt=""&gt;</span></pre><h2 id="633a" class="jz ka hu bd kb kc kd ke kf kg kh ki kj jj kk kl km jn kn ko kp jr kq kr ks kt dt translated">3-存储/删除令牌</h2><p id="7469" class="pw-post-body-paragraph iy iz hu ja b jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv hn dt translated">一旦用户读取QR码，他们可以输入一次性密码并提交给应用程序以验证其激活。</p><figure class="ku kv kw kx fq iv"><div class="bz el l di"><div class="lp lq l"/></div></figure><p id="6919" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">如果用户提交了正确的一次性密码，Google2FA Facade将验证该密码，并将密码存储在用户的表上。</p><h2 id="5a71" class="jz ka hu bd kb kc kd ke kf kg kh ki kj jj kk kl km jn kn ko kp jr kq kr ks kt dt translated">4-认证方法</h2><p id="b0b7" class="pw-post-body-paragraph iy iz hu ja b jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv hn dt translated">激活令牌后，下一步是在登录过程中需要它。在Laravel默认认证系统中，<code class="eh lm ln lo kz b">LoginController</code>带有一个<code class="eh lm ln lo kz b">authenticated</code>方法，可用于在认证后触发一个动作。申请代币的绝佳地点。</p><figure class="ku kv kw kx fq iv"><div class="bz el l di"><div class="lp lq l"/></div></figure><p id="fe0f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">策略是检查<code class="eh lm ln lo kz b">authenticated</code>用户是否有令牌，如果有，要求一次性密码。如果令牌为空，将应用重定向到主页的常规行为。当不是这种情况时，用户被重定向到<code class="eh lm ln lo kz b">/token</code>路线。</p><p id="904f" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated"><em class="lr">注意:确保在用户表中添加google_token列。</em></p><h2 id="1dc2" class="jz ka hu bd kb kc kd ke kf kg kh ki kj jj kk kl km jn kn ko kp jr kq kr ks kt dt translated">5-登录时请求一次性密码</h2><p id="46cf" class="pw-post-body-paragraph iy iz hu ja b jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv hn dt translated"><code class="eh lm ln lo kz b">TokenController</code>将显示一个简单的视图，其中有一个需要一次性密码的输入字段。</p><p id="7179" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在这个视图的表单提交中，目标是检索用户并根据他们的google令牌验证他们的一次性密码。如果匹配，则它们被认证，否则再次询问。</p><figure class="ku kv kw kx fq iv"><div class="bz el l di"><div class="lp lq l"/></div></figure><h2 id="9d43" class="jz ka hu bd kb kc kd ke kf kg kh ki kj jj kk kl km jn kn ko kp jr kq kr ks kt dt translated">6-最后的想法</h2><p id="93a1" class="pw-post-body-paragraph iy iz hu ja b jb lh jd je jf li jh ji jj lj jl jm jn lk jp jq jr ll jt ju jv hn dt translated">这个包使得在任何Laravel应用程序中实现多因素认证变得非常简单。Google2FA Facade只关注生成一个密钥并在必要时验证它，完美地处理了这项工作。<br/>另一个有趣的地方是使用Auth Facade强制注销的策略，同时请求一次性密码并在令牌匹配时依赖<code class="eh lm ln lo kz b">loginUsingId</code>。</p></div></div>    
</body>
</html>