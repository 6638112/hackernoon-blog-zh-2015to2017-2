<html>
<head>
<title>Easily getting a user’s country, currency, timezone or language from their IP address</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从用户的IP地址中轻松获取用户的国家、货币、时区或语言</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/easily-getting-a-users-country-currency-timezone-or-language-from-their-ip-address-5124ea4bba0e?source=collection_archive---------1-----------------------#2017-08-04">https://medium.com/hackernoon/easily-getting-a-users-country-currency-timezone-or-language-from-their-ip-address-5124ea4bba0e?source=collection_archive---------1-----------------------#2017-08-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/bd10b77a3b519a96cd021284ca9aecef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JcKRWLtH3G5wf4IevTlrUQ.jpeg"/></div></div></figure><p id="3731" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在过去的许多项目中，当我不得不使用Geo IP <a class="ae ka" href="https://hackernoon.com/tagged/api" rel="noopener ugc nofollow" target="_blank"> API </a>服务来查找用户的IP地址时，通常是出于几个原因之一——获取用户的国家(用于地理锁定某些功能，或默认到网站的某些部分或类别)，将用户创建的帐户默认为某种货币，让他们的时区适当地保留电子邮件或通知的时间，或设置默认语言。(对于最后一种情况，通常与接受语言HTTP头一起使用)</p><p id="5878" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，您可以使用<a class="ae ka" href="https://usercountry.com" rel="noopener ugc nofollow" target="_blank">用户国家API </a>服务在一个步骤中完成所有这些工作，而不是必须找到一个Geo IP API服务来进行IP查找，然后寻找另一个服务或数据库来进行货币或语言查找。</p><h2 id="a663" class="kb kc hu bd kd ke kf kg kh ki kj kk kl jn km kn ko jr kp kq kr jv ks kt ku kv dt translated">简单REST API</h2><p id="8973" class="pw-post-body-paragraph jc jd hu je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">API调用本身只是一个HTTP GET请求。事实上，你甚至可以在你自己的浏览器上测试它，方法是:<a class="ae ka" href="https://usercountry.com/v1.0/json/173.194.192.101" rel="noopener ugc nofollow" target="_blank">https://usercountry.com/v1.0/json/173.194.192.101</a></p><p id="152b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您将看到一个JSON格式的响应，看起来就像主页上的示例。这已经包含了您想要的该IP用户的关键数据——货币、国家的官方语言和时区信息。还有一些额外的东西，如大陆，更精确的地区数据(甚至邮政编码)。</p><p id="34f7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是一些主要语言的示例代码，展示了从用户的IP地址获取默认货币是多么容易！您可以很容易地修改它们，以获得它们的时区、国家语言或邮政编码。</p><h1 id="70ec" class="lb kc hu bd kd lc ld le kh lf lg lh kl li lj lk ko ll lm ln kr lo lp lq ku lr dt translated">Node.js中的示例代码(使用请求包)</h1><p id="9979" class="pw-post-body-paragraph jc jd hu je b jf kw jh ji jj kx jl jm jn ky jp jq jr kz jt ju jv la jx jy jz hn dt translated">从npm安装<code class="eh ls lt lu lv b">request</code>库:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="1916" class="kb kc hu lv b fv me mf l mg mh">npm install request</span></pre><p id="a0ea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">应用代码:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="a8b2" class="kb kc hu lv b fv me mf l mg mh">import request from 'request';</span><span id="0606" class="kb kc hu lv b fv mi mf l mg mh">request('http://usercountry.com/v1.0/json/173.194.192.101',<br/>  (err, response, body) =&gt; {<br/>    const result = JSON.parse(body);<br/>    result.currency.code;<br/>  }<br/>);</span></pre><h1 id="e3d2" class="lb kc hu bd kd lc ld le kh lf lg lh kl li lj lk ko ll lm ln kr lo lp lq ku lr dt translated">jQuery中的示例</h1><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="8d86" class="kb kc hu lv b fv me mf l mg mh">$.ajax({<br/>  url: 'http://usercountry.com/v1.0/json/173.194.192.101',<br/>  dataType: 'json',<br/>  success: function(result) {<br/>    result.currency.code;<br/>  }<br/>});</span></pre><h1 id="daca" class="lb kc hu bd kd lc ld le kh lf lg lh kl li lj lk ko ll lm ln kr lo lp lq ku lr dt translated">PHP示例代码(使用curl)</h1><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="fb80" class="kb kc hu lv b fv me mf l mg mh">$ch = curl_init();<br/>curl_setopt($ch, CURLOPT_URL, 'http://usercountry.com/v1.0/json/173.194.192.101');<br/>curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);<br/>curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true);<br/>curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 2);<br/>$response = curl_exec($ch);<br/>curl_close($ch);<br/>$result = json_decode($response, true);<br/>$result['currency']['code'];</span></pre><h1 id="92fc" class="lb kc hu bd kd lc ld le kh lf lg lh kl li lj lk ko ll lm ln kr lo lp lq ku lr dt translated">Ruby中的示例代码</h1><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="99c7" class="kb kc hu lv b fv me mf l mg mh">require 'net/http'<br/>require 'json'</span><span id="828c" class="kb kc hu lv b fv mi mf l mg mh">url = 'http://usercountry.com/v1.0/json/173.194.192.101'<br/>uri = URI(url)<br/>response = Net::HTTP.get(uri)<br/>result = JSON.parse(response)<br/>result['currency']['code']</span></pre><h1 id="0ae0" class="lb kc hu bd kd lc ld le kh lf lg lh kl li lj lk ko ll lm ln kr lo lp lq ku lr dt translated">Python中的示例代码</h1><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="a140" class="kb kc hu lv b fv me mf l mg mh">import requests</span><span id="1558" class="kb kc hu lv b fv mi mf l mg mh">r = requests.get('http://usercountry.com/v1.0/json/173.194.192.101')<br/>result = r.json()<br/>result['currency']['code']</span></pre><p id="a343" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">很简单，对吧？</p><p id="5658" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请注意，在以上所有示例中，您应该添加更多的错误检查，比如检查请求是否成功，以及检查响应对象的<code class="eh ls lt lu lv b">status</code>字段，以确保在使用结果之前，它显示来自用户国家API调用的<code class="eh ls lt lu lv b">success</code>。</p><p id="39e2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">编码快乐！</p><figure class="lw lx ly lz fq iv"><div class="bz el l di"><div class="mj mk l"/></div></figure></div></div>    
</body>
</html>