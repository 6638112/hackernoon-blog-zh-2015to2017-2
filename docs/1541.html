<html>
<head>
<title>How Python Makes Working With Data More Difficult in the Long Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从长远来看，Python如何使数据处理变得更加困难</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-python-makes-working-with-data-more-difficult-in-the-long-run-8da7c8e083fe?source=collection_archive---------0-----------------------#2016-11-13">https://medium.com/hackernoon/how-python-makes-working-with-data-more-difficult-in-the-long-run-8da7c8e083fe?source=collection_archive---------0-----------------------#2016-11-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="2e59" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们开始之前，让我们先弄清楚术语。当我在<a class="ae jp" href="https://hackernoon.com/tagged/software-development" rel="noopener ugc nofollow" target="_blank">软件开发</a>的上下文中提到“处理数据”时，我可能指的是以下两种情况之一:</p><ol class=""><li id="5c16" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated"><em class="jz">交互地</em>处理数据，可能使用Jupyter (née IPython)或实时解释器</li><li id="a3df" class="jq jr hu it b iu ka iy kb jc kc jg kd jk ke jo jv jw jx jy dt translated"><em class="jz">编写、测试、阅读、审查</em>和<em class="jz">维护主要操作数据的</em>程序</li></ol><p id="4743" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">简而言之:Python在交互式数据分析方面很棒，但在编写处理复杂数据结构的长期程序方面却很糟糕。</strong></p><p id="7dd8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第二个定义可能过于宽泛，但我会马上澄清。在此之前，让我第一个说<a class="ae jp" href="https://hackernoon.com/tagged/python" rel="noopener ugc nofollow" target="_blank"> Python </a>是一种<strong class="it hv">不可思议的</strong>语言，用于交互式地处理或<em class="jz">探索</em>数据。围绕数据操作、可视化和数据科学涌现出来的第三方包和工具的生态系统已经相当引人注目。</p><p id="7cc5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果处理交互数据是你的专长，Python应该是你的铁锤。</p><p id="137b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是第二种解释呢？实际上，它可以被认为是第一个的逻辑延伸。假设您正在编写一个程序，在数据库中查询一个搜索词，进行一些情感分析，然后用JSON返回结果。与数据库结果、您的情感分析库返回的结果以及您生成的JSON交互工作是自然的第一步。你仍然处于“探索模式”。还没有真正写程序，只是看看数据是什么样子，以及你需要如何操作它。</p><p id="f141" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你对每一步的数据“形状”有了“感觉”，你就可以开始写程序了。在实现程序逻辑时，您可能会回头参考在探索过程中创建的输出示例。特别是对于深度嵌套的数据结构(我正在看你，“每个人对JSON的滥用……”)，在你的头脑中保持数据在每个阶段的“形状”通常太难了。</p><p id="ee7a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是Python使得处理数据变得容易，所以你的程序很快就完成了。它是有效的，有很好的文档记录，甚至有100%的测试覆盖率。如果你永远不需要回到这个代码，万岁！你的任务完成了。</p><h1 id="0e37" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">动态类型是万恶之源(j/k…有点…)</h1><p id="07b1" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">Python的特性使得你的程序很容易编写，但是同样的特性也会使你的程序难以审查、阅读和(最重要的)维护。Python的动态类型系统意味着，在大多数情况下，当数据在系统中移动时，您不必枚举定义数据的完整的字段、类型和值约束。你可以把它全部塞进一个<code class="eh li lj lk ll b">dict</code>！异类价值观FTW！</p><p id="a78e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在C或Go这样的静态类型语言中，上面的任务会更加费力和耗时。例如，在Go中，为了解析并返回来自某个web API的JSON响应，首先需要创建一个<code class="eh li lj lk ll b">struct</code>，它的字段和字段类型<em class="jz">与响应的结构</em>完全匹配。下面是如何准备使用来自<code class="eh li lj lk ll b"><a class="ae jp" href="https://github.com/coreos/etcd" rel="noopener ugc nofollow" target="_blank">etcd</a></code>的JSON响应(取自他们的客户库):</p><pre class="lm ln lo lp fq lq ll lr ls aw lt dt"><span id="c2b8" class="lu kg hu ll b fv lv lw l lx ly">type Response struct {<br/> // Action is the name of the operation that occurred. Possible values<br/> // include get, set, delete, update, create, compareAndSwap,<br/> // compareAndDelete and expire.<br/> Action string `json:"action"`</span><span id="704c" class="lu kg hu ll b fv lz lw l lx ly">// Node represents the state of the relevant etcd Node.<br/> Node *Node `json:"node"`</span><span id="9137" class="lu kg hu ll b fv lz lw l lx ly">// PrevNode represents the previous state of the Node. PrevNode is non-nil<br/> // only if the Node existed before the action occurred and the action<br/> // caused a change to the Node.<br/> PrevNode *Node `json:"prevNode"`</span><span id="51f9" class="lu kg hu ll b fv lz lw l lx ly">// Index holds the cluster-level index at the time the Response was generated.<br/> // This index is not tied to the Node(s) contained in this Response.<br/> Index uint64 `json:"-"`<br/>}</span><span id="877f" class="lu kg hu ll b fv lz lw l lx ly">type Node struct {<br/> // Key represents the unique location of this Node (e.g. "/foo/bar").<br/> Key string `json:"key"`</span><span id="a916" class="lu kg hu ll b fv lz lw l lx ly">// Dir reports whether node describes a directory.<br/> Dir bool `json:"dir,omitempty"`</span><span id="0a02" class="lu kg hu ll b fv lz lw l lx ly">// Value is the current data stored on this Node. If this Node<br/> // is a directory, Value will be empty.<br/> Value string `json:"value"`</span><span id="95f4" class="lu kg hu ll b fv lz lw l lx ly">// Nodes holds the children of this Node, only if this Node is a directory.<br/> // This slice of will be arbitrarily deep (children, grandchildren, great-<br/> // grandchildren, etc.) if a recursive Get or Watch request were made.<br/> Nodes Nodes `json:"nodes"`</span><span id="c745" class="lu kg hu ll b fv lz lw l lx ly">// CreatedIndex is the etcd index at-which this Node was created.<br/> CreatedIndex uint64 `json:"createdIndex"`</span><span id="f550" class="lu kg hu ll b fv lz lw l lx ly">// ModifiedIndex is the etcd index at-which this Node was last modified.<br/> ModifiedIndex uint64 `json:"modifiedIndex"`</span><span id="41e0" class="lu kg hu ll b fv lz lw l lx ly">// Expiration is the server side expiration time of the key.<br/> Expiration *time.Time `json:"expiration,omitempty"`</span><span id="71a1" class="lu kg hu ll b fv lz lw l lx ly">// TTL is the time to live of the key in second.<br/> TTL int64 `json:"ttl,omitempty"`<br/>}</span></pre><p id="8a77" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每个字段后的“<code class="eh li lj lk ll b">json:...</code>”部分描述了从JSON消息中封送对象时该字段的名称。注意，因为<code class="eh li lj lk ll b">Response</code>包含一个嵌套对象(<code class="eh li lj lk ll b">Node</code>)，我们也必须完全定义这个嵌套对象。</p><p id="9f3f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jz">注意:公平地说，这里有</em> <strong class="it hv"> <em class="jz">和</em> </strong> <em class="jz">一些快捷方式，人们可能会在Go中采用它们来减少对上述部分的需求，但它们很少被采用(并且有很好的理由)。</em></p><p id="96ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Python中，你可能会说:</p><pre class="lm ln lo lp fq lq ll lr ls aw lt dt"><span id="1cb3" class="lu kg hu ll b fv lv lw l lx ly">result = make_etcd_call("some", "arguments", "here")</span></pre><p id="7e19" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想知道这个<code class="eh li lj lk ll b">node</code>是不是一个目录，你可以敲出来:</p><pre class="lm ln lo lp fq lq ll lr ls aw lt dt"><span id="7d7b" class="lu kg hu ll b fv lv lw l lx ly">if result.json()['node']['dir']:<br/>    # make magic happen...</span></pre><p id="ee3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Python版本比Go版本代码更少，编写时间更短。</p><h1 id="bb6e" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">“我看不出有什么问题”</h1><p id="aef5" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">Python版本比较好吧？让我们考虑一下“好代码”的两种定义，这样我们就可以清楚我们所说的更好是什么意思。</p><ol class=""><li id="4ea3" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">短小、简洁且可以快速编写的代码</li><li id="b167" class="jq jr hu it b iu ka iy kb jc kc jg kd jk ke jo jv jw jx jy dt translated">可维护的代码</li></ol><p id="0463" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们使用第一个定义，Python版本“更好”。如果我们用第二个，<strong class="it hv">那就糟糕多了。</strong>Go版本，尽管包含了一大堆样板式的定义代码，<em class="jz">明确了我们可以在</em> <code class="eh li lj lk ll b"><em class="jz">result</em></code>中预期的数据的确切结构。</p><blockquote class="ma mb mc"><p id="0305" class="ir is jz it b iu iv iw ix iy iz ja jb md jd je jf me jh ji jj mf jl jm jn jo hn dt translated">老板:“你能告诉我关于Python版本的什么，只看我们上面的代码？”</p><p id="54f1" class="ir is jz it b iu iv iw ix iy iz ja jb md jd je jf me jh ji jj mf jl jm jn jo hn dt translated">我:“嗯，它是JSON，有一个‘node’对象，这个对象可能有一个‘dir’字段。”</p><p id="cae3" class="ir is jz it b iu iv iw ix iy iz ja jb md jd je jf me jh ji jj mf jl jm jn jo hn dt translated">老板:<code class="eh li lj lk ll b">dir</code>里是什么类型的值？它是布尔值、字符串还是嵌套对象？”</p><p id="95a6" class="ir is jz it b iu iv iw ix iy iz ja jb md jd je jf me jh ji jj mf jl jm jn jo hn dt translated">我:“呃，我不知道。不过，这是真的！”</p><p id="fa7f" class="ir is jz it b iu iv iw ix iy iz ja jb md jd je jf me jh ji jj mf jl jm jn jo hn dt translated">老板:“Python里的其他东西也是。是否保证<code class="eh li lj lk ll b">dir</code>是响应中<code class="eh li lj lk ll b">node</code>对象的一部分？”</p><p id="9782" class="ir is jz it b iu iv iw ix iy iz ja jb md jd je jf me jh ji jj mf jl jm jn jo hn dt translated">我:“呃....”</p></blockquote><p id="0d4c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经达到了描述一部分代码的“3-Uh”限制。如果你参考Go版本，你可以回答这些问题，相比之下听起来像一个该死的天才。</p><p id="bc48" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是这些正是你的同事在代码评审中应该问的问题。Go版的问题答案不言而喻。Python版本的答案就没那么多了…</p><h1 id="b410" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">做出改变</h1><p id="243f" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">当我们需要对Python版本进行更改时会发生什么？也许我们想说“只有<code class="eh li lj lk ll b">make magic happen</code>的目录才被创建，而不是对每个响应都有一个目录？”</p><p id="26c4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Go版本中，如何做到这一点非常清楚。与Python版本相比，Go版本就像是<code class="eh li lj lk ll b">etcd</code> <code class="eh li lj lk ll b">Response</code>的亚历山大图书馆。对于Python版本来说，<em class="jz">我们没有任何本地参考来找出</em> <code class="eh li lj lk ll b"><em class="jz">result</em></code> <em class="jz">的结构和我们需要做出的改变。我们必须去查阅HTTP API文档。让我们希望:</em></p><ul class=""><li id="247b" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo mg jw jx jy dt translated">它存在</li><li id="238e" class="jq jr hu it b iu ka iy kb jc kc jg kd jk ke jo mg jw jx jy dt translated">它保养得很好</li><li id="8984" class="jq jr hu it b iu ka iy kb jc kc jg kd jk ke jo mg jw jx jy dt translated">管道没有堵塞</li></ul><p id="2684" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是一个<em class="jz">非常</em>简单的变化，我们正在谈论一个<em class="jz">非常</em>简单的JSON对象。我可以讲一些恐怖的故事，当你在Elasticsearch JSON回复中陷入困境时会发生什么…(剧透警告:<code class="eh li lj lk ll b">response['hits_']['hits_']['hits_']...</code>)。</p><p id="3218" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然而，乐趣并不仅仅停留在<em class="jz">改变</em>代码上。请记住，我们是专业人士，所以我们所有的代码都经过了同行评审和单元测试。在正确更新了代码<em class="jz"/>之后，我们仍然几乎不能对它进行推理。突然间，我们又回到了我和老板之间的对话，我说了很多“嗯”，他想知道为什么他没有去做木工。</p><h1 id="fbd7" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">大家都慌了！</h1><p id="3624" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">我已经描绘了一幅使用Python以可维护的方式操作复杂(甚至不那么复杂)的数据结构的暗淡画面。然而，事实上，这是大多数动态语言共有的缺点。在本文的后半部分，我将描述不同的人/公司正在做的事情，从简单的事情，如走向“编辑器中的动态数据”<a class="ae jp" href="https://www.dropbox.com/s/efatwr0pozsargb/PyCon%20mypy%20talk%202016.pdf?dl=0" rel="noopener ugc nofollow" target="_blank">一直到Dropboxian的“类型注释所有的东西”</a>。简而言之，在这个领域有很多有趣的工作在进行，并且<em class="jz">很多人</em>都参与其中(注意Dropbox面板中第二个演讲者的名字)。</p><p id="2049" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jz">原载于2016年11月13日</em><a class="ae jp" href="https://jeffknupp.com/blog/2016/11/13/how-python-makes-working-with-data-more-difficult-in-the-long-run/" rel="noopener ugc nofollow" target="_blank"><em class="jz">jeffknupp.com</em></a><em class="jz">。</em></p><blockquote class="ma mb mc"><p id="4e8d" class="ir is jz it b iu iv iw ix iy iz ja jb md jd je jf me jh ji jj mf jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿妹家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>的机会。</p><p id="dca4" class="ir is jz it b iu iv iw ix iy iz ja jb md jd je jf me jh ji jj mf jl jm jn jo hn dt translated">要了解更多信息，请阅读我们的“关于”页面、<a class="ae jp" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">喜欢/在脸书上给我们发消息</a>，或者简单地发送<a class="ae jp" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank"> tweet/DM @HackerNoon。</a></p><p id="708a" class="ir is jz it b iu iv iw ix iy iz ja jb md jd je jf me jh ji jj mf jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="lm ln lo lp fq mh"><div class="bz el l di"><div class="mi mj l"/></div></figure></div></div>    
</body>
</html>