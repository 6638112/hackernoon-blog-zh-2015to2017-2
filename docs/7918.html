<html>
<head>
<title>Implementing basic Component tests using Jest and Enzyme</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jest和Enzyme实现基本组件测试</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/implementing-basic-component-tests-using-jest-and-enzyme-d1d8788d627a?source=collection_archive---------1-----------------------#2017-11-13">https://medium.com/hackernoon/implementing-basic-component-tests-using-jest-and-enzyme-d1d8788d627a?source=collection_archive---------1-----------------------#2017-11-13</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4abe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这可能是我将要做的关于测试React组件和TDD的两篇文章中的第一篇。这一部分处理Jest和Enzyme库的设置，然后为登录组件编写几个基本测试。在我的下一篇文章中，我希望能更详细地介绍这些库，以及我们如何测试包含Redux的更复杂的组件。因此，让我们开始吧！</p><h1 id="4c59" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">什么是玩笑？</h1><p id="1f94" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">Jest是一个测试库，可以用来测试简单的Javascript代码或React组件。这是通过Jest提供给用户的简单API来完成的。使用这个API，可以断言函数应该如何运行，然后根据测试结果测试我们的预期结果。它非常容易设置，开箱即可使用。这就是为什么它是脸书首选的测试库。Jest的一个很酷的功能是快照。这将对组件及其渲染方式进行快照，然后在进行其他测试时进行比较，让您知道是否发生了意想不到的事情。我不会对快照进行过多的描述，因为我会在另一篇文章中介绍。使用Jest和Enzyme时，可以通过模拟DOM测试组件。</p><h1 id="9df3" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">酶是什么？</h1><p id="eda1" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">酶是另一个常用于Jest或Mocha和Chai的库。有了Enzyme，我们可以创建一个模拟DOM来测试组件是否被正确呈现，以及它们在被操作时是否表现正确。Enzyme的模拟渲染既可以通过浅层渲染完成，也可以通过全DOM渲染完成。</p><p id="204a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">浅渲染</strong>在对一个组件进行单元测试时使用。这允许测试只关注那个组件以及它是如何工作的，而不关心它可能与之交互的其他组件。</p><p id="ab46" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">全DOM渲染</strong>包括渲染你的组件和所有子组件。允许进行更深入的测试，以了解DOM上的组件如何相互交互。</p><h1 id="111c" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">设置笑话和酶</h1><p id="7529" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">首先，让我们将Jest和Enzyme添加到React应用程序中。要安装Jest，只需运行以下代码，</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="ead1" class="lb jq hu kx b fv lc ld l le lf">npm install --save-dev jest</span></pre><p id="b59f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您使用Create React App来构建应用程序的基础，那么它可能已经安装了。Enzyme需要安装几个包。首先，我们将安装酶和适当的适配器。我们必须指定使用哪个版本的React来获得正确的测试适配器。我使用的是React 15.6.1，所以我将要安装的包是</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="bc69" class="lb jq hu kx b fv lc ld l le lf">npm install --save-dev enzyme enzyme-adapter-react-15</span></pre><p id="98b1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">适配器包的完整列表可以在<a class="ae lg" href="https://github.com/airbnb/enzyme#upgrading-from-enzyme-2x-or-react--16" rel="noopener ugc nofollow" target="_blank">这里</a>找到。接下来我们将安装Jest酶包，这样我们就可以像这样一起使用它们，</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="d360" class="lb jq hu kx b fv lc ld l le lf">npm install --save-dev jest-enzyme</span></pre><p id="2711" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们已经安装了两个库，我们还需要设置一些东西。首先让我们建立我们的文件结构。通常最好让组件测试靠近组件代码。因此，让我们在组件文件夹中创建一个名为__tests__的子文件夹。我们将在这里为每个组件创建一个文件来编写我们的测试。</p><p id="373e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们需要设置的最后一件事是我们的适配器。为了将Enzyme与React一起使用，我们需要创建另一个文件，并告诉Enzyme根据我们的React版本使用什么适配器。这是我们将使用之前安装的软件包的地方，它对应于我们的React版本。因为我使用了Create React App，所以我们可以在src文件夹中创建一个名为setupTests.js的文件。代码应该是这样的</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="efee" class="lb jq hu kx b fv lc ld l le lf">// in app/src/setupTests.js file</span><span id="5417" class="lb jq hu kx b fv lh ld l le lf">const Enzyme = require('enzyme');</span><span id="2e7b" class="lb jq hu kx b fv lh ld l le lf">// this is where we reference the adapter package we installed  <br/>// earlier<br/>const EnzymeAdapter = require('enzyme-adapter-react-15');</span><span id="c2dd" class="lb jq hu kx b fv lh ld l le lf">// This sets up the adapter to be used by Enzyme<br/>Enzyme.configure({ adapter: new EnzymeAdapter() });</span></pre><h1 id="f40b" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">开始测试的时间</h1><p id="1095" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">现在我们已经设置好了一切，我们可以开始编写测试了。我们将要测试的组件是一个简单的登录组件。我们将在之前创建的__tests__文件夹中创建测试文件。它应该是这样的，</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="e6fd" class="lb jq hu kx b fv lc ld l le lf">// path with the example test file name<br/>app/src/components/__tests__/Login-test.js</span></pre><p id="5987" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您像我一样对这两个库都不熟悉，我建议查看它们的文档，以便确定用于您的测试的正确的API方法。我们要做的第一件事是从酶中导入我们的组件、反应和一些功能。我们将从Enzyme导入shallow、mount和render，因为这些会模仿我们在DOM中的组件呈现。我们现在只使用shallow，因为我们不需要测试这个组件和其他组件之间的交互。</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="a4ab" class="lb jq hu kx b fv lc ld l le lf">// Login-test.js</span><span id="2e10" class="lb jq hu kx b fv lh ld l le lf">import React from 'react';<br/>import { shallow, mount, render } from 'enzyme';<br/>import Login from '../Login';</span></pre><p id="2a0e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以通常在测试驱动开发(TDD)中，我们首先编写测试，然后编写函数或组件来通过这些测试。但是由于这是一个例子，我将给出组件的示例代码，看看我们如何选择要测试的代码部分。</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="b5cf" class="lb jq hu kx b fv lc ld l le lf">// app/src/components/Login.js</span><span id="70cd" class="lb jq hu kx b fv lh ld l le lf">import React from 'react';</span><span id="b223" class="lb jq hu kx b fv lh ld l le lf">class Login extends React.Component {</span><span id="2854" class="lb jq hu kx b fv lh ld l le lf">constructor() {<br/>  super()<br/>  this.state = {<br/>   username: '',<br/>   password: ''<br/>  }<br/> }</span><span id="474a" class="lb jq hu kx b fv lh ld l le lf">handleInputChange = (event) =&gt; {<br/>  this.setState({<br/>   [event.target.name]: event.target.value<br/>  })<br/> }</span><span id="4b15" class="lb jq hu kx b fv lh ld l le lf">render() {<br/>  return (<br/>   &lt;form className='login'&gt;<br/>     &lt;label&gt;Username&lt;/label&gt;<br/>     &lt;input id='email' onChange={this.handleInputChange} name='email' type='text' /&gt;<br/>     &lt;label&gt;Password&lt;/label&gt;<br/>     &lt;input id='password' onChange={this.handleInputChange} name='password' type='password' /&gt;<br/>     &lt;button&gt;Submit&lt;/button&gt;<br/>   &lt;/form&gt;<br/>  )<br/> }<br/>}</span><span id="3d36" class="lb jq hu kx b fv lh ld l le lf">export default Login</span></pre><p id="c25f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，首先我们编写describe函数来描述我们正在测试的内容，然后我们编写关于组件某些部分的行为的断言。这个测试检查我们的组件是否正确地呈现在DOM中，</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="f794" class="lb jq hu kx b fv lc ld l le lf">import React from 'react';<br/>import { shallow, mount, render } from 'enzyme';<br/>import Login from '../Login'</span><span id="bfab" class="lb jq hu kx b fv lh ld l le lf">// describe what we are testing<br/>describe('Login Component', () =&gt; {<br/> <br/> // make our assertion and what we expect to happen <br/> it('should render without throwing an error', () =&gt; {<br/>   expect(shallow(&lt;Login /&gt;).find('form.login').exists()).toBe(true)<br/> })<br/>})</span></pre><p id="9905" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个测试只是简单地呈现我们的登录组件，然后我们检查表单节点是否存在于呈现的HTML中。既然我们知道表单可以成功呈现，我们可以添加几个更简单的测试来确保表单上的输入也可以正确呈现。</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="7c7d" class="lb jq hu kx b fv lc ld l le lf">// within the Login components describe function</span><span id="4b41" class="lb jq hu kx b fv lh ld l le lf">it('renders a email input', () =&gt; {<br/>  expect(shallow(&lt;Login /&gt;).find('#email').length).toEqual(1)<br/> })</span><span id="6ec3" class="lb jq hu kx b fv lh ld l le lf">it('renders a password input', () =&gt; {<br/>  expect(shallow(&lt;Login /&gt;).find('#password').length).toEqual(1)<br/> })</span></pre><p id="89b8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这两个测试中，我们都使用了Enzyme提供的find功能，使用它们的id来查找我们的输入。由于find返回所有与我们的搜索词匹配的节点，我们只是检查以确保每个输入都有一个。我们可以简单地检查长度，看看节点是否存在。</p><p id="211f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们继续模拟输入变化。这是一个受控的表单，因此我们可以测试输入何时被更改，以查看它是否成功地更改了我们的登录组件的状态。为此，我们将使用Enzyme提供的simulate函数，并将模拟事件对象作为第二个参数传入。测试看起来会像这样，</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="b687" class="lb jq hu kx b fv lc ld l le lf">// within the Login components describe function</span><span id="d45a" class="lb jq hu kx b fv lh ld l le lf">describe('Email input', () =&gt; {<br/>  <br/>  it('should respond to change event and change the state of the Login Component', () =&gt; {<br/>   <br/>   const wrapper = shallow(&lt;Login /&gt;);<br/>   wrapper.find('#email').simulate('change', {target: {name: 'email', value: '<a class="ae lg" href="mailto:blah@gmail.com" rel="noopener ugc nofollow" target="_blank">blah@gmail.com</a>'}});<br/>   <br/>  expect(wrapper.state('email')).toEqual('<a class="ae lg" href="mailto:blah@gmail.com" rel="noopener ugc nofollow" target="_blank">blah@gmail.com</a>');<br/>  })<br/> })<br/> <br/> describe('Password input', () =&gt; {<br/>  <br/>  it('should respond to change event and change the state of the Login Component', () =&gt; {<br/>   <br/>   const wrapper = shallow(&lt;Login /&gt;);<br/>   wrapper.find('#password').simulate('change', {target: {name: 'password', value: 'cats'}});<br/>   <br/>   expect(wrapper.state('password')).toEqual('cats');<br/>  })<br/> })</span></pre><p id="3c59" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，当我们在登录组件上调用shallow时，它不是返回呈现的组件，而是返回组件的包装版本。这就是为什么我将wrapper的值设置为浅层呈现的登录组件。接下来，我们用模拟的事件数据模拟一个调用我们的输入的变更事件。模拟功能的工作方式是它实际上并不模拟事件。相反，它在所选节点上寻找与该事件对应的属性，在本例中是onChange，并调用它传递我们的模拟事件数据。</p><p id="8f7d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们模拟事件之后，我们检查整个登录组件的状态。我们确保在输入改变后，onChange函数被正确调用并且行为正常。</p><p id="f2cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所有这些测试都是这样编写的，终端中的输出应该是这样的，</p><figure class="ks kt ku kv fq lj fe ff paragraph-image"><div class="fe ff li"><img src="../Images/e2514f1a0b523f2a8c15c05cd2c61446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*lxUVDJPtrH-KD51KjG0HKw.png"/></div></figure><h1 id="0016" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">摘要</h1><p id="e59c" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">这些例子只是一些简单的测试，你可以用Jest和Enzyme来编写。这些例子最重要的部分是它们的结构。无论何时编写测试，无论使用什么测试库，恰当地构建它们总是很重要的。这意味着在describe functions下逻辑地组织你的测试，一次只关注组件的一部分。注意我是如何为我的两个输入包含一个describe函数的，以便清楚地表明那些测试集中在组件的那些特定部分。这使得其他程序员更容易理解和阅读测试。希望现在您已经了解了如何安装这些库，以及如何开始为您的组件编写基本测试！查看下面的参考资料，了解Jest和Enzyme允许您使用哪些功能的更多文档！</p><p id="b7a4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lm">查看我的下一篇</em> <a class="ae lg" rel="noopener" href="/@lukepierotti/snapshot-testing-react-components-with-jest-744a1e980366"> <em class="lm">帖子</em> </a> <em class="lm">了解Jest的快照测试。有关如何测试Redux连接组件的信息，请查看我的新</em> <a class="ae lg" rel="noopener" href="/@lukepierotti/unit-testing-redux-connected-components-692fa3c4441c"> <em class="lm">帖子</em> </a> <em class="lm">。</em></p><h1 id="2c6e" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">来源:</h1><div class="ln lo fm fo lp lq"><a href="https://github.com/airbnb/enzyme#enzyme" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab ej"><div class="ls ab lt cl cj lu"><h2 class="bd hv fv z el lv eo ep lw er et ht dt translated">Airbnb/酵素</h2><div class="lx l"><h3 class="bd b fv z el lv eo ep lw er et ek translated">React的酶- JavaScript测试实用程序</h3></div><div class="ly l"><p class="bd b gc z el lv eo ep lw er et ek translated">github.com</p></div></div><div class="lz l"><div class="ma l mb mc md lz me lk lq"/></div></div></a></div><div class="ln lo fm fo lp lq"><a href="https://github.com/airbnb/enzyme/blob/master/docs/api/shallow.md" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab ej"><div class="ls ab lt cl cj lu"><h2 class="bd hv fv z el lv eo ep lw er et ht dt translated">shallownrenderingapi</h2><div class="lx l"><h3 class="bd b fv z el lv eo ep lw er et ek translated">React的酶- JavaScript测试实用程序</h3></div><div class="ly l"><p class="bd b gc z el lv eo ep lw er et ek translated">github.com</p></div></div><div class="lz l"><div class="mf l mb mc md lz me lk lq"/></div></div></a></div><div class="ln lo fm fo lp lq"><a href="http://facebook.github.io/jest/" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab ej"><div class="ls ab lt cl cj lu"><h2 class="bd hv fv z el lv eo ep lw er et ht dt translated">笑话🃏愉快的JavaScript测试</h2><div class="lx l"><h3 class="bd b fv z el lv eo ep lw er et ek translated">🃏令人愉快的JavaScript测试</h3></div><div class="ly l"><p class="bd b gc z el lv eo ep lw er et ek translated">🃏令人愉快的JavaScript测试facebook.github.io</p></div></div><div class="lz l"><div class="mg l mb mc md lz me lk lq"/></div></div></a></div></div></div>    
</body>
</html>