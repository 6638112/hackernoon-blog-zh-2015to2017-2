<html>
<head>
<title>Creating a todolist backend with persistence</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建具有持久性的todolist后端</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/creating-a-todolist-backend-with-persistence-a1e8d7d39f62?source=collection_archive---------21-----------------------#2017-10-19">https://medium.com/hackernoon/creating-a-todolist-backend-with-persistence-a1e8d7d39f62?source=collection_archive---------21-----------------------#2017-10-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="daa3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个<a class="ae jp" href="https://hackernoon.com/tagged/todolist" rel="noopener ugc nofollow" target="_blank"> todolist </a>项目有助于展示为小应用程序构建一个<a class="ae jp" href="https://hackernoon.com/tagged/backend" rel="noopener ugc nofollow" target="_blank">后端</a>。本文将涵盖以下几个方面</p><ul class=""><li id="e16f" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">拥有基于SQL的持久化数据库(sqlite)</li><li id="86d4" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">定义待办事项和项目实体</li><li id="7075" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">部署在云上(Heroku)</li><li id="8d14" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">使用curl测试新的API</li></ul><p id="a3ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一段时间以来，我一直在用Daptin做小应用。它允许你快速迭代并为一个应用程序创建一个背景，而不需要太多的工作。这似乎也是一系列教程的完美开端，在这些教程中，我们将构建一个“待办事项”应用程序。</p><h1 id="5d79" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">设置</h1><p id="d532" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">你要做的第一件事是在<a class="ae jp" href="http://heroku.com" rel="noopener ugc nofollow" target="_blank"> heroku </a>上注册(免费实例足以测试)，因为<strong class="it hv">我们将在heroku </strong>上部署我们的后端。然后按照这个链接<strong class="it hv">在heroku </strong>上部署一个daptin实例。</p><div class="lh li fm fo lj lk"><a href="https://dashboard.heroku.com/new?button-url=https%3A%2F%2Fgithub.com%2Fdaptin%2Fdaptin&amp;template=https%3A%2F%2Fgithub.com%2Fdaptin%2Fdaptin" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab ej"><div class="lm ab ln cl cj lo"><h2 class="bd hv fv z el lp eo ep lq er et ht dt translated">赫罗库</h2><div class="lr l"><h3 class="bd b fv z el lp eo ep lq er et ek translated">部署Daptin</h3></div><div class="ls l"><p class="bd b gc z el lp eo ep lq er et ek translated">dashboard.heroku.com</p></div></div></div></a></div><figure class="lu lv lw lx fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff lt"><img src="../Images/72b35199a51e2f2208a6e4ec943e5d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bdJzn_EPNsijVcsdPrgkOg.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">Choose a name for this app</figcaption></figure><p id="10cb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为此实例选择一个应用程序名称(我选择了todolist-tutorial)。单击“部署应用程序”后，将需要几分钟时间来运行实例。</p><figure class="lu lv lw lx fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff mj"><img src="../Images/0ec487fef37983e51f439a58afda4a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uaF_dv6-CAUfztqPrh1JVA.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">Deploying app can take 3–5 minutes</figcaption></figure><p id="b748" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">部署完成后，您将获得实例的链接。单击“查看”转到新部署的实例。</p><figure class="lu lv lw lx fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff lt"><img src="../Images/70818071f7e1f0e097c0ecad07ace708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2wEOmAJiHKnBQDfS9z9hQ.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">“View” will take us to the newly deployed instance</figcaption></figure><figure class="lu lv lw lx fq ly fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/465555269967fa5e44bf05d9e4ce7f08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*tul96z1AZscxbEg_bpWWrg.png"/></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">Create an account using Sign Up, Then Sign In</figcaption></figure><p id="eb55" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦实例准备就绪，我们将在daptin上创建一个用户帐户。使用“注册”创建帐户，然后登录。</p><h1 id="b9ae" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">定义模式</h1><p id="1fa1" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">我们需要<strong class="it hv">定义我们的todo实体</strong>。让我们借此机会创建一个稍微复杂一点的todo-list实现。我们将有“项目”将有一个名称，“待办事项”将属于这些项目之一。</p><p id="f6f0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将<strong class="it hv">创建一个YAML文件来定义模式</strong>(您也可以使用JSON)并将它上传到daptin以获得我们的API</p><ul class=""><li id="5add" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">Todo将有一个“标题”、“描述”和“日程日期”。</li><li id="fba7" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">项目将有一个“名称”。</li><li id="40c3" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">我们还需要定义todo和项目实体之间的关系。总的来说，它将如下所示:</li></ul><figure class="lu lv lw lx fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff ml"><img src="../Images/9532407fd1f1796874758f8ff0aaadb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*xIa9yQX5NKcoYGemdZuopw.png"/></div></div></figure><div class="lu lv lw lx fq ab cb"><figure class="mm ly mn mo mp mq mr paragraph-image"><img src="../Images/bc5bbde803cd09505509900a21fa9e00.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*461WNoiVNnbiZZVYeJcc2A.png"/></figure><figure class="mm ly ms mo mp mq mr paragraph-image"><img src="../Images/f775b148859fac57b6c791660c475b35.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*1CwlA6AHHMmT2eLYK0Z1TA.png"/></figure></div><p id="676c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在这里找到我使用过的完整文件<a class="ae jp" href="https://github.com/artpar/daptin-marketplace-dummy/blob/master/todolist/schema_todolist_daptin.yaml" rel="noopener ugc nofollow" target="_blank"/>。保存此文件，以便我们可以将其上传到daptin。</p><div class="lu lv lw lx fq ab cb"><figure class="mm ly mt mo mp mq mr paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/13741a4c0be2f71ed675891f92e1d021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*meZJTb5ulm8zmQR-cuagwg.png"/></div></figure><figure class="mm ly mu mo mp mq mr paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><img src="../Images/f8cbea949181294b6f2d2ddc1fd5533f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*ElIYZhKvGj2faiooZPdeeg.png"/></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek mv di mw mx">Select Upload Schema and choose the previously created file</figcaption></figure></div><p id="6216" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上传还需要15-20秒。完成后，我们的API就准备好了。</p><h1 id="3686" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">测试API</h1><p id="431e" class="pw-post-body-paragraph ir is hu it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hn dt translated">让我们试试吧。我们将使用curl从终端调用API:</p><pre class="lu lv lw lx fq my mz na nb aw nc dt"><span id="65d4" class="nd kf hu mz b fv ne nf l ng nh">curl “<a class="ae jp" href="https://todolist-tutorial.herokuapp.com/api/todo" rel="noopener ugc nofollow" target="_blank">https://todolist-tutorial.herokuapp.com/api/todo</a>"</span></pre><p id="0012" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">反应</p><pre class="lu lv lw lx fq my mz na nb aw nc dt"><span id="0aa7" class="nd kf hu mz b fv ne nf l ng nh">{<br/> “links”: {<br/> “current_page”: 1,<br/> “from”: 0,<br/> “last_page”: 0,<br/> “last_page_url”: “//api/todo?page[number]=0”,<br/> “next_page_url”: “//api/todo?page[number]=2”,<br/> “per_page”: 10,<br/> “to”: 10,<br/> “total”: 0<br/> },<br/> “data”: []<br/>}</span></pre><p id="1d1d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为我们还没有创建任何todo，所以我们在“data”键中得到一个空数组。让我们创建一个新的待办事项</p><pre class="lu lv lw lx fq my mz na nb aw nc dt"><span id="0bb3" class="nd kf hu mz b fv ne nf l ng nh">curl “<a class="ae jp" href="https://todolist-tutorial.herokuapp.com/api/todo" rel="noopener ugc nofollow" target="_blank">https://todolist-tutorial.herokuapp.com/api/todo</a>" — data ‘{“data”: { “type”: “todo”, “attributes”: {“title”: “get this done”, “schedule”: “2017–10–19”}}}’</span></pre><p id="eda4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">回应:</p><pre class="lu lv lw lx fq my mz na nb aw nc dt"><span id="3a5a" class="nd kf hu mz b fv ne nf l ng nh">{<br/> “errors”: [<br/> {<br/> “status”: “500”,<br/> “title”: “Unauthorized”<br/> }<br/> ]<br/>}</span></pre><p id="8fbe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">哎呀，因为我们调用create API时没有Auth令牌，所以不允许我们这样做。让我们使用终端登录以获取新令牌。</p><pre class="lu lv lw lx fq my mz na nb aw nc dt"><span id="ae87" class="nd kf hu mz b fv ne nf l ng nh">curl “<a class="ae jp" href="https://todolist-tutorial.herokuapp.com/action/user/signin" rel="noopener ugc nofollow" target="_blank">https://todolist-tutorial.herokuapp.com/action/user/signin</a>" — data ‘{“attributes”: {“email”: “<a class="ae jp" href="mailto:tester@gmail.com" rel="noopener ugc nofollow" target="_blank">tester@gmail.com</a>”, “password”: “&lt;password&gt;”}}’</span></pre><p id="ef75" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">登录响应中的令牌:</p><pre class="lu lv lw lx fq my mz na nb aw nc dt"><span id="752b" class="nd kf hu mz b fv ne nf l ng nh">[<br/> {<br/> “ResponseType”: “client.store.set”,<br/> “Attributes”: {<br/> “key”: “token”,<br/> “value”: “<strong class="mz hv">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InRlc3RlckBnbWFpbC5jb20iLCJleHAiOjE1MDg0MDA4OTcsImlhdCI6IjIwMTctMTAtMTlUMDc6MTQ6NTcuNjUxMjY1NTU5WiIsImlzcyI6ImRhcHRpbiIsImp0aSI6ImI1ZjJlMDA0LTRlMGMtNGMwZi05MDc3LWZmM2NmNThmNmI1OSIsIm5hbWUiOiJ0ZXN0ZXIiLCJuYmYiOjE1MDgzOTcyOTcsInBpY3R1cmUiOiJodHRwczovL3d3dy5ncmF2YXRhci5jb20vYXZhdGFyLzhjM2ZlMWFkMjVlNmQ1ZjQ3NTEyZWE3MzY1NDE5OTY2XHUwMDI2ZD1tb25zdGVyaWQifQ.gM8SdgCpr_iCsI0zGN0nCnKTYiDhkwXZanWrYD1fMRg</strong>”<br/> }<br/> }<br/>]</span></pre><p id="d3a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们现在将使用这个标记来创建一个todo。我们在“授权”报头中发送令牌。该令牌是Oauth2令牌。</p><figure class="lu lv lw lx fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff ni"><img src="../Images/7aca0e9d3e5c6ef097e2d50d4d6078e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6uOj7tgJiy3fcFdT5vncOg.png"/></div></div></figure><p id="d9d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们现在可以使用第一个api来获取todos列表。我们还需要使用授权令牌。</p><p id="2cbe" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还允许游客创建和获取这些待办事项。但是让我们在下一篇文章中讨论这个问题。</p><p id="d537" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">几个结尾注释:</p><ul class=""><li id="9365" class="jq jr hu it b iu iv iy iz jc js jg jt jk ju jo jv jw jx jy dt translated">这里使用的数据库是SQLite。我们也可以使用MySQL或Postgresql。同样，我们将在另一篇文章中讨论这个问题</li><li id="13bb" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">Heroku在空闲30分钟后关闭自由实例。因此所有更改都将丢失。付费实例有这个问题，每月花费大约5美元。</li><li id="65cf" class="jq jr hu it b iu jz iy ka jc kb jg kc jk kd jo jv jw jx jy dt translated">部署的实例将允许来宾注册和登录。单击daptin仪表板上的“成为管理员”以关闭注册。您可以稍后启用它。</li></ul><figure class="lu lv lw lx fq ly"><div class="bz el l di"><div class="nj nk l"/></div></figure></div></div>    
</body>
</html>