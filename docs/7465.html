<html>
<head>
<title>Extending Laravel’s migration command to add new options</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扩展Laravel的迁移命令以添加新选项</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/extending-laravels-migration-command-to-add-new-options-90b5a0fc4ef4?source=collection_archive---------0-----------------------#2017-10-29">https://medium.com/hackernoon/extending-laravels-migration-command-to-add-new-options-90b5a0fc4ef4?source=collection_archive---------0-----------------------#2017-10-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><blockquote class="ir is it"><p id="80fa" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">这是我的<a class="ae jt" href="https://hackernoon.com/multi-tenant-application-with-laravel-and-postgres-abbb137bdbc8" rel="noopener ugc nofollow" target="_blank">上一篇文章</a>的延续，在那篇文章中，我们讨论了使用Laravel和Postgres创建多租户应用。我建议您在阅读本文之前先阅读那篇文章。</p></blockquote><p id="aac8" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">由于我们的多租户应用程序已经就绪，我们希望利用Laravel的控制台命令来处理我们的迁移。在本文中，我们将看到如何扩展Laravel的迁移实现，以优雅地处理多租户应用程序<a class="ae jt" href="https://hackernoon.com/tagged/app" rel="noopener ugc nofollow" target="_blank">的所有模式的迁移。</a></p><h1 id="ccf5" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">概观</h1><p id="b032" class="pw-post-body-paragraph iu iv hu ix b iy kv ja jb jc kw je jf ju kx ji jj jv ky jm jn jw kz jq jr js hn dt translated"><a class="ae jt" href="https://hackernoon.com/tagged/laravel" rel="noopener ugc nofollow" target="_blank"> Laravel </a>在<code class="eh la lb lc ld b">migrate</code>名称空间中提供简单的控制台命令来处理迁移。例如:</p><pre class="le lf lg lh fq li ld lj lk aw ll dt"><span id="da10" class="lm jy hu ld b fv ln lo l lp lq">$ php artisan migrate<br/>$ php artisan migrate:rollback<br/>...</span></pre><p id="c33e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">但是，您可能已经注意到，这些命令将只在默认模式下运行迁移，在我们的例子中，需要为所有模式运行。我们将扩展Laravel提供的命令，添加两个新选项:</p><ul class=""><li id="f7b0" class="lr ls hu ix b iy iz jc jd ju lt jv lu jw lv js lw lx ly lz dt translated"><code class="eh la lb lc ld b">--all</code></li><li id="79b1" class="lr ls hu ix b iy ma jc mb ju mc jv md jw me js lw lx ly lz dt translated"><code class="eh la lb lc ld b">--schema=[SCHEMA]</code></li></ul><p id="9065" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">因此，我们将能够:</p><pre class="le lf lg lh fq li ld lj lk aw ll dt"><span id="f323" class="lm jy hu ld b fv ln lo l lp lq"># Run migrations in all available schemas.<br/>$ php artisan migrate --all</span><span id="58ee" class="lm jy hu ld b fv mf lo l lp lq"># Run migrations in given schemas.<br/>$ php artisan migrate --schema=th,vn,ph</span><span id="9879" class="lm jy hu ld b fv mf lo l lp lq"># Rollback migrations in all available schemas.<br/>$ php artisan migrate:rollback --all</span><span id="b744" class="lm jy hu ld b fv mf lo l lp lq"># Rollback migrations in given schemas.<br/>$ php artisan migrate:rollback --schema=th,vn,ph</span></pre><blockquote class="ir is it"><p id="5f1d" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">我使用Laravel 5.5和PostgreSQL 9.5进行设置。</p></blockquote><h1 id="6a06" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">Laravel控制台命令</h1><p id="08fa" class="pw-post-body-paragraph iu iv hu ix b iy kv ja jb jc kw je jf ju kx ji jj jv ky jm jn jw kz jq jr js hn dt translated">Laravel中的控制台命令实现基本上是一个<a class="ae jt" href="https://www.sitepoint.com/understanding-the-command-design-pattern/" rel="noopener ugc nofollow" target="_blank">命令设计模式</a>的实现。每个命令都有它自己的<code class="eh la lb lc ld b">handle</code>方法，每当一个命令被调度时就会被触发。</p><blockquote class="mg"><p id="5875" class="mh mi hu bd mj mk ml mm mn mo mp js ek translated">命令模式是一种行为设计模式，其中使用一个对象来表示和封装稍后调用方法所需的所有信息。这些信息包括方法名称、拥有该方法的对象以及方法参数的值。—维基百科</p></blockquote><p id="549c" class="pw-post-body-paragraph iu iv hu ix b iy mq ja jb jc mr je jf ju ms ji jj jv mt jm jn jw mu jq jr js hn dt translated">Laravel中的数据库命令可以在<code class="eh la lb lc ld b">Illuminate\Database\Console\Migrations</code>名称空间中找到。我们只需要用自己的实现来覆盖它们。</p><h1 id="5f20" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">添加新选项</h1><p id="48cb" class="pw-post-body-paragraph iu iv hu ix b iy kv ja jb jc kw je jf ju kx ji jj jv ky jm jn jw kz jq jr js hn dt translated">在<code class="eh la lb lc ld b">app/Console</code>中创建一个名为<code class="eh la lb lc ld b">Migration</code>的文件夹。我们将把所有的迁移命令放在这个文件夹中。创建一个名为<code class="eh la lb lc ld b">MigrateCommand.php</code>的文件。</p><figure class="le lf lg lh fq mv"><div class="bz el l di"><div class="mw mx l"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">app/Console/Migration/MigrateCommand.php</figcaption></figure><p id="fc09" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">这个类扩展了<code class="eh la lb lc ld b">Illuminate\Database\Console\Migrations\MigrateCommand</code>，它基本上是实现<code class="eh la lb lc ld b">migrate</code>命令(<code class="eh la lb lc ld b">php artisan migrate</code>)的类。注意，在构造函数中，我们通过添加选项<code class="eh la lb lc ld b">--all</code>和<code class="eh la lb lc ld b">--schema</code>来扩展它的签名。然后我们用所需的参数调用父构造函数。</p><p id="dd18" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">我们现在需要将它注册为Laravel的默认<code class="eh la lb lc ld b">migrate</code>命令。为此，在<code class="eh la lb lc ld b">app/Http/Providers</code>目录中创建一个名为<code class="eh la lb lc ld b">VentureMigrationServiceProvider</code>的服务提供者，并在<code class="eh la lb lc ld b">config/app.php</code>中注册它。</p><p id="bd19" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">注意，这个服务提供者扩展了Laravel的迁移服务提供者<code class="eh la lb lc ld b">Illuminate\Database\MigrationServiceProvider</code>，而不是默认的<code class="eh la lb lc ld b">Illuminate\Support\ServiceProvider</code>。</p><figure class="le lf lg lh fq mv"><div class="bz el l di"><div class="mw mx l"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">app/Http/Providers/<code class="eh la lb lc ld b">VentureMigrationServiceProvider.php</code></figcaption></figure><p id="95c0" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh la lb lc ld b">registerMigrateCommand</code>扩展别名<code class="eh la lb lc ld b">command.migrate</code>中可用的singleton对象，并返回我们自己的<em class="iw"> MigrateCommand </em>。<code class="eh la lb lc ld b">command.migrate</code> <em class="iw"> </em>别名指向<code class="eh la lb lc ld b">Illuminate\Database\Console\Migrations\MigrateCommand</code>对象。所以覆盖<code class="eh la lb lc ld b">command.migrate</code>也将覆盖Laravel的默认<em class="iw"> MigrateCommand </em>。</p><p id="735a" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">运行<code class="eh la lb lc ld b">php artisan migrate --help</code>。您可以看到我们之前添加的两个新选项。</p><figure class="le lf lg lh fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="fe ff nc"><img src="../Images/cb84b0afc65dd1122217905b41075f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1nkLa_g5Itn79El22h9ZWw.png"/></div></div></figure><h1 id="77fe" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">该处理方法</h1><p id="7bd8" class="pw-post-body-paragraph iu iv hu ix b iy kv ja jb jc kw je jf ju kx ji jj jv ky jm jn jw kz jq jr js hn dt translated">每当我们运行<code class="eh la lb lc ld b">php artisan migrate</code>时，<code class="eh la lb lc ld b">MigrateCommand</code>中的<code class="eh la lb lc ld b">handle</code>方法就会被执行。让它响应我们新添加的选项。</p><figure class="le lf lg lh fq mv"><div class="bz el l di"><div class="mw mx l"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">app/Console/Migration/MIgrateCommand.php</figcaption></figure><p id="aa91" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh la lb lc ld b">handle</code>方法很简单。如果<code class="eh la lb lc ld b">--all</code>方案通过，我们将为所有可能的企业进行迁移。如果传递了<code class="eh la lb lc ld b">--schema</code>选项，我们将为给定的模式运行它，否则我们将只调用默认的父处理程序。<code class="eh la lb lc ld b">runFor</code>方法存在于<code class="eh la lb lc ld b">MigrationTrait</code>中，稍后我会解释。</p><h1 id="b46e" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">迁移特性</h1><p id="0f35" class="pw-post-body-paragraph iu iv hu ix b iy kv ja jb jc kw je jf ju kx ji jj jv ky jm jn jw kz jq jr js hn dt translated">因为当我们覆盖像<code class="eh la lb lc ld b">migrate:rollback</code>和<code class="eh la lb lc ld b">migrate:status</code>这样的命令时，我们会经常使用一些公共方法，所以我们将提取特征中的一些公共方法。姑且称之为<code class="eh la lb lc ld b">MigrationTrait</code>。</p><blockquote class="ir is it"><p id="df02" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">注意，您也可以为此创建一个AbstractClass。你想如何实现这一点取决于你。在本教程中，我将使用trait。</p></blockquote><figure class="le lf lg lh fq mv"><div class="bz el l di"><div class="mw mx l"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">app/Console/Migration/MigrationTrait.php</figcaption></figure><p id="ef71" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh la lb lc ld b">connectUsingSchema</code>方法根据传递的参数切换模式。该方法中的第一行覆盖全局配置，下一行将清除当前数据库连接。断开数据库是必要的，因为Laravel缓存连接并再次使用它。因此，在这种情况下，只更改全局配置是行不通的。重新连接是由Laravel自己完成的，所以在我们的方法中我们不需要重新连接数据库。在重新连接期间，Laravel将使用基于当前我们传递的模式的配置的模式。</p><p id="8950" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh la lb lc ld b">getValidSchemas</code>顾名思义，将从传递的参数中返回所有有效的模式。记住我们将以<code class="eh la lb lc ld b">--schema=th,vn,sg</code>格式从命令行传递模式。我们首先需要用逗号展开参数，并从我们的冒险列表中返回有效的模式。</p><p id="7ddd" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh la lb lc ld b">runFor</code>方法循环通过我们在参数中传递的所有冒险，并运行命令(migrate，rollback，等等)。).方法的第一行保存默认模式，该模式用于在方法结束时重置模式。然后，我们遍历ventures，切换模式，并运行当前模式的父处理程序。</p><h1 id="ccb8" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">测试迁移命令</h1><p id="280c" class="pw-post-body-paragraph iu iv hu ix b iy kv ja jb jc kw je jf ju kx ji jj jv ky jm jn jw kz jq jr js hn dt translated">在这个阶段，我们的<code class="eh la lb lc ld b">MigrateCommand</code>已经准备好为所有企业处理迁移事宜。让我们使用<code class="eh la lb lc ld b">--all</code>选项运行一些迁移。</p><figure class="le lf lg lh fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="fe ff nj"><img src="../Images/6a7c09855779ef95d4c0cbf9c6d5a274.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B9__yTrjljejKDH1gk7YqA.jpeg"/></div></div></figure><p id="697c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">注意，运行<code class="eh la lb lc ld b">php artisan migrate</code>将只运行默认模式中的迁移，默认模式可以在<code class="eh la lb lc ld b">.env</code>中定义，正如在<a class="ae jt" href="http://hackernoon.com/multi-tenant-application-with-laravel-and-postgres-abbb137bdbc8" rel="noopener ugc nofollow" target="_blank">上一篇文章</a>中提到的。</p><p id="daf8" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">现在，尝试用<code class="eh la lb lc ld b">php artisan migrate --schema=th,sg,vn</code>运行特定模式的迁移。这将为<em class="iw">泰国</em>、<em class="iw">新加坡</em>和<em class="iw">越南</em>的企业进行迁移。</p><figure class="le lf lg lh fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="fe ff nk"><img src="../Images/ea8b146ef77d9d742524e05a3956c0c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UhZbkLFqzkaPPY3lycjf8w.jpeg"/></div></div></figure><blockquote class="ir is it"><p id="a98c" class="iu iv iw ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hn dt translated">以这种方式扩展迁移的主要优点是，我们仍然可以链接由Laravel migrate名称空间中的命令提供的所有其他选项。例如，你可以运行<code class="eh la lb lc ld b">php artisan migrate --all --seed</code>。很酷吧。</p></blockquote><figure class="le lf lg lh fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="fe ff nl"><img src="../Images/ef04e5d8c0fbc536004010fb949979e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bOJXl_CxHjrDWKKBwJbChA.jpeg"/></div></div></figure><h1 id="56ec" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">回滚命令</h1><p id="6cbb" class="pw-post-body-paragraph iu iv hu ix b iy kv ja jb jc kw je jf ju kx ji jj jv ky jm jn jw kz jq jr js hn dt translated">现在让我们扩展<code class="eh la lb lc ld b">migrate:rollback</code>命令。在<code class="eh la lb lc ld b">app/Console</code>中创建一个名为<code class="eh la lb lc ld b">RollbackCommand.php</code>的文件。这个类将扩展<code class="eh la lb lc ld b">Illuminate\Database\Console\Migrations\RollbackCommand</code>，这是Laravel对<code class="eh la lb lc ld b">migrate:rollback</code>命令的实现。</p><p id="7932" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh la lb lc ld b">handle</code>方法与我们之前讨论的相同。</p><p id="f73d" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">与<code class="eh la lb lc ld b">MigrateCommand</code>类不同，我们需要覆盖<code class="eh la lb lc ld b">RollbackCommand</code>类中的<code class="eh la lb lc ld b">getOptions</code>方法，以便向列表中添加新选项。</p><figure class="le lf lg lh fq mv"><div class="bz el l di"><div class="mw mx l"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">app/Console/Migration/RollbackCommand.php</figcaption></figure><p id="9be3" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">你可能会想为什么我们需要在<code class="eh la lb lc ld b">RollbackCommand</code>中覆盖<code class="eh la lb lc ld b">getOptions</code>，而不是在<code class="eh la lb lc ld b">MigrateCommand</code>中。它就是这样实现的。貌似<a class="nm nn gr" href="https://medium.com/u/d694c31ce941?source=post_page-----90b5a0fc4ef4--------------------------------" rel="noopener" target="_blank">泰勒奥特威尔</a>不知什么原因在最近的版本里改了。检查<a class="ae jt" href="https://github.com/laravel/framework/commit/7052fe0aca07b2cd931bd19928db3264472c286a" rel="noopener ugc nofollow" target="_blank">这个提交</a>。如果你知道他为什么这么做，请在评论中回答；)</p><p id="1349" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">此时，我们的回滚命令几乎准备好了。我们现在需要做的就是告诉Laravel使用这个类，而不是默认的类。我们可以在我们之前创建的<code class="eh la lb lc ld b">VentureMigrationServiceProvider</code>中这样做。</p><figure class="le lf lg lh fq mv"><div class="bz el l di"><div class="mw mx l"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">app/Http/Providers/<code class="eh la lb lc ld b">VentureMigrationServiceProvider.php</code></figcaption></figure><p id="67a6" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh la lb lc ld b">registerMigrateRollbackCommand</code>扩展别名<code class="eh la lb lc ld b">command.migrate.rollback</code>中可用的singleton对象，并返回我们自己的<code class="eh la lb lc ld b">RollbackCommand</code>。</p><h1 id="6169" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">测试回滚命令</h1><p id="c750" class="pw-post-body-paragraph iu iv hu ix b iy kv ja jb jc kw je jf ju kx ji jj jv ky jm jn jw kz jq jr js hn dt translated">我们现在可以用<code class="eh la lb lc ld b">php artisan migrate:rollback --all</code>全部回滚。</p><figure class="le lf lg lh fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="fe ff no"><img src="../Images/861501d88c7d68059c7f1cebeb2f9e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cBiWazfz_WgzrlrYTj8lhQ.png"/></div></div></figure><p id="4f6c" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">要回滚特定模式，请使用<code class="eh la lb lc ld b">php artisan migrate:rollback --schema=th,sg,vn</code>。</p><figure class="le lf lg lh fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="fe ff np"><img src="../Images/f2967dfbc96f1d2d8ebfafdb8ad284dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tw9Cdqe4oitIycl45aossg.png"/></div></div></figure><h1 id="b858" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">状态命令</h1><p id="7b7f" class="pw-post-body-paragraph iu iv hu ix b iy kv ja jb jc kw je jf ju kx ji jj jv ky jm jn jw kz jq jr js hn dt translated">Status命令显示您的迁移状态。当您想要检查哪些迁移已经运行，哪些尚未执行时，此命令通常很有帮助。我们可以像扩展<code class="eh la lb lc ld b">RollbackCommand</code>一样扩展<code class="eh la lb lc ld b">StatusCommand</code>。</p><figure class="le lf lg lh fq mv"><div class="bz el l di"><div class="mw mx l"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">app/Console/Migration/StatusCommand.php</figcaption></figure><p id="2364" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">同样，在<code class="eh la lb lc ld b">VentureMigrationServiceProvider</code>中，将<code class="eh la lb lc ld b">App\Console\Migration\StatusCommand</code>注册为Laravel的默认状态命令。</p><figure class="le lf lg lh fq mv"><div class="bz el l di"><div class="mw mx l"/></div><figcaption class="my mz fg fe ff na nb bd b be z ek">app/Http/Providers/<code class="eh la lb lc ld b">VentureMigrationServiceProvider.php</code></figcaption></figure><p id="89ca" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated"><code class="eh la lb lc ld b">registerMigrateStatusCommand</code>扩展别名<code class="eh la lb lc ld b">command.migrate.status</code>中可用的singleton对象，并返回我们自己的<code class="eh la lb lc ld b">StatusCommand</code>。</p><h1 id="9332" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">测试状态命令</h1><p id="ae90" class="pw-post-body-paragraph iu iv hu ix b iy kv ja jb jc kw je jf ju kx ji jj jv ky jm jn jw kz jq jr js hn dt translated">要查看我们所有模式的状态，运行<code class="eh la lb lc ld b">php artisan migrate:status --all</code>。</p><figure class="le lf lg lh fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="fe ff nq"><img src="../Images/fa4d643e43a1fed970aef2bfa014f0d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWj1GV_JAjnyB7kzhGwiaw.jpeg"/></div></div></figure><p id="9732" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">要查看特定模式的状态，请运行<code class="eh la lb lc ld b">php artisan migrate:status --schema=th,my,vn</code>。</p><figure class="le lf lg lh fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="fe ff nr"><img src="../Images/6792635009a663f098e240fb2916c15b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7aE5dYNVQfaOxI5vqRcY9Q.jpeg"/></div></div></figure><h1 id="87a4" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">最后的话</h1><p id="fa96" class="pw-post-body-paragraph iu iv hu ix b iy kv ja jb jc kw je jf ju kx ji jj jv ky jm jn jw kz jq jr js hn dt translated">同样，我们可以覆盖剩余的命令:<code class="eh la lb lc ld b">migrate:fresh</code>、<code class="eh la lb lc ld b">migrate:reset</code>、<code class="eh la lb lc ld b">migrate:refresh</code>和<code class="eh la lb lc ld b">migrate:install</code>。扩展默认迁移而不是创建一个新的迁移的一个主要优点是，我们仍然可以链接其他有用的选项，如<code class="eh la lb lc ld b">--force</code>、<code class="eh la lb lc ld b">--seed</code>、<code class="eh la lb lc ld b">--database</code>等。</p><p id="cb5e" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">下一步:你能让<code class="eh la lb lc ld b">--path</code>选项为企业定义不同的迁移路径吗？在评论中让我知道你的实现:)</p><p id="ffb4" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">当前和<a class="ae jt" href="http://hackernoon.com/multi-tenant-application-with-laravel-and-postgres-abbb137bdbc8" rel="noopener ugc nofollow" target="_blank">先前教程</a>中使用的所有代码都可以在这个<a class="ae jt" href="https://github.com/ankitpokhrel/laravel-multitenant" rel="noopener ugc nofollow" target="_blank"> Github repo </a>中找到。</p><p id="f9b2" class="pw-post-body-paragraph iu iv hu ix b iy iz ja jb jc jd je jf ju jh ji jj jv jl jm jn jw jp jq jr js hn dt translated">仅此而已！编码快乐！</p><figure class="le lf lg lh fq mv"><div class="bz el l di"><div class="ns mx l"/></div></figure></div></div>    
</body>
</html>