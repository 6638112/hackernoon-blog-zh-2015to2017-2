<html>
<head>
<title>⚡Delivering Functions with Cake🍰</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">⚡Delivering功能与蛋糕🍰</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/delivering-functions-with-cake-4b269c50f817?source=collection_archive---------10-----------------------#2017-03-06">https://medium.com/hackernoon/delivering-functions-with-cake-4b269c50f817?source=collection_archive---------10-----------------------#2017-03-06</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="2e0d" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">C#中的Azure函数自定义部署脚本</h2></div><p id="fe8f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Azure Functions使用与Azure App Services相同的“引擎”进行部署，默认情况下，当你从GitHub Kudu连接连续部署时，它会为你处理一切，并且它会正常工作——你将提交你的代码，并且在你的代码上线后不久。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff kf"><img src="../Images/2ba25d1f6e8989be5f4626b8fc0cedc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*KR60Hwm2PP5eUdDBDnfbkA.png"/></div></figure><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff kn"><img src="../Images/178f26dfa0d7ce2a9492eb430c4ef743.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*df3gNKwF7UNwiNnANlj5kA.png"/></div></figure><p id="f1d1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这篇文章中，我将带您了解当部署源发生变化时，覆盖默认部署流程的过程。</p><p id="4ab8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我将使用C#作为部署的例子，但基本上天空是这里的限制，你可以使用F#与FAKE，JavaScript与Node，PowerShell或作为默认的普通旧批处理脚本-基本上任何你喜欢的工具。</p><p id="f5e9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你为什么要这么做？基本上，它支持更高级的部署场景，如自定义路径、私有NuGet feeds，而无需将敏感信息提交给存储库，仅举几例。</p><h2 id="d18b" class="ko kp hu bd kq kr ks kt ku kv kw kx ky js kz la lb jw lc ld le ka lf lg lh li dt translated">标准部署</h2><p id="20cc" class="pw-post-body-paragraph jj jk hu jl b jm lj iv jo jp lk iy jr js ll ju jv jw lm jy jz ka ln kc kd ke hn dt translated">所以让我们先看看Azure Functions的标准Kudu批处理部署脚本是什么样子的(不要担心，会有一个摘要，所以你可以跳过它😎)</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="c228" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果去掉错误处理、工具引导和变量的初始设置，重要的一行就是这一行</p><pre class="kg kh ki kj fq lq lr ls lt aw lu dt"><span id="c70a" class="ko kp hu lr b fv lv lw l lx ly">"%KUDU_SYNC_CMD%" -v 50 -f "%DEPLOYMENT_SOURCE%" -t "%DEPLOYMENT_TARGET%" -n "%NEXT_MANIFEST_PATH%" -p "%PREVIOUS_MANIFEST_PATH%" -i ".git;.hg;.deployment;deploy.cmd"</span></pre><p id="9fcb" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">因此，这基本上是将存储库中的文件与功能应用程序上运行的文件同步，不包括存储库系统文件和部署脚本，删除任何不再存在的文件，添加任何新文件并覆盖任何更改文件。</p><h2 id="75e8" class="ko kp hu bd kq kr ks kt ku kv kw kx ky js kz la lb jw lc ld le ka lf lg lh li dt translated">覆盖默认脚本</h2><p id="de78" class="pw-post-body-paragraph jj jk hu jl b jm lj iv jo jp lk iy jr js ll ju jv jw lm jy jz ka ln kc kd ke hn dt translated">覆盖默认行为实际上非常简单，在存储库的根中添加一个<code class="eh lz ma mb lr b">.deployment</code>文件，<code class="eh lz ma mb lr b">.deployment</code>文件可以控制部署的许多方面，无需定制脚本，即覆盖部署源(即GIT存储库)中的Azure函数脚本根，但我们感兴趣的设置是<code class="eh lz ma mb lr b">command</code>设置，它允许我们设置在部署时应该执行哪个命令。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="7c0d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">不，每次由提交或初始部署触发部署时，它都会寻找一个名为<code class="eh lz ma mb lr b">deploy.cmd</code>的文件并执行它。</p><h2 id="b2f4" class="ko kp hu bd kq kr ks kt ku kv kw kx ky js kz la lb jw lc ld le ka lf lg lh li dt translated">自助蛋糕</h2><p id="f04d" class="pw-post-body-paragraph jj jk hu jl b jm lj iv jo jp lk iy jr js ll ju jv jw lm jy jz ka ln kc kd ke hn dt translated">因此，蛋糕在Azure应用服务上默认不可用，所以我们需要确保它在我们可以使用C#部署之前就位，我们在我们的定制<code class="eh lz ma mb lr b">deploy.cmd</code>中这样做</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="0124" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这将创建一个<code class="eh lz ma mb lr b">Tool</code>目录，从NuGet获取并安装Cake脚本运行程序，然后执行<code class="eh lz ma mb lr b">deploy.cake</code>，这是我们的C#部署脚本。</p><h2 id="2c1e" class="ko kp hu bd kq kr ks kt ku kv kw kx ky js kz la lb jw lc ld le ka lf lg lh li dt translated">使用蛋糕进行部署</h2><p id="1bba" class="pw-post-body-paragraph jj jk hu jl b jm lj iv jo jp lk iy jr js ll ju jv jw lm jy jz ka ln kc kd ke hn dt translated">因此，Cake中的标准批量部署脚本可能如下所示</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="6e85" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh lz ma mb lr b">#tool</code>指令从NuGet获取KuduSync(而默认从NPM获取)</p><p id="f55e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh lz ma mb lr b">#addin</code>指令获取<code class="eh lz ma mb lr b">Cake.Kudu</code>插件，这是我写的一个蛋糕插件，它从C#中抽象了Kudu环境中的一些东西，可以通过类型化的对象、属性和方法轻松访问，即KuduSync实用程序。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/f53d15904e07cb29c0b7afaa2c875c91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*zeEFedUDYqwCmbzWlNR4LA.png"/></div></figure><p id="874d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后我们可以只写<code class="eh lz ma mb lr b">Kudu.Sync("./src");</code>,它会做与批处理脚本相同的事情，但是作为对未来的准备(因为这是正确的做法😉)我利用蛋糕任务运行器。</p><p id="a110" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">尽管没有那么多代码——与批处理脚本相比，我为C#开发人员分配了更多可读和熟悉的代码。</p><p id="3f54" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">更好的日志输出只是一个很好的奖励。</p><h2 id="84c2" class="ko kp hu bd kq kr ks kt ku kv kw kx ky js kz la lb jw lc ld le ka lf lg lh li dt translated">结论</h2><p id="138d" class="pw-post-body-paragraph jj jk hu jl b jm lj iv jo jp lk iy jr js ll ju jv jw lm jy jz ka ln kc kd ke hn dt translated">这篇文章中的蛋糕脚本是一个非常基础和幼稚的脚本，当你意识到你得到了C#的全部能力。NET框架和数以百计的蛋糕插件有助于它的真正强大的故事，我会做更先进的场景后续职位。</p><p id="4f28" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以在<a class="ae md" href="http://cakebuild.net/" rel="noopener ugc nofollow" target="_blank">cakebuild.net</a>了解更多关于Cake的信息，那里除了Cake自己的文档之外——大多数插件API都有文档记录，包括<a class="ae md" href="http://cakebuild.net/api/Cake.Kudu.Provider/KuduProvider/" rel="noopener ugc nofollow" target="_blank"> Cake。Kudu </a>。</p><p id="7629" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如往常一样，如果你有任何反馈、表扬或问题，请随时联系我。你可以在下面的GitHub库找到这篇文章的完整代码</p><div class="me mf fm fo mg mh"><a href="https://github.com/azurevoodoo/DeliveringFunctionswithCake" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab ej"><div class="mj ab mk cl cj ml"><h2 class="bd hv fv z el mm eo ep mn er et ht dt translated">azure voodoo/交付蛋糕功能</h2><div class="mo l"><h3 class="bd b fv z el mm eo ep mn er et ek translated">通过Cake脚本使用C#部署Azure函数</h3></div><div class="mp l"><p class="bd b gc z el mm eo ep mn er et ek translated">github.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv kl mh"/></div></div></a></div><div class="kg kh ki kj fq ab cb"><figure class="mw kk mx my mz na nb paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mw kk mx my mz na nb paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mw kk mx my mz na nb paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nc nd ne"><p id="f922" class="jj jk nf jl b jm jn iv jo jp jq iy jr ng jt ju jv nh jx jy jz ni kb kc kd ke hn dt translated"><a class="ae md" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae md" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae md" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae md" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jj jk nf jl b jm jn iv jo jp jq iy jr ng jt ju jv nh jx jy jz ni kb kc kd ke hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae md" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae md" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="fe ff nj"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>