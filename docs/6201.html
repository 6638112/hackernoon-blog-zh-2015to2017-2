<html>
<head>
<title>Managing Datadog with Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Terraform管理Datadog</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/managing-datadog-with-terraform-89abe0eb62f5?source=collection_archive---------10-----------------------#2017-09-07">https://medium.com/hackernoon/managing-datadog-with-terraform-89abe0eb62f5?source=collection_archive---------10-----------------------#2017-09-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/a05f8aa780fca3fd81018c6ce88d452f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VT_ylbTPJnacLBNONdpJQA.png"/></div></div></figure><div class=""/><p id="64e1" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">手动管理Datadog是一个极其繁琐且容易出错的过程。</p><p id="5a6a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">针对Datadog的API编写一个自动化工具会有回报，但这是一个巨大的代价。</p><p id="63f8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">谢天谢地，有更好的方法。一个更好的方法。那就是<a class="ae ka" href="https://hackernoon.com/tagged/managing-datadog" rel="noopener ugc nofollow" target="_blank">用Terraform管理Datadog </a>，免费给你<a class="ae ka" href="https://hackernoon.com/tagged/automation" rel="noopener ugc nofollow" target="_blank">自动化</a>(以及更多)。</p><h1 id="eeb0" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">Terraform如何帮助您管理Datadog</h1><ul class=""><li id="bac2" class="kz la if je b jf lb jj lc jn ld jr le jv lf jz lg lh li lj dt translated">在几秒钟内对所有Datadog组件进行可靠的全面更改。无论您有一台、十台还是一百台显示器，运行Terraform所需的时间大约是十秒钟。</li><li id="da96" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">在GitHub pull请求中跟踪和检查对Datadog设置的更改，就像进行代码更改一样。使用您喜欢的文本编辑工具编辑您的整个DD设置。</li><li id="8c81" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">模板化您的警报消息，并在监视器和时间板上重复使用查询。例如，为您的监视器提供一个一致的页脚(下面显示了如何在代码中实现),其中包括指向您的Datadog仪表板和Kibana日志的链接，您的待命人员可以立即着手解决问题。</li><li id="8c3e" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">在几秒钟内为您的所有显示器和时间板的新环境设置一个新的Datadog帐户。例如，您开始使用Datadog，并为dev创建一个单独的帐户，然后为prod创建一个单独的帐户，并需要对其进行调配。</li></ul><h1 id="b6d1" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">你如何使用Terraform？</h1><p id="1dd6" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">你用<a class="ae ka" href="https://www.terraform.io/docs/configuration/syntax.html" rel="noopener ugc nofollow" target="_blank"> HCL </a>(哈希公司的配置语言)编写你的配置。您描述了您想要的组件，例如“我想要一个名为disk_usage的DD monitor，用于度量system.disk.in_use，在85%及以上时发出警报”。然后，TF计算并运行您的DD帐户上需要的任何更改，以达到您描述的期望状态。</p><p id="c14d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">虽然HCL是一种声明性语言，但它是动态的，提供了像变量这样的特性；<a class="ae ka" href="https://www.terraform.io/docs/configuration/resources.html#count" rel="noopener ugc nofollow" target="_blank">计数</a>；条件；列表和地图等类型；<a class="ae ka" href="https://www.terraform.io/docs/configuration/interpolation.html#built-in-functions" rel="noopener ugc nofollow" target="_blank">内置函数</a>比如format——格式化字符串，join——用分隔符连接列表项，element——访问列表项；和模块。因此，除了配置语言之外，你不需要模板语言来弥补后者的不足。例如，当使用由YAML配置的工具时，您经常需要使用像Jinja2这样的模板语言及其条件和循环来生成工作YAML。你只需要盐酸。</p><p id="bc86" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以使用易于使用的CLI运行Terraform。到目前为止，您运行了几个shell命令:plan和apply。为TF做计划，找出你想要的和你在DD中已经得到的之间的差异，并计划需要的改变，以达到你想要的状态。并申请在DD上运行这些更改并到达那里。</p><h1 id="6db4" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">使用TF管理DD的示例</h1><p id="09d0" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">下面的示例展示了如何创建监视器和时间板，使用变量来获得一致的警报消息、查询和阈值。您可以跟随这个<a class="ae ka" href="https://github.com/travisjeffery/datadog-terraform-example" rel="noopener ugc nofollow" target="_blank">示例repo </a>。克隆它并使用试用的Datadog帐户运行(如果您没有同名的监视器/时间板，您自己的帐户也可以)。</p><p id="e6c0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">以下脚本/要点中的内容:</p><ul class=""><li id="63df" class="kz la if je b jf jg jj jk jn ls jr lt jv lu jz lg lh li lj dt translated">该脚本定义了两个监视器，磁盘使用率和CPU使用率。它们共享一个页脚用于页面责任和松弛时间提醒。用于监视器的查询也在时间板图中使用，因此您可以直观地确认监视器是否正确，并对照警报阈值检查每个指标的历史记录。</li><li id="c1f2" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">然后，该脚本定义了一个时间板，它有两个图表，分别显示磁盘使用情况和CPU使用情况。</li><li id="169d" class="kz la if je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj dt translated">该脚本还定义了变量，以便在一个地方定义常量值，而不是在它们发生变化时将它们分散到各处进行挖掘。</li></ul><figure class="lv lw lx ly fq hw"><div class="bz el l di"><div class="lz ma l"/></div><figcaption class="mb mc fg fe ff md me bd b be z ek">Terraform script managing Datadog.</figcaption></figure><p id="033d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以阅读Terraform的数据狗提供商<a class="ae ka" href="https://www.terraform.io/docs/providers/datadog/index.html" rel="noopener ugc nofollow" target="_blank">文档</a>来了解API的细节。</p><h1 id="989a" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">用Terraform！愈早愈好</h1><p id="693b" class="pw-post-body-paragraph jc jd if je b jf lb jh ji jj lc jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">Terraform是一种支付复利的工具。你从小额投资开始，比如Datadog，然后是Kubernetes和AWS。虽然它们可以单独管理，但是通过将它们连接在一起，您可以在一个模块中组成服务的基础结构。现在，您可以轻松启动每个环境的所有基础架构—开发、试运行、生产(甚至每个IaaS — AWS和GCP)。</p><p id="c50c" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Terraform是有史以来最好的操作工具之一。如果你知道它就在那里，却不去利用它，你就是一个受虐狂。即使有了Datadog，这也是一大福音。</p><p id="cf1b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt">–</p><p id="9f86" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请向<a class="ae ka" href="https://twitter.com/travisjeffery" rel="noopener ugc nofollow" target="_blank"> @travisjeffery </a>问好。</p><p id="1921" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">击中👏如果你觉得这有用，欢迎分享。</p><p id="0420" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">感谢阅读。</p><figure class="lv lw lx ly fq hw"><div class="bz el l di"><div class="mf ma l"/></div></figure></div></div>    
</body>
</html>