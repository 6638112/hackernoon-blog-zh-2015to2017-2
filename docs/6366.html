<html>
<head>
<title>Swift Custom[subscripting]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift定制[订购]</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/swift-custom-subscripting-a7c0af68e065?source=collection_archive---------16-----------------------#2017-09-14">https://medium.com/hackernoon/swift-custom-subscripting-a7c0af68e065?source=collection_archive---------16-----------------------#2017-09-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0793" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本周我们将暂停谈论ReaktiveKit和Bond。在构建我们自己的事件和可观察类时，我陷入了一个类似兔子洞的境地，所以本周我们将稍微偏离主题，谈谈在<a class="ae jp" href="https://hackernoon.com/tagged/swift" rel="noopener ugc nofollow" target="_blank"> Swift </a>中订阅的<a class="ae jp" href="https://hackernoon.com/tagged/subscripting" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="5539" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们一直在Swift中使用下标，通常是在数组或字典中。它们看起来像这样:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="4747" class="jz ka hu jv b fv kb kc l kd ke">someArray[2] = "Some value"<br/>someDictionary["some key"] = "Some value</span></pre><p id="19a9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你明白了。我们用数组和字典做各种各样的事情。但是最棒的是，我们可以给自己的自定义类和结构添加下标。同样的方式，我们可以为我们的自定义类型提供一个初始化器，我们可以提供一个下标。这里有一个非常简单的例子:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="cceb" class="jz ka hu jv b fv kb kc l kd ke">struct Group {</span><span id="e8ac" class="jz ka hu jv b fv kf kc l kd ke">   subscript(index: Int) -&gt; Int {<br/>      get {<br/>         return index<br/>      }<br/>   }<br/>}</span><span id="12fb" class="jz ka hu jv b fv kf kc l kd ke">let justiceLeague = Group()<br/>print(justiceLeague[3]) //prints "3"<br/>print(justiceLeague[2]) //prints "2"</span></pre><figure class="jq jr js jt fq kh fe ff paragraph-image"><div class="fe ff kg"><img src="../Images/b7bb6da4d893ab210a9235bb8b45c69d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*DLAmNccuqWEQGHDB_kCOKw.gif"/></div></figure><p id="6bb4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是最基本的工作原理。让我们把它放大一点，展示一下能够下标是如何有用的。在我不久前发布的一个应用程序中，我有一个用来表示音符的网格:</p><figure class="jq jr js jt fq kh fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kk"><img src="../Images/048147c5399d7333402d64651fa9c97b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*axaEJ1sukrQQ9J6_hGXzdw.png"/></div></div><figcaption class="kp kq fg fe ff kr ks bd b be z ek"><a class="ae jp" href="https://itunes.apple.com/us/app/blipbloop/id1237810871?mt=8" rel="noopener ugc nofollow" target="_blank">BlipBloop</a></figcaption></figure><p id="10de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每个按钮代表一个音符，而音符又由一个结构来表示。我们称这个结构为“音符”下面是Note的一个简单实现:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="ee4e" class="jz ka hu jv b fv kb kc l kd ke">struct Note {<br/>   let pitch: Int<br/>   let isOn: Bool</span><span id="92fe" class="jz ka hu jv b fv kf kc l kd ke">   static let empty = Note(pitch: 0, isOn: false)<br/>}</span></pre><p id="d815" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，如果有一种方法可以用下标的方式来表示音符网格，那就太棒了。所以任何时候我们想改变这个网格上的一个音符，我们可以这样做:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="a178" class="jz ka hu jv b fv kb kc l kd ke">grid[2, 3] = Note(pitch: 67, isOn: true)</span></pre><p id="fcd4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是一个可以代表我们网格的自定义类的样子:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="c7a7" class="jz ka hu jv b fv kb kc l kd ke">struct NoteMatrix{<br/>   let rows: Int<br/>   let columns: Int<br/>   var grid = [Note]()</span><span id="30b9" class="jz ka hu jv b fv kf kc l kd ke">   init(rows: Int, columns: Int) {<br/>      self.rows = rows<br/>      self.columns = columns<br/>      grid = Array(repeating: Note.empty, count: columns * rows)<br/>   }</span><span id="db0a" class="jz ka hu jv b fv kf kc l kd ke">   subscript(row: Int, column: Int) -&gt; Note {<br/>      get {<br/>         return grid[(row * columns) + column]<br/>      }<br/>      set(newValue) {<br/>         grid[(row * columns) + column] = newValue<br/>      }<br/>   }<br/>}</span></pre><p id="318a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们可以这样做:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="2dad" class="jz ka hu jv b fv kb kc l kd ke">var score = NoteMatrix(rows: 4, columns: 4)<br/>score[2, 3] = Note(pitch: 67, isOn: true)</span><span id="5562" class="jz ka hu jv b fv kf kc l kd ke">print(score[2, 3].pitch) //prints "67"</span></pre><p id="34ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">嘿，你看看那个。我们还可以在下标的“get-set”部分添加一个assert语句，如果超出了行数和列数，该语句将使所有内容崩溃:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="fad5" class="jz ka hu jv b fv kb kc l kd ke">assert(row &gt;= 0 &amp;&amp; row &lt; rows &amp;&amp; column &gt;= 0 &amp;&amp; column &lt; columns, "Index out of range")</span></pre><p id="a7cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本质上，我们有创建集合类型的构件。我想看看我是否能让这个矩阵类和泛型一起工作，所以我拼凑了一些东西，它工作起来没有任何错误。虽然不太好看。如果你有更好的方法，请在评论区告诉我。在这里…呃…在这里:</p><pre class="jq jr js jt fq ju jv jw jx aw jy dt"><span id="6352" class="jz ka hu jv b fv kb kc l kd ke">struct Matrix&lt;T&gt;{<br/>   let rows: Int<br/>   let columns: Int<br/>   var grid = [Int: [Int: T]]()</span><span id="5c39" class="jz ka hu jv b fv kf kc l kd ke">   init(rows: Int, columns: Int) {<br/>      self.rows = rows<br/>      self.columns = columns<br/>   }</span><span id="b03d" class="jz ka hu jv b fv kf kc l kd ke">   subscript(row: Int, column: Int) -&gt; T? {<br/>      get {<br/>         assert(indexIsValid(row: row, column: column), "Index out of range")<br/>         if let gridRow = grid[row] {<br/>            if let output = gridRow[column] {<br/>               return output<br/>            } else {<br/>               return nil<br/>            }<br/>         }else {<br/>            return nil<br/>         }<br/>      }</span><span id="d1f9" class="jz ka hu jv b fv kf kc l kd ke">   set(newValue) {<br/>      assert(indexIsValid(row: row, column: column), "Index out of range")<br/>         if let newValue = newValue {<br/>            grid[row] = [column: newValue]<br/>         }<br/>      }<br/>   }<br/>   <br/>   func indexIsValid(row: Int, column: Int) -&gt; Bool {<br/>      return row &gt;= 0 &amp;&amp; row &lt; rows &amp;&amp; column &gt;= 0 &amp;&amp; column &lt; columns<br/>   }</span><span id="f731" class="jz ka hu jv b fv kf kc l kd ke">}</span><span id="6dc3" class="jz ka hu jv b fv kf kc l kd ke">struct Note {<br/>   let pitch: Int<br/>   let isOn: Bool<br/>}</span><span id="e5de" class="jz ka hu jv b fv kf kc l kd ke">var noteGrid = Matrix&lt;Note&gt;(rows: 4, columns: 4)</span><span id="9127" class="jz ka hu jv b fv kf kc l kd ke">noteGrid[1, 1] = Note(pitch: 67, isOn: true)</span><span id="6fcb" class="jz ka hu jv b fv kf kc l kd ke">print(noteGrid[1, 1]?.pitch) //prints "67"</span></pre><p id="88af" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">太恶心了。它肯定需要返工。但是现在我们有了一个通用的矩阵，可以用于我们的任何自定义类型。说真的，如果你有更好的方法，请告诉我。我有一种感觉，要有一种在自定义集合类型中存储值的方法，我必须更进一步。但是，无论如何。现在你可以看到订阅是如何工作的了！</p><figure class="jq jr js jt fq kh fe ff paragraph-image"><div class="fe ff kg"><img src="../Images/f0372ed445d70bfe90670a71765bf06c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*wICVyB5t0iLya87hPgGFYw.gif"/></div></figure><figure class="jq jr js jt fq kh"><div class="bz el l di"><div class="kt ku l"/></div></figure></div></div>    
</body>
</html>