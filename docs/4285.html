<html>
<head>
<title>Introducing Nile.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nile.js简介</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/introducing-nile-js-81d83a31cfe3?source=collection_archive---------2-----------------------#2017-05-23">https://medium.com/hackernoon/introducing-nile-js-81d83a31cfe3?source=collection_archive---------2-----------------------#2017-05-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="5f4d" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">一个基于WebTorrent的点对点实时视频流库</h2></div><h2 id="25e4" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated"><em class="kh">简介</em></h2><p id="a14c" class="pw-post-body-paragraph ki kj hu kk b kl km iv kn ko kp iy kq ju kr ks kt jy ku kv kw kc kx ky kz la hn dt translated">我们建立了<a class="ae lb" href="http://nilejs.com/" rel="noopener ugc nofollow" target="_blank"> Nile.js </a>，这是一个点对点直播视频流库，旨在处理缩放。我们的库使用的是<a class="ae lb" href="https://webtorrent.io/" rel="noopener ugc nofollow" target="_blank"> WebTorrent </a>，这是一个受<a class="ae lb" href="http://www.bittorrent.com/" rel="noopener ugc nofollow" target="_blank"> BitTorrent </a>启发，用<a class="ae lb" href="https://webrtc.org/" rel="noopener ugc nofollow" target="_blank"> WebRTC </a>构建的分布式文件交付协议。我们选择WebTorrent作为我们广播流的方式，因为随着更多的对等点加入视频流，视频流会变得越来越强。这也使得它比实现典型的WebRTC对等连接更合适，因为WebTorrent能够减轻每个对等点大约10到20个连接的限制。</p><h2 id="c274" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated"><em class="kh">我们如何使用WebTorrent进行流式传输</em></h2><p id="652e" class="pw-post-body-paragraph ki kj hu kk b kl km iv kn ko kp iy kq ju kr ks kt jy ku kv kw kc kx ky kz la hn dt translated">首先，WebTorrent使用的torrent文件是不可变的，这使得它不太适合直播。为了模拟流媒体，我们将视频流分割成片段，通过观众自己生成的种子文件分发给观众。</p><p id="169f" class="pw-post-body-paragraph ki kj hu kk b kl lc iv kn ko ld iy kq ju le ks kt jy lf kv kw kc lg ky kz la hn dt translated">一旦WebTorrent客户端开始播种，就会生成一个磁铁链接(字符串形式的标识符)。我们通过一系列的WebSocket和WebRTC连接将这种吸引力传播给观看者。磁体首先被传递到连接到有限数量的WebSockets的节点/Express服务器。服务器将磁铁发送到初始WebSocket连接，这些连接通过链表结构中的WebRTC对等体传递磁铁。在收到磁铁后，每个观众客户端将开始吸取(下载)和播种(上传)流。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/91c818abd563fa1ba251712bf42c7502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nY082FIxwE9Ks8nG."/></div></div><figcaption class="lt lu fg fe ff lv lw bd b be z ek">Broadcasting Model</figcaption></figure><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lx"><img src="../Images/b70dcbb3f0a8ef4595998c08b34e6156.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WP-Bd9KkPRCiPY1m."/></div></div><figcaption class="lt lu fg fe ff lv lw bd b be z ek">Distributed Video Streaming via WebTorrent</figcaption></figure><h2 id="4a25" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated"><em class="kh">注意事项</em></h2><p id="5d06" class="pw-post-body-paragraph ki kj hu kk b kl km iv kn ko kp iy kq ju kr ks kt jy ku kv kw kc kx ky kz la hn dt translated">由于我们的WebSocket到WebRTC连接的链表结构，如果一个对等体断开连接，这个链就会被破坏。我们的图书馆被设计成在服务中断时自动重新连接。断开连接的webRTC对等方将打开与服务器的WebSocket连接，在那里它将被重新分配给新的WebSocket对等方。</p><p id="9c75" class="pw-post-body-paragraph ki kj hu kk b kl lc iv kn ko ld iy kq ju le ks kt jy lf kv kw kc lg ky kz la hn dt translated">如果只有几个对等点观看该流，初始上传速度高度依赖于广播公司的带宽和网络速度，从而产生一个主要的瓶颈。为了抵消这种糟糕的初始性能，我们允许广播公司有足够的时间向每个对等点发送足够的数据，以便在不丢失一秒钟的情况下进行查看。从这一经验中，我们进一步认识到将点对点交付与CDN(类似于<a class="ae lb" href="https://peer5.com/" rel="noopener ugc nofollow" target="_blank"> Peer5 </a>)相结合的有效性，以处理低到高数量的观众。</p><h2 id="9d72" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated"><em class="kh">问题</em></h2><p id="ba53" class="pw-post-body-paragraph ki kj hu kk b kl km iv kn ko kp iy kq ju kr ks kt jy ku kv kw kc kx ky kz la hn dt translated">当我们在广播端积累WebTorrent种子数量时，似乎有一个客户端内存泄漏，最终导致浏览器崩溃。我们已经检查了CPU和内存的使用情况，但没有发现错误消息或异常。</p><p id="a1b8" class="pw-post-body-paragraph ki kj hu kk b kl lc iv kn ko ld iy kq ju le ks kt jy lf kv kw kc lg ky kz la hn dt translated">我们为解决问题而采取的不成功的方法:</p><ul class=""><li id="099b" class="ly lz hu kk b kl lc ko ld ju ma jy mb kc mc la md me mf mg dt translated">服务器端播种代替客户端播种</li><li id="6c7f" class="ly lz hu kk b kl mh ko mi ju mj jy mk kc ml la md me mf mg dt translated">用网络工作者播种</li><li id="a6d8" class="ly lz hu kk b kl mh ko mi ju mj jy mk kc ml la md me mf mg dt translated">iframes中的播种</li><li id="0120" class="ly lz hu kk b kl mh ko mi ju mj jy mk kc ml la md me mf mg dt translated">在每个新种子上销毁WebTorrent客户端</li><li id="fb87" class="ly lz hu kk b kl mh ko mi ju mj jy mk kc ml la md me mf mg dt translated">在每个新种子上销毁WebTorrent文件</li></ul><p id="ec7a" class="pw-post-body-paragraph ki kj hu kk b kl lc iv kn ko ld iy kq ju le ks kt jy lf kv kw kc lg ky kz la hn dt translated">我们发现的一个解决方案是特定于浏览器的。如果使用Chrome Canary来测试库，它似乎会无限期运行。如果开源社区中的任何人能够提供一些见解，请在我们的<a class="ae lb" href="https://github.com/gitsummore/nile.js" rel="noopener ugc nofollow" target="_blank"> GitHub </a> repo上提出请求。</p><h2 id="7ccb" class="jj jk hu bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg dt translated"><em class="kh">结论</em></h2><p id="e9e6" class="pw-post-body-paragraph ki kj hu kk b kl km iv kn ko kp iy kq ju kr ks kt jy ku kv kw kc kx ky kz la hn dt translated">作为概念的证明，我们希望其他开发人员尝试我们的库，并留下反馈，告诉我们如何改进项目，甚至在它的基础上进行构建。来我们的网站、<a class="ae lb" href="https://github.com/gitsummore/nile.js" rel="noopener ugc nofollow" target="_blank"> GitHub </a>和<a class="ae lb" href="https://www.npmjs.com/package/nile.js" rel="noopener ugc nofollow" target="_blank"> npm </a>看看我们吧。</p><p id="c6fb" class="pw-post-body-paragraph ki kj hu kk b kl lc iv kn ko ld iy kq ju le ks kt jy lf kv kw kc lg ky kz la hn dt translated"><em class="mm"> Nile.js是</em> <a class="mn mo gr" href="https://medium.com/u/8689739f5747?source=post_page-----81d83a31cfe3--------------------------------" rel="noopener" target="_blank"> <em class="mm">德瑞克米兰达</em></a><em class="mm"/><a class="mn mo gr" href="https://medium.com/u/735b24064ab9?source=post_page-----81d83a31cfe3--------------------------------" rel="noopener" target="_blank"><em class="mm">凯文邱</em></a><em class="mm"/><a class="mn mo gr" href="https://medium.com/u/b0b7e8f684e5?source=post_page-----81d83a31cfe3--------------------------------" rel="noopener" target="_blank"><em class="mm">贾斯汀皮尔森</em> </a> <em class="mm">。</em></p><div class="li lj lk ll fq ab cb"><figure class="mp lm mq mr ms mt mu paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mp lm mq mr ms mt mu paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mp lm mq mr ms mt mu paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mv mw mx"><p id="f922" class="ki kj mm kk b kl lc iv kn ko ld iy kq my le ks kt mz lf kv kw na lg ky kz la hn dt translated"><a class="ae lb" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae lb" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae lb" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae lb" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ki kj mm kk b kl lc iv kn ko ld iy kq my le ks kt mz lf kv kw na lg ky kz la hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae lb" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae lb" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff nb"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure></div></div>    
</body>
</html>