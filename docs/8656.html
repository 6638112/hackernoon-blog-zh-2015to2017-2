<html>
<head>
<title>Performance Monitoring for the Frontend — Using Zipkin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">前端性能监控—使用Zipkin</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/performance-monitoring-for-the-frontend-using-zipkin-bf3aa4a715e5?source=collection_archive---------15-----------------------#2017-12-09">https://medium.com/hackernoon/performance-monitoring-for-the-frontend-using-zipkin-bf3aa4a715e5?source=collection_archive---------15-----------------------#2017-12-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="7a43" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这一系列的博文都是关于网络相关的<a class="ae jp" href="https://hackernoon.com/tagged/performance" rel="noopener ugc nofollow" target="_blank">性能</a>问题。<br/>我们的目标是为您提供一套工具，帮助您了解如何向客户交付更少、更短的装货屏幕。</p><p id="1866" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请确保您也阅读了第一部分:<a class="ae jp" rel="noopener" href="/@dschmidt1992/performance-monitoring-for-the-frontend-an-introduction-e0ab422f131c"> <strong class="it hv">前端性能监控—简介</strong> </a></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/a2f26dbab1368044742c49dbeadcbf00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ysEbLoc3HjMDmlA0SVLOCA.png"/></div></div></figure><h1 id="b206" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">入门指南</h1><p id="58ab" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">既然我们已经得到了正确的名称，让我们看看如何跟踪单个span。为此，我们需要一个追踪器来开始跨度。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lf lg l"/></div></figure><p id="3390" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以在第13行看到，我们需要设置一个采样器。采样器是返回布尔值的函数，该布尔值指示是否应该开始跟踪。设置很有用，因为您可能只想跟踪特定比例的用户，或者只跟踪连接到WIFI或您企业特有的设备的用户。<br/>在第14行中，您会看到服务名被设置为“frontend”，这将显示在左侧。现在我们有了一个可以工作的跟踪器，可以用来开始一些实际的跟踪。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lf lg l"/></div></figure><p id="a8a5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们详细讨论一下:您可能注意到的第一件事是，我们将想要跟踪的语句包装在一个限定了作用域的块中，并设置了span的当前id，这样<a class="ae jp" href="https://hackernoon.com/tagged/zipkin" rel="noopener ugc nofollow" target="_blank"> Zipkin </a>就知道我们具体讨论的是哪个span。createRootId部分意味着我们想要创建一个根span，稍后我们将看到如何创建子span。接下来要注意的是，我们为客户机发送记录了一个注释，它标志着我们的跨度的起点，并表明客户机将要向服务器发送一个请求。如果我们在这里写了一个服务器，我们将需要使用服务器接收注释；对于本地跨度(系统之间没有交互)，我们可以使用本地操作启动。在第15行我们看到了相反的部分，客户端接收注释，它标志着跨度的结束。正如您已经知道的，Span可以有名称，在本例中，我们通过RPC注释将其设置为“My Span”。RPC代表远程过程调用，这意味着我们用这个调用调用服务器上的一个函数。<br/>最后但同样重要的是，我们想知道API调用的结果。因此，我们记录一个二进制日志，用键“result”和字符串化的响应作为值。</p><h1 id="47b5" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">延伸跨度</h1><p id="0dd3" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">应该只有一个根，所以让我们看看如何定义子关系:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lf lg l"/></div></figure><p id="9ed1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您需要位于父块的作用域内，以便可以通过运行createChildId来扩展它。就这样，很简单，对吗？当您试图将两个系统相互连接起来时，事情会变得有点复杂，我可能会在本系列的后面部分详细介绍这一点。现在，我想告诉你，如果你想做这样的事情，你可以看看哪里:</p><p id="e398" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">- <a class="ae jp" href="https://github.com/openzipkin/zipkin-js/blob/ee844c9249b47872444bdc5c4514f39df27a9714/packages/zipkin-instrumentation-fetch/src/wrapFetch.js#L11" rel="noopener ugc nofollow" target="_blank">给请求添加HTTP头</a> <br/> - <a class="ae jp" href="https://github.com/openzipkin/zipkin-js/blob/ee844c9249b47872444bdc5c4514f39df27a9714/packages/zipkin-instrumentation-express/src/expressMiddleware.js#L30" rel="noopener ugc nofollow" target="_blank">从请求中提取跟踪上下文</a></p><h1 id="5fe2" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">局部跨度</h1><p id="9037" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">最后，我想给你看一些‏recently添加到Zipkin的东西:本地跨度。每当您发现自己需要跟踪只与一个服务有关的东西时，无论是同步计算还是带有承诺的异步计算，您都应该使用本地范围进行跟踪。您可以自己设置注释，或者让Zipkin为您处理，如下例所示:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lf lg l"/></div></figure><p id="4397" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">local的第一个参数采用一个span名称，第二个参数采用一个函数。如果函数返回一个承诺，当承诺完成时跨度结束，否则当函数完成时跨度结束</p><p id="95cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lh">想听我说更多吗？欢迎订阅我的时事通讯，我大概一个月发一次新闻。</em></p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="li lg l"/></div></figure><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lj lg l"/></div></figure></div></div>    
</body>
</html>