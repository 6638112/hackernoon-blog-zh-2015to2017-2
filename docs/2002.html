<html>
<head>
<title>Inject the .Net framework into the browser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">注射。Net框架集成到浏览器中</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/inject-the-net-framework-into-the-browser-84803a223b1?source=collection_archive---------2-----------------------#2016-12-31">https://medium.com/hackernoon/inject-the-net-framework-into-the-browser-84803a223b1?source=collection_archive---------2-----------------------#2016-12-31</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="057d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有时你需要浏览器的简单性和成熟的编程框架的强大功能。</p><p id="465a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在上一篇关于创建简单的。Net REPL，<a class="ae jp" rel="noopener" href="/@mikeptweet/making-a-net-repl-57ca5c465081#.w6xvh925y">https://medium . com/@ mikeptweet/making-a-net-repl-57ca 5c 465081 # . w6xvh 925y</a>，我概述了一种快速简单的方法来访问。Net框架从一个互动<a class="ae jp" href="https://hackernoon.com/tagged/repl" rel="noopener ugc nofollow" target="_blank"> REPL </a>。除了能够计算表达式和访问。Net框架类和库，这个简单的REPL提供了一个简单的方法来跨越。Net和标准COM对象。Window的许多编程，尤其是LOB(业务线)应用程序都涉及COM自动化。对于任何从事复杂的Microsoft Office工作的人来说尤其如此。之前。COM是Windows的通用语言，Windows的许多互操作性都是基于COM的。</p><p id="70ca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">尽管流行和增长。Net框架中，相当多的现有窗口应用程序是基于COM的，并且在许多情况下，COM是实现不同供应商的应用程序之间的互操作的唯一可行的方法。而。Net framework提供了许多创建和访问COM对象的方法，这些方法通常需要大量的知识，对于一般的“脚本小子”来说并不容易理解...比如<a class="ae jp" href="https://msdn.microsoft.com/en-us/library/system.runtime.interopservices(v=vs.110).aspx" rel="noopener ugc nofollow" target="_blank">https://msdn . Microsoft . com/en-us/library/system . runtime . interop services(v = vs . 110)。aspx </a>。</p><p id="d156" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">理想情况下，我们希望混搭。Net和COM对象，并利用两者的力量。这可以通过我们的REPL实现，因为它处理COM和。作为一等公民平等地上网。如果我们回顾一下我们以前的文章，您会发现访问它是多么容易。Net framework类:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/994d197e8d40aa7a20d29450b32de261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*gb8x61rgpWdDiS43XLSTtw.jpeg"/></div></figure><p id="f839" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">同样简单的是，我们可以访问COM对象:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/3c99358bfce6608144c9cb38c56f86b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*YJMOcz5mhRb6z76DPRgCcw.jpeg"/></div></figure><p id="6b03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">COM很容易访问Window应用程序生态系统的大部分内容，我们可以使用自动化接口创建一些强大的集成，例如Microsoft Office:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="32db" class="kd ke hu jz b fv kf kg l kh ki">$.excel=new ActiveXObject("Excel.Application");<br/>$.word=new ActiveXObject("Word.Application");</span></pre><p id="63e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">或者数据库访问</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="b216" class="kd ke hu jz b fv kf kg l kh ki">$.conn = new ActiveXObject("ADODB.Connection");</span></pre><p id="22d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">能够写剧本。Net Framework类与COM对象的结合提供了一个巨大的工具箱，可以实现大多数业务类型的程序员无法实现的场景。我说的“业务型程序员”指的是应付账款部门的女孩(或男孩)，他们会用Excel宏做一些让你头晕目眩的事情:-)</p><p id="249b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我不止一次发现非常有用的一个场景是能够编写Internet Explorer应用程序的脚本来自动执行web页面任务。这可能就像关闭一个网站以获取汇率、股票报价或最新天气预报等信息一样简单。在我们REPL这样做很简单。在这个简单的例子中，我们编写了Internet Explorer脚本，将20美元转换为加元:</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/81b8035086bbc6a01d0c5bd3d10b2043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*mp7XhudKl7kseq1mqidiwg.jpeg"/></div></figure><p id="d5c9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然这是一个微不足道的例子，但它展示了几行脚本代码在一个有创造力的人手中是多么强大。只是重申一下，我们有COM的全部功能加上。Net框架供我们使用。它的美妙之处在于，它提供了无限的灵活性，让你可以根据自己的意愿来完成任务。在另一个场景中，您可能只想从web页面获取原始HTML，并在本地做一些进一步的处理。在这种情况下，您可以调用。Net系统。Net.WebClient类来获取原始数据:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="a6b2" class="kd ke hu jz b fv kf kg l kh ki">$.html=(new WebClient()).DownloadString("http://example.com"); </span></pre><p id="fa09" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">同时能够编写两者的脚本。Net和COM非常有用，有时我希望一个环境的功能在另一个环境的“内部”。例如，能够在内部承载一个COM对象。Net，反之亦然，在基于COM的应用程序中托管. Net Framework类/对象/库。同样，这些功能对于经验丰富的程序员来说是存在的，也就是说，我可以在任一种情况下创建一个Excel插件。但是它们需要广博的知识以及大量的依赖和限制。由于我的口头禅一直是<strong class="it hv"> <em class="kj">【少即是多】</em> </strong>，所以可以说我希望能够在飞行中做到这一点。使用我们的。Net REPL，我们可以用几行代码来完成。由于在REPL内部创建的对象是“通用COM对象”，这意味着我们可以简单地通过调用方法或设置属性将. Net对象“附加”到现有的COM对象。例如，下面演示了在Internet Explorer中创建调用本机的新方法(函数)是多么容易。Net类返回一个新的GUID，这在浏览器中仅仅通过JavaScript是不可能的:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="904f" class="kd ke hu jz b fv kf kg l kh ki">$.ie.document.parentWindow.CreateGuid=function(){return Guid.NewGuid().ToString()};</span></pre><p id="a580" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果打开Internet Explorer开发人员工具(按F12)，可以看到新函数现在作为DOM window对象上的一个方法存在。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff kk"><img src="../Images/fd2fa76bb6ad2561f71bb8147c87dc72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*34E73TN4iH2VFC7ue4G54Q.jpeg"/></div></figure><p id="c14f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，只需几行代码，我们就能够提供。Net框架，浏览器的JavaScript引擎可以完全访问它。</p><p id="fade" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">事实上，我们可以将这一点发挥到极致，使我们的REPL环境中的任何可用内容都可以从浏览器的Javascript引擎环境中访问。它只需要一行代码:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="aacd" class="kd ke hu jz b fv kf kg l kh ki">$.ie.document.parentWindow.Repl=$;</span></pre><p id="f2b3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这使得我们在REPL中定义的任何全局引用(变量、函数等)都可以通过窗口使用。浏览器中的Repl。REPL全局$上的简单定义功能，它们可以从浏览器中自动访问。例如，假设我们想使用。Net在浏览器中…这很简单:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="9933" class="kd ke hu jz b fv kf kg l kh ki">$.ie.document.parentWindow.Repl=$;<br/>$.format=System.String.Format;</span><span id="c12c" class="kd ke hu jz b fv kl kg l kh ki">//and from the browser we can do</span><span id="4247" class="kd ke hu jz b fv kl kg l kh ki">window.Repl.format("The date is {0}},Date());</span></pre><p id="7ccf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当然，我们可以进一步简化，将Format方法直接分配给浏览器窗口对象:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="6e11" class="kd ke hu jz b fv kf kg l kh ki">$.ie.document.parentWindow.format=String.Format;</span><span id="cb03" class="kd ke hu jz b fv kl kg l kh ki">// and from the browser</span><span id="7590" class="kd ke hu jz b fv kl kg l kh ki">window.format("The date is {0}},Date());</span><span id="d398" class="kd ke hu jz b fv kl kg l kh ki">//or simply<br/>format("The date is {0}}.Date());</span><span id="10ca" class="kd ke hu jz b fv kl kg l kh ki">//since all properties and methods on the window object are global by default.</span></pre><p id="5f0c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">同样，我们可以混合搭配COM和。Net，并用很少的几行代码创建了一些非常强大的解决方案。因此，这意味着我们同样可以像下面这样将Excel插入到浏览器上下文中:</p><pre class="jr js jt ju fq jy jz ka kb aw kc dt"><span id="f508" class="kd ke hu jz b fv kf kg l kh ki">$.window=$.ie.document.parentWindow;<br/>$.window.Excel= new ActiveXObject("Excel.Application");</span></pre><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="fe ff km"><img src="../Images/30eded3cf5f8fad981669f152ce09d2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M-XiAPQwmIlPQ9k02zfCzA.jpeg"/></div></div></figure><p id="b15e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">没错，我现在可以从我的浏览器上下文中完整地编写Excel脚本了！</p><p id="031e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将把它留给另一篇文章:-)</p><div class="jr js jt ju fq ab cb"><figure class="kr jv ks kt ku kv kw paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="kr jv ks kt ku kv kw paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="kr jv ks kt ku kv kw paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="kx ky kz"><p id="f922" class="ir is kj it b iu iv iw ix iy iz ja jb la jd je jf lb jh ji jj lc jl jm jn jo hn dt translated"><a class="ae jp" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae jp" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae jp" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae jp" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is kj it b iu iv iw ix iy iz ja jb la jd je jf lb jh ji jj lc jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jp" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jp" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="fe ff ld"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="le lf l"/></div></figure></div></div>    
</body>
</html>