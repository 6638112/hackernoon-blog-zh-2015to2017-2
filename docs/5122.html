<html>
<head>
<title>Speech to text transcription in 40 lines of Bash</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Bash中40行的语音到文本转录</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/speech-to-text-transcription-in-40-lines-of-bash-f466092d8feb?source=collection_archive---------4-----------------------#2017-07-11">https://medium.com/hackernoon/speech-to-text-transcription-in-40-lines-of-bash-f466092d8feb?source=collection_archive---------4-----------------------#2017-07-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="ef0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有没有想过开发一款可以接收用户音频输入的应用？将音频集成到应用程序中有很多好处——从简单地转录音频文件到在文本输出上运行NLP。但是语音识别不是一项简单的任务。你可能想专注于开发自己的应用，而不是构建和训练一个转录音频流的模型。</p><p id="b58d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">输入机器学习API！使用ML作为API，您可以利用完成常见ML任务的预训练模型，将ML添加到您的应用程序中，而无需重新发明轮子。</p><h1 id="82e6" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">给我看看代码</h1><p id="9f53" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">我编写了一个简单的bash脚本，它使用<a class="ae ks" href="http://sox.sourceforge.net/" rel="noopener ugc nofollow" target="_blank"> SoX </a>制作音频记录，base64编码音频文件，并将其发送到<a class="ae ks" href="https://cloud.google.com/speech/" rel="noopener ugc nofollow" target="_blank">云语音API </a>。<strong class="it hv">的完整代码是</strong> <a class="ae ks" href="https://github.com/sararob/ml-talk-demos/blob/master/speech/request.sh" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">这里是</strong> </a>，下面我将重点介绍让它运行的关键步骤。</p><h2 id="16dd" class="kt jq hu bd jr ku kv kw jv kx ky kz jz jc la lb kd jg lc ld kh jk le lf kl lg dt translated">安装SoX</h2><p id="6f63" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">如果你已经安装了自制软件，你可以用一个简单的命令来安装SoX:<code class="eh lh li lj lk b">brew install sox --with-flac</code>(<code class="eh lh li lj lk b">--with-flac</code>标志增加了对<a class="ae ks" href="https://xiph.org/flac/" rel="noopener ugc nofollow" target="_blank"> FLAC编码</a>的支持，这是我们在语音API中需要的)。也可以<a class="ae ks" href="https://sourceforge.net/projects/sox/files/sox/" rel="noopener ugc nofollow" target="_blank">直接安装SoX</a>。SoX给了我们<code class="eh lh li lj lk b">rec</code>命令，我们将使用它来记录我们的音频。</p><h2 id="ca88" class="kt jq hu bd jr ku kv kw jv kx ky kz jz jc la lb kd jg lc ld kh jk le lf kl lg dt translated">录制音频并进行base64编码</h2><p id="5cab" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">安装SoX后，您可以使用以下内容录制5秒钟的音频:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="2174" class="kt jq hu lk b fv lt lu l lv lw">rec --channels=1 --bits=16 --rate=16000 audio.flac trim 0 5</span></pre><p id="8624" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将使用FLAC编码录制5秒钟的音频，并将其保存到一个名为<code class="eh lh li lj lk b">audio.flac</code>的文件中。然后，我们将对该文件进行base64编码，以将其发送到语音API(它也支持其他格式):</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="22ce" class="kt jq hu lk b fv lt lu l lv lw">base64 audio.flac &gt; audio.base64</span></pre><p id="0364" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在可以发送到语音API了！我们将在一个JSON文件中准备我们的请求。</p><h2 id="7800" class="kt jq hu bd jr ku kv kw jv kx ky kz jz jc la lb kd jg lc ld kh jk le lf kl lg dt translated">创建语音API请求</h2><p id="471d" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">在Bash中，我们可以创建一个<code class="eh lh li lj lk b">request.json</code>文件:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="7c42" class="kt jq hu lk b fv lt lu l lv lw">FILENAME=”request-”`date +”%s”.json`<br/>cat &lt;&lt;EOF &gt; $FILENAME<br/>{ <br/>  "config": { <br/>    "encoding":"FLAC", <br/>    "languageCode": "en-US", <br/>    "speechContexts": { <br/>      "phrases": [''] <br/>    }, <br/>    "maxAlternatives": 1 <br/>  }, <br/>  "audio": { <br/>    "content": <br/>  }<br/>}<br/>EOF</span></pre><p id="bc57" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请注意，我们将<code class="eh lh li lj lk b">content</code>留空，我们将用base64编码的音频内容来填充它:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="1fc7" class="kt jq hu lk b fv lt lu l lv lw">sed -i '' -e '/"content":/r audio.base64' $FILENAME</span></pre><p id="d210" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们已经准备好通过<code class="eh lh li lj lk b">curl</code>提出我们的请求:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="eeaf" class="kt jq hu lk b fv lt lu l lv lw">curl -s -X POST -H "Content-Type: application/json" --data-binary @${FILENAME} <a class="ae ks" href="https://speech.googleapis.com/v1/speech:recognize?key=YOUR_API_KEY" rel="noopener ugc nofollow" target="_blank">https://speech.googleapis.com/v1/speech:recognize?key=YOUR_API_KEY</a></span></pre><p id="47e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里，<code class="eh lh li lj lk b">${FILENAME}</code>是一个Bash变量，带有您的<code class="eh lh li lj lk b">request.json </code>文件的名称(在完整的Bash脚本中，我给文件名附加了一个时间戳，这样它们就不会被覆盖)。用云API密钥替换<code class="eh lh li lj lk b">YOUR_API_KEY</code>——你可以在你的云控制台的<strong class="it hv">凭证</strong>部分生成一个。</p><p id="5c9f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就是这样！在Bash的40行中，你有语音到文本的转录。</p><p id="8afa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该脚本还支持用不同语言的文件调用API。运行脚本时，只需添加一个语言代码作为命令行参数，即<code class="eh lh li lj lk b">bash request.sh fr</code>。这将把JSON请求的<code class="eh lh li lj lk b">languageCode</code>部分更改为您指定的语言。</p><h1 id="aa68" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated"><strong class="ak">云语音API还能做什么？</strong></h1><p id="ad9c" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">我上面的Bash示例显示了向API发送一个完整的音频文件(一个批处理请求)。该API还支持流式传输，因此你可以向它发送连续的音频流，API将返回临时结果。点击此处找到关于流识别<a class="ae ks" href="https://cloud.google.com/speech/docs/streaming-recognize" rel="noopener ugc nofollow" target="_blank">的文档。</a></p><p id="4922" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请求中的<code class="eh lh li lj lk b">speechContext</code>参数是我最喜欢的语音API特性之一。假设您有一个专有名词或一些专门针对您的应用程序的术语。预先训练的模型可能不会识别这些特定于行业的术语，但是您可以提供提示，告诉模型注意这些术语。例如，我在几个DevFests上讲过话——一个特定类型的Google开发者团体活动的名称。如果我向API传递一个带有“DevFest”的音频文件，它通常会将其转录为“death fest”，这绝对不是一回事！当我通过<code class="eh lh li lj lk b">speechContext</code>参数提供一个提示时，它完美地转录了“DevFest”。</p><h1 id="3a7e" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">谁在使用语音API？</h1><p id="e483" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">虽然转录一个5秒钟的音频文件很有趣，但你可能想知道这是如何在生产中使用的。这里有两个例子:</p><ul class=""><li id="a7af" class="lx ly hu it b iu iv iy iz jc lz jg ma jk mb jo mc md me mf dt translated">Twilio  :他们最近宣布了一项自动语音识别服务，用于转录电话，由语音API提供支持。</li><li id="633f" class="lx ly hu it b iu mg iy mh jc mi jg mj jk mk jo mc md me mf dt translated"><a class="ae ks" href="https://cloud.google.com/customers/hyperconnect/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> Azar </strong> </a>:一款聊天应用，连接了超过150亿场比赛，使用语音API转录比赛之间发送的任何音频片段。</li></ul><h1 id="eb39" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">开始转录音频</h1><p id="a499" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">以下是这篇文章中提到的所有资源的列表:</p><ul class=""><li id="1b61" class="lx ly hu it b iu iv iy iz jc lz jg ma jk mb jo mc md me mf dt translated"><a class="ae ks" href="https://github.com/sararob/ml-talk-demos/blob/master/speech/request.sh" rel="noopener ugc nofollow" target="_blank"> Bash脚本代码</a></li><li id="b46b" class="lx ly hu it b iu mg iy mh jc mi jg mj jk mk jo mc md me mf dt translated"><a class="ae ks" href="https://cloud.google.com/speech/docs" rel="noopener ugc nofollow" target="_blank">语音API文档</a></li><li id="bb6a" class="lx ly hu it b iu mg iy mh jc mi jg mj jk mk jo mc md me mf dt translated"><a class="ae ks" href="https://youtu.be/w1xNTLH1zlA?t=10m42s" rel="noopener ugc nofollow" target="_blank">我的云下一节演讲API上的</a></li></ul><p id="4806" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">享受吧，如果你对Twitter <a class="ae ks" href="https://twitter.com/srobtweets" rel="noopener ugc nofollow" target="_blank"> @SRobTweets </a>有任何语音API反馈，请告诉我。</p></div></div>    
</body>
</html>