<html>
<head>
<title>Automate implementing the DISA STIG for PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为PostgreSQL自动实现DISA STIG</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/automate-implementing-the-disa-stig-for-postgresql-a7e3267c83d0?source=collection_archive---------11-----------------------#2017-05-22">https://medium.com/hackernoon/automate-implementing-the-disa-stig-for-postgresql-a7e3267c83d0?source=collection_archive---------11-----------------------#2017-05-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/5015a00558461995f1a05511a62fdd79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S2jsrM3a0QT7jJ5Smm25gA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Audit of a PostgreSQL server configuration</figcaption></figure><p id="2a3f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在本文中，我将展示如何使用<a class="ae ke" href="https://github.com/OSSIndex/DevAudit" rel="noopener ugc nofollow" target="_blank"> DevAudit </a>对PostgreSQL服务器的配置进行安全审计，DevAudit 是一个开源的跨平台多用途安全审计程序，具有一个审计规则集，可以自动检查服务器是否符合美国国防信息系统局(DISA)发布的<a class="ae ke" href="https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf" rel="noopener ugc nofollow" target="_blank"> PostgreSQL 9.x安全技术实施指南</a>。</p><h2 id="e09d" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">介绍</h2><p id="acd9" class="pw-post-body-paragraph jg jh hu ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hn dt translated">这是我关于开源审计项目DevAudit的系列文章的第2篇。在第一篇文章的<a class="ae ke" href="https://hackernoon.com/security-auditing-asp-net-applications-using-devaudit-ee31873be364" rel="noopener ugc nofollow" target="_blank">中，我介绍了审计ASP.NET web应用程序的库依赖、应用程序配置和代码。在这里，我将讨论根据一组众所周知的安全和强化规则来审计您的web或其他应用程序可能依赖的应用服务器的配置。该步骤可以是持续集成或部署管道的一部分，用于验证应用程序操作环境或基础设施的配置和安全状况。在本文中，我将具体介绍:</a></p><ul class=""><li id="7955" class="lf lg hu ji b jj jk jn jo jr lh jv li jz lj kd lk ll lm ln dt translated">通过SSH远程审计Linux PostgreSQL服务器。</li><li id="cb20" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated">将PostgreSQL STIG规则实现为审计规则。</li><li id="1133" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated">未来的DevAudit服务器审计功能。</li><li id="f3f6" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated">通过WinRM远程审核Windows PostgreSQL服务器。</li><li id="0534" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated">审计PostgreSQL服务器<a class="ae ke" href="https://hackernoon.com/tagged/docker" rel="noopener ugc nofollow" target="_blank"> Docker </a>容器。</li></ul><h2 id="214e" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">关于DevAudit</h2><p id="61bb" class="pw-post-body-paragraph jg jh hu ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hn dt translated">DevAudit是一个跨平台的多用途<a class="ae ke" href="https://hackernoon.com/tagged/security" rel="noopener ugc nofollow" target="_blank">安全</a>审计工具，旨在审计应用程序开发安全的所有方面。应用程序通常运行在环境中部署的服务器上，并依赖于这些服务器来提供所需的服务，如身份验证、web应用程序托管和服务、数据存储等。应用服务器也可以作为微服务<a class="ae ke" href="https://www.nginx.com/blog/microservices-at-netflix-architectural-best-practices/" rel="noopener ugc nofollow" target="_blank">部署，微服务</a>可以利用容器化技术，比如Docker。保护像PostgreSQL这样的数据库服务器是应用程序安全的一个关键部分，因为配置不当的数据库服务器是应用程序漏洞和潜在的大规模泄露敏感数据(如用户帐户)的主要载体。</p><p id="99dc" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">DevAudit可以根据YAML文本文件中定义的可配置审计规则来审计MySQL和PostgreSQL等数据库服务器的配置，这些规则实现了安全检查和强化准则的集合。用于保护应用服务器的安全指南和配置标准的最佳集合之一是来自美国国防部国防信息系统局(DISA)的安全技术实施指南(STIG) <a class="ae ke" href="http://iase.disa.mil/stigs/Pages/index.aspx" rel="noopener ugc nofollow" target="_blank">文档集合</a>。来自维基百科:</p><blockquote class="lt lu lv"><p id="7981" class="jg jh lw ji b jj jk jl jm jn jo jp jq lx js jt ju ly jw jx jy lz ka kb kc kd hn dt translated">安全技术实施指南(STIG)是一种网络安全方法，用于标准化网络、服务器、计算机和逻辑设计中的安全协议，以增强整体安全性。这些指南一旦实施，将增强软件、硬件、物理和逻辑架构的安全性，从而进一步减少漏洞。</p></blockquote><p id="27c6" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">STIGs针对各种服务器、操作系统和应用程序发布。DevAudit可以根据STIGs提供的规则和其他已发布的安全准则来审核服务器、操作系统和应用程序。目前，DevAudit为以下服务器提供配置审核:</p><ul class=""><li id="90be" class="lf lg hu ji b jj jk jn jo jr lh jv li jz lj kd lk ll lm ln dt translated">OpenSSH sshd</li><li id="b3e6" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated">Apache httpd</li><li id="7afb" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated">MySQL和衍生品</li><li id="1d3c" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated">Nginx</li><li id="d2b2" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated">一种数据库系统</li></ul><p id="0755" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">您可以在每次部署或测试应用程序时运行DevAudit服务器审核，以确保没有对服务器配置进行可能会影响应用程序安全状态的更改。</p><h2 id="1502" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">入门指南</h2><p id="da21" class="pw-post-body-paragraph jg jh hu ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hn dt translated">开始使用DevAudit最简单的方法是从项目<a class="ae ke" href="https://github.com/OSSIndex/DevAudit/releases" rel="noopener ugc nofollow" target="_blank">发布</a>页面下载Windows或Linux的二进制版本。你所需要的是。Windows上的NET Framework 4.6+或Linux上的Mono 4.4+。在Linux上，你也可以从Docker Hub中提取<code class="eh ma mb mc md b">ossindex/devaudit</code> <a class="ae ke" href="https://hub.docker.com/r/ossindex/devaudit/" rel="noopener ugc nofollow" target="_blank"> Docker镜像</a>。您也可以在Windows或Linux上从源代码构建项目。请参见DevAudit wiki的<a class="ae ke" href="https://github.com/OSSIndex/DevAudit/wiki#installation" rel="noopener ugc nofollow" target="_blank">安装</a>部分，了解完整的安装选项。</p><p id="cff1" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">只要您能够访问打算用于服务器实例的PGSQL二进制文件和配置文件，就不需要为审计安装PostgreSQL的运行实例。您还可以审核正在运行的PostgreSQL Docker容器。从您的DevAudit项目文件夹中，您可以使用以下命令在本地计算机上启动审计:</p><p id="4be3" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh ma mb mc md b">devaudit pgsql -c &lt;path to PGSQL config file&gt; -b &lt;path to PGSQL binary&gt;</code></p><p id="af8b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">如果不指定<code class="eh ma mb mc md b">-c </code>或<code class="eh ma mb mc md b">-b </code>参数，那么DevAudit将尝试自动检测PostgreSQL服务器配置文件和二进制文件。例如，在Linux主机上，我们可以:</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="8996" class="kf kg hu md b fv mm mn l mo mp">allisterb@ubuntu:~/DevAudit$ ./devaudit pgsql -c /etc/postgresql/9.5/main/postgresql.conf                                                                                                                     <br/>                                                                                                                                                                                                              <br/> _____                 _______            __  __  __                                                                                                                                                          <br/>|     \ .-----..--.--.|   _   |.--.--..--|  ||__||  |_                                                                                                                                                        <br/>|  --  ||  -__||  |  ||       ||  |  ||  _  ||  ||   _|                                                                                                                                                       <br/>|_____/ |_____| \___/ |___|___||_____||_____||__||____|                                                                                                                                                       <br/>                                                                                                                                                                                                              <br/>                                                                                                                                                                                                              <br/>v2.1.0.0                                                                                                                                                                                                      <br/>04:09:04&lt;01&gt; [AUDIT] [SUCCESS] Auto-detected PostgreSQL server binary at /usr/lib/postgresql/9.5/bin/postgres.                                                                                                <br/>04:09:04&lt;01&gt; [AUDIT] [INFO] Using PostgreSQL configuration file /etc/postgresql/9.5/main/postgresql.conf.                                                                                                     <br/>04:09:04&lt;01&gt; [AUDIT] [SUCCESS] Got PostgreSQL server version 9.5.6.                                                                                                                                           <br/>04:09:04&lt;01&gt; [AUDIT] [STATUS] Scanning PostgreSQL packages.                                                                                                                                                   <br/>Scanning PostgreSQL packages...                                                                                                                                                                               <br/>04:09:05&lt;05&gt; [AUDIT] [SUCCESS] Parsed configuration from /etc/postgresql/9.5/main/postgresql.conf. Successfully included 0 out of 0 include files. First line parsed 1. Last line parsed: 623. Parsed 1 total <br/>configuration nodes. Parsed 501 total comments.                                                                                                                                                               <br/>04:09:06&lt;05&gt; [AUDIT] [INFO] Found PostgreSQL server auto configuration file /var/lib/postgresql/9.5/main/postgresql.auto.conf.                                                                                <br/>04:09:06&lt;05&gt; [AUDIT] [SUCCESS] Merged configuration from /var/lib/postgresql/9.5/main/postgresql.auto.conf.                                                                                                   </span></pre><p id="c334" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在这种情况下，DevAudit会自动检测PostgreSQL server二进制路径，并使用配置文件中指定的路径来加载服务器配置。</p><p id="4228" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">使用DevAudit Docker映像，在Linux主机上执行PostgreSQL审计的命令如下所示:</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="05e2" class="kf kg hu md b fv mm mn l mo mp">docker run -it -v /:/hostroot ossindex/devaudit pgsql -c /etc/postgresql/9.5/main/postgresql.conf</span></pre><p id="16f6" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们需要运行带有<code class="eh ma mb mc md b">-it</code>选项的Docker容器来启用交互式输出，并在<code class="eh ma mb mc md b">/hostroot</code>将我们的本地根目录挂载为一个卷，以便让DevAudit Docker容器访问审计所需的文件。一旦为Docker容器设置了所需的选项，就可以使用与常规命令行版本相同的DevAudit程序选项。</p><h2 id="2936" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">通过SSH远程审计Linux PostgreSQL服务器</h2><p id="dbb6" class="pw-post-body-paragraph jg jh hu ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hn dt translated">通常情况下，您的应用程序在部署、测试或运行时将与之对话的服务器不是您开发应用程序的机器。我们可以使用DevAudit的远程审计功能来审计网络上运行PostgreSQL server的任何机器。在这里，我将使用以下命令行选项创建一个SSH审核环境，开始对远程Linux PostgreSQL服务器进行审核:</p><p id="3b6d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh ma mb mc md b">-s</code>指定要通过SSH连接的远程计算机的IP或主机名。</p><p id="6713" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh ma mb mc md b">-u</code>指定连接到远程计算机的用户。</p><p id="1270" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh ma mb mc md b">-k</code>指定用于验证用户的OpenSSH格式私钥文件。</p><p id="8274" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh ma mb mc md b">-p</code>指定我们想要使用一个交互提示(禁用本地回显)来输入密钥文件的密码短语。</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="3006" class="kf kg hu md b fv mm mn l mo mp">&gt; devaudit pgsql -s 173.xxx.xxx.xxx -u richard.foo -k C:\bar.key -p -c /etc/postgresql/9.5/main/postgresql.conf                                                   <br/>Password:                                                                                                 <br/> _____                 _______            __  __  __                                                      <br/>|     \ .-----..--.--.|   _   |.--.--..--|  ||__||  |_                                                    <br/>|  --  ||  -__||  |  ||       ||  |  ||  _  ||  ||   _|                                                   <br/>|_____/ |_____| \___/ |___|___||_____||_____||__||____|                                                   <br/>                                                                                                          <br/>                                                                                                          <br/>v2.1.0.0                                                                                                  <br/>07:44:17&lt;01&gt; [HOST] [INFO] Connecting to 173.xxx.xxx.xxx:22...                                            <br/>07:44:18&lt;05&gt; [HOST] [INFO] Host key fingerprint is: ssh-rsa 0b:50:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx.                                                                                                        <br/>07:44:19&lt;01&gt; [HOST] [SUCCESS] Connected to 173.xxx.xxx.xxx in 1954 ms.                                    <br/>07:44:19&lt;01&gt; [HOST] [INFO] Using work directory: C:\Users\Allister\AppData\Local\Temp\devaudit-work\149535<br/>2659.80851.                                                                                               <br/>07:44:21&lt;01&gt; [AUDIT] [SUCCESS] Auto-detected PostgreSQL server binary at /usr/lib/postgresql/9.5/bin/postg<br/>res.                                                                                                      <br/>07:44:21&lt;01&gt; [AUDIT] [INFO] Using PostgreSQL configuration file /etc/postgresql/9.5/main/postgresql.conf. <br/>07:44:21&lt;01&gt; [AUDIT] [SUCCESS] Got PostgreSQL server version 9.5.6.                                       <br/>07:44:21&lt;01&gt; [AUDIT] [STATUS] Scanning PostgreSQL packages.                                               <br/>Scanning PostgreSQL packages...                                                                           <br/>07:44:22&lt;08&gt; [AUDIT] [SUCCESS] Parsed configuration from /etc/postgresql/9.5/main/postgresql.conf. Success<br/>fully included 0 out of 0 include files. First line parsed 1. Last line parsed: 623. Parsed 1 total config<br/>uration nodes. Parsed 501 total comments.                                                                 <br/>07:44:23&lt;08&gt; [AUDIT] [INFO] Found PostgreSQL server auto configuration file /var/lib/postgresql/9.5/main/p<br/>ostgresql.auto.conf.                                                                                      <br/>07:44:24&lt;08&gt; [AUDIT] [SUCCESS] Merged configuration from /var/lib/postgresql/9.5/main/postgresql.auto.conf<br/>.                                                                                                         </span></pre><p id="e0eb" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">DevAudit将连接到远程机器，并并行执行PostgreSQL审计所需的任务。自动检测服务器二进制路径，并读取和解析指定的配置文件。读取并执行所需的任何附加文件或配置任务，以便为审计任务收集尽可能多的服务器信息。</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="3589" class="kf kg hu md b fv mm mn l mo mp">07:44:24&lt;01&gt; [AUDIT] [SUCCESS] Scanned 1 PostgreSQL packages.                                             <br/>Searching OSS Index for vulnerabilities for 1 packages...                                                 <br/>07:44:24&lt;08&gt; [AUDIT] [INFO] Loading default configuration rules for PostgreSQL application.               <br/>Searching OSS Index for vulnerabilities for 1 packages...                                                 <br/>07:44:24&lt;08&gt; [AUDIT] [INFO] Got 7 default configuration rule(s) for 1 module(s) from postgresql.yml in 77 <br/>ms.                                                                                                       <br/>Searching OSS Index for vulnerabilities for 1 packages...                                                 <br/>07:44:26&lt;06&gt; [AUDIT] [SUCCESS] Found 87 vulnerabilities for 1 package(s) on OSS Index in 2321 ms.         <br/>Evaluating 7 configuration rule(s)...                                                                     <br/>07:44:26&lt;06&gt; [AUDIT] [SUCCESS] Evaluated 7 configuration rule(s) in 21 ms.                                <br/>07:44:27&lt;08&gt; [AUDIT] [INFO] Evaluated 87 vulnerabilities with 0 matches to package version in 515 ms.</span></pre><p id="a584" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">DevAudit将根据由<a class="ae ke" href="https://ossindex.net" rel="noopener ugc nofollow" target="_blank"> OSS Index </a>汇编的漏洞数据，对其检测到的PostgreSQL“包”或应用程序模块和组件的版本进行审计。目前，只有核心服务器二进制文件被DevAudit注册为“包”或模块/组件。PostgreSQL <a class="ae ke" href="https://www.postgresql.org/support/security/" rel="noopener ugc nofollow" target="_blank">漏洞</a>仅针对特定的PGSQL server版本报告，而不是针对特定的模块，如pgcrypto。但是DevAudit确实能够扫描特定应用程序模块、插件、扩展等的漏洞。在这种情况下，我们没有发现PGSQL 9 . 5 . 6版的任何索引漏洞。</p><p id="da68" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">但是，关于PostgreSQL服务器配置有3个发现:</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="e8e7" class="kf kg hu md b fv mm mn l mo mp">Application Configuration Audit Results                                                                   <br/>=======================================                                                                   <br/>3 total vulnerabilities found in PostgreSQL application configuration audit. Total time for audit: 9398 ms<br/>.                                                                                                         <br/>                                                                                                          <br/>[1/1] Module: postgresql. 7 rule(s).  3 rule(s) succeeded. [VULNERABLE]                                   <br/>--[1/7] Rule: Server port is set to default (Port). Result: True.                                         <br/>  --Summary:                                                                                              <br/>    --By default postgres runs on port 5432. Most attackers will check if a server is listening on port 54<br/>32.                                                                                                       <br/>    --If you change the port # to something different, others need to know exactly what port to use to access the server.                                                                                           <br/>  --Tags:                                                                                                 <br/>    --STIG/V-72841/PostgreSQL must be configured to prohibit or restrict the use of organization defined f<br/>unctions, ports, protocols, and/or services                                                               <br/>  --Severity: 1                                                                                           <br/>  --Resolution:                                                                                           <br/>    --Add a directive like the following to the PGSQL configuration file: port 9122.                      <br/>  --Urls:                                                                                                 <br/>    --<a class="ae ke" href="https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf" rel="noopener ugc nofollow" target="_blank">https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf</a>                                       <br/>                                                                                                          <br/>--[2/7] Rule: client_min_messages is set to log or debug. Result: False.                                  <br/>--[3/7] Rule: max_connections is not set. Result: False.                                                  <br/>--[4/7] Rule: log_timezone is not set. Result: False.                                                     <br/>--[5/7] Rule: Server auditing is not enabled. Result: True.                                               <br/>  --Summary:                                                                                              <br/>    --Information system auditing capability is critical for accurate forensic analysis.                  <br/>    --Without information about the outcome of events, security personnel cannot make an accurate assessme<br/>nt as to whether an attack was successful or if changes were made to the security state of the system.    <br/>    --Event outcomes can include indicators of event success or failure and event-specific results (e.g., <br/>the security state of the information system after the event occurred).                                   <br/>    --As such, they also provide a means to measure the impact of an event and help authorized personnel t<br/>o determine the appropriate response.                                                                     <br/>  --Tags:                                                                                                 <br/>    --STIG/V-72843/PostgreSQL must produce audit records containing sufficient information to establish th<br/>e outcome (success or failure) of the events.                                                             <br/>  --Severity: 2                                                                                           <br/>  --Resolution:                                                                                           <br/>    --You must install and configure the pgaudit extension.                                               <br/>  --Urls:                                                                                                 <br/>    --<a class="ae ke" href="https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf" rel="noopener ugc nofollow" target="_blank">https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf</a>                                       <br/>    --<a class="ae ke" href="http://pgaudit.org" rel="noopener ugc nofollow" target="_blank">http://pgaudit.org</a>                                                                                  <br/>                                                                                                          <br/>--[6/7] Rule: client_min_messages is not set to error. Result: True.                                      <br/>  --Summary:                                                                                              <br/>    --Any PostgreSQL or associated application providing too much information in error messages on the scr<br/>een or printout risks compromising the data and security of the system.                                   <br/>    --The structure and content of error messages need to be carefully considered by the organization and <br/>development team.                                                                                         <br/>  --Tags:                                                                                                 <br/>    --STIG/V-72851/PostgreSQL must provide non-privileged users with error messages that provide informati<br/>on necessary for corrective actions without revealing information that could be exploited by adversaries. <br/>  --Severity: 2                                                                                           <br/>  --Resolution:                                                                                           <br/>    --Set the client_min_messages directive in the PGSQL configuration file to error.                     <br/>  --Urls:                                                                                                 <br/>    --<a class="ae ke" href="https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf" rel="noopener ugc nofollow" target="_blank">https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf</a>                                       <br/>    --<a class="ae ke" href="https://www.postgresql.org/docs/9.1/static/runtime-config-logging.html" rel="noopener ugc nofollow" target="_blank">https://www.postgresql.org/docs/9.1/static/runtime-config-logging.html</a>                              <br/>                                                                                                          <br/>--[7/7] Rule: Server log files are not mode 0600. Result: False.</span></pre><p id="ae90" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们发现:</p><ul class=""><li id="d646" class="lf lg hu ji b jj jk jn jo jr lh jv li jz lj kd lk ll lm ln dt translated">被审计的PostgreSQL服务器被配置为在默认端口上运行。</li><li id="3cd1" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated">未安装pgaudit扩展。</li><li id="98c3" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated"><code class="eh ma mb mc md b">client_min_message</code>配置文件指令未设置为“错误”。</li></ul><p id="2253" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这些发现中的每一个都对应于<code class="eh ma mb mc md b">Rules/postgresql.yml</code> YAML文件中的一个审计规则，每个DevAudit审计规则都实现了PostgreSQL STIG中的一个规则。例如，PostgreSQL STIG文档中的第一条规则如下所示:</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="4c0f" class="kf kg hu md b fv mm mn l mo mp">Group ID (Vulid): V-72841<br/>Group Title: SRG-APP-000142-DB-000094<br/>Rule ID: SV-87493r1_rule<br/>Severity: CAT II<br/>Rule Version (STIG-ID): PGS9-00-000100<br/>Rule Title: PostgreSQL must be configured to prohibit or restrict the use of organization-defined functions, ports, protocols, and/or services, as definedin the PPSM CAL and vulnerability assessments.</span><span id="c442" class="kf kg hu md b fv mq mn l mo mp">...</span><span id="dcd3" class="kf kg hu md b fv mq mn l mo mp">To support the requirements and principles of least functionality, the application must support the organizational requirements providing only essential capabilities and limiting the use of ports, protocols, and/or services to only those required, authorized, and approved to conduct official business or to address authorized quality of life issues.</span><span id="0df6" class="kf kg hu md b fv mq mn l mo mp">Database Management Systems using ports, protocols, and services deemed unsafe are open to attack through those ports, protocols, and services. This can allow unauthorized access to the database and through the database to other components of the information system.</span><span id="02ec" class="kf kg hu md b fv mq mn l mo mp">Check Content:<br/>As the database administrator, run the following SQL:<br/>$ psql -c "SHOW port"<br/>If the currently defined port configuration is deemed prohibited, this is a finding.<br/>Fix Text: Note: The following instructions use the PGDATA environment variable. See supplementary content APPENDIX-F for instructions on<br/>configuring PGDATA.<br/>To change the listening port of the database, as the database administrator, change the following setting in postgresql.conf:<br/>$ sudo su - postgres<br/>$ vi $PGDATA/postgresql.conf<br/>Change the port parameter to the desired port.</span></pre><p id="70f6" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这在<code class="eh ma mb mc md b">postgresql.yml</code>中作为审计规则实施，如下所示:</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="59c1" class="kf kg hu md b fv mm mn l mo mp">-   id: 1<br/>        title:  Server port is set to default (Port)<br/>        tags:<br/>            -   STIG/V-72841/PostgreSQL must be configured to prohibit or restrict the use of organization defined functions, ports, protocols, and/or services<br/>        severity: 1<br/>        xpathtest:  not(boolean(/PGSQL/Values/port)) or boolean(/PGSQL/Values/port='5432') <br/>        summary: |<br/>        By default postgres runs on port 5432. Most attackers will check if a server is listening on port 5432.<br/>        If you change the port # to something different, others need to know exactly what port to use to access the server.  <br/>        resolution: |<br/>        Add a directive like the following to the PGSQL configuration file: port 9122. <br/>        urls:<br/>            -   https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf</span></pre><p id="b006" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">该审计规则查询PostgreSQL配置文件，以确定<code class="eh ma mb mc md b">port</code>配置指令是未设置还是设置为默认值。</p><h2 id="0a3a" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">将PostgreSQL STIG规则实施为审计规则</h2><p id="cb0d" class="pw-post-body-paragraph jg jh hu ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hn dt translated">DevAudit使用<a class="ae ke" href="https://github.com/allisterb/Alpheus" rel="noopener ugc nofollow" target="_blank"> Alpheus </a>库来解析和查询服务器配置文件。Alpheus将配置文件创建为XML文档，并允许您使用<a class="ae ke" href="https://www.w3schools.com/xml/xpath_intro.asp" rel="noopener ugc nofollow" target="_blank"> XPATH </a>查询来查询这个文档。除了理解配置文件的语法，Alphues还试图理解像包含文件这样的元素的语义。如下所示的PostgreSQL配置文件:</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="07b0" class="kf kg hu md b fv mm mn l mo mp"># -----------------------------                                                                            <br/># PostgreSQL configuration file                                                                            <br/># -----------------------------                                                                            <br/>#                                                                                                          <br/># This file consists of lines of the form:                                                                 </span><span id="3565" class="kf kg hu md b fv mq mn l mo mp">...<br/>                                                                                                          <br/># The default values of these variables are driven from the -D command-line                                <br/># option or PGDATA environment variable, represented here as ConfigDir.                                    <br/>                                                                                                           <br/>data_directory = '/var/lib/postgresql/9.5/main'         # use data in another directory                    <br/>                                        # (change requires restart)                                        <br/>hba_file = '/etc/postgresql/9.5/main/pg_hba.conf'       # host-based authentication file                   <br/>                                        # (change requires restart)<br/>...</span></pre><p id="ef71" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">将被表示为如下所示的XML</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="b96e" class="kf kg hu md b fv mm mn l mo mp">&lt;PGSQL&gt;<br/>  &lt;Values File="postgresql.conf"&gt;<br/>    &lt;Line_1_Comment File="postgresql.conf"&gt;<br/>      &lt;Value Position="1" Column="2" Line="1" Length="30" File="postgresql.conf"&gt; -----------------------------&lt;/Value&gt;<br/>    &lt;/Line_1_Comment&gt;</span><span id="841e" class="kf kg hu md b fv mq mn l mo mp">...</span><span id="3046" class="kf kg hu md b fv mq mn l mo mp">&lt;hba_file Position="1851" Column="1" Line="43" Length="8" File="postgresql.conf"&gt;<br/>     &lt;Value Position="1863" Column="13" Line="43" Length="36" File="postgresql.conf"&gt;/etc/postgresql/9.5/main/pg_hba.conf&lt;/Value&gt;<br/>&lt;/hba_file&gt;<br/>&lt;Line_43_Comment File="postgresql.conf"&gt;<br/>      &lt;Value Position="1902" Column="52" Line="43" Length="31" File="postgresql.conf"&gt; host-based authentication file&lt;/Value&gt;<br/>&lt;/Line_43_Comment&gt;<br/>&lt;Line_44_Comment File="postgresql.conf"&gt;<br/>      &lt;Value Position="1940" Column="7" Line="44" Length="26" File="postgresql.conf"&gt; (change requires restart)&lt;/Value&gt;<br/>&lt;/Line_44_Comment&gt;<br/>&lt;ident_file Position="1967" Column="1" Line="45" Length="10" File="postgresql.conf"&gt;<br/>      &lt;Value Position="1981" Column="15" Line="45" Length="38" File="postgresql.conf"&gt;/etc/postgresql/9.5/main/pg_ident.conf&lt;/Value&gt;</span></pre><p id="5b13" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">配置文件的每个注释和指令都表示为一个XML元素，该元素具有声明指令或注释在配置文本文件中的精确位置的属性。通过将配置文件的内容和结构表示为XML，Alpheus可以对配置文件执行复杂的查询，这远远超出了使用正则表达式的典型<code class="eh ma mb mc md b">grep</code>搜索。Alpheus还可以解释包含文件的语法元素，并将从任何包含文件中解析的XML内容插入到父文档的根元素中。</p><p id="e43a" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">对于第一个审计规则，我们使用XPATH查询来检查复杂的条件:</p><p id="bb2f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">端口指令不存在</p><p id="34eb" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">或者</p><p id="803d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">端口指令设置为5432。</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="c3b8" class="kf kg hu md b fv mm mn l mo mp">not(boolean(/PGSQL/Values/port)) or boolean(/PGSQL/Values/port='5432')</span></pre><p id="5ccf" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">如果满足此条件，则DevAudit会将其标记为一个查找。每个审核规则都有附加属性，如标题、摘要、标签，这些属性会在应用程序配置审核结果报告中打印出来。</p><p id="94c9" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">目前只有大约7个PostgreSQL的STIG规则由DevAudit实现。我们目前正在为每个受支持的服务器审计目标构建规则集，并添加所需的额外审计功能(如在目标数据库服务器上运行SQL查询)，这将允许为每个服务器STIG全面实现规则。您还可以添加PostgreSQL服务器部署所需的任何定制配置审计规则，方法是将它们附加到<code class="eh ma mb mc md b">Rules/postgresql.yml</code>文件中。</p><h2 id="179e" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">未来的DevAudit服务器审计功能</h2><p id="7353" class="pw-post-body-paragraph jg jh hu ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hn dt translated">目前，DevAudit仅限于服务器配置文件的语法分析。实施服务器审计需要额外的功能，如:</p><ul class=""><li id="a563" class="lf lg hu ji b jj jk jn jo jr lh jv li jz lj kd lk ll lm ln dt translated">在目标数据库服务器上执行SQL查询，以检索配置设置、数据库元数据和模式信息。</li><li id="a4c5" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated">在目标服务器的操作环境中执行shell命令，以检索环境变量、文件系统权限和所有权以及其他系统信息。</li></ul><p id="b099" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">最终，DevAudit审计规则将包含如下测试</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="a31c" class="kf kg hu md b fv mm mn l mo mp">%env(PGPORT)='5432' or %sql(SHOW port)='5432'</span></pre><p id="3e36" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这将允许全面实施服务器STIG规则。</p><h2 id="b291" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">远程审核Windows PostgreSQL服务器</h2><p id="9221" class="pw-post-body-paragraph jg jh hu ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hn dt translated">我们还可以通过WinRM使用DevAudit的远程审计功能来审计Windows机器。在这里，我将使用以下命令行选项创建一个WinRM审核环境，从另一台Windows计算机开始审核远程Windows PostgreSQL服务器:</p><p id="c04c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh ma mb mc md b">-w</code>指定我们想要使用WinRM协议进行审计。</p><p id="c3d5" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh ma mb mc md b">-s</code>指定要连接的Windows计算机的IP。</p><p id="3f7c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh ma mb mc md b">-u</code>指定连接到Windows机器的用户。</p><p id="e62d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><code class="eh ma mb mc md b">-p</code>指定连接到Windows机器的用户的密码。</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="9a6c" class="kf kg hu md b fv mm mn l mo mp">&gt; devaudit pgsql -w -s 192.168.56.103 -u Administrator -p -r C:\Apps\pgsql -c <a class="ae ke" href="http://twitter.com/postgresql" rel="noopener ugc nofollow" target="_blank">@postgresql</a>.conf                                                                                                                <br/>Password:                                                                                                                                                                                                     <br/> _____                 _______            __  __  __                                                                                                                                                          <br/>|     \ .-----..--.--.|   _   |.--.--..--|  ||__||  |_                                                                                                                                                        <br/>|  --  ||  -__||  |  ||       ||  |  ||  _  ||  ||   _|                                                                                                                                                       <br/>|_____/ |_____| \___/ |___|___||_____||_____||__||____|                                                                                                                                                       <br/>                                                                                                                                                                                                              <br/>                                                                                                                                                                                                              <br/>v2.1.0.0                                                                                                                                                                                                      <br/>05:16:11&lt;01&gt; [HOST] [STATUS] Connecting to Windows host address 192.168.56.103                                                                                                                                <br/>Connecting to Windows host address 192.168.56.103..                                                                                                                                                           <br/>05:16:13&lt;01&gt; [HOST] [SUCCESS] Connected to Windows host address 192.168.56.103. Computer name: WIN-H1LOJM1A4GD. Windows version: Microsoft Windows Server 2008 R2 Standard .                                  <br/>05:16:14&lt;01&gt; [AUDIT] [SUCCESS] Auto-detected PostgreSQL server binary at C:\Apps\pgsql\bin\postgres.exe.                                                                                                      <br/>05:16:15&lt;01&gt; [AUDIT] [INFO] Using PostgreSQL configuration file C:\Apps\pgsql\postgresql.conf.                                                                                                                <br/>05:16:15&lt;01&gt; [AUDIT] [SUCCESS] Got PostgreSQL server version 9.1.24.                                                                                                                                          <br/>Scanning PostgreSQL packages...                                                                                                                                                                               <br/>05:16:16&lt;11&gt; [AUDIT] [SUCCESS] Parsed configuration from C:\Apps\pgsql\postgresql.conf. Successfully included 0 out of 0 include files. First line parsed 1. Last line parsed: 557. Parsed 1 total configurati<br/>on nodes. Parsed 453 total comments.                                                                                                                                                                          </span><span id="ea76" class="kf kg hu md b fv mq mn l mo mp">...                                                                                                                <br/>                                                                                                                                                                                                              <br/>Application Configuration Audit Results                                                                                                                                                                       <br/>=======================================                                                                                                                                                                       <br/>4 total vulnerabilities found in PostgreSQL application configuration audit. Total time for audit: 8370 ms.                                                                                                   <br/>                                                                                                                                                                                                              <br/>[1/1] Module: postgresql. 7 rule(s).  4 rule(s) succeeded. [VULNERABLE]                                                                                                                                       <br/>--[1/7] Rule: Server port is set to default (Port). Result: True.                                                                                                                                             <br/>  --Summary:                                                                                                                                                                                                  <br/>    --By default postgres runs on port 5432. Most attackers will check if a server is listening on port 5432.                                                                                                 <br/>    --If you change the port # to something different, others need to know exactly what port to use to access the server.                                                                                     <br/>  --Tags:                                                                                                                                                                                                     <br/>    --STIG/V-72841/PostgreSQL must be configured to prohibit or restrict the use of organization defined functions, ports, protocols, and/or services                                                         <br/>  --Severity: 1                                                                                                                                                                                               <br/>  --Resolution:                                                                                                                                                                                               <br/>    --Add a directive like the following to the PGSQL configuration file: port 9122.                                                                                                                          <br/>  --Urls:                                                                                                                                                                                                     <br/>    --<a class="ae ke" href="https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf" rel="noopener ugc nofollow" target="_blank">https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf</a>                                                                                                                                           <br/>                                                                                                                                                                                                              <br/>--[2/7] Rule: log_timezone is not set. Result: True.                                                                                                                                                          <br/>  --Summary:                                                                                                                                                                                                  <br/>    --Time stamps generated by PostgreSQL must include date and time. Time is commonly expressed in Coordinated Universal Time (UTC),                                                                         <br/>    --a modern continuation of Greenwich Mean Time (GMT), or local time with an offset from UTC.                                                                                                              <br/>  --Tags:                                                                                                                                                                                                     <br/>    --STIG/V-72887/PostgreSQL must record time stamps, in audit records and application data, that can be mapped to Coordinated Universal Time (UTC, formerly GMT)..                                          <br/>  --Severity: 2                                                                                                                                                                                               <br/>  --Resolution:                                                                                                                                                                                               <br/>    --Set the log_timezone directive in the PGSQL configuration file to the current timezone.                                                                                                                 <br/>  --Urls:                                                                                                                                                                                                     <br/>    --<a class="ae ke" href="https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf" rel="noopener ugc nofollow" target="_blank">https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf</a>                                                                                                                                           <br/>                                                                                                                                                                                                              <br/>--[3/7] Rule: Server auditing is not enabled. Result: True.                                                                                                                                                   <br/>  --Summary:                                                                                                                                                                                                  <br/>    --Information system auditing capability is critical for accurate forensic analysis.                                                                                                                      <br/>    --Without information about the outcome of events, security personnel cannot make an accurate assessment as to whether an attack was successful or if changes were made to the security state of the syste<br/>m.                                                                                                                                                                                                            <br/>    --Event outcomes can include indicators of event success or failure and event-specific results (e.g., the security state of the information system after the event occurred).                             <br/>    --As such, they also provide a means to measure the impact of an event and help authorized personnel to determine the appropriate response.                                                               <br/>  --Tags:                                                                                                                                                                                                     <br/>    --STIG/V-72843/PostgreSQL must produce audit records containing sufficient information to establish the outcome (success or failure) of the events.                                                       <br/>  --Severity: 2                                                                                                                                                                                               <br/>  --Resolution:                                                                                                                                                                                               <br/>    --You must install and configure the pgaudit extension.                                                                                                                                                   <br/>  --Urls:                                                                                                                                                                                                     <br/>    --<a class="ae ke" href="https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf" rel="noopener ugc nofollow" target="_blank">https://www.crunchydata.com/postgres-stig/PGSQL-STIG-9.5+.pdf</a>                                                                                                                                           <br/>    --<a class="ae ke" href="http://pgaudit.org" rel="noopener ugc nofollow" target="_blank">http://pgaudit.org</a>                                                                                                                                                                                      <br/>                                                                                                                                                                                                              <br/>--[4/7] Rule: Server log files are not mode 0600. Result: False.                                                                                                                                              <br/>--[5/7] Rule: max_connections is not set. Result: False.                                                                                                                                                      <br/>--[6/7] Rule: client_min_messages is not set to error. Result: True.                                                                                                                                          </span><span id="9e89" class="kf kg hu md b fv mq mn l mo mp">...<br/></span></pre><p id="a9e1" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在这里，我们使用远程计算机上的PostgreSQL根目录C:\Apps\pgsql和指定根目录中的配置文件postgresql.conf来审核位于192.168.56.103的Windows计算机。DevAudit检测到PGSQL版本为9.1.24，并发现4个违反STIG审核规则的配置问题。</p><h2 id="bc5b" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">审核PostgreSQL server Docker容器</h2><figure class="me mf mg mh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mr"><img src="../Images/c61993b6c3ef2812a4b247b17c36e4b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eZIXt7oEIfT3U6Xuhxkz7g.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">PostgreSQL 9.6 Docker container audit</figcaption></figure><p id="8210" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">应用程序部署的一个常见场景是作为Docker容器运行。我们可以通过用运行Docker容器的名称或id指定<code class="eh ma mb mc md b">-i</code>选项来创建一个DevAudit Docker容器审计环境。这里我们连接到一个名为pgsql1的正在运行的Docker容器。所有后续的DevAudit程序选项保持不变，服务器审计照常进行:</p><pre class="me mf mg mh fq mi md mj mk aw ml dt"><span id="bee9" class="kf kg hu md b fv mm mn l mo mp">allisterb@ubuntu:~/DevAudit$ ./devaudit pgsql -i pgsql1 -c /var/lib/postgresql/data/postgresql.conf<br/> _____                 _______            __  __  __<br/>|     \ .-----..--.--.|   _   |.--.--..--|  ||__||  |_<br/>|  --  ||  -__||  |  ||       ||  |  ||  _  ||  ||   _|<br/>|_____/ |_____| \___/ |___|___||_____||_____||__||____|</span><span id="a2c1" class="kf kg hu md b fv mq mn l mo mp">v2.1.0.0<br/>08:20:33&lt;01&gt; [HOST] [SUCCESS] Found Docker container with id or name pgsql1.<br/>08:20:33&lt;01&gt; [AUDIT] [SUCCESS] Auto-detected PostgreSQL server binary at /usr/lib/postgresql/9.6/bin/postgres.<br/>08:20:33&lt;01&gt; [AUDIT] [INFO] Using PostgreSQL configuration file /var/lib/postgresql/data/postgresql.conf.<br/>08:20:33&lt;01&gt; [AUDIT] [SUCCESS] Got PostgreSQL server version 9.6.2.<br/>08:20:33&lt;01&gt; [AUDIT] [STATUS] Scanning PostgreSQL packages.<br/>Scanning PostgreSQL packages...<br/>08:20:35&lt;04&gt; [AUDIT] [SUCCESS] Parsed configuration from /var/lib/postgresql/data/postgresql.conf. Successfully included 0 out of 0 include files. First line parsed 1. Last line parsed: 524. Parsed 1 total configuration nodes. Parsed 519 total comments.<br/>08:20:35&lt;04&gt; [AUDIT] [INFO] Found PostgreSQL server auto configuration file /var/lib/postgresql/data/postgresql.auto.conf.<br/>08:20:35&lt;04&gt; [AUDIT] [SUCCESS] Merged configuration from /var/lib/postgresql/data/postgresql.auto.conf.<br/>08:20:35&lt;01&gt; [AUDIT] [SUCCESS] Scanned 1 PostgreSQL packages.<br/>Searching OSS Index for vulnerabilities for 1 packages...</span></pre><p id="a69e" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">DevAudit可以在容器部署之前提供对特定应用服务器配置问题的扫描，是对专用Docker image <a class="ae ke" href="https://docs.docker.com/datacenter/dtr/2.2/guides/user/manage-images/scan-images-for-vulnerabilities/#view-security-scan-results" rel="noopener ugc nofollow" target="_blank">安全扫描</a>的很好补充。审计规则不限于安全性，还可以包括性能、复制、集群、服务器故障转移等规则。</p><h2 id="fa5e" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">结论</h2><p id="2b00" class="pw-post-body-paragraph jg jh hu ji b jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd hn dt translated">DevAudit可以根据DISA PostgreSQL STIG的安全规则以及任何其他来源的安全和强化准则，审核多个环境中PostgreSQL服务器的服务器配置。我们正在构建项目的功能，以审计越来越多的服务器(如MongoDB ),以及可用于每个服务器审计的审计功能。对于采用DevOps和DevSecOps的DBA、开发人员和团队来说，DevAudit是一个很好的平台，可以将自动化安全检查集成为开发和部署流程中一致且定义良好的部分。</p><h2 id="8e8b" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">链接</h2><ul class=""><li id="36c8" class="lf lg hu ji b jj la jn lb jr ms jv mt jz mu kd lk ll lm ln dt translated"><a class="ae ke" href="https://github.com/OSSIndex/DevAudit" rel="noopener ugc nofollow" target="_blank"> GitHub项目pag </a> e</li><li id="1850" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated"><a class="ae ke" href="https://gitpitch.com/OSSIndex/DevAudit" rel="noopener ugc nofollow" target="_blank">DevAudit上的简短演示</a>。</li><li id="426d" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated"><a class="ae ke" href="https://ossindex.net/" rel="noopener ugc nofollow" target="_blank"> OSS指数:</a>开源包和漏洞数据的指数。</li><li id="3c4e" class="lf lg hu ji b jj lo jn lp jr lq jv lr jz ls kd lk ll lm ln dt translated"><a class="ae ke" href="https://vorsecurity.com/" rel="noopener ugc nofollow" target="_blank">VR Security</a>:联系商业支持选项。</li></ul><div class="me mf mg mh fq ab cb"><figure class="mv iv mw mx my mz na paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="mv iv mw mx my mz na paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="mv iv mw mx my mz na paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="lt lu lv"><p id="f922" class="jg jh lw ji b jj jk jl jm jn jo jp jq lx js jt ju ly jw jx jy lz ka kb kc kd hn dt translated"><a class="ae ke" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ke" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ke" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae ke" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jg jh lw ji b jj jk jl jm jn jo jp jq lx js jt ju ly jw jx jy lz ka kb kc kd hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ke" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ke" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="me mf mg mh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nb"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="me mf mg mh fq iv"><div class="bz el l di"><div class="nc nd l"/></div></figure></div></div>    
</body>
</html>