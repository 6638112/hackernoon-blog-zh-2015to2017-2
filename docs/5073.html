<html>
<head>
<title>A guide to TDD a React/Redux TodoList App — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TDD a React/Redux TodoList应用程序指南—第2部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-guide-to-tdd-a-react-redux-todolist-app-part-2-8d4cb2dc154c?source=collection_archive---------3-----------------------#2017-07-09">https://medium.com/hackernoon/a-guide-to-tdd-a-react-redux-todolist-app-part-2-8d4cb2dc154c?source=collection_archive---------3-----------------------#2017-07-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="84ff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" rel="noopener" href="/@sanjsanj/a-guide-to-tdd-a-react-redux-todolist-app-part-1-b8a200bb7091">第1部分—链接</a>。</p><p id="8f4a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第二部分——你现在在这里。</p><p id="0b8f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" rel="noopener" href="/@sanjsanj/a-guide-to-tdd-a-react-redux-todolist-app-part-3-f25c2289c54">第三部分——链接</a>。</p><p id="26ac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" rel="noopener" href="/@sanjsanj/a-guide-to-tdd-a-react-redux-todolist-app-part-4-edb62e113c9b">第4部分—链接</a>。</p><h1 id="ce2d" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">添加待办事项</h1><p id="e00e" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">现在让我们编写一个更有用的特性测试，它将帮助我们编写相应的单元测试和代码来实际构建我们想要的功能:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">e2etests/test.js</figcaption></figure><p id="49b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们用简单的英语把它分解。</p><p id="be31" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 9</code>创建一个<code class="eh le lf lg lh b">todoText</code>字符串常量。</p><p id="b2b2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 10</code>导航到页面。</p><p id="d99a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 11</code>找到<code class="eh le lf lg lh b">.todo-input</code>元素，进入<code class="eh le lf lg lh b">todoText</code>。</p><p id="1e7d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 12</code>点击<code class="eh le lf lg lh b">.todo-submit</code>元素。</p><p id="561f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 13</code>找到<code class="eh le lf lg lh b">.todo-text</code>元素，并将其文本值赋给<code class="eh le lf lg lh b">actual</code>常量。</p><p id="f564" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 15</code>断言<code class="eh le lf lg lh b">actual</code>等于<code class="eh le lf lg lh b">todoText</code>。</p><p id="2b0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">运行测试，看着它失败。你应该有一个通过和一个失败的e2e测试，如果都失败了，你有一个观察模式的问题，应该手动运行e2e测试。我还没有时间来正确地调试这个手表问题，但是如果你有适当的动机，就继续吧。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="fe ff li"><img src="../Images/2e79d4fd0eb8ba618030dc4170c45da5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mAPR3u-RT4uGUBWpmXpESQ.png"/></div></div></figure><p id="8b4f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们编写必要的代码之前，我们将编写适当的单元测试，在此之前，让我们修复e2e测试中的eslint错误。将以下注释添加到<code class="eh le lf lg lh b">e2etests/test.js</code>文件的顶部:</p><p id="30fa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">/* global describe, it, browser */</code></p><p id="bd65" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们在那个文件中得到另一个eslint错误，抱怨<code class="eh le lf lg lh b">chai</code>是一个devDependency，那么有一个已知的bug已经引起了一些关于eslint规则合并的争论。这与我们在这里做的事情无关，但是如果你想知道更多的话，请从这里开始阅读。</p><p id="d179" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">目前的解决方案是在我们的<code class="eh le lf lg lh b">.eslintrc.js</code>中添加另一条规则</p><pre class="kt ku kv kw fq lp lh lq lr aw ls dt"><span id="227e" class="lt jr hu lh b fv lu lv l lw lx">rules: {<br/>  ...<br/>  "import/no-extraneous-dependencies": [2, { devDependencies: true }],<br/>},</span></pre><p id="09be" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是我的<code class="eh le lf lg lh b">.eslintrc.js</code>现在的样子:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">.eslintrc.js</figcaption></figure><p id="711e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们创建下面的文件夹结构<code class="eh le lf lg lh b">src/components/addTodo/</code>，并在其中创建一个占位符<code class="eh le lf lg lh b">index.js</code>，将其留空。我们不想写任何我们不需要的代码，我们只需要足够的代码来通过我们的测试。所以让我们在<code class="eh le lf lg lh b">src/components/addTodo/test.js</code>写一个单元测试:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">src/components/addTodo/test.js</figcaption></figure><p id="6e48" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 5</code>从与该测试相同的文件夹中的<code class="eh le lf lg lh b">index.js</code>导入一个<code class="eh le lf lg lh b">AddTodo</code>组件。</p><p id="883e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 9 — 10</code>浅层渲染组件到<code class="eh le lf lg lh b">component</code>常量，并期望它存在。</p><p id="cf6b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个单元测试应该会失败，因为我们的<code class="eh le lf lg lh b">.../addTodo/index.js</code>没有返回任何东西，因此无法呈现。因此，让我们创建我们的组件:</p><p id="56a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="ly">您应该让您的单元测试任务运行，如果不是，那么运行</em> <code class="eh le lf lg lh b"><em class="ly">npm run test</em></code> <em class="ly">。</em></p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">src/components/addTodo/index.js</figcaption></figure><p id="4a3a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们的测试应该通过了。让我们来编写下一个测试，这是我们离最终目标更近一步所必须做的最起码的工作:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">src/components/addTodo/test.js</figcaption></figure><p id="5348" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">测试应该会失败，让我们尽最大努力让它通过:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">src/components/addTodo/index.js</figcaption></figure><p id="e38f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此时，我们可以将我们的<code class="eh le lf lg lh b">AddTodo</code>组件合并到我们的主<code class="eh le lf lg lh b">App</code>中，这将帮助我们通过e2e测试中的第一个错误，并显示我们还需要做什么:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">src/App.js</figcaption></figure><p id="e5ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 2</code>导入<code class="eh le lf lg lh b">AddTodo</code>组件。</p><p id="078f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 7</code>添加到我们的<code class="eh le lf lg lh b">App</code>。</p><p id="b4a4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 6</code>添加适当的标题。</p><p id="0c74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的e2e测试现在应该显示它能够找到<code class="eh le lf lg lh b">.todo-input</code>并在其中输入一些文本，但是它不能找到<code class="eh le lf lg lh b">.todo-submit</code>，所以这正是我们接下来要进行单元测试和编码的内容:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">src/components/addTodo/test.js</figcaption></figure><p id="3b6d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所以让我们添加我们需要的<code class="eh le lf lg lh b">.todo-submit</code>元素，我们知道我们希望它是一个按钮。现在我知道你在想什么了，<em class="ly">‘一个输入，一个提交按钮，接下来是什么——一个表单？’</em>，没错你说对了，一个形式！</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">src/components/addTodo/index.js</figcaption></figure><p id="2ad7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的e2e测试可以在输入中输入文本，并单击提交按钮，但是我们需要为它挂接功能，但是让我们先编写一个适当的单元测试:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">src/components/addTodo/test.js</figcaption></figure><p id="2246" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 1</code>为<code class="eh le lf lg lh b">jest</code>的eslint添加一个例外。</p><p id="58ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将<code class="eh le lf lg lh b">jest.fn()</code>方法指定为我们的模拟。我们使用它是因为它与我们的<a class="ae jp" href="https://hackernoon.com/tagged/app" rel="noopener ugc nofollow" target="_blank">应用</a>捆绑在一起，并为我们提供了<a class="ae jp" href="https://facebook.github.io/jest/docs/mock-functions.html" rel="noopener ugc nofollow" target="_blank">好的帮助方法</a>，使测试函数被调用变得容易，同时不用担心它的实际实现。</p><p id="e52d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 4</code>我们从<code class="eh le lf lg lh b">enzyme</code>进口<code class="eh le lf lg lh b">mount</code>模块。</p><p id="2d5e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 15</code>我们实际上<code class="eh le lf lg lh b">mount</code>了我们的组件，所以我们可以访问表单提交上的<code class="eh le lf lg lh b">event</code>到<code class="eh le lf lg lh b">preventDefault()</code>。我们也用一个<code class="eh le lf lg lh b">submitTodo</code> prop实例化它，我们给它一个<code class="eh le lf lg lh b">submitMock</code>函数。</p><p id="e86f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">&lt;AddTodo submitTodo={submitMock} /&gt;</code>翻译过来就是；创建一个AddTodo组件，它有一个名为<code class="eh le lf lg lh b">submitTodo</code>的属性，当我们实例化这个组件时，传入<code class="eh le lf lg lh b">submitMock</code>作为那个属性。稍后在组件本身中，我们将为道具编写一些验证，以确保它是一个函数。</p><p id="2cf0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 17 — 19</code>我们期望我们的<code class="eh le lf lg lh b">submitTodo</code>从零个调用开始，一旦我们提交表单，它就有一个调用，确认事件被触发。</p><p id="e0f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将要对我们的<code class="eh le lf lg lh b">AddTodo</code>组件进行实质性的修改，但是首先让我们安装prop-types节点包:</p><p id="505a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">npm install --save-dev prop-types</code></p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">src/components/addTodo/index.js</figcaption></figure><p id="920e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们来看看这些变化:</p><p id="fdb6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 4 — 7</code>我们对组件的语法做了一点修改。因为我们想做的不仅仅是返回一些从开始构造时就有的标记:</p><pre class="kt ku kv kw fq lp lh lq lr aw ls dt"><span id="e5ef" class="lt jr hu lh b fv lu lv l lw lx">const Something = () =&gt; (<br/>  &lt;p&gt;Return something&lt;/p&gt;<br/>);</span></pre><p id="1809" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">收件人:</p><pre class="kt ku kv kw fq lp lh lq lr aw ls dt"><span id="0ae9" class="lt jr hu lh b fv lu lv l lw lx">const Something = () =&gt; {<br/>  const text = "Return something";</span><span id="5785" class="lt jr hu lh b fv lz lv l lw lx">  return (<br/>    &lt;p&gt;{text}&lt;/p&gt;<br/>  );<br/>};</span></pre><p id="7151" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后:</p><p id="c3bb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 5</code>我们需要一个可变变量来存储我们的输入文本，所以我们做了一个<code class="eh le lf lg lh b">let input;</code>。</p><p id="7b01" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 19 — 21</code>当我们提交表单时，我们希望发送输入的文本，所以我们告诉<a class="ae jp" href="https://hackernoon.com/tagged/" rel="noopener ugc nofollow" target="_blank"> React </a>存储一个对这个DOM元素的<code class="eh le lf lg lh b">ref</code>(引用)，这意味着React将能够跟踪并在组件中使用它。然后将该元素赋给可变的<code class="eh le lf lg lh b">input</code>变量。</p><p id="bd9c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="ly">以上还有更好的方法，但我认为这是一个很好的机会来探索一个</em><code class="eh le lf lg lh b"><em class="ly">ref</em></code><em class="ly"/><a class="ae jp" href="https://facebook.github.io/react/docs/refs-and-the-dom.html" rel="noopener ugc nofollow" target="_blank"><em class="ly">的功能。</em></a></p><p id="983c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 10 — 14</code>我们告诉表单要做什么<code class="eh le lf lg lh b">onSubmit</code>。首先是<code class="eh le lf lg lh b">preventDefault</code>动作，在这种情况下是重新加载页面，因为这是表单提交的默认行为。然后用<code class="eh le lf lg lh b">input.value</code>调用一个<code class="eh le lf lg lh b">submitTodo</code>函数，在这个例子中是输入到输入中的文本。然后将<code class="eh le lf lg lh b">input.value</code>设置回一个空字符串，这样它就会清除输入文本框。</p><p id="f1aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 4</code>我们将<code class="eh le lf lg lh b">submitTodo</code>函数作为属性传递给组件，也就是<code class="eh le lf lg lh b">prop</code>。阅读关于<a class="ae jp" href="https://facebook.github.io/react/docs/components-and-props.html" rel="noopener ugc nofollow" target="_blank">组件和道具</a>的内容。</p><p id="3aa8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 2</code>我们必须导入<code class="eh le lf lg lh b">prop-types</code>节点包，以便在我们没有为它们提供值时给我们正确的验证和默认值。</p><p id="e9f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 32 — 34</code>我们必须在我们的组件中验证<code class="eh le lf lg lh b">prop</code>，所以我们告诉React它将是一个函数，当我们实例化这个组件时，它是必需的。阅读关于<a class="ae jp" href="https://facebook.github.io/react/docs/typechecking-with-proptypes.html" rel="noopener ugc nofollow" target="_blank">验证属性类型</a>的内容。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="fe ff li"><img src="../Images/3af26c612f95199e3e700cd3aa0402d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YkNvGMkYXlXchO896mU6_g.png"/></div></div></figure><p id="51d9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们刚刚编写的测试通过了，但是我们对<code class="eh le lf lg lh b">AddTodo</code>组件的修改破坏了另外两个测试。我们现在告诉组件，它在实例化时需要一个<code class="eh le lf lg lh b">submitTodo</code> prop，它是一个函数，是必需的，我们还没有提供默认值。</p><pre class="kt ku kv kw fq lp lh lq lr aw ls dt"><span id="3e39" class="lt jr hu lh b fv lu lv l lw lx">// src/components/addTodo/index.js<br/>// Line 32 - 34</span><span id="3cab" class="lt jr hu lh b fv lz lv l lw lx">AddTodo.propTypes = {<br/>  submitTodo: PropTypes.func.isRequired,<br/>};</span></pre><p id="6136" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在在我们的测试中，我们希望组件的每个实例也有这个属性，但这将是许多重构的第一步，所以让我们稍微优化一下我们的设置，记住DRY(不要重复自己)。</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">src/components/addTodo/test.js</figcaption></figure><p id="8c2c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 8 — 17</code>我们创建一个可变的<code class="eh le lf lg lh b">component</code>变量，并将其分配给我们的<code class="eh le lf lg lh b">shallow</code>挂载组件<code class="eh le lf lg lh b">beforeEach</code>测试，并从每个单独的<code class="eh le lf lg lh b">it(...)</code>块中移除该分配。</p><p id="4ff5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 33</code>我们仍然必须保留这个赋值，因为我们实际上希望<code class="eh le lf lg lh b">mount</code>在为这个测试渲染时使用它。</p><p id="c58c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 1</code>将<code class="eh le lf lg lh b">beforeEach</code>添加到eslint异常中。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="fe ff li"><img src="../Images/dff50b4e35d6b58f617a995352a4175c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NONYWahs88q_H7TQhvB2hQ.png"/></div></div></figure><p id="ad65" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们要修复我们的应用程序测试。它告诉我们错误发生在哪里，<code class="eh le lf lg lh b">App.js Line 7</code>:</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="ky kz l"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">src/App.js</figcaption></figure><p id="c37f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh le lf lg lh b">Line 7</code>现在我们只是将一个空的ES6箭头函数<code class="eh le lf lg lh b">() =&gt; {}</code>传递给我们的<code class="eh le lf lg lh b">AddTodo</code>的<code class="eh le lf lg lh b">submitTodo</code>道具。这将允许我们通过我们的组件验证，并再次通过单元测试，尽管它不会帮助我们的e2e测试进展或实际上增加任何功能…但这是我们接下来要做的。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="fe ff ma"><img src="../Images/d67627e33b80d2033d801c493f143055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x2yFep_my-uibhO9P7wI_w.png"/></div></div></figure><ul class=""><li id="a6c1" class="mb mc hu it b iu iv iy iz jc md jg me jk mf jo mg mh mi mj dt translated"><a class="ae jp" href="https://github.com/sanjsanj/my-react-todolist/commit/cde73d27d845c8f6d25bc7b181400b3fa7453f6a" rel="noopener ugc nofollow" target="_blank"> Git提交</a></li><li id="051d" class="mb mc hu it b iu mk iy ml jc mm jg mn jk mo jo mg mh mi mj dt translated"><a class="ae jp" href="https://github.com/sanjsanj/my-react-todolist/tree/cde73d27d845c8f6d25bc7b181400b3fa7453f6a" rel="noopener ugc nofollow" target="_blank">储存库的状态</a></li></ul><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff mp"><img src="../Images/bf85a2771bb1e5f72910a5e1017e3f69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*jj-fzkU7D93IzEVhP4fVmQ.png"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">What our App looks like now.</figcaption></figure><h1 id="fb09" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">概述</h1><p id="e38e" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">我们已经学会了如何:</p><ul class=""><li id="890f" class="mb mc hu it b iu iv iy iz jc md jg me jk mf jo mg mh mi mj dt translated">写一个有用的特性测试。</li><li id="344a" class="mb mc hu it b iu mk iy ml jc mm jg mn jk mo jo mg mh mi mj dt translated">单元测试React组件的创建。</li><li id="f214" class="mb mc hu it b iu mk iy ml jc mm jg mn jk mo jo mg mh mi mj dt translated">验证属性类型。</li></ul><h1 id="f834" class="jq jr hu bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">下一个</h1><p id="3d90" class="pw-post-body-paragraph ir is hu it b iu ko iw ix iy kp ja jb jc kq je jf jg kr ji jj jk ks jm jn jo hn dt translated">现在我们需要超越仅仅创建UI，开始通过<code class="eh le lf lg lh b">actions</code>设置我们的事件调度程序，通过<code class="eh le lf lg lh b">reducers</code>设置事件处理程序。</p><p id="3c61" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" rel="noopener" href="/@sanjsanj/a-guide-to-tdd-a-react-redux-todolist-app-part-1-b8a200bb7091">第1部分—链接</a>。</p><p id="4ccd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第二部分——你现在在这里。</p><p id="fa17" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" rel="noopener" href="/@sanjsanj/a-guide-to-tdd-a-react-redux-todolist-app-part-3-f25c2289c54">第3部分—链接</a>。</p><p id="2adc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" rel="noopener" href="/@sanjsanj/a-guide-to-tdd-a-react-redux-todolist-app-part-4-edb62e113c9b">第4部分—链接</a>。</p><figure class="kt ku kv kw fq kx"><div class="bz el l di"><div class="mq kz l"/></div></figure></div></div>    
</body>
</html>