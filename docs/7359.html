<html>
<head>
<title>You Don’t Need a Dependency Injection Container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你不需要依赖注入容器</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/you-dont-need-a-dependency-injection-container-10a5d4a5f878?source=collection_archive---------7-----------------------#2017-10-25">https://medium.com/hackernoon/you-dont-need-a-dependency-injection-container-10a5d4a5f878?source=collection_archive---------7-----------------------#2017-10-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="bb91" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当错误地使用DI容器时，也就是说，在大多数情况下，不仅仅是代码污染者，而是绝对的恶魔。</p><h2 id="5fb6" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">这是一种静态依赖</h2><p id="be20" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">DI容器经常被从各个地方调用。在这种情况下，DI容器只是一个<a class="ae jp" href="http://blog.ploeh.dk/2010/02/03/ServiceLocatorisanAnti-Pattern/" rel="noopener ugc nofollow" target="_blank">服务定位器</a>，它是一个单体。拥有大量方法的Singleton。除此之外，它还引入了<a class="ae jp" rel="noopener" href="/@wrong.about/static-classes-are-evil-or-make-your-dependencies-explicit-af3e73bd29dd">隐藏依赖</a>。看起来可能是这样的:</p><pre class="kq kr ks kt fq ku kv kw kx aw ky dt"><span id="5bb6" class="jq jr hu kv b fv kz la l lb lc"><strong class="kv hv">class </strong>PaymentProcessor<br/>{<br/>    <strong class="kv hv">public function </strong>purchase()<br/>    {<br/>        <strong class="kv hv">return </strong>DIPaymentModuleFactory::<em class="ld">me</em>()-&gt;purchase();<br/>    }<br/>}</span></pre><p id="5bcd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要纠正这个错误，唯一的方法是只在应用程序的最高级别使用它，最好是在应用程序启动的索引文件中。如果你这样使用它，你真的还需要它吗？反正你不知道。已经<a class="ae jp" href="https://en.wikipedia.org/wiki/Catch-22" rel="noopener ugc nofollow" target="_blank"> Catch-22 </a>了，前面还有两分。</p><h2 id="806e" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">它打破了最坚实的OOP隐喻之一</h2><p id="1f57" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">DI container打破了大卫·韦斯特在他的书<a class="ae jp" href="https://www.amazon.com/Object-Thinking-Developer-Reference-David/dp/0735619654" rel="noopener ugc nofollow" target="_blank">对象思维</a>中谈到的<a class="ae jp" rel="noopener" href="/@wrong.about/on-good-domain-decomposition-385ee8ce5a3">乐高积木</a>的比喻。我希望我的类在一个地方被实例化，这个地方应该是任何请求或消息的入口点。他们的合作只能通过组合来实现。可组合性是任何有抱负的对象思考者努力追求的目标。</p><h2 id="77f5" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">它破坏了凝聚力</h2><p id="290e" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">此外，它打破了基本的OOP原则——数据封装和公开行为。为什么一个对象应该被实例化的方式对程序代码是隐藏的？为什么放在某个<a class="ae jp" href="https://symfony.com/doc/current/components/dependency_injection.html" rel="noopener ugc nofollow" target="_blank">配置文件</a>里？真的，想想看——简直是胡说八道！这一点更宽泛。为什么我们需要一个配置文件？为什么有些数据会被从其行为中分离出来？这正是马丁·福勒14年前所说的，对吗？每个人似乎都同意这一点。但是为什么我们一直遵循这个概念呢？配置文件只是程序思维的反映！</p><h2 id="7d85" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">没有容器的生活</h2><p id="5da3" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">是一个<a class="ae jp" href="http://blog.ploeh.dk/2014/06/10/pure-di/" rel="noopener ugc nofollow" target="_blank">纯依赖注入</a>。这就是我的入口点通常的样子:</p><pre class="kq kr ks kt fq ku kv kw kx aw ky dt"><span id="a2df" class="jq jr hu kv b fv kz la l lb lc"><strong class="kv hv">try </strong>{<br/>    <strong class="kv hv">echo<br/>        </strong>(<strong class="kv hv">new </strong>PurchaseOrder(<br/>            <strong class="kv hv">new </strong>LocalOrderStorage(<br/>                <strong class="kv hv">new </strong>NullOrderStorage()<br/>            ),<br/>            <strong class="kv hv">new </strong>OrderId($inputParams[<strong class="kv hv">'order_id'</strong>])<br/>        ))<br/>            -&gt;newInvoice(<br/>                <strong class="kv hv">new </strong>InvoiceNumber(<br/>                    <strong class="kv hv">new </strong>Vendor(<br/>                        <strong class="kv hv">new </strong>LocalVendorStorage(),<br/>                        <strong class="kv hv">new </strong>VendorId($inputParams[<strong class="kv hv">'vendor_id'</strong>])<br/>                    ),<br/>                    <strong class="kv hv">new </strong>VendorInvoiceNumber($inputParams[<strong class="kv hv">'vendor_invoice_number'</strong>]),<br/>                    <strong class="kv hv">new </strong>DateTime($inputParams[<strong class="kv hv">'date_time'</strong>])<br/>                ),<br/>                <strong class="kv hv">new </strong>VendorInvoiceNumber($inputParams[<strong class="kv hv">'vendor_invoice_number'</strong>]),<br/>                <strong class="kv hv">new </strong>DateTime($inputParams[<strong class="kv hv">'date_time'</strong>]),<br/>                <strong class="kv hv">new </strong>InvoiceAmount(<br/>                    <strong class="kv hv">new </strong>Amount($inputParams[<strong class="kv hv">'amount'</strong>]),<br/>                    <strong class="kv hv">new </strong>Currency($inputParams[<strong class="kv hv">'currency'</strong>])<br/>                )<br/>            )<br/>                -&gt;json()<br/>    ;<br/>} <strong class="kv hv">catch </strong>(Exxeption $exxeption) {<br/>    <strong class="kv hv">return<br/>        </strong>(<strong class="kv hv">new </strong>ErrorResult())<br/>            -&gt;json($exxeption-&gt;getCode(), $exxeption-&gt;getMessage())<br/>        ;<br/>}</span></pre><p id="9d1f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">太棒了。加入我吧。</p></div></div>    
</body>
</html>