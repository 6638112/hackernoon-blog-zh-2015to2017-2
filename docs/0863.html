<html>
<head>
<title>How to control a fan to cool the CPU of your RaspBerryPi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何控制风扇来冷却你的RaspBerryPi的CPU</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-control-a-fan-to-cool-the-cpu-of-your-raspberrypi-3313b6e7f92c?source=collection_archive---------0-----------------------#2016-06-12">https://medium.com/hackernoon/how-to-control-a-fan-to-cool-the-cpu-of-your-raspberrypi-3313b6e7f92c?source=collection_archive---------0-----------------------#2016-06-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="fc75" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">遵循这个<strong class="it hv">教程</strong>你将能够<strong class="it hv">组装一个风扇</strong>使用晶体管将5V电流引入风扇的马达。然后，您将编写一个Python脚本，让<strong class="it hv">在CPU达到某个温度</strong>时激活风扇。最后，您将能够在启动时自动运行脚本。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff jp"><img src="../Images/f729b84fbb18d654ac022ecb04299217.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*VGxStAWkq9MopL_RXgLy4g.png"/></div></figure><h2 id="2082" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">范围</h2><p id="08cf" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ku je jf jg kv ji jj jk kw jm jn jo hn dt translated">我用最新的RaspBerryPi 3做很多事情。Plex就是其中之一。RPI3在索引我所有的媒体文件时速度非常快，但在代码转换方面却很吃力。mkv文件:它运行良好，但电影经常中断，这不是一个很好的用户体验。幸运的是，Plex有内置的转换器，可以将免费的. mp4转换为浏览器流。为此，在后台，CPU达到380%,温度大大超过80C。所以我想:是时候冷却一下了。</p><h2 id="6021" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">硬件设置</h2><p id="7345" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ku je jf jg kv ji jj jk kw jm jn jo hn dt translated">首先:我已经在亚马逊上买了这个风扇。我见过的所有风扇都是DC 5V，最大200毫安:所以有功功率是1W。然而，pi上的GPIO引脚只能提供3.3V，每个引脚最大16mA:我们不能——也不应该——用引脚的功率给电机供电。休斯顿，我们有一个问题(？).</p><p id="8ec7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们需要的是某种类型的<strong class="it hv">继电器</strong>，它可以通过标准引脚激活，以全速将电流引入我们的风扇。认识一下<strong class="it hv">晶体管</strong>。更具体地，一个<strong class="it hv"> NPN晶体管</strong> (S8050)。最终设置如下(风扇<strong class="it hv">表示为DC电机</strong>，这是<strong class="it hv">而不是</strong>真正的DC电机):</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff ky"><img src="../Images/4117c7fb57b0815068d0f96a85bd0434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kD7Nv0KudnLL-9XKJe8t0w.png"/></div></div><figcaption class="ld le fg fe ff lf lg bd b be z ek">The Breadboard</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/435e2b5bbfb1313f8e6d7941849561fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*l6cEydrQ4nQqauCKuhJi4w.png"/></div><figcaption class="ld le fg fe ff lf lg bd b be z ek">The Schematic</figcaption></figure><blockquote class="li lj lk"><p id="e9e4" class="ir is ll it b iu iv iw ix iy iz ja jb lm jd je jf ln jh ji jj lo jl jm jn jo hn dt translated">永远不要把真正的DC汽车连接到你的板上:你肯定会损坏它。</p></blockquote><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff lp"><img src="../Images/440e9e5603d1125926ef6a646d1a5bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bVRFQIwmn_1fPWEqAKVwjA.jpeg"/></div></div><figcaption class="ld le fg fe ff lf lg bd b be z ek">My finalhacky solution</figcaption></figure><p id="7893" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦一切都设置好了，就是软件部分的时间了。</p><h2 id="d091" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">软件设置</h2><p id="6047" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ku je jf jg kv ji jj jk kw jm jn jo hn dt translated">在自定义位置(我的位置在~/Development/run-fan.py)创建一个名为“run-fan.py”的文件，并复制粘贴以下代码:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="fd6e" class="jx jy hu lr b fv lv lw l lx ly">#!/usr/bin/env python3<br/># Author: Edoardo Paolo Scalafiotti &lt;edoardo849@gmail.com&gt;</span><span id="b09b" class="jx jy hu lr b fv lz lw l lx ly">import os<br/>from time import sleep<br/>import signal<br/>import sys<br/>import RPi.GPIO as GPIO</span><span id="1d64" class="jx jy hu lr b fv lz lw l lx ly">pin = 18 # The pin ID, edit here to change it<br/>maxTMP = 40 # The maximum temperature in Celsius after which we trigger the fan</span><span id="ef85" class="jx jy hu lr b fv lz lw l lx ly">def setup():<br/>    GPIO.setmode(GPIO.BCM)<br/>    GPIO.setup(pin, GPIO.OUT)<br/>    GPIO.setwarnings(False)<br/>    return()</span><span id="1d5d" class="jx jy hu lr b fv lz lw l lx ly">def getCPUtemperature():<br/>    res = os.popen(‘vcgencmd measure_temp’).readline()<br/>    temp =(res.replace(“temp=”,””).replace(“’C\n”,””))<br/>    #print(“temp is {0}”.format(temp)) #Uncomment here for testing<br/>    return temp<br/>def fanON():<br/>    setPin(True)<br/>    return()<br/>def fanOFF():<br/>    setPin(False)<br/>    return()<br/>def getTEMP():<br/>    CPU_temp = float(getCPUtemperature())<br/>    if CPU_temp&gt;maxTMP:<br/>        fanON()<br/>    else:<br/>        fanOFF()<br/>    return()<br/>def setPin(mode): # A little redundant function but useful if you want to add logging<br/>    GPIO.output(pin, mode)<br/>    return()</span><span id="218b" class="jx jy hu lr b fv lz lw l lx ly">try:<br/>    setup() <br/>    while True:<br/>        getTEMP()<br/>    sleep(5) # Read the temperature every 5 sec, increase or decrease this limit if you want<br/>except KeyboardInterrupt: # trap a CTRL+C keyboard interrupt <br/>    GPIO.cleanup() # resets all GPIO ports used by this program</span></pre><p id="3af0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">好了，现在让我们从控制台测试它:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="49d4" class="jx jy hu lr b fv lv lw l lx ly">python run-fan.py</span></pre><p id="c3dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果一切都设置正确，你应该看到你的风扇旋转和停止相应的CPU温度。酷毙了。</p><h2 id="e34f" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jc ki kj kk jg kl km kn jk ko kp kq kr dt translated">还有一件事…</h2><p id="d999" class="pw-post-body-paragraph ir is hu it b iu ks iw ix iy kt ja jb jc ku je jf jg kv ji jj jk kw jm jn jo hn dt translated">显然，我们不想每次重启pi时都手动运行程序，不是吗？我们希望所有东西都在启动时加载，对吗？然后让我们在/etc/init.d中创建一个引导脚本，简称为“fan”:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="be0a" class="jx jy hu lr b fv lv lw l lx ly">nano /etc/init.d/fan</span></pre><p id="bb2d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">…并在其中复制粘贴以下代码:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="a407" class="jx jy hu lr b fv lv lw l lx ly">#!/bin/sh<br/>### BEGIN INIT INFO<br/># Provides: dnscheck<br/># Required-Start: $remote_fs $syslog<br/># Required-Stop: $remote_fs $syslog<br/># Short-Description: Start fan script at boot time<br/># Description: Enable service provided by daemon.<br/>### END INIT INFO</span><span id="6f24" class="jx jy hu lr b fv lz lw l lx ly">python /home/pi/Development/run-fan.py</span></pre><p id="5570" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">…然后通过运行以下命令创建符号链接:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="0f13" class="jx jy hu lr b fv lv lw l lx ly">update-rc.d /etc/init.d/dnscheck defaults</span></pre><p id="9246" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">…下次您重新启动pi时，您的fan脚本将自动运行。</p><div class="jq jr js jt fq ab cb"><figure class="ma ju mb mc md me mf paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="ma ju mb mc md me mf paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="ma ju mb mc md me mf paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="li lj lk"><p id="f922" class="ir is ll it b iu iv iw ix iy iz ja jb lm jd je jf ln jh ji jj lo jl jm jn jo hn dt translated"><a class="ae kx" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae kx" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae kx" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>，并乐意<a class="ae kx" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="ir is ll it b iu iv iw ix iy iz ja jb lm jd je jf ln jh ji jj lo jl jm jn jo hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae kx" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae kx" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="jq jr js jt fq ju fe ff paragraph-image"><a href="https://goo.gl/Ahtev1"><div class="fe ff mg"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></a></figure></div></div>    
</body>
</html>