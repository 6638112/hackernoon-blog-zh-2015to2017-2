<html>
<head>
<title>Build an Instagram feed app with just javascript (using Expo &amp; React Native)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">仅用javascript构建一个Instagram feed应用程序(使用Expo &amp; React Native)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-an-instagram-feed-app-with-just-javascript-using-expo-react-native-97c0e799b5cf?source=collection_archive---------6-----------------------#2017-12-07">https://medium.com/hackernoon/build-an-instagram-feed-app-with-just-javascript-using-expo-react-native-97c0e799b5cf?source=collection_archive---------6-----------------------#2017-12-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="a3a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我想从事移动开发已经有一段时间了，但是每当我开始做一些其他的事情时，我都会遇到同样令人烦恼的问题:</p><ul class=""><li id="3067" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated">我浪费时间做乏味的事情。制作一个hello world应用程序需要大量的样板代码和随机安装</li><li id="fdc4" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated">我的网络知识没有转移。Android和iOS完全不同，两者都和web完全不同。</li></ul><p id="b17e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在浏览了一些互联网后，脸书似乎用React Native(一个基于React.js制作原生应用的库)解决了这个问题，但在尝试后，我发现设置和以前一样乏味。主要问题仍然存在:我需要编写一堆样板Java / C#代码。</p><p id="53f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我已经准备好承认在移动设备上建设，但是我发现了一个叫做Expo的东西。Expo有几个库和工具以一些有意义的方式建立在React Native的成功之上:</p><ul class=""><li id="5801" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated">您可以立即启动并运行，无需下载任何内容</li><li id="9ad0" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated">独立的应用程序可以100%在<a class="ae kd" href="https://hackernoon.com/tagged/javascript" rel="noopener ugc nofollow" target="_blank"> javascript </a>中制作</li><li id="70f6" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated">它与API捆绑在一起，简化了应用程序中的常见任务</li></ul><p id="971e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我最近的创作是一个Instagram feed应用程序，这是我们将要做的。你可以关注<a class="ae kd" href="https://snack.expo.io/" rel="noopener ugc nofollow" target="_blank">世博小吃</a>(一个玩世博的网络界面)。你也可以在github 上查看<a class="ae kd" href="https://github.com/sameesiddiqui/instagram-example" rel="noopener ugc nofollow" target="_blank">源码或者观看我的</a><a class="ae kd" href="https://www.youtube.com/watch?v=aJhJCc8lrC8" rel="noopener ugc nofollow" target="_blank">视频教程。</a>我们开始吧。</p></div><div class="ab cl ke kf hc kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hn ho hp hq hr"><figure class="km kn ko kp fq kq fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff kl"><img src="../Images/f5b2bdf646aa5889a1077bb4dbced0c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bb_6jXj0TNhOxbX6UIb_qg.png"/></div></div><figcaption class="kx ky fg fe ff kz la bd b be z ek">Finished app</figcaption></figure><p id="5ae7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从高层次来看，我们可以看到该应用程序由帖子列表、关于帖子的元数据以及帖子评论组成。我们需要使用Instagram api来获取这些信息，然后以列表格式显示出来。</p><p id="d04c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们设置一个Instagram客户端应用程序，这样我们就可以发出api请求。</p><figure class="km kn ko kp fq kq fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff lb"><img src="../Images/e0072288f31fb759e0d57e7a1331cb3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3gQAi00yuEaaF5rLPIUfA.png"/></div></div></figure><p id="5166" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">填写完创建客户端应用程序的信息后，取消选中复选框以禁用隐式OAuth。为了简化我们的演示应用程序，我们将获得没有任何服务器端代码的访问令牌。</p><p id="c190" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，单击“管理客户端”,并在新创建的客户端上进行管理。点击安全，并在“有效重定向”字段中输入任何url(我输入了http://www.google.com)。</p><p id="4b07" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">快好了。为了获得我们的访问令牌，我们使用Instagram的身份验证api进行api调用。api将把我们重定向到指定的url，但是使用我们的访问令牌作为url参数。以下是您需要粘贴到浏览器中的内容:</p><pre class="km kn ko kp fq lc ld le lf aw lg dt"><span id="1ab0" class="lh li hu ld b fv lj lk l ll lm">https://api.instagram.com/oauth/authorize/?client_id=CLIENT-ID&amp;redirect_uri=REDIRECT-URI&amp;response_type=token&amp;scope=public_content</span></pre><p id="21ba" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其中客户端ID和重定向URI是各自的值。批准应用程序访问您的Instagram帐户后，您应该会被重定向。这是我获取访问令牌的地方(请为您的应用创建一个唯一的令牌)。</p><figure class="km kn ko kp fq kq fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff ln"><img src="../Images/8aaa3fe5e2ec4b8df1a09d73603cd050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_9Ead49Mp51jihB6WFEKWg.png"/></div></div></figure><p id="cff4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">很好。我们终于可以开始编码了。</p><p id="a399" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">以下是任何世博会项目的框架:</p><pre class="km kn ko kp fq lc ld le lf aw lg dt"><span id="c71a" class="lh li hu ld b fv lj lk l ll lm">import React, { Component } from 'react';<br/>import { Text, View, StyleSheet } from 'react-native';</span><span id="e477" class="lh li hu ld b fv lo lk l ll lm">export default class App extends Component {<br/>  render() {<br/>    return (<br/>      &lt;View&gt;<br/>        &lt;Text&gt;Hi&lt;/Text&gt;<br/>      &lt;/View&gt;<br/>    )<br/>  }<br/>}</span><span id="e7d1" class="lh li hu ld b fv lo lk l ll lm">const styles = StyleSheet.create({})</span></pre><p id="3906" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">html风格的标签被称为JSX，是React的一个特性。我们可以用它来定义我们的布局，并将javascript逻辑嵌入其中。</p><p id="3df1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们从<a class="ae kd" href="https://hackernoon.com/tagged/react-native" rel="noopener ugc nofollow" target="_blank"> React Native </a>和Expo再导入一些组件。</p><ul class=""><li id="e01f" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated">FlatList组件将是我们UI的主要构建块，因为它通过调用renderItem函数来呈现列表中的每个项目。</li><li id="c062" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated">AppLoading用于在我们渲染部分应用程序时向用户显示一个加载图标(否则他们会看到一个空白屏幕，一旦加载就会闪烁并显示我们的内容)</li><li id="6897" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated">样式表就像一个css文件，我们可以将样式应用于应用程序视图</li></ul><p id="9b9d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还需要我们的访问令牌和存储每个帖子数据的地方。在React Native中，这是通过称为state的东西来完成的。UI需要访问的任何数据都应该存储在这里。这很方便，因为无论何时状态改变，我们的应用程序都会重新呈现。</p><pre class="km kn ko kp fq lc ld le lf aw lg dt"><span id="0af3" class="lh li hu ld b fv lj lk l ll lm">import React, { Component } from 'react'<br/>import {<br/>  Text,<br/>  View,<br/>  StyleSheet,<br/>  Image,<br/>  Dimensions,<br/>  FlatList,<br/>} from 'react-native'<br/>import { Constants, AppLoading } from 'expo'</span><span id="a727" class="lh li hu ld b fv lo lk l ll lm">access_token = '6626870867.cbba754.83fa37c865314df8be5c52347e3e4987'</span><span id="6faf" class="lh li hu ld b fv lo lk l ll lm">state = {<br/>    loaded: false,<br/>    data: null,<br/>    comments: [],<br/>}</span><span id="38cc" class="lh li hu ld b fv lo lk l ll lm">export default class App extends Component {<br/>  render() {<br/>    return (<br/>      &lt;View style={styles.container}&gt;<br/>        &lt;FlatList<br/>          data={this.state.data}<br/>          renderItem={({ item, index }) =&gt; this.createPost(item, index)}<br/>          keyExtractor={(item) =&gt; item.id}<br/>        /&gt;<br/>      &lt;/View&gt;<br/>    )<br/>  }<br/>}</span><span id="c715" class="lh li hu ld b fv lo lk l ll lm">const styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>    alignItems: 'center',<br/>    paddingTop: Constants.statusBarHeight,<br/>    backgroundColor: '#ecf0f1',<br/>  }<br/>})</span></pre><p id="ff51" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">FlatList的数据属性是一个数组，其中的每一项都作为参数传递给renderItem函数。我们将把我们的Instagram帖子存储在这个数组中。</p><p id="ae44" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，让我们使用我们的access_token来获取我们的post数据。我们使用fetch api向Instagram的api端点发出GET请求。然后，我们将这些值存储在应用程序状态中。</p><pre class="km kn ko kp fq lc ld le lf aw lg dt"><span id="34b7" class="lh li hu ld b fv lj lk l ll lm">async fetchFeed () {<br/>    let response = await fetch(<br/>      '<a class="ae kd" href="https://api.instagram.com/v1/users/'" rel="noopener ugc nofollow" target="_blank">https://api.instagram.com/v1/users/self'</a> + <br/>      '/media/recent/?access_token=' +<br/>      this.access_token<br/>    )<br/>    let posts = await response.json()<br/>    let comments = await this.makeCommentsList(posts.data)</span><span id="72ce" class="lh li hu ld b fv lo lk l ll lm">this.setState({<br/>        data: posts.data,<br/>        comments: comments,<br/>        loaded: true<br/>    })<br/>  }</span></pre><p id="d271" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们有最近的帖子列表，但是对于每个帖子，我们需要获得评论和相关元数据的列表。这意味着我们正在发出一系列网络请求，这些请求可能会以错误的顺序返回。我们的计划是通过返回一组承诺来处理这个问题，这些承诺将在帖子评论被检索到时得到解决。我们还通过在帖子没有评论时不发出请求来节省一些加载时间，只显示一个显示“没有评论”的视图</p><pre class="km kn ko kp fq lc ld le lf aw lg dt"><span id="030b" class="lh li hu ld b fv lj lk l ll lm">async makeCommentsList(posts) {<br/>    let postsArray = posts.map(async (post) =&gt; {<br/>      let postId = post.id</span><span id="84e8" class="lh li hu ld b fv lo lk l ll lm">    if (post.comments.count === 0) {<br/>        return (<br/>          &lt;View style={styles.comment} key={postId}&gt;<br/>            &lt;Text&gt;No Comments!&lt;/Text&gt;<br/>          &lt;/View&gt;<br/>        )<br/>      } else {</span><span id="bfc9" class="lh li hu ld b fv lo lk l ll lm">        let response = await fetch(<br/>          '<a class="ae kd" href="https://api.instagram.com/v1/media/'" rel="noopener ugc nofollow" target="_blank">https://api.instagram.com/v1/media/'</a> +<br/>            postId +<br/>            '/comments?access_token=' +<br/>            this.access_token<br/>        )</span><span id="92fc" class="lh li hu ld b fv lo lk l ll lm">        let comments = await response.json()<br/>        let commentsArray = comments.data<br/>        <br/>        let commentsList = commentsArray.map(commentInfo =&gt; {<br/>          return (<br/>            &lt;View style={styles.comment} key={commentInfo.id}&gt;<br/>              &lt;Text style={styles.commentText}&gt;{commentInfo.from.username}&lt;/Text&gt;<br/>              &lt;Text&gt;{commentInfo.text}&lt;/Text&gt;<br/>            &lt;/View&gt;<br/>          )<br/>        })</span><span id="f255" class="lh li hu ld b fv lo lk l ll lm">        return commentsList<br/>      }</span><span id="674b" class="lh li hu ld b fv lo lk l ll lm">    })</span><span id="2347" class="lh li hu ld b fv lo lk l ll lm">    postsArray = await Promise.all(postsArray)<br/>    return postsArray<br/>  }</span></pre><p id="a017" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们添加了一些样式使评论看起来更好:</p><pre class="km kn ko kp fq lc ld le lf aw lg dt"><span id="d194" class="lh li hu ld b fv lj lk l ll lm">const styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>    alignItems: 'center',<br/>    paddingTop: Constants.statusBarHeight,<br/>    backgroundColor: '#ecf0f1',<br/>  },<br/>  comment: {<br/>    flexDirection: 'row',<br/>    padding: 10,<br/>    paddingLeft: 15,<br/>    borderBottomWidth: 1,<br/>    borderColor: '#d8d8d8',<br/>  },<br/>  commentText: {<br/>    paddingRight: 15,<br/>    fontWeight: 'bold',<br/>  }<br/>})</span></pre><p id="19ad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们已经有了所有的评论和帖子数据，我们需要制作时间线并用我们得到的数据填充它。createPost函数使用这些值来显示文章、元数据和评论。</p><pre class="km kn ko kp fq lc ld le lf aw lg dt"><span id="6620" class="lh li hu ld b fv lj lk l ll lm">createPost(postInfo, index) {<br/>    let imageUri = postInfo.images.standard_resolution.url<br/>    let username = postInfo.user.username<br/>    let numLikes = postInfo.likes.count</span><span id="bb65" class="lh li hu ld b fv lo lk l ll lm">return (<br/>      &lt;View&gt;<br/>        &lt;Image style={styles.image} source={{ uri: imageUri }} /&gt;<br/>        &lt;View style={styles.info}&gt;</span><span id="e6a1" class="lh li hu ld b fv lo lk l ll lm">          &lt;Text style={styles.infoText}&gt;{username}&lt;/Text&gt;<br/>          &lt;Text style={styles.infoText}&gt;<br/>            {numLikes + (numLikes !== 1 ? ' likes' : ' like')}<br/>          &lt;/Text&gt;</span><span id="4314" class="lh li hu ld b fv lo lk l ll lm">        &lt;/View&gt;</span><span id="c7da" class="lh li hu ld b fv lo lk l ll lm">        &lt;View&gt;<br/>          {this.state.comments[index]}<br/>        &lt;/View&gt;<br/>      &lt;/View&gt;<br/>    )<br/>  }</span></pre><p id="3c24" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">imageUri、username和numLikes都是从我们对Instagram api的fetch请求返回的JSON中检索的。返回值的例子可以在Instagram开发者文档中找到。</p><p id="11eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们再一次在样式表中添加了一些样式，使我们的帖子看起来更漂亮。</p><pre class="km kn ko kp fq lc ld le lf aw lg dt"><span id="22ad" class="lh li hu ld b fv lj lk l ll lm">  image: {<br/>    width: Dimensions.get('window').width,<br/>    height: Dimensions.get('window').width,<br/>  },<br/>  info: {<br/>    flexDirection: 'row',<br/>    justifyContent: 'space-between',<br/>    padding: 10,<br/>    paddingLeft: 15,<br/>    paddingRight: 15,<br/>    borderBottomWidth: 1,<br/>    borderColor: '#d8d8d8',<br/>  },<br/>  infoText: {<br/>    fontSize: 16,<br/>    fontWeight: 'bold',<br/>  }</span></pre><p id="6a56" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了添加一些收尾工作，让我们在应用程序启动时获取我们的Instagram信息，并显示一个加载图标以获得最佳用户体验。</p><pre class="km kn ko kp fq lc ld le lf aw lg dt"><span id="c780" class="lh li hu ld b fv lj lk l ll lm">componentDidMount () {<br/>    this.fetchFeed()<br/>}</span><span id="d24a" class="lh li hu ld b fv lo lk l ll lm">render () {<br/>    if (!this.state.loaded) {<br/>      return (<br/>        &lt;AppLoading /&gt;<br/>      )<br/>    }</span><span id="f6e9" class="lh li hu ld b fv lo lk l ll lm">    return (<br/>      &lt;View style={styles.container}&gt;<br/>        &lt;FlatList<br/>          data={this.state.data}<br/>          renderItem={({ item, index }) =&gt; this.createPost(item, index)}<br/>          keyExtractor={(item) =&gt; item.id}<br/>        /&gt;<br/>      &lt;/View&gt;<br/>    )<br/>  }</span></pre><p id="68e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就这样，你完成了！约150行的移动Instagram feed查看器。你可以在这里查看完整的工作点心例子<a class="ae kd" href="https://snack.expo.io/@samee/instagram-example" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="9c22" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于本教程是在没有任何安装的情况下完成的，我们还没有完成制作一个独立的Android或iOS应用程序的过程。幸运的是，你就在几步之外。</p><ol class=""><li id="0976" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo lp jv jw jx dt translated">确保您拥有Apple开发者帐户和Google Play帐户。</li><li id="e64c" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo lp jv jw jx dt translated">下载博览会的工具<a class="ae kd" href="https://docs.expo.io/versions/latest/introduction/installation.html" rel="noopener ugc nofollow" target="_blank"> XDE </a>，点击零食中的“出口到XDE”。</li><li id="c59f" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo lp jv jw jx dt translated">遵循Expo的<a class="ae kd" href="https://docs.expo.io/versions/latest/guides/building-standalone-apps.html" rel="noopener ugc nofollow" target="_blank">独立应用页面</a>上的构建说明(主要是向你的应用添加元数据)</li><li id="91e9" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo lp jv jw jx dt translated">恭喜你！你已经为iOS和Android开发了一个本地应用</li></ol><figure class="km kn ko kp fq kq"><div class="bz el l di"><div class="lq lr l"/></div></figure></div></div>    
</body>
</html>