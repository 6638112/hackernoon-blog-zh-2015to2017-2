<html>
<head>
<title>How to build a SEO-friendly React blog with an API-based CMS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用基于API的CMS构建一个SEO友好的React博客</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/react-js-cms-blog-tutorial-e090c699845b?source=collection_archive---------3-----------------------#2017-03-09">https://medium.com/hackernoon/react-js-cms-blog-tutorial-e090c699845b?source=collection_archive---------3-----------------------#2017-03-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/d1db5ed97f159d969c821042417e2b89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H8j-yzyKCMjqzn2dRNBAVQ.png"/></div></div></figure><p id="dc53" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你有没有想过使用<a class="ae ka" href="https://hackernoon.com/tagged/react" rel="noopener ugc nofollow" target="_blank"> React </a>和Node.js建立一个服务器渲染的、SEO友好的网站？实现这一点的典型解决方案是使用Prerender.io等预呈现服务，或者实现React组件的服务器端呈现。</p><p id="fc00" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一个相对较新的选择是<a class="ae ka" href="https://github.com/zeit/next.js/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>，一个构建通用React webapps的框架。Next.js为服务器端渲染提供了现成的<a class="ae ka" href="https://hackernoon.com/tagged/tools" rel="noopener ugc nofollow" target="_blank">工具</a>，包括为SEO设置HTML标签以及在渲染组件之前获取数据。点击阅读更多关于Next.js <a class="ae ka" href="https://zeit.co/blog/next" rel="noopener ugc nofollow" target="_blank">背后的哲学。</a></p><p id="b504" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本教程中，我们将向您展示如何使用<a class="ae ka" href="https://facebook.github.io/react/" rel="noopener ugc nofollow" target="_blank"> React </a>、<a class="ae ka" href="https://github.com/zeit/next.js/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>和<a class="ae ka" href="https://buttercms.com/" rel="noopener ugc nofollow" target="_blank"> ButterCMS </a>构建一个基于CMS的博客。本教程的最终代码是Github 上的<a class="ae ka" href="https://github.com/buttercms/react-cms-blog-with-next-js" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="13e7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" href="https://buttercms.com/" rel="noopener ugc nofollow" target="_blank"> ButterCMS </a>是一个<a class="ae ka" href="https://buttercms.com/cms" rel="noopener ugc nofollow" target="_blank">基于API的CMS和内容API </a>。你可以认为Butter类似于WordPress，除了你用你选择的语言建立你的网站，然后用API插入动态内容。你可以通过<a class="ae ka" href="https://buttercms.com/github/oauth" rel="noopener ugc nofollow" target="_blank">登录Github </a>亲自尝试<a class="ae ka" href="https://buttercms.com/nodejs-cms/" rel="noopener ugc nofollow" target="_blank"> ButterCMS </a>。</p><h1 id="fe33" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">入门指南</h1><p id="12e1" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">为您的应用程序创建一个新目录，并添加package.json文件:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="d121" class="ln kc hu lj b fv lo lp l lq lr">{<br/>  "name": "react-blog"<br/>}</span></pre><p id="aaf1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">安装Next.js并反应。在撰写本文时，我们希望安装Next.js，以便以后可以设置动态路由:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="33b3" class="ln kc hu lj b fv lo lp l lq lr">npm install next@beta react react-dom --save</span></pre><p id="0f19" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后将一个脚本添加到您的包中。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="0faf" class="ln kc hu lj b fv lo lp l lq lr">{<br/>  "scripts": {<br/>    "start": "next"<br/>  }<br/>}</span></pre><p id="f8ac" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Next.js将<code class="eh ls lt lu lj b">./pages</code>目录中的每个js文件视为一个页面。让我们通过在项目中创建一个<code class="eh ls lt lu lj b">./pages/index.js</code>来设置一个基本的主页:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="1955" class="ln kc hu lj b fv lo lp l lq lr">export default () =&gt; (<br/>  &lt;div&gt;My blog homepage&lt;/div&gt;<br/>)</span></pre><p id="defc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后只需运行<code class="eh ls lt lu lj b">npm run start</code>并前往<code class="eh ls lt lu lj b">http://localhost:3000</code>。</p><p id="2dca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，创建一个<code class="eh ls lt lu lj b">./pages/post.js</code>并确保它在<code class="eh ls lt lu lj b"><a class="ae ka" href="http://localhost:3000/post:" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/post</a></code>加载:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="9201" class="ln kc hu lj b fv lo lp l lq lr">export default () =&gt; (<br/>  &lt;div&gt;A blog post&lt;/div&gt;<br/>)</span></pre><h1 id="5b3c" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">获取博客文章</h1><p id="97b6" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">接下来我们将集成<a class="ae ka" href="https://buttercms.com/react-cms/" rel="noopener ugc nofollow" target="_blank"> ButterCMS </a>，这样我们就可以动态地获取和呈现博客文章。</p><p id="a1ce" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先安装ButterCMS Node.js API客户端并重启服务器:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="1a04" class="ln kc hu lj b fv lo lp l lq lr">npm install buttercms --save</span></pre><p id="b994" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将更新<code class="eh ls lt lu lj b">index.js</code>成为一个React组件，使用ButterCMS SDK获取并显示帖子:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="e71e" class="ln kc hu lj b fv lo lp l lq lr">import React from 'react'<br/>import Link from 'next/link'<br/>import Butter from 'buttercms'<br/><br/>const butter = Butter('de55d3f93789d4c5c26fb07445b680e8bca843bd')<br/><br/>export default class extends React.Component {<br/>  static async getInitialProps({ query }) {<br/>    let page = query.page || 1;<br/><br/>    const resp = await butter.post.list({page: page, page_size: 10})    <br/>    return resp.data;<br/>  }<br/>  render() {<br/>    const { next_page, previous_page } = this.props.meta;<br/><br/>    return (<br/>      &lt;div&gt;<br/>        {this.props.data.map((post) =&gt; {<br/>          return (<br/>            &lt;div&gt;<br/>              &lt;a href={`/post/${post.slug}`}&gt;{post.title}&lt;/a&gt;<br/>            &lt;/div&gt;<br/>          )<br/>        })}<br/><br/>        &lt;br /&gt;<br/><br/>        &lt;div&gt;<br/>          {previous_page &amp;&amp; &lt;Link href={`/?page=${previous_page}`}&gt;&lt;a&gt;Prev&lt;/a&gt;&lt;/Link&gt;}<br/><br/>          {next_page &amp;&amp; &lt;Link href={`/?page=${next_page}`}&gt;&lt;a&gt;Next&lt;/a&gt;&lt;/Link&gt;}<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="8681" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用Next.js <code class="eh ls lt lu lj b">getInitialProps</code>将在初始页面加载时在服务器上执行，然后在使用内置的<code class="eh ls lt lu lj b">&lt;Link&gt;</code>组件导航到不同的路径时在客户端上执行。<code class="eh ls lt lu lj b">getInitialProps</code>也接收具有各种属性的上下文对象——我们访问<code class="eh ls lt lu lj b">query</code>属性来处理分页。我们正在从ButterCMS测试帐户获取帖子——使用Github登录来设置您自己的帖子。</p><p id="f6e0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在我们的<code class="eh ls lt lu lj b">render()</code>方法中，我们使用了一些巧妙的语法，仅在适用时才显示分页链接。我们的帖子链接会将我们带到404-我们接下来会让这些工作。</p><h1 id="e289" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">显示帖子</h1><p id="96ca" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">为了让我们的文章链接工作，我们需要为我们的博客文章设置动态路由。创建一个定制服务器<code class="eh ls lt lu lj b">./server.js</code>，将所有<code class="eh ls lt lu lj b">/post/:slug</code>URL路由到我们的post组件:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="8a92" class="ln kc hu lj b fv lo lp l lq lr">const { createServer } = require('http')<br/>const { parse } = require('url')<br/>const next = require('next')<br/><br/>const dev = process.env.NODE_ENV !== 'production'<br/>const app = next({ dev })<br/>const handle = app.getRequestHandler()<br/><br/>app.prepare().then(() =&gt; {<br/>  createServer((req, res) =&gt; {<br/>    // Be sure to pass `true` as the second argument to `url.parse`.<br/>    // This tells it to parse the query portion of the URL.<br/>    const parsedUrl = parse(req.url, true)<br/>    const { pathname, query } = parsedUrl<br/><br/>    if (pathname.includes('/post/')) {<br/>      const splitPath = pathname.split("/");<br/><br/>      // Add post slug to query object<br/>      query.slug = splitPath[2];<br/><br/>      app.render(req, res, '/post', query)<br/>    } else {<br/>      handle(req, res, parsedUrl)<br/>    }<br/>  })<br/>  .listen(3000, (err) =&gt; {<br/>    if (err) throw err<br/>    console.log('&gt; Ready on http://localhost:3000')<br/>  })<br/>})</span></pre><p id="c08c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们还将更新我们的post组件，通过slug获取博客文章，并呈现标题和正文:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="2c33" class="ln kc hu lj b fv lo lp l lq lr">import React from 'react'<br/>import Butter from 'buttercms'<br/><br/>const butter = Butter('de55d3f93789d4c5c26fb07445b680e8bca843bd')<br/><br/>export default class extends React.Component {<br/>  static async getInitialProps({ query }) {<br/>    const resp = await butter.post.retrieve(query.slug);  <br/>    return resp.data;<br/>  }<br/>  render() {<br/>    const post = this.props.data;<br/><br/>    return (<br/>      &lt;div&gt;<br/>        &lt;h1&gt;{post.title}&lt;/h1&gt;<br/>        &lt;div dangerouslySetInnerHTML={{__html: post.body}} /&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="4cb3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后，更新我们的<code class="eh ls lt lu lj b">package.json</code>启动脚本以使用我们的客户服务器并重启:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="08dc" class="ln kc hu lj b fv lo lp l lq lr">"scripts": {<br/>  "start": "node server.js"<br/>}</span></pre><h1 id="93ad" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">搜索引擎优化</h1><p id="e707" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">Next.js提供了一个用于设置HTML标题和meta标签的<code class="eh ls lt lu lj b">&lt;Head&gt;</code>组件。将<code class="eh ls lt lu lj b">import Head from 'next/head'</code>添加到<code class="eh ls lt lu lj b">./pages/post.js</code>的顶部，并使用<code class="eh ls lt lu lj b">render()</code>方法中的组件:</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="3689" class="ln kc hu lj b fv lo lp l lq lr">render() {<br/>  const post = this.props.data;<br/><br/>  return (<br/>    &lt;div&gt;<br/>      &lt;Head&gt;<br/>        &lt;title&gt;{post.seo_title}&lt;/title&gt;<br/>        &lt;meta name="description" content={post.meta_description} /&gt;<br/>        &lt;meta name="og:image" content={post.featured_image} /&gt;<br/>      &lt;/Head&gt;<br/><br/>      &lt;h1&gt;{post.title}&lt;/h1&gt;<br/>      &lt;div dangerouslySetInnerHTML={{__html: post.body}} /&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><p id="1267" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">重启服务器，检查一篇文章的HTML源代码，验证标签设置是否正确。</p><h1 id="0537" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">包裹</h1><p id="2433" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">Next.js是一个强大的框架，可以轻松构建通用的React应用程序。有了ButterCMS，你可以用React快速构建基于CMS的博客和网站。</p><p id="9fdf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一定要看看<a class="ae ka" href="https://buttercms.com/" rel="noopener ugc nofollow" target="_blank"> ButterCMS </a>，这是一个<a class="ae ka" href="https://buttercms.com/cms/" rel="noopener ugc nofollow" target="_blank">托管的基于API的CMS和内容API </a>以及博客引擎，让你使用任何编程语言构建CMS驱动的应用，包括<a class="ae ka" href="https://buttercms.com/ruby-cms" rel="noopener ugc nofollow" target="_blank"> Ruby </a>、<a class="ae ka" href="https://buttercms.com/rails-cms" rel="noopener ugc nofollow" target="_blank"> Rails </a>、<a class="ae ka" href="https://buttercms.com/nodejs-cms" rel="noopener ugc nofollow" target="_blank"> Node.js </a>、<a class="ae ka" href="https://buttercms.com/asp-net-cms" rel="noopener ugc nofollow" target="_blank">。网</a>、<a class="ae ka" href="https://buttercms.com/python-cms" rel="noopener ugc nofollow" target="_blank">蟒蛇</a>、<a class="ae ka" href="https://buttercms.com/phoenix-cms" rel="noopener ugc nofollow" target="_blank">凤凰</a>、<a class="ae ka" href="https://buttercms.com/django-cms" rel="noopener ugc nofollow" target="_blank">姜戈</a>、<a class="ae ka" href="https://buttercms.com/react-cms" rel="noopener ugc nofollow" target="_blank">反应</a>、<a class="ae ka" href="https://buttercms.com/angular-cms" rel="noopener ugc nofollow" target="_blank">角</a>、<a class="ae ka" href="https://buttercms.com/golang-cms" rel="noopener ugc nofollow" target="_blank">围棋</a>、<a class="ae ka" href="https://buttercms.com/php-cms" rel="noopener ugc nofollow" target="_blank"> PHP </a>、<a class="ae ka" href="https://buttercms.com/laravel-cms" rel="noopener ugc nofollow" target="_blank">拉拉夫</a>、<a class="ae ka" href="https://buttercms.com/elixir-cms" rel="noopener ugc nofollow" target="_blank">仙丹</a>、<a class="ae ka" href="https://buttercms.com/meteor-cms" rel="noopener ugc nofollow" target="_blank">流星</a>。</p><p id="17bb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们希望你喜欢这个教程。如果你有任何关于设置你的ButterCMS驱动的Next.js/React应用的问题，请通过roger@buttercms.com<a class="ae ka" href="mailto:roger@buttercms.com" rel="noopener ugc nofollow" target="_blank">或Twitter </a>上的<a class="ae ka" href="https://twitter.com/buttercms" rel="noopener ugc nofollow" target="_blank">联系我。</a></p><div class="le lf lg lh fq ab cb"><figure class="lv iv lw lx ly lz ma paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lv iv lw lx ly lz ma paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lv iv lw lx ly lz ma paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="mb mc md"><p id="f922" class="jc jd me je b jf jg jh ji jj jk jl jm mf jo jp jq mg js jt ju mh jw jx jy jz hn dt translated"><a class="ae ka" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ka" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ka" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae ka" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jc jd me je b jf jg jh ji jj jk jl jm mf jo jp jq mg js jt ju mh jw jx jy jz hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ka" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ka" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="le lf lg lh fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mi"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="le lf lg lh fq iv"><div class="bz el l di"><div class="mj mk l"/></div></figure></div></div>    
</body>
</html>