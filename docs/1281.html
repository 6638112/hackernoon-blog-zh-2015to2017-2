<html>
<head>
<title>Processing Real Time Big Data Streams Using Kinesis &amp; Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用motis &amp; Lambda处理实时大数据流</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/processing-real-time-big-data-streams-using-kinesis-lambda-561a029ef305?source=collection_archive---------0-----------------------#2016-10-05">https://medium.com/hackernoon/processing-real-time-big-data-streams-using-kinesis-lambda-561a029ef305?source=collection_archive---------0-----------------------#2016-10-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="3279" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">放弃</h2></div><p id="7c86" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">此内容是我们某个在线课程/培训的一部分或受其启发。在2019年<strong class="jl hv">黑色星期五</strong>期间，我们对这些材料提供高达80%的折扣。</p><p id="fbee" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以在这里享受<a class="ae kf" href="http://bf.eralabs.io/" rel="noopener ugc nofollow" target="_blank">折扣。</a></p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff kg"><img src="../Images/1345d16bd1f2c8c580f171d820e90b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gMn-3DQVJe6WiPB_.png"/></div></div></figure></div><div class="ab cl ks kt hc ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hn ho hp hq hr"><p id="e307" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我正在创建一个AWS在线课程，我的目标是让人们有机会通过高质量的课程和实用的学习途径来学习DevOps技术。</p><blockquote class="kz"><p id="3f43" class="la lb hu bd lc ld le lf lg lh li ke ek translated">如果您对<a class="ae kf" href="https://practicalaws.com" rel="noopener ugc nofollow" target="_blank">实用AWS培训</a>感兴趣，您可以<a class="ae kf" href="http://practicalaws.com" rel="noopener ugc nofollow" target="_blank">现在就预订</a>以半价获得培训。</p><p id="553e" class="la lb hu bd lc ld le lf lg lh li ke ek translated">您也可以下载我们的迷你电子书<a class="ae kf" href="https://app.getresponse.com/site2/practical_aws?u=hWKcs&amp;webforms_id=BSioY" rel="noopener ugc nofollow" target="_blank"> 8学习AWS的好技巧</a>。</p></blockquote><p id="1f24" class="pw-post-body-paragraph jj jk hu jl b jm lj iv jo jp lk iy jr js ll ju jv jw lm jy jz ka ln kc kd ke hn dt translated">这是上一篇文章<a class="ae kf" rel="noopener" href="/@eon01/creating-a-realtime-analytics-event-processing-system-for-big-data-using-amazon-kinesis-756f5e5d1abf">的第2部分，文章名为【使用亚马逊驱动程序创建大数据实时分析&amp;事件处理系统</a>。</p><p id="37bc" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">完成本教程后，您将能够向您的AWS基础架构发送大量数据，同时在每次检测到事件时实时发送Hipchat通知。</p><p id="8e43" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们将使用:亚马逊驱动，蟒蛇和亚马逊λ</p><p id="3879" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最后一个教程面向工程师、开发人员和架构师，他们希望为从多个来源收集的大量数据构建实时分析和事件处理系统:物联网、服务器日志、路由器、分布式处理系统..等等</p><p id="9fa3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这一个更加关注事件处理部分，尽管这两个教程是逻辑链接的。我建议你至少快速阅读一下上一篇<a class="ae kf" rel="noopener" href="/@eon01/creating-a-realtime-analytics-event-processing-system-for-big-data-using-amazon-kinesis-756f5e5d1abf">。</a></p><p id="d954" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这篇文章中，我们将看到如何尽可能快地处理和响应实时事件。有多种使用情况，但让我们想象成千上万的物联网设备发送日志，在某些情况下，如果检查到一个条件，就应该触发一个操作。</p><p id="e6f9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">简而言之，数据将通过驱动程序，将由AWS Lambda检查，后者可能会触发其他Lambda功能。</p><h2 id="1ef0" class="lo lp hu bd lq lr ls lt lu lv lw lx ly js lz ma mb jw mc md me ka mf mg mh mi dt translated">什么是运动？</h2><p id="1866" class="pw-post-body-paragraph jj jk hu jl b jm mj iv jo jp mk iy jr js ml ju jv jw mm jy jz ka mn kc kd ke hn dt translated">如果您已经习惯了阿帕奇卡夫卡，那么驱动程序是基于云的卡夫卡的托管替代品。</p><p id="8919" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">换句话说，驱动系统是一个用于构建实时数据管道和流式应用程序，并将相同数据存储到AWS红移或S3的系统。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff mo"><img src="../Images/d474389753dbb6622639f4e416812119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RwofQabw8M489cKkzhYgMw.png"/></div></div></figure><h2 id="fbe7" class="lo lp hu bd lq lr ls lt lu lv lw lx ly js lz ma mb jw mc md me ka mf mg mh mi dt translated">什么是λ？</h2><p id="c043" class="pw-post-body-paragraph jj jk hu jl b jm mj iv jo jp mk iy jr js ml ju jv jw mm jy jz ka mn kc kd ke hn dt translated">AWS Lambda是一个计算服务器，它允许开发人员和工程师创建一个无服务器架构来执行上传的代码。</p><p id="11e6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">AWS Lambda可用作:</p><ul class=""><li id="992e" class="mp mq hu jl b jm jn jp jq js mr jw ms ka mt ke mu mv mw mx dt translated">作为通过运行代码来响应HTTP请求的计算服务。HTTP请求使用Amazon API Gateway或AWS APIs。</li><li id="e177" class="mp mq hu jl b jm my jp mz js na jw nb ka nc ke mu mv mw mx dt translated">作为一个事件驱动的服务，其中AWS Lambda运行您的代码以响应其他AWS服务中的事件，如S3桶或文件、Kinesis流或DynamoDB表..等等</li></ul><p id="a4dd" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在我们的教程中，第二个场景用于Kinesis流。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff nd"><img src="../Images/84fdc0ebe31023bfa6ec70ca865db6f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*Q8CECE6GAoVf0BelovB30g.png"/></div></figure><h2 id="933d" class="lo lp hu bd lq lr ls lt lu lv lw lx ly js lz ma mb jw mc md me ka mf mg mh mi dt translated">从Kinesis到λ</h2><p id="d319" class="pw-post-body-paragraph jj jk hu jl b jm mj iv jo jp mk iy jr js ml ju jv jw mm jy jz ka mn kc kd ke hn dt translated">在这一步，我们应该有一个设置Kinesis流。</p><p id="e325" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Kinesis流将收集和流式传输数据，以便进行有序、可回放的实时处理。去你的控制台，只需创建一个流。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff ne"><img src="../Images/6636a21fc428eb4c58e2a7abbcf10652.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QUt5Lvng5KSgb2dKMOs46w.jpeg"/></div></div></figure><p id="2da3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是<em class="nf"> describe_stream() </em>函数输出的一个例子(在上一个教程中已经看到了):</p><pre class="kh ki kj kk fq ng nh ni nj aw nk dt"><span id="4bd8" class="lo lp hu nh b fv nl nm l nn no">{  <br/>   'StreamDescription':{  <br/>      'StreamARN':'arn:aws:kinesis:eu-west-1:95312312312:stream/TestStream',<br/>      'EnhancedMonitoring':[  <br/>         {  <br/>            'ShardLevelMetrics':[</span><span id="f254" class="lo lp hu nh b fv np nm l nn no">]<br/>         }<br/>      ],<br/>      'StreamStatus':'ACTIVE',<br/>      'RetentionPeriodHours':24,<br/>      'HasMoreShards':False,<br/>      'StreamName':'TestStream',<br/>      'Shards':[  <br/>         {  <br/>            'SequenceNumberRange':{  <br/>               'StartingSequenceNumber':'495662365138256951538110533149564956654'<br/>            },<br/>            'HashKeyRange':{  <br/>               'EndingHashKey':'4956312312314956123124956124956',<br/>               'StartingHashKey':'0'<br/>            },<br/>            'ShardId':'shardId-000000000000'<br/>         }<br/>      ]<br/>   }<br/>}</span></pre><p id="ad68" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后转到Lambda仪表板，跳过这一步:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff nq"><img src="../Images/8f1d34a2edd7400d753fceb00ef8f000.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gMLMDoaEK_ugXtG3ogIpPA.jpeg"/></div></div></figure><p id="99f5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">选择Kinesis作为上游服务，启用触发器，不要忘记启用弹出窗口来添加权限。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff nr"><img src="../Images/3271c7af741dc50555ba2ec9773aee63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bQx7zzrdW3x671y59m2N_w.jpeg"/></div></div></figure><p id="4cc8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，您应该单击Next，在下一个屏幕中设置您的代码。</p><p id="2bae" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以选择其他选项，如允许的内存、超时或VPC..等等</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff ns"><img src="../Images/12e4fb1b04576ad071eb7515ca5e34e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LbzrF8KzEqGcv4G3kYghnQ.jpeg"/></div></div></figure><p id="31b8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我现在要执行producer函数(一个python脚本，它将连接到一个API，获取数据(在本例中是一个用户列表)并将其发送给Kinesis):</p><pre class="kh ki kj kk fq ng nh ni nj aw nk dt"><span id="66b1" class="lo lp hu nh b fv nl nm l nn no">from api.users import Users<br/>import json<br/>from boto import kinesis</span><span id="5891" class="lo lp hu nh b fv np nm l nn no">stream_name = "TestStream"<br/>u = get_users()<br/>x = u.list()</span><span id="22d6" class="lo lp hu nh b fv np nm l nn no">for line in x.iter_lines():<br/>        kinesis = kinesis.connect_to_region("eu-west-1")<br/>        kinesis.put_record(stream_name, line, "partitionkey")<br/>        if line:<br/>            print (line)</span></pre><p id="0bf9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">出于测试目的，我一直在终端上执行这个脚本，同时查看Lambda的监控仪表板，结果是:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff nt"><img src="../Images/e3331c08fe32b10f454fe50c47eac84a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GDyaGtUc7iD1eBrOfxwikA.jpeg"/></div></div></figure><p id="9350" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您看到调用计数增加，那么您就在正确的道路上。这很正常，因为每个传输流都会触发代码执行。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff nu"><img src="../Images/1eda6795a98b857dc55c24217e5c6430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5KvV6LiMeB2vV656tbc4iQ.jpeg"/></div></div></figure><h2 id="9de4" class="lo lp hu bd lq lr ls lt lu lv lw lx ly js lz ma mb jw mc md me ka mf mg mh mi dt translated">一个简单的基于Lambda的微服务</h2><p id="9c35" class="pw-post-body-paragraph jj jk hu jl b jm mj iv jo jp mk iy jr js ml ju jv jw mm jy jz ka mn kc kd ke hn dt translated">现在一切都设置好了，我们要上传一个Python应用程序，每次我们有一个Kinesis流时都会执行这个应用程序。</p><p id="6347" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这个例子中，我将通知一个Hipchat聊天室，我将使用我开发的工具:<a class="ae kf" href="https://github.com/eon01/Hippy" rel="noopener ugc nofollow" target="_blank">Hippy——hip chat Api v2</a>的Python包装器。</p><p id="06c3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">从Github下载代码到你的app目录，在同一个文件夹中安装依赖项，并重命名example.py yo lambda_function.py</p><pre class="kh ki kj kk fq ng nh ni nj aw nk dt"><span id="3e77" class="lo lp hu nh b fv nl nm l nn no">mkdir app<br/>pip install -r requirements.txt -t app/<br/>cd app<br/>mv example.py lambda_function.py<br/></span></pre><p id="4ec5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是example.py的原代码(重命名为lambda_function.py):</p><pre class="kh ki kj kk fq ng nh ni nj aw nk dt"><span id="2291" class="lo lp hu nh b fv nl nm l nn no">from api.notify import Notify </span><span id="332d" class="lo lp hu nh b fv np nm l nn no">key = ""</span><span id="2a2d" class="lo lp hu nh b fv np nm l nn no">room_id = ""</span><span id="bbd6" class="lo lp hu nh b fv np nm l nn no">n = Notify(key, room_id)</span><span id="87a8" class="lo lp hu nh b fv np nm l nn no">n.notify( "Testing Hippy", "red", "false", "text")</span></pre><p id="b92f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这不足以让我们的应用程序使用Lambda，代码应该是这样的</p><pre class="kh ki kj kk fq ng nh ni nj aw nk dt"><span id="ea4b" class="lo lp hu nh b fv nl nm l nn no">def lambda_handler(event, context):<br/>    from api.notify import Notify<br/>    key = ""<br/>    room_id = ""<br/>    n = Notify(key, room_id)<br/>    n.notify( "Testing Hippy From AWS Lambda", "red", "false", "text")</span></pre><p id="e918" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们在同一个文件夹中安装了依赖项，我们更改了example.py的名称和它的结构，现在所有的东西都应该放到一个zip存档中:</p><pre class="kh ki kj kk fq ng nh ni nj aw nk dt"><span id="7a68" class="lo lp hu nh b fv nl nm l nn no">zip -r lambda.zip .</span></pre><p id="76ad" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">转到Lambda dashboard，选择上传zip，然后上传lambda.zip:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="fe ff nv"><img src="../Images/5b1d0a7d3ef30db4793b16ac96e5c56f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nZysl5zDRnaKa3hQIVyK-A.png"/></div></div></figure><p id="2c48" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，在每一个流检测，一条消息将被发送到您的Hipchat房间。</p><p id="6e6e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以使用云观察调试您的应用程序，并查看其日志。</p><p id="ea71" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这就是所有的乡亲:-)</p><h1 id="c64b" class="nw lp hu bd lq nx ny nz lu oa ob oc ly ja od jb mb jd oe je me jg of jh mh og dt translated">连接更深</h1><p id="5da7" class="pw-post-body-paragraph jj jk hu jl b jm mj iv jo jp mk iy jr js ml ju jv jw mm jy jz ka mn kc kd ke hn dt translated">如果你对这篇文章有共鸣，请订阅<a class="ae kf" href="http://devopslinks.com" rel="noopener ugc nofollow" target="_blank"> DevOpsLinks </a>:一个由来自世界各地的热情的DevOps、系统管理员&amp;开发人员组成的在线社区。</p><p id="5d3d" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以在<a class="ae kf" href="https://twitter.com/eon01" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae kf" href="https://clarity.fm/aymenelamri/" rel="noopener ugc nofollow" target="_blank"> Clarity </a>或者我的<a class="ae kf" href="http://eon01.com/blog" rel="noopener ugc nofollow" target="_blank">博客</a>上找到我，你也可以查看我的书:<a class="ae kf" href="http://saltstackfordevops.com" rel="noopener ugc nofollow" target="_blank"> SaltStack For DevOps </a>、<a class="ae kf" href="http://thejumpstartup.com" rel="noopener ugc nofollow" target="_blank"> The Jumpstart Up </a> &amp; <a class="ae kf" href="http://painlessdocker.com" rel="noopener ugc nofollow" target="_blank">无痛Docker </a>。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="ab fr cl oh"><img src="../Images/9be788c6c2620a6f8af98543b867b658.png" data-original-src="https://miro.medium.com/v2/1*koUfnfQ-YkmwubsUs4zwwQ.gif"/></div></figure><p id="c0a6" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你喜欢这篇文章，请推荐并分享给你的追随者。</p></div></div>    
</body>
</html>