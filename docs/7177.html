<html>
<head>
<title>Learning to Rank for Flight Itinerary Search</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习为航班路线搜索排序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/learning-to-rank-for-flight-itinerary-search-8594761eb867?source=collection_archive---------9-----------------------#2017-10-19">https://medium.com/hackernoon/learning-to-rank-for-flight-itinerary-search-8594761eb867?source=collection_archive---------9-----------------------#2017-10-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0098" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">由</em> <a class="jq jr gr" href="https://medium.com/u/9766caca50be?source=post_page-----8594761eb867--------------------------------" rel="noopener" target="_blank"> <em class="jp">尼尔·莱西亚、</em> </a> <em class="jp">高级数据科学家，伦敦。</em></p><figure class="jt ju jv jw fq jx fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff js"><img src="../Images/63a098a57d3a92b344836e72c4dd812f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lBddPoEGtBqKcx68_PCErQ.png"/></div></div><figcaption class="ke kf fg fe ff kg kh bd b be z ek">Learning to Rank for Flight Itinerary Search</figcaption></figure><p id="73e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">搜索最佳航班是<a class="ae ki" href="https://www.skyscanner.net/mobile.html" rel="noopener ugc nofollow" target="_blank"> Skyscanner app </a>用户的核心活动之一。同样，思考如何帮助我们的用户预订理想的旅行是我们发现自己讨论最多的问题之一。最近，在关于旅游推荐者的<a class="ae ki" href="http://www.ec.tuwien.ac.at/rectour2017/keynote/" rel="noopener ugc nofollow" target="_blank">研讨会</a>(ACM rec sys 2017的一部分)上，我有机会做了一个主题演讲，分享了我们最近在该领域的一些实验，特别是关于我们如何在这个问题上应用机器学习。在这篇文章中，我将详述我在那里分享的一些想法。</p><h2 id="5023" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">复杂的搜索问题</h2><p id="3cbe" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">我们中的许多人都经历过寻找理想航班的痛苦——有许多不同的因素在起作用。这太贵了吗？我们能在这个时间到达机场吗？我们应该在某个地方中途停留以节省一些钱，还是为直飞航班多付一点钱？是不是应该早一天走，晚一天回来？取决于你从哪里飞来，试图飞到哪里，可能性似乎是无穷无尽的。</p><p id="59b2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在最近的一篇文章中，Zsombor描述了<a class="ae ki" href="http://skyscanner.net?utm_medium=blog&amp;utm_source=engmediumblogpost&amp;utm_campaign=learning_to_rank_itin_flight_search" rel="noopener ugc nofollow" target="_blank"> Skyscanner </a>应用程序的航班搜索结果页面<a class="ae ki" rel="noopener" href="/@SkyscannerEng/from-itineraries-to-widgets-9b89ca72fda4">是如何随着时间的推移而演变的</a>——它现在正从一个价格排序航班的无限列表，转向一套工具(或<em class="jp">小部件</em>，帮助用户导航这一选择的复杂性。虽然我们可以设想许多想法和改进，这些想法和改进将使信息和控制浮出水面，但我们提出的问题之一是:我们能否通过立即浮出水面的“最佳”航班来帮助用户？</p><h2 id="c834" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">学习排名</h2><p id="6646" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">在研究文献中，使用“最佳”或“相关”的概念对“项目”(在这种情况下是航班行程)进行排序被称为<a class="ae ki" href="https://en.wikipedia.org/wiki/Learning_to_rank" rel="noopener ugc nofollow" target="_blank">学习排序</a>。在这个问题空间中应用各种形式的机器学习已经得到了广泛的研究，并且在各种产品中越来越常见(例如，Slack的<a class="ae ki" href="https://slack.engineering/search-at-slack-431f8c80619e" rel="noopener ugc nofollow" target="_blank">搜索</a>，Foursquare的<a class="ae ki" href="https://engineering.foursquare.com/switching-to-a-probabilistic-model-for-venue-search-in-foursquare-d7535445c09c" rel="noopener ugc nofollow" target="_blank">场地搜索</a>，以及对Twitter的Feed进行排名的<a class="ae ki" href="https://blog.twitter.com/engineering/en_us/topics/insights/2017/using-deep-learning-at-scale-in-twitters-timelines.html" rel="noopener ugc nofollow" target="_blank"/>)。</p><p id="8c11" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">基本前提是，如果我们有关于用户认为与他们的查询相关的<em class="jp">项目的数据— </em>正面示例—以及用户认为与他们的查询不相关的<em class="jp">项目— </em>负面示例—那么我们可以使用这些来训练一个机器学习模型，该模型可以<em class="jp">预测用户找到与他们的查询相关的航班</em>的概率。在这样做的时候，我们已经将项目排序的问题转化为一个二元回归问题<em class="jp">(注意:</em>还有其他方法，比如<a class="ae ki" href="https://en.wikipedia.org/wiki/Learning_to_rank#Pairwise_approach" rel="noopener ugc nofollow" target="_blank">成对排序的方法</a>，我在这里不做介绍)。</p><p id="c07b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在任何背景下定义相关性都是棘手的。许多系统依赖于通过查看用户点击了哪些项目来进行隐性测量。然而，在Skyscanner应用程序中，点击搜索结果并不是一个非常强烈的信号，表明用户已经找到了他们想要的东西——你可能只是点击旅程以了解更多信息。相关性的一个更强的信号是点击进入航空公司/旅行社网站购买它的承诺，这需要用户的多个动作。</p><figure class="jt ju jv jw fq jx fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff lj"><img src="../Images/6b432837d031811021acff1398e625c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0PUwKY2H4mq2nCsUrjYKg.png"/></div></div><figcaption class="ke kf fg fe ff kg kh bd b be z ek">Relevance in flight search: an search result is relevant if you bought it.</figcaption></figure><p id="1145" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从用机器学习对航班搜索结果进行排序的想法到实验，经历了几个阶段。我们通过两种工作流程来解决这些问题——离线和在线实验。</p><h2 id="be60" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">这行得通吗？离线实验</h2><p id="1da4" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">我们首先改进了收集每个用户搜索体验数据的方式；然后，这些数据通过一个管道进行连接、转换和整形，成为一组<em class="jp">特征</em>和一个<em class="jp">二元相关性分数</em>。</p><p id="7fa6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有了这样的历史数据，我们就可以提出<em class="jp">假设</em>之类的问题。如果我们以不同的方式对航班进行排序，你选择的航班会出现在搜索结果列表的顶部吗？</p><p id="72fd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">形式上，这意味着进行大量的离线评估。我们开发了一个工具包来支持这项工作——很像<a class="ae ki" href="http://rival.recommenders.net/" rel="noopener ugc nofollow" target="_blank">类似的开源工具</a>，这个工具包负责进行机器学习实验的基础:将数据分成训练/测试，并在每次测试期间收集各种指标(例如，<a class="ae ki" href="https://en.wikipedia.org/wiki/Information_retrieval#Mean_average_precision" rel="noopener ugc nofollow" target="_blank">平均精度</a>和<a class="ae ki" href="https://en.wikipedia.org/wiki/Mean_reciprocal_rank" rel="noopener ugc nofollow" target="_blank">平均倒数排名</a>)。我们开发了自己的工具，以便我们可以将任何机器学习方法与一个简单的基线进行比较:价格排序。</p><p id="64d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不出所料，我们最初的许多实验都没有成功。我们的基线被证明难以置信地难以超越——也许是因为我们所有的数据都来源于查看这样排名的搜索结果的用户。我们在这里不断迭代，直到我们发现一组似乎比价格排序做得更好的功能，使用一个非常简单的模型开始:<a class="ae ki" href="https://en.wikipedia.org/wiki/Logistic_regression" rel="noopener ugc nofollow" target="_blank">逻辑回归</a>。</p><h2 id="89b2" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">行得通吗？在线实验</h2><p id="9a6c" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">离线机器学习实验的一个公开挑战是理解<a class="ae ki" href="https://www.slideshare.net/xamat/10-lessons-learned-from-building-machine-learning-systems" rel="noopener ugc nofollow" target="_blank">离线指标如何与在线性能</a>相关联。换句话说，仅仅因为一个算法在历史数据上看起来比基线<em class="jp">做得更好，并不意味着它会为用户做得更好。为了验证这一点，我们求助于一个在线实验。</em></p><p id="4dd2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为此，我们制造了运行生产实验所需的所有剩余部件。在Skyscanner，这意味着构建与我们的数据平台和微服务交互的组件。</p><p id="510e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在A/B测试中评估这种方法的一种方法是用一个新的相关性排序列表完全替换价格排序列表。虽然这种方法正在积极探索中，但我们最初测试的UI是一个小部件，它在价格排序列表的上方推荐航班。</p><p id="dedd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，我们进行了一项实验，比较了使用机器学习获得推荐<em class="jp">的用户，使用仅考虑价格和持续时间的<em class="jp"> </em>启发式方法获得推荐的用户，以及没有获得任何推荐的用户。</em></p><figure class="jt ju jv jw fq jx fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff lk"><img src="../Images/6ce200f53dfb741a385da43c4d3ecd7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pXW8FoSqpNAPWnpMECi8kQ.png"/></div></div><figcaption class="ke kf fg fe ff kg kh bd b be z ek">Online experiment: recommending flights above the traditional, price-sorted list.</figcaption></figure><h2 id="743c" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">我们的第一个结果:搜索努力和转化</h2><p id="1b2e" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">如上所述，我们没有通过查看点击量来评估这一点——我们对用户点击小部件不感兴趣。相反，我们首先量化了<em class="jp">的搜索努力</em>，通过观察用户在单次会话中过滤/重新选择/重新搜索路线的频率，包括他们收到航班推荐和没有收到的情况。在这种情况下，我们没有发现任何显著的差异。</p><p id="030f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不过，更广泛地说，我们感兴趣的是衡量<em class="jp">转化率</em>——在“传统”结果列表中，用户购买小工具推荐的航班与购买低于它的航班的频率。我们发现了巨大前景的证据——令我们惊讶的是，这个排名第一的模型比基于规则的模型驱动了更多的购买。</p><h2 id="b8ab" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">对未来工作的一瞥</h2><p id="e50f" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">这个实验是许多实验中的一个；这个过程的很大一部分是为了奠定基础，以便我们可以探索使用机器学习进行航班排名提供的数以千计的假设——无论是在线还是离线。</p><p id="c3e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<a class="ae ki" href="https://www.skyscanner.net/" rel="noopener ugc nofollow" target="_blank"> Skyscanner </a>上，这个领域还会有更多的东西:专注于UI的实验，跨平台的实验，测试新的机器学习模型的实验，以及可以使用这种方法构建的各种小部件的实验。</p><h1 id="53de" class="ll kk hu bd kl lm ln lo kp lp lq lr kt ls lt lu kw lv lw lx kz ly lz ma lc mb dt translated">与我们合作</h1><p id="a603" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">我们在Skyscanner以不同的方式做事，我们正在全球办事处寻找更多的工程团队成员。看看我们的<a class="ae ki" href="https://www.skyscanner.net/jobs/" rel="noopener ugc nofollow" target="_blank"> Skyscanner职位</a>寻找更多空缺。</p><figure class="jt ju jv jw fq jx fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff mc"><img src="../Images/986ea3d9e2542000bd33035721b207c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zvfRkK8SIOuNFiFn_KcUUw.png"/></div></div><figcaption class="ke kf fg fe ff kg kh bd b be z ek"><a class="ae ki" href="http://9nl.es/nealrank_engjobs" rel="noopener ugc nofollow" target="_blank">We’re hiring!</a></figcaption></figure><h2 id="1a90" class="kj kk hu bd kl km kn ko kp kq kr ks kt jc ku kv kw jg kx ky kz jk la lb lc ld dt translated">关于作者</h2><p id="0eae" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">你好，我是尼尔。我目前是Skyscanner伦敦办公室的高级数据科学家。我与一个团队合作，这个团队主要在我们布达佩斯的办公室进行上述实验，所以为旅行者构建这些功能背后的真实故事还包括旅行几次(去一个我以前没有去过的美丽城市)。你可以在<a class="ae ki" rel="noopener" href="/@neal_lathia"> Medium </a>和<a class="ae ki" href="https://twitter.com/neal_lathia" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上找到我，或者在我的网站上了解我以前的学术生活<a class="ae ki" href="http://nlathia.github.io/" rel="noopener ugc nofollow" target="_blank">。</a></p><div class="md me fm fo mf mg"><a rel="noopener follow" target="_blank" href="/@neal_lathia"><div class="mh ab ej"><div class="mi ab mj cl cj mk"><h2 class="bd hv fv z el ml eo ep mm er et ht dt translated">尼尔·拉西亚-中等</h2><div class="mn l"><h3 class="bd b fv z el ml eo ep mm er et ek translated">阅读Neal Lathia在媒体上的文章。数据科学等。每天，尼尔·拉西亚和成千上万的其他声音都在读…</h3></div><div class="mo l"><p class="bd b gc z el ml eo ep mm er et ek translated">medium.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu kc mg"/></div></div></a></div></div></div>    
</body>
</html>