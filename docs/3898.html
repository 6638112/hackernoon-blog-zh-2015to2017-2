<html>
<head>
<title>Why you should keep your react components pure by using HOCs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么您应该使用HOCs来保持react组件的纯净</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/why-you-should-keep-your-react-components-pure-by-using-hocs-67e5c7f80c81?source=collection_archive---------4-----------------------#2017-04-30">https://medium.com/hackernoon/why-you-should-keep-your-react-components-pure-by-using-hocs-67e5c7f80c81?source=collection_archive---------4-----------------------#2017-04-30</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/d82fac5138788ce563c800dfdfa45527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k_1M97_f-RmT8jgvpQ0pdQ.jpeg"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Image courtesy of <a class="ae ih" href="https://www.tahoepurewater.com" rel="noopener ugc nofollow" target="_blank">tahoepurewater</a></figcaption></figure><div class=""/><p id="02bc" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如今构建前端应用程序非常复杂。一些html加上一点jQuery就能解决问题的日子已经一去不复返了。今天，我们希望响应迅速、丰富、动态的单页面应用程序(<strong class="jj il"> SPA </strong>)能够在大量的设备和浏览器上运行——这不是一件容易的事情。幸运的是，我们有强大的框架和库可以帮助我们。在本文中，我用一些<a class="ae ih" href="https://facebook.github.io/react/" rel="noopener ugc nofollow" target="_blank"> React </a>的例子展示了从表示层分解状态如何既能降低复杂性又能促进代码重用——这是一个双赢的局面，有助于克服开发spa的挑战。虽然我使用的是React，但这些经验是通用的，可以应用于任何T4框架。</p><blockquote class="kf"><p id="b53c" class="kg kh ik bd ki kj kk kl km kn ko ke ek translated">警告，下面有大量代码</p></blockquote><p id="a85a" class="pw-post-body-paragraph jh ji ik jj b jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka kt kc kd ke hn dt translated">考虑一个简单的toggle React组件，它可以显示“<strong class="jj il"> on </strong>”或“<strong class="jj il"> off </strong>”:</p><figure class="ku kv kw kx fq hw"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="e887" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们在这里使用了一些ES7语法，但基本上组件可以呈现两个不同的元素，并通过用户点击它来切换状态。作为负责任的开发人员，我们可以用下面的代码来测试它(如果我们真的负责任，我们会首先编写这些测试😋):</p><figure class="ku kv kw kx fq hw"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="e60f" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">到目前为止很简单…除了在测试数量上有点少——没关系。但是，假设我们有另一个本质上类似但不同的组件，足以保证它有自己的代码，例如，可以显示或隐藏消息的info组件:</p><figure class="ku kv kw kx fq hw"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="f2a6" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">该组件具有不同的属性，并显示不同的元素集；然而，测试结果非常相似，因为基本上组件是相同的:对单个布尔状态变量的条件呈现。</p><figure class="ku kv kw kx fq hw"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="cb0e" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在每个组件中，很大一部分代码和测试都与管理状态有关。想象一下在一个大的代码库中重复这个过程——这可能会有点乏味。那么我们能做什么呢？</p><h2 id="c2a3" class="la lb ik bd lc ld le lf lg lh li lj lk js ll lm ln jw lo lp lq ka lr ls lt lu dt translated">引入高阶元件，即hoc</h2><figure class="ku kv kw kx fq hw fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/b9f93bc5334d68e4112d0bf426c3bdd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*5aGt89kK6B_GW8dPdneJxg.jpeg"/></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Image courtesy of <a class="ae ih" href="https://www.serenityatsummit.com" rel="noopener ugc nofollow" target="_blank">serenityatsummit</a></figcaption></figure><p id="d520" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">什么是<strong class="jj il">特设</strong>！？</p><blockquote class="kf"><p id="5a7d" class="kg kh ik bd ki kj kk kl km kn ko ke ek translated">高阶组件(HOC)是React中重用组件逻辑的一种高级技术。本质上，hoc不是React API的一部分。它们是从React的组合性质中出现的一种模式。</p><p id="2267" class="kg kh ik bd ki kj kk kl km kn ko ke ek translated">具体而言，<strong class="ak">高阶分量是取一个分量并返回一个新分量的函数。</strong><a class="ae ih" href="https://facebook.github.io/react/docs/higher-order-components.html" rel="noopener ugc nofollow" target="_blank">https://Facebook . github . io/react/docs/higher-order-components . html</a></p></blockquote><p id="451e" class="pw-post-body-paragraph jh ji ik jj b jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka kt kc kd ke hn dt translated">下面的代码显示了一个<strong class="jj il"> HOC </strong>，它可以包装任何具有开/关布尔状态的组件，一个点击处理程序来切换标志:</p><figure class="ku kv kw kx fq hw"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="7d54" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">注意，它只是一个带有单个参数<code class="eh lw lx ly lz b">WrappedComponent</code>(添加额外功能的react组件)的函数，它返回一个新的react组件；该组件负责呈现原始组件，但用布尔属性<code class="eh lw lx ly lz b">on</code>和管理状态的<code class="eh lw lx ly lz b">toggle</code>函数进行了修饰；它还会传递您想要的任何其他属性。</p><p id="4935" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">关于<strong class="jj il"> HOC </strong>的惊人之处在于，因为它们只是简单的函数，我们可以将多个<strong class="jj il"> HOC </strong>组合在一起，以增加潜在的无限功能。我们可以创建简单的、通用的、经过良好测试的组件，最终得到复杂的、功能强大的组件。</p><p id="58b2" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们不要忘记对我们的<strong class="jj il">特设</strong>的测试:</p><figure class="ku kv kw kx fq hw"><div class="bz el l di"><div class="ky kz l"/></div></figure><h2 id="291d" class="la lb ik bd lc ld le lf lg lh li lj lk js ll lm ln jw lo lp lq ka lr ls lt lu dt translated">现在来看看我们的纯组件</h2><figure class="ku kv kw kx fq hw fe ff paragraph-image"><div class="fe ff ma"><img src="../Images/24522871e8ee005e54ba96a54095f406.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*3kBltEyrlf_XY7JvZhQAkQ.jpeg"/></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Image courtesy of <a class="ae ih" href="http://www.eastcottvets.co.uk" rel="noopener ugc nofollow" target="_blank">eastcottvets</a></figcaption></figure><blockquote class="kf"><p id="9b3d" class="kg kh ik bd ki kj mb mc md me mf ke ek translated">纯函数是这样的函数，给定相同的输入，将总是返回相同的输出，并且没有任何可观察到的副作用。<a class="ae ih" href="https://drboolean.gitbooks.io/mostly-adequate-guide/ch3.html" rel="noopener ugc nofollow" target="_blank">https://dr boolean . git books . io/mosely-sufficient-guide/CH3 . html</a></p></blockquote><figure class="mg mh mi mj mk hw"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="a154" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">看看我们的Toggle组件现在有多漂亮。我们还可以在组件的属性上使用析构(<code class="eh lw lx ly lz b">Toggle = ({on, toggle}) =&gt; ..</code>)，这使得如何使用组件变得非常声明性和明显，即它需要两个参数:<code class="eh lw lx ly lz b">on</code>和<code class="eh lw lx ly lz b">toggle</code>；如果我们检查<code class="eh lw lx ly lz b">propTypes</code>对象，我们也可以看到它们分别是一个布尔and函数。<em class="ml">如果你想了解更多关于析构的知识，可以看看我的文章</em> <a class="ae ih" rel="noopener" href="/@DjamelH/javascript-es6-destructuring-and-a-few-useful-tricks-883c1c493783"> <em class="ml"> JAVASCRIPT ES6析构和一些有用的技巧</em> </a></p><p id="fd06" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后，我们使用我们的<code class="eh lw lx ly lz b">withState</code> <strong class="jj il"> HOC </strong>用<code class="eh lw lx ly lz b">on</code>状态和<code class="eh lw lx ly lz b">toggle</code>功能包装我们的纯组件。</p><p id="80ef" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们的测试:</p><figure class="ku kv kw kx fq hw"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="e30e" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们的测试现在已经改变了:我们只关心当组件被点击时切换功能是否被调用；我们相信实际的状态操作已经被测试过了——事实也的确如此！</p><p id="110a" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们看看Info组件是如何被重写以使用<code class="eh lw lx ly lz b">withState</code> <strong class="jj il"> HOC </strong>:</p><figure class="ku kv kw kx fq hw"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="724f" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">可爱！</p><p id="4333" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">测试是:</p><figure class="ku kv kw kx fq hw"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="8f47" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">就像Toggle组件的测试一样非常简单。</p><h1 id="0acd" class="mm lb ik bd lc mn mo mp lg mq mr ms lk mt mu mv ln mw mx my lq mz na nb lt nc dt translated">结论</h1><p id="2107" class="pw-post-body-paragraph jh ji ik jj b jk nd jm jn jo ne jq jr js nf ju jv jw ng jy jz ka nh kc kd ke hn dt translated">希望您已经看到了我们如何将一些状态委托给<strong class="jj il"> HOC </strong> s，这通过允许我们开发可爱的纯函数来简化我们的<a class="ae ih" href="https://hackernoon.com/tagged/react" rel="noopener ugc nofollow" target="_blank"> React </a>组件。由于我们最终可能会大量重用我们的<strong class="jj il"> HOC </strong>，这鼓励我们投入时间和精力来编写高质量的通用代码，并用单元测试彻底覆盖代码。例如，本文中介绍的简单withState <strong class="jj il"> HOC </strong>可能应该被重构，以使用一个函数来设置状态，而不是直接使用一个对象(有关更多信息，请参见本文<a class="ae ih" rel="noopener" href="/@shopsifter/using-a-function-in-setstate-instead-of-an-object-1f5cfd6e55d1">文章</a>)。对于我们上面的简单用例，这不会引起任何问题，但是如果它是一个可靠的可重用的<strong class="jj il"> HOC </strong>，我们真的应该这样做。</p><p id="caac" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您想尝试本文中的代码，请随意克隆/派生我的<a class="ae ih" href="https://github.com/dhassaine/reactPureVsClass" rel="noopener ugc nofollow" target="_blank"> repo </a>。</p></div><div class="ab cl ni nj hc nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="hn ho hp hq hr"><p id="9ea8" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="ml">如果你觉得这篇文章有用/有启发性</em> <strong class="jj il"> <em class="ml">点击</em> </strong>💚这样其他人也可以享受。</p><p id="62fe" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">感谢您的宝贵时间！关注我的<a class="ae ih" href="https://twitter.com/DjamelH" rel="noopener ugc nofollow" target="_blank"><em class="ml">Twitter</em></a><em class="ml">和</em><a class="ae ih" href="https://www.linkedin.com/in/dhassaine/" rel="noopener ugc nofollow" target="_blank"><em class="ml">LinkedIn</em></a><em class="ml">。</em></p></div><div class="ab cl ni nj hc nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="hn ho hp hq hr"><p id="18d1" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你对构建复杂的应用程序感兴趣，你可能会喜欢我的文章<a class="ae ih" rel="noopener" href="/@DjamelH/architecture-of-a-saas-sentinurl-com-a53a5c3724ee">sentinurl.com SaaS的架构</a>来获得一些高层次的架构建议。</p><div class="ku kv kw kx fq ab cb"><figure class="np hw nq nr ns nt nu paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="np hw nq nr ns nt nu paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="np hw nq nr ns nt nu paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="nv nw nx"><p id="f922" class="jh ji ml jj b jk jl jm jn jo jp jq jr ny jt ju jv nz jx jy jz oa kb kc kd ke hn dt translated"><a class="ae ih" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是<a class="ae ih" href="http://bit.ly/atAMIatAMI" rel="noopener ugc nofollow" target="_blank"> @AMI </a>家庭的一员。我们现在<a class="ae ih" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">正在接受投稿</a>并乐意<a class="ae ih" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jh ji ml jj b jk jl jm jn jo jp jq jr ny jt ju jv nz jx jy jz oa kb kc kd ke hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae ih" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae ih" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="ku kv kw kx fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ob"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="ku kv kw kx fq hw"><div class="bz el l di"><div class="oc kz l"/></div></figure></div></div>    
</body>
</html>