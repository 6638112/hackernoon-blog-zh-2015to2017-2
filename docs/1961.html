<html>
<head>
<title>A simple messaging app with React Native and Socket.io</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有React Native和Socket.io的简单消息应用</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-simple-messaging-app-with-react-native-and-socket-io-e1cae3df7bda?source=collection_archive---------0-----------------------#2016-12-25">https://medium.com/hackernoon/a-simple-messaging-app-with-react-native-and-socket-io-e1cae3df7bda?source=collection_archive---------0-----------------------#2016-12-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/5e8ca8d0ba9630922cb45e5826147522.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/1*YSJE2eyu_BNBu5ErqoOSyQ.gif"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek"><a class="ae jc" href="https://github.com/vinnyoodles/react-native-socket-io-example" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="f1c1" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">我从未想过我会写一篇关于媒体的文章，但老实说，我找不到一个合适的指南或例子来说明如何在这个用例中使用<a class="ae jc" href="https://github.com/facebook/react-native" rel="noopener ugc nofollow" target="_blank"> React Native </a>和<a class="ae jc" href="http://socket.io/" rel="noopener ugc nofollow" target="_blank"> Socket.io </a>。我确实在<a class="ae jc" rel="noopener" href="/@ekryski/how-to-actually-use-socket-io-in-react-native-39082d8d6172#.qjp8o5hs3">找到了一些</a> <a class="ae jc" href="https://github.com/badfortrains/wsExample" rel="noopener ugc nofollow" target="_blank">相关的</a> <a class="ae jc" href="https://github.com/skellock/phoenix-react-native-mashup" rel="noopener ugc nofollow" target="_blank">示例</a>，但是它们要么不够描述性，要么使用了不同的技术堆栈。所以现在是我贡献知识财富的时候了。</p><p id="e034" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">让我们开始吧。首先，需要创建一个服务器和客户机。这个例子将使用一个Express服务器和一个普通的React本地项目。一旦它们都被创建，它们都必须指向同一个web套接字，这就是数据在两者之间传输的方式。</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><p id="a175" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">一个服务器和多个客户端之间可以打开多个套接字。Socket.io使得单个客户端、多个客户端或所有客户端之间的对话变得非常简单。</p><p id="2084" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">一旦建立了套接字，两端就可以无延迟地自由通话(比HTTP请求更快😊。).</p><p id="686b" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">要使用web套接字，只需通过指定的通道发送数据/消息。</p><pre class="kb kc kd ke fq ko kp kq kr aw ks dt"><span id="114c" class="kt ku hu kp b fv kv kw l kx ky">socket.emit('channel-name', 'Hello world!');</span></pre><p id="1e53" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">这对于服务器和客户端都是一样的。另一端只需监听指定的频道。</p><pre class="kb kc kd ke fq ko kp kq kr aw ks dt"><span id="87be" class="kt ku hu kp b fv kv kw l kx ky">socket.on('channel-name', (message) =&gt; ... /* some logic */);</span></pre><p id="5adb" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">简单的数据结构也可以通过套接字发送，所以数组和对象是公平的游戏。</p></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><p id="de77" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">回到我们的用例。当用户输入并发送消息时，它将被发送到服务器，服务器可以执行一些逻辑，然后服务器将消息发送到所有套接字(其他用户)。消息应用程序应该在会话之间存储数据，所以我们只需在消息被转发时将其保存在数据库中。</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="21d8" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">消息模型可能类似于:</p><pre class="kb kc kd ke fq ko kp kq kr aw ks dt"><span id="3e5b" class="kt ku hu kp b fv kv kw l kx ky">{ <br/>  text: <em class="kz">String</em>,<br/>  createdAt: <em class="kz">Date</em>,<br/>  userId: <em class="kz">ObjectId</em>,<br/>  chatId: <em class="kz">ObjectId</em> <br/>}</span></pre><p id="1616" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">为了跟踪一个任何数量的人都可以加入的开放聊天室，一个<em class="kz">标识符</em>字段将有助于跟踪消息。对于移动应用程序，每个设备将充当一个用户，对于新用户，他们将被分配一个<em class="kz"> id </em>字段，该字段应保存在设备的本地存储中。如果设备上保存有<em class="kz"> id </em>字段，我们可以确定用户是否加入了聊天室。为了处理多个聊天室，应该使用某种映射结构，以便我们知道用户在哪个房间(如果存在的话)。</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="e5fb" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">关于我前面提到的持久性，当用户加入一个房间时，我们应该给它任何预先存在的消息，这些消息保存在特定房间的数据库中。</p><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="07f9" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">我已经创建了一个<a class="ae jc" href="https://github.com/vinnyoodles/react-native-socket-io-example" rel="noopener ugc nofollow" target="_blank">工作消息应用</a>的工作示例。非常感谢<a class="la lb gr" href="https://medium.com/u/fea63d4e28f3?source=post_page-----e1cae3df7bda--------------------------------" rel="noopener" target="_blank">法里德·萨菲</a>的<a class="ae jc" href="https://github.com/FaridSafi/react-native-gifted-chat" rel="noopener ugc nofollow" target="_blank">消息组件</a>让这变得如此简单。尽情享受吧！</p></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><p id="b5fa" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">我是弗吉尼亚理工大学计算机科学专业的学生，喜欢写代码和举重💪。<a class="ae jc" href="https://www.linkedin.com/in/vinnyoodles" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> <a class="ae jc" href="https://github.com/vinnyoodles" rel="noopener ugc nofollow" target="_blank"> Github </a></p><div class="kb kc kd ke fq ab cb"><figure class="lc iv ld le lf lg lh paragraph-image"><a href="http://bit.ly/HackernoonFB"><img src="../Images/50ef4044ecd4e250b5d50f368b775d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></a></figure><figure class="lc iv ld le lf lg lh paragraph-image"><a href="https://goo.gl/k7XYbx"><img src="../Images/979d9a46439d5aebbdcdca574e21dc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></a></figure><figure class="lc iv ld le lf lg lh paragraph-image"><a href="https://goo.gl/4ofytp"><img src="../Images/2930ba6bd2c12218fdbbf7e02c8746ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></a></figure></div><blockquote class="li lj lk"><p id="f922" class="jd je kz jf b jg jh ji jj jk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz ka hn dt translated"><a class="ae jc" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">黑客中午</a>是黑客如何开始他们的下午。我们是阿妹家庭的一员。我们现在<a class="ae jc" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">接受投稿</a>并乐意<a class="ae jc" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">讨论广告&amp;赞助</a>机会。</p><p id="708a" class="jd je kz jf b jg jh ji jj jk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz ka hn dt translated">如果你喜欢这个故事，我们推荐你阅读我们的<a class="ae jc" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">最新科技故事</a>和<a class="ae jc" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">趋势科技故事</a>。直到下一次，不要把世界的现实想当然！</p></blockquote><figure class="kb kc kd ke fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="fe ff lo"><img src="../Images/be0ca55ba73a573dce11effb2ee80d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></div></div></figure><figure class="kb kc kd ke fq iv"><div class="bz el l di"><div class="lt kg l"/></div></figure></div></div>    
</body>
</html>