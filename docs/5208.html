<html>
<head>
<title>A first look into the Angular CDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">棱角分明的CDK初探</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-first-look-into-the-angular-cdk-67e68807ed9b?source=collection_archive---------0-----------------------#2017-07-16">https://medium.com/hackernoon/a-first-look-into-the-angular-cdk-67e68807ed9b?source=collection_archive---------0-----------------------#2017-07-16</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="8a53" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这篇文章中，我深入探讨了最近发布的Angular CDK的一些特性。具体我就说说Portal和PortalHost。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/532371f5ef355efdf0656f768cb5831d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FPwG27hHNXOVtbys2ji5g.png"/></div></div></figure><p id="ee24" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="kb">TL；DR:我用最近发布的角度CDK构建了一个简单的例子。跳转到本文末尾的代码或者</em> <a class="ae kc" href="https://stackblitz.com/edit/angular-cdk-portal-basic" rel="noopener ugc nofollow" target="_blank"> <em class="kb">访问Stackblitz </em> </a> <em class="kb">中的工作演示。</em></p></div><div class="ab cl kd ke hc kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hn ho hp hq hr"><h1 id="03df" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated"><strong class="ak">棱角分明的物质CDK </strong></h1><p id="c3ff" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">作为一点介绍，Angular Material团队<a class="ae kc" href="http://angularjs.blogspot.com.co/2017/07/angular-material-status-update.html" rel="noopener ugc nofollow" target="_blank">前几天发布了</a>Angular Component开发套件。我不会花太多精力解释什么是CDK，所以我宁愿在这里引用它们:</p><blockquote class="ln lo lp"><p id="01a3" class="ir is kb it b iu iv iw ix iy iz ja jb lq jd je jf lr jh ji jj ls jl jm jn jo hn dt translated">CDK的目标是给开发者更多的工具来为网络构建令人敬畏的组件。这对于希望利用角形材料的特性而不采用材料设计视觉语言的项目尤其有用。— <strong class="it hv">棱角分明的团队</strong></p></blockquote><p id="e4dd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，很明显，CDK是由一堆服务、指令、组件、类、模块等组成的，这使得我们在开发Angular组件时更加容易。在当前的第一个版本中，它们包含了可访问性、文本方向性、平台检测和动态组件实例化的特性。<strong class="it hv">在这篇文章中，我将专门讨论动态组件实例化。还没有文档，但是你可以在这里看一下代码<a class="ae kc" href="https://github.com/angular/material2/tree/master/src/cdk" rel="noopener ugc nofollow" target="_blank"/>。CDK是在@angular/cdk npm包下发布的。</strong></p><h2 id="40d2" class="lt kl hu bd km lu lv lw kq lx ly lz ku jc ma mb ky jg mc md lc jk me mf lg mg dt translated">我为什么要考虑用这个呢？</h2><p id="f947" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">CDK背后的人和角状物质背后的人是同一批人。Angular Material团队的任务之一就是在考虑性能、a11y、i18n、可扩展性等因素的情况下，为如何在Angular中正确构建组件打下良好的基础。所以，在差不多<a class="ae kc" href="https://github.com/angular/material2/issues" rel="noopener ugc nofollow" target="_blank"> 3k期结束</a>后，我确信他们对如何为网络构建好的组件略知一二。使用自动CDK是一种安全的方法，可确保将最佳实践纳入您的组件生产工作流程。</p></div><div class="ab cl kd ke hc kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hn ho hp hq hr"><h1 id="2207" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">门户和门户主机</h1><p id="b024" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">我将尽力解释这两个核心概念，它们在Angular素材库中被大量使用。在CDK源代码中有一个关于这个主题的简短文档，你可以在这里访问<a class="ae kc" href="https://github.com/angular/material2/blob/master/src/cdk/portal/portal.md" rel="noopener ugc nofollow" target="_blank"/>。简单地说，CDK公开了一个API，让您通过门户和门户主机进行动态组件实例化。这意味着您可以轻松地在任何其他元素中注入组件或模板，无论它是一个<code class="eh mh mi mj mk b">ng-template</code>还是一个普通的DOM元素(比如<code class="eh mh mi mj mk b">document.body)</code>)。让我们来分解一下<code class="eh mh mi mj mk b">Portal</code>和<code class="eh mh mi mj mk b">PortalHost</code>的概念。</p><p id="24f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">Portal:</strong><strong class="it hv"/>您想在其他地方插入的UI块。它可以是Component或TemplateRef。</p><p id="9e03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> PortalHost: </strong>要渲染门户的地方。PortalHost有一个名为<code class="eh mh mi mj mk b">DOMPortalHost</code>的具体实现，它基本上允许您将门户附加到Angular应用程序上下文之外的任意DOM元素，比如<code class="eh mh mi mj mk b">document.body</code>。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/6e7acdb399d5f839493f883f0cabea00.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*hkFG8aHySNx8D5kLF54NdQ.png"/></div><figcaption class="mm mn fg fe ff mo mp bd b be z ek">A Component or Template Ref is attached to a Portal. A portal is then attached to a PortalHost. A PortalHost can be an ng-template or an arbitrary DOM element.</figcaption></figure><p id="c1c3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们跳到如何在真实世界场景中使用这些概念的例子之前，我建议您在这里访问CDK源代码<a class="ae kc" href="https://github.com/angular/material2/blob/master/src/cdk/portal/portal.ts" rel="noopener ugc nofollow" target="_blank">中的<code class="eh mh mi mj mk b">portal.ts</code>实现。不要试图理解具体的实现细节(如果你想的话就去做)，而是看一看这些类和它们的方法。通过阅读它们的名字，你将很快掌握每个类和方法的作用。这会让你对这些工具为你做了什么有一个很好的感觉。</a></p></div><div class="ab cl kd ke hc kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hn ho hp hq hr"><h1 id="b211" class="kk kl hu bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">例子</h1><p id="8963" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">在本例中，我们将构建一个简单的服务/组件，让我们显示完整的宽度/高度<em class="kb"> Loading… </em>消息。当您在几个屏幕中从一个API加载数据时，这真的很方便。下面的代码片段假设已经通过<code class="eh mh mi mj mk b">npm install @angular/cdk</code>安装了CDK。</p><p id="6e18" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将在我们的文档的<code class="eh mh mi mj mk b">&lt;body&gt;</code>中添加一个组件，所以如果你能先看看这篇文章中的<em class="kb">普通的、非cdk </em>方法<a class="ae kc" rel="noopener" href="/@caroso1222/angular-pro-tip-how-to-dynamically-create-components-in-body-ba200cc289e6">，下面的代码会更有意义。</a></p><h2 id="e7b5" class="lt kl hu bd km lu lv lw kq lx ly lz ku jc ma mb ky jg mc md lc jk me mf lg mg dt translated">该组件</h2><p id="138d" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">我们应该做的第一件事是创建一个带有<em class="kb"> Loading… </em>消息的组件。它也可以有一个旋转器，一个阴影背景，淡入/淡出动画等。因为这不是这篇文章的核心，我假设你已经知道如何去做，我将在这里跳过实现细节。您应该注意的一件事是<strong class="it hv">将您的组件添加到您的模块的</strong> <code class="eh mh mi mj mk b"><strong class="it hv">entryComponents</strong></code>。为了便于举例，我们将组件命名为<code class="eh mh mi mj mk b">LoadingSpinnerComponent</code>。</p><h2 id="5f35" class="lt kl hu bd km lu lv lw kq lx ly lz ku jc ma mb ky jg mc md lc jk me mf lg mg dt translated">服务</h2><p id="72c3" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">这就是我们应用在这篇文章中学到的概念的地方。我们将构建一个服务<code class="eh mh mi mj mk b">LoadingSpinnerService</code>，它公开两个简单的方法:<code class="eh mh mi mj mk b">reveal()</code>和<code class="eh mh mi mj mk b">hide()</code>，这两个方法将分别显示和隐藏我们的加载微调器(咄)。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mq mr l"/></div></figure><h2 id="9643" class="lt kl hu bd km lu lv lw kq lx ly lz ku jc ma mb ky jg mc md lc jk me mf lg mg dt translated">分解要点</h2><p id="7398" class="pw-post-body-paragraph ir is hu it b iu li iw ix iy lj ja jb jc lk je jf jg ll ji jj jk lm jm jn jo hn dt translated">我真的觉得代码是非常自我解释的，但我还是会添加一些评论。请遵循片段注释中的数字:</p><ol class=""><li id="7723" class="ms mt hu it b iu iv iy iz jc mu jg mv jk mw jo mx my mz na dt translated"><strong class="it hv">创建对门户的引用:</strong>如前所述，门户是用于包含组件或模板引用的抽象。在这种情况下，我们将从之前创建的<code class="eh mh mi mj mk b">LoadingSpinnerComponent</code>构建一个门户。</li><li id="23d0" class="ms mt hu it b iu nb iy nc jc nd jg ne jk nf jo mx my mz na dt translated"><strong class="it hv">创建对PortalHost: </strong>的引用，我们将使用<code class="eh mh mi mj mk b">document.body</code>来注入我们的组件。我们选择了一个DOM元素作为主机的锚点，所以我们使用了<code class="eh mh mi mj mk b">PortalHost</code>的<code class="eh mh mi mj mk b">DomPortalHost</code>实现。</li><li id="34bd" class="ms mt hu it b iu nb iy nc jc nd jg ne jk nf jo mx my mz na dt translated"><strong class="it hv">注入依赖关系:</strong>这些依赖关系是<code class="eh mh mi mj mk b">DomPortalHost</code>构建门户主机所需要的。如果你想了解CDK是如何处理所有这些依赖关系的，请访问这篇文章，在这篇文章中，我详细介绍了所有这些细节。</li><li id="7957" class="ms mt hu it b iu nb iy nc jc nd jg ne jk nf jo mx my mz na dt translated"><strong class="it hv">创建门户:</strong><code class="eh mh mi mj mk b">Portal</code>抽象类有两个实现:<code class="eh mh mi mj mk b">ComponentPortal</code>和<code class="eh mh mi mj mk b">TemplatePortal</code>。我们使用前者作为我们的构造函数，因为我们想要基于我们的<code class="eh mh mi mj mk b">LoadingSpinnerComponent</code>创建一个门户。</li><li id="b700" class="ms mt hu it b iu nb iy nc jc nd jg ne jk nf jo mx my mz na dt translated"><strong class="it hv">创建PortalHost: </strong>与第4点相同，我们使用构造函数基于DOM元素<code class="eh mh mi mj mk b">&lt;body&gt;</code>构建PortalHost。如果你想知道为什么我选择了<code class="eh mh mi mj mk b">document.body</code>来附加组件，原因很简单:loading spinner是一个应该放在屏幕中任何其他元素之上的组件，如果放在任何其他元素之内，我们不想处理堆叠问题。此外，它作为一个对话框工作，因此，从架构上来说，它不应该是任何组件的后代的一部分。</li><li id="ab9e" class="ms mt hu it b iu nb iy nc jc nd jg ne jk nf jo mx my mz na dt translated"><strong class="it hv">显示微调器:</strong>通过简单地将组件连接到门户主机来显示组件。就这么简单。</li><li id="a0d4" class="ms mt hu it b iu nb iy nc jc nd jg ne jk nf jo mx my mz na dt translated"><strong class="it hv">隐藏旋转器:</strong>通过简单地将组件从门户主机上拆下来隐藏组件。就这么简单。</li></ol></div><div class="ab cl kd ke hc kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hn ho hp hq hr"><p id="9d8d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">工作演示(鸣谢</strong> <a class="ng nh gr" href="https://medium.com/u/dc147cdeb83e?source=post_page-----67e68807ed9b--------------------------------" rel="noopener" target="_blank"> <strong class="it hv">格欣奥克斯</strong></a><strong class="it hv">):</strong><a class="ae kc" href="https://stackblitz.com/edit/angular-cdk-portal-basic" rel="noopener ugc nofollow" target="_blank">https://stackblitz.com/edit/angular-cdk-portal-basic</a>。</p><p id="2db6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我希望这篇文章能激励你去玩新的棱角分明的CDK。Angular Material团队肯定会在接下来的几周内为CDK添加更多功能，敬请关注。</p></div><div class="ab cl kd ke hc kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hn ho hp hq hr"><p id="2ad2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你喜欢这个，请展示你的爱并分享。通过Twitter <a class="ae kc" href="https://twitter.com/caroso1222" rel="noopener ugc nofollow" target="_blank"> @caroso1222 </a>联系我。</p></div></div>    
</body>
</html>