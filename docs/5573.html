<html>
<head>
<title>How to Build a Vue.js Photo Gallery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何建立Vue.js图片库</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-a-vue-js-photo-gallery-a0d4a1ec298d?source=collection_archive---------3-----------------------#2017-08-03">https://medium.com/hackernoon/how-to-build-a-vue-js-photo-gallery-a0d4a1ec298d?source=collection_archive---------3-----------------------#2017-08-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="adc7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本教程中，我将向您展示如何使用来自<a class="ae jp" href="https://html5up.net/" rel="noopener ugc nofollow" target="_blank"> HTML5UP </a>的现成模板构建一个照片库，该模板由<a class="ae jp" href="https://cosmicjs.com" rel="noopener ugc nofollow" target="_blank"> Cosmic JS </a> API提供支持，托管在Cosmic JS应用服务器上。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/c7d6571693a1ce3de31fba2996effe15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Tqa1f01aXXqXcvrR.jpg"/></div></div></figure><h1 id="29b4" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">TL；速度三角形定位法(dead reckoning)</h1><p id="fd52" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated"><a class="ae jp" href="https://cosmicjs.com/apps/vuejs-photo-gallery" rel="noopener ugc nofollow" target="_blank">查看演示</a> <br/> <a class="ae jp" href="https://github.com/cosmicjs/vuejs-photo-gallery" rel="noopener ugc nofollow" target="_blank">在GitHub上查看代码库</a></p><h1 id="5048" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">先决条件</h1><p id="7318" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">您将需要节点JS和npm。在开始之前，确保你已经有了它们。</p><h1 id="dbf3" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">入门指南</h1><p id="6397" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">首先，我们需要安装VueJS CLI并启动新项目。为此，请运行以下命令:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="e087" class="lk kd hu lg b fv ll lm l ln lo">npm install -g vue-cli<br/>vue init webpack vuejs-photo-gallery<br/>cd vuejs-photo-gallery<br/>npm install</span></pre><p id="dfbc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">设置好这个项目后，您就可以运行了</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="ac21" class="lk kd hu lg b fv ll lm l ln lo">cd vuejs-photo-gallery<br/>npm run dev</span></pre><p id="5a09" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在浏览器中玩你的应用程序</p><h1 id="559f" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">使用现有的git repo做任何事情</h1><p id="a05b" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">首先，您必须确保安装了node &gt; 6.x，然后运行以下命令:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="cc87" class="lk kd hu lg b fv ll lm l ln lo">npm install -g vue-cli<br/>git clone https://github.com/cosmicjs/vuejs-photo-gallery.git<br/>cd vuejs-photo-gallery<br/>npm install<br/>npm run dev</span></pre><p id="9c50" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">运行最后一个命令后，浏览器窗口将自动打开</p><h1 id="b392" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">建立宇宙JS库</h1><p id="81b5" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">首先安装Cosmic JS Angular/JavaScript库</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="2fc4" class="lk kd hu lg b fv ll lm l ln lo">npm install cosmicjs --save</span></pre><p id="7351" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在你应该能够导入宇宙对象并执行宇宙JS API调用，如下所示:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="2914" class="lk kd hu lg b fv ll lm l ln lo">import Cosmic from 'cosmicjs';<br/>const bucket = { slug: 'your-bucket-slug' };</span><span id="8240" class="lk kd hu lg b fv lp lm l ln lo">Cosmic.getObjects({ bucket }, (err, res) =&gt; {<br/>  console.log(res.objects);<br/>});</span></pre><h1 id="dacf" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">用宇宙JS设置事物</h1><p id="0d54" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">创建存储桶并记住存储桶名称(在我们的例子中为<code class="eh lq lr ls lg b">vuejs-photo-gallery</code>):</p><p id="de50" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后创建一个名为Photo的新对象类型。</p><p id="d0d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还需要一种存储图片本身的方法。请进入“图元字段模板”选项卡，用键<code class="eh lq lr ls lg b">image</code>添加“图像/文件”类型的图元字段。这个元字段将存储图像。我们不需要更多的东西，所以只需设置名称和保存对象类型。保存后，您将被重定向到“新照片”页面。使用此页面创建一些照片并保存它们-我们将使用它们作为测试数据。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/2467ba3bb156e3cb3d31ce4ebc0634b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hYS84oI6gicqubVT.png"/></div></div></figure><p id="33c0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">剩下唯一要做的就是设置网站范围内的东西，比如标题、标语、社交图标和页脚文本。让我们再创建一个名为Global的对象类型。并添加以下元字段:</p><ul class=""><li id="f743" class="lt lu hu it b iu iv iy iz jc lv jg lw jk lx jo ly lz ma mb dt translated">标语—纯文本区域</li><li id="a480" class="lt lu hu it b iu mc iy md jc me jg mf jk mg jo ly lz ma mb dt translated">Twitter —纯文本输入</li><li id="bae3" class="lt lu hu it b iu mc iy md jc me jg mf jk mg jo ly lz ma mb dt translated">Instagram —纯文本输入</li><li id="0724" class="lt lu hu it b iu mc iy md jc me jg mf jk mg jo ly lz ma mb dt translated">Github —纯文本输入</li><li id="25df" class="lt lu hu it b iu mc iy md jc me jg mf jk mg jo ly lz ma mb dt translated">电子邮件—纯文本输入</li><li id="4bc6" class="lt lu hu it b iu mc iy md jc me jg mf jk mg jo ly lz ma mb dt translated">页脚—纯文本区域</li></ul><h1 id="e4c6" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">VueJS环境</h1><p id="87ec" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">我们希望在部署时自动选择我们的存储桶名称。在这种情况下，我们需要配置文件，我们将在部署过程中使用正确的数据填充该文件。创建<code class="eh lq lr ls lg b">src/config.js</code>以匹配以下内容:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="70dd" class="lk kd hu lg b fv ll lm l ln lo">Config = {<br/>    bucket: 'vuejs-photo-gallery'<br/>};</span><span id="2dc3" class="lk kd hu lg b fv lp lm l ln lo">module.exports = Config;</span></pre><h1 id="0ba3" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">准备资产</h1><p id="4666" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">下载模板ZIP文件，并将其解压缩到某个地方。在我们的例子中，我们有以下内容:</p><p id="41f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是我们的HTML标记，稍后我们会把它移到Vue组件中。<code class="eh lq lr ls lg b">images</code> -这是样本图像文件夹。我们不需要它，我们的图像将由宇宙JS服务器<code class="eh lq lr ls lg b">assets</code>提供——其他资产如CSS、字体、javascript文件。我们需要CSS和字体。让我们暂时忽略Javascript，因为我们计划使用VueJS。让我们将<code class="eh lq lr ls lg b">assets/css</code>和<code class="eh lq lr ls lg b">assets/fonts</code>文件夹复制到我们项目中的<code class="eh lq lr ls lg b">static</code>文件夹。这将允许我们将这些文件作为静态资产自动添加到构建中。</p><h1 id="b6a9" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">准备index.html</h1><p id="6602" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">现在是时候将我们的资产纳入<code class="eh lq lr ls lg b">index.html</code>了。将以下内容添加到<code class="eh lq lr ls lg b">head</code>部分:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="f62d" class="lk kd hu lg b fv ll lm l ln lo">&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;<br/>&lt;!--[if lte IE 8]&gt;&lt;script src="assets/js/ie/html5shiv.js"&gt;&lt;/script&gt;&lt;![endif]--&gt;<br/>&lt;link rel="stylesheet" href="static/css/main.css" /&gt;<br/>&lt;!--[if lte IE 8]&gt;&lt;link rel="stylesheet" href="assets/css/ie8.css" /&gt;&lt;![endif]--&gt;<br/>&lt;!--[if lte IE 9]&gt;&lt;link rel="stylesheet" href="assets/css/ie9.css" /&gt;&lt;![endif]--&gt;<br/>&lt;noscript&gt;&lt;link rel="stylesheet" href="static/css/noscript.css" /&gt;&lt;/noscript&gt;</span></pre><p id="d042" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将包括我们的静态资产。一旦我们实现了正确的标记，外观将通过CSS自动设置。</p><h1 id="f8fb" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">VueJS组件</h1><p id="d6fa" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">查看我们的页面，我们可以定义我们需要的组件:</p><p id="37b5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lq lr ls lg b">Header</code>和<code class="eh lq lr ls lg b">Footer</code> -这将是非常简单的组件，将显示应用程序启动时加载的全局数据<code class="eh lq lr ls lg b">Thumbs</code> -该组件将显示照片缩略图<code class="eh lq lr ls lg b">Viwer</code> -该组件将显示大照片，并提供上一页/下一页导航。请注意——我们正在使用之前下载的模板创建组件的模板标记(从index.html复制粘贴并应用VueJS指令)。</p><p id="5bea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lq lr ls lg b">Header</code>组件:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="676d" class="lk kd hu lg b fv ll lm l ln lo">&lt;template&gt;<br/>    &lt;header id="header"&gt;<br/>        &lt;h1&gt;{{ header }}&lt;/h1&gt;<br/>        &lt;div v-html="text"&gt;&lt;/div&gt;<br/>        &lt;ul class="icons"&gt;<br/>            &lt;li&gt;&lt;a :href="twitter" class="icon fa-twitter"&gt;&lt;span class="label"&gt;Twitter&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;<br/>            &lt;li&gt;&lt;a :href="instagram" class="icon fa-instagram"&gt;&lt;span class="label"&gt;Instagram&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;<br/>            &lt;li&gt;&lt;a :href="github" class="icon fa-github"&gt;&lt;span class="label"&gt;Github&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;<br/>            &lt;li&gt;&lt;a :href="email" class="icon fa-envelope-o"&gt;&lt;span class="label"&gt;Email&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;<br/>        &lt;/ul&gt;<br/>    &lt;/header&gt;<br/>&lt;/template&gt;</span><span id="b1f8" class="lk kd hu lg b fv lp lm l ln lo">&lt;script&gt;<br/>import {EventBus} from '../event_bus';</span><span id="17dc" class="lk kd hu lg b fv lp lm l ln lo">export default {<br/>    name: 'app-header',<br/>    created() {<br/>        EventBus.$on('global_loaded', (obj) =&gt; {<br/>            this.header = obj.title;<br/>            this.text = obj.metafield.tagline.value;<br/>            this.twitter = obj.metafield.twitter.value;<br/>            this.instagram = obj.metafield.instagram.value;<br/>            this.github = obj.metafield.github.value;<br/>            this.email = 'mailto:' + obj.metafield.email.value;<br/>        });<br/>    },<br/>    data () {<br/>        return {<br/>            text: null,<br/>            twitter: '',<br/>            instagram: '',<br/>            github: '',<br/>            email: '',<br/>            header: ''<br/>        }<br/>    }<br/>}<br/>&lt;/script&gt;</span></pre><p id="b6f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lq lr ls lg b">Footer</code>组件非常相似:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="a297" class="lk kd hu lg b fv ll lm l ln lo">&lt;template&gt;<br/>    &lt;footer id="footer"&gt;<br/>        &lt;div v-html="text"&gt;&lt;/div&gt;<br/>    &lt;/footer&gt;<br/>&lt;/template&gt;</span><span id="d883" class="lk kd hu lg b fv lp lm l ln lo">&lt;script&gt;<br/>import {EventBus} from '../event_bus';</span><span id="3ea6" class="lk kd hu lg b fv lp lm l ln lo">export default {<br/>    name: 'app-footer',<br/>    created() {<br/>        EventBus.$on('global_loaded', (obj) =&gt; {<br/>            this.text = obj.metafield.footer.value;<br/>        });<br/>    },<br/>    data () {<br/>        return {<br/>            text: null<br/>        }<br/>    }<br/>}<br/>&lt;/script&gt;</span></pre><p id="9305" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">两个组件都使用<code class="eh lq lr ls lg b">EventBus</code>从父组件接收数据。我将在这篇文章的后面讲述事件总线。</p><h1 id="bb41" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">拇指组件</h1><p id="9736" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">这个组件比前两个组件更复杂:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="ae44" class="lk kd hu lg b fv ll lm l ln lo">&lt;template&gt;<br/>    &lt;section id="thumbnails"&gt;<br/>        &lt;article v-for="(item, index) in items" v-bind:class="{ 'active': activeIndex == index }"&gt;<br/>            &lt;a class="thumbnail" v-on:click="selectImage(item, index)"&gt;<br/>                &lt;img v-bind:src="item.metafield.image.imgix_url" alt="" /&gt;<br/>            &lt;/a&gt;<br/>            &lt;h2&gt;{{ item.title }}&lt;/h2&gt;<br/>            &lt;div v-html="item.content"&gt;&lt;/div&gt;<br/>        &lt;/article&gt;<br/>    &lt;/section&gt;<br/>&lt;/template&gt;</span><span id="986b" class="lk kd hu lg b fv lp lm l ln lo">&lt;script&gt;<br/>import Cosmic from 'cosmicjs';<br/>import * as Config from '../config';<br/>import {EventBus} from '../event_bus';</span><span id="ab2e" class="lk kd hu lg b fv lp lm l ln lo">const bucket = { slug: Config.bucket };</span><span id="9114" class="lk kd hu lg b fv lp lm l ln lo">export default {<br/>    name: 'thumbs',<br/>    props: ['bus'],<br/>    created() {<br/>        Cosmic.getObjectType({ bucket }, { type_slug: 'photos' }, (err, res) =&gt; {<br/>            this.items = res.objects.all;<br/>            EventBus.$emit('loaded', this.items[0]);<br/>        });<br/>        EventBus.$on('move', (dir) =&gt; {<br/>            this.activeIndex = this.activeIndex + dir;<br/>            if (dir &gt; 0 &amp;&amp; this.activeIndex &gt;= this.items.length) {<br/>                this.activeIndex = 0;<br/>            }<br/>            if (dir &lt; 0 &amp;&amp; this.activeIndex &lt; 0) {<br/>                this.activeIndex = this.items.length - 1;<br/>            }<br/>            EventBus.$emit('loaded', this.items[this.activeIndex]);<br/>        });<br/>    },<br/>    data () {<br/>        return {<br/>            items: [],<br/>            activeIndex: 0<br/>        }<br/>    },<br/>    methods: {<br/>        selectImage (itm, index) {<br/>            EventBus.$emit('loaded', itm);<br/>            this.activeIndex = index;<br/>        }<br/>    }<br/>}<br/>&lt;/script&gt;</span></pre><p id="8a3b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在组件创建时，我们获取照片列表并订阅事件总线“移动”事件。然后，我们只是渲染这些照片，并在每次用户选择新照片时发出一个新事件。</p><h1 id="b650" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">查看器组件</h1><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="6785" class="lk kd hu lg b fv ll lm l ln lo">&lt;template&gt;<br/>    &lt;div id="viewer"&gt;<br/>        &lt;div class="inner"&gt;<br/>            &lt;div class="nav-next" v-on:click="selectNext()"&gt;&lt;/div&gt;<br/>            &lt;div class="nav-previous" v-on:click="selectPrev()"&gt;&lt;/div&gt;<br/>        &lt;/div&gt;<br/>        &lt;div class="slide active" v-if="img"&gt;<br/>            &lt;div class="caption"&gt;<br/>                &lt;h2&gt;{{ img.title }}&lt;/h2&gt;<br/>                &lt;div v-html="img.content"&gt;&lt;/div&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="image" v-bind:style='{ backgroundImage: "url(" + img.metafield.image.imgix_url + ")" }'&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt; <br/>    &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="db5c" class="lk kd hu lg b fv lp lm l ln lo">&lt;script&gt;<br/>import {EventBus} from '../event_bus';</span><span id="fb21" class="lk kd hu lg b fv lp lm l ln lo">export default {<br/>    name: 'viewer',<br/>    props: ['bus'],<br/>    created() {<br/>        EventBus.$on('loaded', (obj) =&gt; {<br/>            this.img = obj;<br/>        });<br/>    },<br/>    data () {<br/>        return {<br/>            img: null<br/>        }<br/>    },<br/>    methods: {<br/>        selectNext() {<br/>            EventBus.$emit('move', 1);<br/>        },<br/>        selectPrev() {<br/>            EventBus.$emit('move', -1);<br/>        }<br/>    }<br/>}<br/>&lt;/script&gt;</span></pre><p id="7084" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该组件通过事件总线订阅<code class="eh lq lr ls lg b">loaded</code>事件。这个事件意味着用户选择了一张新照片，我们必须以更大的尺寸显示它；该组件的另一个任务是在用户单击上一页/下一页按钮时通知Thumbs组件。组件也将事件总线用于此目的。</p><h1 id="0005" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">事件总线</h1><p id="9ce2" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">事件总线遵循发布-订阅模式，允许我们在Thumbs和查看器组件之间建立通信。两个组件都在同一个层次上(没有父子关系)，所以我们需要比简单的事件发射更复杂的东西。事件总线的实现非常简单(<code class="eh lq lr ls lg b">src/event_bus.js</code>):</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="48a1" class="lk kd hu lg b fv ll lm l ln lo">import Vue from 'vue';<br/>export const EventBus = new Vue();</span></pre><p id="c287" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个事件总线用于触发一个组件中的事件(使用<code class="eh lq lr ls lg b">EventBus.$emit</code>)和订阅另一个组件中的事件(使用<code class="eh lq lr ls lg b">EventBus.$on</code>)。</p><h1 id="89aa" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">将一切串联在一起</h1><p id="4981" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">现在是时候用<code class="eh lq lr ls lg b">App</code>组件连接一切了:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="a772" class="lk kd hu lg b fv ll lm l ln lo">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;div id="main"&gt;<br/>      &lt;app-header&gt;&lt;/app-header&gt;<br/>      &lt;thumbs&gt;&lt;/thumbs&gt;<br/>      &lt;app-footer&gt;&lt;/app-footer&gt;<br/>    &lt;/div&gt;<br/>    &lt;viewer&gt;&lt;/viewer&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="9fd4" class="lk kd hu lg b fv lp lm l ln lo">&lt;script&gt;<br/>import AppHeader from './components/AppHeader'<br/>import AppFooter from './components/AppFooter'<br/>import Thumbs from './components/Thumbs'<br/>import Viewer from './components/Viewer'<br/>import Vue from 'vue';<br/>import Cosmic from 'cosmicjs';<br/>import * as Config from './config';<br/>import {EventBus} from './event_bus';</span><span id="b851" class="lk kd hu lg b fv lp lm l ln lo">const bucket = { slug: Config.bucket };</span><span id="df77" class="lk kd hu lg b fv lp lm l ln lo">export default {<br/>  name: 'app',<br/>  components: {<br/>    AppFooter,<br/>    AppHeader,<br/>    Thumbs,<br/>    Viewer<br/>  },<br/>  created() {<br/>    Cosmic.getObjectType({ bucket }, { type_slug: 'globals' }, (err, res) =&gt; {<br/>      EventBus.$emit('global_loaded', res.objects.all[0]);<br/>      console.log(res.objects.all[0]);<br/>    });<br/>  },<br/>}<br/>&lt;/script&gt;</span></pre><p id="b0cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该组件在创建时加载全局数据，并通过<code class="eh lq lr ls lg b">EventBus</code>通知<code class="eh lq lr ls lg b">AppHeader</code>和<code class="eh lq lr ls lg b">AppFooter</code>组件。</p><h1 id="53e5" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">部署到Cosmic JS服务器</h1><p id="cc19" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">Cosmic JS对部署应用有一些要求:</p><ul class=""><li id="3f24" class="lt lu hu it b iu iv iy iz jc lv jg lw jk lx jo ly lz ma mb dt translated">它必须在公共git repo中</li><li id="e1e7" class="lt lu hu it b iu mc iy md jc me jg mf jk mg jo ly lz ma mb dt translated"><a class="ae jp" href="https://devcenter.heroku.com/" rel="noopener ugc nofollow" target="_blank">必须满足取决于您的平台的特定要求</a></li></ul><p id="01a2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们的例子中，我们实际上有HTML5应用程序，所以我们需要一些额外的软件。</p><h1 id="3f50" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">准备配置</h1><p id="abdd" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">在您的项目目录中创建一个<code class="eh lq lr ls lg b">prepare.js</code>文件:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="7806" class="lk kd hu lg b fv ll lm l ln lo">var fs = require('fs');</span><span id="9fe9" class="lk kd hu lg b fv lp lm l ln lo">var str = `<br/>    Config = {<br/>        bucket: '${process.env.COSMIC_BUCKET}'<br/>    };</span><span id="92dc" class="lk kd hu lg b fv lp lm l ln lo">    module.exports = Config;<br/>`;<br/>fs.writeFile("./src/config.js", str, function(err) {<br/>    if(err) {<br/>        return console.log(err);<br/>    }<br/>    console.log("The file was saved!");<br/>});</span></pre><p id="4f4c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个脚本将重写应用程序配置文件(见以上更多信息)文件，以使用您的宇宙JS桶写密钥和桶名。</p><h1 id="7d65" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">修改package.json</h1><p id="a09c" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">VueJS CLI添加了一些打包在<code class="eh lq lr ls lg b">package.json</code>上的作为<code class="eh lq lr ls lg b">devDependencies</code>。我们必须把它们都移到<code class="eh lq lr ls lg b">dependencies</code>中，这样我们的脚本才能在Cosmic JS服务器中工作。</p><h1 id="5b1e" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">准备软件</h1><p id="731b" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">我们还需要一些东西来服务我们的Angular应用程序。我们将使用快速框架:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="e1e0" class="lk kd hu lg b fv ll lm l ln lo">npm install --save express</span></pre><p id="9189" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将以下内容添加到package.json中:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="d9f8" class="lk kd hu lg b fv ll lm l ln lo">{<br/>  ...<br/>  "scripts": {<br/>    ...<br/>    "start": "node app.js"<br/>  },<br/>  ...<br/>}</span></pre><p id="5788" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要点是在<code class="eh lq lr ls lg b">scripts</code>部分定义了<code class="eh lq lr ls lg b">start</code>命令(您可以安全地替换默认角度<code class="eh lq lr ls lg b">start</code>命令)。这是将运行来启动我们的应用程序的命令。所以现在我们只剩下一件事了——创建<code class="eh lq lr ls lg b">app.js</code>文件:</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="ed24" class="lk kd hu lg b fv ll lm l ln lo">const express = require('express')<br/>const app = express()</span><span id="cce2" class="lk kd hu lg b fv lp lm l ln lo">app.use(express.static('./dist'));</span><span id="34d8" class="lk kd hu lg b fv lp lm l ln lo">app.listen(process.env.PORT, function () {<br/>});</span></pre><p id="114e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是一个简单的Express应用程序，它将<code class="eh lq lr ls lg b">dist</code>目录作为静态文件的目录。请注意-应用程序监听通过<code class="eh lq lr ls lg b">PORT</code>环境变量指定的端口，在Cosmic JS应用程序服务器上运行应用程序很重要。</p><h1 id="d4f9" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">为生产构建VueJS应用程序</h1><p id="1846" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">我们将使用<code class="eh lq lr ls lg b">app.json</code>来完成这项工作(dokku <code class="eh lq lr ls lg b">predeploy</code>部分):</p><pre class="jr js jt ju fq lf lg lh li aw lj dt"><span id="2dc6" class="lk kd hu lg b fv ll lm l ln lo">{<br/>    "scripts": {<br/>        "dokku": {<br/>            "predeploy": "node prepare.js &amp;&amp; npm run build"<br/>        }<br/>    }<br/>}</span></pre><p id="5e07" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该脚本将在我们启动express应用程序来构建VueJS生产应用程序之前执行。</p><h1 id="5dc4" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">运行它！</h1><p id="c322" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">现在你可以在你的宇宙JS仪表板中进入“部署Web应用程序”页面。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/00b6cc81dfa7bf0e8ab67d64a3704743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rOFMmN_aUG9LFqS_.png"/></div></div></figure><p id="4fb8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">只需输入您的回购网址，然后点击“部署到网站”，部署过程将开始，应用程序将在几分钟内准备就绪。</p><h1 id="fa43" class="kc kd hu bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated">结论</h1><p id="4d8e" class="pw-post-body-paragraph ir is hu it b iu la iw ix iy lb ja jb jc lc je jf jg ld ji jj jk le jm jn jo hn dt translated">使用Cosmic JS应用程序服务器允许使用git repo将应用程序快速部署到主机，而不用担心服务器配置和软件安装——一切都将由Cosmic JS服务器完成。</p><blockquote class="mh mi mj"><p id="fc1d" class="ir is mk it b iu iv iw ix iy iz ja jb ml jd je jf mm jh ji jj mn jl jm jn jo hn dt translated">这篇文章最初出现在<a class="ae jp" href="https://cosmicjs.com/blog/how-to-build-a-vuejs-photo-gallery" rel="noopener ugc nofollow" target="_blank">宇宙JS博客</a>上。</p></blockquote></div></div>    
</body>
</html>